
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as B,aa as w,ab as T,c as f,a as I,o as d,b as c,f as x,i as t,e as m,w as b,ac as S,N as $,F as g,t as F,j as h,h as N,ad as _,T as L,G as O,a0 as H,$ as A}from"./index-C9ZUjx-r.js";import{I as j,r as z}from"./item-DbYmSGlb.js";const W=B({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(k){const s=k,p=s.menu.path??JSON.stringify(s.menu),y=w(),a=w(),n=T(z),v=f(()=>n.openedMenus.includes(s.uniqueKey.at(-1))),M=f(()=>n.alwaysOpenedsMenus.includes(s.uniqueKey.at(-1))),q=f(()=>n.isMenuPopup?{enter(e){e.offsetHeight>window.innerHeight&&(e.style.height=`${window.innerHeight}px`)},afterEnter:()=>{},beforeLeave:e=>{e.style.overflow="hidden",e.style.maxHeight=`${e.offsetHeight}px`},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.overflow="",e.style.maxHeight=""}}:{enter(e){const i=e.offsetHeight;e.style.maxHeight="0",e.style.overflow="hidden",e.offsetHeight,e.style.maxHeight=`${i}px`},afterEnter(e){e.style.overflow="",e.style.maxHeight=""},beforeLeave(e){e.style.overflow="hidden",e.style.maxHeight=`${e.offsetHeight}px`},leave(e){e.style.maxHeight="0"},afterLeave(e){e.style.overflow="",e.style.maxHeight=""}}),P=f(()=>n.isMenuPopup?{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"}:{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"}),l=f(()=>{let e=!0;return s.menu.children?s.menu.children.every(i=>{var o;return((o=i.meta)==null?void 0:o.menu)===!1})&&(e=!1):e=!1,e});function R(){M.value||n.isMenuPopup&&l.value||(l.value?n.handleSubMenuClick(p,s.uniqueKey):n.handleMenuItemClick(p))}let u;function E(){n.isMenuPopup&&(n.mouseInMenu=s.uniqueKey,u==null||u(),{stop:u}=H(()=>{if(l.value)n.openMenu(p,s.uniqueKey),A(()=>{const e=y.value.ref;let i=0,o=0;n.props.mode==="vertical"||s.level!==0?(i=e.getBoundingClientRect().top+e.scrollTop,o=(n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right)+e.getBoundingClientRect().width,i+a.value.getElement().offsetHeight>window.innerHeight&&(i=window.innerHeight-a.value.getElement().offsetHeight)):(i=e.getBoundingClientRect().top+e.getBoundingClientRect().height,o=n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right,i+a.value.getElement().offsetHeight>window.innerHeight&&(a.value.getElement().style.height=`${window.innerHeight-i}px`)),a.value.getElement().style.top=`${i}px`,a.value.getElement().style.insetInlineStart=`${o}px`});else{const e=s.menu.children?n.subMenus[p].indexPath.at(-1):n.items[p].indexPath.at(-1);n.openMenu(e,n.subMenus[e].indexPath)}},300))}function K(){n.isMenuPopup&&(n.mouseInMenu=[],u==null||u(),{stop:u}=H(()=>{n.mouseInMenu.length===0?n.closeMenu(s.uniqueKey):l.value&&!n.mouseInMenu.includes(s.uniqueKey.at(-1))&&n.closeMenu(s.uniqueKey.at(-1))},300))}return(e,i)=>{const o=I("SubMenu");return d(),c(g,null,[x(j,{ref_key:"itemRef",ref:y,"unique-key":e.uniqueKey,item:e.menu,level:e.level,"sub-menu":t(l),expand:t(v),"always-expand":t(M),onClick:R,onMouseenter:E,onMouseleave:K},null,8,["unique-key","item","level","sub-menu","expand","always-expand"]),t(l)?(d(),m(O,{key:0,to:"body",disabled:!t(n).isMenuPopup},[x(L,N(t(P),_(t(q))),{default:b(()=>[t(v)?(d(),m(t(S),{key:0,ref_key:"subMenuRef",ref:a,options:{scrollbars:{visibility:"hidden"}},defer:"",class:$(["sub-menu",{"bg-[var(--g-sub-sidebar-bg)]":t(n).isMenuPopup,"ring-1 ring-stone-2 dark:ring-stone-8 shadow-xl fixed z-3000 w-[200px]":t(n).isMenuPopup,"mx-2":t(n).isMenuPopup&&(t(n).props.mode==="vertical"||e.level!==0),"rounded-2 py-1":t(n).props.rounded&&t(n).isMenuPopup}])},{default:b(()=>[(d(!0),c(g,null,F(e.menu.children,r=>{var C;return d(),c(g,{key:r.path??JSON.stringify(r)},[((C=r.meta)==null?void 0:C.menu)!==!1?(d(),m(o,{key:0,"unique-key":[...e.uniqueKey,r.path??JSON.stringify(r)],menu:r,level:e.level+1},null,8,["unique-key","menu","level"])):h("",!0)],64)}),128))]),_:1},8,["class"])):h("",!0)]),_:1},16)],8,["disabled"])):h("",!0)],64)}}});export{W as _};
