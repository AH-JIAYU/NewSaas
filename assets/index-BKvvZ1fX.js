
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as H}from"./group_team-CXRvfBlF.js";import{a as ie}from"./department-BY4vK5Aw.js";import{u as ce}from"./department-DYet1ZVw.js";import{u as me}from"./configuration_manager-CyOhJT09.js";import{u as fe}from"./position_manage-3ZghlNhE.js";import{d as pe,aN as _e,r as u,k as ve,a as c,p as he,q as ge,o as d,b as k,f as s,w as e,s as R,g as v,e as p,H as g,F as S,t as V,j as N,E as $,aJ as be,aK as Ie,R as ke}from"./index-DJy_89sN.js";import"./position_manage-B7LjRfKU.js";const ye=y=>(be("data-v-6b1aa632"),y=y(),Ie(),y),we=ye(()=>R("div",{class:"card-header"},[R("span",null,"组成员")],-1)),xe={style:{flex:"auto"}},Se=pe({name:"Edit",__name:"index",emits:["success"],setup(y,{expose:J,emit:O}){_e();const U=u(),q=u(),C=fe(),B=u(),z=ce(),b=u(),A=me(),E=u([]),G=O,M=u(""),K=u(),Q=u(!1);u([]);const L=u(),I=u(!1),_=u([]),T=u([]),D=u();u({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{chineseName:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});const w=u(null),m=u({groupId:null,userInfo:[],menuId:[]}),W={children:"children",label:"name"},X=u({commission:[{validator:(t,n,o)=>{/^[0-9]*[.]?[0-9]+$/.test(n)?o():o(new Error("请输入有效的数字或小数"))},trigger:"blur"}]});async function Y(t){M.value=t!=null&&t.id?"编辑":"新增";const n=JSON.parse(t);m.value.groupId=n.id,D.value=n.departmentId;const o={page:1,limit:10,groupId:n.id},f=await H.list(o);f!=null&&f.data.data&&f.data.data.forEach(a=>{var h,x;(x=(h=m.value)==null?void 0:h.menuId)==null||x.push(a.id),_.value.push(a)});const r=await ie.createEvery();b.value=r.data.result,b.value=b.value.filter(a=>a.id===D.value),I.value=!0}const Z=()=>{w&&(_.value=b.value[0].children.filter(t=>t.userName.includes(w.value)))};ve(async()=>{B.value=await(C==null?void 0:C.getPositionManage())||[],b.value=await z.getDepartment(),E.value=await A.getStaff(),K.value=new Date});function j(t,n){const o=t.findIndex(f=>f.memberId===n);o!==-1&&t.splice(o,1)}function F(t,n){t.some(o=>o.id===n.id)||t.push(n)}function ee(t){_.value=_.value.filter(o=>o.id!==t.id),U.value.getNode(t.id).checked?t.children&&t.children.length?t.children.forEach(o=>F(_.value,o)):F(_.value,t):t.children&&t.children.length?t.children.forEach(o=>j(_.value,o.id)):j(_.value,t.id)}function te(){return new Promise(t=>{L.value&&L.value.validate(n=>{if(n){m.value.userInfo=[],delete m.value.menuId;let o=0;T.value.forEach(r=>{r.commission&&(o+=r.commission);let a={userId:r.memberId,commission:r.commission};m.value.userInfo.push(a)}),_.value.forEach(r=>{r.commission&&(o+=r.commission);let a;r.memberId?a={userId:r.memberId,commission:r.commission}:a={userId:r.id,commission:r.commission},m.value.userInfo.push(a)});const f=new Set;if(m.value.userInfo=m.value.userInfo.filter(r=>{const{userId:a}=r;return f.has(a)?!1:(f.add(a),!0)}),o>100){$.warning({message:"提成比例不能超过100",center:!0});return}H.edit(m.value).then(()=>{$.success({message:"操作成功",center:!0}),G("success"),I.value=!1,t()})}})})}const ae=()=>{Object.assign(m.value,{groupId:null,userInfo:[],menuId:[]}),T.value=[],_.value=[]};return J({showEdit:Y}),(t,n)=>{const o=c("el-input"),f=c("el-tree"),r=c("el-col"),a=c("el-text"),h=c("el-table-column"),x=c("el-form-item"),le=c("el-form"),oe=c("el-empty"),ne=c("el-table"),se=c("el-row"),re=c("el-card"),P=c("el-button"),ue=c("el-drawer"),de=he("loading");return ge((d(),k("div",null,[s(ue,{modelValue:I.value,"onUpdate:modelValue":n[2]||(n[2]=l=>I.value=l),title:M.value,onClose:ae,size:"60%"},{footer:e(()=>[R("div",xe,[s(P,{type:"",onClick:n[1]||(n[1]=l=>I.value=!1)},{default:e(()=>[v(" 取消 ")]),_:1}),s(P,{type:"primary",onClick:te},{default:e(()=>[v(" 确定 ")]),_:1})])]),default:e(()=>[s(re,{class:"box-card"},{header:e(()=>[we]),default:e(()=>[s(se,{gutter:20},{default:e(()=>[s(r,{class:"leftData",span:8},{default:e(()=>[s(o,{modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=l=>w.value=l),placeholder:"可输入用户名查找",clearable:"",onBlur:Z},null,8,["modelValue"]),s(f,{style:{"max-width":"37.5rem","min-height":"20.125rem","margin-top":"20px"},data:b.value,ref_key:"treeRef",ref:U,"show-checkbox":"","node-key":"id","default-checked-keys":m.value.menuId,"default-expanded-keys":m.value.menuId,"default-expand-all":"",props:W,onCheck:ee},null,8,["data","default-checked-keys","default-expanded-keys"])]),_:1}),s(r,{span:16},{default:e(()=>[s(ne,{ref_key:"tableRef",ref:q,data:_.value,border:""},{empty:e(()=>[s(oe,{description:"暂无数据"})]),default:e(()=>[s(h,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"},{default:e(({row:l})=>[l.id?(d(),p(a,{key:0},{default:e(()=>[v(g(l.id),1)]),_:2},1024)):(d(),p(a,{key:1},{default:e(()=>[v(g(l.id),1)]),_:2},1024))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"userName",label:"用户名"},{default:e(({row:l})=>[l.id?(d(!0),k(S,{key:0},V(E.value,i=>(d(),p(a,null,{default:e(()=>[l.id===i.id?(d(),p(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):N("",!0)]),_:2},1024))),256)):(d(),p(a,{key:1},{default:e(()=>[v(g(l.userName?l.userName:"-"),1)]),_:2},1024))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"name",label:"姓名"},{default:e(({row:l})=>[l.id?(d(!0),k(S,{key:0},V(E.value,i=>(d(),p(a,null,{default:e(()=>[l.id===i.id?(d(),p(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):N("",!0)]),_:2},1024))),256)):(d(),p(a,{key:1},{default:e(()=>[v(g(l.name),1)]),_:2},1024))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"职位"},{default:e(({row:l})=>[(d(!0),k(S,null,V(B.value,i=>(d(),p(a,null,{default:e(()=>[l.positionId===i.id?(d(),p(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):N("",!0)]),_:2},1024))),256))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:l})=>[(d(!0),k(S,null,V(b.value,i=>(d(),p(a,null,{default:e(()=>[D.value===i.id?(d(),p(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):N("",!0)]),_:2},1024))),256))]),_:1}),s(h,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:l})=>[s(le,{model:l,ref_key:"formRef",ref:L,rules:X.value},{default:e(()=>[s(x,{prop:"commission"},{default:e(()=>[s(o,{modelValue:l.commission,"onUpdate:modelValue":i=>l.commission=i,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[v("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])),[[de,Q.value]])}}}),Ue=ke(Se,[["__scopeId","data-v-6b1aa632"]]);export{Ue as default};
