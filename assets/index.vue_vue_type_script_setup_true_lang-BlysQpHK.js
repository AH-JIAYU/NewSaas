
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as S}from"./index.vue_vue_type_script_setup_true_lang-C8wWXQsJ.js";import{a as d}from"./user_customer-0ChSzHWC.js";import{u as L}from"./stagedData-CTwcWJWt.js";import{d as B,r as m,a0 as I,a1 as f,a as _,o as g,b as z,f as u,w as r,g as p,e as P,j,i as F,al as C,ai as v}from"./index-C_N3Tfx9.js";const G=B({__name:"index",emits:["fetch-data"],setup(M,{expose:b,emit:w}){const c=L(),y=w,n=m(!1),o=m(""),l=m([]);function k(e){l.value.push(e)}I("validateTopTabs",k);let s=f([]);const D=[{customerAccord:"客户名称",customerShortName:"",companyName:"",customerName:"",customerPhone:"",emailAddress:"",chargeName:"",settlementCycle:null,customerStatus:null,antecedentQuestionnaire:null,riskControl:null,turnover:null,rateAudit:null}];async function N(e){if(!e)o.value="添加",s=c.userCustomer||C(D);else{o.value="编辑";const{data:t}=await d.detail({tenantCustomerId:e.tenantCustomerId});T(t)}n.value=!0}function T(e){s.length=0,s.push({...e}),e.children&&e.children.length&&e.children.forEach(t=>{s.push({...t})})}function x(e){const t=new Set;for(const a of e){if(t.has(a.customerAccord))return!0;t.add(a.customerAccord)}return!1}function V(){c.userCustomer=C(s),s=f([]),n.value=!1,l.value=[]}function h(){s=f([]),n.value=!1,l.value=[],o.value==="添加"&&(c.userCustomer=null)}async function A(){const e=[];l.value.forEach(t=>{e.push(t.validate())});try{if((await Promise.all(e)).every(a=>a))if(x(s))v.warning({message:"客户名称重复",center:!0});else{if(o.value==="添加"){const a={tenantCustomerInfoList:s},{status:i}=await d.create(a);i===1&&v.success({message:"新增成功",center:!0})}else{const{status:a}=await d.edit(s[0]);a===1&&v.success({message:"修改成功",center:!0})}y("fetch-data"),h()}}catch(t){console.error("Form validation failed:",t)}}return b({showEdit:N}),(e,t)=>{const a=_("el-button"),i=_("el-drawer");return g(),z("div",null,[u(i,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=E=>n.value=E),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%"},{footer:r(()=>[u(a,{onClick:h},{default:r(()=>[p(" 取消 ")]),_:1}),o.value==="添加"?(g(),P(a,{key:0,type:"warning",onClick:V},{default:r(()=>[p(" 暂存 ")]),_:1})):j("",!0),u(a,{type:"primary",onClick:A},{default:r(()=>[p(" 确定 ")]),_:1})]),default:r(()=>[u(S,{title:o.value,"left-tabs-data":F(s),"validate-top-tabs":l.value},null,8,["title","left-tabs-data","validate-top-tabs"])]),_:1},8,["modelValue"])])}}});export{G as _};
