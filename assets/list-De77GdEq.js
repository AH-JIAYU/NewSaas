
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as M,d as ye,aM as ke,r as i,n as Ce,a as r,q as j,o as s,b as U,f as l,w as t,s as k,e as u,g as n,i as _,aN as Se,A as c,v as q,O as Q,j as p,F as G,aO as we,E as J,aP as Te,aQ as xe,be as Ne,ao as ze,M as Ae}from"./index-fxjDEbzK.js";import{_ as Be}from"./index-BK07XJpG.js";import{_ as Ie}from"./index.vue_vue_type_style_index_0_lang-ZUk-NFkM.js";import{_ as Le}from"./index-Dtqdd95m.js";import{U as Ee}from"./user_supplier-CHmFP3ae.js";import"./index-BOiTd8p2.js";import"./clipboard-8Jy29zkY.js";import"./index.vue_vue_type_script_setup_true_lang-DitCt3JY.js";import"./sortable.esm-C0-Qcoum.js";import"./user_supplier-Bu9pnZHl.js";const x={list:b=>M.post("bill/getTenantSupplierBillList",b),changestatus:b=>M.post("bill/updateTenantSupplierBill",b),settlement:b=>M.post("bill/addTenantSupplierBill",b)},Fe={class:"copyId tableSmall"},Pe={class:"id oneLine projectId fontColor"},De=ye({name:"supplierSettlement",__name:"list",setup(b){const K=Ee(),{getParams:W,pagination:g,onSizeChange:X,onCurrentChange:Y}=ke(),Z=i(""),C=i(!0);i();const N=i(!1),d=i([]),z=i(!0);i(!1);const A=i("default"),B=i(!0),ee=i([]),te=[{label:"待收票",value:1},{label:"待支付",value:2},{label:"已支付",value:3},{label:"已拒绝",value:4}],le=K.payMethod,$=i(),ae=i("formSearch-supplierSettlement"),I=i([{label:"供应商名称",prop:"supplierName",sortable:!0,checked:!0},{label:"供应商ID",prop:"supplierId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税费",prop:"taxesFees",sortable:!0,checked:!0},{label:"实付金额",prop:"payAmount",sortable:!0,checked:!0},{label:"状态",prop:"billStatus",sortable:!0,checked:!0}]),L=i({supplierId:"",billStatus:[],time:[],beginTime:"",endTime:""}),H=i([]);function oe(o){ee.value=o}function ne(){Object.assign(L.value,{supplierId:"",billStatus:[],time:[],beginTime:"",endTime:""})}function se(o){X(o).then(()=>h())}function E(o=1){Y(o).then(()=>h())}async function h(){try{C.value=!0;const o={...W(),...L.value},a=await x.list(o);H.value=a.data.tenantSupplierBillInfoList,g.value.total=a.data.total,C.value=!1}catch{}finally{C.value=!1}}const ie=async()=>{const{data:o}=await x.settlement({});o&&h()};async function F(o,a){a===3?we.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async S=>{(await x.changestatus({id:o,type:a,notes:S.value})).status===1&&J.success({message:"操作成功"}),h()}):((await x.changestatus({id:o,type:a})).status===1&&J.success({message:"操作成功"}),h())}Ce(()=>{I.value.forEach(o=>{o.checked&&d.value.push(o.prop)}),h(),$.value=[{index:1,show:!0,type:"input",modelName:"supplierId",placeholder:"供应商ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"billStatus",placeholder:"状态",option:"billStatus",optionLabel:"label",optionValue:"value",multiple:!0}]});const ue={billStatus:()=>te},P=i();function re(o){o?P.value=o.id:P.value=""}return(o,a)=>{const S=Le,R=r("ElDivider"),y=r("el-button"),ce=Ie,pe=Te,de=xe,O=r("el-row"),v=r("el-col"),m=r("el-text"),f=r("el-table-column"),me=Be,D=Ne,w=r("el-tag"),fe=r("ElTableColumn"),_e=r("el-empty"),be=r("el-table"),ge=r("ElPagination"),he=ze,T=j("auth"),ve=j("loading");return s(),U("div",{class:Q({"absolute-container":N.value})},[l(he,null,{default:t(()=>[l(S,{formSearchList:$.value,formSearchName:ae.value,onCurrentChange:E,onOnReset:ne,model:L.value,formOption:ue},null,8,["formSearchList","formSearchName","model"]),l(R,{"border-style":"dashed"}),l(O,{gutter:24},{default:t(()=>[l(ce,null,{default:t(()=>[k((s(),u(y,{size:"default",type:"primary",onClick:ie},{default:t(()=>[n(" 手动结算 ")]),_:1})),[[T,"supplierSettlement-get-addTenantSupplierBill"]])]),_:1}),l(de,null,{default:t(()=>[l(y,{size:"default",onClick:a[0]||(a[0]=()=>{})},{default:t(()=>[n(" 导出 ")]),_:1}),l(pe,{border:z.value,"onUpdate:border":a[1]||(a[1]=e=>z.value=e),tableAutoHeight:N.value,"onUpdate:tableAutoHeight":a[2]||(a[2]=e=>N.value=e),checkList:d.value,"onUpdate:checkList":a[3]||(a[3]=e=>d.value=e),columns:I.value,"onUpdate:columns":a[4]||(a[4]=e=>I.value=e),"line-height":A.value,"onUpdate:lineHeight":a[5]||(a[5]=e=>A.value=e),stripe:B.value,"onUpdate:stripe":a[6]||(a[6]=e=>B.value=e),style:{"margin-left":"12px"},onQueryData:E},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),k((s(),u(be,{ref_key:"tableSortRef",ref:Z,style:{"margin-top":"10px"},"row-key":"id",data:H.value,border:z.value,size:A.value,stripe:B.value,onSelectionChange:oe,"highlight-current-row":"",onCurrentChange:re},{empty:t(()=>[l(_e,{image:_(Se),"image-size":300},null,8,["image"])]),default:t(()=>[l(f,{type:"expand"},{default:t(e=>[l(O,{gutter:20,style:{margin:"10px 0"}},{default:t(()=>[l(v,{span:1}),l(v,{span:3},{default:t(()=>[l(m,{class:"fontColor"},{default:t(()=>[n("付款方式: "+c(_(le)[e.row.billStatus-1].label),1)]),_:2},1024)]),_:2},1024),l(v,{span:3},{default:t(()=>[l(m,{class:"fontColor"},{default:t(()=>[n("账户名称: "+c(e.row.accountName?e.row.accountName:"-"),1)]),_:2},1024)]),_:2},1024),l(v,{span:3},{default:t(()=>[l(m,{class:"fontColor"},{default:t(()=>[n("收款账号: "+c(e.row.collectionAccount?e.row.collectionAccount:"-"),1)]),_:2},1024)]),_:2},1024),l(v,{span:3},{default:t(()=>[l(m,{class:"fontColor"},{default:t(()=>[n("银行名称: "+c(e.row.bankName?e.row.bankName:"-"),1)]),_:2},1024)]),_:2},1024),l(v,{span:3},{default:t(()=>[l(m,{class:"fontColor"},{default:t(()=>[n("结算周期: "+c(e.row.settlementCycle?e.row.settlementCycle:"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),d.value.includes("supplierId")?(s(),u(f,{key:0,"show-overflow-tooltip":"",align:"left",label:"供应商ID"},{default:t(({row:e})=>[q("div",Fe,[q("div",Pe,c(e.supplierId?e.supplierId:"-"),1),l(me,{content:e.supplierId,class:Q([{rowCopy:"rowCopy",current:e.id===P.value},"littleButton"])},null,8,["content","class"])])]),_:1})):p("",!0),d.value.includes("supplierName")?(s(),u(f,{key:1,prop:"supplierName","show-overflow-tooltip":"",align:"left",label:"供应商名称"},{default:t(({row:e})=>[l(m,{class:"fontColor"},{default:t(()=>[n(c(e.supplierName?e.supplierName:"-"),1)]),_:2},1024)]),_:1})):p("",!0),d.value.includes("billTime")?(s(),u(f,{key:2,prop:"billTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:t(({row:e})=>[l(m,{class:"fontColor"},{default:t(()=>[n(c(e.billTime?e.billTime:"-"),1)]),_:2},1024)]),_:1})):p("",!0),d.value.includes("billAmount")?(s(),u(f,{key:3,prop:"billAmount","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:t(({row:e})=>[l(m,{class:"fontColor"},{default:t(()=>[l(D),n(c(e.billAmount||0),1)]),_:2},1024)]),_:1})):p("",!0),d.value.includes("taxesFees")?(s(),u(f,{key:4,prop:"taxesFees","show-overflow-tooltip":"",align:"left",label:"税费"},{default:t(({row:e})=>[l(m,{class:"fontColor"},{default:t(()=>[l(D),n(c(e.taxesFees||0),1)]),_:2},1024)]),_:1})):p("",!0),d.value.includes("payAmount")?(s(),u(f,{key:5,prop:"payAmount","show-overflow-tooltip":"",align:"left",label:"实付金额"},{default:t(({row:e})=>[l(m,{class:"fontColor"},{default:t(()=>[l(D),n(c(e.payAmount||0),1)]),_:2},1024)]),_:1})):p("",!0),d.value.includes("billStatus")?(s(),u(fe,{key:6,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:t(({row:e})=>[e.billStatus===1?(s(),u(w,{key:0,type:"warning",effect:"dark",style:{"background-color":"skyblue","border-color":"white"}},{default:t(()=>[n("待收票")]),_:1})):p("",!0),e.billStatus===2?(s(),u(w,{key:1,type:"warning",effect:"dark",style:{"background-color":"#FFAC54","border-color":"white"}},{default:t(()=>[n("待支付")]),_:1})):p("",!0),e.billStatus===3?(s(),u(w,{key:2,type:"success",effect:"dark",style:{"border-color":"white"}},{default:t(()=>[n("已支付")]),_:1})):p("",!0),e.billStatus===4?(s(),u(w,{key:3,type:"danger",effect:"dark",style:{"border-color":"white"}},{default:t(()=>[n("已拒绝")]),_:1})):p("",!0)]),_:1})):p("",!0),l(f,{align:"left",fixed:"right",label:"操作",width:"170"},{default:t(({row:e})=>[e.billStatus===1?k((s(),u(y,{key:0,size:"small",plain:"",type:"primary",onClick:V=>F(e.id,1)},{default:t(()=>[n(" 确认收票 ")]),_:2},1032,["onClick"])),[[T,"supplierSettlement-update-updateTenantSupplierBill"]]):e.billStatus===2?(s(),U(G,{key:1},[k((s(),u(y,{size:"small",plain:"",onClick:V=>F(e.id,2)},{default:t(()=>[n(" 支付 ")]),_:2},1032,["onClick"])),[[T,"supplierSettlement-update-updateTenantSupplierBill"]]),k((s(),u(y,{size:"small",plain:"",type:"danger",onClick:V=>F(e.id,3)},{default:t(()=>[n(" 拒绝 ")]),_:2},1032,["onClick"])),[[T,"supplierSettlement-update-updateTenantSupplierBill"]])],64)):(s(),U(G,{key:2},[n("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[ve,C.value]]),l(ge,{"current-page":_(g).page,total:_(g).total,"page-size":_(g).size,"page-sizes":_(g).sizes,layout:_(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:se,onCurrentChange:E},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),Ge=Ae(De,[["__scopeId","data-v-e16b9aef"]]);export{Ge as default};
