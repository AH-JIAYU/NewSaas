
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as L}from"./configuration_role-BOr2nU1C.js";import{x as G,af as H,r as i,d as M,bo as T,k as j,E as F,a as _,p as J,q as O,i as s,o as x,b as w,f,w as p,e as S,s as I,H as P,F as z,t as Q,g as W,j as K,R as X}from"./index-CzARc10T.js";const Y={list:()=>G.get("role/getRoleButton")},Z=H("buttonPermission",()=>{const v=i([]);return{permissions:v,getPermissions:async()=>{if(v.value.length)return v.value;const{data:h}=await Y.list();return v.value=h,h}}}),D=Z,ee={class:"custom-tree-node"},te={class:"menu"},oe={class:"permission"},se={key:0,class:"permissions"},le=M({__name:"index",props:["id","row"],setup(v,{expose:E}){const h=v,R=T(),U=D(),d=i(!1),k=i(),g=i(),V=i([]),a=i([]),e=i({id:h.id??null,menuId:[],permission:[],roleName:"",remark:""}),$=i({roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]});j(async()=>{try{d.value=!0,e.value.id!==""&&await q(),a.value=await U.getPermissions(),V.value=R.routesRaw;const l=await R.obtainLevel1AndLevel2Routing();e.value.menuId=e.value.menuId.filter(t=>!l.some(n=>n.id===t)),d.value=!1}catch{}finally{d.value=!1}});async function q(){d.value=!0,e.value=JSON.parse(h.row),d.value=!1}function N(l){var t;return(t=a==null?void 0:a.value)==null?void 0:t.filter(n=>l===n.menuId)}const A=l=>{const t=[];t.push(l),g.value.getNode(l.id).checked?t.map(r=>{var c;const o=(c=a==null?void 0:a.value)==null?void 0:c.filter(u=>r.id===u.menuId);o&&o.length&&o.forEach(u=>{e.value.permission.push(u.id)})}):t.map(r=>{var c;const o=(c=a==null?void 0:a.value)==null?void 0:c.filter(u=>r.id===u.menuId);if(o&&o.length){let u=o.map(b=>b.id);e.value.permission=e.value.permission.filter(b=>!u.some(C=>C===b))}})};return E({submit(){return e.value.menuId=g.value.getCheckedKeys(!1),new Promise(l=>{const t=g.value.getCheckedKeys(),n=g.value.getHalfCheckedKeys(),r=t.concat(n);e.value.menuId=r,e.value.id===""?k.value&&k.value.validate(o=>{o&&L.create(e.value).then(()=>{F.success({message:"新增成功",center:!0}),l()})}):k.value&&k.value.validate(o=>{o&&L.edit(e.value).then(()=>{F.success({message:"编辑成功",center:!0}),l()})})})}}),(l,t)=>{const n=_("ElInput"),r=_("ElFormItem"),o=_("ElCheckbox"),c=_("ElCheckboxGroup"),u=_("el-tree"),b=_("ElForm"),C=J("loading");return O((x(),w("div",null,[f(b,{ref_key:"formRef",ref:k,model:s(e),rules:s($),"label-width":"120px"},{default:p(()=>[f(r,{label:"角色名称",prop:"roleName"},{default:p(()=>[f(n,{modelValue:s(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=m=>s(e).roleName=m),disabled:!!s(e).id,placeholder:"请输入角色名称"},null,8,["modelValue","disabled"])]),_:1}),f(r,{label:"备注",prop:"remark"},{default:p(()=>[f(n,{modelValue:s(e).remark,"onUpdate:modelValue":t[1]||(t[1]=m=>s(e).remark=m),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),f(r,{label:"权限"},{default:p(()=>[s(d)?K("",!0):(x(),S(u,{key:0,ref_key:"treeRef",ref:g,data:s(V),style:{width:"100%"},"default-checked-keys":s(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"",onCheckChange:A,"default-expand-all":"",border:""},{default:p(({data:m})=>{var B;return[I("div",ee,[I("div",te,P(m.meta.title),1),I("div",oe,[(B=N(m.id))!=null&&B.length?(x(),w("div",se,[f(c,{modelValue:s(e).permission,"onUpdate:modelValue":t[2]||(t[2]=y=>s(e).permission=y)},{default:p(()=>[(x(!0),w(z,null,Q(N(m.id),y=>(x(),S(o,{key:y.id,value:y.id},{default:p(()=>[W(P(y.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):K("",!0)])])]}),_:1},8,["data","default-checked-keys"]))]),_:1})]),_:1},8,["model","rules"])])),[[C,s(d)]])}}}),re=X(le,[["__scopeId","data-v-4f8ed666"]]);export{re as default};
