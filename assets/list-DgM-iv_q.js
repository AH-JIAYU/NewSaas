
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as N,d as fe,aM as _e,r as n,n as ve,a as c,q as $,o as r,b as x,f as o,w as a,s as b,e as s,g as i,i as f,aN as he,v as O,A as y,O as q,j as p,F as V,E as U,aP as Se,aQ as be,be as ye,ao as ze,M as Ce}from"./index-puGejJ6c.js";import{_ as ke}from"./index-CUmVAZCa.js";import{_ as Te}from"./index.vue_vue_type_style_index_0_lang-CZKVSSDz.js";import{_ as we}from"./index-BTFXVoNN.js";import"./index-SAQW-vwF.js";import"./clipboard-H53ocpNK.js";import"./index.vue_vue_type_script_setup_true_lang-BqyJygVi.js";import"./sortable.esm-C0-Qcoum.js";const M={queryOrganizationalStructureSettlementRecordList:d=>N.post("financial-record/queryOrganizationalStructureSettlementRecordList",d),organizationalStructureSettlement:d=>N.post("organizationalStructure/organizationalStructureSettlement",d),organizationalStructureSettlementUpdate:d=>N.post("organizationalStructure/organizationalStructureSettlementUpdate",d)},Pe={class:"copyId tableSmall"},Ee={class:"id oneLine projectId fontColor"},Ie=fe({name:"PMSettlement",__name:"list",setup(d){const{getParams:B,pagination:g,onSizeChange:j,onCurrentChange:J}=_e(),Q=n(""),h=n(!0);n();const z=n(!1),m=n([]),C=n(!0);n(!1);const k=n("default"),T=n(!0);n([]);const G=[{label:"待支付",value:"PENDING"},{label:"已支付",value:"PAID"},{label:"已拒绝",value:"REJECTED"}],R=n(),K=n("formSearch-PMSettlement"),w=n([{label:"部门ID",prop:"organizationalStructureId",sortable:!0,checked:!0},{label:"部门名称",prop:"name",sortable:!0,checked:!0},{label:"账单日期",prop:"createTime",sortable:!0,checked:!0},{label:"账单金额",prop:"price",sortable:!0,checked:!0},{label:"状态",prop:"status",sortable:!0,checked:!0}]),u=n({organizationalStructureId:"",status:[],time:[],startTime:null,endTime:null}),A=n([]);function W(){Object.assign(u.value,{organizationalStructureId:"",status:[],time:[],startTime:null,endTime:null})}function X(l){j(l).then(()=>_())}function P(l=1){J(l).then(()=>_())}async function _(){try{h.value=!0,u.value.time.length?(u.value.startTime=u.value.time[0],u.value.endTime=u.value.time[1]):(u.value.time=[],u.value.startTime=null,u.value.endTime=null);const l={...B(),...u.value};delete l.time;const t=await M.queryOrganizationalStructureSettlementRecordList(l);A.value=t.result,g.value.total=t.total?Number(t.total):0,h.value=!1}catch{}finally{h.value=!1}}const Y=async()=>{const{status:l,error:t}=await M.organizationalStructureSettlement({});l==1?(U.success({message:"手动结算成功",center:!0}),_()):U.success({message:t,center:!0})};async function F(l,t){(await M.organizationalStructureSettlementUpdate({id:l,status:t})).status===1&&U.success({message:"操作成功"}),_()}ve(()=>{w.value.forEach(l=>{l.checked&&m.value.push(l.prop)}),_(),R.value=[{index:1,show:!0,type:"input",modelName:"organizationalStructureId",placeholder:"部门ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"status",placeholder:"状态",option:"status",optionLabel:"label",optionValue:"value",multiple:!0}]});const Z={status:()=>G},E=n();function ee(l){l?E.value=l.id:E.value=""}return(l,t)=>{const H=we,te=c("ElDivider"),S=c("el-button"),ae=Te,le=Se,ne=be,oe=c("el-row"),re=ke,v=c("el-table-column"),I=c("el-text"),se=ye,D=c("el-tag"),ue=c("ElTableColumn"),ie=c("el-empty"),ce=c("el-table"),me=c("ElPagination"),pe=ze,L=$("auth"),de=$("loading");return r(),x("div",{class:q({"absolute-container":z.value})},[o(pe,null,{default:a(()=>[o(H,{formSearchList:R.value,formSearchName:K.value,onCurrentChange:P,onOnReset:W,model:u.value,formOption:Z},null,8,["formSearchList","formSearchName","model"]),o(te,{"border-style":"dashed"}),o(oe,{gutter:24},{default:a(()=>[o(ae,null,{default:a(()=>[b((r(),s(S,{size:"default",type:"primary",onClick:Y},{default:a(()=>[i(" 手动结算 ")]),_:1})),[[L,"PMSettlement-update-organizationalStructureSettlement"]])]),_:1}),o(ne,null,{default:a(()=>[o(S,{size:"default",onClick:t[0]||(t[0]=()=>{})},{default:a(()=>[i(" 导出 ")]),_:1}),o(le,{border:C.value,"onUpdate:border":t[1]||(t[1]=e=>C.value=e),tableAutoHeight:z.value,"onUpdate:tableAutoHeight":t[2]||(t[2]=e=>z.value=e),checkList:m.value,"onUpdate:checkList":t[3]||(t[3]=e=>m.value=e),columns:w.value,"onUpdate:columns":t[4]||(t[4]=e=>w.value=e),"line-height":k.value,"onUpdate:lineHeight":t[5]||(t[5]=e=>k.value=e),stripe:T.value,"onUpdate:stripe":t[6]||(t[6]=e=>T.value=e),style:{"margin-left":"12px"},onQueryData:P},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),b((r(),s(ce,{ref_key:"tableSortRef",ref:Q,style:{"margin-top":"10px"},"row-key":"id",data:A.value,border:C.value,size:k.value,stripe:T.value,"highlight-current-row":"",onCurrentChange:ee},{empty:a(()=>[o(ie,{image:f(he),"image-size":300},null,8,["image"])]),default:a(()=>[m.value.includes("organizationalStructureId")?(r(),s(v,{key:0,"show-overflow-tooltip":"",align:"left",label:"部门ID"},{default:a(({row:e})=>[O("div",Pe,[O("div",Ee,y(e.organizationalStructureId?e.organizationalStructureId:"-"),1),o(re,{content:e.organizationalStructureId,class:q({rowCopy:"rowCopy",current:e.id===E.value})},null,8,["content","class"])])]),_:1})):p("",!0),m.value.includes("name")?(r(),s(v,{key:1,prop:"name","show-overflow-tooltip":"",align:"left",label:"部门名称"},{default:a(({row:e})=>[o(I,{class:"fontColor"},{default:a(()=>[i(y(e.name?e.name:"-"),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("createTime")?(r(),s(v,{key:2,prop:"createTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:a(({row:e})=>[o(I,{class:"fontColor"},{default:a(()=>[i(y(e.createTime?e.createTime:"-"),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("price")?(r(),s(v,{key:3,prop:"price","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:a(({row:e})=>[o(I,{class:"fontColor"},{default:a(()=>[o(se),i(y(e.price||0),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("status")?(r(),s(ue,{key:4,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:a(({row:e})=>[e.status=="待支付"?(r(),s(D,{key:0,type:"warning",effect:"dark",style:{"background-color":"#FFAC54"}},{default:a(()=>[i("待支付")]),_:1})):p("",!0),e.status=="已支付"?(r(),s(D,{key:1,type:"success",effect:"dark"},{default:a(()=>[i("已支付")]),_:1})):p("",!0),e.status=="已拒绝"?(r(),s(D,{key:2,type:"danger",effect:"dark"},{default:a(()=>[i("已拒绝")]),_:1})):p("",!0)]),_:1})):p("",!0),o(v,{align:"left",fixed:"right",label:"操作",width:"170"},{default:a(({row:e})=>[e.status=="待支付"?(r(),x(V,{key:0},[b((r(),s(S,{size:"small",type:"primary",plain:"",onClick:ge=>F(e.id,"PAID")},{default:a(()=>[i(" 支付 ")]),_:2},1032,["onClick"])),[[L,"PMSettlement-update-organizationalStructureSettlementUpdate"]]),b((r(),s(S,{size:"small",plain:"",type:"danger",onClick:ge=>F(e.id,"REJECTED")},{default:a(()=>[i(" 拒绝 ")]),_:2},1032,["onClick"])),[[L,"PMSettlement-update-organizationalStructureSettlementUpdate"]])],64)):(r(),x(V,{key:1},[i("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[de,h.value]]),o(me,{"current-page":f(g).page,total:f(g).total,"page-size":f(g).size,"page-sizes":f(g).sizes,layout:f(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:X,onCurrentChange:P},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),Fe=Ce(Ie,[["__scopeId","data-v-913d0de1"]]);export{Fe as default};
