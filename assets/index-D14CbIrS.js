
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as ne,a as ue}from"./he-Cx_rshqu.js";import{o as D,s as de}from"./apiLoading-Bh6oZbbQ.js";import{a as Y}from"./projectManagement-Dp7VNLYN.js";import{a as ce}from"./user_cooperation-Dw7BwrRU.js";import{a as fe}from"./survey_vip_department-MLR0KCCW.js";import{U as ge}from"./user_supplier-BgEnZGVP.js";import{u as me}from"./survey_vipGroup-DrFtI3Zw.js";import{d as ve,r as n,n as Ie,a as v,q as Ae,o as d,b as S,f as p,w as s,y as I,g as c,s as Se,i as a,e as E,j as y,F as z,t as G,A as Le,E as Q,aH as ye,aI as he,L as be}from"./index-VxlvK3Gs.js";import"./user_supplier-P8GCk7fh.js";import"./survey_vipGroup-D_EL7nuh.js";const N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAS1JREFUKFN1kr8vQ1EUxz+HRl5EYhEaSRMSTBIDo/DKYDCwWVjKZrAYREgaJTF0MJD4kdbSjT/AxAsREgYSo0gs/gDLE1575Op77VV1l3ty7vfzzflxhfC4aY2RYAZhGugBPlAeBPYv5uUx0okJxo+0o9jAKcJw9FBzb3opWTc5cY/VocQVwtA/4ii95qVkywBLKDu2OJ2E8xe4fLWySsAnveLm9K7WPd4C2Qk4vP8DLRvgCyHW1gyDnVVHA80NwIb3CyqIm1cfcPrbYbKvCjQ1wmgXnD1D9rqSL9QtyYgzY+AHkPGgqCEgrBhgEWHXbnp1BH4gW2z24tMt4cJu7MYTrfD2bjmX3cpjNZG7p3EcTuouzoxT2K4szi4lmdcphdnwawTALSUOvAV5inTfDOJhkx1Lf7QAAAAASUVORK5CYII=",_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAklJREFUOE+VlF9Ik2EUxp/HjbZSgoqJZFiLIBeEgoOEiBZ02UAoWFCwdbUNEvKui0CFLrorUHBdaVHQqGiw0V1oRNGFhiGUdtGWDlquMMJs4fpOfPv7fdvrau/d953n/b3nHM55CMWREY8Vfd0+oQwA6AfYUZKlITJPtsRS2V9R56WpXO111v6QeOiCUG4A3Kd6zPAvQ5Er9N6OGnUVoJ6V5u6+SeDyP0CmsIhEWuaWBjkyk9cDFeCfeHiClFAzsLJWgHHLmchgBShPgz7R+EAJ6zoBOI4UQ6sLwMorpYyCi/RG7lMmA3Zx2JMAyo0HDp4G9nuA94+BHj9otRUh+Rzk7V3AdRZIPgNS0wa4pDm75KQkwn6BTJme9YyCre2Q+TuGppQUArDXD/xchcwMm64VstTiwScg9fGonlPXwR17Grdz4xtk+lqNRh5RS4T0cg+ogLL2Efj9w3xpWxu4+xCgBqZ14CYAqxK4/BLIrZmB9l1g1/EtgMg3Bn5ZADbX6zNsP9oIGFyp24pSD+XzGyD33Qy07QT3urcqOUUtEXwI8Nx/l9zqADuPqYEiMRZ3F/eUwK8fgPyGOUOLDXS4lECCAeo7LO7DSVPZJ4fBtuqcK+dnPQN5PmoMZT5lc87CLtdl2dEDdPY3nsPlF0D2XUVDkfO681TNIREaa9ZpyjQRRizeibD+bbavPtdYs45DYByzi0N19lV5reg8t0xmoSxe0hRe1R3GGK5z7EJPJwN2OLb7RLQBkL0ASu4tGQCvKYxhbjFazsoI/AvM0v9Xs8g/iwAAAABJRU5ErkJggg==",_=k=>(ye("data-v-dea21e8b"),k=k(),he(),k),je=_(()=>I("span",{class:"icon-class"},[I("img",{src:ne,alt:"",style:{"margin-right":"0.25rem"}}),c(" 供应商")],-1)),ke=_(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ve={key:1},Ce=_(()=>I("span",{class:"icon-class"},[I("img",{src:_e,alt:"",style:{"margin-right":"0.25rem"}}),c(" 调查站")],-1)),xe=_(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Te={key:1},Ee=_(()=>I("span",{class:"icon-class"},[I("img",{src:ue,alt:"",style:{"margin-right":"0.25rem"}}),c(" 合作商")],-1)),we=_(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Re={key:1},Ue={style:{flex:"auto"}},Pe=ve({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(k,{expose:J,emit:M}){const F=ge();me();const H=M,V=n(!1),j=n(!1),w=n(),h=n(),b=n([]),q={children:"children",label:"name"};n([]);const e=n({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),f=n({projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),g=n({projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),r=n({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),W=n({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]}),C=n();async function Z(t,l){if(e.value.list=[{...t}],l==="reassign"){e.value.title="重新分配";const m=await D(Y.getProjectAllocation({projectId:t.projectId}));e.value.form.projectId=t.projectId;const{getProjectAllocationInfoList:L}=m.data;L.forEach(i=>{i.allocationType===2?g.value={allocationType:i.allocationType,projectId:i.projectId,groupSupplierIdList:i.groupSupplierIdSet}:i.allocationType===3?r.value={allocationType:i.allocationType,projectId:i.projectId,groupSupplierIdList:i.groupSupplierIdSet}:i.allocationType===4&&(f.value={allocationType:i.allocationType,projectId:i.projectId,groupSupplierIdList:i.groupSupplierIdSet},C.value=i.groupSupplierIdSet)})}else e.value.title="分配",e.value.form.projectId=t.projectId,f.value.projectId=t.projectId,g.value.projectId=t.projectId,r.value.projectId=t.projectId;e.value.tenantSupplierList=await D(F.getTenantSupplierList(t.projectId));const A=await fe.list({name:""});e.value.departmentList=A.data;const u=await D(ce.getAllocationBindList({projectId:t.projectId}));b.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(b.value=e.value.form.groupSupplierIdList),e.value.tenantList=u.data.allocationBindInfoList,j.value=!0}function X(){f.value.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(t=>{f.value.groupSupplierIdList.push(t.beInvitationTenantId)})}function $(){g.value.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(t=>{g.value.groupSupplierIdList.push(t.tenantSupplierId)})}const ee=()=>{r.value.groupSupplierIdList=[],e.value.departmentList.forEach(t=>{K(t)}),h.value.setCheckedKeys(r.value.groupSupplierIdList)};function K(t){r.value.groupSupplierIdList.push(t.id),t.children&&t.children.length&&t.children.forEach(l=>{K(l)})}function le(){r.value.groupSupplierIdList=[],e.value.selectAll.member?(ee(),h.value.setCheckedKeys(r.value.groupSupplierIdList)):(e.value.selectAll.member=!1,r.value.groupSupplierIdList=[],h.value.setCheckedKeys([]))}const te=(t,l)=>{l?b.value.includes(t.id)||b.value.push(t.id):b.value=b.value.filter(L=>L!==t.id);const A=h.value.getCheckedKeys(),u=h.value.getHalfCheckedKeys(),m=[...A,...u];r.value.groupSupplierIdList=m},x=n(!1),R=n(null),ae=(t,l)=>{R.value=l,O(),x.value=!0},O=()=>{Object.assign(f.value,{projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),Object.assign(g.value,{projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),Object.assign(r.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.tenant=!1,e.value.selectAll.supplier=!1,e.value.selectAll.member=!1};function U(){w.value.resetFields(),O(),j.value=!1,x.value=!1,R.value=null}function oe(){w.value.validate(async t=>{if(t)try{V.value=!0;let l={addProjectAllocationInfoList:[]};if(f.value.groupSupplierIdList.length&&(f.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(f.value)),g.value.groupSupplierIdList.length&&(g.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(g.value)),r.value.groupSupplierIdList.length&&(r.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(r.value)),e.value.title!=="分配"&&l.addProjectAllocationInfoList.map(u=>{u.projectId||(u.projectId=e.value.form.projectId),u.groupSupplierIdList.length&&(x.value=!1),u.allocationType===4&&(u.deleteSet=[],C.value&&C.value.length&&C.value.filter(m=>{u.groupSupplierIdList.map(L=>{m!==L&&u.deleteSet.push(m)})}))}),x.value&&(l={addProjectAllocationInfoList:[{projectId:e.value.form.projectId,allocationType:5,groupSupplierIdList:[],deleteSet:[]}]}),!l.addProjectAllocationInfoList.length){Q.warning({message:"至少选择一个分配目标",center:!0});return}const{status:A}=await de(Y.allocation(l));V.value=!1,A===1&&Q.success({message:"分配成功",center:!0}),U(),H("fetch-data")}catch{}finally{V.value=!1}})}const P=t=>{};return Ie(async()=>{}),J({showEdit:Z}),(t,l)=>{const A=v("el-table-column"),u=v("el-table"),m=v("el-checkbox"),L=v("el-option"),i=v("el-select"),T=v("el-form-item"),se=v("el-tree-select"),B=v("el-button"),pe=v("el-form"),re=v("el-dialog"),ie=Ae("loading");return d(),S("div",null,[p(re,{modelValue:a(j),"onUpdate:modelValue":l[10]||(l[10]=o=>Le(j)?j.value=o:null),title:a(e).title,width:"700","before-close":U},{footer:s(()=>[I("div",Ue,[p(B,{onClick:U},{default:s(()=>[c(" 取消 ")]),_:1}),p(B,{type:"primary",onClick:oe},{default:s(()=>[c(" 确定 ")]),_:1})])]),default:s(()=>[Se((d(),E(u,{data:a(e).list,"row-key":"id"},{default:s(()=>[p(A,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),p(A,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),p(A,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[ie,a(V)]]),p(pe,{ref_key:"formRef",ref:w,"label-width":"90px",rules:a(W),model:a(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:s(()=>[p(T,{style:{"margin-top":"1rem"}},{label:s(()=>[je]),default:s(()=>[p(i,{modelValue:a(g).groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=o=>a(g).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[p(m,{modelValue:a(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=o=>a(e).selectAll.supplier=o),onChange:$,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[a(e).tenantSupplierList.length==0?(d(),S("span",{key:0,class:"prefix-class",onClick:l[1]||(l[1]=o=>P("供应商"))},[c(" 请先维护供应商数据 "),ke])):y("",!0),a(g).groupSupplierIdList.length==0?(d(),S("span",Ve,"请先选择供应商数据")):y("",!0)]),default:s(()=>[(d(!0),S(z,null,G(a(e).tenantSupplierList,o=>(d(),E(L,{label:o.supplierAccord,key:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(T,null,{label:s(()=>[Ce]),default:s(()=>[p(se,{ref_key:"treeRef",ref:h,modelValue:a(r).groupSupplierIdList,"onUpdate:modelValue":l[5]||(l[5]=o=>a(r).groupSupplierIdList=o),data:a(e).departmentList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:q,onCheckChange:te,"check-strictly":!0,"check-on-click-node":!0,multiple:!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},{header:s(()=>[p(m,{modelValue:a(e).selectAll.member,"onUpdate:modelValue":l[3]||(l[3]=o=>a(e).selectAll.member=o),onChange:le,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[a(e).departmentList.length==0?(d(),S("span",{key:0,class:"prefix-class",onClick:l[4]||(l[4]=o=>P("调查站"))},[c(" 请先维护调查站数据 "),xe])):y("",!0),a(r).groupSupplierIdList.length?y("",!0):(d(),S("span",Te,"请先选择调查站数据"))]),_:1},8,["modelValue","data"])]),_:1}),p(T,null,{label:s(()=>[Ee]),default:s(()=>[p(i,{modelValue:a(f).groupSupplierIdList,"onUpdate:modelValue":l[8]||(l[8]=o=>a(f).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[p(m,{modelValue:a(e).selectAll.tenant,"onUpdate:modelValue":l[6]||(l[6]=o=>a(e).selectAll.tenant=o),onChange:X,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[a(e).tenantList.length==0?(d(),S("span",{key:0,class:"prefix-class",onClick:l[7]||(l[7]=o=>P("合作商"))},[c(" 请先维护合作商数据 "),we])):y("",!0),a(f).groupSupplierIdList.length==0?(d(),S("span",Re,"请先选择合作商数据")):y("",!0)]),default:s(()=>[(d(!0),S(z,null,G(a(e).tenantList,o=>(d(),E(L,{label:o.beInvitationTenantName,key:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(e).title=="重新分配"?(d(),E(T,{key:0},{label:s(()=>[p(B,{type:a(R)===1?"primary":"",onClick:l[9]||(l[9]=o=>ae("发送",1))},{default:s(()=>[c(" 取消分配 ")]),_:1},8,["type"])]),_:1})):y("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),Me=be(Pe,[["__scopeId","data-v-dea21e8b"]]);export{Me as default};
