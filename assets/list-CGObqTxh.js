
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as I,d as ne,a1 as se,r as d,l as ue,b as r,q as ie,s as re,o as k,e as P,g as e,w as a,S as de,j as me,bj as pe,t as b,h as _,H as ve,E as y,a0 as fe,aB as ce,ap as _e,aI as ge,aJ as ye,R as be}from"./index-BKVONNyH.js";import{a as x,s as Ve}from"./index-B0j_bw4R.js";import{u as we}from"./index-Di1LDWB4.js";import"./index-l7iYoBAp.js";import"./index-nNYdKdKE.js";import"./clipboard-BYMA51a4.js";const he={getTenantLogo:p=>I.post("tenant-logo/getTenantLogo",p),uploadLogo:p=>I.post("tenant-logo/upload",p)},w=p=>(ge("data-v-477b1c90"),p=p(),ye(),p),Ne=w(()=>b("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Le=["src"],xe={key:0},De=w(()=>b("span",{class:"red"},null,-1)),Ee=w(()=>b("span",{style:{"margin-right":"10px"}},"已生效",-1)),Ue=[De,Ee],Ce={key:1},Oe=w(()=>b("span",{class:"green"},null,-1)),ke=w(()=>b("span",{style:{"margin-right":"10px"}},"未生效",-1)),Pe=[Oe,ke],Ae=ne({name:"site_setting",__name:"list",setup(p){const g=se(),A=d(),M="https://saas-api.surveysaas.com/tenant-logo/upload",{toClipboard:S}=we(),R=d("基本设置"),c=d(!1),v=d(),h=d(!1),T=d(),l=d({id:"",registerOffOrOn:!0,registerExamineOffOrOn:!1,keyWords:"",description:"",webName:"",topLevelDomainName:"",defaultPriceRatio:null,taxRate:null,minimumAmount:null,phone:"",email:"",qqCode:"",address:""}),N=d({webName:[{required:!0,message:"请输入网站名称",trigger:"blur"}],topLevelDomainName:[{required:!1,message:"请输入顶级域名",trigger:"submit"},{validator:(n,t,u)=>{new RegExp("^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(?:\\.[A-Za-z0-9-]{1,63}(?<!-))*\\.[A-Za-z]{2,}$").test(t)?u():u(new Error("请输入合法的域名"))},trigger:"submit"}],phone:[{required:!1,trigger:"submit",message:"请输入手机号"},{validator:(n,t,u)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(l.value.phone)?u():u(new Error("请输入合法手机号"))},trigger:"submit"}],email:[{required:!1,trigger:"submit",message:"请输入邮箱"},{validator:(n,t,u)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l.value.email)?u():u(new Error("请输入合法邮箱"))},trigger:"submit"}]});ue(()=>{c.value=!0,g.logo&&(f.value=[{name:"logo",url:g.logo}]),D(),c.value=!1});async function D(){try{const{data:n}=await x.list();if(n&&(l.value=n||l.value,T.value=l.value,g.setWebName(n.webName)),l.value.topLevelDomainName!==""&&l.value.topLevelDomainName!==null){const t=await x.getTenantWebConfigQueryAnalysis({url:l.value.topLevelDomainName});h.value=t.data.success}}catch{}finally{c.value=!1}}const W=async()=>{var t;f.value=[];const n=await he.getTenantLogo();n.data&&(g.setLogo(n.data.logoUrl),f.value.push({name:"file",url:(t=n==null?void 0:n.data)==null?void 0:t.logoUrl}))},$=async n=>{v.value&&v.value.validateField(l.value.topLevelDomainName?"topLevelDomainName":"",async t=>{if(t&&l.value.topLevelDomainName!==""&&l.value.topLevelDomainName!==null){const u=await x.getTenantWebConfigQueryAnalysis({url:l.value.topLevelDomainName});u.data.success===!1?(h.value=u.data.success,y({type:"warning",message:"解析未生效"})):(h.value=u.data.success,y({type:"success",message:"解析已生效"}))}})},B=()=>{A.value.showEdit(T.value)},Z=()=>{const n=l.value.personalizedDomainName;S(n),y({type:"success",message:"复制成功"})},Q=g.token,j=d({Token:Q}),q=d(""),E=d(!1),f=d([]),F=async()=>{y.success({message:"删除成功",center:!0}),g.delLogo()},G=(n,t)=>{n.status===-1?(fe.error(n.error,{zIndex:2e3}),f.value=f.value.filter(u=>u.name!==t.name)):W()},J=async()=>{y.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},H=n=>{q.value=n.url,E.value=!0};function U(){(l.value.email===""||l.value.email===null)&&(N.value.email=[],v.value.clearValidate("email")),(l.value.phone===""||l.value.phone===null)&&(N.value.phone=[],v.value.clearValidate("phone")),(l.value.topLevelDomainName===""||l.value.topLevelDomainName===null)&&(N.value.topLevelDomainName=[],v.value.clearValidate("topLevelDomainName")),v.value&&v.value.validate(async n=>{if(n)try{c.value=!0,l.value.topLevelDomainName&&(l.value.topLevelDomainName=l.value.topLevelDomainName.replace(/^https?:\/\//,""));const t=await x.edit(l.value);c.value=!1,t.status===1&&(D(),y.success({message:"修改成功",center:!0}))}catch(t){console.log("error",t)}finally{c.value=!1}})}return(n,t)=>{const u=ce,L=r("el-icon"),K=r("el-upload"),X=r("el-dialog"),Y=r("ElFormItem"),s=r("el-col"),z=r("el-switch"),i=r("el-form-item"),m=r("el-input"),ee=r("el-text"),V=r("el-button"),C=r("el-row"),O=r("el-tab-pane"),ae=r("el-form"),le=r("el-tabs"),te=_e,oe=ie("loading");return re((k(),P("div",null,[e(u,{title:"站点设置管理"}),e(te,null,{default:a(()=>[e(le,{modelValue:R.value,"onUpdate:modelValue":t[14]||(t[14]=o=>R.value=o)},{default:a(()=>[e(ae,{ref_key:"formRef",ref:v,model:l.value,rules:N.value,"label-width":"100px","label-position":"right",inline:!1},{default:a(()=>[e(O,{label:"基础设置",name:"基本设置"},{default:a(()=>[e(C,{gutter:20},{default:a(()=>[e(s,{span:24},{default:a(()=>[e(Y,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"网址Logo"},{default:a(()=>[e(K,{class:de({hide_box:f.value.length}),"file-list":f.value,"onUpdate:fileList":t[0]||(t[0]=o=>f.value=o),headers:j.value,action:M,"list-type":"picture-card",limit:1,"on-preview":H,"on-remove":F,"on-success":G,"on-exceed":J},{tip:a(()=>[Ne]),default:a(()=>[e(L,{class:"el-icon--upload"},{default:a(()=>[e(me(pe))]),_:1})]),_:1},8,["class","file-list","headers"]),e(X,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=o=>E.value=o),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:a(()=>[b("img",{"w-full":"",src:q.value,alt:"Preview Image"},null,8,Le)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:3},{default:a(()=>[e(i,{label:"注册开关"},{default:a(()=>[e(z,{modelValue:l.value.registerOffOrOn,"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.registerOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:6},{default:a(()=>[e(i,{label:"注册审核"},{default:a(()=>[e(z,{modelValue:l.value.registerExamineOffOrOn,"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.registerExamineOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"网站名称",prop:"webName"},{default:a(()=>[e(m,{modelValue:l.value.webName,"onUpdate:modelValue":t[4]||(t[4]=o=>l.value.webName=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"网站关键字"},{default:a(()=>[e(m,{modelValue:l.value.keyWords,"onUpdate:modelValue":t[5]||(t[5]=o=>l.value.keyWords=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"网站描述"},{default:a(()=>[e(m,{modelValue:l.value.description,"onUpdate:modelValue":t[6]||(t[6]=o=>l.value.description=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"个性化域名",prop:""},{default:a(()=>[e(ee,{class:"mx-1"},{default:a(()=>[_(ve(l.value.personalizedDomainName),1)]),_:1}),e(V,{class:"copy",type:"primary",link:"",onClick:Z},{default:a(()=>[_("复制")]),_:1})]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"顶级域名",prop:"topLevelDomainName"},{default:a(()=>[e(m,{modelValue:l.value.topLevelDomainName,"onUpdate:modelValue":t[7]||(t[7]=o=>l.value.topLevelDomainName=o),style:{width:"18rem"},onMouseleave:$},null,8,["modelValue"]),h.value?(k(),P("div",xe,Ue)):(k(),P("div",Ce,Pe)),e(V,{class:"copy",onClick:B,type:"primary",link:""},{default:a(()=>[_("CNAME配置")]),_:1})]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,null,{default:a(()=>[e(V,{type:"primary",onClick:U},{default:a(()=>[_(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{label:"高级设置",name:"高级设置"},{default:a(()=>[e(C,{gutter:20},{default:a(()=>[e(s,{span:24},{default:a(()=>[e(i,{label:"最低结算金额",prop:""},{default:a(()=>[e(m,{modelValue:l.value.minimumAmount,"onUpdate:modelValue":t[8]||(t[8]=o=>l.value.minimumAmount=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"供应商税点",prop:""},{default:a(()=>[e(m,{modelValue:l.value.taxRate,"onUpdate:modelValue":t[9]||(t[9]=o=>l.value.taxRate=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},{append:a(()=>[_("%")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,null,{default:a(()=>[e(V,{type:"primary",onClick:U},{default:a(()=>[_(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{label:"联系我们",name:"联系我们"},{default:a(()=>[e(C,{gutter:20},{default:a(()=>[e(s,{span:24},{default:a(()=>[e(i,{label:"电子邮箱",prop:"email"},{default:a(()=>[e(m,{style:{width:"18rem"},modelValue:l.value.email,"onUpdate:modelValue":t[10]||(t[10]=o=>l.value.email=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"手机号码",prop:"phone"},{default:a(()=>[e(m,{style:{width:"18rem"},modelValue:l.value.phone,"onUpdate:modelValue":t[11]||(t[11]=o=>l.value.phone=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"QQ号码",prop:""},{default:a(()=>[e(m,{style:{width:"18rem"},modelValue:l.value.qqCode,"onUpdate:modelValue":t[12]||(t[12]=o=>l.value.qqCode=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,{label:"公司地址",prop:""},{default:a(()=>[e(m,{style:{width:"18rem"},modelValue:l.value.address,"onUpdate:modelValue":t[13]||(t[13]=o=>l.value.address=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:a(()=>[e(i,null,{default:a(()=>[e(V,{type:"primary",onClick:U},{default:a(()=>[_("确认")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1}),e(Ve,{ref_key:"recordRef",ref:A,onFetchData:D},null,512)])),[[oe,c.value]])}}}),Be=be(Ae,[["__scopeId","data-v-477b1c90"]]);export{Be as default};
