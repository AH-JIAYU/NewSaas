
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as U}from"./index.vue_vue_type_script_setup_true_lang-Bhgyg-fX.js";import{o as j,s as w}from"./apiLoading-CscGKk70.js";import{a as p}from"./user_supplier-Q0ZnA3fI.js";import{u as z}from"./stagedData-41GiWlbY.js";import{u as M}from"./index.vue_vue_type_script_setup_true_lang-C-8s7tKy.js";import{u as G}from"./user_customer-DYsIPc1k.js";import{d as O,r,a3 as P,a4 as m,G as $,a as h,o as S,b as q,f as c,w as u,g as v,e as F,j as H,i as J,an as T,ak as d}from"./index-B5L6_y5W.js";const te=O({__name:"index",emits:["fetch-data"],setup(K,{expose:y,emit:k}){const f=z(),C=M(),L=G(),D=k,o=r(!1),l=r(""),_=r(),n=r([]),i=r([]);function x(e){i.value.push(e)}P("validateTopTabs",x);let t=m([]);async function V(e){if(!e)l.value="添加",t=f.usersupplier||[T(C.initialTopTabsData)];else{l.value="编辑";const{data:a}=await j(p.detail({tenantSupplierId:e.tenantSupplierId}));E(a)}n.value=[],o.value=!0}function E(e){t.length=0,t.push({...e})}function A(e){const a=new Set;for(const s of e){if(a.has(s.supplierAccord))return!0;a.add(s.supplierAccord)}return!1}function B(){f.usersupplier=T(t),t=m([]),o.value=!1,i.value=[]}function b(){t=m([]),o.value=!1,i.value=[],l.value==="添加"&&(f.usersupplier=null)}async function g(){const e=[];i.value.forEach(s=>{e.push(s.validate())});const a=await Promise.allSettled(e);n.value=a.map(s=>s.status)}async function I(){if(await g(),n.value.every(e=>e==="fulfilled"))if(A(t))d.warning({message:"供应商名称重复",center:!0});else{if(l.value==="添加"){const e={addTenantSupplierInfoList:t};console.log("dataList",e);const{status:a}=await w(p.create(e));a===1&&d.success({message:"新增成功",center:!0})}else{const{status:e}=await w(p.edit(t[0]));e===1&&d.success({message:"修改成功",center:!0})}D("fetch-data"),b()}else _.value.activeLeftTab=n.value.indexOf("rejected"),d.warning({message:"请完善表单",center:!0})}return $(async()=>{await L.getCustomerList()}),y({showEdit:V}),(e,a)=>{const s=h("el-button"),N=h("el-drawer");return S(),q("div",null,[c(N,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=R=>o.value=R),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:""},{footer:u(()=>[c(s,{onClick:b},{default:u(()=>[v(" 取消 ")]),_:1}),l.value==="添加"?(S(),F(s,{key:0,type:"warning",onClick:B},{default:u(()=>[v(" 暂存 ")]),_:1})):H("",!0),c(s,{type:"primary",onClick:I},{default:u(()=>[v(" 确定 ")]),_:1})]),default:u(()=>[c(U,{onValidate:g,ref_key:"LeftTabsRef",ref:_,title:l.value,"left-tabs-data":J(t),"validate-top-tabs":i.value,"validate-all":n.value},null,8,["title","left-tabs-data","validate-top-tabs","validate-all"])]),_:1},8,["modelValue"])])}}});export{te as _};
