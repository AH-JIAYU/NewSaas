
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang-CUoW7ghQ.js";import{d as $e,aA as Me,v as ze,ah as Le,r as i,aD as x,n as Be,aE as I,E as M,$ as ce,aF as De,W as Ke,b as ee,f as l,w as t,y as c,s as H,aG as O,i as a,H as Ze,I as Ge,a as v,aH as We,aI as He,o as w,A as Oe,aJ as je,g as d,z as q,e as R,ay as pe,j,ax as ae,F as Je,t as Qe,aK as Xe,_ as Ye,L as ea,am as ge}from"./index-C6oMP_bv.js";import aa from"./agreement-BzSEip96.js";import la from"./index-CQNCO2sM.js";import{a as V}from"./register-Cy49sIqs.js";const z=L=>(We("data-v-a3d3cb8b"),L=L(),He(),L),ta=z(()=>c("div",{class:"bg-banner"},null,-1)),oa={id:"login-box"},ra=z(()=>c("div",{class:"login-banner"},null,-1)),na={class:"title-container"},sa={class:"fx-c"},ia={class:"flex-bar",style:{width:"100%",margin:"0"}},ua={class:"flex-bar"},da={key:0,class:"sub-link"},ma=z(()=>c("span",{class:"text"},"还不是会员?",-1)),ca={class:"sub-link"},pa=z(()=>c("span",{class:"text"},"已经有帐号?",-1)),ga=z(()=>c("div",{class:"title-container"},[c("h3",{class:"title"},"忘记密码了? 🔒")],-1)),fa={class:"sub-link"},fe=$e({name:"Login",__name:"login",setup(L){var ue;const J=Ze(),ve=Ge(),B=Me(),ye=ze(),{t:b}=Le();new URL("/assets/login-banner-ZfMZACb6.png",import.meta.url).href,new URL("/assets/logo-CLz_KCqM.png",import.meta.url).href;const le=i(),te=i(),y=i("login"),C=i(!1),be=i(((ue=J.query.redirect)==null?void 0:ue.toString())??ye.settings.home.fullPath),F=i(),_=i("password"),P=i("获取验证码"),D=i(!1),u=i({account:x.local.get("login_account")||"",remember:x.local.has("login_account"),agreeToTheAgreement:!1}),_e=(o,e,n)=>{/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(e)?n():n(new Error("请输入合法手机号"))},we=(o,e,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(u.value.account)?n():n(new Error("请输入合法邮箱"))},k=i({account:[{required:!0,trigger:"blur",message:"请输入手机号/邮箱/用户名"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],agreeToTheAgreement:[{required:!0,validator:(o,e)=>e===!0,message:"请阅读并勾选协议",trigger:"change"}]}),Q=o=>{const e=/(\D+)(\d+)\.(\S+)/,n=o.match(e);return n?n[2]:""};Be(async()=>{const{data:o}=await V.getTenantConfig();te.value=(o==null?void 0:o.register)!==!1,J.query.isRegister&&J.query.isRegister==="true"&&(y.value="register");const e=await V.getTenantPageTemplate({});le.value=e.data.isDomain,e.data.isDomain===1&&(B.webName=e.data.webName,B.description=e.data.description,B.keyWords=e.data.keyWords)});const oe=()=>{const o=u.value.account;o.includes("@")?k.value.account=[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:we,trigger:"blur"}]:/^\d{11}$/.test(o)?k.value.account=[{required:!0,trigger:"blur",message:"请输入手机号"},{validator:_e,trigger:"blur"}]:o.trim()!==""?k.value.account=[{required:!0,trigger:"blur",message:"请输入用户名"}]:k.value.account=[]},he=I(async o=>{const{status:e}=await V.sendCode(o);e===1&&(M.success({message:"已发送"}),Ve())},1e3);async function xe(){F.value.validateField("account",async o=>{if(o){let e;u.value.account.includes("@")?e={email:u.value.account,type:"login_email"}:e={phone:u.value.account,type:"login_phone_number"},P.value="正在发送验证码",await he(e)}})}const Ve=()=>{D.value=!0;let o=60;p.value=setInterval(()=>{o>0?(o--,P.value=`请在${o}s后重新获取`):(clearInterval(p.value),P.value="获取验证码",p.value=null,D.value=!1)},1e3)},X=I(()=>{F.value&&F.value.validate(o=>{if(o){let e={...u.value};_.value==="password"?e.type=1:u.value.account.includes("@")?e.type=3:e.type=2;const n=window.location.href;console.log(n,Q(n)),Q(n)&&(e.tenantId=Q(n)),C.value=!0,B.login(e).then(()=>{C.value=!1,u.value.remember?x.local.set("login_account",u.value.account):x.local.remove("login_account"),ve.push(be.value)}).catch(()=>{C.value=!1})}})},500),p=i(null),E=i("获取验证码"),K=i(!1),T=i(),re=i([]),s=i({name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",agreeToTheAgreement:!1,companyType:"company",companyName:"",legalPersonName:"",taxID:""}),Ce=i({account:[{required:!0,trigger:"blur",message:"请输入用户名"}],companyName:[{required:!0,trigger:"blur",message:"请输入公司名称"}],companyType:[{required:!0,trigger:"change",message:"请选择账户类型"}],legalPersonName:[{required:!0,trigger:"blur",message:"请输入法人姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(o,e,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(s.value.email)?n():n(new Error("请输入合法邮箱"))},trigger:"blur"}],phoneNumber:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(o,e,n)=>{/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(s.value.phoneNumber)?n():n(new Error("请输入合法手机号"))},trigger:"blur"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],country:[{required:!0,trigger:"change",message:"请选择区域"}],name:[{required:!0,trigger:"blur",message:"请输入用户名"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],isInvitation:[{required:!0,trigger:"blur",message:"请选择合作邀约"}],agreeToTheAgreement:[{required:!0,validator:(o,e)=>e===!0,message:"请阅读并勾选协议",trigger:"change"}]}),ne=I(async o=>{const{status:e}=await V.sendCode(o);e===1&&(M.success({message:"已发送"}),Ee())},1e3),ke=async()=>{const o=await T.value.validateField("country");T.value.validateField(s.value.country==="CN"?"phoneNumber":"email",async e=>{if(e&&o){const n={type:"register_phone_number",email:s.value.email,phone:s.value.phoneNumber,countryCode:s.value.country};s.value.country==="CN"?(E.value="正在发送验证码",await ne(n)):(n.type="register_email",E.value="正在发送验证码",await ne(n))}})},Ee=()=>{K.value=!0;let o=60;p.value=setInterval(()=>{o>0?(o--,E.value=`请在${o}s后重新获取`):(clearInterval(p.value),E.value="获取验证码",p.value=null,K.value=!1)},1e3)},Te=I(async()=>{T.value&&T.value.validate(async o=>{if(o){s.value.type=s.value.country==="CN"?"phone":"email",s.value.type==="phone"?delete s.value.email:delete s.value.phoneNumber,delete s.value.agreeToTheAgreement;const{status:e}=await V.register(s.value);e===1&&(M.success({message:"注册成功"}),y.value="login",_.value="password"),ce(()=>{u.value.account=s.value.email||s.value.phoneNumber})}})},500),h=i(null),A=i(),U=i("获取验证码"),Z=i(!1),g=i({info:x.local.get("login_account"),code:"",newPassword:""}),Ne=i({info:[{required:!0,trigger:"blur",message:"请输入用户名"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],newPassword:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(o,e,n)=>{/[\s\u4e00-\u9fa5]/.test(e)?n(new Error("密码中带有空格或汉字")):n()},trigger:"blur"}]}),Ie=I(()=>{A.value.validateField(g.value.info?"":"info",async o=>{if(o){U.value="正在发送验证码";const{status:e}=await V.forgetCode({info:g.value.info});e===1&&(M.success({message:"已发送"}),Re())}})},1e3),qe=I(()=>{A.value&&A.value.validate(async o=>{if(o){const{status:e}=await V.updatePassword(g.value);e===1&&(M.success({message:"修改成功"}),y.value="login",ce(()=>{u.value.account=g.value.info}))}})},500),Re=()=>{Z.value=!0;let o=60;h.value=setInterval(()=>{o>0?(o--,U.value=`请在${o}s后重新获取`):(clearInterval(h.value),U.value="获取验证码",h.value=null,Z.value=!1)},1e3)};De(()=>{clearInterval(p.value),p.value=null,clearInterval(h.value),h.value=null});const se=()=>{k.value.account=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱/用户名"}],u.value.code="",F.value.resetFields()};Ke(()=>y.value,async o=>{switch(o){case"login":se(),clearInterval(p.value),P.value="获取验证码",p.value=null,D.value=!1,u.value={account:x.local.get("login_account")||"",remember:x.local.has("login_account"),agreeToTheAgreement:!1};break;case"register":T.value.resetFields(),clearInterval(p.value),E.value="获取验证码",p.value=null,K.value=!1,s.value.agreeToTheAgreement=!1,s.value={name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",agreeToTheAgreement:!1};break;case"reset":A.value.resetFields(),clearInterval(h.value),U.value="获取验证码",h.value=null,Z.value=!1,g.value={info:"",newPassword:"",code:""};break}if(o==="register"){const e=await Xe.itemlist({page:1,limit:-1,id:"32"});re.value=e.data.records}});const ie=i(),G=o=>{ie.value.showEdit(o)};return(o,e)=>{const n=Ye,N=Se,de=v("el-radio-button"),Fe=v("el-radio-group"),S=v("el-button"),f=v("ElInput"),m=v("ElFormItem"),Y=v("ElCheckbox"),W=v("ElLink"),$=v("ElButton"),Pe=v("el-form"),Ae=v("ElOption"),Ue=v("ElSelect"),me=v("ElForm");return w(),ee("div",null,[ta,l(N,{placement:"bottom-end",class:"i18n-selector"},{default:t(()=>[l(n,{name:"i-ri:translate"})]),_:1}),c("div",oa,[ra,H(l(Pe,{ref_key:"loginFormRef",ref:F,model:a(u),rules:a(k),class:"login-form","validate-on-rule-change":!1},{default:t(()=>[c("div",na,[c("div",sa,[l(Fe,{modelValue:a(_),"onUpdate:modelValue":e[0]||(e[0]=r=>Oe(_)?_.value=r:null),size:"large",onChange:se},{default:t(()=>[l(de,{label:"密码登录",value:"password"}),l(de,{label:"验证码登录",value:"code"})]),_:1},8,["modelValue"])])]),c("div",null,[l(m,{prop:"account"},{default:t(()=>[l(f,{modelValue:a(u).account,"onUpdate:modelValue":e[1]||(e[1]=r=>a(u).account=r),modelModifiers:{trim:!0},placeholder:a(b)("app.account"),type:"text",tabindex:"1",onBlur:oe},je({prefix:t(()=>[l(n,{name:"i-ri:user-3-fill"})]),_:2},[a(_)==="code"?{name:"append",fn:t(()=>[l(S,{type:"primary",disabled:a(D),onClick:xe},{default:t(()=>[d(q(a(P)),1)]),_:1},8,["disabled"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),a(_)==="password"?(w(),R(m,{key:0,prop:"password"},{default:t(()=>[l(f,{modelValue:a(u).password,"onUpdate:modelValue":e[2]||(e[2]=r=>a(u).password=r),modelModifiers:{trim:!0},type:"password",placeholder:a(b)("app.password"),tabindex:"2",autocomplete:"new-password","show-password":"",onKeyup:pe(a(X),["enter"])},{prefix:t(()=>[l(n,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):j("",!0),a(_)==="code"?(w(),R(m,{key:1,prop:"code"},{default:t(()=>[l(f,{modelValue:a(u).code,"onUpdate:modelValue":e[3]||(e[3]=r=>a(u).code=r),modelModifiers:{trim:!0},type:"text",placeholder:a(b)("app.captcha"),tabindex:"2",onKeyup:pe(a(X),["enter"])},{prefix:t(()=>[l(n,{name:"i-ep:message"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):j("",!0),l(m,{prop:"agreeToTheAgreement",style:{"margin-bottom":"0.5rem"}},{default:t(()=>[c("div",ia,[l(Y,{modelValue:a(u).agreeToTheAgreement,"onUpdate:modelValue":e[6]||(e[6]=r=>a(u).agreeToTheAgreement=r),tabindex:"3"},{default:t(()=>[d(" 我已阅读并同意 "),l(S,{type:"primary",size:"default",link:"",onClick:e[4]||(e[4]=r=>G(1))},{default:t(()=>[d("《会员协议》")]),_:1}),d("和"),l(S,{type:"primary",size:"default",link:"",onClick:e[5]||(e[5]=r=>G(2))},{default:t(()=>[d("《服务协议》")]),_:1})]),_:1},8,["modelValue"])])]),_:1}),l(m,null,{default:t(()=>[c("div",ua,[l(Y,{modelValue:a(u).remember,"onUpdate:modelValue":e[7]||(e[7]=r=>a(u).remember=r),tabindex:"4"},{default:t(()=>[d(" 保持登录 ")]),_:1},8,["modelValue"]),a(_)==="password"?(w(),R(W,{key:0,type:"primary",underline:!1,onClick:e[8]||(e[8]=r=>y.value="reset")},{default:t(()=>[d(" 忘记密码了? ")]),_:1})):j("",!0)])]),_:1})]),l($,{loading:a(C),type:"primary",size:"large",style:{width:"100%"},onClick:ae(a(X),["prevent"]),tabindex:"5"},{default:t(()=>[d(q(a(b)("app.login")),1)]),_:1},8,["loading","onClick"]),a(le)!==1?H((w(),ee("div",da,[ma,l(W,{type:"primary",underline:!1,onClick:e[9]||(e[9]=r=>y.value="register")},{default:t(()=>[d(" 立即注册 ")]),_:1})],512)),[[O,a(te)]]):j("",!0)]),_:1},8,["model","rules"]),[[O,a(y)==="login"]]),H(l(me,{ref_key:"registerFormRef",ref:T,model:a(s),rules:a(Ce),class:"login-form","auto-complete":"on"},{default:t(()=>[c("div",null,[l(m,{prop:"companyName"},{default:t(()=>[l(f,{modelValue:a(s).companyName,"onUpdate:modelValue":e[10]||(e[10]=r=>a(s).companyName=r),modelModifiers:{trim:!0},placeholder:"请输入公司名称",tabindex:"1"},{prefix:t(()=>[l(n,{name:"i-mdi:greenhouse"})]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"name"},{default:t(()=>[l(f,{modelValue:a(s).name,"onUpdate:modelValue":e[11]||(e[11]=r=>a(s).name=r),modelModifiers:{trim:!0},placeholder:"用户名",tabindex:"2"},{prefix:t(()=>[l(n,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"country"},{default:t(()=>[l(Ue,{modelValue:a(s).country,"onUpdate:modelValue":e[12]||(e[12]=r=>a(s).country=r),placeholder:"区域",clearable:"",filterable:"",tabindex:"3"},{prefix:t(()=>[l(n,{name:"i-mdi:format-list-bulleted-type"})]),default:t(()=>[(w(!0),ee(Je,null,Qe(a(re),r=>(w(),R(Ae,{label:r.chineseName,value:r.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(s).country==="CN"?(w(),R(m,{key:0,prop:"phoneNumber"},{default:t(()=>[l(f,{modelValue:a(s).phoneNumber,"onUpdate:modelValue":e[13]||(e[13]=r=>a(s).phoneNumber=r),modelModifiers:{trim:!0},placeholder:"手机号",tabindex:"4"},{prefix:t(()=>[l(n,{name:"i-ant-design:phone-outlined"})]),_:1},8,["modelValue"])]),_:1})):(w(),R(m,{key:1,prop:"email"},{default:t(()=>[l(f,{modelValue:a(s).email,"onUpdate:modelValue":e[14]||(e[14]=r=>a(s).email=r),modelModifiers:{trim:!0},placeholder:"邮箱",tabindex:"4"},{prefix:t(()=>[l(n,{name:"i-mdi:email"})]),_:1},8,["modelValue"])]),_:1})),l(m,{prop:"code"},{default:t(()=>[l(f,{modelValue:a(s).code,"onUpdate:modelValue":e[15]||(e[15]=r=>a(s).code=r),modelModifiers:{trim:!0},placeholder:"验证码",tabindex:"5"},{prefix:t(()=>[l(n,{name:"i-ic:baseline-verified-user"})]),append:t(()=>[l($,{disabled:a(K),onClick:ke},{default:t(()=>[d(q(a(E)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"password"},{default:t(()=>[l(f,{modelValue:a(s).password,"onUpdate:modelValue":e[16]||(e[16]=r=>a(s).password=r),modelModifiers:{trim:!0},type:"password",placeholder:"密码",tabindex:"6","show-password":""},{prefix:t(()=>[l(n,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"agreeToTheAgreement"},{default:t(()=>[l(Y,{modelValue:a(s).agreeToTheAgreement,"onUpdate:modelValue":e[19]||(e[19]=r=>a(s).agreeToTheAgreement=r),tabindex:"8"},{default:t(()=>[d(" 我已阅读并同意 "),l(S,{type:"primary",size:"default",link:"",onClick:e[17]||(e[17]=r=>G(1))},{default:t(()=>[d("《会员协议》")]),_:1}),d("和"),l(S,{type:"primary",size:"default",link:"",onClick:e[18]||(e[18]=r=>G(2))},{default:t(()=>[d("《服务协议》")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l($,{tabindex:"9",loading:a(C),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:ae(a(Te),["prevent"])},{default:t(()=>[d(" 注册 ")]),_:1},8,["loading","onClick"]),c("div",ca,[pa,l(W,{type:"primary",underline:!1,onClick:e[20]||(e[20]=r=>y.value="login")},{default:t(()=>[d(" 去登录 ")]),_:1})])]),_:1},8,["model","rules"]),[[O,a(y)==="register"]]),H(l(me,{ref_key:"resetFormRef",ref:A,model:a(g),rules:a(Ne),class:"login-form"},{default:t(()=>[ga,c("div",null,[l(m,{prop:"info"},{default:t(()=>[l(f,{modelValue:a(g).info,"onUpdate:modelValue":e[21]||(e[21]=r=>a(g).info=r),modelModifiers:{trim:!0},placeholder:a(b)("app.account"),type:"text",tabindex:"1",onBlur:oe},{prefix:t(()=>[l(n,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(m,{prop:"code"},{default:t(()=>[l(f,{modelValue:a(g).code,"onUpdate:modelValue":e[22]||(e[22]=r=>a(g).code=r),modelModifiers:{trim:!0},placeholder:a(b)("app.captcha"),type:"text",tabindex:"2"},{prefix:t(()=>[l(n,{name:"i-ic:baseline-verified-user"})]),append:t(()=>[l($,{disabled:a(Z),onClick:a(Ie)},{default:t(()=>[d(q(a(U)),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue","placeholder"])]),_:1}),l(m,{prop:"newPassword"},{default:t(()=>[l(f,{modelValue:a(g).newPassword,"onUpdate:modelValue":e[23]||(e[23]=r=>a(g).newPassword=r),modelModifiers:{trim:!0},type:"password",placeholder:a(b)("app.newPassword"),tabindex:"3","show-password":""},{prefix:t(()=>[l(n,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1})]),l($,{loading:a(C),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:ae(a(qe),["prevent"])},{default:t(()=>[d(q(a(b)("app.check")),1)]),_:1},8,["loading","onClick"]),c("div",fa,[l(W,{type:"primary",underline:!1,onClick:e[24]||(e[24]=r=>y.value="login")},{default:t(()=>[d(q(a(b)("app.goLogin")),1)]),_:1})])]),_:1},8,["model","rules"]),[[O,a(y)==="reset"]])]),l(la),l(aa,{ref_key:"agreementRef",ref:ie},null,512)])}}});typeof ge=="function"&&ge(fe);const Ca=ea(fe,[["__scopeId","data-v-a3d3cb8b"]]);export{Ca as default};
