
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ye,l as _e,I as ve,aN as he,v as be,r as w,c as Ce,n as Pe,x as z,B as we,a as s,q as Ie,o as m,b as x,f as l,w as r,i as a,g as p,s as Se,e as g,aM as Le,z as E,F as j,j as B,N as xe,E as b,aO as U,an as Me,L as ke}from"./index-B6wfMZ3d.js";import{_ as Ve}from"./index-2OLGrO5H.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-BiP8OhcF.js";import{s as C}from"./apiLoading-C3foY2u9.js";import{G as y}from"./otherFunctions_screenLibrary-D_v6JQlm.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-BGEwWqKW.js";import{u as $e}from"./index-oG8RF41X.js";import{u as ze}from"./stagedData-C3qiv-kk.js";import{u as Ee}from"./useTabbar-BKShPd0W.js";import"./index.vue_vue_type_script_setup_true_lang-yTw1CAiK.js";import"./sortable.esm-C0-Qcoum.js";/* empty css                      */const je=ye({name:"screen_library",__name:"list",setup(Be){const T=_e(),F=$e(),P=ze(),O=ve(),{pagination:d,getParams:R,onSizeChange:A,onCurrentChange:q,onSortChange:G}=he(),H=Ee(),M=be(),k=w(),J=w("formSearch-screen_library"),e=w({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),V=w();function u(){try{e.value.loading=!0;const t={...R(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};y.list(t).then(o=>{o.data&&o.status===1&&(e.value.dataList=o.data.getCountryListInfoList,d.value.total=o.data.getCountryListInfoList.length),e.value.loading=!1})}catch{}finally{e.value.loading=!1}}const N=Ce(()=>e.value.dataList.slice((d.value.page-1)*d.value.size,d.value.page*d.value.size));function K(t){A(t).then(()=>u())}function D(t=1){q(t).then(()=>u())}function $({prop:t,order:o}){G(t,o).then(()=>u())}function Q(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function W(t){t.getProjectProblemCategoryInfoList.unshift({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add"})}function X(t,o,_){V.value.validateField(`[${o}].getProjectProblemCategoryInfoList[${_}].categoryName`,async v=>{if(v){const{data:f,status:I}=await C(y.create(t));I===1&&b.success({message:"新增成功",center:!0}),await u()}})}function Y(t,o){const _=e.value.dataList.findIndex(v=>v.countryId===t.countryId);e.value.dataList[_].getProjectProblemCategoryInfoList.splice(o,1)}async function Z(t){const{status:o}=await C(y.update(t));o===1&&b.success({message:"修改「默认区域」成功",center:!0}),u(),P.projectManagementList=null}async function ee(t){const{status:o}=await C(y.edit(t));o===1&&b.success({message:"修改「状态」成功",center:!0}),u(),P.projectManagementList=null}function te(t){F.countryId=t.countryId,e.value.formMode==="router"?M.settings.tabbar.enable&&M.settings.tabbar.mergeTabsBy!=="activeMenu"?H.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):O.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function ae(t){U.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:o}=await C(y.delete({countryId:t.countryId}));o===1&&b.success({message:"删除成功",center:!0}),u()}).catch(()=>{}),P.projectManagementList=null}function oe(t){U.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:o}=await C(y.delete({projectProblemCategoryId:t.projectProblemCategoryId}));o===1&&b.success({message:"删除成功",center:!0}),u()}).catch(()=>{}),P.projectManagementList=null}function ne(){Object.assign(e.value.search,{countryId:""}),u()}return Pe(async()=>{u(),e.value.countryList=await T.getCountry(),e.value.formMode==="router"&&z.on("get-data-list",()=>{u()}),k.value=[{index:1,show:!0,type:"select",modelName:"countryId",placeholder:"区域",option:"global",optionLabel:"chineseName",optionValue:"id"}]}),we(()=>{e.value.formMode==="router"&&z.off("get-data-list")}),(t,o)=>{const _=Ve,v=s("ElDivider"),f=s("ElButton"),I=s("ElSpace"),S=s("el-table-column"),L=s("ElSwitch"),h=s("ElTableColumn"),le=s("el-input"),re=s("el-form-item"),ie=s("el-text"),se=s("el-table"),ue=s("el-tag"),de=s("el-empty"),ce=s("ElTable"),me=s("el-form"),pe=s("ElPagination"),fe=Me,ge=Ie("loading");return m(),x("div",{class:xe({"absolute-container":a(e).tableAutoHeight})},[l(fe,null,{default:r(()=>[l(_,{formSearchList:a(k),formSearchName:a(J),onCurrentChange:D,onOnReset:ne,model:a(e).search},null,8,["formSearchList","formSearchName","model"]),l(v,{"border-style":"dashed"}),l(I,{wrap:""},{default:r(()=>[l(f,{type:"primary",size:"default",onClick:Q},{default:r(()=>[p(" 新增前置问卷库 ")]),_:1})]),_:1}),l(me,{ref_key:"formRef",ref:V,rules:a(e).rules,model:a(N)},{default:r(()=>[Se((m(),g(ce,{class:"my-4",data:a(N),"highlight-current-row":"",height:"100%",onSortChange:$,onSelectionChange:o[1]||(o[1]=i=>a(e).batch.selectionDataList=i),"default-expand-all":!0},{empty:r(()=>[l(de,{image:a(Le),"image-size":300},null,8,["image"])]),default:r(()=>[l(S,{type:"expand",width:"55"},{default:r(i=>[l(se,{data:i.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",height:"100%",onSortChange:$,onSelectionChange:o[0]||(o[0]=n=>a(e).batch.selectionDataList=n)},{default:r(()=>[l(S,{width:"55"}),l(h,{prop:"status",label:"状态",align:"left"},{default:r(n=>[n.row.type==="add"?(m(),g(L,{key:0,modelValue:n.row.status,"onUpdate:modelValue":c=>n.row.status=c,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])):(m(),g(L,{key:1,onChange:c=>ee(n.row),modelValue:n.row.status,"onUpdate:modelValue":c=>n.row.status=c,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),l(S,{width:"500",prop:"categoryName",label:"问卷名称",align:"left"},{default:r(n=>[n.row.type==="add"?(m(),g(re,{key:0,prop:`[${i.$index}].getProjectProblemCategoryInfoList[${n.$index}].categoryName`,rules:a(e).rules.categoryName},{default:r(()=>[l(le,{modelValue:n.row.categoryName,"onUpdate:modelValue":c=>n.row.categoryName=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(m(),g(ie,{key:1,class:"fontC-System"},{default:r(()=>[p(E(n.row.categoryName),1)]),_:2},1024))]),_:2},1024),l(h,{width:"250",align:"left",fixed:"right",label:"操作"},{default:r(n=>[n.row.type==="add"?(m(),x(j,{key:0},[l(f,{type:"primary",size:"small",plain:"",onClick:c=>X(n.row,i.$index,n.$index)},{default:r(()=>[p(" 提交 ")]),_:2},1032,["onClick"]),l(f,{type:"danger",size:"small",plain:"",onClick:c=>Y(n.row,n.$index)},{default:r(()=>[p(" 取消 ")]),_:2},1032,["onClick"])],64)):(m(),x(j,{key:1},[l(f,{type:"warning",size:"small",plain:"",onClick:c=>te(n.row)},{default:r(()=>[p(" 设计问卷 ")]),_:2},1032,["onClick"]),l(f,{type:"danger",size:"small",plain:"",onClick:c=>oe(n.row)},{default:r(()=>[p(" 删除 ")]),_:2},1032,["onClick"])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),l(h,{prop:"isDefault",label:"默认/状态",align:"left"},{default:r(i=>[l(L,{onChange:n=>Z(i.row),modelValue:i.row.isDefault,"onUpdate:modelValue":n=>i.row.isDefault=n,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),l(h,{prop:"countryName",label:"区域/标题",width:"500",align:"left"},{default:r(({row:i})=>[l(ue,{type:"primary"},{default:r(()=>[p(E(i.countryName),1)]),_:2},1024)]),_:1}),l(h,{label:"操作",width:"250",align:"left",fixed:"right"},{default:r(i=>[l(f,{type:"primary",size:"small",plain:"",onClick:n=>W(i.row)},{default:r(()=>[p(" 新增问卷 ")]),_:2},1032,["onClick"]),l(f,{type:"danger",size:"small",plain:"",onClick:n=>ae(i.row)},{default:r(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,a(e).loading]])]),_:1},8,["rules","model"]),l(pe,{"current-page":a(d).page,total:a(d).total,"page-size":a(d).size,"page-sizes":a(d).sizes,layout:a(d).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:K,onCurrentChange:D},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),a(e).editProps.visible?(m(),g(De,{key:0,id:a(e).editProps.id,countryId:a(e).editProps.countryId,modelValue:a(e).editProps.visible,"onUpdate:modelValue":o[2]||(o[2]=i=>a(e).editProps.visible=i),row:a(e).editProps.row,onSuccess:u},null,8,["id","countryId","modelValue","row"])):B("",!0),a(e).formMode==="dialog"||a(e).formMode==="drawer"?(m(),g(Ne,{key:1,id:a(e).formModeProps.id,modelValue:a(e).formModeProps.visible,"onUpdate:modelValue":o[3]||(o[3]=i=>a(e).formModeProps.visible=i),mode:a(e).formMode,details:a(e).formModeProps.details,title:a(e).formModeProps.title,onSuccess:u},null,8,["id","modelValue","mode","details","title"])):B("",!0)],2)}}}),We=ke(je,[["__scopeId","data-v-2f3ae185"]]);export{We as default};
