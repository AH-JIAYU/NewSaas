
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ge,M as ye,aM as _e,q as ve,r as x,D as be,E as N,H as he,c as Ce,a as u,al as we,o as c,b as C,f as o,w as r,i as n,aA as Pe,a3 as S,a4 as Ie,e as g,g as p,G as j,am as Le,j as U,P as Se,ak as w,aN as B,L as ke,p as Me,_ as Ve}from"./index-C5gylVSa.js";import{_ as Ee}from"./index.vue_vue_type_script_setup_true_lang-J3kA3idt.js";import{_ as $e}from"./index.vue_vue_type_script_setup_true_lang-DTLAQ1Jy.js";import{s as P}from"./apiLoading-B23SXnXZ.js";import{a as y}from"./otherFunctions_screenLibrary-DTZd4fhX.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-DmNVG1ku.js";import{u as ze}from"./otherFunctions_basicDictionary-D3tLxLQ-.js";import{u as xe}from"./index-B7_OTXxO.js";import{u as Ne}from"./stagedData-C1CJIQky.js";import{u as je}from"./useTabbar-B-0gWBWX.js";import"./basicDictionary-Dc01cZ3t.js";/* empty css                      */const Ue=ge({name:"OtherFunctionsScreenLibraryList",__name:"list",setup(Be){const F=ze(),T=xe(),I=Ne(),O=ye(),{pagination:m,getParams:A,onSizeChange:H,onCurrentChange:R,onSortChange:q}=_e(),K=je(),E=ve(),e=x({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),$=x();be(async()=>{d(),e.value.countryList=await F.getCountry(),e.value.formMode==="router"&&N.on("get-data-list",()=>{d()})}),he(()=>{e.value.formMode==="router"&&N.off("get-data-list")});function d(){e.value.loading=!0;const t={...A(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};y.list(t).then(a=>{e.value.loading=!1,e.value.dataList=a.data.getCountryListInfoList,m.value.total=a.data.getCountryListInfoList.length})}const D=Ce(()=>e.value.dataList.slice((m.value.page-1)*m.value.size,m.value.page*m.value.size));function G(t){H(t).then(()=>d())}function L(t=1){R(t).then(()=>d())}function z({prop:t,order:a}){q(t,a).then(()=>d())}function J(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function Q(t){t.getProjectProblemCategoryInfoList.push({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add"})}function W(t,a,_){$.value.validateField(`[${a}].getProjectProblemCategoryInfoList[${_}].categoryName`,async v=>{if(v){const{data:k,status:b}=await P(y.create(t));b===1&&w.success({message:"新增成功",center:!0}),await d()}})}function X(t,a){const _=e.value.dataList.findIndex(v=>v.countryId===t.countryId);e.value.dataList[_].getProjectProblemCategoryInfoList.splice(a,1)}async function Y(t){const{status:a}=await P(y.update(t));a===1&&w.success({message:"修改「默认国家」成功",center:!0}),d(),I.projectManagementList=null}async function Z(t){const{status:a}=await P(y.edit(t));a===1&&w.success({message:"修改「状态」成功",center:!0}),d(),I.projectManagementList=null}function ee(t){T.countryId=t.countryId,e.value.formMode==="router"?E.settings.tabbar.enable&&E.settings.tabbar.mergeTabsBy!=="activeMenu"?K.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):O.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function te(t){B.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:a}=await P(y.delete({countryId:t.countryId}));a===1&&w.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),I.projectManagementList=null}function ae(t){B.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:a}=await P(y.delete({projectProblemCategoryId:t.projectProblemCategoryId}));a===1&&w.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),I.projectManagementList=null}return(t,a)=>{const _=u("ElOption"),v=u("el-select"),k=u("ElFormItem"),b=ke,f=u("ElButton"),oe=u("ElForm"),ne=Ee,le=u("ElDivider"),re=u("ElSpace"),M=u("el-table-column"),se=u("el-input"),ie=u("el-form-item"),V=u("ElSwitch"),h=u("ElTableColumn"),ue=u("el-table"),de=u("ElTable"),ce=u("el-form"),me=u("ElPagination"),pe=Me,fe=we("loading");return c(),C("div",{class:Se({"absolute-container":n(e).tableAutoHeight})},[o(pe,null,{default:r(()=>[o(ne,{"show-toggle":!1},{default:r(({fold:s,toggle:l})=>[o(oe,{model:n(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:r(()=>[o(k,{label:"国家"},{default:r(()=>[o(v,{onKeydown:a[0]||(a[0]=Pe(i=>L(),["enter"])),onClear:a[1]||(a[1]=i=>L()),filterable:"",modelValue:n(e).search.countryId,"onUpdate:modelValue":a[2]||(a[2]=i=>n(e).search.countryId=i),placeholder:"Select"},{default:r(()=>[(c(!0),C(S,null,Ie(n(e).countryList,i=>(c(),g(_,{label:i.chineseName,value:i.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(k,null,{default:r(()=>[o(f,{type:"primary",onClick:a[3]||(a[3]=i=>L())},{icon:r(()=>[o(b,{name:"i-ep:search"})]),default:r(()=>[p(" 筛选 ")]),_:1}),o(f,{link:"",disabled:"",onClick:l},{icon:r(()=>[o(b,{name:s?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:r(()=>[p(" "+j(s?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),o(le,{"border-style":"dashed"}),o(re,{wrap:""},{default:r(()=>[o(f,{type:"primary",size:"default",onClick:J},{icon:r(()=>[o(b,{name:"i-ep:plus"})]),default:r(()=>[p(" 新增前置问卷库 ")]),_:1})]),_:1}),o(ce,{ref_key:"formRef",ref:$,rules:n(e).rules,model:n(D)},{default:r(()=>[Le((c(),g(de,{class:"my-4",border:"",data:n(D),"highlight-current-row":"",height:"100%",onSortChange:z,onSelectionChange:a[5]||(a[5]=s=>n(e).batch.selectionDataList=s),"default-expand-all":!0},{default:r(()=>[o(M,{type:"expand",width:"55"},{default:r(s=>[o(ue,{data:s.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",border:"",height:"100%",onSortChange:z,onSelectionChange:a[4]||(a[4]=l=>n(e).batch.selectionDataList=l)},{default:r(()=>[o(M,{width:"55"}),o(M,{width:"500",prop:"categoryName",label:"问卷名称",align:"center"},{default:r(l=>[l.row.type==="add"?(c(),g(ie,{key:0,prop:`[${s.$index}].getProjectProblemCategoryInfoList[${l.$index}].categoryName`,rules:n(e).rules.categoryName},{default:r(()=>[o(se,{modelValue:l.row.categoryName,"onUpdate:modelValue":i=>l.row.categoryName=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(c(),C(S,{key:1},[p(j(l.row.categoryName),1)],64))]),_:2},1024),o(h,{prop:"status",label:"状态"},{default:r(l=>[l.row.type==="add"?(c(),g(V,{key:0,modelValue:l.row.status,"onUpdate:modelValue":i=>l.row.status=i,"active-value":1,"inactive-value":2},null,8,["modelValue","onUpdate:modelValue"])):(c(),g(V,{key:1,onChange:i=>Z(l.row),modelValue:l.row.status,"onUpdate:modelValue":i=>l.row.status=i,"active-value":1,"inactive-value":2},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),o(h,{width:"250",align:"center",fixed:"right",label:"操作"},{default:r(l=>[l.row.type==="add"?(c(),C(S,{key:0},[o(f,{type:"primary",size:"small",plain:"",onClick:i=>W(l.row,s.$index,l.$index)},{default:r(()=>[p(" 提交 ")]),_:2},1032,["onClick"]),o(f,{type:"danger",size:"small",plain:"",onClick:i=>X(l.row,l.$index)},{default:r(()=>[p(" 取消 ")]),_:2},1032,["onClick"])],64)):(c(),C(S,{key:1},[o(f,{type:"success",size:"small",plain:"",onClick:i=>ee(l.row)},{default:r(()=>[p(" 设计问卷 ")]),_:2},1032,["onClick"]),o(f,{type:"danger",size:"small",plain:"",onClick:i=>ae(l.row)},{default:r(()=>[p(" 删除 ")]),_:2},1032,["onClick"])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),o(h,{prop:"countryName",label:"国家/标题",width:"500"}),o(h,{prop:"isDefault",label:"默认/状态"},{default:r(s=>[o(V,{onChange:l=>Y(s.row),modelValue:s.row.isDefault,"onUpdate:modelValue":l=>s.row.isDefault=l,"active-value":1,"inactive-value":2},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),o(h,{label:"操作",width:"250",align:"center",fixed:"right"},{default:r(s=>[o(f,{type:"primary",size:"small",plain:"",onClick:l=>Q(s.row)},{default:r(()=>[p(" 新增问卷 ")]),_:2},1032,["onClick"]),o(f,{type:"danger",size:"small",plain:"",onClick:l=>te(s.row)},{default:r(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,n(e).loading]])]),_:1},8,["rules","model"]),o(me,{"current-page":n(m).page,total:n(m).total,"page-size":n(m).size,"page-sizes":n(m).sizes,layout:n(m).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:G,onCurrentChange:L},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),n(e).editProps.visible?(c(),g(De,{key:0,id:n(e).editProps.id,countryId:n(e).editProps.countryId,modelValue:n(e).editProps.visible,"onUpdate:modelValue":a[6]||(a[6]=s=>n(e).editProps.visible=s),row:n(e).editProps.row,onSuccess:d},null,8,["id","countryId","modelValue","row"])):U("",!0),n(e).formMode==="dialog"||n(e).formMode==="drawer"?(c(),g($e,{key:1,id:n(e).formModeProps.id,modelValue:n(e).formModeProps.visible,"onUpdate:modelValue":a[7]||(a[7]=s=>n(e).formModeProps.visible=s),mode:n(e).formMode,details:n(e).formModeProps.details,title:n(e).formModeProps.title,onSuccess:d},null,8,["id","modelValue","mode","details","title"])):U("",!0)],2)}}}),Xe=Ve(Ue,[["__scopeId","data-v-7f66014d"]]);export{Xe as default};
