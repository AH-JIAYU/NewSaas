
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ue,m as Z,r as d,l as de,u as ie,c as ce,n as pe,a as i,o as v,e as x,w as a,y as _,f as l,g as V,i as r,b as $,t as J,F as O,z as me,p as j,E as G,aH as fe,aI as ve,L as _e}from"./index-BN2fl0vf.js";import{a as ge}from"./department-B0H2_vLX.js";import{a as he}from"./position_manage-CzwzQ0_-.js";import{a as ye}from"./configuration_role-4PLhTrUl.js";import{u as be}from"./configuration_manager-DOZJ846e.js";const R=g=>(fe("data-v-a02039fd"),g=g(),ve(),g),ke=R(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"},"基本信息")],-1)),xe=R(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"}," 部门信息 ")],-1)),Ve=R(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"},"角色信息")],-1)),we={class:"flex-c"},Ce=ue({__name:"index",props:Z(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:Z(["success","getList"],["update:modelValue"]),setup(g,{emit:Q}){const W=be(),X=d([]),D=d(),Y=de(),ee=d(),L=d(),T=d(),ae=d(!1),q=d(),F=d(),p=g,w=Q,h=d(),N=ie(g,"modelValue"),le=ce(()=>p.id===""?"新增用户":"编辑用户"),te={children:"children",label:"name"},f=d(),oe=d([]),e=d({id:p.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"123456",roleList:[],role:"",active:!0,positionId:"",organizationalStructureId:""}),c=d([]),C=d({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{validator:(n,t,s)=>{const u=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;e.value.phone?u.test(e.value.phone)?s():s(new Error("请输入合法手机号")):s()},trigger:"blur"}],email:[{validator:(n,t,s)=>{const u=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e.value.email?u.test(e.value.email)?s():s(new Error("请输入合法邮箱")):s()},trigger:"blur"}]}),se=n=>{Array.isArray(n)&&n.length>1&&(e.value.roleList=[n[n.length-1]])};function ne(){e.value.email||(C.value.email=[],f.value.clearValidate("email")),e.value.phone||(C.value.phone=[],f.value.clearValidate("phone")),c.value=h.value.getCheckedKeys(!1);const n=h.value.getCheckedKeys(),t=h.value.getHalfCheckedKeys(),s=n.concat(t);e.value.organizationalStructureId=s[0],e.value.roleList.length>0?e.value.role=e.value.roleList[0]:(e.value.role="",e.value.roleList=[]),e.value.id?f.value&&f.value.validate(u=>{if(u){const{id:m,phone:z,email:B,password:S,name:b,country:k,active:U,type:A,role:K,positionId:M,organizationalStructureId:E,userName:P}=e.value,o={id:m,phone:z,email:B,password:S,name:b,country:k,active:U,type:A,role:K,positionId:M,organizationalStructureId:E,userName:P};F.value===o.phone&&delete o.phone,q.value===o.email&&delete o.email,o.password||delete o.password,j.edit(o).then(()=>{G.success({message:"编辑成功",center:!0}),w("success"),w("getList"),I()})}}):f.value&&f.value.validate(u=>{u&&j.create(e.value).then(()=>{G.success({message:"新增成功",center:!0}),w("success"),w("getList"),I()})})}function I(){N.value=!1}const H=n=>n==null?void 0:n.reduce((t,s)=>Array.isArray(s)?t.concat(H(s)):t.concat(s),[]),re=(n,t)=>{t?(h.value.getCheckedKeys().forEach(u=>{u!==n.id&&h.value.setChecked(u,!1)}),c.value=[n.id]):c.value=c.value.filter(s=>s!==n.id)};return pe(async()=>{c.value=[],c.value.push(p.parentId);const{data:n}=await he.list({page:1,limit:10,id:null,name:"",active:null});n&&(D.value=n.data),X.value=await W.getStaff();const t=await ye.list({id:null,name:""});t.data&&(L.value=t.data);const s=await ge.list({name:""});s.data&&(T.value=s.data),ee.value=await Y.getCountry(),p.id!==""&&p.row&&(C.value.password=[],e.value=JSON.parse(p.row),e.value.roleList=[e.value.role],c.value||(c.value=[]),c.value.push(p.parentId),q.value=e.value.email,F.value=e.value.phone,ae.value=!0),oe.value=H(p.dataList)}),(n,t)=>{const s=i("el-input"),u=i("el-form-item"),m=i("el-col"),z=i("el-option"),B=i("el-select"),S=i("el-text"),b=i("el-row"),k=i("el-card"),U=i("el-tree"),A=i("el-checkbox"),K=i("el-checkbox-group"),M=i("ElForm"),E=i("ElButton"),P=i("ElDrawer");return v(),x(P,{modelValue:N.value,"onUpdate:modelValue":t[7]||(t[7]=o=>N.value=o),title:r(le),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:I},{footer:a(()=>[_("div",we,[l(E,{size:"large",onClick:I},{default:a(()=>[V(" 取消 ")]),_:1}),l(E,{type:"primary",size:"large",onClick:ne},{default:a(()=>[V(" 确定 ")]),_:1})])]),default:a(()=>[l(M,{ref_key:"formRef",ref:f,model:r(e),rules:r(C),"label-width":"100px","validate-on-rule-change":!1},{default:a(()=>[l(k,{class:"box-card"},{header:a(()=>[ke]),default:a(()=>[l(b,{gutter:24},{default:a(()=>[l(m,{span:8},{default:a(()=>[l(u,{label:"用户名",prop:"userName"},{default:a(()=>[l(s,{modelValue:r(e).userName,"onUpdate:modelValue":t[0]||(t[0]=o=>r(e).userName=o),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:a(()=>[l(u,{label:"姓名",prop:""},{default:a(()=>[l(s,{modelValue:r(e).name,"onUpdate:modelValue":t[1]||(t[1]=o=>r(e).name=o),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:a(()=>[l(u,{label:"手机号",prop:"phone"},{default:a(()=>[l(s,{modelValue:r(e).phone,"onUpdate:modelValue":t[2]||(t[2]=o=>r(e).phone=o),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:a(()=>[l(u,{label:"邮箱",prop:"email"},{default:a(()=>[l(s,{modelValue:r(e).email,"onUpdate:modelValue":t[3]||(t[3]=o=>r(e).email=o),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:a(()=>[l(u,{label:"职位",prop:""},{default:a(()=>[l(B,{modelValue:r(e).positionId,"onUpdate:modelValue":t[4]||(t[4]=o=>r(e).positionId=o),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[5]||(t[5]=()=>{})},{default:a(()=>[(v(!0),$(O,null,J(r(D),o=>(v(),x(z,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:a(()=>[l(u,{label:"初始密码",prop:""},{default:a(()=>[l(S,null,{default:a(()=>[V("123456")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(k,{class:"box-card"},{header:a(()=>[xe]),default:a(()=>[l(b,{gutter:24},{default:a(()=>[l(u,{label:"分配部门:"},{default:a(()=>[l(U,{style:{"max-width":"600px"},ref_key:"treeRef",ref:h,data:r(T),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":r(c),"default-expand-all":"",props:te,onCheckChange:re},null,8,["data","default-checked-keys"])]),_:1})]),_:1})]),_:1}),l(k,{class:"box-card"},{header:a(()=>[Ve]),default:a(()=>[l(b,{gutter:24},{default:a(()=>[l(u,{label:"分配角色:"},{default:a(()=>{var o;return[(o=r(L))!=null&&o.length?(v(),x(K,{key:0,style:{"margin-left":"1.5rem"},modelValue:r(e).roleList,"onUpdate:modelValue":t[6]||(t[6]=y=>r(e).roleList=y),onChange:se},{default:a(()=>[(v(!0),$(O,null,J(r(L),y=>(v(),x(A,{key:y.id,label:y.roleName,value:y.roleName},{default:a(()=>[V(me(y.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):(v(),x(S,{key:1},{default:a(()=>[V("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ue=_e(Ce,[["__scopeId","data-v-a02039fd"]]);export{Ue as default};
