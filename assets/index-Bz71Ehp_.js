
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as V}from"./configuration_role-B-B5FtC-.js";import{k as U,C as $,r as s,c as M,d as j,bl as q,D as J,ak as E,a as n,al as K,am as L,i as o,o as _,b as g,f as a,w as r,F as b,G as C,a3 as O,a4 as T,e as z,g as A,j as H,_ as Q}from"./index-BamRYlq0.js";const W={list:()=>U.get("role/get/getRoleButton")},X=$("buttonPermission",()=>{const u=s([]),v=M(async()=>{if(u.value.length)return u.value;const{data:f}=await W.list();return f});return{permissions:u,getPermissions:v}}),Y=X,Z={class:"custom-tree-node"},ee={class:"menu"},te={class:"permission"},oe={key:0,class:"permissions"},ae=j({__name:"index",props:["id","row"],setup(u,{expose:v}){const f=u,I=q(),N=Y(),i=s(!1),d=s(),h=s(),x=s([]),p=s([]),e=s({id:f.id??null,menuId:[],permission:[],roleName:"",remark:""}),R=s({roleName:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});J(async()=>{e.value.id!==""&&await B(),i.value=!0,x.value=I.routesRaw,p.value=await N.getPermissions,i.value=!1});async function B(){i.value=!0,e.value=JSON.parse(f.row),i.value=!1}function w(c){return p==null?void 0:p.value.filter(t=>c===t.menuId)}return v({submit(){return e.value.menuId=h.value.getCheckedKeys(!1),new Promise(c=>{e.value.id===""?d.value&&d.value.validate(t=>{t&&V.create(e.value).then(()=>{E.success({message:"新增成功",center:!0}),c()})}):d.value&&d.value.validate(t=>{t&&V.edit(e.value).then(()=>{E.success({message:"编辑成功",center:!0}),c()})})})}}),(c,t)=>{const y=n("ElInput"),k=n("ElFormItem"),F=n("ElCheckbox"),S=n("ElCheckboxGroup"),D=n("el-tree"),P=n("ElForm"),G=K("loading");return L((_(),g("div",null,[a(P,{ref_key:"formRef",ref:d,model:o(e),rules:o(R),"label-width":"120px","label-suffix":"："},{default:r(()=>[a(k,{label:"角色码",prop:"roleName"},{default:r(()=>[a(y,{modelValue:o(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=l=>o(e).roleName=l),disabled:!!o(e).id,placeholder:"请输入角色码"},null,8,["modelValue","disabled"])]),_:1}),a(k,{label:"备注",prop:"remark"},{default:r(()=>[a(y,{modelValue:o(e).remark,"onUpdate:modelValue":t[1]||(t[1]=l=>o(e).remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),a(k,{label:"权限"},{default:r(()=>[a(D,{ref_key:"treeRef",ref:h,data:o(x),style:{width:"100%"},"default-checked-keys":o(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:r(({data:l})=>[b("div",Z,[b("div",ee,C(l.meta.title),1),b("div",te,[w(l.id).length?(_(),g("div",oe,[a(S,{modelValue:o(e).permission,"onUpdate:modelValue":t[2]||(t[2]=m=>o(e).permission=m)},{default:r(()=>[(_(!0),g(O,null,T(w(l.id),m=>(_(),z(F,{key:m.id,value:m.id},{default:r(()=>[A(C(m.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):H("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[G,o(i)]])}}}),re=Q(ae,[["__scopeId","data-v-6e60b19d"]]);export{re as default};
