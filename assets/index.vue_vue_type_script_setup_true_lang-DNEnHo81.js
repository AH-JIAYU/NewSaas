
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as f,d as G,r,n as H,a as d,q as K,s as Q,o as _,b as V,f as a,w as o,y as U,g,F as h,t as E,e as W,E as T,am as X,_ as Z}from"./index-f26E4OBE.js";import{u as ee}from"./user_customer-BKVnFhGq.js";import{_ as le}from"./index.vue_vue_type_script_setup_true_lang-ByfnrPoE.js";const A={list:m=>f.post("tenant-invoice/getTenantInvoices",m),create:m=>f.post("tenant-invoice/insertTenantInvoice",m),edit:m=>f.post("tenant-invoice/updateById",m),delete:m=>f.post("tenant-invoice/deleteById",m)},te={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"0 1rem"}},ae={style:{flex:"auto"}},ie=G({name:"Edit",__name:"index",emits:["success"],setup(m,{expose:Y,emit:q}){const B=ee(),C=q,D=r(""),b=r(),n=r(!1),k=r([]),c=r(),v=r(!1),x=r(),M=[{lable:"未收款",value:1},{lable:"部分收款",value:2},{lable:"已完结",value:3},{lable:"坏账",value:4}],t=r({id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""}),L=r({invoiceCode:[{required:!0,trigger:"blur",message:"请输入发票编号"}],tenantCustomerId:[{required:!0,trigger:"change",message:"请选择客户"}],invoiceStatus:[{required:!0,trigger:"change",message:"请选择发票状态"}],invoiceAmount:[{required:!0,trigger:"blur",message:"请输入发票金额"},{validator:(u,e,i)=>{e?/^\d+(\.\d{1,10})?$/.test(e)?i():i(new Error("格式不正确，请输入有效的金额")):i(new Error("请输入发票金额"))},trigger:"blur"}],invoiceDate:[{required:!0,trigger:"change",message:"请选择开票日期"}]});function $(){return new Promise(u=>{t.value.id?c.value&&c.value.validate(e=>{if(e)try{n.value=!0;const i=X(t.value);A.edit(i).then(()=>{n.value=!1,T.success({message:"编辑成功",center:!0}),C("success"),v.value=!1,u()})}catch{}finally{n.value=!1}}):c.value&&c.value.validate(e=>{if(e)try{n.value=!0,delete t.value.id,A.create(t.value).then(()=>{n.value=!1,T.success({message:"新增成功",center:!0}),C("success"),v.value=!1,u()})}catch{}finally{n.value=!1}})})}async function F(u){try{n.value=!0,u?t.value=JSON.parse(u):t.value={id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""},D.value=u!=null&&u.id?"编辑":"新增",n.value=!1,v.value=!0}catch{}finally{n.value=!1}}const N=()=>{x.value.showEdit()},I=async()=>{k.value=await B.getCustomerList()};H(async()=>{b.value=new Date,await I()});const O=()=>{c.value.resetFields(),Object.assign(t.value,{id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""})};return Y({showEdit:F}),(u,e)=>{const i=d("el-option"),S=Z,y=d("el-button"),w=d("el-select"),s=d("el-form-item"),p=d("el-input"),j=d("ElOption"),R=d("el-date-picker"),z=d("el-form"),J=d("el-dialog"),P=K("loading");return Q((_(),V("div",null,[a(J,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value=l),title:D.value,width:"700",onClose:O},{footer:o(()=>[U("div",ae,[a(y,{type:"",onClick:e[9]||(e[9]=l=>v.value=!1)},{default:o(()=>[g(" 取消 ")]),_:1}),a(y,{type:"primary",onClick:$},{default:o(()=>[g(" 确定 ")]),_:1})])]),default:o(()=>[a(z,{ref_key:"formRef",ref:c,"label-width":"7rem",model:t.value,rules:L.value,inline:!1},{default:o(()=>[a(s,{label:"客户简称",prop:"tenantCustomerId"},{default:o(()=>[a(w,{modelValue:t.value.tenantCustomerId,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.tenantCustomerId=l),placeholder:"请选择客户",clearable:"",filterable:""},{empty:o(()=>[U("div",te,[g(" 暂无数据 "),a(y,{type:"primary",link:"",size:"small",onClick:N},{default:o(()=>[g(" 快捷新增 "),a(S,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:".125rem",margin:"0 .125rem"}})]),_:1})])]),default:o(()=>[(_(!0),V(h,null,E(k.value,l=>(_(),W(i,{key:l.tenantCustomerId,value:l.tenantCustomerId,label:l.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{prop:"invoiceCode",label:"发票编号"},{default:o(()=>[a(p,{modelValue:t.value.invoiceCode,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.invoiceCode=l),placeholder:"请输入发票编号",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{prop:"invoiceAmount",label:"发票金额"},{default:o(()=>[a(p,{modelValue:t.value.invoiceAmount,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.invoiceAmount=l),placeholder:"请输入发票金额",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"手续费(税)"},{default:o(()=>[a(p,{modelValue:t.value.invoiceTax,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.invoiceTax=l),placeholder:"请输入手续费",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"实际收款"},{default:o(()=>[a(p,{modelValue:t.value.actualReceipts,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.actualReceipts=l),placeholder:"请输入实际收款",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{prop:"invoiceStatus",label:"发票状态"},{default:o(()=>[a(w,{modelValue:t.value.invoiceStatus,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.invoiceStatus=l),placeholder:"请选择发票状态",clearable:"",filterable:""},{default:o(()=>[(_(),V(h,null,E(M,l=>a(j,{label:l.lable,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(s,{style:{width:"100%"},prop:"invoiceDate",label:"开票日期"},{default:o(()=>[a(R,{modelValue:t.value.invoiceDate,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.invoiceDate=l),"default-time":b.value,type:"datetime",placeholder:"请选择开票日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(s,{label:"收款日期"},{default:o(()=>[a(R,{modelValue:t.value.paymentDate,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.paymentDate=l),"default-time":b.value,type:"datetime",placeholder:"请选择收款日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(s,{label:"备注"},{default:o(()=>[a(p,{modelValue:t.value.remark,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.remark=l),placeholder:"备注说明",clearable:"",rows:5,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(le,{ref_key:"editRef",ref:x,onFetchData:I},null,512)])),[[P,n.value]])}}});export{ie as _,A as a};
