
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as D,d as ge,aN as fe,r as n,o as _e,a3 as c,al as $,b as r,j as N,g as o,w as a,a4 as z,c as s,h as i,i as v,aM as ve,f as A,t as d,B,k as p,O as F,ai as x,aO as he,aP as Se,aQ as ye,ao as be,z as ze}from"./index-D3JQ81m5.js";import{_ as Ce}from"./index-DP8IuCLz.js";import{_ as ke}from"./index.vue_vue_type_style_index_0_lang-CRNanwWp.js";import{_ as Te}from"./index-BK2I_xz4.js";import"./index-1FaGR_2D.js";import"./clipboard-BjMDEG42.js";import"./index.vue_vue_type_script_setup_true_lang-0pTNkfeo.js";import"./sortable.esm-C0-Qcoum.js";const U={queryOrganizationalStructureSettlementRecordList:g=>D.post("financial-record/queryOrganizationalStructureSettlementRecordList",g),organizationalStructureSettlement:g=>D.post("organizationalStructure/organizationalStructureSettlement",g),organizationalStructureSettlementUpdate:g=>D.post("organizationalStructure/organizationalStructureSettlementUpdate",g)},Le={class:"copyId tableSmall"},Pe={class:"id oneLine projectId fontColor"},Ie=ge({name:"PMSettlement",__name:"list",setup(g){const{getParams:V,pagination:f,onSizeChange:q,onCurrentChange:j}=fe(),J=n(""),y=n(!0);n();const C=n(!1),m=n([]),k=n(!1);n(!1);const T=n("default"),L=n(!1);n([]);const Q=[{label:"待支付",value:"PENDING"},{label:"已支付",value:"PAID"},{label:"已拒绝",value:"REJECTED"}],R=n(),G=n("formSearch-PMSettlement"),P=n([{label:"部门ID",prop:"organizationalStructureId",sortable:!0,checked:!0},{label:"部门名称",prop:"name",sortable:!0,checked:!0},{label:"账单日期",prop:"createTime",sortable:!0,checked:!0},{label:"账单金额",prop:"price",sortable:!0,checked:!0},{label:"状态",prop:"status",sortable:!0,checked:!0}]),u=n({organizationalStructureId:"",status:[],time:[],startTime:null,endTime:null}),M=n([]);function K(){Object.assign(u.value,{organizationalStructureId:"",status:[],time:[],startTime:null,endTime:null})}function W(l){q(l).then(()=>h())}function I(l=1){j(l).then(()=>h())}async function h(){try{y.value=!0,u.value.time.length?(u.value.startTime=u.value.time[0],u.value.endTime=u.value.time[1]):(u.value.time=[],u.value.startTime=null,u.value.endTime=null);const l={...V(),...u.value};delete l.time;const t=await U.queryOrganizationalStructureSettlementRecordList(l);M.value=t.result,f.value.total=t.total?Number(t.total):0,y.value=!1}catch{}finally{y.value=!1}}const X=async()=>{const{status:l,error:t}=await U.organizationalStructureSettlement({});l==1?(x.success({message:"手动结算成功",center:!0}),h()):x.success({message:t,center:!0})};async function H(l,t){(await U.organizationalStructureSettlementUpdate({id:l,status:t})).status===1&&x.success({message:"操作成功"}),h()}_e(()=>{P.value.forEach(l=>{l.checked&&m.value.push(l.prop)}),h(),R.value=[{index:1,show:!0,type:"input",modelName:"organizationalStructureId",placeholder:"部门ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"status",placeholder:"状态",option:"status",optionLabel:"label",optionValue:"value",multiple:!0}]});const Y={status:()=>Q},E=n();function Z(l){l?E.value=l.id:E.value=""}return(l,t)=>{const O=Te,ee=c("ElDivider"),b=c("el-button"),te=ke,ae=he,le=Se,ne=c("el-row"),oe=Ce,S=c("el-table-column"),_=c("el-text"),re=ye,se=c("ElTableColumn"),ue=c("el-empty"),ie=c("el-table"),ce=c("ElPagination"),me=be,w=$("auth"),pe=$("loading");return r(),N("div",{class:B({"absolute-container":C.value})},[o(me,null,{default:a(()=>[o(O,{formSearchList:R.value,formSearchName:G.value,onCurrentChange:I,onOnReset:K,model:u.value,formOption:Y},null,8,["formSearchList","formSearchName","model"]),o(ee,{"border-style":"dashed"}),o(ne,{gutter:24},{default:a(()=>[o(te,null,{default:a(()=>[z((r(),s(b,{size:"default",type:"primary",onClick:X},{default:a(()=>[i(" 手动结算 ")]),_:1})),[[w,"PMSettlement-update-organizationalStructureSettlement"]])]),_:1}),o(le,null,{default:a(()=>[o(b,{size:"default",onClick:t[0]||(t[0]=()=>{})},{default:a(()=>[i(" 导出 ")]),_:1}),o(ae,{border:k.value,"onUpdate:border":t[1]||(t[1]=e=>k.value=e),tableAutoHeight:C.value,"onUpdate:tableAutoHeight":t[2]||(t[2]=e=>C.value=e),checkList:m.value,"onUpdate:checkList":t[3]||(t[3]=e=>m.value=e),columns:P.value,"onUpdate:columns":t[4]||(t[4]=e=>P.value=e),"line-height":T.value,"onUpdate:lineHeight":t[5]||(t[5]=e=>T.value=e),stripe:L.value,"onUpdate:stripe":t[6]||(t[6]=e=>L.value=e),style:{"margin-left":"12px"},onQueryData:I},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),z((r(),s(ie,{ref_key:"tableSortRef",ref:J,style:{"margin-top":"10px"},"row-key":"id",data:M.value,border:k.value,size:T.value,stripe:L.value,"highlight-current-row":"",onCurrentChange:Z},{empty:a(()=>[o(ue,{image:v(ve),"image-size":300},null,8,["image"])]),default:a(()=>[m.value.includes("organizationalStructureId")?(r(),s(S,{key:0,"show-overflow-tooltip":"",align:"left",label:"部门ID"},{default:a(({row:e})=>[A("div",Le,[A("div",Pe,d(e.organizationalStructureId?e.organizationalStructureId:"-"),1),o(oe,{content:e.organizationalStructureId,class:B({rowCopy:"rowCopy",current:e.id===E.value})},null,8,["content","class"])])]),_:1})):p("",!0),m.value.includes("name")?(r(),s(S,{key:1,prop:"name","show-overflow-tooltip":"",align:"left",label:"部门名称"},{default:a(({row:e})=>[o(_,{class:"fontColor"},{default:a(()=>[i(d(e.name?e.name:"-"),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("createTime")?(r(),s(S,{key:2,prop:"createTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:a(({row:e})=>[o(_,{class:"fontColor"},{default:a(()=>[i(d(e.createTime?e.createTime:"-"),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("price")?(r(),s(S,{key:3,prop:"price","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:a(({row:e})=>[o(_,{class:"fontColor"},{default:a(()=>[o(re),i(d(e.price||0),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("status")?(r(),s(se,{key:4,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:a(({row:e})=>[e.status=="待支付"?(r(),s(_,{key:0,style:{color:"rgb(255, 172, 84)"},class:"oneLine",type:"warning"},{default:a(()=>[i(d(e.status),1)]),_:2},1024)):p("",!0),e.status=="已支付"?(r(),s(_,{key:1,style:{color:"rgb(3, 194, 57)"},class:"oneLine",type:"success"},{default:a(()=>[i(d(e.status),1)]),_:2},1024)):p("",!0),e.status=="已拒绝"?(r(),s(_,{key:2,style:{color:"rgb(251, 104, 104)"},class:"oneLine",type:"danger"},{default:a(()=>[i(d(e.status),1)]),_:2},1024)):p("",!0)]),_:1})):p("",!0),o(S,{align:"left",fixed:"right",label:"操作",width:"170"},{default:a(({row:e})=>[e.status=="待支付"?(r(),N(F,{key:0},[z((r(),s(b,{size:"small",type:"primary",plain:"",onClick:de=>H(e.id,"PAID")},{default:a(()=>[i(" 支付 ")]),_:2},1032,["onClick"])),[[w,"PMSettlement-update-organizationalStructureSettlementUpdate"]]),z((r(),s(b,{size:"small",plain:"",type:"danger",onClick:de=>H(e.id,"REJECTED")},{default:a(()=>[i(" 拒绝 ")]),_:2},1032,["onClick"])),[[w,"PMSettlement-update-organizationalStructureSettlementUpdate"]])],64)):(r(),N(F,{key:1},[i("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[pe,y.value]]),o(ce,{"current-page":v(f).page,total:v(f).total,"page-size":v(f).size,"page-sizes":v(f).sizes,layout:v(f).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:W,onCurrentChange:I},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),He=ze(Ie,[["__scopeId","data-v-81c1af21"]]);export{He as default};
