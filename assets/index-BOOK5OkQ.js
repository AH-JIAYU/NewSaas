
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as v,d as D,r as f,k as U,E as C,a as u,p as R,q as z,i as t,o as c,b as p,f as l,w as a,g as y,F as _,t as B,e as j,s as O,H as S,R as P}from"./index-BrOEW0VG.js";const V={list:s=>v.post("bill/getMemberBillList",s),create:s=>v.post("bill/addMemberSettlement",s),getMemberBillAvailableBalance:s=>v.post("bill/getMemberBillAvailableBalance",s),changestatus:s=>v.post("bill/updateMemberBill",s)},q=D({__name:"index",props:{id:{default:""}},setup(s,{expose:A}){const i=f(!1),g=f(),n=f({minimumAmount:"",settlementType:1,settlementAmount:"",addMemberSettlementInfoList:[]}),b=f({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),M=f({}),h=async()=>{try{i.value=!0;const r=await V.getMemberBillAvailableBalance({});b.value.memberSettlementInfoList=r.data.memberBillAvailableBalanceInfoList,n.value.minimumAmount=r.data.minimumAmount,i.value=!1}catch{}finally{i.value=!1}},x=r=>{const o=b.value.memberSettlementInfoList.filter(m=>r.includes(m.id));for(let m=0;m<o.length;m++)n.value.addMemberSettlementInfoList.push(o[m])};return U(async()=>{await h()}),A({submit(){return new Promise(r=>{g.value&&g.value.validate(o=>{if(o)try{i.value=!0,V.create(n.value).then(()=>{i.value=!1,C.success({message:"新增成功",center:!0}),r()})}catch{}finally{i.value=!1}})})}}),(r,o)=>{const m=u("el-radio"),E=u("el-radio-group"),d=u("ElFormItem"),I=u("ElInput"),L=u("el-option"),k=u("el-select"),w=u("ElInputNumber"),F=u("ElForm"),N=R("loading");return z((c(),p("div",null,[l(F,{ref_key:"formRef",ref:g,model:t(n),rules:t(M),"label-width":"6.25rem"},{default:a(()=>[l(d,{label:"结算方式"},{default:a(()=>[l(E,{modelValue:t(n).settlementType,"onUpdate:modelValue":o[0]||(o[0]=e=>t(n).settlementType=e)},{default:a(()=>[l(m,{value:1,size:"large"},{default:a(()=>[y(" 全部结算 ")]),_:1}),l(m,{value:2,size:"large"},{default:a(()=>[y(" 指定结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(n).settlementType===1?(c(),p(_,{key:0},[l(d,{label:"最低结算额度"},{default:a(()=>[l(I,{disabled:"",placeholder:"",value:t(n).minimumAmount},null,8,["value"])]),_:1}),l(d,{label:"结算金额"},{default:a(()=>[l(I,{modelValue:t(n).settlementAmount,"onUpdate:modelValue":o[1]||(o[1]=e=>t(n).settlementAmount=e),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(c(),p(_,{key:1},[l(d,{label:"指定会员"},{default:a(()=>[l(k,{placeholder:"Select",modelValue:t(b).memberSettlementInfoSelect,"onUpdate:modelValue":o[2]||(o[2]=e=>t(b).memberSettlementInfoSelect=e),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:x},{default:a(()=>[(c(!0),p(_,null,B(t(b).memberSettlementInfoList,e=>(c(),j(L,{key:e.id,value:e.id,label:e.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"最低结算额度"},{default:a(()=>[l(I,{disabled:"",placeholder:"",value:"111"})]),_:1}),(c(!0),p(_,null,B(t(n).addMemberSettlementInfoList,e=>(c(),p(_,null,[l(d,{label:""},{default:a(()=>[O("p",null,S(e.memberId)+" - "+S(e.memberName)+" - 可用余额："+S(e.availableBalance),1)]),_:2},1024),l(d,{label:"结算金额"},{default:a(()=>[l(w,{"controls-position":"right",modelValue:e.settlementAmount,"onUpdate:modelValue":T=>e.settlementAmount=T,max:e.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[N,t(i)]])}}}),H=P(q,[["__scopeId","data-v-b55bc540"]]),G=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));export{H as D,V as a,G as i};
