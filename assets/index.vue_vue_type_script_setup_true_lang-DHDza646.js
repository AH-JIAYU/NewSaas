
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{c as P}from"./user_cooperation-WeC_KTb_.js";import{_ as E}from"./index.vue_vue_type_script_setup_true_lang-SxHCfjyr.js";import{a as w}from"./department-htT9pOTR.js";import{d as q,r as u,a as m,o as U,b as F,f as a,w as r,g as s,i as t,y as p,e as A,j as D,A as M,E as L}from"./index-ChQqcNbm.js";const $={style:{display:"flex","justify-items":"center"}},z=p("span",{style:{"margin-right":"15px"}},"发送项目",-1),G={style:{display:"flex","justify-items":"center"}},H=p("span",{style:{"margin-right":"15px"}},"接收项目",-1),W=q({__name:"index",emits:["fetch-data"],setup(J,{expose:T,emit:V}){const I=V,i=u(!1),v=u(),e=u({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),_=u([]);async function N(l){if(console.log(l,"rrrr"),e.value.form.id=l.id,e.value.form.priceRatio=l.priceRatio,e.value.form.sendProjectType=l.sendProjectType,e.value.form.receiveProjectType=l.receiveProjectType,e.value.form.chargeUserName=l.chargeUserName,e.value.form.departmentId=l.departmentId,e.value.form.chargeUserId=l.chargeUserId,e.value.form.departmentId){const o=await w.list({name:""});o.data&&(_.value=o.data);const c=_.value.find(d=>d.id===e.value.form.departmentId);e.value.form.departmentName=c.name}e.value.form.name=(e.value.form.departmentName?e.value.form.departmentName:"")+(e.value.form.chargeUserName?e.value.form.chargeUserName:""),i.value=!0}function g(){i.value=!1,e.value.form={},v.value.resetFields()}const y=u();function R(){y.value.showEdit()}async function b(){await P.updateInvitationBindUser({id:e.value.form.id,chargeUserId:e.value.form.chargeUserId,departmentId:e.value.form.departmentId,chargeUserName:e.value.form.chargeUserName,sendProjectType:e.value.form.sendProjectType,receiveProjectType:e.value.form.receiveProjectType})}async function x(){await P.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio}),L.success({message:"修改成功",center:!0})}async function k(){v.value.validate(l=>{l&&(e.value.form.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",e.value.form.departmentId=""),b(),x(),I("fetch-data"),g())})}return T({showEdit:N}),(l,o)=>{const c=m("el-input"),d=m("el-form-item"),f=m("el-radio"),h=m("el-radio-group"),B=m("ElForm"),j=m("el-button"),C=m("el-dialog");return U(),F("div",null,[a(C,{modelValue:t(i),"onUpdate:modelValue":o[4]||(o[4]=n=>M(i)?i.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置"},{footer:r(()=>[a(j,{onClick:g},{default:r(()=>[s(" 关闭 ")]),_:1}),a(j,{type:"primary",onClick:k},{default:r(()=>[s(" 确认 ")]),_:1})]),default:r(()=>[a(B,{ref_key:"formRef",ref:v,rules:t(e).rules,model:t(e).form,"label-width":"7rem"},{default:r(()=>[a(d,{label:"价格比例",prop:"priceRatio"},{default:r(()=>[a(c,{modelValue:t(e).form.priceRatio,"onUpdate:modelValue":o[0]||(o[0]=n=>t(e).form.priceRatio=n),clearable:""},{append:r(()=>[s("%")]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"项目分配方式",prop:"sendProjectType","label-width":"7rem"},{default:r(()=>[p("div",$,[z,a(h,{modelValue:t(e).form.sendProjectType,"onUpdate:modelValue":o[1]||(o[1]=n=>t(e).form.sendProjectType=n)},{default:r(()=>[a(f,{value:1},{default:r(()=>[s("自动")]),_:1}),a(f,{value:2},{default:r(()=>[s("手动")]),_:1})]),_:1},8,["modelValue"])])]),_:1}),a(d,{prop:"receiveProjectType"},{default:r(()=>[p("div",G,[H,a(h,{modelValue:t(e).form.receiveProjectType,"onUpdate:modelValue":o[2]||(o[2]=n=>t(e).form.receiveProjectType=n)},{default:r(()=>[a(f,{value:1},{default:r(()=>[s("自动")]),_:1}),a(f,{value:2},{default:r(()=>[s("手动")]),_:1})]),_:1},8,["modelValue"])]),t(e).form.receiveProjectType==1?(U(),A(c,{key:0,placeholder:"请选择负责部门/PM",clearable:"",style:{width:"200px","margin-left":"25px"},onClick:R,modelValue:t(e).form.name,"onUpdate:modelValue":o[3]||(o[3]=n=>t(e).form.name=n)},null,8,["modelValue"])):D("",!0)]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),a(E,{ref_key:"userRef",ref:y},null,512)])}}});export{W as _};
