
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k,d as z,as as H,r as h,B as K,$ as P,c as J,ai as F,a as i,aj as O,ak as Q,i as n,o as b,b as A,f as u,w as r,l as W,E as X,e as x,g as I,j as Y,F as Z,n as ee,D as ae,K as le}from"./index-CRsr9m9e.js";import{a as C}from"./role-uYF6xluz.js";const te={list:()=>k.get("menu/list",{baseURL:"/mock/"}),detail:d=>k.get("menu/detail",{params:{id:d},baseURL:"/mock/"}),create:d=>k.post("menu/create",d,{baseURL:"/mock/"}),edit:d=>k.post("menu/edit",d,{baseURL:"/mock/"}),delete:d=>k.post("menu/delete",{id:d},{baseURL:"/mock/"})},oe={class:"mb-2"},ue=z({__name:"index",props:{id:{default:""}},setup(d,{expose:L}){const S=d,B=H(),E=h(!1),p=h(),l=h({id:S.id,name:"",remark:"",auths:[]}),T=h({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),f=h("frontend"),v=h([]),_=h([]);K(()=>{R(),l.value.id!==""&&D()}),P(f,()=>{R()});function R(){if(f.value==="frontend"){v.value=B.routesRaw;let o=1;const e=t=>{t.forEach((a,m)=>{var g;t[m].id=o,o++,_.value.push({id:a.id,auths:a.meta.auths||[]}),((g=a==null?void 0:a.children)==null?void 0:g.length)>0&&e(a.children)})};e(v.value)}else te.list().then(o=>{v.value=o.data;const e=t=>{t.forEach(a=>{var m;_.value.push({id:a.id,auths:a.meta.auths}),((m=a==null?void 0:a.children)==null?void 0:m.length)>0&&e(a.children)})};e(v.value)})}function D(){E.value=!0,C.detail(l.value.id).then(o=>{E.value=!1,l.value.name=o.data.name,l.value.remark=o.data.remark,l.value.auths=o.data.auths})}const V=J(()=>{const o={};return _.value.forEach(e=>{let t=0;e.auths.forEach(a=>{l.value.auths.includes(a.value)&&t++}),o[e.id]={checkAll:t===e.auths.length,indeterminate:t>0&&t<e.auths.length}}),o});function N(o,e){o?_.value.forEach(t=>{t.id===e&&t.auths.forEach(a=>{l.value.auths.includes(a.value)||l.value.auths.push(a.value)})}):_.value.forEach(t=>{t.id===e&&t.auths.forEach(a=>{l.value.auths=l.value.auths.filter(m=>m!==a.value)})})}return L({submit(){return new Promise(o=>{l.value.id===""?p.value&&p.value.validate(e=>{e&&C.create(l.value).then(()=>{F.success({message:"模拟新增成功",center:!0}),o()})}):p.value&&p.value.validate(e=>{e&&C.edit(l.value).then(()=>{F.success({message:"模拟编辑成功",center:!0}),o()})})})}}),(o,e)=>{const t=i("ElInput"),a=i("ElFormItem"),m=i("ElSwitch"),g=le,M=i("el-tooltip"),U=i("ElTableColumn"),w=i("ElCheckbox"),j=i("ElCheckboxGroup"),q=i("ElTable"),G=i("ElForm"),$=O("loading");return Q((b(),A("div",null,[u(G,{ref_key:"formRef",ref:p,model:n(l),rules:n(T),"label-width":"120px","label-suffix":"："},{default:r(()=>[u(a,{label:"名称",prop:"name"},{default:r(()=>[u(t,{modelValue:n(l).name,"onUpdate:modelValue":e[0]||(e[0]=s=>n(l).name=s),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),u(a,{label:"备注",prop:"remark"},{default:r(()=>[u(t,{modelValue:n(l).remark,"onUpdate:modelValue":e[1]||(e[1]=s=>n(l).remark=s),type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),u(a,{label:"权限"},{default:r(()=>[W("div",oe,[u(m,{modelValue:n(f),"onUpdate:modelValue":e[2]||(e[2]=s=>X(f)?f.value=s:null),"inactive-text":"前端路由数据","inactive-value":"frontend","active-text":"后端路由数据","active-value":"backend"},null,8,["modelValue"]),u(M,{content:"为方便演示，提供了路由数据分别从前端获取和后端获取的切换",placement:"top"},{default:r(()=>[u(g,{name:"i-ri:question-line",class:"ms-4"})]),_:1})]),(b(),x(q,{key:n(f),data:n(v),"row-key":"id",stripe:"","highlight-current-row":"","default-expand-all":"",border:"",style:{lineHeight:"normal"}},{default:r(()=>[u(U,{prop:"meta.title",width:"300",label:"模块"}),u(U,{label:"权限"},{default:r(({row:s})=>{var y;return[(y=s.meta.auths)!=null&&y.length?(b(),x(w,{key:0,modelValue:n(V)[s.id].checkAll,"onUpdate:modelValue":c=>n(V)[s.id].checkAll=c,indeterminate:n(V)[s.id].indeterminate,onChange:c=>N(c,s.id)},{default:r(()=>[I(" 全选 ")]),_:2},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"])):Y("",!0),u(j,{modelValue:n(l).auths,"onUpdate:modelValue":e[3]||(e[3]=c=>n(l).auths=c)},{default:r(()=>[(b(!0),A(Z,null,ee(s.meta.auths,c=>(b(),x(w,{key:c.value,label:c.value},{default:r(()=>[I(ae(c.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]}),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["model","rules"])])),[[$,n(E)]])}}});export{ue as _};
