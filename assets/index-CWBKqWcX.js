
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Q,m as C,r as f,u as W,c as X,n as Y,a as p,q as Z,s as k,i,o as g,e as D,w as d,f as r,g as b,b as S,t as E,F as P,v as V,A as ee,aq as q,E as ae,M as le}from"./index-BL1kLiLm.js";import{a as se}from"./department-CDTo8POA.js";import{u as oe}from"./configuration_manager-nQ0fE4Ne.js";const te={class:"mr"},ne={class:"mr checkbox-container"},re={class:"center mr"},ue={class:"centers mr"},ie=Q({__name:"index",props:C({parentId:{default:""},id:{default:""},tree:{},row:{},name:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:C(["getList"],["update:modelValue"]),setup(w,{emit:T}){const B=oe(),_=f([]),v=w,F=[{label:"完成计提",value:1},{label:"审核计提",value:2},{label:"结算计提",value:3}],I=f(!1),M=T,y=W(w,"modelValue"),N=X(()=>v.id===""?"新增子部门":"编辑子部门"),n=f([]),h=f();f([]);const e=f({parentId:v.parentId,name:"",remark:"",userIdList:[],organizationalStructurePersonList:[],superior:""}),O=f({name:[{required:!0,message:"请输入部门名称"}],commissionType:[{required:!0,message:"请选择计提方式",trigger:"change"}]});async function R(){h.value&&h.value.validate(async t=>{if(t){console.log("filteredUsers",n.value),e.value.organizationalStructurePersonList=[],n.value.forEach(a=>{const c={userId:a.id,commission:a.commission,commissionType:a.commissionType,commissionStatus:a.commissionStatus};e.value.organizationalStructurePersonList.push(c)}),console.log("filteredUsers11111111",n.value),console.log("form.value.organizationalStructurePersonList",e.value.organizationalStructurePersonList);const l=e.value.organizationalStructurePersonList.reduce((a,c)=>(a.some(L=>L.userId===c.userId)||a.push(c),a),[]);e.value.organizationalStructurePersonList=l;const o={...e.value};if(delete o.userIdList,e.value.id){console.log("params",o),console.log("filteredUsers",n.value);const{status:a}=await se.edit(o);a===1&&ae.success({message:"编辑成功",center:!0})}else{delete o.userIdList,console.log("params",o);return}await M("getList"),x()}})}const j=t=>{if(t.userId){const a=e.value.userIdList.indexOf(t.userId);a!==-1&&e.value.userIdList.splice(a,1)}else{const a=e.value.userIdList.indexOf(t.id);a!==-1&&e.value.userIdList.splice(a,1)}const l=e.value.organizationalStructurePersonList.findIndex(a=>a.id===t.id||a.userId===t.id);l!==-1&&e.value.organizationalStructurePersonList.splice(l,1);const o=n.value.findIndex(a=>a.id===t.id||a.userId===t.id);o!==-1&&n.value.splice(o,1)},A=t=>{var l;if(e.value.userIdList=t,n.value=_.value.filter(o=>{var a;return(a=e.value)==null?void 0:a.userIdList.includes(o.id)}),(l=e.value)!=null&&l.userIdList.length){const o=[];e.value.organizationalStructurePersonList.forEach(u=>{o.push(u)}),n.value.forEach(u=>{e.value.organizationalStructurePersonList.some(z=>z.userId===u.id)||o.push(u)});const c=Array.from(new Map(o.map(u=>[u.id,u])).values()).filter(u=>t.includes(u.id));n.value=c,e.value.organizationalStructurePersonList=n.value}else n.value=[],e.value.organizationalStructurePersonList=n.value};function x(){Object.assign(e,{parentId:"",name:"",remark:"",userIdList:[],organizationalStructurePersonList:[],superior:""}),y.value=!1}const J=()=>_.value.filter(t=>{var l;return(l=e.value)==null?void 0:l.userIdList.includes(t.id)});return v.parentId&&(e.value.superior=v.name),Y(async()=>{try{if(I.value=!0,v.id!==""){const{id:t,name:l,remark:o,organizationalStructurePersonList:a}=JSON.parse(v.row);e.value.id=t,e.value.name=l,e.value.remark=o,e.value.organizationalStructurePersonList=a,a.forEach(c=>{e.value.userIdList.push(c.userId)})}_.value=await B.getStaff(),n.value=J(),e.value.id&&(n.value=e.value.organizationalStructurePersonList),I.value=!1}catch{}finally{I.value=!1}}),(t,l)=>{const o=p("ElInput"),a=p("ElFormItem"),c=p("el-option"),u=p("el-select"),L=p("el-tag"),z=p("el-text"),$=p("el-switch"),G=p("ElForm"),U=p("ElButton"),H=p("ElDialog"),K=Z("loading");return k((g(),D(H,{modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=s=>y.value=s),title:i(N),width:"25rem","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:x},{footer:d(()=>[r(U,{size:"large",onClick:x},{default:d(()=>[b(" 取消 ")]),_:1}),r(U,{type:"primary",size:"large",onClick:R},{default:d(()=>[b(" 确定 ")]),_:1})]),default:d(()=>[r(G,{ref_key:"formRef",ref:h,model:i(e),rules:i(O),"label-width":"7rem"},{default:d(()=>[r(a,{label:"上级部门",prop:""},{default:d(()=>[r(o,{modelValue:i(e).superior,"onUpdate:modelValue":l[0]||(l[0]=s=>i(e).superior=s),disabled:!!v.parentId,placeholder:"请输入部门名称",clearable:""},null,8,["modelValue","disabled"])]),_:1}),r(a,{label:"部门名称",prop:"name"},{default:d(()=>[r(o,{modelValue:i(e).name,"onUpdate:modelValue":l[1]||(l[1]=s=>i(e).name=s),placeholder:"请输入部门名称",clearable:""},null,8,["modelValue"])]),_:1}),r(a,{label:"部门主管",prop:""},{default:d(()=>[r(u,{modelValue:i(e).userIdList,"onUpdate:modelValue":l[2]||(l[2]=s=>i(e).userIdList=s),"value-key":"",placeholder:"请选择部门主管",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",clearable:"",filterable:"",onChange:A},{default:d(()=>[(g(!0),S(P,null,E(i(_),s=>(g(),D(c,{key:s.value,label:s.userName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(g(!0),S(P,null,E(i(n),s=>(g(),S("div",{key:s.id,class:"user"},[V("div",te,[r(L,{type:"primary",closable:"",onClose:m=>j(s)},{default:d(()=>[b(ee(s.userName),1)]),_:2},1032,["onClose"])]),V("div",ne,[r(z,{style:{width:"4.375rem"}},{default:d(()=>[b("开启提成")]),_:1}),r($,{modelValue:s.commissionStatus,"onUpdate:modelValue":m=>s.commissionStatus=m,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"开启","inactive-text":"关闭"},null,8,["modelValue","onUpdate:modelValue"])]),k(V("div",re,[r(u,{modelValue:s.commissionType,"onUpdate:modelValue":m=>s.commissionType=m,"value-key":"",placeholder:"请选择计提时间",clearable:"",filterable:"",onChange:l[3]||(l[3]=()=>{})},{default:d(()=>[(g(),S(P,null,E(F,m=>r(c,{key:m.value,label:m.label,value:m.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])],512),[[q,s.commissionStatus===1]]),k(V("div",ue,[r(o,{modelValue:s.commission,"onUpdate:modelValue":m=>s.commission=m,placeholder:"请输入提成比例",style:{"max-width":"12rem"},clearable:""},null,8,["modelValue","onUpdate:modelValue"])],512),[[q,s.commissionStatus===1]])]))),128))]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])),[[K,i(I)]])}}}),pe=le(ie,[["__scopeId","data-v-c5b67b41"]]);export{pe as default};
