
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as S,ac as H,d as A,r as O,a3 as j,b as y,j as f,g as i,w as d,f as t,h as u,t as n,i as _,O as x,P as N,B as b,bw as R,k as G,aM as $,l as q,aH as w,aI as F,z as U}from"./index-BnVk3aZr.js";const D={list:c=>S.post("tenantBind/getProjectAllocationList",c),meList:c=>S.post("tenantBind/getProjectMeAllocationList",c),getTenantMeasurementList:c=>S.post("tenantBind/getTenantMeasurementList",c),getQuestionnaireClickList:c=>S.post("tenantBind/getQuestionnaireClickList",c),updateReceiveStatus:c=>S.post("tenantBind/updateReceiveStatus",c)},J=H("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),K=J,W=c=>(w("data-v-7da71380"),c=c(),F(),c),X={class:"details"},Y={class:"details-left"},Z={class:"project box"},ee={class:"link"},te=W(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),se=["onClick"],ne={class:"item-left"},ae={class:"tenant"},le={key:0,class:"tenantName",style:{color:"#333333"}},oe={class:"tenantLength"},ie={class:"tenantName",style:{color:"#333333"}},ce={class:"price flex-b"},re={style:{color:"#333333"}},pe={style:{color:"#333333"}},de={key:0,class:"viewAll"},ue={key:0,class:"details-right"},_e={key:0,class:"clickId"},ye={class:"clickIdItem"},fe={class:"clickIdItem-title"},Ie={class:"supplierName",style:{color:"#333333"}},me={class:"clickIdItem-content"},ve={style:{color:"#333333"}},Le={key:1,class:"nodata"},he={style:{flex:"auto"}},ge=A({name:"Edit",__name:"index",setup(c,{expose:B}){const k=K(),h=O(!1);O();const s=O({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function V(o,I=0){const a={linkId:o.linkId,projectId:o.projectId,source:I},r=await D.getTenantMeasurementList(a),l=r.data.tenantMeasurementInfoList;r.data.tenantMeasurementInfo&&l.unshift(r.data.tenantMeasurementInfo);const g=l.findIndex(p=>p.allocationTenantId===r.data.currentTenantId);l.splice(0,g);const e=l.findIndex(p=>p.allocationTenantId===r.data.currentTenantId),m=l[e].allocationHierarchy;l.splice(m+1);const T=l.filter(p=>p.type===1),v=l.filter(p=>p.type===2),L=l.filter(p=>p.type===3),M=[...T];if(v.length){const p=v.map(C=>C.memberGroupOrSupperId);v[0].length=v.length,v[0].memberGroupOrSupperIdList=p,M.push(v[0])}else if(L.length){const p=L.map(C=>C.memberGroupOrSupperId);L[0].length=L.length,L[0].memberGroupOrSupperIdList=p,M.push(L[0])}M.forEach(p=>p.visible=!1),s.value.currentTenantId=r.data.currentTenantId,s.value.tenantMeasurementInfoList=M,h.value=!0}const P=async(o,I)=>{if(o.totality==0)return;s.value.select=s.value.select===I?"":I,s.value.clickIdList=[];const a={type:o.type,projectId:o.projectId,tenantId:o.allocationTenantId,supplierIdList:o.type===2?o.memberGroupOrSupperIdList:[],memberGroupIdList:o.type===3?o.memberGroupOrSupperIdList:[]},r=await D.getQuestionnaireClickList(a);s.value.clickIdList=Q(r.data.questionnaireClickInfoList),o.type===2?s.value.clickIdList=s.value.clickIdList.filter(l=>l.peopleType===2):o.type===3&&(s.value.clickIdList=s.value.clickIdList.filter(l=>l.peopleType===1))};function Q(o){return o.reduce((I,a)=>{const{supplierId:r,supplierName:l,projectQuestionnaireClickId:g,surveyStatus:e,price:m,peopleType:T}=a;let v=I.find(L=>L.supplierId===r);return v?v.list.push({projectQuestionnaireClickId:g,surveyStatus:e,price:m}):I.push({supplierId:r,peopleType:T,supplierName:l,list:[{projectQuestionnaireClickId:g,surveyStatus:e,price:m}]}),I},[])}function z(){h.value=!1,s.value={select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]}}function E(){z()}return B({showEdit:V}),(o,I)=>{const a=j("el-text"),r=j("el-button"),l=j("el-empty"),g=j("el-drawer");return y(),f("div",null,[i(g,{modelValue:_(h),"onUpdate:modelValue":I[0]||(I[0]=e=>q(h)?h.value=e:null),title:"详情",size:"60%","before-close":z},{footer:d(()=>[t("div",he,[i(r,{onClick:z},{default:d(()=>[u(" 取消 ")]),_:1}),i(r,{type:"primary",onClick:E},{default:d(()=>[u(" 确定 ")]),_:1})])]),default:d(()=>[t("div",X,[t("div",Y,[t("div",Z,[t("div",null,[i(a,{tag:"b",style:{color:"#333333"}},{default:d(()=>{var e;return[u(n((e=_(s).tenantMeasurementInfoList[0])==null?void 0:e.projectName),1)]}),_:1})]),t("div",null,[i(a,{type:"info",style:{color:"#333333"}},{default:d(()=>{var e;return[u("ID："+n((e=_(s).tenantMeasurementInfoList[0])==null?void 0:e.projectId),1)]}),_:1})])]),(y(!0),f(x,null,N(_(s).tenantMeasurementInfoList,(e,m)=>(y(),f("div",{key:e.allocationTenantId},[t("div",ee,[te,t("div",{class:b({"item box":!0,select:m===_(s).select}),onClick:T=>P(e,m)},[t("div",ne,[t("div",ae,[(e==null?void 0:e.length)>1?(y(),f("p",le,[u(" 已分配数： "),t("span",oe,n(e==null?void 0:e.length),1),t("span",{class:b("type"+e.type)},n(_(k).typeList[e.type-1]),3)])):(y(),f(x,{key:1},[t("p",null,[t("span",ie,n(e.tenantName),1),t("span",{class:b("type"+e.type),style:{"font-size":"14px"}},n(_(k).typeList[e.type-1]),3)]),i(a,{type:"info",style:{color:"#333333"}},{default:d(()=>[u("ID："+n(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",ce,[t("p",re," 项目价: "+n(e.currencyType===1?"$":"￥")+" "+n(e.doMoneyPrice),1),t("p",pe,[u(" 参数: "),i(a,{size:"large"},{default:d(()=>[u(n(e.participationNumber||0),1)]),_:2},1024),i(a,{size:"large"},{default:d(()=>[u(" / ")]),_:1}),i(a,{type:"success",size:"large"},{default:d(()=>[u(n(e.doneNumber||0),1)]),_:2},1024),i(a,{size:"large"},{default:d(()=>[u(" / ")]),_:1}),i(a,{type:"warning",size:"large"},{default:d(()=>[u(n(e.num||0),1)]),_:2},1024),i(a,{size:"large"},{default:d(()=>[u(" / ")]),_:1}),i(a,{size:"large"},{default:d(()=>[u(n(e.limitedQuantity||0),1)]),_:2},1024)])])]),e.totality!=0?(y(),f("div",de,[i(r,{type:"primary",circle:"",size:"small",icon:_(R)},null,8,["icon"])])):G("",!0)],10,se)])]))),128))]),_(s).select!==""?(y(),f("div",ue,[_(s).clickIdList.length?(y(),f("div",_e,[(y(!0),f(x,null,N(_(s).clickIdList,e=>(y(),f("div",ye,[t("div",fe,[t("div",null,[t("span",Ie,n(e.supplierName),1),t("span",{class:b("peopleType"+e.peopleType),style:{"font-size":"14px"}},n(_(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[i(a,{type:"info",style:{color:"#333333"}},{default:d(()=>[u("ID： "+n(e.supplierId),1)]),_:2},1024)])]),t("div",me,[t("ul",null,[(y(!0),f(x,null,N(e.list,m=>(y(),f("li",null,[t("span",ve,n(m.projectQuestionnaireClickId),1),t("span",{class:b("surveyStatus"+m.surveyStatus),style:{"font-size":"14px"}},n(_(k).surveyStatusList[m.surveyStatus-1]),3)]))),256))])])]))),256))])):(y(),f("div",Le,[i(l,{image:_($),"image-size":300},null,8,["image"])]))])):G("",!0)])]),_:1},8,["modelValue"])])}}}),ke=U(ge,[["__scopeId","data-v-7da71380"]]),be=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"}));export{D as a,be as i,ke as o,K as u};
