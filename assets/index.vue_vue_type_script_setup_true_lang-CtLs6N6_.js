
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{ae as M,r as s,d as Z,l as J,n as L,aw as P,E as I,a as d,ap as j,am as G,i as a,o as p,b as S,f as t,w as u,F as A,p as D,e as h}from"./index-mUezZMLI.js";import{a as H}from"./configuration_role-DCchBSzG.js";const K=M("buttonPermission",()=>{const m=s([]);return{role:m,getRole:async()=>{if(m.value.length)return m.value;const{data:v}=await H.list();return v}}}),Q=K,Y=Z({__name:"index",props:["id","row"],setup(m,{expose:R}){const v=s(!1),O=J(),T=Q(),N=s(),U=s(),q=m,b=s(!1),B=s(!1),c=s(),e=s({id:"",email:"",phone:"",name:"",country:"",password:"",role:null,active:!0,type:"phone"}),$=(i,o,r)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?r():r(new Error("请输入合法手机号"))},z=(i,o,r)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?r():r(new Error("请输入合法邮箱"))},F=()=>{e.value.phone.includes("@")?f.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:z,trigger:"blur"}]:f.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:$,trigger:"blur"}]},f=s({password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]});L(async()=>{b.value=!0,U.value=await O.getCountry(),N.value=await T.getRole(),b.value=!1,q.id&&(e.value=JSON.parse(q.row),f.value.password=[],v.value=!0)});const k=i=>{(i!==e.value.phone||i!==e.value.email)&&(B.value=!0)};R({submit(){return new Promise(i=>{e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?c.value&&c.value.validate(o=>{o&&(delete e.value.id,e.value.type==="phone"?delete e.value.email:delete e.value.phone,P.create(e.value).then(()=>{I.success({message:"新增成功",center:!0}),_(),i()}))}):c.value&&c.value.validate(o=>{if(o){const{id:r,phone:n,email:w,password:y,name:E,country:V,active:x,type:g,role:C}=e.value,l={id:r,phone:n,email:w,password:y,name:E,country:V,active:x,type:g,role:C};g==="phone"?(l.email="",delete l.email):(l.phone="",delete l.phone),l.password||delete l.password,B.value||(delete l.phone,delete l.email),P.edit(l).then(()=>{I.success({message:"编辑成功",center:!0}),_(),i()})}})})},onCancel:_});function _(){e.value={}}return(i,o)=>{const r=d("ElInput"),n=d("ElFormItem"),w=d("ElOption"),y=d("ElSelect"),E=d("el-option"),V=d("el-select"),x=d("el-switch"),g=d("ElForm"),C=j("loading");return G((p(),S("div",null,[t(g,{ref_key:"formRef",ref:c,model:a(e),rules:a(f),"label-width":"130px","label-suffix":"："},{default:u(()=>[t(n,{label:"用户名",prop:"name"},{default:u(()=>[t(r,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(n,{label:"国家",prop:"country"},{default:u(()=>[t(y,{modelValue:a(e).country,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).country=l),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:u(()=>[(p(!0),S(A,null,D(a(U),l=>(p(),h(w,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(e).country==="CN"?(p(),h(n,{key:0,label:"手机号",prop:"phone"},{default:u(()=>[t(r,{modelValue:a(e).phone,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).phone=l),placeholder:"请输入手机号",onChange:k,onBlur:F},null,8,["modelValue"])]),_:1})):(p(),h(n,{key:1,label:"邮箱",prop:"email"},{default:u(()=>[t(r,{modelValue:a(e).email,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).email=l),placeholder:"请输入邮箱",onChange:k,onBlur:F},null,8,["modelValue"])]),_:1})),t(n,{label:"密码",prop:"password"},{default:u(()=>[t(r,{disabled:a(v),model:"form.password",placeholder:"需要修改密码时请前往当前账号个人中心"},null,8,["disabled"])]),_:1}),t(n,{label:"角色",prop:"role"},{default:u(()=>[t(V,{modelValue:a(e).role,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).role=l),placeholder:"请选择角色"},{default:u(()=>[(p(!0),S(A,null,D(a(N),l=>(p(),h(E,{key:l.id,label:l.roleName,value:l.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"是否启用",prop:"active"},{default:u(()=>[t(x,{modelValue:a(e).active,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[C,a(b)]])}}});export{Y as _,Q as u};
