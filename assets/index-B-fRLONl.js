
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as H,_ as ge}from"./jiantou-BFtAGxsy.js";import{o as O,s as me}from"./apiLoading-DQtsQngU.js";import{a as Z}from"./projectManagement-dC2-0rpz.js";import{a as Ie}from"./user_cooperation-C-qp-n_8.js";import{a as ve}from"./survey_vip_department-MsKB4uK7.js";import{U as Ae}from"./user_supplier-CcTpOU7f.js";import{u as Se}from"./survey_vipGroup-D5HYBDDC.js";import{d as Le,r as c,n as he,a as I,q as ye,o as g,b as S,f as p,w as s,y as v,g as m,s as be,i as t,e as x,aJ as B,j as h,F as J,t as F,A as je,E as q,aH as _e,aI as ke,L as Ve}from"./index-DpfE-7e2.js";const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAmtJREFUOE+dlTtIXEEUhr9ZFxWfaOEDg6/CxiZWBkEEsbARIqwoJLLXLoEISZdyy3QJRIidd8FANAG1sFJEsDCIQrRRRMyVbCEq4qsQXXficXa9d/eqwUyz7Jkz3/xz5sx/FXcMHYkEqa3tBZ4Dz4CKZFrsOvYLpSZJJMbUwMB55nKVGdC2/QL4ADy5azNPbBel3qpweMybdwtMqvoIvPkHKHN6GMcZVJFIXCZcoG1/AV49EpZKH1KWNXgL1NFoL1p/S4OVlUFLCxQXw8EBrK5CTEp473ipLOur0iMjuSj121N4s6K7G4qK3NUXFzA+DldX9xFjOE6d0tFoGK3ttKycHOjr8y+cnjZqH1KpbXsi2R5uWnk5dHb6ly0twfr6Q8AfStu2HLc2LSs7G7q6oKDADctRp6bg9PQhYEyAl0DQl1VZCR0dEAjA4SGsrEBFhdnk5AQ2NuDc19fx+4HBIPT0mEtYXITWVojHIZEwm8jv7CwcHXm13AD/pL2KwkJoaIDqanPLoqymBkpLYX7eHFkurbERsrJgZsYLdAT4HQjdRkMhyM93k+bmoL0dtrZgbw8uL0FaqK3NAEdHvcBJAcrbdaP9/eZIqbGwAM3NsL8P29umbURtU5PJmJAmSQ6lLJV8w3LTxgykZUpKIC8PcnMNQJTIsc/OoKoKdnagvh6Wl2FzM4XbReu6m7fsU3lXY0hdpW5S1+NjWFszil11feI8XnP4/B9Ok8INK8t6LX8y7Uugj3WcIRznnc++UlslneeTzyz8ZRDreS8O453yOfZNTcWBAgGxNPkEPPX06S7w8zo2ieOMpVR5gX8BZ0fYI9liOMMAAAAASUVORK5CYII=",Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAoBJREFUOE+dlU1IVFEYhp/TDJYiCEYU0VRGiYugSIKgqJsQgVEMEU0xA4UWGCUUREQgTbioRVCkkBtNS4f8CSdq1cImKHCX/aCrspxZTAitJCPHTp577u+MU9i3uZzvO+c97/dz3itYxIy4DBIigiCMZBewxtwmyCAZQ5Bkiv5UXPzMPy7yHUanjAK3EKxb7DKPLwtcTDWIfu8+B9BktZ47wIV/APnDkg7SNKfiIqeTsMzolPcRNC0JzN3cnmoQzQ6g0SUjwGPlKAnA2VqoLIWhcZiY9l9RvRIiW2H6B/S8hVmTFyCJpRpFnzAeyBVIJu3CN+3UB5TN/IJwAualXgcEDByHyjK9Hp6Ae6MOYIY0VcLokqeAbptHyz6o2+Syqn/ksigNwrMoBJbp+MhnaH3lyUASE0anHDbHwzKV0s0DULEcuseg950/5dg2aNyh2V95UVCSIcVQpbvRe0ylpmrp1CevUyo2/9sthROWZBTDOQRB27m6HG7sh1VlkPgAT8b9aPVbNEPVlOsv4duML+VcAeDl3XCoWm9SLA73uUwVM1VD9S1Sw5xKOQ3uq2itgz0b3FvPPIVP3/U6VAEPj7qx11+hZcSXwRcFOAgcs935gLNzkHivO3ukRs+nbQWAkqRKOYqgtxjg+edwcLMGHPgIPX9neFpYyjJpi0E+w5ODkLUKX16ia1iEYZYpqsy37GUZroHatVZTJNx+o2dOmWrGtb36xSgby/qm4IRSHlccumTbkpXGpirpSDWKc2rpl68Qbf+hOO1McalAvuzLLOW566i0byo8C0kGuKoUxrulQLHNmmoFiizIfXhB7rcjrTkVKJUeRZIkbf4CbPFyMP8AN7LhTtHVZc8AAAAASUVORK5CYII=",_=T=>(_e("data-v-94097498"),T=T(),ke(),T),Ue=_(()=>v("span",{class:"icon-class"},[v("img",{src:Ce,alt:"",style:{"margin-right":"0.25rem"}}),m(" 供应商")],-1)),Ee=_(()=>v("img",{src:H,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),xe={key:1},Ne=_(()=>v("span",{class:"icon-class"},[v("img",{src:ge,alt:"",style:{"margin-right":"0.25rem"}}),m(" 调查站")],-1)),Re=_(()=>v("img",{src:H,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),we={key:1},Ke=_(()=>v("span",{class:"icon-class"},[v("img",{src:Te,alt:"",style:{"margin-right":"0.25rem"}}),m(" 合作商")],-1)),Pe=_(()=>v("img",{src:H,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Oe={key:1},Be={style:{flex:"auto"}},He=Le({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(T,{expose:z,emit:D}){const Q=Ae();Se();const Y=D,U=c(!1),k=c(!1),N=c(),y=c(),b=c([]),G={children:"children",label:"name"};c([]);const e=c({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),d=c({projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),f=c({projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),i=c({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),W=c({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]}),R=c([]),E=c();async function $(a,l){if(e.value.list=[{...a}],l==="reassign"){e.value.title="重新分配";const A=await O(Z.getProjectAllocation({projectId:a.projectId}));e.value.form.projectId=a.projectId;const{getProjectAllocationInfoList:j}=A.data;j.forEach(n=>{n.allocationType===2?f.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet}:n.allocationType===3?i.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet}:n.allocationType===4&&(d.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet},E.value=n.groupSupplierIdSet)})}else e.value.title="分配",e.value.form.projectId=a.projectId,d.value.projectId=a.projectId,f.value.projectId=a.projectId,i.value.projectId=a.projectId;e.value.tenantSupplierList=await O(Q.getTenantSupplierList(a.projectId)),e.value.tenantSupplierList.length==f.value.groupSupplierIdList.length?e.value.selectAll.supplier=!0:e.value.selectAll.supplier=!1;const u=await ve.list({name:""});e.value.departmentList=u.data;const L=JSON.parse(JSON.stringify(u.data));R.value=M(L),R.value.length==i.value.groupSupplierIdList.length?e.value.selectAll.member=!0:e.value.selectAll.member=!1;const r=await O(Ie.getAllocationBindList({projectId:a.projectId}));b.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(b.value=e.value.form.groupSupplierIdList),e.value.tenantList=r.data.allocationBindInfoList,e.value.tenantList.length==d.value.groupSupplierIdList.length?e.value.selectAll.tenant=!0:e.value.selectAll.tenant=!1,k.value=!0}const M=a=>a.reduce((l,u)=>{const{children:L,...r}=u;return l.push(r),u.children&&u.children.length>0&&(l=l.concat(M(u.children))),l},[]);function ee(){d.value.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(a=>{d.value.groupSupplierIdList.push(a.beInvitationTenantId)})}function le(){f.value.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(a=>{f.value.groupSupplierIdList.push(a.tenantSupplierId)})}const te=()=>{e.value.tenantSupplierList.length==f.value.groupSupplierIdList.length?e.value.selectAll.supplier=!0:e.value.selectAll.supplier=!1},ae=()=>{e.value.tenantList.length==d.value.groupSupplierIdList.length?e.value.selectAll.tenant=!0:e.value.selectAll.tenant=!1},oe=()=>{i.value.groupSupplierIdList=[],e.value.departmentList.forEach(a=>{X(a)}),y.value.setCheckedKeys(i.value.groupSupplierIdList)};function X(a){i.value.groupSupplierIdList.push(a.id),a.children&&a.children.length&&a.children.forEach(l=>{X(l)})}function se(){i.value.groupSupplierIdList=[],e.value.selectAll.member?(oe(),y.value.setCheckedKeys(i.value.groupSupplierIdList)):(e.value.selectAll.member=!1,i.value.groupSupplierIdList=[],y.value.setCheckedKeys([]))}const ne=(a,l)=>{l?b.value.includes(a.id)||b.value.push(a.id):b.value=b.value.filter(A=>A!==a.id);const u=y.value.getCheckedKeys(),L=y.value.getHalfCheckedKeys(),r=[...u,...L];i.value.groupSupplierIdList=r,R.value.length==r.length?e.value.selectAll.member=!0:e.value.selectAll.member=!1},V=c(!1),C=c(!1),ie=()=>{C.value=!C.value,C.value?V.value=!0:V.value=!1},re=()=>{Object.assign(d.value,{projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),Object.assign(f.value,{projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),Object.assign(i.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.tenant=!1,e.value.selectAll.supplier=!1,e.value.selectAll.member=!1};function w(){N.value.resetFields(),re(),k.value=!1,V.value=!1,C.value=null}function pe(){N.value.validate(async a=>{if(a)try{U.value=!0;let l={addProjectAllocationInfoList:[]};if(d.value.groupSupplierIdList.length&&(d.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(d.value)),f.value.groupSupplierIdList.length&&(f.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(f.value)),i.value.groupSupplierIdList.length&&(i.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(i.value)),e.value.title!=="分配")l.addProjectAllocationInfoList.length||(V.value=!0),l.addProjectAllocationInfoList.map(r=>{r.projectId||(r.projectId=e.value.form.projectId),r.allocationType===4&&(r.deleteSet=[],E.value&&E.value.length&&E.value.filter(A=>{r.groupSupplierIdList.map(j=>{A!==j&&r.deleteSet.push(A)})}))});else if(!l.addProjectAllocationInfoList.length){q.warning({message:"至少选择一个分配目标",center:!0});return}let u="分配成功";V.value&&(u="取消分配成功",l={addProjectAllocationInfoList:[{projectId:e.value.form.projectId,allocationType:5,groupSupplierIdList:[],deleteSet:[]}]});const{status:L}=await me(Z.allocation(l));U.value=!1,L===1&&q.success({message:u,center:!0}),w(),Y("fetch-data")}catch{}finally{U.value=!1}})}const K=a=>{};return he(async()=>{}),z({showEdit:$}),(a,l)=>{const u=I("el-table-column"),L=I("el-table"),r=I("el-checkbox"),A=I("el-option"),j=I("el-select"),n=I("el-form-item"),ue=I("el-tree-select"),P=I("el-button"),ce=I("el-form"),de=I("el-dialog"),fe=ye("loading");return g(),S("div",null,[p(de,{modelValue:t(k),"onUpdate:modelValue":l[10]||(l[10]=o=>je(k)?k.value=o:null),title:t(e).title,width:"700","before-close":w},{footer:s(()=>[v("div",Be,[p(P,{onClick:w},{default:s(()=>[m(" 取消 ")]),_:1}),p(P,{type:"primary",onClick:pe},{default:s(()=>[m(" 确定 ")]),_:1})])]),default:s(()=>[be((g(),x(L,{data:t(e).list,"row-key":"id"},{default:s(()=>[p(u,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),p(u,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),p(u,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[fe,t(U)]]),p(ce,{ref_key:"formRef",ref:N,"label-width":"90px",rules:t(W),model:t(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:s(()=>[p(n,{style:{"margin-top":"1rem"}},{label:s(()=>[Ue]),default:s(()=>[p(j,{modelValue:t(f).groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=o=>t(f).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:"",onChange:te},B({prefix:s(()=>[t(e).tenantSupplierList.length==0?(g(),S("span",{key:0,class:"prefix-class",onClick:l[1]||(l[1]=o=>K("供应商"))},[m(" 请先维护供应商数据 "),Ee])):h("",!0),t(f).groupSupplierIdList.length==0&&t(e).tenantSupplierList.length!=0?(g(),S("span",xe,"请先选择供应商数据")):h("",!0)]),default:s(()=>[(g(!0),S(J,null,F(t(e).tenantSupplierList,o=>(g(),x(A,{label:o.supplierAccord,key:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),128))]),_:2},[t(e).tenantSupplierList.length?{name:"header",fn:s(()=>[p(r,{modelValue:t(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=o=>t(e).selectAll.supplier=o),onChange:le,style:{display:"flex",height:"unset"}},{default:s(()=>[m("全选")]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),p(n,null,{label:s(()=>[Ne]),default:s(()=>[p(ue,{ref_key:"treeRef",ref:y,modelValue:t(i).groupSupplierIdList,"onUpdate:modelValue":l[5]||(l[5]=o=>t(i).groupSupplierIdList=o),data:t(e).departmentList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:G,onCheckChange:ne,"check-strictly":!0,"check-on-click-node":!0,multiple:!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},B({prefix:s(()=>[t(e).departmentList.length==0?(g(),S("span",{key:0,class:"prefix-class",onClick:l[4]||(l[4]=o=>K("调查站"))},[m(" 请先维护调查站数据 "),Re])):h("",!0),!t(i).groupSupplierIdList.length&&t(e).departmentList.length!=0?(g(),S("span",we,"请先选择调查站数据")):h("",!0)]),_:2},[t(e).departmentList.length?{name:"header",fn:s(()=>[p(r,{modelValue:t(e).selectAll.member,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).selectAll.member=o),onChange:se,style:{display:"flex",height:"unset"}},{default:s(()=>[m("全选")]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","data"])]),_:1}),p(n,null,{label:s(()=>[Ke]),default:s(()=>[p(j,{modelValue:t(d).groupSupplierIdList,"onUpdate:modelValue":l[8]||(l[8]=o=>t(d).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:"",onChange:ae},B({prefix:s(()=>[t(e).tenantList.length==0?(g(),S("span",{key:0,class:"prefix-class",onClick:l[7]||(l[7]=o=>K("合作商"))},[m(" 请先维护合作商数据 "),Pe])):h("",!0),t(d).groupSupplierIdList.length==0&&t(e).tenantList.length!=0?(g(),S("span",Oe,"请先选择合作商数据")):h("",!0)]),default:s(()=>[(g(!0),S(J,null,F(t(e).tenantList,o=>(g(),x(A,{label:o.beInvitationTenantName,key:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),128))]),_:2},[t(e).tenantList.length?{name:"header",fn:s(()=>[p(r,{modelValue:t(e).selectAll.tenant,"onUpdate:modelValue":l[6]||(l[6]=o=>t(e).selectAll.tenant=o),onChange:ee,style:{display:"flex",height:"unset"}},{default:s(()=>[m("全选")]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),t(e).title=="重新分配"?(g(),x(n,{key:0},{label:s(()=>[p(P,{type:t(C)?"primary":"",onClick:l[9]||(l[9]=o=>ie()),style:{"border-radius":"1.875rem"}},{default:s(()=>[m(" 取消分配 ")]),_:1},8,["type"])]),_:1})):h("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),Me=Ve(He,[["__scopeId","data-v-94097498"]]),Ye=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));export{Ce as _,Me as a,Te as b,Ye as i};
