
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as L,r as u,a as s,o as k,b as O,f as o,w as t,g as c,i as l,y as v,e as $,j as H,A as M,E as j,_ as G,aH as Q,aI as W,L as X}from"./index-C64c0FPw.js";import{c as b}from"./user_cooperation-BRXaTECP.js";import{u as Y}from"./index-DBDy8-gE.js";import{a as Z}from"./department-CpFRDbuB.js";import"./index-DROGtFSi.js";import"./index-B6n9U-2r.js";const ee=f=>(Q("data-v-23e42aa4"),f=f(),W(),f),re=ee(()=>v("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式",-1)),ae={style:{display:"flex"}},oe=L({__name:"index",emits:["fetch-data"],setup(f,{expose:N,emit:x}){const C=x,m=u(!1),g=u(),e=u({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(r,a,d)=>{if(/^(100|[1-9]?\d)$/.test(a)==!1)return d(new Error("请输入 0 到 100 之间的数字"));d()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),R={children:"children",label:"name"},y=u([]);u();const h=u();async function V(r){e.value.form.chargeUserId="",e.value.form.id=r.id,e.value.form.priceRatio=r.priceRatio,e.value.form.sendProjectType=r.sendProjectType?[r.sendProjectType]:null,e.value.form.receiveProjectType=r.receiveProjectType?[r.receiveProjectType]:null,e.value.form.chargeUserName=r.userName,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserId=r.userId;const a=await Z.list({name:""});a.data&&(y.value=a.data),m.value=!0}const A=(r,a)=>{a?(h.value.getCheckedKeys().forEach(i=>{i!==r.id&&h.value.setChecked(i,!1)}),e.value.form.chargeUserId=r.id,e.value.form.chargeUserName=r.name):(e.value.form.chargeUserId=[e.value.form.chargeUserId].filter(d=>d!==r.id),e.value.form.chargeUserId.length==0&&(e.value.form.chargeUserId="")),e.value.form.chargeUserId||(e.value.form.chargeUserName=""),console.log(e.value.form.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.form.chargeUserId,"data.value.form.chargeUserId")};function _(){m.value=!1,e.value.form={},g.value.resetFields()}const E=u();async function S(r){await b.updateInvitationBindUser({id:e.value.form.id,chargeUserId:r.chargeUserId,invitationType:r.invitationType,chargeUserName:r.chargeUserName,sendProjectType:r.sendProjectType,receiveProjectType:r.receiveProjectType})}async function B(){await b.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio}),j.success({message:"修改成功",center:!0})}async function q(){g.value.validate(r=>{if(r){let a=JSON.parse(JSON.stringify(e.value.form));if(Array.isArray(a.chargeUserId)&&(a.chargeUserId=a.chargeUserId[0]),a.receiveProjectType==1&&!a.chargeUserId){j.warning({message:"请选择部门",center:!0});return}a.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,a.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,a.invitationType=2,a.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",a.chargeUserId=null,a.chargeUserName="",a.invitationType=""),S(a),B(),setTimeout(()=>{C("fetch-data")},1e3),_()}})}const w=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.sendProjectType=[r[r.length-1]])},F=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.receiveProjectType=[r[r.length-1]])};function K(r){e.value.form.chargeUserId=r.chargeUserId,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserName=r.chargeUserName}return N({showEdit:V}),(r,a)=>{const d=s("el-input"),i=s("el-form-item"),U=G,T=s("el-tooltip"),p=s("el-checkbox"),I=s("el-checkbox-group"),z=s("el-tree-select"),D=s("ElForm"),P=s("el-button"),J=s("el-dialog");return k(),O("div",null,[o(J,{modelValue:l(m),"onUpdate:modelValue":a[4]||(a[4]=n=>M(m)?m.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置",class:"hezuoDrawer"},{footer:t(()=>[o(P,{onClick:_},{default:t(()=>[c(" 关闭 ")]),_:1}),o(P,{type:"primary",onClick:q},{default:t(()=>[c(" 确认 ")]),_:1})]),default:t(()=>[o(D,{ref_key:"formRef",ref:g,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"right"},{default:t(()=>[o(i,{label:"价格比例",prop:"priceRatio"},{default:t(()=>[o(d,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":a[0]||(a[0]=n=>l(e).form.priceRatio=n),clearable:""},{append:t(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),o(i,{"label-width":"7rem"},{label:t(()=>[re]),_:1}),o(i,{prop:"sendProjectType","label-width":"7rem"},{label:t(()=>[v("span",null,[o(T,{effect:"dark",content:"",placement:"top-start"},{default:t(()=>[o(U,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:t(()=>[o(I,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":a[1]||(a[1]=n=>l(e).form.sendProjectType=n),onChange:w},{default:t(()=>[o(p,{value:1},{default:t(()=>[c(" 自动 ")]),_:1}),o(p,{value:2},{default:t(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),v("div",ae,[o(i,{prop:"receiveProjectType",style:{"margin-right":"1.5625rem"}},{label:t(()=>[v("span",null,[o(T,{effect:"dark",content:"",placement:"top-start"},{default:t(()=>[o(U,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:t(()=>[o(I,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":a[2]||(a[2]=n=>l(e).form.receiveProjectType=n),onChange:F},{default:t(()=>[o(p,{value:1},{default:t(()=>[c(" 自动 ")]),_:1}),o(p,{value:2},{default:t(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).form.receiveProjectType==1?(k(),$(z,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:h,modelValue:l(e).form.chargeUserId,"onUpdate:modelValue":a[3]||(a[3]=n=>l(e).form.chargeUserId=n),data:l(y),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:R,onCheckChange:A,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):H("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(Y,{ref_key:"userRef",ref:E,onUserData:K},null,512)])}}}),ue=X(oe,[["__scopeId","data-v-23e42aa4"]]);export{ue as default};
