
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Le}from"./index.vue_vue_type_script_setup_true_lang-BzgJzun8.js";import{d as Be,az as De,u as Ke,ae as Ze,r as d,aD as C,F as u,o as Oe,aE as I,ai as z,Q as me,aF as Ge,L as We,j as Y,g as l,w as r,f,a4 as W,aG as j,i as e,s as je,v as He,a3 as h,aH as Je,aI as Qe,b as x,l as Xe,aJ as Ye,h as c,t as m,c as q,ax as ce,k as H,aw as ee,O as ea,P as aa,aK as ta,_ as la,z as ra,an as ge}from"./index-BnVk3aZr.js";import oa from"./agreement-B47M1JOG.js";import na from"./index-CY109EU7.js";import{a as k}from"./register-nb9XcZfU.js";const fe=L=>(Je("data-v-2863662a"),L=L(),Qe(),L),sa=fe(()=>f("div",{class:"bg-banner"},null,-1)),ia={id:"login-box"},ua=fe(()=>f("div",{class:"login-banner"},null,-1)),da={class:"title-container"},pa={class:"fx-c"},ma={class:"flex-bar",style:{width:"100%",margin:"0"}},ca={class:"flex-bar"},ga={key:0,class:"sub-link"},fa={class:"text"},va={class:"sub-link"},ya={class:"text"},ba={class:"title-container"},ha={class:"title"},_a={class:"sub-link"},ve=Be({name:"Login",__name:"login",setup(L){var ue;const J=je(),ye=He(),B=De(),be=Ke(),{t}=Ze();new URL("/assets/login-banner-ZfMZACb6.png",import.meta.url).href,new URL("/assets/logo-CLz_KCqM.png",import.meta.url).href;const ae=d(),te=d(),_=d("login"),E=d(!1),he=d(((ue=J.query.redirect)==null?void 0:ue.toString())??be.settings.home.fullPath),S=d(),w=d("password"),R=d("获取验证码"),D=d(!1),p=d({account:C.local.get("login_account")||"",remember:C.local.has("login_account"),agreeToTheAgreement:!1}),_e=(o,a,s)=>{/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(a)?s():s(new Error(t("app.rightPhone")))},we=(o,a,s)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(p.value.account)?s():s(new Error(t("app.rightEmail")))},T=d({account:[{required:!0,trigger:"blur",message:u(()=>t("app.numberEnter"))}],code:[{required:!0,trigger:"blur",message:u(()=>t("app.captchaEnter"))}],password:[{required:!0,trigger:"blur",message:u(()=>t("app.pwdEnter"))},{min:6,max:18,trigger:"blur",message:u(()=>t("app.6to18"))}],agreeToTheAgreement:[{required:!0,validator:(o,a)=>a===!0,message:u(()=>t("app.readCheck")),trigger:"change"}]}),le=o=>{const a=/(\D+)(\d+)\.(\S+)/,s=o.match(a);return s?s[2]:""};Oe(async()=>{const{data:o}=await k.getTenantConfig();te.value=(o==null?void 0:o.register)!==!1,J.query.isRegister&&J.query.isRegister==="true"&&(_.value="register");const a=await k.getTenantPageTemplate({});ae.value=a.data.isDomain,a.data.isDomain===1&&(B.webName=a.data.webName,B.description=a.data.description,B.keyWords=a.data.keyWords)});const re=()=>{const o=p.value.account;o.includes("@")?T.value.account=[{required:!0,trigger:"blur",message:u(()=>t("app.enterEmail"))},{validator:we,trigger:"blur"}]:/^\d{11}$/.test(o)?T.value.account=[{required:!0,trigger:"blur",message:u(()=>t("app.enterPhone"))},{validator:_e,trigger:"blur"}]:o.trim()!==""?T.value.account=[{required:!0,trigger:"blur",message:u(()=>t("app.enterAccount"))}]:T.value.account=[]},xe=I(async o=>{const{status:a}=await k.sendCode(o);a===1&&(z.success({message:u(()=>t("app.sendSuccess"))}),Ce())},1e3);async function Ve(){S.value.validateField("account",async o=>{if(o){let a;p.value.account.includes("@")?a={email:p.value.account,type:"login_email"}:a={phone:p.value.account,type:"login_phone_number"},R.value=t("app.sending"),await xe(a)}})}const Ce=()=>{D.value=!0;let o=60;v.value=setInterval(()=>{o>0?(o--,R.value=`${t("app.please")}${o}${t("app.getAgain")}`):(clearInterval(v.value),R.value="获取验证码",v.value=null,D.value=!1)},1e3)},Q=I(()=>{S.value&&S.value.validate(o=>{if(o){let a={...p.value};w.value==="password"?a.type=1:p.value.account.includes("@")?a.type=3:a.type=2;const s=window.location.href;le(s)&&(a.tenantId=le(s)),E.value=!0,B.login(a).then(()=>{E.value=!1,p.value.remember?C.local.set("login_account",p.value.account):C.local.remove("login_account"),ye.push(he.value)}).catch(()=>{E.value=!1})}})},500),v=d(null),A=d("获取验证码"),K=d(!1),N=d(),oe=d([]),i=d({name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",agreeToTheAgreement:!1,companyType:"company",companyName:"",legalPersonName:"",taxID:""}),ke=(o,a,s)=>{/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(i.value.phoneNumber)?s():s(new Error(t("app.rightPhone")))},Ee=(o,a,s)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i.value.email)?s():s(new Error(t("app.rightEmail")))},Te=d({account:[{required:!0,trigger:"blur",message:u(()=>t("app.enterAccount"))}],companyName:[{required:!0,trigger:"blur",message:u(()=>t("app.companyName"))}],companyType:[{required:!0,trigger:"change",message:u(()=>t("app.accountType"))}],legalPersonName:[{required:!0,trigger:"blur",message:u(()=>t("app.enterLegalPerson"))}],email:[{required:!0,trigger:"blur",message:u(()=>t("app.enterEmail"))},{validator:Ee,trigger:"blur"}],phoneNumber:[{required:!0,trigger:"blur",message:u(()=>t("app.enterPhone"))},{validator:ke,trigger:"blur"}],code:[{required:!0,trigger:"blur",message:u(()=>t("app.captchaEnter"))}],country:[{required:!0,trigger:"change",message:u(()=>t("app.areaSelect"))}],name:[{required:!0,trigger:"blur",message:u(()=>t("app.enterAccount"))}],password:[{required:!0,trigger:"blur",message:u(()=>t("app.pwdEnter"))},{min:6,max:18,trigger:"blur",message:u(()=>t("app.6to18"))}],isInvitation:[{required:!0,trigger:"blur",message:u(()=>t("app.cooperationOfferSelect"))}],agreeToTheAgreement:[{required:!0,validator:(o,a)=>a===!0,message:u(()=>t("app.readCheck")),trigger:"change"}]}),ne=I(async o=>{const{status:a}=await k.sendCode(o);a===1&&(z.success({message:u(()=>t("app.sendSuccess"))}),Ne())},1e3),Ae=async()=>{const o=await N.value.validateField("country");N.value.validateField(i.value.country==="CN"?"phoneNumber":"email",async a=>{if(a&&o){const s={type:"register_phone_number",email:i.value.email,phone:i.value.phoneNumber,countryCode:i.value.country};i.value.country==="CN"?(A.value="正在发送验证码",await ne(s)):(s.type="register_email",A.value="正在发送验证码",await ne(s))}})},Ne=()=>{K.value=!0;let o=60;v.value=setInterval(()=>{o>0?(o--,A.value=`${t("app.please")}${o}${t("app.getAgain")}`):(clearInterval(v.value),A.value="获取验证码",v.value=null,K.value=!1)},1e3)},Pe=I(async()=>{N.value&&N.value.validate(async o=>{if(o){i.value.type=i.value.country==="CN"?"phone":"email",i.value.type==="phone"?delete i.value.email:delete i.value.phoneNumber,delete i.value.agreeToTheAgreement;const{status:a}=await k.register(i.value);a===1&&(z.success({message:u(()=>t("app.signInSuccess"))}),_.value="login",w.value="password"),me(()=>{p.value.account=i.value.email||i.value.phoneNumber})}})},500),V=d(null),F=d(),U=d("获取验证码"),Z=d(!1),y=d({info:C.local.get("login_account"),code:"",newPassword:""}),Ie=(o,a,s)=>{/[\s\u4e00-\u9fa5]/.test(a)?s(new Error("密码中带有空格或汉字")):s()},qe=d({info:[{required:!0,trigger:"blur",message:u(()=>t("app.enterAccount"))}],code:[{required:!0,trigger:"blur",message:u(()=>t("app.captchaEnter"))}],newPassword:[{required:!0,trigger:"blur",message:u(()=>t("app.newPwdEnter"))},{min:6,max:18,trigger:"blur",message:u(()=>t("app.6to18"))},{validator:Ie,trigger:"blur"}]}),Se=I(()=>{F.value.validateField(y.value.info?"":"info",async o=>{if(o){U.value="正在发送验证码";const{status:a}=await k.forgetCode({info:y.value.info});a===1&&(z.success({message:u(()=>t("app.sendSuccess"))}),Fe())}})},1e3),Re=I(()=>{F.value&&F.value.validate(async o=>{if(o){const{status:a}=await k.updatePassword(y.value);a===1&&(z.success({message:u(()=>t("app.changeSuccess"))}),_.value="login",me(()=>{p.value.account=y.value.info}))}})},500),Fe=()=>{Z.value=!0;let o=60;V.value=setInterval(()=>{o>0?(o--,U.value=`请在${o}s后重新获取`):(clearInterval(V.value),U.value="获取验证码",V.value=null,Z.value=!1)},1e3)};Ge(()=>{clearInterval(v.value),v.value=null,clearInterval(V.value),V.value=null});const se=()=>{T.value.account=[{required:!0,trigger:"blur",message:u(()=>t("app.numberEnter"))}],p.value.code="",S.value.resetFields()};We(()=>_.value,async o=>{switch(o){case"login":se(),clearInterval(v.value),R.value=t("app.getCaptcha"),v.value=null,D.value=!1,p.value={account:C.local.get("login_account")||"",remember:C.local.has("login_account"),agreeToTheAgreement:!1};break;case"register":N.value.resetFields(),clearInterval(v.value),A.value=t("app.getCaptcha"),v.value=null,K.value=!1,i.value.agreeToTheAgreement=!1,i.value={name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",agreeToTheAgreement:!1};break;case"reset":F.value.resetFields(),clearInterval(V.value),U.value="获取验证码",V.value=null,Z.value=!1,y.value={info:"",newPassword:"",code:""};break}if(o==="register"){const a=await ta.itemlist({page:1,limit:-1,id:"32"});oe.value=a.data.records}});const ie=d(),O=o=>{ie.value.showEdit(o)};return(o,a)=>{const s=la,P=Le,de=h("el-radio-button"),Ue=h("el-radio-group"),$=h("el-button"),b=h("ElInput"),g=h("ElFormItem"),X=h("ElCheckbox"),G=h("ElLink"),M=h("ElButton"),$e=h("el-form"),Me=h("ElOption"),ze=h("ElSelect"),pe=h("ElForm");return x(),Y("div",null,[sa,l(P,{placement:"bottom-end",class:"i18n-selector"},{default:r(()=>[l(s,{name:"i-ri:translate"})]),_:1}),f("div",ia,[ua,W(l($e,{ref_key:"loginFormRef",ref:S,model:e(p),rules:e(T),class:"login-form","validate-on-rule-change":!1},{default:r(()=>[f("div",da,[f("div",pa,[l(Ue,{modelValue:e(w),"onUpdate:modelValue":a[0]||(a[0]=n=>Xe(w)?w.value=n:null),size:"large",onChange:se},{default:r(()=>[l(de,{label:"密码登录",value:"password"}),l(de,{label:"验证码登录",value:"code"})]),_:1},8,["modelValue"])])]),f("div",null,[l(g,{prop:"account"},{default:r(()=>[l(b,{modelValue:e(p).account,"onUpdate:modelValue":a[1]||(a[1]=n=>e(p).account=n),modelModifiers:{trim:!0},placeholder:e(t)("app.account"),type:"text",tabindex:"1",onBlur:re},Ye({prefix:r(()=>[l(s,{name:"i-ri:user-3-fill"})]),_:2},[e(w)==="code"?{name:"append",fn:r(()=>[l($,{type:"primary",disabled:e(D),onClick:Ve},{default:r(()=>[c(m(e(R)),1)]),_:1},8,["disabled"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),e(w)==="password"?(x(),q(g,{key:0,prop:"password"},{default:r(()=>[l(b,{modelValue:e(p).password,"onUpdate:modelValue":a[2]||(a[2]=n=>e(p).password=n),modelModifiers:{trim:!0},type:"password",placeholder:e(t)("app.password"),tabindex:"2",autocomplete:"new-password","show-password":"",onKeyup:ce(e(Q),["enter"])},{prefix:r(()=>[l(s,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):H("",!0),e(w)==="code"?(x(),q(g,{key:1,prop:"code"},{default:r(()=>[l(b,{modelValue:e(p).code,"onUpdate:modelValue":a[3]||(a[3]=n=>e(p).code=n),modelModifiers:{trim:!0},type:"text",placeholder:e(t)("app.captcha"),tabindex:"2",onKeyup:ce(e(Q),["enter"])},{prefix:r(()=>[l(s,{name:"i-ep:message"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):H("",!0),l(g,{prop:"agreeToTheAgreement",style:{"margin-bottom":"0.5rem"}},{default:r(()=>[f("div",ma,[l(X,{modelValue:e(p).agreeToTheAgreement,"onUpdate:modelValue":a[6]||(a[6]=n=>e(p).agreeToTheAgreement=n),tabindex:"3"},{default:r(()=>[c(m(e(t)("app.readAgree"))+" ",1),l($,{type:"primary",size:"default",link:"",onClick:a[4]||(a[4]=n=>O(1))},{default:r(()=>[c(m(e(t)("app.vipAgreement")),1)]),_:1}),c(m(e(t)("app.and")),1),l($,{type:"primary",size:"default",link:"",onClick:a[5]||(a[5]=n=>O(2))},{default:r(()=>[c(m(e(t)("app.serviceAgreement")),1)]),_:1})]),_:1},8,["modelValue"])])]),_:1}),l(g,null,{default:r(()=>[f("div",ca,[l(X,{modelValue:e(p).remember,"onUpdate:modelValue":a[7]||(a[7]=n=>e(p).remember=n),tabindex:"4"},{default:r(()=>[c(m(e(t)("app.keepLogin")),1)]),_:1},8,["modelValue"]),e(w)==="password"?(x(),q(G,{key:0,type:"primary",underline:!1,onClick:a[8]||(a[8]=n=>_.value="reset")},{default:r(()=>[c(m(e(t)("app.forgetPassword")),1)]),_:1})):H("",!0)])]),_:1})]),l(M,{loading:e(E),type:"primary",size:"large",style:{width:"100%"},onClick:ee(e(Q),["prevent"]),tabindex:"5"},{default:r(()=>[c(m(e(t)("app.login")),1)]),_:1},8,["loading","onClick"]),e(ae)!==1?W((x(),Y("div",ga,[f("span",fa,m(e(t)("app.notMember")),1),l(G,{type:"primary",underline:!1,onClick:a[9]||(a[9]=n=>_.value="register")},{default:r(()=>[c(m(e(t)("app.register")),1)]),_:1})],512)),[[j,e(te)]]):H("",!0)]),_:1},8,["model","rules"]),[[j,e(_)==="login"]]),W(l(pe,{ref_key:"registerFormRef",ref:N,model:e(i),rules:e(Te),class:"login-form","auto-complete":"on"},{default:r(()=>[f("div",null,[l(g,{prop:"companyName"},{default:r(()=>[l(b,{modelValue:e(i).companyName,"onUpdate:modelValue":a[10]||(a[10]=n=>e(i).companyName=n),modelModifiers:{trim:!0},placeholder:e(t)("app.CompanyName"),tabindex:"1"},{prefix:r(()=>[l(s,{name:"i-mdi:greenhouse"})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(g,{prop:"name"},{default:r(()=>[l(b,{modelValue:e(i).name,"onUpdate:modelValue":a[11]||(a[11]=n=>e(i).name=n),modelModifiers:{trim:!0},placeholder:e(t)("app.Username"),tabindex:"2"},{prefix:r(()=>[l(s,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(g,{prop:"country"},{default:r(()=>[l(ze,{modelValue:e(i).country,"onUpdate:modelValue":a[12]||(a[12]=n=>e(i).country=n),placeholder:e(t)("app.Area"),clearable:"",filterable:"",tabindex:"3"},{prefix:r(()=>[l(s,{name:"i-mdi:format-list-bulleted-type"})]),default:r(()=>[(x(!0),Y(ea,null,aa(e(oe),n=>(x(),q(Me,{label:n.chineseName,value:n.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])]),_:1}),e(i).country==="CN"?(x(),q(g,{key:0,prop:"phoneNumber"},{default:r(()=>[l(b,{modelValue:e(i).phoneNumber,"onUpdate:modelValue":a[13]||(a[13]=n=>e(i).phoneNumber=n),modelModifiers:{trim:!0},placeholder:e(t)("app.PhoneNumber"),tabindex:"4"},{prefix:r(()=>[l(s,{name:"i-ant-design:phone-outlined"})]),_:1},8,["modelValue","placeholder"])]),_:1})):(x(),q(g,{key:1,prop:"email"},{default:r(()=>[l(b,{modelValue:e(i).email,"onUpdate:modelValue":a[14]||(a[14]=n=>e(i).email=n),modelModifiers:{trim:!0},placeholder:e(t)("app.Email"),tabindex:"4"},{prefix:r(()=>[l(s,{name:"i-mdi:email"})]),_:1},8,["modelValue","placeholder"])]),_:1})),l(g,{prop:"code"},{default:r(()=>[l(b,{modelValue:e(i).code,"onUpdate:modelValue":a[15]||(a[15]=n=>e(i).code=n),modelModifiers:{trim:!0},placeholder:e(t)("app.captcha"),tabindex:"5"},{prefix:r(()=>[l(s,{name:"i-ic:baseline-verified-user"})]),append:r(()=>[l(M,{disabled:e(K),onClick:Ae},{default:r(()=>[c(m(e(A)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","placeholder"])]),_:1}),l(g,{prop:"password"},{default:r(()=>[l(b,{modelValue:e(i).password,"onUpdate:modelValue":a[16]||(a[16]=n=>e(i).password=n),modelModifiers:{trim:!0},type:"password",placeholder:e(t)("app.password"),tabindex:"6","show-password":""},{prefix:r(()=>[l(s,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(g,{prop:"agreeToTheAgreement"},{default:r(()=>[l(X,{modelValue:e(i).agreeToTheAgreement,"onUpdate:modelValue":a[19]||(a[19]=n=>e(i).agreeToTheAgreement=n),tabindex:"8"},{default:r(()=>[c(m(e(t)("app.readAgree"))+" ",1),l($,{type:"primary",size:"default",link:"",onClick:a[17]||(a[17]=n=>O(1))},{default:r(()=>[c(m(e(t)("app.vipAgreement")),1)]),_:1}),c(m(e(t)("app.and")),1),l($,{type:"primary",size:"default",link:"",onClick:a[18]||(a[18]=n=>O(2))},{default:r(()=>[c(m(e(t)("app.serviceAgreement")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(M,{tabindex:"9",loading:e(E),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:ee(e(Pe),["prevent"])},{default:r(()=>[c(m(e(t)("app.Register")),1)]),_:1},8,["loading","onClick"]),f("div",va,[f("span",ya,m(e(t)("app.haveAccount")),1),l(G,{type:"primary",underline:!1,onClick:a[20]||(a[20]=n=>_.value="login")},{default:r(()=>[c(m(e(t)("app.toLogin")),1)]),_:1})])]),_:1},8,["model","rules"]),[[j,e(_)==="register"]]),W(l(pe,{ref_key:"resetFormRef",ref:F,model:e(y),rules:e(qe),class:"login-form"},{default:r(()=>[f("div",ba,[f("h3",ha,m(e(t)("app.forgetPassword"))+" 🔒",1)]),f("div",null,[l(g,{prop:"info"},{default:r(()=>[l(b,{modelValue:e(y).info,"onUpdate:modelValue":a[21]||(a[21]=n=>e(y).info=n),modelModifiers:{trim:!0},placeholder:e(t)("app.account"),type:"text",tabindex:"1",onBlur:re},{prefix:r(()=>[l(s,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(g,{prop:"code"},{default:r(()=>[l(b,{modelValue:e(y).code,"onUpdate:modelValue":a[22]||(a[22]=n=>e(y).code=n),modelModifiers:{trim:!0},placeholder:e(t)("app.captcha"),type:"text",tabindex:"2"},{prefix:r(()=>[l(s,{name:"i-ic:baseline-verified-user"})]),append:r(()=>[l(M,{disabled:e(Z),onClick:e(Se)},{default:r(()=>[c(m(e(U)),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue","placeholder"])]),_:1}),l(g,{prop:"newPassword"},{default:r(()=>[l(b,{modelValue:e(y).newPassword,"onUpdate:modelValue":a[23]||(a[23]=n=>e(y).newPassword=n),modelModifiers:{trim:!0},type:"password",placeholder:e(t)("app.newPassword"),tabindex:"3","show-password":""},{prefix:r(()=>[l(s,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1})]),l(M,{loading:e(E),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:ee(e(Re),["prevent"])},{default:r(()=>[c(m(e(t)("app.check")),1)]),_:1},8,["loading","onClick"]),f("div",_a,[l(G,{type:"primary",underline:!1,onClick:a[24]||(a[24]=n=>_.value="login")},{default:r(()=>[c(m(e(t)("app.goLogin")),1)]),_:1})])]),_:1},8,["model","rules"]),[[j,e(_)==="reset"]])]),l(na),l(oa,{ref_key:"agreementRef",ref:ie},null,512)])}}});typeof ge=="function"&&ge(ve);const Ea=ra(ve,[["__scopeId","data-v-2863662a"]]);export{Ea as default};
