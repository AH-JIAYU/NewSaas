
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as G,r as d,c as H,a as s,o as i,b as f,f as o,w as n,g as c,i as l,F as Q,t as W,e as p,y as h,z as b,j as _,A as X,E as I,_ as Y,aE as Z,L as ee}from"./index-BEO6Civ3.js";import{c as L}from"./user_cooperation-CDeLxu1G.js";import{u as te}from"./index-Cs5p42li.js";import"./index-CC9qcoXf.js";import"./index-DYjRmm1G.js";import"./department-BBTmsQz7.js";const ae={style:{float:"left"}},oe={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"0.8125rem"}},ne={key:0},re={key:1},le={key:3,style:{display:"flex"},class:"inviteDialog"},se=G({__name:"index",emits:["fetch-data"],setup(ie,{expose:E,emit:R}){const D=R,u=d(!1);d("");const T=d(),e=d({form:{},tenantUserList:[],tenantStaffList:[],chargeUserId:null,departmentId:null,chargeUserName:"",rules:{beInvitationTenantId:[{required:!0,message:"请选择合作商",trigger:"change"}],priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}});async function S(){await q(),u.value=!0}async function q(){const t=await L.getTenantUserList({});e.value.tenantUserList=t.data.tenantUserInfoList}const U=H(()=>{const t=e.value.tenantUserList.find(a=>a.tenantId===e.value.form.beInvitationTenantId);return t?(e.value.form.tenantName=t.name,e.value.form.phoneOrEmail=Z.local.get("account"),[t]):[]});function k(){u.value=!1,e.value.form={},T.value.resetFields()}async function w(){T.value.validate(t=>{if(t){let a=JSON.parse(JSON.stringify(e.value.form));if(a.receiveProjectType==1&&!a.chargeUserId){I.warning({message:"请选择接收项目负责人",center:!0});return}a.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,a.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,a.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",e.value.form.invitationType="",a.chargeUserId=null,a.chargeUserName="",a.invitationType=""),L.addInvitationBind(a).then(v=>{v.status==-1?I.success({message:v.error,center:!0}):(I.success({message:"发送成功",center:!0}),D("fetch-data"),k())})}})}E({showEdit:S});const j=d();function A(){let t={chargeUserId:e.value.form.chargeUserId,invitationType:e.value.form.invitationType,chargeUserName:e.value.form.chargeUserName};j.value.showEdit(t,"请选择负责部门/人")}function B(t){e.value.form.chargeUserId=t.chargeUserId,e.value.form.invitationType=t.invitationType,e.value.form.chargeUserName=t.chargeUserName}const F=t=>{Array.isArray(t)&&t.length>1&&(e.value.form.sendProjectType=[t[t.length-1]])},O=t=>{Array.isArray(t)&&t.length>1&&(e.value.form.receiveProjectType=[t[t.length-1]])},z=t=>{t.preventDefault()};return(t,a)=>{const v=s("el-option"),J=s("el-select"),m=s("el-form-item"),g=s("el-table-column"),K=s("el-table"),P=s("el-input"),N=Y,x=s("el-tooltip"),y=s("el-checkbox"),V=s("el-checkbox-group"),M=s("ElForm"),C=s("el-button"),$=s("el-dialog");return i(),f("div",null,[o($,{modelValue:l(u),"onUpdate:modelValue":a[5]||(a[5]=r=>X(u)?u.value=r:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"邀约公司"},{footer:n(()=>[o(C,{onClick:k},{default:n(()=>[c(" 关闭 ")]),_:1}),o(C,{type:"primary",onClick:w},{default:n(()=>[c(" 发送邀约 ")]),_:1})]),default:n(()=>[o(M,{ref_key:"formRef",ref:T,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left"},{default:n(()=>[o(m,{label:"公司名称",prop:"beInvitationTenantId"},{default:n(()=>[o(J,{modelValue:l(e).form.beInvitationTenantId,"onUpdate:modelValue":a[0]||(a[0]=r=>l(e).form.beInvitationTenantId=r),clearable:""},{default:n(()=>[(i(!0),f(Q,null,W(l(e).tenantUserList,r=>(i(),p(v,{key:r.tenantId,value:r.tenantId,label:r.tenantName},{default:n(()=>[h("span",ae,b(r.tenantName),1),h("span",oe,b(r.tenantId),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(U).length?(i(),p(K,{key:0,data:l(U),border:"",stripe:"",style:{"margin-bottom":"18px"}},{default:n(()=>[o(g,{prop:"name",label:"用户名"}),o(g,{prop:"tenantName",label:"公司名称"}),o(g,{prop:"country",label:"区域"}),o(g,{label:"电子邮箱/手机号"},{default:n(({row:r})=>[r.phone?(i(),f("span",ne,b(r.phone),1)):(i(),f("span",re,b(r.email),1))]),_:1})]),_:1},8,["data"])):_("",!0),l(e).form.beInvitationTenantId?(i(),p(m,{key:1,label:"价格比例",prop:"priceRatio"},{default:n(()=>[o(P,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":a[1]||(a[1]=r=>l(e).form.priceRatio=r),clearable:""},{append:n(()=>[c("%")]),_:1},8,["modelValue"])]),_:1})):_("",!0),l(e).form.beInvitationTenantId?(i(),p(m,{key:2,label:"项目分配方式","label-width":"7rem"})):_("",!0),l(e).form.beInvitationTenantId?(i(),f("div",le,[o(m,{prop:"sendProjectType","label-width":"7rem"},{label:n(()=>[h("span",null,[o(x,{effect:"dark",content:"1111111",placement:"top-start"},{default:n(()=>[o(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:n(()=>[o(V,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":a[2]||(a[2]=r=>l(e).form.sendProjectType=r),onChange:F},{default:n(()=>[o(y,{value:1},{default:n(()=>[c(" 自动 ")]),_:1}),o(y,{value:2},{default:n(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(m,{prop:"receiveProjectType",style:{"margin-left":"40px"}},{label:n(()=>[h("span",null,[o(x,{effect:"dark",content:"1111111",placement:"top-start"},{default:n(()=>[o(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:n(()=>[o(V,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":a[3]||(a[3]=r=>l(e).form.receiveProjectType=r),onChange:O},{default:n(()=>[o(y,{value:1},{default:n(()=>[c(" 自动 ")]),_:1}),o(y,{value:2},{default:n(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):_("",!0),l(e).form.receiveProjectType&&l(e).form.receiveProjectType[0]==1?(i(),p(P,{key:4,placeholder:"请选择接收项目负责人",onKeydown:z,onClick:A,modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":a[4]||(a[4]=r=>l(e).form.chargeUserName=r)},null,8,["modelValue"])):_("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(te,{ref_key:"userRef",ref:j,onUserData:B},null,512)])}}}),_e=ee(se,[["__scopeId","data-v-49b4b234"]]);export{_e as default};
