
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as g,d as U,r as v,n as z,E as S,a as u,q as C,s as j,i as a,o as f,b as p,f as l,w as n,g as M,F as _,t as B,e as R,y as $,z as y,L as q}from"./index-B5ofkhVZ.js";const L={list:s=>g.post("bill/getMemberBillList",s),create:s=>g.post("bill/addMemberSettlement",s),getMemberBillAvailableBalance:s=>g.post("bill/getMemberBillAvailableBalance",s),changestatus:s=>g.post("bill/updateMemberBill",s)},O=U({__name:"index",props:{id:{default:""}},setup(s,{expose:V}){const i=v(!1),A=v(),e=v({minimumAmount:"",settlementType:1,settlementAmount:"",addMemberSettlementInfoList:[]}),b=v({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),h=v({settlementAmount:[{required:!0,message:"请输入正数，且最多两位小数",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入有效的正数，且最多两位小数",trigger:"blur"}]}),E=async()=>{try{i.value=!0;const r=await L.getMemberBillAvailableBalance({});r.data&&(b.value.memberSettlementInfoList=r.data.memberBillAvailableBalanceInfoList,e.value.minimumAmount=r.data.minimumAmount),i.value=!1}catch{}finally{i.value=!1}},x=r=>{e.value.addMemberSettlementInfoList=[];const o=b.value.memberSettlementInfoList.filter(m=>r.includes(m.id));for(let m=0;m<o.length;m++)e.value.addMemberSettlementInfoList.push(o[m])};return z(async()=>{await E()}),V({submit(){return new Promise(r=>{A.value&&A.value.validate(o=>{const m=e.value.addMemberSettlementInfoList.every(d=>typeof d.settlementAmount=="number"&&d.settlementAmount>=e.value.minimumAmount);if(e.value.settlementType===2){for(let d of e.value.addMemberSettlementInfoList)if(d.settlementAmount<=0){S.warning({message:"结算金额需要输入正数",center:!0});return}e.value.settlementAmount=""}else e.value.addMemberSettlementInfoList=[];if(o)if(m&&e.value.settlementAmount>=e.value.minimumAmount)try{i.value=!0,L.create(e.value).then(()=>{i.value=!1,S.success({message:"新增成功",center:!0}),r()})}catch{}finally{i.value=!1}else S.warning({message:"“结算金额”小于“最低结算金额”",center:!0})})})}}),(r,o)=>{const m=u("el-radio"),d=u("el-radio-group"),c=u("ElFormItem"),I=u("ElInput"),w=u("el-option"),k=u("el-select"),F=u("ElInputNumber"),N=u("ElForm"),T=C("loading");return j((f(),p("div",null,[l(N,{ref_key:"formRef",ref:A,model:a(e),rules:a(h),"label-width":"9rem"},{default:n(()=>[l(c,{label:"结算方式"},{default:n(()=>[l(d,{modelValue:a(e).settlementType,"onUpdate:modelValue":o[0]||(o[0]=t=>a(e).settlementType=t)},{default:n(()=>[l(m,{value:1,size:"large"},{default:n(()=>[M(" 全部结算 ")]),_:1}),l(m,{value:2,size:"large"},{default:n(()=>[M(" 指定结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(e).settlementType===1?(f(),p(_,{key:0},[l(c,{label:"最低结算额度"},{default:n(()=>[l(I,{disabled:"",placeholder:"",value:a(e).minimumAmount},null,8,["value"])]),_:1}),l(c,{label:"结算金额",prop:"settlementAmount"},{default:n(()=>[l(I,{modelValue:a(e).settlementAmount,"onUpdate:modelValue":o[1]||(o[1]=t=>a(e).settlementAmount=t),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(f(),p(_,{key:1},[l(c,{label:"指定会员"},{default:n(()=>[l(k,{placeholder:"Select",modelValue:a(b).memberSettlementInfoSelect,"onUpdate:modelValue":o[2]||(o[2]=t=>a(b).memberSettlementInfoSelect=t),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:x},{default:n(()=>[(f(!0),p(_,null,B(a(b).memberSettlementInfoList,t=>(f(),R(w,{key:t.id,value:t.id,label:t.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"最低结算额度"},{default:n(()=>[l(I,{disabled:"",placeholder:"",value:a(e).minimumAmount},null,8,["value"])]),_:1}),(f(!0),p(_,null,B(a(e).addMemberSettlementInfoList,t=>(f(),p(_,null,[l(c,{label:""},{default:n(()=>[$("p",null,y(t.memberId)+" - "+y(t.memberName)+" - 可用余额："+y(t.availableBalance),1)]),_:2},1024),l(c,{label:"结算金额"},{default:n(()=>[l(F,{"controls-position":"right",modelValue:t.settlementAmount,"onUpdate:modelValue":D=>t.settlementAmount=D,max:t.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[T,a(i)]])}}}),P=q(O,[["__scopeId","data-v-7445174b"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"}));export{P as D,L as a,H as i};
