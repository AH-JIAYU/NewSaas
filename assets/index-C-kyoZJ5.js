
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as H,s as M}from"./apiLoading-DiALs-Sk.js";import{a as U}from"./projectManagement-C6f9_rDT.js";import{a as F}from"./survey_vip_department-CEEaLWlV.js";import{u as P}from"./survey_vipGroup-DSFwKbsE.js";import{d as Q,r as s,n as J,a as i,q as W,o as c,b as X,f as n,w as t,y as Y,g as u,s as Z,e as m,z as S,i as l,j as L,A as $,E as ee,L as te}from"./index-BaoGh0WK.js";import"./survey_vipGroup-BvC1-c8B.js";const le={style:{flex:"auto"}},oe=Q({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(ae,{expose:C,emit:V}){const j=P(),g=s([]),v=s(),d=s([]),T={children:"children",label:"name"},N=V,p=s(!1),y=s(),e=s({list:[],title:null,vipGroupList:[],form:{projectId:"",allocationType:3,groupSupplierIdList:[]},selectAll:{member:!1}}),E=s({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择至少一项"}]});async function R(o,a){e.value.list=[{...o}],e.value.form.projectId=o.projectId,e.value.vipGroupList=await H(j.getGroupNameList()),a==="reassign"?e.value.title="重新分配":e.value.title="分配",p.value=!0}function h(){y.value.resetFields(),Object.assign(e.value.form,{projectId:"",groupSupplierIdList:[]}),p.value=!1,Object.assign(I.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.member=!1}const I=s({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),G=(o,a)=>{a?d.value.includes(o.id)||d.value.push(o.id):d.value=d.value.filter(k=>k!==o.id);const f=v.value.getCheckedKeys(),b=v.value.getHalfCheckedKeys(),_=[...f,...b];I.value.groupSupplierIdList=_};function z(){y.value.validate(async o=>{if(o){const{status:a}=await M(U.allocation(e.value.form));a===1&&ee.success({message:"分配成功",center:!0}),h(),N("fetch-data")}})}function A(){e.value.form.groupSupplierIdList=[]}return J(async()=>{const o=await F.list({name:""});o.data&&(g.value=o.data)}),s(!1),s(null),C({showEdit:R}),(o,a)=>{const f=i("el-table-column"),b=i("el-table"),_=i("el-radio"),k=i("el-radio-group"),w=i("el-form-item"),B=i("el-tree"),K=i("el-text"),O=i("el-form"),x=i("el-button"),q=i("el-dialog"),D=W("loading");return c(),X("div",null,[n(q,{modelValue:l(p),"onUpdate:modelValue":a[1]||(a[1]=r=>$(p)?p.value=r:null),title:l(e).title,width:"700","before-close":h},{footer:t(()=>[Y("div",le,[n(x,{onClick:h},{default:t(()=>[u(" 取消 ")]),_:1}),n(x,{type:"primary",onClick:z},{default:t(()=>[u(" 确定 ")]),_:1})])]),default:t(()=>[Z((c(),m(b,{data:l(e).list,"row-key":"id"},{default:t(()=>[n(f,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),n(f,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"projectName"}),n(f,{align:"left","show-overflow-tooltip":"",label:"配额/限量",prop:"name"},{default:t(({row:r})=>[u(S(r.limitedQuantity||0)+"/ "+S(r.num||0),1)]),_:1})]),_:1},8,["data"])),[[D,!1]]),n(O,{ref_key:"formRef",ref:y,"label-width":"6rem",rules:l(E),model:l(e).form,inline:!1,style:{"margin-top":"1.25rem"}},{default:t(()=>[n(w,{label:"分配目标"},{default:t(()=>[n(k,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=r=>l(e).form.allocationType=r),class:"ml-4",onChange:A},{default:t(()=>[n(_,{value:3,size:"large"},{default:t(()=>[u(" 部门 ")]),_:1}),l(e).title==="重新分配"?(c(),m(_,{key:0,value:5,size:"large"},{default:t(()=>[u(" 取消分配 ")]),_:1})):L("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===3&&l(e).form.allocationType!==5?(c(),m(w,{key:0,label:"部门",prop:""},{default:t(()=>[l(g).length>0?(c(),m(B,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:v,data:l(g),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":l(d),"default-expand-all":"",props:T,onCheckChange:G},null,8,["data","default-checked-keys"])):(c(),m(K,{key:1},{default:t(()=>[u("暂无数据")]),_:1}))]),_:1})):L("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),de=te(oe,[["__scopeId","data-v-114140f0"]]);export{de as default};
