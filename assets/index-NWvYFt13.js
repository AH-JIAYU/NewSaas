
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as b,ag as P,d as Q,r as x,a as T,o as I,b as y,f as a,w as u,s as t,g as l,H as o,i as _,F as j,t as O,S,bp as E,j as $,I as A,ba as H,aG as F,aH as R,R as q}from"./index-DcVBZRhf.js";const z={list:d=>b.post("tenantBind/getProjectAllocationList",d),meList:d=>b.post("tenantBind/getProjectMeAllocationList",d),getTenantMeasurementList:d=>b.post("tenantBind/getTenantMeasurementList",d),getQuestionnaireClickList:d=>b.post("tenantBind/getQuestionnaireClickList",d)},w=P("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),U=w,J=d=>(F("data-v-7f6a4418"),d=d(),R(),d),K={class:"details"},W={class:"details-left"},X={class:"project box"},Y=J(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),Z=["onClick"],ee={class:"item-left"},te={class:"tenant"},se={key:0,class:"tenantName"},ne={class:"tenantLength"},ae={class:"tenantName"},le={class:"price flex-b"},oe={class:"viewAll"},ie={key:0,class:"details-right"},ce={key:0,class:"clickId"},re={class:"clickIdItem"},pe={class:"clickIdItem-title"},ue={class:"supplierName"},de={class:"clickIdItem-content"},_e={key:1,class:"nodata"},fe={style:{flex:"auto"}},Ie=Q({name:"Edit",__name:"index",setup(d,{expose:N}){const k=U(),v=x(!1);x();const s=x({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function G(c,m=0){const n={linkId:c.linkId,projectId:c.projectId,source:m},f=await z.getTenantMeasurementList(n),i=f.data.tenantMeasurementInfoList;f.data.tenantMeasurementInfo&&i.unshift(f.data.tenantMeasurementInfo);const g=i.findIndex(p=>p.allocationTenantId===f.data.currentTenantId);i.splice(0,g);const h=i.filter(p=>p.type===1),e=i.filter(p=>p.type===2),r=i.filter(p=>p.type===3),L=[...h];if(e.length){const p=e.map(C=>C.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=p,L.push(e[0])}else if(r.length){const p=r.map(C=>C.memberGroupOrSupperId);r[0].length=r.length,r[0].memberGroupOrSupperIdList=p,L.push(r[0])}L.forEach(p=>p.visible=!1),s.value.currentTenantId=f.data.currentTenantId,s.value.tenantMeasurementInfoList=L,v.value=!0}const V=async(c,m)=>{s.value.select=s.value.select===m?"":m,s.value.clickIdList=[];const n={type:c.type,projectId:c.projectId,tenantId:c.allocationTenantId,supplierIdList:c.type===2?c.memberGroupOrSupperIdList:[],memberGroupIdList:c.type===3?c.memberGroupOrSupperIdList:[]},f=await z.getQuestionnaireClickList(n);s.value.clickIdList=B(f.data.questionnaireClickInfoList),c.type===2?s.value.clickIdList=s.value.clickIdList.filter(i=>i.peopleType===2):c.type===3&&(s.value.clickIdList=s.value.clickIdList.filter(i=>i.peopleType===1))};function B(c){return c.reduce((m,n)=>{const{supplierId:f,supplierName:i,projectQuestionnaireClickId:g,surveyStatus:h,price:e,peopleType:r}=n;let L=m.find(p=>p.supplierId===f);return L?L.list.push({projectQuestionnaireClickId:g,surveyStatus:h,price:e}):m.push({supplierId:f,peopleType:r,supplierName:i,list:[{projectQuestionnaireClickId:g,surveyStatus:h,price:e}]}),m},[])}function M(){v.value=!1,s.value={select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]}}function D(){M()}return N({showEdit:G}),(c,m)=>{const n=T("el-text"),f=H,i=T("el-button"),g=T("el-empty"),h=T("el-drawer");return I(),y("div",null,[a(h,{modelValue:_(v),"onUpdate:modelValue":m[0]||(m[0]=e=>A(v)?v.value=e:null),title:"详情",size:"60%","before-close":M},{footer:u(()=>[t("div",fe,[a(i,{onClick:M},{default:u(()=>[l(" 取消 ")]),_:1}),a(i,{type:"primary",onClick:D},{default:u(()=>[l(" 确定 ")]),_:1})])]),default:u(()=>[t("div",K,[t("div",W,[t("div",X,[t("div",null,[a(n,{tag:"b"},{default:u(()=>{var e;return[l(o((e=_(s).tenantMeasurementInfoList[0])==null?void 0:e.projectName),1)]}),_:1})]),t("div",null,[a(n,{type:"info"},{default:u(()=>{var e;return[l("ID："+o((e=_(s).tenantMeasurementInfoList[0])==null?void 0:e.projectId),1)]}),_:1})])]),(I(!0),y(j,null,O(_(s).tenantMeasurementInfoList,(e,r)=>(I(),y("div",{class:"link",key:e.allocationTenantId},[Y,t("div",{class:S({"item box":!0,select:r===_(s).select}),onClick:L=>V(e,r)},[t("div",ee,[t("div",te,[(e==null?void 0:e.length)>1?(I(),y("p",se,[l(" 已分配数： "),t("span",ne,o(e==null?void 0:e.length),1),t("span",{class:S("type"+e.type)},o(_(k).typeList[e.type-1]),3)])):(I(),y(j,{key:1},[t("p",null,[t("span",ae,o(e.tenantName),1),t("span",{class:S("type"+e.type)},o(_(k).typeList[e.type-1]),3)]),a(n,{type:"info"},{default:u(()=>[l("ID："+o(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",le,[t("p",null,[l(" 原价: "),a(f),l(o(e.doMoneyPrice),1)]),t("p",null,[l(" 参数: "),a(n,{size:"large"},{default:u(()=>[l(o(e.participationNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{type:"success",size:"large"},{default:u(()=>[l(o(e.doneNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{type:"warning",size:"large"},{default:u(()=>[l(o(e.num||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{size:"large"},{default:u(()=>[l(o(e.limitedQuantity||0),1)]),_:2},1024)])])]),t("div",oe,[a(i,{type:"primary",circle:"",size:"small",icon:_(E)},null,8,["icon"])])],10,Z)]))),128))]),_(s).select!==""?(I(),y("div",ie,[_(s).clickIdList.length?(I(),y("div",ce,[(I(!0),y(j,null,O(_(s).clickIdList,e=>(I(),y("div",re,[t("div",pe,[t("div",null,[t("span",ue,o(e.supplierName),1),t("span",{class:S("peopleType"+e.peopleType)},o(_(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[a(n,{type:"info"},{default:u(()=>[l("ID： "+o(e.supplierId),1)]),_:2},1024)])]),t("div",de,[t("ul",null,[(I(!0),y(j,null,O(e.list,r=>(I(),y("li",null,[t("span",null,o(r.projectQuestionnaireClickId),1),t("span",{class:S("surveyStatus"+r.surveyStatus)},o(_(k).surveyStatusList[r.surveyStatus-1]),3)]))),256))])])]))),256))])):(I(),y("div",_e,[a(g,{description:"暂无数据"})]))])):$("",!0)])]),_:1},8,["modelValue"])])}}}),ye=q(Ie,[["__scopeId","data-v-7f6a4418"]]),Le=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{z as a,Le as i,ye as o,U as u};
