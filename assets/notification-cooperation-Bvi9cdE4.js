
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as X,aL as Y,r as u,a as s,o as f,b as w,y as p,z as U,i as r,f as l,w as a,g as n,j as V,e as b,A as Z,b8 as I,E as ee,_ as te,aH as ae,aI as oe,L as le}from"./index-aj2M0Wo9.js";import{u as re}from"./index-equV0VuT.js";import{a as se}from"./department-urBbSri_.js";import"./index-zJ0REmWL.js";import"./index-2w19qN4f.js";const ne=_=>(ae("data-v-b3884190"),_=_(),oe(),_),ce={class:"news p-4"},ie=ne(()=>p("div",{class:"type"},[p("span"),n(" 合作邀约")],-1)),de={class:"news-content"},ue={class:"content"},pe={class:"time"},me={key:0,class:"footer"},fe={style:{display:"flex"}},_e=X({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(_,{expose:S,emit:E}){const T=E,y=Y(),e=u({rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(t,o,d)=>{if(/^(100|[1-9]?\d)$/.test(o)==!1)return d(new Error("请输入 0 到 100 之间的数字"));d()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),m=u(!1);u([]);const C=u(),A={children:"children",label:"name"},B=async t=>{e.value.chargeUserId="",e.value=t;const o=await se.list({name:""});o.data&&(k.value=o.data),z()},k=u([]),N=u(),g=u(),q=(t,o)=>{if(e.value.chargeUserId="",o){g.value.getCheckedKeys().forEach(i=>{i!==t.id&&g.value.setChecked(i,!1)}),e.value.chargeUserId=t.id;const v=g.value.getCheckedNodes();e.value.chargeUserName=v.map(i=>i.name)[0],setTimeout(()=>{N.value.blur()},100)}else e.value.chargeUserId=[e.value.chargeUserId].filter(d=>d!==t.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="");e.value.chargeUserId||(e.value.chargeUserName=""),console.log(e.value.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.chargeUserId,"data.value.form.chargeUserId")},z=async()=>{const t={id:e.value.id,type:1};await I.updateTenantAudit(t),await y.getUnreadTodo()},D=async()=>{const t={id:e.value.id,type:2};T("delSelectId"),await I.updateTenantAudit(t),await y.getUnreadTodo()},F=async()=>{C.value.validate(async t=>{if(t){if(e.value.receiveProjectType==1&&!e.value.chargeUserId){ee.warning({message:"请选择接收项目负责人",center:!0});return}const o={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType[0],receiveProjectType:e.value.receiveProjectType[0]};T("delSelectId"),await I.updateTenantAudit(o),await y.getUnreadTodo()}})},$=u();function K(t){e.value.chargeUserId=t.chargeUserId,e.value.invitationType=t.invitationType,e.value.chargeUserName=t.chargeUserName}const L=t=>{Array.isArray(t)&&t.length>1&&(e.value.sendProjectType=[t[t.length-1]])},M=t=>{Array.isArray(t)&&t.length>1&&(e.value.receiveProjectType=[t[t.length-1]])};return S({showEdit:B}),(t,o)=>{const d=s("el-button"),v=s("el-input"),i=s("el-form-item"),x=te,P=s("el-tooltip"),h=s("el-checkbox"),j=s("el-checkbox-group"),H=s("el-tree"),O=s("el-text"),G=s("el-option"),J=s("el-select"),Q=s("ElForm"),R=s("ElButton"),W=s("el-dialog");return f(),w("div",ce,[ie,p("div",de,[p("div",ue,"尊贵的"+U(r(e).beInvitedName),1),p("div",pe," 您好，我是"+U(r(e).invitationName||"-")+"诚挚邀请您与我们一同协作共赢！若有疑问请联系"+U(r(e).phoneOrEmail)+"。 ",1),r(e).auditStatus===1?(f(),w("div",me,[l(d,{onClick:D},{default:a(()=>[n("拒绝合作")]),_:1}),l(d,{type:"primary",onClick:o[0]||(o[0]=c=>m.value=!0)},{default:a(()=>[n(" 同意合作 ")]),_:1})])):V("",!0)]),l(W,{modelValue:r(m),"onUpdate:modelValue":o[6]||(o[6]=c=>Z(m)?m.value=c:null),title:"添加PM",class:"hezuoDrawer"},{footer:a(()=>[l(R,{size:"large",onClick:o[5]||(o[5]=c=>m.value=!1)},{default:a(()=>[n(" 取消 ")]),_:1}),l(R,{type:"primary",size:"large",onClick:F},{default:a(()=>[n(" 确定 ")]),_:1})]),default:a(()=>[l(Q,{ref_key:"FormRef",ref:C,rules:r(e).rules,model:r(e),"label-width":"7rem",labelPosition:"left"},{default:a(()=>[l(i,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[l(v,{modelValue:r(e).priceRatio,"onUpdate:modelValue":o[1]||(o[1]=c=>r(e).priceRatio=c),clearable:""},{append:a(()=>[n("%")]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"项目分配方式","label-width":"7rem"}),l(i,{prop:"sendProjectType","label-width":"7rem"},{label:a(()=>[p("span",null,[l(P,{effect:"dark",content:"1111111",placement:"top-start"},{default:a(()=>[l(x,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),n(" 发送项目 ")])]),default:a(()=>[l(j,{modelValue:r(e).sendProjectType,"onUpdate:modelValue":o[2]||(o[2]=c=>r(e).sendProjectType=c),onChange:L},{default:a(()=>[l(h,{value:1},{default:a(()=>[n(" 自动 ")]),_:1}),l(h,{value:2},{default:a(()=>[n(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),p("div",fe,[l(i,{prop:"receiveProjectType"},{label:a(()=>[p("span",null,[l(P,{effect:"dark",content:"1111111",placement:"top-start"},{default:a(()=>[l(x,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),n(" 接收项目 ")])]),default:a(()=>[l(j,{modelValue:r(e).receiveProjectType,"onUpdate:modelValue":o[3]||(o[3]=c=>r(e).receiveProjectType=c),onChange:M},{default:a(()=>[l(h,{value:1},{default:a(()=>[n(" 自动 ")]),_:1}),l(h,{value:2},{default:a(()=>[n(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(e).receiveProjectType==1?(f(),b(J,{key:0,modelValue:r(e).chargeUserName,"onUpdate:modelValue":o[4]||(o[4]=c=>r(e).chargeUserName=c),placeholder:"请选择部门",ref_key:"selectTreeRef",ref:N,style:{width:"15.625rem","margin-left":"1.5625rem"}},{default:a(()=>[l(G,{value:r(e).chargeUserId,style:{height:"auto"}},{default:a(()=>[r(k).length>0?(f(),b(H,{key:0,ref_key:"treeRef",ref:g,disabled:!0,data:r(k),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":[r(e).chargeUserId],"default-expand-all":"",props:A,onCheckChange:q,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["data","default-checked-keys"])):(f(),b(O,{key:1},{default:a(()=>[n("暂无数据")]),_:1}))]),_:1},8,["value"])]),_:1},8,["modelValue"])):V("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),l(re,{ref_key:"userRef",ref:$,onUserData:K},null,512)])}}}),be=le(_e,[["__scopeId","data-v-b3884190"]]);export{be as default};
