
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{s as q,d as te,aN as ae,r as u,k as le,a as h,l as oe,n as ne,o as n,b,f as l,w as e,p as C,g as i,F as g,q as y,e as s,G as p,j as k,a5 as re,E as se,aJ as de,aK as ue,Q as ie}from"./index-DaerNgvX.js";import{u as ce}from"./department-Cvz-8GzC.js";import{u as me}from"./configuration_manager-Bx6DwtdQ.js";import"./department-Ca-TysAJ.js";const U={list:f=>q.post("team/getGroupTeam",f),create:f=>q.post("team/insertGroupTeam",f),edit:f=>q.post("team/updateGroupTeam",f),delete:f=>q.post("team/deleteGroupTeam",f)},B=f=>(de("data-v-962577c4"),f=f(),ue(),f),pe=B(()=>C("div",{class:"card-header"},[C("span",null,"组长")],-1)),fe=B(()=>C("div",{class:"card-header"},[C("span",null,"组员")],-1)),_e={style:{flex:"auto"}},ve=te({name:"Edit",__name:"index",emits:["success"],setup(f,{expose:M,emit:j}){ae();const V=u(),E=u(),F=ce(),I=u(),H=me(),w=u([]),K=j,T=u(""),P=u(),J=u(!1);u([]),u();const x=u(!1),_=u([]),D=u([]),S=u();u({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{chineseName:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),u({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1});const v=u({groupId:null,userInfo:[],menuId:[]}),$={children:"children",label:"name"};u({invoiceCode:[{required:!0,trigger:"blur",message:"请输入姓名"}],tenantCustomerId:[{required:!0,trigger:"change",message:"请选择客户"}]});async function z(d){T.value=d!=null&&d.id?"编辑":"新增";const c=JSON.parse(d);v.value.groupId=c.id;const o={page:1,limit:10,groupId:c.id},t=await U.list(o);console.log("res",t),S.value=t.data.departmentId,console.log("department.value",S.value),t.data.data.forEach(m=>{m.isLeader?D.value.push(m):(v.value.menuId.push(m.memberId),_.value.push(m))}),x.value=!0}le(async()=>{I.value=await F.getDepartment(),w.value=await H.getStaff(),I.value=[{id:"574449384760348672",name:"技术部",director:"574448371148066816",memberCount:null,commissionStatus:1,commission:100,commissionTyp:2,remark:"技术部",children:[{id:"574451094157332480",phone:null,email:"131631@qq.com",name:"小小",country:"DE",role:"admin",active:!0},{id:"574449041162964992",phone:null,email:"131616@qq.com",name:"王二",country:"CA",role:"admin",active:!0},{id:"575155400074555392",phone:null,email:"3221313@qq.com",name:"小红",country:"BR",role:"admin",active:!0}]},{id:"23131",name:"财务部",director:"31313132",memberCount:null,commissionStatus:1,commission:100,commissionTyp:2,remark:"财务部",children:[{id:"5163131",phone:null,email:"131631@qq.com",name:"hello",country:"DE",role:"admin",active:!0},{id:"35131313",phone:null,email:"131616@qq.com",name:"world",country:"CA",role:"admin",active:!0},{id:"575155211095994368",phone:null,email:"3131@qq.com",name:"小鹏",country:"CA",role:"admin",active:!0}]}],P.value=new Date});const O=d=>{_.value=_.value.filter(o=>o.id!==d.id),V.value.getNode(d.id).checked&&(d.children&&d.children.length?d.children.forEach(o=>{_.value.some(t=>t.id===o.id)||_.value.push(o)}):_.value.some(o=>o.id===d.id)||_.value.push(d)),Q(_.value)},Q=d=>{const c=E.value;c&&re(()=>{d.forEach(o=>{const t=_.value.find(m=>m.id===o.id);t&&c.toggleRowSelection(t,!0)})})};function W(){return new Promise(d=>{const c=V.value.getCheckedKeys(),o=V.value.getHalfCheckedKeys();c.concat(o),delete v.value.menuId,D.value.forEach(t=>{let m={userId:t.id,commission:t.commission};v.value.userInfo.push(m)}),_.value.forEach(t=>{let m={userId:t.id,commission:t.commission};v.value.userInfo.push(m)}),console.log("form.value",v.value),delete v.value.id,U.create(v.value).then(()=>{se.success({message:"新增成功",center:!0}),K("success"),x.value=!1,d()})})}return M({showEdit:z}),(d,c)=>{const o=h("el-table-column"),t=h("el-text"),m=h("el-input"),L=h("el-empty"),N=h("el-table"),A=h("el-card"),X=h("el-tree"),G=h("el-col"),Y=h("el-row"),R=h("el-button"),Z=h("el-drawer"),ee=oe("loading");return ne((n(),b("div",null,[l(Z,{modelValue:x.value,"onUpdate:modelValue":c[2]||(c[2]=a=>x.value=a),title:T.value,size:"60%"},{footer:e(()=>[C("div",_e,[l(R,{type:"",onClick:c[1]||(c[1]=a=>x.value=!1)},{default:e(()=>[i(" 取消 ")]),_:1}),l(R,{type:"primary",onClick:W},{default:e(()=>[i(" 确定 ")]),_:1})])]),default:e(()=>[l(A,{class:"box-card"},{header:e(()=>[pe]),default:e(()=>[l(N,{data:D.value,border:""},{empty:e(()=>[l(L,{description:"暂无数据"})]),default:e(()=>[l(o,{align:"center",type:"index",label:"序号",width:"80"}),l(o,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"}),l(o,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"用户名"},{default:e(({row:a})=>[a.memberId?(n(!0),b(g,{key:0},y(w.value,r=>(n(),s(t,null,{default:e(()=>[a.memberId===r.id?(n(),s(t,{key:0},{default:e(()=>[i(p(r.name),1)]),_:2},1024)):k("",!0)]),_:2},1024))),256)):(n(),s(t,{key:1},{default:e(()=>[i(p(a.name),1)]),_:2},1024))]),_:1}),l(o,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"姓名"},{default:e(({row:a})=>[a.memberId?(n(!0),b(g,{key:0},y(w.value,r=>(n(),s(t,null,{default:e(()=>[a.memberId===r.id?(n(),s(t,{key:0},{default:e(()=>[i(p(r.name),1)]),_:2},1024)):k("",!0)]),_:2},1024))),256)):(n(),s(t,{key:1},{default:e(()=>[i(p(a.name),1)]),_:2},1024))]),_:1}),l(o,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:a})=>[(n(!0),b(g,null,y(I.value,r=>(n(),s(t,null,{default:e(()=>[S.value===r.id?(n(),s(t,{key:0},{default:e(()=>[i(p(r.name),1)]),_:2},1024)):k("",!0)]),_:2},1024))),256))]),_:1}),l(o,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"组内提成比例"},{default:e(({row:a})=>[l(m,{modelValue:a.commission,"onUpdate:modelValue":r=>a.commission=r,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[i("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1}),l(A,{class:"box-card"},{header:e(()=>[fe]),default:e(()=>[l(Y,{gutter:20},{default:e(()=>[l(G,{class:"leftData",span:8},{default:e(()=>[i(p(_.value)+" ",1),l(m,{modelValue:v.value.invoiceAmount,"onUpdate:modelValue":c[0]||(c[0]=a=>v.value.invoiceAmount=a),placeholder:"可输入关键字查找",clearable:""},null,8,["modelValue"]),l(X,{style:{"max-width":"600px","margin-top":"20px",height:"90%"},data:I.value,ref_key:"treeRef",ref:V,"show-checkbox":"","node-key":"id","default-checked-keys":v.value.menuId,"default-expanded-keys":[],props:$,onCheckChange:O},null,8,["data","default-checked-keys"])]),_:1}),l(G,{span:16},{default:e(()=>[l(N,{ref_key:"tableRef",ref:E,data:_.value,border:""},{empty:e(()=>[l(L,{description:"暂无数据"})]),default:e(()=>[l(o,{align:"center",type:"selection"}),l(o,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"},{default:e(({row:a})=>[a.memberId?(n(),s(t,{key:0},{default:e(()=>[i(p(a.memberId),1)]),_:2},1024)):(n(),s(t,{key:1},{default:e(()=>[i(p(a.id),1)]),_:2},1024))]),_:1}),l(o,{align:"center","show-overflow-tooltip":"",prop:"name",label:"用户名"},{default:e(({row:a})=>[a.memberId?(n(!0),b(g,{key:0},y(w.value,r=>(n(),s(t,null,{default:e(()=>[a.memberId===r.id?(n(),s(t,{key:0},{default:e(()=>[i(p(r.name),1)]),_:2},1024)):k("",!0)]),_:2},1024))),256)):(n(),s(t,{key:1},{default:e(()=>[i(p(a.name),1)]),_:2},1024))]),_:1}),l(o,{align:"center","show-overflow-tooltip":"",prop:"name",label:"姓名"},{default:e(({row:a})=>[a.memberId?(n(!0),b(g,{key:0},y(w.value,r=>(n(),s(t,null,{default:e(()=>[a.memberId===r.id?(n(),s(t,{key:0},{default:e(()=>[i(p(r.name),1)]),_:2},1024)):k("",!0)]),_:2},1024))),256)):(n(),s(t,{key:1},{default:e(()=>[i(p(a.name),1)]),_:2},1024))]),_:1}),l(o,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:a})=>[(n(!0),b(g,null,y(I.value,r=>(n(),s(t,null,{default:e(()=>[S.value===r.id?(n(),s(t,{key:0},{default:e(()=>[i(p(r.name),1)]),_:2},1024)):k("",!0)]),_:2},1024))),256))]),_:1}),l(o,{align:"center",width:"190",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:a})=>[l(m,{modelValue:a.commission,"onUpdate:modelValue":r=>a.commission=r,modelModifiers:{number:!0},placeholder:"提成比例",clearable:""},{append:e(()=>[i("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])),[[ee,J.value]])}}}),ke=ie(ve,[["__scopeId","data-v-962577c4"]]);export{ke as default};
