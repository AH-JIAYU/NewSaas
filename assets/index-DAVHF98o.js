
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as P}from"./index.vue_vue_type_script_setup_true_lang-0vupJV8C.js";import{x as S,af as Q,d as E,r as x,a as T,o as I,b as y,f as l,w as u,s as t,g as s,H as o,i as _,F as j,t as O,S as b,bo as $,j as A,I as F,aJ as H,aK as R,R as q}from"./index-B9G65lgK.js";const z={list:d=>S.post("tenantBind/getProjectAllocationList",d),meList:d=>S.post("tenantBind/getProjectMeAllocationList",d),getTenantMeasurementList:d=>S.post("tenantBind/getTenantMeasurementList",d),getQuestionnaireClickList:d=>S.post("tenantBind/getQuestionnaireClickList",d)},w=Q("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),J=w,K=d=>(H("data-v-262e321b"),d=d(),R(),d),U={class:"details"},W={class:"details-left"},X={class:"project box"},Y=K(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),Z=["onClick"],ee={class:"item-left"},te={class:"tenant"},se={key:0,class:"tenantName"},ne={class:"tenantLength"},ae={class:"tenantName"},le={class:"price flex-b"},oe={class:"viewAll"},ie={key:0,class:"details-right"},ce={key:0,class:"clickId"},re={class:"clickIdItem"},pe={class:"clickIdItem-title"},ue={class:"supplierName"},de={class:"clickIdItem-content"},_e={key:1,class:"nodata"},fe={style:{flex:"auto"}},Ie=E({name:"Edit",__name:"index",setup(d,{expose:N}){const k=J(),v=x(!1);x();const n=x({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function G(c,m=0){const a={linkId:c.linkId,projectId:c.projectId,source:m},f=await z.getTenantMeasurementList(a),i=f.data.tenantMeasurementInfoList;f.data.tenantMeasurementInfo&&i.unshift(f.data.tenantMeasurementInfo);const h=i.findIndex(p=>p.allocationTenantId===f.data.currentTenantId);i.splice(0,h);const g=i.filter(p=>p.type===1),e=i.filter(p=>p.type===2),r=i.filter(p=>p.type===3),L=[...g];if(e.length){const p=e.map(C=>C.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=p,L.push(e[0])}else if(r.length){const p=r.map(C=>C.memberGroupOrSupperId);r[0].length=r.length,r[0].memberGroupOrSupperIdList=p,L.push(r[0])}L.forEach(p=>p.visible=!1),n.value.currentTenantId=f.data.currentTenantId,n.value.tenantMeasurementInfoList=L,v.value=!0}const V=async(c,m)=>{n.value.select=n.value.select===m?"":m,n.value.clickIdList=[];const a={type:c.type,projectId:c.projectId,tenantId:c.allocationTenantId,supplierIdList:c.type===2?c.memberGroupOrSupperIdList:[],memberGroupIdList:c.type===3?c.memberGroupOrSupperIdList:[]},f=await z.getQuestionnaireClickList(a);n.value.clickIdList=B(f.data.questionnaireClickInfoList),c.type===2?n.value.clickIdList=n.value.clickIdList.filter(i=>i.peopleType===2):c.type===3&&(n.value.clickIdList=n.value.clickIdList.filter(i=>i.peopleType===1))};function B(c){return c.reduce((m,a)=>{const{supplierId:f,supplierName:i,projectQuestionnaireClickId:h,surveyStatus:g,price:e,peopleType:r}=a;let L=m.find(p=>p.supplierId===f);return L?L.list.push({projectQuestionnaireClickId:h,surveyStatus:g,price:e}):m.push({supplierId:f,peopleType:r,supplierName:i,list:[{projectQuestionnaireClickId:h,surveyStatus:g,price:e}]}),m},[])}function M(){v.value=!1}function D(){M()}return N({showEdit:G}),(c,m)=>{const a=T("el-text"),f=P,i=T("el-button"),h=T("el-empty"),g=T("el-drawer");return I(),y("div",null,[l(g,{modelValue:_(v),"onUpdate:modelValue":m[0]||(m[0]=e=>F(v)?v.value=e:null),title:"详情",size:"60%","before-close":M},{footer:u(()=>[t("div",fe,[l(i,{onClick:M},{default:u(()=>[s(" 取消 ")]),_:1}),l(i,{type:"primary",onClick:D},{default:u(()=>[s(" 确定 ")]),_:1})])]),default:u(()=>[t("div",U,[t("div",W,[t("div",X,[t("div",null,[l(a,{tag:"b"},{default:u(()=>[s(o(_(n).tenantMeasurementInfoList[0].projectName),1)]),_:1})]),t("div",null,[l(a,{type:"info"},{default:u(()=>[s("ID："+o(_(n).tenantMeasurementInfoList[0].projectId),1)]),_:1})])]),(I(!0),y(j,null,O(_(n).tenantMeasurementInfoList,(e,r)=>(I(),y("div",{class:"link",key:e.allocationTenantId},[Y,t("div",{class:b({"item box":!0,select:r===_(n).select}),onClick:L=>V(e,r)},[t("div",ee,[t("div",te,[(e==null?void 0:e.length)>1?(I(),y("p",se,[s(" 已分配数： "),t("span",ne,o(e==null?void 0:e.length),1),s(),t("span",{class:b("type"+e.type)},o(_(k).typeList[e.type-1]),3)])):(I(),y(j,{key:1},[t("p",null,[t("span",ae,o(e.tenantName),1),t("span",{class:b("type"+e.type)},o(_(k).typeList[e.type-1]),3)]),l(a,{type:"info"},{default:u(()=>[s("ID："+o(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",le,[t("p",null,[s(" 原价: "),l(f),s(o(e.doMoneyPrice),1)]),t("p",null,[s(" 参数: "),l(a,{size:"large"},{default:u(()=>[s(o(e.participationNumber||0),1)]),_:2},1024),l(a,{size:"large"},{default:u(()=>[s(" / ")]),_:1}),l(a,{type:"success",size:"large"},{default:u(()=>[s(o(e.doneNumber||0),1)]),_:2},1024),l(a,{size:"large"},{default:u(()=>[s(" / ")]),_:1}),l(a,{type:"warning",size:"large"},{default:u(()=>[s(o(e.num||0),1)]),_:2},1024),l(a,{size:"large"},{default:u(()=>[s(" / ")]),_:1}),l(a,{size:"large"},{default:u(()=>[s(o(e.limitedQuantity||0),1)]),_:2},1024)])])]),t("div",oe,[l(i,{type:"primary",circle:"",size:"small",icon:_($)},null,8,["icon"])])],10,Z)]))),128))]),_(n).select!==""?(I(),y("div",ie,[_(n).clickIdList.length?(I(),y("div",ce,[(I(!0),y(j,null,O(_(n).clickIdList,e=>(I(),y("div",re,[t("div",pe,[t("div",null,[t("span",ue,o(e.supplierName),1),t("span",{class:b("peopleType"+e.peopleType)},o(_(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[l(a,{type:"info"},{default:u(()=>[s("ID： "+o(e.supplierId),1)]),_:2},1024)])]),t("div",de,[t("ul",null,[(I(!0),y(j,null,O(e.list,r=>(I(),y("li",null,[t("span",null,o(r.projectQuestionnaireClickId),1),t("span",{class:b("surveyStatus"+r.surveyStatus)},o(_(k).surveyStatusList[r.surveyStatus-1]),3)]))),256))])])]))),256))])):(I(),y("div",_e,[l(h,{description:"暂无数据"})]))])):A("",!0)])]),_:1},8,["modelValue"])])}}}),ye=q(Ie,[["__scopeId","data-v-262e321b"]]),ve=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{z as a,ye as e,ve as i,J as u};
