
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as w}from"./index.vue_vue_type_script_setup_true_lang-DzdjhJoy.js";import{x as b,af as D,d as R,r as C,a as S,o as d,b as I,f as c,w as i,s as t,g as l,F as T,t as x,S as O,i as _,H as n,e as U,j,I as A,aJ as F,aK as H,R as q}from"./index-Iao0X4w3.js";const G={list:p=>b.post("tenantBind/getProjectAllocationList",p),meList:p=>b.post("tenantBind/getProjectMeAllocationList",p),getTenantMeasurementList:p=>b.post("tenantBind/getTenantMeasurementList",p),getQuestionnaireClickList:p=>b.post("tenantBind/getQuestionnaireClickList",p)},J=D("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),K=J,N=p=>(F("data-v-c5afa966"),p=p(),H(),p),W={class:"milestone"},X={class:"left"},Y={class:"left-top-left p-4"},Z={class:"project"},ee={class:"projectName flex-b"},te={class:"projectId"},se={class:"price flex-b"},ne={key:0,class:"left-top-right p-4"},ae={class:"tenant"},oe={key:0,class:"left-bottom"},le=N(()=>t("div",{class:"line"},null,-1)),re={class:"allocation"},ie=N(()=>t("div",{class:"arrow"},null,-1)),ce={key:0,class:"right"},pe={class:"clickIdItem m-2"},ue={class:"clickIdItem-left"},de={class:"clickIdItem-right"},_e={class:"title"},fe=N(()=>t("li",null,"点击ID:",-1)),Ie={key:0},ye={style:{flex:"auto"}},ve=R({name:"Edit",__name:"index",setup(p,{expose:B}){const h=K(),g=C(!1),z=C(),r=C({currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function V(a){const f={linkId:a.linkId,projectId:a.projectId},u=await G.getTenantMeasurementList(f),o=u.data.tenantMeasurementInfoList.findIndex(s=>s.allocationTenantId===u.data.currentTenantId),y=u.data.tenantMeasurementInfoList;y.splice(0,o);const k=y.filter(s=>s.type===1),v=y.filter(s=>s.type===2),e=y.filter(s=>s.type===3),L=[...k];if(v.length){const s=v.map(m=>m.memberGroupOrSupperId);v[0].length=v.length,v[0].memberGroupOrSupperIdList=s,L.push(v[0])}else if(e.length){const s=e.map(m=>m.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=s,L.push(e[0])}L.forEach(s=>s.visible=!1),r.value.currentTenantId=u.data.currentTenantId,r.value.tenantMeasurementInfoList=L,g.value=!0}const E=a=>{r.value.clickIdList=[],z.value.forEach((f,u)=>{u!==a-1&&f.hide()})},P=async a=>{const f={type:a.type,projectId:a.projectId,tenantId:a.allocationTenantId,supplierIdList:a.type===2?a.memberGroupOrSupperIdList:[],memberGroupIdList:a.type===3?a.memberGroupOrSupperIdList:[]},u=await G.getQuestionnaireClickList(f);r.value.clickIdList=Q(u.data.questionnaireClickInfoList),a.type===2?r.value.clickIdList=r.value.clickIdList.filter(o=>o.peopleType===2):a.type===3&&(r.value.clickIdList=r.value.clickIdList.filter(o=>o.peopleType===1))};function Q(a){return a.reduce((f,u)=>{const{supplierId:o,supplierName:y,projectQuestionnaireClickId:k,surveyStatus:v,price:e,peopleType:L}=u;let s=f.find(m=>m.supplierId===o);return s?s.list.push({projectQuestionnaireClickId:k,surveyStatus:v,price:e}):f.push({supplierId:o,peopleType:L,supplierName:y,list:[{projectQuestionnaireClickId:k,surveyStatus:v,price:e}]}),f},[])}function M(){g.value=!1}function $(){M()}return B({showEdit:V}),(a,f)=>{const u=w,o=S("el-text"),y=S("el-button"),k=S("el-popover"),v=S("el-drawer");return d(),I("div",null,[c(v,{modelValue:_(g),"onUpdate:modelValue":f[0]||(f[0]=e=>A(g)?g.value=e:null),title:"项目测查",size:"60%","before-close":M},{footer:i(()=>[t("div",ye,[c(y,{onClick:M},{default:i(()=>[l(" 取消 ")]),_:1}),c(y,{type:"primary",onClick:$},{default:i(()=>[l(" 确定 ")]),_:1})])]),default:i(()=>[t("div",W,[(d(!0),I(T,null,x(_(r).tenantMeasurementInfoList,(e,L)=>(d(),I("div",{class:"item",key:e.allocationTenantId},[t("div",X,[t("div",{class:O({"left-top":!0,"flex-b":!0,currentTenant:e.allocationTenantId===_(r).currentTenantId&&e.type===1})},[t("div",Y,[t("div",Z,[t("div",ee,[t("b",null,n(e.projectName),1),t("span",null,n(_(h).projectStatusList[e.projectStatus-1]),1)]),t("div",te,n(e.projectId),1)]),t("div",se,[t("p",null,[l(" 原价： "),c(u),l(" "+n(e.doMoneyPrice),1)]),t("p",null,[l(" 参数： "),c(o,{size:"large"},{default:i(()=>[l(n(e.participationNumber||0),1)]),_:2},1024),c(o,{size:"large"},{default:i(()=>[l(" / ")]),_:1}),c(o,{type:"success",size:"large"},{default:i(()=>[l(n(e.doneNumber||0),1)]),_:2},1024),c(o,{size:"large"},{default:i(()=>[l(" / ")]),_:1}),c(o,{type:"warning",size:"large"},{default:i(()=>[l(n(e.num||0),1)]),_:2},1024),c(o,{size:"large"},{default:i(()=>[l(" / ")]),_:1}),c(o,{size:"large"},{default:i(()=>[l(n(e.limitedQuantity||0),1)]),_:2},1024)])])]),e.allocationTenantId!==_(r).currentTenantId||e.type!==1?(d(),I("div",ne,[t("p",{class:O("type"+e.type)},n(_(h).typeList[e.type-1]),3),t("div",ae,[(e==null?void 0:e.length)>1?(d(),U(y,{key:0,type:"primary",link:""},{default:i(()=>[l(" 查看更多("+n(e==null?void 0:e.length)+") ",1)]),_:2},1024)):(d(),I(T,{key:1},[t("p",null,n(e.tenantName),1),t("p",null,n(e.allocationTenantId),1)],64))])])):j("",!0)],2),_(r).tenantMeasurementInfoList.length!==L+1?(d(),I("div",oe,[le,t("div",re,n(e.tenantName)+"-分配-"+n(_(h).typeList[_(r).tenantMeasurementInfoList[L+1].type-1]),1),ie])):j("",!0)]),e.allocationTenantId!==_(r).currentTenantId||e.type!=1?(d(),I("div",ce,[c(k,{visible:e.visible,"onUpdate:visible":s=>e.visible=s,ref_for:!0,ref_key:"popoverRef",ref:z,placement:"right",width:350,trigger:"click",onBeforeEnter:s=>E(L),onShow:s=>P(e)},{reference:i(()=>[c(y,{style:{padding:"0.5rem"},type:"primary",link:""},{default:i(()=>[l(" 》 ")]),_:1})]),default:i(()=>[(d(!0),I(T,null,x(_(r).clickIdList,s=>(d(),I("div",pe,[t("div",ue,[t("span",{class:O("peopleType"+s.peopleType)},n(_(h).peopleTypeList[s.peopleType-1]),3)]),t("div",de,[t("div",_e,n(s.supplierName)+"   "+n(s.supplierId),1),t("ul",null,[fe,(d(!0),I(T,null,x(s.list,m=>(d(),I("li",null,[t("span",null,n(m.projectQuestionnaireClickId),1),t("span",null,"  "+n(_(h).surveyStatusList[m.surveyStatus-1]),1),m.surveyStatus===1?(d(),I("span",Ie,[l("   "),c(u),l(n(m.price),1)])):j("",!0)]))),256))])])]))),256))]),_:2},1032,["visible","onUpdate:visible","onBeforeEnter","onShow"])])):j("",!0)]))),128))])]),_:1},8,["modelValue"])])}}}),Le=q(ve,[["__scopeId","data-v-c5afa966"]]),ge=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{G as a,Le as e,ge as i,K as u};
