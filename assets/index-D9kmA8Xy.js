
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as re,m as j,I as ue,r as u,l as de,u as ie,c as me,n as pe,a as i,o as r,e as p,w as e,f as o,g as _,i as s,b as x,t as D,F as B,y as V,z as ce,j as H,p as J,E as O,aH as fe,aI as _e,L as ve}from"./index-Ci6VJ9pE.js";import{a as ge}from"./position_manage-CJBwwrSK.js";import{u as ye}from"./department-rDBTVKVN.js";import{u as he}from"./tenant_role-BZgNm-TU.js";import{u as Ve}from"./configuration_manager-DyMPZj5e.js";import"./department-JT6eYehB.js";import"./configuration_role-BdgqaFRn.js";const G=v=>(fe("data-v-6f679bd6"),v=v(),_e(),v),be=G(()=>V("div",{class:"card-header"},[V("div",{class:"leftTitle"},"基本信息")],-1)),we={class:"card-header"},Ie={class:"leftTitle"},xe={key:0,style:{"margin-left":"20px","font-size":"14px"}},Ee=G(()=>V("div",{class:"card-header"},[V("div",{class:"leftTitle"},"角色信息")],-1)),Se=re({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success"],["update:modelValue"]),setup(v,{emit:K}){ue();const Q=Ve(),T=u([]),P=u([]),q=u(),W=de(),X=u(),Y=he(),L=u(),ee=ye(),ae=u(),le=u(!1),A=u(),F=u();u();const g=v,Z=K,U=ie(v,"modelValue"),te=me(()=>g.id===""?"新增用户":"编辑用户"),f=u(),oe=u([]),a=u({id:g.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),E=u({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{validator:(d,t,n)=>{const m=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;a.value.phone?m.test(a.value.phone)?n():n(new Error("请输入合法手机号")):n()},trigger:"blur"}],email:[{validator:(d,t,n)=>{const m=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a.value.email?m.test(a.value.email)?n():n(new Error("请输入合法邮箱")):n()},trigger:"blur"}]}),se=async d=>{};function ne(){a.value.email||(E.value.email=[],f.value.clearValidate("email")),a.value.phone||(E.value.phone=[],f.value.clearValidate("phone")),a.value.id?f.value&&f.value.validate(d=>{if(d){const{id:t,phone:n,email:m,password:y,name:z,country:M,active:b,type:w,role:h,groupId:k,positionId:N,departmentId:R,userName:C}=a.value,c={id:t,phone:n,email:m,password:y,name:z,country:M,active:b,type:w,role:h,groupId:k,positionId:N,departmentId:R,userName:C};F.value===c.phone&&delete c.phone,A.value===c.email&&delete c.email,c.password||delete c.password,J.edit(c).then(()=>{O.success({message:"编辑成功",center:!0}),Z("success"),S()})}}):f.value&&f.value.validate(d=>{d&&J.create(a.value).then(()=>{O.success({message:"新增成功",center:!0}),Z("success"),S()})})}function S(){U.value=!1}const $=d=>d==null?void 0:d.reduce((t,n)=>Array.isArray(n)?t.concat($(n)):t.concat(n),[]);return pe(async()=>{const{data:d}=await ge.list({page:1,limit:10,id:null,name:"",active:null});q.value=d.data,T.value=await Q.getStaff(),L.value=await Y.getRole(),ae.value=await ee.getDepartment(),X.value=await W.getCountry(),g.id!==""&&g.row&&(E.value.password=[],a.value=JSON.parse(g.row),A.value=a.value.email,F.value=a.value.phone,a.value.departmentId&&se(a.value.departmentId),le.value=!0),oe.value=$(g.dataList)}),(d,t)=>{const n=i("el-input"),m=i("el-form-item"),y=i("el-col"),z=i("el-option"),M=i("el-select"),b=i("el-row"),w=i("el-card"),h=i("el-text"),k=i("el-radio"),N=i("el-radio-group"),R=i("ElForm"),C=i("ElButton"),c=i("ElDrawer");return r(),p(c,{modelValue:U.value,"onUpdate:modelValue":t[7]||(t[7]=l=>U.value=l),title:s(te),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:e(()=>[o(C,{size:"large",onClick:S},{default:e(()=>[_(" 取消 ")]),_:1}),o(C,{type:"primary",size:"large",onClick:ne},{default:e(()=>[_(" 确定 ")]),_:1})]),default:e(()=>[o(R,{ref_key:"formRef",ref:f,model:s(a),rules:s(E),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[o(w,{class:"box-card"},{header:e(()=>[be]),default:e(()=>[o(b,{gutter:24},{default:e(()=>[o(y,{span:8},{default:e(()=>[o(m,{label:"用户名",prop:"userName"},{default:e(()=>[o(n,{modelValue:s(a).userName,"onUpdate:modelValue":t[0]||(t[0]=l=>s(a).userName=l),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(y,{span:8},{default:e(()=>[o(m,{label:"手机号",prop:"phone"},{default:e(()=>[o(n,{modelValue:s(a).phone,"onUpdate:modelValue":t[1]||(t[1]=l=>s(a).phone=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(y,{span:8},{default:e(()=>[o(m,{label:"邮箱",prop:"email"},{default:e(()=>[o(n,{modelValue:s(a).email,"onUpdate:modelValue":t[2]||(t[2]=l=>s(a).email=l),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(y,{span:8},{default:e(()=>[o(m,{label:"职位",prop:""},{default:e(()=>[o(M,{modelValue:s(a).positionId,"onUpdate:modelValue":t[3]||(t[3]=l=>s(a).positionId=l),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[4]||(t[4]=()=>{})},{default:e(()=>[(r(!0),x(B,null,D(s(q),l=>(r(),p(z,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(w,{class:"box-card"},{header:e(()=>[V("div",we,[V("div",Ie,[_(" 部门信息"),s(a).director?(r(),x("span",xe,[_("负责人:"),(r(!0),x(B,null,D(s(T),l=>(r(),p(h,{key:l.id},{default:e(()=>[l.id===s(a).director?(r(),p(h,{key:0},{default:e(()=>[_(ce(l.name),1)]),_:2},1024)):H("",!0)]),_:2},1024))),128))])):H("",!0)])])]),default:e(()=>[o(b,{gutter:24},{default:e(()=>[o(m,{label:"分配部门:"},{default:e(()=>[s(P).length?(r(),p(N,{key:0,modelValue:s(a).groupId,"onUpdate:modelValue":t[5]||(t[5]=l=>s(a).groupId=l)},{default:e(()=>[(r(!0),x(B,null,D(s(P),l=>(r(),p(k,{key:l.id,value:l.id,label:l.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(r(),p(h,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1}),o(w,{class:"box-card"},{header:e(()=>[Ee]),default:e(()=>[o(b,{gutter:24},{default:e(()=>[o(m,{label:"分配角色:"},{default:e(()=>{var l;return[(l=s(L))!=null&&l.length?(r(),p(N,{key:0,modelValue:s(a).role,"onUpdate:modelValue":t[6]||(t[6]=I=>s(a).role=I)},{default:e(()=>[(r(!0),x(B,null,D(s(L),I=>(r(),p(k,{key:I.id,value:I.roleName,label:I.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(r(),p(h,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Re=ve(Se,[["__scopeId","data-v-6f679bd6"]]);export{Re as default};
