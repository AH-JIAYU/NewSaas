
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Ue,ae as Be,aN as we,r as u,E as m,M as Fe,o as je,a2 as g,al as re,a as s,c as i,w as r,b as k,f as c,h as t,a3 as I,g as v,t as p,k as R,aM as He,j as d,i as E,A as z,ai as W,aS as ce,aP as qe,aQ as Oe,_ as Ge,aR as Je,ao as Ke,y as We}from"./index-CxSXUQRU.js";import{_ as Xe}from"./index-BNC4RpCQ.js";import{_ as Ye}from"./index.vue_vue_type_style_index_0_lang-D__ohy0s.js";import{_ as Ze}from"./index-DA4NZtDa.js";import et from"./index-DHsEqk9o.js";import tt from"./index-CA9F5YrD.js";import ot from"./index-CRn0MDiF.js";import nt from"./index-DIE7oicG.js";import at from"./index-6Se9jpqa.js";import st from"./customerDetail-CmH7dMh8.js";import lt from"./index-uY72vzwI.js";import rt from"./index-CA5aL5U8.js";import{s as ie}from"./apiLoading-ArDFFVvl.js";import{u as ct}from"./user_customer-BDqUqZqM.js";import{a as X}from"./user_customer-DEqjJrPk.js";import{a as it}from"./user_cooperation-uV4NSf9I.js";import"./index-CrNZ6CW0.js";import"./clipboard-DquYvbb_.js";import"./index.vue_vue_type_script_setup_true_lang-5fUkfTjC.js";import"./sortable.esm-C0-Qcoum.js";import"./index.vue_vue_type_script_setup_true_lang-BgKoGmKp.js";import"./index-Bk2Ekfbx.js";import"./index-BhYlFqc6.js";import"./department-BjjuPcDv.js";import"./position_manage-C2ltHd3e.js";import"./configuration_role-DeiAQ-mf.js";import"./tenant_role-BI7fL2Re.js";import"./configuration_manager-DUYjHYv1.js";import"./configuration_siteSetting-VpOknSW-.js";import"./configuration_site_setting-DQocyua6.js";import"./stagedData-BDZzd_-f.js";import"./index.vue_vue_type_script_setup_true_lang-Cs0mTZ3Y.js";import"./index-B2vugyWQ.js";import"./member-CB3zcQYN.js";import"./index-mntO0aA0.js";import"./index-DGmSQ9kt.js";const ut=["onClick"],mt={key:0,class:"fontC-System"},dt={class:"tableBig flex-c"},pt={class:"oneLine",style:{width:"calc(100% - 55px)"}},ft={class:"copyId tableSmall"},ht={class:"id oneLine beInvitationTenantId"},_t={class:"flex-c tableBig"},vt={class:"oneLine",style:{width:"calc(100% - 20px)"}},yt={class:"flex-c"},gt={class:"oneLine"},kt={key:0,style:{display:"inline-block"},class:"fontC-System"},bt={key:1},Ct=["onClick"],St={key:1},It=["onClick"],Et={key:1},xt={key:0,class:"fontC-System"},Nt={class:"fontC-System"},At=Ue({name:"customer",__name:"index copy1",setup(Qt){const ue=ct(),{t:o}=Be(),{pagination:b,getParams:Rt,onSizeChange:me,onCurrentChange:de}=we();u([]);const L=u(!1),x=u([]),w=u(),Y=u(),F=u(),pe=u(),N=u(),fe=u(),V=u(!1),$=u(!1),P=u(!1),M=u("default"),h=u([]),Z=u(),he=u("formSearch-customer"),U=u([{label:m(()=>o("customer.customerCode")),checked:!0,sortable:!0,prop:"tenantCustomerId"},{label:m(()=>o("customer.customerName")),checked:!0,sortable:!0,prop:"customerAccord"},{label:m(()=>o("customer.customerShortName")),checked:!0,sortable:!0,prop:"customerShortName"},{label:"PM",checked:!0,sortable:!0,prop:"chargeId"},{label:m(()=>o("customer.noAssociatedProject")),checked:!0,sortable:!0,prop:"projectNumber"},{label:m(()=>o("customer.customerStatus")),checked:!0,sortable:!0,prop:"customerStatus"},{label:m(()=>o("customer.antecedentQuestionnaire")),checked:!0,sortable:!0,prop:"antecedentQuestionnaire"},{label:m(()=>o("customer.riskControl")),checked:!0,sortable:!0,prop:"riskControl"},{label:m(()=>o("customer.limit")),checked:!0,sortable:!0,prop:"turnover"},{label:m(()=>o("customer.rateMin")),checked:!0,sortable:!0,prop:"rateAudit"}]);function _e(){w.value.showEdit()}const ee=u();function ve(n){w.value.showEdit(n)}async function j(n,a,C){console.log(n,"state");const l={status:n,operationalType:a,tenantCustomerId:C},{status:_}=await ie(X.changestatus(l));_===1&&W.success({message:o("customer.editSucess")}),ue.customer=null,y()}function ye(n){n.type==1?Y.value.showEdit(n):ee.value.showEdit(n)}function ge(n){n?N.value=n.id:N.value=""}const te=u();function oe(n,a){F.value.showEdit(n,a)}function ke(n,a){n.type==1?F.value.showEdit(n,a):te.value.showEdit(n,"chargeUserId")}function be(n){ce.confirm(o("customer.delConfirm"),o("customer.delMessage")).then(async()=>{const{status:a}=await ie(X.delete({tenantCustomerId:n.tenantCustomerId}));a===1&&W.success({message:o("customer.delSuccess")}),y()}).catch(()=>{})}const S=Fe({customerShortName:"",customerStatus:null,antecedentQuestionnaire:null});function Ce(n){me(n).then(()=>D())}function ne(n=1){de(n).then(()=>D())}function Se(){Object.assign(S,{customerShortName:"",customerStatus:null,antecedentQuestionnaire:null}),y()}function y(){b.value.page=1,D()}async function D(){try{L.value=!0;const n={...S},{data:a}=await X.getBindCustomer(n);x.value=(a==null?void 0:a.getBindCustomerInfoList)||[],Ie(),L.value=!1}catch{}finally{L.value=!1}}const Ie=()=>{x.value.forEach(l=>{l.type==2&&(l.tenantCustomerId=l.beInvitationTenantId)});const n=x.value.filter(l=>l.type==2&&l.customerStatus==2);let a=x.value.filter(l=>l.type==2&&l.customerStatus==4);a=Array.from(new Map(a.map(l=>[l.beInvitationTenantId,l])).values());const C=n.map(l=>l.type==2&&l.beInvitationTenantId);a.forEach(l=>{C.includes(l.beInvitationTenantId)||n.push(l)}),x.value.forEach(l=>{l.type==1&&n.push(l)}),x.value=n},Ee=m(()=>{const n=x.value.filter(l=>{const[_,B]=S.customerStatus!=null?S.customerStatus.split(",").map(Number):["",""],H=S.customerShortName?l.customerShortName==S.customerShortName:!0,q=S.antecedentQuestionnaire?l.antecedentQuestionnaire==S.antecedentQuestionnaire:!0,O=_?l.type==_:!0,T=B?l.customerStatus===B:!0;return H&&q&&O&&T}),a=(b.value.page-1)*b.value.size,C=a+b.value.size;return b.value.total=n.slice(a,C).length,n.slice(a,C)});function xe(n){fe.value=n}je(async()=>{U.value.forEach(n=>{n.checked&&h.value.push(n.prop)}),y(),Z.value=[{index:1,show:!0,type:"input",modelName:"customerShortName",placeholder:m(()=>o("customer.customerShortName"))},{index:2,show:!0,type:"select",modelName:"customerStatus",placeholder:m(()=>o("customer.customerStatus")),option:"customerStatus",optionLabel:"label",optionValue:"value"},{index:3,show:!0,type:"select",modelName:"antecedentQuestionnaire",placeholder:m(()=>o("customer.antecedentQuestionnaire")),option:"antecedentQuestionnaire",optionLabel:"label",optionValue:"value"}]});const Ne={customerStatus:()=>[{label:m(()=>o("customer.forbidden")),value:"1,1"},{label:m(()=>o("customer.enable")),value:"1,2"},{label:m(()=>o("customer.Agree")),value:"2,2"},{label:m(()=>o("customer.Terminate")),value:"2,4"}],antecedentQuestionnaire:()=>[{label:m(()=>o("customer.forbidden")),value:1},{label:m(()=>o("customer.enable")),value:2}]},ae=u(),se=u();function Ae(){se.value.showEdit()}function Qe(n){ae.value.showEdit(n)}function Re(n){ce.prompt(o("customer.configuration"),o("customer.stop"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),inputPlaceholder:o("customer.instructions"),inputPattern:/^.{0,500}$/,inputErrorMessage:o("customer.lt500"),type:"warning"}).then(async a=>{const{data:{flag:C}}=await it.updateRescindTenant({beInvitationTenantId:n.beInvitationTenantId,remark:a.value});C&&W({type:"success",message:o("customer.terminatedCooperation")}),D()}).catch(()=>{})}return(n,a)=>{const C=Ze,l=g("ElDivider"),_=g("el-button"),B=Ye,H=qe,q=Oe,O=g("el-row"),T=g("ElSwitch"),G=g("el-text"),J=g("ElTableColumn"),le=Xe,K=Ge,ze=g("el-tooltip"),A=g("el-table-column"),De=Je,Te=g("ElSpace"),Le=g("el-empty"),Ve=g("el-table"),$e=g("ElPagination"),Pe=Ke,Q=re("auth"),Me=re("loading");return s(),i(Pe,null,{default:r(()=>[k("div",{class:z({"absolute-container":t(P)})},[c(C,{formSearchList:t(Z),formSearchName:t(he),onCurrentChange:ne,onOnReset:Se,model:t(S),formOption:Ne},null,8,["formSearchList","formSearchName","model"]),c(l,{"border-style":"dashed"}),c(O,null,{default:r(()=>[c(B,null,{default:r(()=>[I((s(),i(_,{type:"primary",size:"default",onClick:_e},{default:r(()=>[v(p(t(o)("common.new")),1)]),_:1})),[[Q,"customer-get-addTenantCustomer"]]),I((s(),i(_,{type:"primary",size:"default",onClick:Ae},{default:r(()=>[v(p(t(o)("customer.invite")),1)]),_:1})),[[Q,"cooperation-get-addInvitationBind"]])]),_:1}),c(q,null,{default:r(()=>[c(_,{size:"default"},{default:r(()=>[v(p(t(o)("common.export")),1)]),_:1}),c(H,{border:t(V),"onUpdate:border":a[0]||(a[0]=e=>R(V)?V.value=e:null),tableAutoHeight:t(P),"onUpdate:tableAutoHeight":a[1]||(a[1]=e=>R(P)?P.value=e:null),checkList:t(h),"onUpdate:checkList":a[2]||(a[2]=e=>R(h)?h.value=e:null),columns:t(U),"onUpdate:columns":a[3]||(a[3]=e=>R(U)?U.value=e:null),"line-height":t(M),"onUpdate:lineHeight":a[4]||(a[4]=e=>R(M)?M.value=e:null),stripe:t($),"onUpdate:stripe":a[5]||(a[5]=e=>R($)?$.value=e:null),style:{"margin-left":"12px"},onQueryData:y},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),I((s(),i(Ve,{border:t(V),data:t(Ee),size:t(M),stripe:t($),onSelectionChange:xe,"highlight-current-row":"",onCurrentChange:ge},{empty:r(()=>[c(Le,{image:t(He),"image-size":300},null,8,["image"])]),default:r(()=>[t(h).includes("customerStatus")?(s(),i(J,{key:0,align:"left","show-overflow-tooltip":"",prop:"customerStatus",label:t(o)("customer.customerStatus"),width:"84"},{default:r(({row:e})=>[k("div",{onClick:f=>j(e.customerStatus,1,e.tenantCustomerId)},[e.type==1?(s(),i(T,{key:0,modelValue:e.customerStatus,"onUpdate:modelValue":f=>e.customerStatus=f,"inline-prompt":"","inactive-value":1,"active-value":2,"active-text":t(o)("customer.enable"),"inactive-text":t(o)("customer.forbidden")},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"])):d("",!0)],8,ut),e.type==2?(s(),E("div",mt,[e.customerStatus===2?(s(),i(G,{key:0,type:"success"},{default:r(()=>[v(p(t(o)("customer.cooperation")),1)]),_:1})):d("",!0),e.customerStatus===4?(s(),i(G,{key:1,type:"danger"},{default:r(()=>[v(p(t(o)("customer.rescindContract")),1)]),_:1})):d("",!0)])):d("",!0)]),_:1},8,["label"])):d("",!0),t(h).includes("customerAccord")?(s(),i(A,{key:1,align:"left",prop:"customerAccord",label:t(o)("customer.customerName"),width:"230"},{default:r(({row:e})=>[k("div",dt,[k("div",pt,p(e.customerAccord),1),c(le,{content:e.customerAccord,class:z({rowCopy:"rowCopy",current:e.id===t(N)})},null,8,["content","class"]),e.type==1?(s(),i(K,{key:0,onClick:f=>oe(e,"customerAccord"),class:z({edit:"edit",current:e.id===t(N)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):d("",!0)]),k("div",ft,[k("div",ht,[c(ze,{effect:"dark",content:e.tenantCustomerId,placement:"top-start"},{default:r(()=>[v(p(e.tenantCustomerId),1)]),_:2},1032,["content"])]),c(le,{content:e.tenantCustomerId,class:z({rowCopy:"rowCopy",current:e.id===t(N)})},null,8,["content","class"])])]),_:1},8,["label"])):d("",!0),t(h).includes("customerShortName")?(s(),i(A,{key:2,align:"left",prop:"customerShortName","show-overflow-tooltip":"",label:t(o)("customer.customerShortName"),width:"150"},{default:r(({row:e})=>[k("div",_t,[k("div",vt,p(e.customerShortName),1),e.customerShortName?(s(),i(K,{key:0,onClick:f=>oe(e,"customerShortName"),class:z({edit:"edit",current:e.id===t(N)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):d("",!0)])]),_:1},8,["label"])):d("",!0),t(h).includes("chargeId")?(s(),i(A,{key:3,align:"left",prop:"chargeId","show-overflow-tooltip":"",label:"PM"},{default:r(({row:e})=>[k("div",yt,[k("div",gt,p(e.chargeName),1),c(K,{onClick:f=>ke(e,"chargeId"),class:z({edit:"edit",current:e.id===t(N)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):d("",!0),t(h).includes("projectNumber")?(s(),i(A,{key:4,align:"left",prop:"turnover","show-overflow-tooltip":"",label:t(o)("customer.noAssociatedProject")},{default:r(({row:e})=>[e.type==1?(s(),E("span",kt,p(e.projectNumber||0),1)):(s(),E("span",bt,"-"))]),_:1},8,["label"])):d("",!0),t(h).includes("antecedentQuestionnaire")?(s(),i(J,{key:5,align:"left","show-overflow-tooltip":"",prop:"antecedentQuestionnaire",label:t(o)("customer.antecedentQuestionnaire")},{default:r(({row:e})=>[e.type==1?(s(),E("div",{key:0,onClick:f=>j(e.antecedentQuestionnaire,2,e.tenantCustomerId)},[c(T,{modelValue:e.antecedentQuestionnaire,"onUpdate:modelValue":f=>e.antecedentQuestionnaire=f,"inline-prompt":"","inactive-value":1,"active-value":2,"active-text":t(o)("customer.enable"),"inactive-text":t(o)("customer.forbidden")},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"])],8,Ct)):(s(),E("div",St," - "))]),_:1},8,["label"])):d("",!0),t(h).includes("riskControl")?(s(),i(J,{key:6,align:"left","show-overflow-tooltip":"",prop:"riskControl",label:t(o)("customer.riskControl")},{default:r(({row:e})=>[e.type==1?(s(),E("div",{key:0,onClick:f=>j(e.riskControl,3,e.tenantCustomerId)},[c(T,{modelValue:e.riskControl,"onUpdate:modelValue":f=>e.riskControl=f,"inline-prompt":"","inactive-value":1,"active-value":2,"active-text":t(o)("customer.enable"),"inactive-text":t(o)("customer.forbidden")},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"])],8,It)):(s(),E("div",Et," - "))]),_:1},8,["label"])):d("",!0),t(h).includes("turnover")?(s(),i(A,{key:7,align:"left",prop:"turnover","show-overflow-tooltip":"",label:t(o)("customer.limit")},{default:r(({row:e})=>[e.turnover>0?(s(),E("div",xt,[c(De),v(p(e.turnover),1)])):(s(),i(G,{key:1,class:"fontC-System"},{default:r(()=>[v("-")]),_:1}))]),_:1},8,["label"])):d("",!0),t(h).includes("rateAudit")?(s(),i(A,{key:8,align:"left",prop:"rateAudit","show-overflow-tooltip":"",label:t(o)("customer.rateMin")},{default:r(({row:e})=>[k("div",Nt,p(e.rateAudit?e.rateAudit:"-"),1)]),_:1},8,["label"])):d("",!0),c(A,{align:"left",fixed:"right",prop:"i",label:t(o)("customer.control"),width:"240"},{default:r(({row:e})=>[c(Te,null,{default:r(()=>[e.type==1?I((s(),i(_,{key:0,size:"small",plain:"",type:"primary",onClick:f=>ve(e)},{default:r(()=>[v(p(t(o)("common.edit")),1)]),_:2},1032,["onClick"])),[[Q,"customer-update-updateTenantCustomer"]]):d("",!0),I((s(),i(_,{type:"warning",plain:"",size:"small",onClick:f=>ye(e)},{default:r(()=>[v(p(t(o)("common.detail")),1)]),_:2},1032,["onClick"])),[[Q,"customer-get-getTenantCustomerInfo"]]),e.type==1?I((s(),i(_,{key:1,type:"danger",plain:"",size:"small",onClick:f=>be(e)},{default:r(()=>[v(p(t(o)("common.delete")),1)]),_:2},1032,["onClick"])),[[Q,"customer-delete-deleteTenantCustomer"]]):d("",!0),e.type==2?I((s(),i(_,{key:2,size:"small",type:"primary",plain:"",onClick:f=>Qe(e)},{default:r(()=>[v(p(t(o)("customer.cooperativeAllocation")),1)]),_:2},1032,["onClick"])),[[Q,"cooperation-update-updateInvitationBindUser"]]):d("",!0),e.customerStatus===2&&e.type==2?I((s(),i(_,{key:3,type:"danger",plain:"",size:"small",onClick:f=>Re(e)},{default:r(()=>[v(p(t(o)("customer.stop")),1)]),_:2},1032,["onClick"])),[[Q,"cooperation-update-updateRescindTenant"]]):d("",!0)]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["border","data","size","stripe"])),[[Me,t(L)]]),c($e,{"current-page":t(b).page,total:t(b).total,"page-size":t(b).size,"page-sizes":t(b).sizes,layout:t(b).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Ce,onCurrentChange:ne},null,8,["current-page","total","page-size","page-sizes","layout"]),c(et,{ref_key:"editRef",ref:w,onFetchData:y},null,512),c(tt,{ref_key:"QuickEditRef",ref:F,onFetchData:y},null,512),c(ot,{ref_key:"AssociatedProjectsRef",ref:pe,onFetchData:y},null,512),c(nt,{ref_key:"checkRef",ref:Y,onFetchData:y},null,512),c(at,{ref_key:"cooperationDetaiRef",ref:ee,onFetchData:y},null,512),c(st,{ref_key:"addCooperationRef",ref:se,onQueryData:y},null,512),c(lt,{ref_key:"proportionRef",ref:ae,onFetchData:y},null,512),c(rt,{ref_key:"QuickEditCooperationRef",ref:te,onFetchData:D},null,512)],2)]),_:1})}}}),fo=We(At,[["__scopeId","data-v-38f10d36"]]);export{fo as default};
