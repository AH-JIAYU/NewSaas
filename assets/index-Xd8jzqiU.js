
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as T}from"./user_cooperation-TK-zO42U.js";import{a as w}from"./department-C2Kf6LqI.js";import{d as L,r as s,a as i,o as m,b as B,i as t,e as v,w as o,f as n,g as _,j as b,ao as M,E as P,L as R}from"./index-CetDaTJ8.js";const K=L({name:"componentsQuickEdit",__name:"index",emits:["fetch-data"],setup(S,{expose:k,emit:U}){const y=U,g=s(),e=s({dialogTableVisible:!1,title:"",type:"",loading:"",formData:{},staffList:[],rules:{chargeId:[{required:!0,message:"请选择PM",trigger:"change"}]}}),c=s([]);s([]);const I={children:"children",label:"name"},u=s(),D={chargeUserId:"PM"};async function V(l,a){const r=await w.list({name:""});r.data&&(c.value=r.data),console.log(c.value,"departmentList.value"),e.value.title=D[a],e.value.type=a,e.value.loading=!0,e.value.formData=M(l),e.value.formData.chargeUserName=l.userName,e.value.formData.chargeUserId=l.userId,e.value.dialogTableVisible=!0,e.value.loading=!1}const C=(l,a)=>{a?(u.value.getCheckedKeys().forEach(d=>{d!==l.id&&u.value.setChecked(d,!1)}),e.value.formData.chargeUserId=l.id,e.value.formData.chargeUserName=l.name):(e.value.formData.chargeUserId=[e.value.formData.chargeUserId].filter(r=>r!==l.id),e.value.formData.chargeUserId.length==0&&(e.value.formData.chargeUserId="")),e.value.formData.chargeUserId||(e.value.formData.chargeUserName="")};async function x(){e.value.loading=!0,g.value.validate(async l=>{if(l){let a=JSON.parse(JSON.stringify(e.value.formData));Array.isArray(a.chargeUserId)&&(a.chargeUserId=a.chargeUserId[0]);const{status:r}=await T.updateInvitationBindUser(a);r===1&&P.success({message:"编辑成功",center:!0}),y("fetch-data"),p()}e.value.loading=!1})}function p(){e.value.dialogTableVisible=!1,e.value.formData={}}return k({showEdit:V}),(l,a)=>{const r=i("el-tree-select"),d=i("el-form-item"),N=i("el-form"),h=i("el-button"),E=i("el-dialog");return m(),B("div",null,[t(e).dialogTableVisible?(m(),v(E,{key:0,modelValue:t(e).dialogTableVisible,"onUpdate:modelValue":a[1]||(a[1]=f=>t(e).dialogTableVisible=f),title:t(e).title+"编辑",draggable:""},{footer:o(()=>[n(h,{onClick:p,disabled:t(e).loading},{default:o(()=>[_(" 取消 ")]),_:1},8,["disabled"]),n(h,{type:"primary",onClick:x,disabled:t(e).loading},{default:o(()=>[_(" 确定 ")]),_:1},8,["disabled"])]),default:o(()=>[n(N,{ref_key:"formRef",ref:g,model:t(e).formData,rules:t(e).rules,"label-width":"100","label-position":"right"},{default:o(()=>[t(e).type==="chargeUserId"?(m(),v(d,{key:0,label:"PM",prop:"chargeUserId"},{default:o(()=>[n(r,{placeholder:"请选择部门",ref_key:"treeRef",ref:u,modelValue:t(e).formData.chargeUserId,"onUpdate:modelValue":a[0]||(a[0]=f=>t(e).formData.chargeUserId=f),data:t(c),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:I,onCheckChange:C,"check-on-click-node":!0,style:{width:"37.625rem"},"expand-on-click-node":!1,clearable:""},null,8,["modelValue","data"])]),_:1})):b("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])):b("",!0)])}}}),O=R(K,[["__scopeId","data-v-6180a5ab"]]);export{O as default};
