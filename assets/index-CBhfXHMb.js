
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ce,m as O,r as u,l as pe,u as me,c as fe,n as ve,a as i,o as c,e as _,w as a,f as o,g as h,i as n,b as N,t as q,F,y,z as _e,j as G,p as Q,E as W,aH as ge,aI as he,L as ye}from"./index-D3RVrWA-.js";import{a as be}from"./department-CX8IL40m.js";import{a as Ve}from"./position_manage-Cvptat3E.js";import{u as we}from"./tenant_role-Cu6joLsP.js";import{u as ke}from"./configuration_manager-CsR-8c2x.js";import"./configuration_role-Pvc7NG3_.js";const X=g=>(ge("data-v-1c478f7d"),g=g(),he(),g),xe=X(()=>y("div",{class:"card-header"},[y("div",{class:"leftTitle"},"基本信息")],-1)),Ie={class:"card-header"},Se={class:"leftTitle"},Ee={key:0,style:{"margin-left":"20px","font-size":"14px"}},Ce=X(()=>y("div",{class:"card-header"},[y("div",{class:"leftTitle"},"角色信息")],-1)),Ne=ce({__name:"index",props:O(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:O(["success","getList"],["update:modelValue"]),setup(g,{emit:Y}){const ee=ke(),K=u([]),H=u(),ae=pe(),le=u(),te=we(),z=u(),x=u(),oe=u(!1),Z=u(),$=u(),m=g,L=Y,I=u(),B=me(g,"modelValue"),se=fe(()=>m.id===""?"新增用户":"编辑用户"),ne={children:"children",label:"name"},f=u(),re=u([]),t=u({id:m.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",organizationalStructureId:""}),p=u([]),S=u({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{validator:(d,e,s)=>{const r=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;t.value.phone?r.test(t.value.phone)?s():s(new Error("请输入合法手机号")):s()},trigger:"blur"}],email:[{validator:(d,e,s)=>{const r=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;t.value.email?r.test(t.value.email)?s():s(new Error("请输入合法邮箱")):s()},trigger:"blur"}]});function de(){t.value.email||(S.value.email=[],f.value.clearValidate("email")),t.value.phone||(S.value.phone=[],f.value.clearValidate("phone")),p.value=I.value.getCheckedKeys(!1);const d=I.value.getCheckedKeys(),e=I.value.getHalfCheckedKeys(),s=d.concat(e);t.value.organizationalStructureId=s[0],t.value.id?f.value&&f.value.validate(r=>{if(r){const{id:v,phone:P,email:U,password:b,name:V,country:w,active:M,type:R,role:A,positionId:D,organizationalStructureId:C,userName:T}=t.value,l={id:v,phone:P,email:U,password:b,name:V,country:w,active:M,type:R,role:A,positionId:D,organizationalStructureId:C,userName:T};$.value===l.phone&&delete l.phone,Z.value===l.email&&delete l.email,l.password||delete l.password,Q.edit(l).then(()=>{W.success({message:"编辑成功",center:!0}),L("success"),E()})}}):f.value&&f.value.validate(r=>{r&&Q.create(t.value).then(()=>{W.success({message:"新增成功",center:!0}),L("success"),L("getList"),E()})})}function E(){B.value=!1}const j=d=>d==null?void 0:d.reduce((e,s)=>Array.isArray(s)?e.concat(j(s)):e.concat(s),[]),ue=(d,e)=>{e?J(d.id):ie()},J=d=>{const e=s=>{s.forEach(r=>{r.disabled=r.id!==d,r.children&&e(r.children)})};e(x.value)},ie=()=>{const d=e=>{e.forEach(s=>{s.disabled=!1,s.children&&d(s.children)})};d(x.value)};return ve(async()=>{p.value=[],p.value.push(m.parentId);const{data:d}=await Ve.list({page:1,limit:10,id:null,name:"",active:null});H.value=d.data,K.value=await ee.getStaff(),z.value=await te.getRole();const e=await be.list({name:""});x.value=e.data,le.value=await ae.getCountry(),p.value.length>0&&J(p.value[0]),m.id!==""&&m.row&&(S.value.password=[],t.value=JSON.parse(m.row),p.value||(p.value=[]),p.value.push(m.parentId),Z.value=t.value.email,$.value=t.value.phone,oe.value=!0),re.value=j(m.dataList)}),(d,e)=>{const s=i("el-input"),r=i("el-form-item"),v=i("el-col"),P=i("el-option"),U=i("el-select"),b=i("el-row"),V=i("el-card"),w=i("el-text"),M=i("el-tree"),R=i("el-radio"),A=i("el-radio-group"),D=i("ElForm"),C=i("ElButton"),T=i("ElDrawer");return c(),_(T,{modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=l=>B.value=l),title:n(se),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:E},{footer:a(()=>[o(C,{size:"large",onClick:E},{default:a(()=>[h(" 取消 ")]),_:1}),o(C,{type:"primary",size:"large",onClick:de},{default:a(()=>[h(" 确定 ")]),_:1})]),default:a(()=>[o(D,{ref_key:"formRef",ref:f,model:n(t),rules:n(S),"label-width":"100px","validate-on-rule-change":!1},{default:a(()=>[o(V,{class:"box-card"},{header:a(()=>[xe]),default:a(()=>[o(b,{gutter:24},{default:a(()=>[o(v,{span:8},{default:a(()=>[o(r,{label:"用户名",prop:"userName"},{default:a(()=>[o(s,{modelValue:n(t).userName,"onUpdate:modelValue":e[0]||(e[0]=l=>n(t).userName=l),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:8},{default:a(()=>[o(r,{label:"姓名",prop:""},{default:a(()=>[o(s,{modelValue:n(t).name,"onUpdate:modelValue":e[1]||(e[1]=l=>n(t).name=l),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:8},{default:a(()=>[o(r,{label:"手机号",prop:"phone"},{default:a(()=>[o(s,{modelValue:n(t).phone,"onUpdate:modelValue":e[2]||(e[2]=l=>n(t).phone=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:8},{default:a(()=>[o(r,{label:"邮箱",prop:"email"},{default:a(()=>[o(s,{modelValue:n(t).email,"onUpdate:modelValue":e[3]||(e[3]=l=>n(t).email=l),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:8},{default:a(()=>[o(r,{label:"职位",prop:""},{default:a(()=>[o(U,{modelValue:n(t).positionId,"onUpdate:modelValue":e[4]||(e[4]=l=>n(t).positionId=l),placeholder:"请选择职位",clearable:"",filterable:"",onChange:e[5]||(e[5]=()=>{})},{default:a(()=>[(c(!0),N(F,null,q(n(H),l=>(c(),_(P,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(V,{class:"box-card"},{header:a(()=>[y("div",Ie,[y("div",Se,[h(" 部门信息"),n(t).enableChargePerson?(c(),N("span",Ee,[h("PM:"),(c(!0),N(F,null,q(n(K),l=>(c(),_(w,{key:l.id},{default:a(()=>[l.id===n(t).id?(c(),_(w,{key:0},{default:a(()=>[h(_e(l.name),1)]),_:2},1024)):G("",!0)]),_:2},1024))),128))])):G("",!0)])])]),default:a(()=>[o(b,{gutter:24},{default:a(()=>[o(r,{label:"分配部门:"},{default:a(()=>[o(M,{style:{"max-width":"600px"},ref_key:"treeRef",ref:I,data:n(x),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":n(p),"default-expand-all":"",props:ne,onCheckChange:ue},null,8,["data","default-checked-keys"])]),_:1})]),_:1})]),_:1}),o(V,{class:"box-card"},{header:a(()=>[Ce]),default:a(()=>[o(b,{gutter:24},{default:a(()=>[o(r,{label:"分配角色:"},{default:a(()=>{var l;return[(l=n(z))!=null&&l.length?(c(),_(A,{key:0,modelValue:n(t).role,"onUpdate:modelValue":e[6]||(e[6]=k=>n(t).role=k)},{default:a(()=>[(c(!0),N(F,null,q(n(z),k=>(c(),_(R,{key:k.id,value:k.roleName,label:k.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(c(),_(w,{key:1},{default:a(()=>[h("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),De=ye(Ne,[["__scopeId","data-v-1c478f7d"]]);export{De as default};
