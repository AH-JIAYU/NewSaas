
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as se,O as ie,aH as re,t as ue,r as de,G as ce,H as V,J as me,c as pe,a as u,al as fe,o as f,b as z,f as t,w as l,i as n,az as ge,F as _e,n as ve,e as b,g as p,I as ye,am as be,l as w,j as M,R as he,ak as h,aI as D,N as Ce,s as Pe,aF as Ie,aG as we,_ as Ee}from"./index-DotqEf4N.js";import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang-CKPvSRrc.js";import{_ as ke}from"./index.vue_vue_type_script_setup_true_lang-CsmqqdE0.js";import{s as C}from"./apiLoading-CvOY47jQ.js";import{a as _}from"./otherFunctions_screenLibrary-8RwamTWT.js";import{_ as Le}from"./index.vue_vue_type_script_setup_true_lang-9UQ-MNe3.js";import{u as Ve}from"./otherFunctions_basicDictionary-BZlfMuB3.js";import{u as ze}from"./useTabbar-CqaBId7R.js";import"./index-B1H8hKY3.js";import"./basicDictionary-BiDsSRtv.js";const Me=v=>(Ie("data-v-8f98610e"),v=v(),we(),v),De={m:"4"},$e=Me(()=>w("div",{m:"4"},[w("h2",null,"该国家下所有问卷")],-1)),Be=se({name:"OtherFunctionsScreenLibraryList",__name:"list",setup(v){const $=Ve(),B=ie(),{pagination:c,getParams:x,onSizeChange:N,onCurrentChange:j,onSortChange:F}=re(),T=ze(),E=ue(),e=de({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[]});ce(async()=>{d(),e.value.countryList=await $.getCountry(),e.value.formMode==="router"&&V.on("get-data-list",()=>{d()})}),me(()=>{e.value.formMode==="router"&&V.off("get-data-list")});function d(){e.value.loading=!0;const a={...x(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};_.list(a).then(o=>{e.value.loading=!1,e.value.dataList=o.data.getCountryListInfoList,c.value.total=o.data.getCountryListInfoList.length})}const U=pe(()=>e.value.dataList.slice((c.value.page-1)*c.value.size,c.value.page*c.value.size));function O(a){N(a).then(()=>d())}function y(a=1){j(a).then(()=>d())}function H({prop:a,order:o}){F(a,o).then(()=>d())}function S(a){e.value.editProps.id="",e.value.editProps.countryId=a?a.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function A(a){e.value.editProps.id=a.projectProblemCategoryId,e.value.editProps.row=JSON.stringify(a),e.value.editProps.visible=!0}async function G(a){const{status:o}=await C(_.update(a));o===1&&h.success({message:"修改「默认国家」成功",center:!0}),d()}async function J(a){const{status:o}=await C(_.edit(a));o===1&&h.success({message:"修改「状态」成功",center:!0}),d()}function K(a){e.value.formMode==="router"?E.settings.tabbar.enable&&E.settings.tabbar.mergeTabsBy!=="activeMenu"?T.open({name:"screenLibraryEdit",params:{id:a.projectProblemCategoryId}}):B.push({name:"screenLibraryEdit",params:{id:a.projectProblemCategoryId}}):(e.value.formModeProps.id=a.projectProblemCategoryId,e.value.formModeProps.details=a.details,e.value.formModeProps.visible=!0)}function R(a){D.confirm(`确认删除「${a.countryId}」吗？`,"确认信息").then(async()=>{const{status:o}=await C(_.delete({countryId:a.countryId}));o===1&&h.success({message:"删除成功",center:!0}),d()}).catch(()=>{})}function q(a){D.confirm(`确认删除「${a.categoryName}」吗？`,"确认信息").then(async()=>{const{status:o}=await C(_.delete({projectProblemCategoryId:a.projectProblemCategoryId}));o===1&&h.success({message:"删除成功",center:!0}),d()}).catch(()=>{})}return(a,o)=>{const Q=u("ElOption"),W=u("el-select"),k=u("ElFormItem"),P=Ce,m=u("ElButton"),X=u("ElForm"),Y=Se,Z=u("ElDivider"),ee=u("ElSpace"),I=u("el-table-column"),L=u("ElSwitch"),g=u("ElTableColumn"),te=u("el-table"),ae=u("ElTable"),oe=u("ElPagination"),ne=Pe,le=fe("loading");return f(),z("div",{class:he({"absolute-container":n(e).tableAutoHeight})},[t(ne,null,{default:l(()=>[t(Y,{"show-toggle":!1},{default:l(({fold:s,toggle:i})=>[t(X,{model:n(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:l(()=>[t(k,{label:"国家"},{default:l(()=>[t(W,{onKeydown:o[0]||(o[0]=ge(r=>y(),["enter"])),onClear:o[1]||(o[1]=r=>y()),filterable:"",modelValue:n(e).search.countryId,"onUpdate:modelValue":o[2]||(o[2]=r=>n(e).search.countryId=r),placeholder:"Select"},{default:l(()=>[(f(!0),z(_e,null,ve(n(e).countryList,r=>(f(),b(Q,{label:r.chineseName,value:r.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),t(k,null,{default:l(()=>[t(m,{type:"primary",onClick:o[3]||(o[3]=r=>y())},{icon:l(()=>[t(P,{name:"i-ep:search"})]),default:l(()=>[p(" 筛选 ")]),_:1}),t(m,{link:"",disabled:"",onClick:i},{icon:l(()=>[t(P,{name:s?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:l(()=>[p(" "+ye(s?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),t(Z,{"border-style":"dashed"}),t(ee,{wrap:""},{default:l(()=>[t(m,{type:"primary",size:"default",onClick:S},{icon:l(()=>[t(P,{name:"i-ep:plus"})]),default:l(()=>[p(" 新增前置问卷库 ")]),_:1})]),_:1}),be((f(),b(ae,{class:"my-4",border:"",stripe:"",data:n(U),"highlight-current-row":"",height:"100%",onSortChange:H,onSelectionChange:o[4]||(o[4]=s=>n(e).batch.selectionDataList=s)},{default:l(()=>[t(I,{type:"expand",width:"55"},{default:l(({row:s})=>[w("div",De,[$e,t(te,{data:s.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header"},{default:l(()=>[t(I,{prop:"categoryName",label:"问卷名称"}),t(g,{prop:"status",label:"状态"},{default:l(i=>[t(L,{onChange:r=>J(i.row),modelValue:i.row.status,"onUpdate:modelValue":r=>i.row.status=r,"active-value":1,"inactive-value":2},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1024),t(I,{prop:"createTime",label:"创建时间"}),t(g,{width:"250",align:"center",label:"操作",fixed:"right"},{default:l(i=>[t(m,{type:"primary",size:"small",plain:"",onClick:r=>A(i.row)},{default:l(()=>[p(" 编辑 ")]),_:2},1032,["onClick"]),t(m,{type:"primary",size:"small",plain:"",onClick:r=>K(i.row)},{default:l(()=>[p(" 设计问卷 ")]),_:2},1032,["onClick"]),t(m,{type:"danger",size:"small",plain:"",onClick:r=>q(i.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["data"])])]),_:1}),t(g,{prop:"countryName",label:"国家"}),t(g,{prop:"isDefault",label:"默认"},{default:l(s=>[t(L,{onChange:i=>G(s.row),modelValue:s.row.isDefault,"onUpdate:modelValue":i=>s.row.isDefault=i,"active-value":1,"inactive-value":2},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),t(g,{label:"操作",width:"250",align:"center",fixed:"right"},{default:l(s=>[t(m,{type:"primary",size:"small",plain:"",onClick:i=>S(s.row)},{default:l(()=>[p(" 新增问卷 ")]),_:2},1032,["onClick"]),t(m,{type:"danger",size:"small",plain:"",onClick:i=>R(s.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,n(e).loading]]),t(oe,{"current-page":n(c).page,total:n(c).total,"page-size":n(c).size,"page-sizes":n(c).sizes,layout:n(c).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:O,onCurrentChange:y},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),n(e).editProps.visible?(f(),b(Le,{key:0,id:n(e).editProps.id,countryId:n(e).editProps.countryId,modelValue:n(e).editProps.visible,"onUpdate:modelValue":o[5]||(o[5]=s=>n(e).editProps.visible=s),row:n(e).editProps.row,onSuccess:d},null,8,["id","countryId","modelValue","row"])):M("",!0),n(e).formMode==="dialog"||n(e).formMode==="drawer"?(f(),b(ke,{key:1,id:n(e).formModeProps.id,modelValue:n(e).formModeProps.visible,"onUpdate:modelValue":o[6]||(o[6]=s=>n(e).formModeProps.visible=s),mode:n(e).formMode,details:n(e).formModeProps.details,onSuccess:d},null,8,["id","modelValue","mode","details"])):M("",!0)],2)}}}),Je=Ee(Be,[["__scopeId","data-v-8f98610e"]]);export{Je as default};
