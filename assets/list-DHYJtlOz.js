
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as B,d as pe,aN as me,r as s,n as de,a as p,q as fe,o as u,b as D,f as l,w as t,g as a,s as _e,e as m,i as f,aM as be,z as r,j as _,F as R,N as ge,aO as ve,E as O,b9 as he,ba as ye,be as Ce,ao as ke,L as Se}from"./index-Dp-ZPQFq.js";import{_ as we}from"./index.vue_vue_type_style_index_0_lang-DWwoOcTW.js";import{_ as xe}from"./index-D9DTIJWi.js";import{U as Ne}from"./user_supplier-T_Qyacyq.js";import"./index.vue_vue_type_script_setup_true_lang-CSTU8XV9.js";import"./sortable.esm-C0-Qcoum.js";import"./user_supplier-BZ_6A_UP.js";const S={list:b=>B.post("bill/getTenantSupplierBillList",b),changestatus:b=>B.post("bill/updateTenantSupplierBill",b),settlement:b=>B.post("bill/addTenantSupplierBill",b)},ze=pe({name:"supplierSettlement",__name:"list",setup(b){const V=Ne(),{getParams:j,pagination:g,onSizeChange:q,onCurrentChange:Q}=me(),G=s(""),C=s(!0);s();const w=s(!1),c=s([]),x=s(!1);s(!1);const N=s("default"),z=s(!1),J=s([]),F=[{label:"待收票",value:1},{label:"待支付",value:2},{label:"已支付",value:3},{label:"已拒绝",value:4}],K=V.payMethod,P=s(),W=s("formSearch-supplierSettlement"),T=s([{label:"供应商名称",prop:"supplierName",sortable:!0,checked:!0},{label:"供应商ID",prop:"supplierId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税费",prop:"taxesFees",sortable:!0,checked:!0},{label:"实付金额",prop:"payAmount",sortable:!0,checked:!0},{label:"状态",prop:"billStatus",sortable:!0,checked:!0}]),A=s({supplierId:"",billStatus:"",time:[],beginTime:"",endTime:""}),U=s([]);function X(n){J.value=n}function Y(){Object.assign(A.value,{supplierId:"",billStatus:null,time:[],beginTime:"",endTime:""})}function Z(n){q(n).then(()=>v())}function L(n=1){Q(n).then(()=>v())}async function v(){try{C.value=!0;const n={...j(),...A.value},o=await S.list(n);U.value=o.data.tenantSupplierBillInfoList,g.value.total=o.data.total,C.value=!1}catch{}finally{C.value=!1}}const ee=async()=>{const{data:n}=await S.settlement({});n&&v()};async function I(n,o){o===3?ve.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async k=>{(await S.changestatus({id:n,type:o,notes:k.value})).status===1&&O.success({message:"操作成功"}),v()}):((await S.changestatus({id:n,type:o})).status===1&&O.success({message:"操作成功"}),v())}de(()=>{T.value.forEach(n=>{n.checked&&c.value.push(n.prop)}),v(),P.value=[{index:1,show:!0,type:"input",modelName:"supplierId",placeholder:"供应商ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"billStatus",placeholder:"状态",option:"billStatus",optionLabel:"label",optionValue:"value"}]});const te={billStatus:()=>F};return(n,o)=>{const k=xe,H=p("ElDivider"),y=p("el-button"),le=we,ae=he,oe=ye,M=p("el-row"),h=p("el-col"),i=p("el-text"),d=p("el-table-column"),E=Ce,ne=p("ElTableColumn"),se=p("el-empty"),ie=p("el-table"),ue=p("ElPagination"),re=ke,ce=fe("loading");return u(),D("div",{class:ge({"absolute-container":w.value})},[l(re,null,{default:t(()=>[l(k,{formSearchList:P.value,formSearchName:W.value,onCurrentChange:L,onOnReset:Y,model:A.value,formOption:te},null,8,["formSearchList","formSearchName","model"]),l(H,{"border-style":"dashed"}),l(M,{gutter:24},{default:t(()=>[l(le,null,{default:t(()=>[l(y,{size:"default",type:"primary",onClick:ee},{default:t(()=>[a(" 手动结算 ")]),_:1})]),_:1}),l(oe,null,{default:t(()=>[l(y,{size:"default",onClick:o[0]||(o[0]=()=>{})},{default:t(()=>[a(" 导出 ")]),_:1}),l(ae,{border:x.value,"onUpdate:border":o[1]||(o[1]=e=>x.value=e),tableAutoHeight:w.value,"onUpdate:tableAutoHeight":o[2]||(o[2]=e=>w.value=e),checkList:c.value,"onUpdate:checkList":o[3]||(o[3]=e=>c.value=e),columns:T.value,"onUpdate:columns":o[4]||(o[4]=e=>T.value=e),"line-height":N.value,"onUpdate:lineHeight":o[5]||(o[5]=e=>N.value=e),stripe:z.value,"onUpdate:stripe":o[6]||(o[6]=e=>z.value=e),style:{"margin-left":"12px"},onQueryData:L},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),_e((u(),m(ie,{ref_key:"tableSortRef",ref:G,style:{"margin-top":"10px"},"row-key":"id",data:U.value,border:x.value,size:N.value,stripe:z.value,onSelectionChange:X},{empty:t(()=>[l(se,{image:f(be),"image-size":300},null,8,["image"])]),default:t(()=>[l(d,{type:"expand"},{default:t(e=>[l(M,{gutter:20,style:{margin:"10px 0"}},{default:t(()=>[l(h,{span:1}),l(h,{span:3},{default:t(()=>[a(" 付款方式: "),l(i,{class:"fontColor"},{default:t(()=>[a(r(f(K)[e.row.billStatus-1].label),1)]),_:2},1024)]),_:2},1024),l(h,{span:3},{default:t(()=>[a("账户名称: "),l(i,{class:"fontColor"},{default:t(()=>[a(r(e.row.accountName?e.row.accountName:"-"),1)]),_:2},1024)]),_:2},1024),l(h,{span:3},{default:t(()=>[a("收款账号: "),l(i,{class:"fontColor"},{default:t(()=>[a(r(e.row.collectionAccount?e.row.collectionAccount:"-"),1)]),_:2},1024)]),_:2},1024),l(h,{span:3},{default:t(()=>[a("银行名称: "),l(i,{class:"fontColor"},{default:t(()=>[a(r(e.row.bankName?e.row.bankName:"-"),1)]),_:2},1024)]),_:2},1024),l(h,{span:3},{default:t(()=>[a("结算周期: "),l(i,{class:"fontColor"},{default:t(()=>[a(r(e.row.settlementCycle?e.row.settlementCycle:"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),c.value.includes("supplierId")?(u(),m(d,{key:0,prop:"supplierId","show-overflow-tooltip":"",align:"left",label:"供应商ID"},{default:t(({row:e})=>[l(i,{class:"fontColor"},{default:t(()=>[a(r(e.supplierId?e.supplierId:"-"),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("supplierName")?(u(),m(d,{key:1,prop:"supplierName","show-overflow-tooltip":"",align:"left",label:"供应商名称"},{default:t(({row:e})=>[l(i,{class:"fontColor"},{default:t(()=>[a(r(e.supplierName?e.supplierName:"-"),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("billTime")?(u(),m(d,{key:2,prop:"billTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:t(({row:e})=>[l(i,{class:"fontColor"},{default:t(()=>[a(r(e.billTime?e.billTime:"-"),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("billAmount")?(u(),m(d,{key:3,prop:"billAmount","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:t(({row:e})=>[l(i,{class:"fontColor"},{default:t(()=>[l(E),a(r(e.billAmount||0),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("taxesFees")?(u(),m(d,{key:4,prop:"taxesFees","show-overflow-tooltip":"",align:"left",label:"税费"},{default:t(({row:e})=>[l(i,{class:"fontColor"},{default:t(()=>[l(E),a(r(e.taxesFees||0),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("payAmount")?(u(),m(d,{key:5,prop:"payAmount","show-overflow-tooltip":"",align:"left",label:"实付金额"},{default:t(({row:e})=>[l(i,{class:"fontColor"},{default:t(()=>[l(E),a(r(e.payAmount||0),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("billStatus")?(u(),m(ne,{key:6,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:t(({row:e})=>[l(i,{class:"fontColor"},{default:t(()=>[a(r(F[e.billStatus-1].label),1)]),_:2},1024)]),_:1})):_("",!0),l(d,{align:"left",fixed:"right",label:"操作",width:"170"},{default:t(({row:e})=>[e.billStatus===1?(u(),m(y,{key:0,size:"small",plain:"",type:"primary",onClick:$=>I(e.id,1)},{default:t(()=>[a(" 确认收票 ")]),_:2},1032,["onClick"])):e.billStatus===2?(u(),D(R,{key:1},[l(y,{size:"small",plain:"",onClick:$=>I(e.id,2)},{default:t(()=>[a(" 支付 ")]),_:2},1032,["onClick"]),l(y,{size:"small",plain:"",type:"danger",onClick:$=>I(e.id,3)},{default:t(()=>[a(" 拒绝 ")]),_:2},1032,["onClick"])],64)):(u(),D(R,{key:2},[a("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[ce,C.value]]),l(ue,{"current-page":f(g).page,total:f(g).total,"page-size":f(g).size,"page-sizes":f(g).sizes,layout:f(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Z,onCurrentChange:L},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),Fe=Se(ze,[["__scopeId","data-v-32f61c22"]]);export{Fe as default};
