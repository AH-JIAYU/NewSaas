
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Me}from"./index-BaFQR1Rx.js";import{_ as Te}from"./index-CByerZZI.js";import{d as Ge,aN as Fe,r as d,l as Ae,n as J,X as U,a as v,q as He,o as r,b as $,y as _,f as i,w as o,g as h,aA as R,s as z,e as s,z as I,az as P,aq as X,F as Q,t as W,i as L,aM as Ke,j as f,aO as M,E as T,p as Y,_ as Oe,aH as je,aI as qe,L as Je,ao as Z}from"./index-DAPnvqq4.js";import{a as G}from"./department-B6hz_tvX.js";import{u as Xe}from"./department-C5X5QeHr.js";import{u as Qe}from"./position_manage-FEfwHHlv.js";import We from"./index-p2yRVkrR.js";import Ye from"./index-Dl4ZNpC1.js";import Ze from"./index-DquaJizH.js";import ea from"./index-BlfF0bpB.js";import aa from"./index-CAbAvjdZ.js";import"./index-CerRT2Wm.js";import"./position_manage-kLQ1SGBI.js";import"./tenantDictionary-BSc0H8k-.js";import"./tenant_role-DYRhgKkT.js";import"./configuration_role-MMSM_EHy.js";import"./configuration_manager-BGK1WqNr.js";const la=N=>(je("data-v-f9c29b00"),N=N(),qe(),N),ta={class:"absolute-container"},ia={class:"page-main"},oa={class:"custom-tree-node"},na=["title"],ra={class:"code"},sa={class:"actions"},ua={class:"dictionary-container"},da={class:"copyId tableSmall"},ca={class:"id oneLine"},pa={class:"dictionary-container"},va=la(()=>_("div",{class:"empty"},"请在左侧新增或选择一个部门",-1)),ma=[va],ee=Ge({name:"department",__name:"list",setup(N){const{pagination:C,getParams:ga,onSizeChange:ae,onCurrentChange:le,onSortChange:te}=Fe(),E=Qe(),F=d(),ie=Ae(),oe=d([]),x=Xe(),ne=d(),re=d([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),se=[{label:"启用",value:!0},{label:"禁用",value:!1}],D=d(!1),ue=d(),A=d(),b=d({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),H=d(),de=d(),t=d({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),K=d(),n=d({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",isClick:!1},row:"",loading:!1}),m=d({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",name:""},row:"",loading:!1});d();const u=d({loading:!1,search:{organizationalStructureId:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});async function S(){try{n.value.loading=!0;const e={...n.value.search},l=await G.list(e);n.value.tree=l.data,n.value.loading=!1}catch{}finally{n.value.loading=!1}}J(()=>{S()}),U(()=>n.value.search,e=>{K.value.filter(e)});function ce(e,l){return e?l.label.includes(e):!0}function pe(e){n.value.currentData=e,n.value.dialog.parentId="",n.value.dialog.id="",n.value.dialog.visible=!0}function ve(e){m.value.currentData=e,m.value.dialog.parentId=(e==null?void 0:e.id)??"",m.value.dialog.name=(e==null?void 0:e.name)??"",m.value.dialog.id="",m.value.dialog.visible=!0}function me(e,l){n.value.currentNode=e,n.value.currentData=l,n.value.row=JSON.stringify(l),n.value.dialog.parentId=e.parent.data.id??"",n.value.dialog.id=l.id,n.value.dialog.visible=!0,u.value.search.organizationalStructureId&&(n.value.dialog.isClick=!0)}function ge(e,l){M.confirm(`确认删除「${l.name}」吗？`,"确认信息").then(()=>{G.delete({id:l.id}).then(()=>{T.success({message:"删除成功",center:!0}),S()})})}function fe(e){C.value.page=1,e.id&&(t.value.dialog.parentId=e.id),u.value.search.organizationalStructureId=e.id}U(()=>u.value.search.organizationalStructureId,()=>{g()});async function g(){try{D.value=!0;const e={...u.value.search},l=await G.itemlist(e);l.data&&(D.value=!1,t.value.dataList=l.data,u.value.dataList.forEach(p=>{p.enableLoading=!1}),C.value.total=l.data.length||0)}catch{}finally{D.value=!1}}J(async()=>{try{b.value.loading=!0,oe.value=await ie.getCountry(),ne.value=await(x==null?void 0:x.getDepartment())||[],F.value=await(E==null?void 0:E.getPositionManage())||[],re.value.forEach(e=>{e.checked&&t.value.checkList.push(e.prop)}),b.value.loading=!1}catch{}finally{b.value.loading=!1}}),U(()=>b.value.search,e=>{ue.value.filter(e)});function he(e){return new Promise(l=>{M.confirm(`确认${e.active?"禁用":"启用"}「${e.userName}」吗？`,"确认信息").then(()=>{try{b.value.loading=!0,Y.edit({id:e.id,email:e.email,phoneNumber:e.phoneNumber,userName:e.userName,country:e.country,role:e.role,positionId:e.positionId,organizationalStructureId:e.organizationalStructureId,active:!e.active}).then(()=>(T.success({message:`${e.active?"禁用":"启用"}成功`,center:!0}),g(),b.value.loading=!1,l(!0))).catch(()=>(b.value.loading=!1,l(!1)))}catch{}finally{b.value.loading=!1}}).catch(()=>l(!1))})}function _e(e){ae(e).then(()=>{t.value.search.limit=e,g()})}function be(e=1){le(e).then(()=>{t.value.search.page=e,g()})}function ye({prop:e,order:l}){te(e,l).then(()=>g())}function ke(e){t.value.dialog.id="",t.value.dialog.visible=!0,t.value.dialog.level=1}const Ie=e=>{H.value=e[0]};function Ce(){const{name:e,id:l}=H.value;M.confirm(`确认将「${e}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{Y.reset({id:l}).then(()=>{T.success({message:"重置成功",center:!0}),g()})}).catch(()=>{})}function Se(e){t.value.row=JSON.stringify(e),t.value.dialog.id=e.id,t.value.dialog.visible=!0}function we(e){A.value.showEdit(e)}function Le(){Object.assign(t.value.search,{id:"",userName:"",departmentId:null,active:null}),g()}return(e,l)=>{const p=v("ElButton"),O=v("ElButtonGroup"),w=Oe,B=v("ElInput"),Ne=v("ElTree"),De=v("ElScrollbar"),Ve=v("el-option"),ze=v("ElSelect"),Ee=v("ElSpace"),y=v("ElTableColumn"),xe=v("ElSwitch"),Be=Te,k=v("el-text"),Ue=v("el-empty"),$e=v("ElTable"),Re=v("ElPagination"),Pe=Me,j=He("loading");return r(),$("div",ta,[_("div",ia,[i(Pe,{"hide-left-side-toggle":""},{leftSide:o(()=>[i(O,{class:"btns"},{default:o(()=>[i(p,{type:"primary",class:"add",onClick:l[0]||(l[0]=a=>pe())},{default:o(()=>[h(" 新增部门 ")]),_:1})]),_:1}),i(B,{modelValue:n.value.search.name,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.search.name=a),placeholder:"请输入关键词筛选",clearable:"",class:"search",onKeydown:R(S,["enter"])},{append:o(()=>[i(p,{onClick:S},{default:o(()=>[i(w,{name:"i-ep:search"})]),_:1})]),_:1},8,["modelValue"]),i(De,{class:"tree"},{default:o(()=>[z((r(),s(Ne,{ref_key:"dictionaryRef",ref:K,data:n.value.tree,"filter-node-method":ce,"default-expand-all":"",onNodeClick:fe},{default:o(({node:a,data:c})=>{var q;return[_("div",oa,[_("div",{class:"label",title:a.label},I(c.name),9,na),_("div",ra,I((q=c==null?void 0:c.organizationalStructurePersonList)==null?void 0:q.map(V=>V.userName).join("，")),1),_("div",sa,[i(O,null,{default:o(()=>[i(p,{type:"primary",plain:"",size:"default",onClick:P(V=>ve(c),["stop"])},{icon:o(()=>[i(w,{name:"i-ep:plus"})]),_:2},1032,["onClick"]),i(p,{type:"info",plain:"",size:"default",onClick:P(V=>me(a,c),["stop"])},{icon:o(()=>[i(w,{name:"i-ep:edit"})]),_:2},1032,["onClick"]),i(p,{type:"danger",plain:"",size:"default",onClick:P(V=>ge(a,c),["stop"])},{icon:o(()=>[i(w,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["data","filter-node-method"])),[[j,n.value.loading]])]),_:1})]),default:o(()=>[z(_("div",ua,[i(Ee,{wrap:""},{default:o(()=>[i(p,{type:"primary",onClick:l[2]||(l[2]=a=>ke())},{default:o(()=>[h(" 新增员工 ")]),_:1}),i(p,{onClick:Ce},{default:o(()=>[h(" 重置密码 ")]),_:1}),i(ze,{modelValue:t.value.search.active,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.search.active=a),"value-key":"",placeholder:"用户状态",style:{width:"200px"},clearable:"",filterable:""},{default:o(()=>[(r(),$(Q,null,W(se,a=>i(Ve,{key:a.label,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(B,{modelValue:t.value.search.id,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.search.id=a),placeholder:"员工ID",clearable:"",style:{width:"200px"},onKeydown:R(g,["enter"])},null,8,["modelValue"]),i(B,{modelValue:t.value.search.userName,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.search.userName=a),placeholder:"用户名",clearable:"",style:{width:"200px"},onKeydown:R(g,["enter"])},null,8,["modelValue"]),i(p,{type:"primary",onClick:g},{icon:o(()=>[i(w,{name:"i-ep:search"})]),_:1}),i(p,{onClick:Le},{icon:o(()=>[i(w,{name:"i-ep:refresh"})]),_:1})]),_:1}),z((r(),s($e,{ref_key:"userItemRef",ref:de,data:t.value.dataList,border:t.value.border,size:t.value.lineHeight,stripe:t.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:ye,onSelectionChange:l[6]||(l[6]=a=>t.value.selectionDataList=a),"row-key":"id","default-expand-all":"",onSelect:Ie},{empty:o(()=>[i(Ue,{image:L(Ke),"image-size":300},null,8,["image"])]),default:o(()=>[i(y,{type:"selection",align:"left",fixed:""}),t.value.checkList.includes("active")?(r(),s(y,{key:0,align:"left",prop:"active",label:"状态"},{default:o(a=>[i(xe,{modelValue:a.row.active,"onUpdate:modelValue":c=>a.row.active=c,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>he(a.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):f("",!0),t.value.checkList.includes("id")?(r(),s(y,{key:1,align:"left",width:"180",prop:"id",label:"员工ID"},{default:o(({row:a})=>[_("div",da,[_("div",ca,"ID: "+I(a.id),1),i(Be,{class:"copy",content:a.id},null,8,["content"])])]),_:1})):f("",!0),t.value.checkList.includes("userName")?(r(),s(y,{key:2,align:"left",width:"130",prop:"userName",label:"用户名"},{default:o(({row:a})=>[i(k,{class:"tableBig"},{default:o(()=>[h(I(a.userName?a.userName:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("phoneNumber")?(r(),s(y,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:o(({row:a})=>[i(k,{class:"tableBig"},{default:o(()=>[h(I(a.phoneNumber?a.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("email")?(r(),s(y,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:o(({row:a})=>[i(k,{class:"tableBig"},{default:o(()=>[h(I(a.email?a.email:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("departmentId")?(r(),s(y,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:o(({row:a})=>[i(k,{class:"tableBig"},{default:o(()=>[h(I(a.organizationalStructureName?a.organizationalStructureName:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("positionId")?(r(),s(y,{key:6,align:"left",prop:"positionId",label:"职位"},{default:o(({row:a})=>[a.positionId?(r(),s(k,{key:0,class:"tableBig"},{default:o(()=>[(r(!0),$(Q,null,W(F.value,c=>(r(),s(k,null,{default:o(()=>[a.positionId===c.id?(r(),s(k,{key:0},{default:o(()=>[h(I(c.name?c.name:"-"),1)]),_:2},1024)):f("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),s(k,{key:1,class:"tableBig"},{default:o(()=>[h("-")]),_:1}))]),_:1})):f("",!0),i(y,{label:"操作",fixed:"right",width:"200",align:"left"},{default:o(a=>[i(p,{type:"primary",size:"small",plain:"",onClick:c=>Se(a.row)},{default:o(()=>[h(" 编辑 ")]),_:2},1032,["onClick"]),i(p,{type:"warning",size:"small",plain:"",onClick:c=>we(a.row)},{default:o(()=>[h(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"])),[[j,D.value]]),i(Re,{"current-page":L(C).page,total:L(C).total,"page-size":L(C).size,"page-sizes":L(C).sizes,layout:L(C).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:_e,onCurrentChange:be},null,8,["current-page","total","page-size","page-sizes","layout"])],512),[[X,u.value.search.organizationalStructureId]]),z(_("div",pa,ma,512),[[X,!u.value.search.organizationalStructureId]])]),_:1}),n.value.dialog.visible?(r(),s(We,{key:0,id:n.value.dialog.id,modelValue:n.value.dialog.visible,"onUpdate:modelValue":l[7]||(l[7]=a=>n.value.dialog.visible=a),row:n.value.row,"parent-id":n.value.dialog.parentId,tree:n.value.tree,isClick:n.value.dialog.isClick,onGetList:S,onGetItmelist:g},null,8,["id","modelValue","row","parent-id","tree","isClick"])):f("",!0),m.value.dialog.visible?(r(),s(Ye,{key:1,id:m.value.dialog.id,modelValue:m.value.dialog.visible,"onUpdate:modelValue":l[8]||(l[8]=a=>m.value.dialog.visible=a),row:m.value.row,"parent-id":m.value.dialog.parentId,name:m.value.dialog.name,tree:m.value.tree,onGetList:S},null,8,["id","modelValue","row","parent-id","name","tree"])):f("",!0),u.value.dialog.visible?(r(),s(Ze,{key:2,id:u.value.dialog.id,modelValue:u.value.dialog.visible,"onUpdate:modelValue":l[9]||(l[9]=a=>u.value.dialog.visible=a),"catalogue-id":u.value.search.organizationalStructureId,"parent-id":u.value.dialog.parentId,level:u.value.dialog.level,tree:n.value.tree,dataList:u.value.dataList,row:u.value.row,onSuccess:g},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):f("",!0),t.value.dialog.visible?(r(),s(ea,{key:3,id:t.value.dialog.id,modelValue:t.value.dialog.visible,"onUpdate:modelValue":l[10]||(l[10]=a=>t.value.dialog.visible=a),"catalogue-id":t.value.search.catalogueId,"parent-id":t.value.dialog.parentId,level:t.value.dialog.level,tree:b.value.tree,dataList:t.value.dataList,row:t.value.row,onSuccess:g,onGetList:S},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):f("",!0),i(aa,{ref_key:"detailRef",ref:A},null,512)])])}}});typeof Z=="function"&&Z(ee);const Ba=Je(ee,[["__scopeId","data-v-f9c29b00"]]);export{Ba as default};
