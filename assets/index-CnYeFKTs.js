
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as K,aN as Q,r as v,a as s,q as R,s as z,o as f,e as m,w as t,f as a,b as W,t as X,F as Y,i as d,aM as Z,g as i,z as r,bf as ee,p as ae,be as te,aH as le,aI as oe,y as C,L as ne}from"./index-Cj0XdJq_.js";import{a as se}from"./financial_pm_log-59fIP4AQ.js";const E=g=>(le("data-v-54dc63a3"),g=g(),oe(),g),ie=E(()=>C("div",{class:"minusSign i-iconamoon:sign-minus-bold w-1em h-1em"},null,-1)),re=E(()=>C("div",{class:"plusSpan i-typcn:plus w-1em h-1em"},null,-1)),ce=K({__name:"index",emits:["fetch-data"],setup(g,{expose:x,emit:k}){const{format:D}=ee(),T=k,{pagination:p,getParams:ue,onSizeChange:N,onCurrentChange:V,onSortChange:de}=Q(),y=v([]),l=v({loading:!1,activeName:"myFinancial",tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,userId:null,organizationalStructureId:null}}),_=v(!1),w=v();async function B(o){if(o.organizationalStructureId){l.value.search.organizationalStructureId=o.organizationalStructureId,await b();const n=await ae.queryNotEnableStaffList({organizationalStructureId:l.value.search.organizationalStructureId});y.value=n.data}_.value=!0}const b=async()=>{try{l.value.loading=!0;const o={...l.value.search},n=await se.getStaffFinancial(o);w.value=n.data.userList,p.value.total=+n.data.total,l.value.loading=!1}catch{}finally{l.value.loading=!1}};function F(o){N(o).then(()=>{l.value.search.limit=o,b()})}function I(o=1){V(o).then(()=>{l.value.search.page=o,b()})}function L(){T("fetch-data"),Object.assign(l.value.search,{page:1,limit:10,userId:null,organizationalStructureId:null}),_.value=!1}return x({showEdit:B}),(o,n)=>{const M=s("ElDivider"),P=s("el-option"),j=s("el-select"),H=s("ElFormItem"),U=s("ElForm"),c=s("el-text"),u=s("ElTableColumn"),h=te,q=s("el-tag"),A=s("el-tooltip"),$=s("el-empty"),O=s("ElTable"),G=s("ElPagination"),J=s("el-drawer"),S=R("loading");return z((f(),m(J,{modelValue:_.value,"onUpdate:modelValue":n[3]||(n[3]=e=>_.value=e),"append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:"财务日志",onClose:L},{default:t(()=>[a(M,{"border-style":"dashed"}),a(U,{model:l.value.search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:t(()=>[a(H,null,{default:t(()=>[a(j,{style:{width:"10.5rem"},modelValue:l.value.search.userId,"onUpdate:modelValue":n[0]||(n[0]=e=>l.value.search.userId=e),placeholder:"请选择员工",clearable:"",filterable:"",onChange:n[1]||(n[1]=e=>I())},{default:t(()=>[(f(!0),W(Y,null,X(y.value,e=>(f(),m(P,{key:e.id,label:e.userName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),z((f(),m(O,{border:l.value.border,size:l.value.lineHeight,stripe:l.value.stripe,class:"my-4",data:w.value,"highlight-current-row":"",onSortChange:o.sortChange,onSelectionChange:n[2]||(n[2]=e=>l.value.batch.selectionDataList=e)},{empty:t(()=>[a($,{image:d(Z),"image-size":300},null,8,["image"])]),default:t(()=>[a(u,{"show-overflow-tooltip":"",align:"left",prop:"",label:"点击ID"},{default:t(({row:e})=>[a(c,{class:"color3"},{default:t(()=>[i(r(e.clientId?e.clientId:"-"),1)]),_:2},1024)]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"projectId",label:"项目ID"},{default:t(({row:e})=>[a(c,{class:"color3"},{default:t(()=>[i(r(e.projectId?e.projectId:"-"),1)]),_:2},1024)]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"",label:"PM"},{default:t(({row:e})=>[a(c,{class:"color3"},{default:t(()=>[i(r(e.userName?e.userName:"-"),1)]),_:2},1024)]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"remark",label:"业绩"},{default:t(({row:e})=>[a(c,{class:"mx-1 color3"},{default:t(()=>[i(r(e.doMoney?e.doMoney:"-"),1)]),_:2},1024)]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"remark",label:"说明"},{default:t(({row:e})=>[a(c,{class:"mx-1 color3"},{default:t(()=>[i(r(e.remark?e.remark:"-"),1)]),_:2},1024)]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"beforeBalance",width:"150",label:"变动前"},{default:t(({row:e})=>[a(h),a(c,{class:"mx-1 color3"},{default:t(()=>[i(r(e.beforeBalance||0),1)]),_:2},1024)]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"addAndSubtraction",width:"150",label:"提成"},{default:t(({row:e})=>[e.type===2?(f(),m(c,{key:0,type:"",class:"mx-1 color3"},{default:t(()=>[ie,a(h),i(r(Math.abs(e.difference)),1)]),_:2},1024)):(f(),m(c,{key:1,type:"",class:"mx-1 color3"},{default:t(()=>[re,a(h),i(r(Math.abs(e.difference)),1)]),_:2},1024))]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"afterBalance",width:"150",label:"变动后"},{default:t(({row:e})=>[a(h),a(c,{class:"color3"},{default:t(()=>[i(r(e.afterBalance||0),1)]),_:2},1024)]),_:1}),a(u,{"show-overflow-tooltip":"",align:"left",prop:"createTime",label:"时间"},{default:t(({row:e})=>[a(A,{content:e.createTime,placement:"top"},{default:t(()=>[a(q,{effect:"plain",type:"info"},{default:t(()=>[i(r(d(D)(e.createTime)),1)]),_:2},1024)]),_:2},1032,["content"])]),_:1})]),_:1},8,["border","size","stripe","data","onSortChange"])),[[S,l.value.loading]]),a(G,{"current-page":d(p).page,total:d(p).total,"page-size":d(p).size,"page-sizes":d(p).sizes,layout:d(p).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:F,onCurrentChange:I},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1},8,["modelValue"])),[[S,l.value.loading]])}}}),me=ne(ce,[["__scopeId","data-v-54dc63a3"]]);export{me as default};
