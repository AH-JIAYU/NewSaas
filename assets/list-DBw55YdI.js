
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as w,d as ne,a1 as se,r as m,l as ue,b as i,q as ie,s as re,o as P,e as A,g as e,w as l,S as de,j as me,bl as pe,t as y,h as c,H as fe,E as g,a0 as ve,aB as ce,ap as _e,aI as ge,aJ as ye,R as be}from"./index-BOIe6JP6.js";import{u as Ve}from"./index-hpqloOh1.js";import we from"./index-CE_4WHgh.js";import"./clipboard-D3hS4yrL.js";const D={list:()=>w.post("tenant-web-config/getTenantWebConfig"),edit:r=>w.post("tenant-web-config/updateTenantWebConfig",r),getTenantWebConfigQueryAnalysis:r=>w.post("tenant-web-config/getTenantWebConfigQueryAnalysis",r)},he={getTenantLogo:r=>w.post("tenant-logo/getTenantLogo",r),uploadLogo:r=>w.post("tenant-logo/upload",r)},h=r=>(ge("data-v-9ff1e95f"),r=r(),ye(),r),xe=h(()=>y("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Le=["src"],Ne={key:0},De=h(()=>y("span",{class:"red"},null,-1)),Ce=h(()=>y("span",{style:{"margin-right":"10px"}},"已生效",-1)),Ee=[De,Ce],Ue={key:1},Oe=h(()=>y("span",{class:"green"},null,-1)),ke=h(()=>y("span",{style:{"margin-right":"10px"}},"未生效",-1)),Te=[Oe,ke],Pe=ne({name:"site_setting",__name:"list",setup(r){const b=se(),R=m(),M="https://saas-api.surveysaas.com/tenant-logo/upload",{toClipboard:S}=Ve(),q=m("基本设置"),v=m(!1),_=m(),x=m(!1),C=m(),t=m({id:"",registerOffOrOn:!0,registerExamineOffOrOn:!1,keyWords:"",webName:"",topLevelDomainName:"",defaultPriceRatio:null,taxRate:null,minimumAmount:null,phone:"",email:"",qqCode:"",address:""}),L=m({webName:[{required:!0,message:"请输入网站名称",trigger:"blur"}],topLevelDomainName:[{required:!1,message:"请输入顶级域名",trigger:"submit"},{validator:(n,a,d)=>{new RegExp("^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(?:\\.[A-Za-z0-9-]{1,63}(?<!-))*\\.[A-Za-z]{2,}$").test(a)?d():d(new Error("请输入合法的域名"))},trigger:"submit"}],phone:[{required:!1,trigger:"submit",message:"请输入手机号"},{validator:(n,a,d)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(t.value.phone)?d():d(new Error("请输入合法手机号"))},trigger:"submit"}],email:[{required:!1,trigger:"submit",message:"请输入邮箱"},{validator:(n,a,d)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.value.email)?d():d(new Error("请输入合法邮箱"))},trigger:"submit"}]});ue(()=>{v.value=!0,b.logo&&(f.value=[{name:"logo",url:b.logo}]),E(),v.value=!1});async function E(){try{const{data:n}=await D.list();if(t.value=n||t.value,t.value.topLevelDomainName!==""&&t.value.topLevelDomainName!==null){const a=await D.getTenantWebConfigQueryAnalysis({url:t.value.topLevelDomainName});x.value=a.data.success}}catch{}finally{v.value=!1}}const W=async()=>{var a;f.value=[];const n=await he.getTenantLogo();n.data&&(b.setLogo(n.data.logoUrl),f.value.push({name:"file",url:(a=n==null?void 0:n.data)==null?void 0:a.logoUrl}))},Q=async n=>{if(t.value.topLevelDomainName!==""&&t.value.topLevelDomainName!==null){const a=await D.getTenantWebConfigQueryAnalysis({url:t.value.topLevelDomainName});a.data.success===!1?(x.value=a.data.success,C.value=a,g({type:"warning",message:"解析未生效"})):(x.value=a.data.success,C.value=a,g({type:"warning",message:"解析已生效"}))}},$=()=>{R.value.showEdit(C.value)},B=()=>{const n=t.value.personalizedDomainName;S(n),g({type:"success",message:"复制成功"})},Z=b.token,G=m({Token:Z}),z=m(""),U=m(!1),f=m([]),J=async()=>{g.success({message:"删除成功",center:!0}),b.delLogo()},j=(n,a)=>{n.status===-1?(ve.error(n.error,{zIndex:2e3}),f.value=f.value.filter(d=>d.name!==a.name)):W()},F=async()=>{g.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},H=n=>{z.value=n.url,U.value=!0};function O(){(t.value.email===""||t.value.email===null)&&(L.value.email=[],_.value.clearValidate("email")),(t.value.phone===""||t.value.phone===null)&&(L.value.phone=[],_.value.clearValidate("phone")),(t.value.topLevelDomainName===""||t.value.topLevelDomainName===null)&&(L.value.topLevelDomainName=[],_.value.clearValidate("topLevelDomainName")),_.value&&_.value.validate(async n=>{if(n)try{v.value=!0,t.value.topLevelDomainName&&(t.value.topLevelDomainName=t.value.topLevelDomainName.replace(/^(https?:\/\/|www\.)/,""));const a=await D.edit(t.value);v.value=!1,a.status===1&&(E(),g.success({message:"修改成功",center:!0}))}catch(a){console.log("error",a)}finally{v.value=!1}})}return(n,a)=>{const d=ce,N=i("el-icon"),K=i("el-upload"),X=i("el-dialog"),Y=i("ElFormItem"),s=i("el-col"),I=i("el-switch"),u=i("el-form-item"),p=i("el-input"),ee=i("el-text"),V=i("el-button"),k=i("el-row"),T=i("el-tab-pane"),le=i("el-form"),ae=i("el-tabs"),te=_e,oe=ie("loading");return re((P(),A("div",null,[e(d,{title:"站点设置管理"}),e(te,null,{default:l(()=>[e(ae,{modelValue:q.value,"onUpdate:modelValue":a[14]||(a[14]=o=>q.value=o)},{default:l(()=>[e(le,{ref_key:"formRef",ref:_,model:t.value,rules:L.value,"label-width":"100px","label-position":"right",inline:!1},{default:l(()=>[e(T,{label:"基础设置",name:"基本设置"},{default:l(()=>[e(k,{gutter:20},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(Y,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"网址Logo"},{default:l(()=>[e(K,{class:de({hide_box:f.value.length}),"file-list":f.value,"onUpdate:fileList":a[0]||(a[0]=o=>f.value=o),headers:G.value,action:M,"list-type":"picture-card",limit:1,"on-preview":H,"on-remove":J,"on-success":j,"on-exceed":F},{tip:l(()=>[xe]),default:l(()=>[e(N,{class:"el-icon--upload"},{default:l(()=>[e(me(pe))]),_:1})]),_:1},8,["class","file-list","headers"]),e(X,{modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=o=>U.value=o),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:l(()=>[y("img",{"w-full":"",src:z.value,alt:"Preview Image"},null,8,Le)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:3},{default:l(()=>[e(u,{label:"注册开关"},{default:l(()=>[e(I,{modelValue:t.value.registerOffOrOn,"onUpdate:modelValue":a[2]||(a[2]=o=>t.value.registerOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:6},{default:l(()=>[e(u,{label:"注册审核"},{default:l(()=>[e(I,{modelValue:t.value.registerExamineOffOrOn,"onUpdate:modelValue":a[3]||(a[3]=o=>t.value.registerExamineOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"网站名称",prop:"webName"},{default:l(()=>[e(p,{modelValue:t.value.webName,"onUpdate:modelValue":a[4]||(a[4]=o=>t.value.webName=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"网站关键字"},{default:l(()=>[e(p,{modelValue:t.value.keyWords,"onUpdate:modelValue":a[5]||(a[5]=o=>t.value.keyWords=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"网站描述"},{default:l(()=>[e(p,{modelValue:t.value.description,"onUpdate:modelValue":a[6]||(a[6]=o=>t.value.description=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"个性化域名",prop:""},{default:l(()=>[e(ee,{class:"mx-1"},{default:l(()=>[c(fe(t.value.personalizedDomainName),1)]),_:1}),e(V,{class:"copy",type:"primary",link:"",onClick:B},{default:l(()=>[c("复制")]),_:1})]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"顶级域名",prop:"topLevelDomainName"},{default:l(()=>[e(p,{modelValue:t.value.topLevelDomainName,"onUpdate:modelValue":a[7]||(a[7]=o=>t.value.topLevelDomainName=o),style:{width:"18rem"},onMouseleave:Q},null,8,["modelValue"]),x.value?(P(),A("div",Ne,Ee)):(P(),A("div",Ue,Te)),e(V,{class:"copy",onClick:$,type:"primary",link:""},{default:l(()=>[c("CNAME配置")]),_:1})]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(V,{type:"primary",onClick:O},{default:l(()=>[c(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{label:"高级设置",name:"高级设置"},{default:l(()=>[e(k,{gutter:20},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(u,{label:"最低结算金额",prop:""},{default:l(()=>[e(p,{modelValue:t.value.minimumAmount,"onUpdate:modelValue":a[8]||(a[8]=o=>t.value.minimumAmount=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"供应商税点",prop:""},{default:l(()=>[e(p,{modelValue:t.value.taxRate,"onUpdate:modelValue":a[9]||(a[9]=o=>t.value.taxRate=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},{append:l(()=>[c("%")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(V,{type:"primary",onClick:O},{default:l(()=>[c(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{label:"联系我们",name:"联系我们"},{default:l(()=>[e(k,{gutter:20},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(u,{label:"电子邮箱",prop:"email"},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.email,"onUpdate:modelValue":a[10]||(a[10]=o=>t.value.email=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"手机号码",prop:"phone"},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.phone,"onUpdate:modelValue":a[11]||(a[11]=o=>t.value.phone=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"QQ号码",prop:""},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.qqCode,"onUpdate:modelValue":a[12]||(a[12]=o=>t.value.qqCode=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"公司地址",prop:""},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.address,"onUpdate:modelValue":a[13]||(a[13]=o=>t.value.address=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(V,{type:"primary",onClick:O},{default:l(()=>[c("确认")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1}),e(we,{ref_key:"recordRef",ref:R,onFetchData:E},null,512)])),[[oe,v.value]])}}}),We=be(Pe,[["__scopeId","data-v-9ff1e95f"]]);export{We as default};
