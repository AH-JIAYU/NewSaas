
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as L,r as d,k as D,n as M,l as R,E as g,a as i,p as B,q as p,i as a,o as b,b as w,f as o,w as s,F as I,t as A,aq as V,g as J,M as O}from"./index--d-k_wOm.js";import{a as y}from"./department-DAbjezxk.js";const P=L({__name:"index",props:["id","row"],setup(x,{expose:S}){const f=x,E=[{label:"完成计提",value:1},{label:"审核计提",value:2},{label:"收款计提",value:3}],T=d([]),r=d(!1),u=d(),e=d({id:f.id,name:"",remark:"",commissionStatus:2,commission:null,commissionType:null});d(!1);const v=d({name:[{required:!0,message:"请输入部门名称",trigger:"blur"}],director:[{required:!0,message:"请选择部门主管",trigger:"change"}],commission:[{required:!0,message:"请输入提成比例",trigger:"blur"},{validator:(m,l,n)=>{l?/^\d+(\.\d+)?$/.test(l)?parseFloat(l)>100?n(new Error("数字不能超过100")):n():n(new Error("请输入有效的数字")):n(new Error("请输入数字"))},trigger:"blur"}]});D(()=>{u.value.resetFields(),M(async()=>{const{data:m}=await R.getTenantStaffList();T.value=m}),e.value.id!==""&&k()});function k(){r.value=!0,e.value=JSON.parse(f.row),r.value=!1}return S({submit(){return new Promise(m=>{try{e.value.commissionStatus!==1&&(v.value.commission=[]),e.value.id===""?u.value&&u.value.validate(l=>{if(l)try{delete e.value.memberCount,r.value=!0,y.create(e.value).then(()=>{r.value=!1,g.success({message:"新增成功",center:!0}),m()})}catch{}finally{r.value=!1}}):u.value&&u.value.validate(l=>{if(l)try{r.value=!0,delete e.value.memberCount,y.edit(e.value).then(()=>{r.value=!1,g.success({message:"编辑成功",center:!0}),m()})}catch{}finally{r.value=!1}})}catch{}finally{setTimeout(()=>{r.value=!1},1e3)}})}}),(m,l)=>{const n=i("el-input"),c=i("el-form-item"),F=i("el-switch"),_=i("el-col"),h=i("el-option"),C=i("el-select"),q=i("el-row"),N=i("ElForm"),U=B("loading");return p((b(),w("div",null,[o(N,{ref_key:"formRef",ref:u,model:a(e),rules:a(v),"label-width":"130px"},{default:s(()=>[o(c,{label:"部门名称",prop:"name"},{default:s(()=>[o(n,{modelValue:a(e).name,"onUpdate:modelValue":l[0]||(l[0]=t=>a(e).name=t),placeholder:"请输入部门名称",clearable:"",onChange:l[1]||(l[1]=()=>{})},null,8,["modelValue"])]),_:1}),o(q,{style:{"margin-bottom":"0px"},gutter:20},{default:s(()=>[o(_,{span:8},{default:s(()=>[o(c,{label:"部门提成",prop:"commissionStatus"},{default:s(()=>[o(F,{modelValue:a(e).commissionStatus,"onUpdate:modelValue":l[2]||(l[2]=t=>a(e).commissionStatus=t),"active-text":"启用","inactive-text":"禁用","inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1})]),_:1}),o(_,{span:16},{default:s(()=>[p(o(c,{label:"提成发放规则",prop:"commissionType"},{default:s(()=>[o(C,{modelValue:a(e).commissionType,"onUpdate:modelValue":l[3]||(l[3]=t=>a(e).commissionType=t),"value-key":"",placeholder:"请选择发放提成方式",clearable:"",filterable:""},{default:s(()=>[(b(),w(I,null,A(E,t=>o(h,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},512),[[V,a(e).commissionStatus===1]])]),_:1})]),_:1}),p(o(c,{label:"提成比例",prop:"commission"},{default:s(()=>[o(n,{modelValue:a(e).commission,"onUpdate:modelValue":l[4]||(l[4]=t=>a(e).commission=t),placeholder:"请输入提成比例",clearable:""},{append:s(()=>[J("%")]),_:1},8,["modelValue"])]),_:1},512),[[V,a(e).commissionStatus===1]]),o(c,{label:"备注"},{default:s(()=>[o(n,{modelValue:a(e).remark,"onUpdate:modelValue":l[5]||(l[5]=t=>a(e).remark=t),type:"textarea",rows:10,placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[U,a(r)]])}}}),G=O(P,[["__scopeId","data-v-970885fb"]]);export{G as default};
