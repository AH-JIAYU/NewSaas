
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as R,s as k}from"./apiLoading-C4xnAioP.js";import{_ as j}from"./index.vue_vue_type_script_setup_true_lang-DqMZZFt3.js";import{a as b}from"./survey_vip-DzkY4y55.js";import{u as M}from"./stagedData-Catj8Brx.js";import{u as A}from"./survey_vip-DBIFCIpL.js";import{d as G,r as i,a2 as O,a3 as u,a as h,o as V,b as P,f as d,w as c,g,e as U,j as $,i as q,N as F,an as H,E as f}from"./index-DUXFfjMZ.js";const ee=G({__name:"index",emits:["fetch-data","getList","getItemlist"],setup(J,{expose:C,emit:L}){const m=M(),v=A(),p=L,o=i(!1),l=i(""),_=i(),n=i([]),r=i([]);function D(e){r.value.push(e)}const w=i(!1);O("validateTopTabs",D);let t=u([]);async function N(e,s){if(s&&(w.value=!0),!e)l.value="新增",v.initialTopTabsData.memberGroupId=s,t=m.surveyVip||u([{...v.initialTopTabsData}]);else{l.value="编辑";const{data:a}=await R(b.detail({memberId:e.memberId}));S(a)}n.value=[],o.value=!0}function S(e){t=u([]),t.push({...e})}function x(){m.surveyVip=H(t),t=u([]),o.value=!1,r.value=[]}function y(){t=u([]),o.value=!1,r.value=[],l.value==="新增"&&(m.surveyVip=null)}async function T(){const e=[];r.value.forEach(a=>{e.push(a.validate())});const s=await Promise.allSettled(e);n.value=s.map(a=>a.status)}function E(e){const s=new Set;for(const a of e){if(s.has(a.memberNickname))return!0;s.add(a.memberNickname)}return!1}async function I(){if(await T(),n.value.every(e=>e==="fulfilled"))if(E(t))f.warning({message:"会员名称重复",center:!0});else{if(l.value==="新增"){const{status:e}=await k(b.create({addMemberInfoList:t}));e===1&&f.success({message:"新增成功",center:!0})}else{const{status:e}=await k(b.edit(t[0]));e===1&&f.success({message:"修改成功",center:!0})}w.value?(p("getList"),p("getItemlist")):p("fetch-data"),v.NickNameList=null,y()}else _.value.activeLeftTab=n.value.indexOf("rejected"),f.warning({message:"请完善表单",center:!0})}return C({showEdit:N}),(e,s)=>{const a=h("el-button"),z=h("el-drawer");return V(),P("div",null,[d(z,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=B=>o.value=B),class:F(l.value==="新增"?"hide-drawer-header":"edit-drawer"),"append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"60%"},{footer:c(()=>[d(a,{onClick:y},{default:c(()=>[g(" 取消 ")]),_:1}),l.value==="新增"?(V(),U(a,{key:0,type:"warning",onClick:x},{default:c(()=>[g(" 暂存 ")]),_:1})):$("",!0),d(a,{type:"primary",onClick:I},{default:c(()=>[g(" 确定 ")]),_:1})]),default:c(()=>[d(j,{onValidate:T,ref_key:"LeftTabsRef",ref:_,title:l.value,"left-tabs-data":q(t),"validate-top-tabs":r.value,"validate-all":n.value},null,8,["title","left-tabs-data","validate-top-tabs","validate-all"])]),_:1},8,["modelValue","class"])])}}});export{ee as _};
