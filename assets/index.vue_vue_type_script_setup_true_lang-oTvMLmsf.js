
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as f,d as J,r as G,a3 as P,a as u,o as i,b as I,f as r,w as l,C as y,g,i as t,e as n,F as N,n as T,D as x,j as b,am as w,aE as C,G as K,an as Q,E as D}from"./index-CVaGN61L.js";import{o as U,s as E}from"./apiLoading-fzwUE5-0.js";const h={list:p=>f.post("projectDispatch/getProjectDispatchList",p),getProjectList:p=>f.post("projectDispatch/getNotDispatchProjectList",p),create:p=>f.post("projectDispatch/addProjectDispatch",p),edit:p=>f.post("projectDispatch/updateProjectDispatch",p),delete:p=>f.post("projectDispatch/deleteProjectDispatch",p),getAllocationGroupOrSupplier:p=>f.post("projectDispatch/getAllocationGroupOrSupplier",p)},W={style:{float:"left"}},X={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Y={style:{flex:"auto"}},te=J({name:"Edit",__name:"index",emits:["fetch-data"],setup(p,{expose:M,emit:z}){const A=z,_=G(),q=P({projectId:[{required:!0,message:"请选择项目",trigger:"change"}],dispatchType:[{required:!0,message:"请选择调度类型",trigger:"change"}],dataType:[{required:!0,message:"请选择调度目标",trigger:"change"}],groupSupplierId:[{required:!0,message:"请选择至少一个",trigger:"change"}]}),d=G(!1),e=P({title:"",projectList:[],memberGroupNameInfoList:[],supplierNameInfoList:[],form:{projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""}});async function B(s,o){const c=await U(h.getProjectList({}));e.projectList=c.data.getNotDispatchProjectInfoList,o?s.isDispatch===1?D.warning({message:"该项目已经调度，请前往「项目调度」进行编辑",center:!0}):(e.title="添加",e.form.projectId=s.projectId,await j(s.projectId),d.value=!0):(s?(e.title="编辑",e.form=Q(s),await j(s.projectId)):e.title="添加",d.value=!0)}const j=async s=>{if(s){const o=await U(h.getAllocationGroupOrSupplier({projectId:s}));e.memberGroupNameInfoList=o.data.getAllocationMemberGroupNameInfoList,e.supplierNameInfoList=o.data.getAllocationSupplierNameInfoList,e.supplierNameInfoList.length&&!e.memberGroupNameInfoList.length&&(e.form.dataType=1),!e.supplierNameInfoList.length&&e.memberGroupNameInfoList.length&&(e.form.dataType=2)}},F=()=>{e.form.groupSupplierId=[],_.value.clearValidate(["groupSupplierId"])};function L(){_.value.resetFields(),e.form={projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},d.value=!1}function O(){_.value&&_.value.validate(async s=>{if(s){if(e.title==="添加"){const{status:o}=await E(h.create(e.form));o===1&&D.success({message:"添加成功"})}else{const{status:o}=await E(h.edit(e.form));o===1&&D.success({message:"修改成功"})}L(),A("fetch-data")}})}return M({showEdit:B}),(s,o)=>{const c=u("el-radio"),S=u("el-radio-group"),m=u("el-form-item"),V=u("el-option"),v=u("el-select"),R=u("el-input"),H=u("el-form"),k=u("el-button"),$=u("el-dialog");return i(),I("div",null,[r($,{modelValue:t(d),"onUpdate:modelValue":o[6]||(o[6]=a=>K(d)?d.value=a:null),title:t(e).title,width:"600","before-close":L},{footer:l(()=>[y("div",Y,[r(k,{onClick:L},{default:l(()=>[g(" 取消 ")]),_:1}),r(k,{type:"primary",onClick:O},{default:l(()=>[g(" 确定 ")]),_:1})])]),default:l(()=>[r(H,{ref_key:"formRef",ref:_,"label-width":"130px",model:t(e).form,rules:t(q),inline:!1},{default:l(()=>[r(m,{label:"调度类型",prop:"dispatchType",style:{"align-items":"center"}},{default:l(()=>[r(S,{modelValue:t(e).form.dispatchType,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).form.dispatchType=a),class:"ml-4"},{default:l(()=>[r(c,{value:1,size:"large"},{default:l(()=>[g(" 指定关闭 ")]),_:1}),r(c,{value:2,size:"large"},{default:l(()=>[g(" 指定价格 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e).title==="添加"?(i(),n(m,{key:0,label:"项目ID/名称",prop:"projectId"},{default:l(()=>[r(v,{placeholder:"",modelValue:t(e).form.projectId,"onUpdate:modelValue":o[1]||(o[1]=a=>t(e).form.projectId=a),clearable:"",filterable:"",onChange:j},{default:l(()=>[(i(!0),I(N,null,T(t(e).projectList,a=>(i(),n(V,{key:a.projectId,label:a.projectName,value:a.projectId},{default:l(()=>[y("span",W,x(a.projectName),1),y("span",X,x(a.projectId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),w(y("div",null,[w(r(m,{prop:"dataType",label:"调度目标",style:{"align-items":"center"}},{default:l(()=>[r(S,{modelValue:t(e).form.dataType,"onUpdate:modelValue":o[2]||(o[2]=a=>t(e).form.dataType=a),class:"ml-4",onChange:F},{default:l(()=>[r(c,{value:1,size:"large"},{default:l(()=>[g(" 供应商 ")]),_:1}),r(c,{value:2,size:"large"},{default:l(()=>[g(" 会员组 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[C,t(e).supplierNameInfoList.length&&t(e).memberGroupNameInfoList.length]]),t(e).supplierNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===1?(i(),n(m,{key:0,label:"供应商",prop:"groupSupplierId"},{default:l(()=>[r(v,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":o[3]||(o[3]=a=>t(e).form.groupSupplierId=a),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:l(()=>[(i(!0),I(N,null,T(t(e).supplierNameInfoList,a=>(i(),n(V,{key:a.projectId,label:a.supplierName,value:a.supplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),t(e).memberGroupNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===2?(i(),n(m,{key:1,label:"会员组",prop:"groupSupplierId"},{default:l(()=>[r(v,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":o[4]||(o[4]=a=>t(e).form.groupSupplierId=a),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:l(()=>[(i(!0),I(N,null,T(t(e).memberGroupNameInfoList,a=>(i(),n(V,{key:a.projectId,label:a.memberGroupName,value:a.memberGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0)],512),[[C,t(e).form.projectId]]),t(e).form.dispatchType===2?(i(),n(m,{key:1,label:"指定价格"},{default:l(()=>[r(R,{placeholder:"",modelValue:t(e).form.doMoneyPrice,"onUpdate:modelValue":o[5]||(o[5]=a=>t(e).form.doMoneyPrice=a),clearable:""},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{te as _,h as a};
