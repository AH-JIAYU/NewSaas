
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{s as b}from"./apiLoading-CCZKHB2k.js";import{a as D}from"./projectManagement-C7NDC55s.js";import{u as M}from"./user_supplier-5WBVS8wQ.js";import{u as q}from"./survey_vipGroup-BCTd97nU.js";import{d as H,r as m,G as O,a as i,al as J,o as s,b as S,f as o,w as l,l as K,g as u,am as P,e as d,i as t,F as V,n as w,j as k,p as Q,ak as W,_ as X}from"./index-DnPHdPWF.js";import"./user_supplier-rMCT-knM.js";import"./survey_vipGroup-DLBkOs_e.js";const Y={style:{flex:"auto"}},Z=H({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup($,{expose:h,emit:x}){const G=M(),T=q(),j=x,p=m(!1),c=m(),e=m({list:[],tenantSupplierList:[],vipGroupList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]}}),C=m({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择至少一项"}]});async function N(n){e.value.list=[{...n}],e.value.form.projectId=n.projectId,e.value.tenantSupplierList=await b(G.getTenantSupplierList(n.projectId)),e.value.vipGroupList=await b(T.getGroupNameList()),p.value=!0}function E(){e.value.form.groupSupplierIdList=[]}function f(){c.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),p.value=!1}function U(){c.value.validate(async n=>{if(n){const{status:r}=await b(D.allocation(e.value.form));r===1&&W.success({message:"分配成功",center:!0}),f(),j("fetch-data")}})}return O(async()=>{}),h({showEdit:N}),(n,r)=>{const _=i("el-table-column"),B=i("el-table"),g=i("el-radio"),R=i("el-radio-group"),v=i("el-form-item"),y=i("el-option"),L=i("el-select"),z=i("el-form"),I=i("el-button"),F=i("el-dialog"),A=J("loading");return s(),S("div",null,[o(F,{modelValue:t(p),"onUpdate:modelValue":r[3]||(r[3]=a=>Q(p)?p.value=a:null),title:"分配",width:"500","before-close":f},{footer:l(()=>[K("div",Y,[o(I,{type:"primary",onClick:U},{default:l(()=>[u(" 确定 ")]),_:1}),o(I,{onClick:f},{default:l(()=>[u(" 取消 ")]),_:1})])]),default:l(()=>[P((s(),d(B,{data:t(e).list,"row-key":"id"},{default:l(()=>[o(_,{align:"center","show-overflow-tooltip":"",label:"客户简称",prop:"clientName"}),o(_,{align:"center","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),o(_,{align:"center","show-overflow-tooltip":"",label:"项目名称",prop:"name"})]),_:1},8,["data"])),[[A,!1]]),o(z,{ref_key:"formRef",ref:c,"label-width":"80px",rules:t(C),model:t(e).form,inline:!1},{default:l(()=>[o(v,{label:"分配目标"},{default:l(()=>[o(R,{modelValue:t(e).form.allocationType,"onUpdate:modelValue":r[0]||(r[0]=a=>t(e).form.allocationType=a),class:"ml-4",onChange:E},{default:l(()=>[o(g,{value:1,size:"large"},{default:l(()=>[u(" 自动分配 ")]),_:1}),o(g,{value:2,size:"large"},{default:l(()=>[u(" 供应商 ")]),_:1}),o(g,{value:3,size:"large"},{default:l(()=>[u(" 会员组 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e).form.allocationType===2?(s(),d(v,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:l(()=>[o(L,{modelValue:t(e).form.groupSupplierIdList,"onUpdate:modelValue":r[1]||(r[1]=a=>t(e).form.groupSupplierIdList=a),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:l(()=>[(s(!0),S(V,null,w(t(e).tenantSupplierList,a=>(s(),d(y,{label:a.supplierAccord,value:a.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):k("",!0),t(e).form.allocationType===3?(s(),d(v,{key:1,label:"会员组",prop:"groupSupplierIdList"},{default:l(()=>[o(L,{modelValue:t(e).form.groupSupplierIdList,"onUpdate:modelValue":r[2]||(r[2]=a=>t(e).form.groupSupplierIdList=a),placeholder:"请选择会员组",clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:l(()=>[(s(!0),S(V,null,w(t(e).vipGroupList,a=>(s(),d(y,{label:a.memberGroupName,value:a.memberGroupId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):k("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),se=X(Z,[["__scopeId","data-v-51b70d8b"]]);export{se as default};
