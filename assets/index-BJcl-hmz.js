
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as H,am as K,r as S,l as z,b as d,o as n,e as y,j as t,f as p,w as l,g as r,h as f,F as v,k as m,v as J,t as c,H as G,s as V,aq as D,an as C,E as O,aI as W,aJ as X,R as Y}from"./index-BKSxisHz.js";import{u as Z}from"./projectManagement_list-DLC8XuS4.js";import{u as $}from"./stagedData-JINbprkr.js";import{u as ee}from"./user_customer-D-Mh8LyM.js";import{a as L}from"./projectManagement-Or7GP7Zj.js";import"./user_customer-BjINviUh.js";const te=g=>(W("data-v-5d02b556"),g=g(),X(),g),ae=te(()=>c("div",null,[f("小时"),c("span",{class:"blue"},"完成"),f("量")],-1)),oe={style:{float:"left"}},le={style:{float:"right",color:"red","font-size":"13px"}},re=H({name:"ProjeckEdit",__name:"index",emits:["fetch-data"],setup(g,{expose:j,emit:M}){const _=Z();$();const P=K(),w=ee(),U=M,k=S(),e=S({dialogTableVisible:!1,title:"",type:"",loading:"",formData:{},customerList:[],rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:2,max:50,message:"内容在2-50个字之间",trigger:"blur"}],projectIdentification:[{max:100,required:!0,message:"请输入项目标识",trigger:"blur"},{min:2,max:100,message:"内容在2-100个字之间",trigger:"blur"}],countryIdList:[{required:!0,message:"请选择所属国家",trigger:"change"}],clientId:[{required:!0,message:"请选择所属客户",trigger:"change"}],doMoneyPrice:[{required:!0,message:"请输入原价",trigger:"blur"}],num:[{required:!0,message:"请输入配额",trigger:"blur"}],minimumDuration:[{required:!0,message:"请输入最小分长",trigger:"blur"}],ir:[{required:!0,message:"请输入配额",trigger:"blur"}]}}),q={PCNL:"参数",customer:"客户",name:"名称/标识",doMoneyPrice:"原价",ir:"IR",remark:"备注"};async function T(i,o){e.value.title=q[o],e.value.type=o;try{e.value.loading=!0;const s=await L.detail({projectId:i.projectId});e.value.formData=s.data,e.value.dialogTableVisible=!0,e.value.loading=!1,_.dataBeforeEditing=[C(e.value.formData)]}catch{}finally{e.value.loading=!1}e.value.customerList=await w.getCustomerList()}const I=i=>{i.key==="."&&i.preventDefault()},E=async()=>{const i=C(e.value.formData);return await _.compareProjectData(_.dataBeforeEditing,[i]),i};async function R(){e.value.loading=!0,k.value.validate(async i=>{if(i){const o=await E(),{status:s}=await L.edit(o);s===1&&O.success({message:"编辑成功",center:!0}),U("fetch-data"),x()}e.value.loading=!1})}function x(){e.value.dialogTableVisible=!1,e.value.formData={}}const B=async()=>{await w.getCustomerList(),await P.getCountry()};return z(async()=>{await B()}),j({showEdit:T}),(i,o)=>{const s=d("el-input-number"),u=d("el-form-item"),N=d("el-option"),A=d("el-select"),b=d("el-input"),Q=d("el-form"),h=d("el-button"),F=d("el-dialog");return n(),y("div",null,[t(e).dialogTableVisible?(n(),p(F,{key:0,modelValue:t(e).dialogTableVisible,"onUpdate:modelValue":o[8]||(o[8]=a=>t(e).dialogTableVisible=a),title:t(e).title+"编辑",draggable:""},{footer:l(()=>[r(h,{onClick:x,disabled:t(e).loading},{default:l(()=>[f(" 取消 ")]),_:1},8,["disabled"]),r(h,{type:"primary",onClick:R,disabled:t(e).loading},{default:l(()=>[f(" 确定 ")]),_:1},8,["disabled"])]),default:l(()=>[r(Q,{ref_key:"formRef",ref:k,model:t(e).formData,rules:t(e).rules,"label-width":"100","label-position":"right"},{default:l(()=>[t(e).type==="PCNL"?(n(),y(v,{key:0},[r(u,{label:"配额",prop:"num"},{default:l(()=>[r(s,{style:{width:"100%"},modelValue:t(e).formData.num,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).formData.num=a),step:1,"step-strictly":"",min:1,max:100,"controls-position":"right",onKeydown:I},null,8,["modelValue"])]),_:1}),r(u,null,{label:l(()=>[ae]),default:l(()=>[r(s,{style:{width:"100%"},modelValue:t(e).formData.limitedQuantity,"onUpdate:modelValue":o[1]||(o[1]=a=>t(e).formData.limitedQuantity=a),min:1,step:1,"step-strictly":"","controls-position":"right",onKeydown:I},null,8,["modelValue"])]),_:1})],64)):m("",!0),t(e).type==="customer"?(n(),p(u,{key:1,label:"所属客户",prop:"clientId"},{default:l(()=>[r(A,{placeholder:"Select",modelValue:t(e).formData.clientId,"onUpdate:modelValue":o[2]||(o[2]=a=>t(e).formData.clientId=a),clearable:""},{default:l(()=>[(n(!0),y(v,null,J(t(e).customerList,a=>(n(),p(N,{key:a.tenantCustomerId,value:a.tenantCustomerId,label:a.customerAccord,disabled:a.isReveal===1},{default:l(()=>[c("span",oe,G(a.customerAccord),1),V(c("span",le,[V(c("span",null," 营业额超限 ",512),[[D,a.turnover<a.practiceTurover]]),V(c("span",null," 审核率不合格 ",512),[[D,a.rateAudit>a.practiceRateAudit]])],512),[[D,a.isReveal===1]])]),_:2},1032,["value","label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):m("",!0),t(e).type==="name"?(n(),y(v,{key:2},[r(u,{label:"项目名称",prop:"name"},{default:l(()=>[r(b,{modelValue:t(e).formData.name,"onUpdate:modelValue":o[3]||(o[3]=a=>t(e).formData.name=a),clearable:"",maxlength:50},null,8,["modelValue"])]),_:1}),r(u,{label:"项目标识",prop:"projectIdentification"},{default:l(()=>[r(b,{clearable:"",modelValue:t(e).formData.projectIdentification,"onUpdate:modelValue":o[4]||(o[4]=a=>t(e).formData.projectIdentification=a),maxlength:100},null,8,["modelValue"])]),_:1})],64)):m("",!0),t(e).type==="doMoneyPrice"?(n(),p(u,{key:3,label:"原价",prop:"doMoneyPrice"},{default:l(()=>[r(s,{style:{width:"100%"},modelValue:t(e).formData.doMoneyPrice,"onUpdate:modelValue":o[5]||(o[5]=a=>t(e).formData.doMoneyPrice=a),min:1,precision:1,step:.1,"controls-position":"right"},null,8,["modelValue"])]),_:1})):m("",!0),t(e).type==="ir"?(n(),p(u,{key:4,label:"IR",prop:"ir"},{default:l(()=>[r(b,{modelValue:t(e).formData.ir,"onUpdate:modelValue":o[6]||(o[6]=a=>t(e).formData.ir=a),modelModifiers:{number:!0},min:1,max:100,step:"0.01",oninput:"if(value>100)value=100;if(value.length>4)value=value.slice(0,4);if(value<0)value=0;value=Number(value).toFixed(1)"},{append:l(()=>[f(" % ")]),_:1},8,["modelValue"])]),_:1})):m("",!0),t(e).type==="remark"?(n(),p(u,{key:5,label:"备注"},{default:l(()=>[r(b,{maxlength:"200","show-word-limit":"",style:{width:"100%"},type:"textarea",rows:5,modelValue:t(e).formData.remark,"onUpdate:modelValue":o[7]||(o[7]=a=>t(e).formData.remark=a)},null,8,["modelValue"])]),_:1})):m("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])):m("",!0)])}}}),pe=Y(re,[["__scopeId","data-v-5d02b556"]]);export{pe as default};
