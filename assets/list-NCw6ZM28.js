
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as de,O as fe,aK as be,y as ge,r as $,k as _e,G as H,J as he,a as i,p as ye,o as r,b as L,f as n,w as a,i as t,az as P,F as D,t as ke,e as u,g as m,H as b,I as ve,q as Ce,s as g,j as c,S as we,E as z,aL as Se,N as Le,aM as Ie,aN as Ee,ba as Me,ap as xe,aG as ze,aH as Te,R as Ne}from"./index-DSaDGYUV.js";import{_ as Ve}from"./index.vue_vue_type_style_index_0_lang-DoTs6dlz.js";import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang-N-6pDRSh.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-D1TL0KR5.js";import{a as T}from"./index-CD7M53PC.js";import{e as $e}from"./empty-bAzhJQI7.js";import{u as He}from"./index-ppvZgP64.js";import{u as Pe}from"./useTabbar-C5Bujlnr.js";import"./clipboard-Cx2uXdQm.js";const De=v=>(ze("data-v-3da827e7"),v=v(),Te(),v),Fe=De(()=>g("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),Ue={key:0,class:"hoverSvg"},Re={class:"fineBom"},Ke={class:"c-fx"},Oe={class:"weightColor"},je={style:{"font-weight":"700"}},Ge={style:{"font-weight":"700"}},qe={style:{"font-weight":"700"}},Je=de({name:"billManagement",__name:"list",setup(v){const{toClipboard:F}=He(),U=fe(),{pagination:_,getParams:R,onSizeChange:K,onCurrentChange:O,onSortChange:j}=be(),G=Pe(),N=ge(),C=$([{label:"会员ID",prop:"memberId",sortable:!0,checked:!0},{label:"会员名称",prop:"memberName",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税",prop:"taxesFees",sortable:!0,checked:!0},{label:"实际金额",prop:"payAmount",sortable:!0,checked:!0},{label:"支付时间",prop:"payTime",sortable:!0,checked:!0},{label:"账单状态",prop:"billStatus",sortable:!0,checked:!0},{label:"说明",prop:"notes",sortable:!0,checked:!0}]),e=$({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],formMode:"dialog",formModeProps:{visible:!1,id:""},search:{memberId:"",memberName:"",member:"",billStatus:""},billStatusList:["待支付","已支付","已拒绝"],batch:{enable:!1,selectionDataList:[]},dataList:[]});_e(()=>{C.value.forEach(s=>{s.checked&&e.value.checkList.push(s.prop)}),d(),e.value.formMode==="router"&&H.on("get-data-list",()=>{d()})}),he(()=>{e.value.formMode==="router"&&H.off("get-data-list")});function d(){try{e.value.loading=!0;const s={...R(),...e.value.search};e.value.search.member&&(/^\d+$/.test(s.member)?s.memberId=s.member:s.memberName=s.member),T.list(s).then(l=>{e.value.loading=!1,e.value.dataList=l.data.memberBillInfoList,_.value.total=l.data.total})}catch{}finally{e.value.loading=!1}}const q=s=>{F(s),z({type:"success",message:"复制成功"})};function J(){Object.assign(e.value.search,{memberId:"",memberName:"",member:"",billStatus:""}),d()}function Q(s){K(s).then(()=>d())}function h(s=1){O(s).then(()=>d())}function W({prop:s,order:l}){j(s,l).then(()=>d())}function X(){e.value.formMode==="router"?N.settings.tabbar.enable&&N.settings.tabbar.mergeTabsBy!=="activeMenu"?G.open({name:"routerName"}):U.push({name:"routerName"}):(e.value.formModeProps.id="",e.value.formModeProps.visible=!0)}async function V(s,l){l===2?Se.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async y=>{(await T.changestatus({id:s,type:l,notes:y.value})).status===1&&z.success({message:"操作成功"}),d()}):((await T.changestatus({id:s,type:l})).status===1&&z.success({message:"操作成功"}),d())}return(s,l)=>{const y=i("ElInput"),k=i("ElFormItem"),Y=i("el-option"),Z=i("el-select"),I=Le,E=i("ElButton"),ee=i("ElForm"),te=Ae,oe=i("ElDivider"),w=i("el-button"),le=Ve,ae=Ie,ne=Ee,se=i("el-row"),A=i("el-table-column"),B=i("el-text"),f=i("ElTableColumn"),M=Me,x=i("el-tag"),re=i("el-empty"),ie=i("ElTable"),ue=i("ElPagination"),me=xe,ce=ye("loading");return r(),L("div",{class:we({"absolute-container":t(e).tableAutoHeight})},[n(me,null,{default:a(()=>[n(te,{"show-toggle":!1},{default:a(({fold:o,toggle:S})=>[n(ee,{model:t(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:a(()=>[n(k,null,{default:a(()=>[n(y,{modelValue:t(e).search.memberId,"onUpdate:modelValue":l[0]||(l[0]=p=>t(e).search.memberId=p),placeholder:"会员ID",clearable:"",onKeydown:l[1]||(l[1]=P(p=>h(),["enter"]))},null,8,["modelValue"])]),_:1}),n(k,null,{default:a(()=>[n(y,{modelValue:t(e).search.memberName,"onUpdate:modelValue":l[2]||(l[2]=p=>t(e).search.memberName=p),placeholder:"会员姓名",clearable:"",onKeydown:l[3]||(l[3]=P(p=>h(),["enter"]))},null,8,["modelValue"])]),_:1}),n(k,null,{default:a(()=>[n(Z,{modelValue:t(e).search.billStatus,"onUpdate:modelValue":l[4]||(l[4]=p=>t(e).search.billStatus=p),"value-key":"",placeholder:"账单状态",clearable:"",filterable:"",onChange:l[5]||(l[5]=p=>h())},{default:a(()=>[(r(!0),L(D,null,ke(t(e).billStatusList,(p,pe)=>(r(),u(Y,{key:p,value:pe+1,label:p},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(k,null,{default:a(()=>[n(E,{type:"primary",onClick:l[6]||(l[6]=p=>h())},{icon:a(()=>[n(I,{name:"i-ep:search"})]),default:a(()=>[m(" 筛选 ")]),_:1}),n(E,{onClick:J},{icon:a(()=>[Fe]),default:a(()=>[m(" 重置 ")]),_:1}),n(E,{disabled:"",link:"",onClick:S},{icon:a(()=>[n(I,{name:o?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:a(()=>[m(" "+b(o?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),n(oe,{"border-style":"dashed"}),n(se,null,{default:a(()=>[n(le,null,{default:a(()=>[n(w,{size:"default",type:"primary",onClick:X},{default:a(()=>[m(" 新增结算 ")]),_:1})]),_:1}),n(ne,null,{default:a(()=>[n(w,{size:"default"},{default:a(()=>[m(" 导出 ")]),_:1}),n(ae,{border:t(e).border,"onUpdate:border":l[7]||(l[7]=o=>t(e).border=o),tableAutoHeight:t(e).tableAutoHeight,"onUpdate:tableAutoHeight":l[8]||(l[8]=o=>t(e).tableAutoHeight=o),checkList:t(e).checkList,"onUpdate:checkList":l[9]||(l[9]=o=>t(e).checkList=o),columns:t(C),"onUpdate:columns":l[10]||(l[10]=o=>ve(C)?C.value=o:null),"line-height":t(e).lineHeight,"onUpdate:lineHeight":l[11]||(l[11]=o=>t(e).lineHeight=o),stripe:t(e).stripe,"onUpdate:stripe":l[12]||(l[12]=o=>t(e).stripe=o),style:{"margin-left":"12px"},onQueryData:d},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),Ce((r(),u(ie,{border:t(e).border,size:t(e).lineHeight,stripe:t(e).stripe,class:"my-4",data:t(e).dataList,"highlight-current-row":"",height:"100%",onSortChange:W,onSelectionChange:l[13]||(l[13]=o=>t(e).batch.selectionDataList=o)},{empty:a(()=>[n(re,{image:t($e),"image-size":300},null,8,["image"])]),default:a(()=>[n(A,{align:"center",type:"selection"}),t(e).checkList.includes("memberId")?(r(),u(f,{key:0,"show-overflow-tooltip":"",align:"center",prop:"",label:"会员ID",width:"200"},{default:a(({row:o})=>[o.memberId?(r(),L("div",Ue,[g("p",Re,"ID："+b(o.memberId),1),g("span",Ke,[n(I,{onClick:S=>q(o.memberId),class:"copySvg",name:"ri:file-copy-2-fill",color:"#4fa5ff"},null,8,["onClick"])])])):(r(),u(B,{key:1},{default:a(()=>[m("-")]),_:1}))]),_:1})):c("",!0),t(e).checkList.includes("memberName")?(r(),u(f,{key:1,"show-overflow-tooltip":"",align:"center",prop:"",label:"会员名称",width:"120"},{default:a(({row:o})=>[g("p",Oe,b(o.memberName?o.memberName:"-"),1)]),_:1})):c("",!0),t(e).checkList.includes("billTime")?(r(),u(f,{key:2,"show-overflow-tooltip":"",align:"center",prop:"billTime",label:"账单日期"})):c("",!0),t(e).checkList.includes("billAmount")?(r(),u(f,{key:3,"show-overflow-tooltip":"",align:"center",prop:"billAmount",label:"账单金额"},{default:a(({row:o})=>[g("p",je,[n(M),m(b(o.billAmount||0),1)])]),_:1})):c("",!0),t(e).checkList.includes("taxesFees")?(r(),u(f,{key:4,"show-overflow-tooltip":"",align:"center",prop:"taxesFees",label:"税"},{default:a(({row:o})=>[g("p",Ge,[n(M),m(b(o.taxesFees||0),1)])]),_:1})):c("",!0),t(e).checkList.includes("payAmount")?(r(),u(f,{key:5,"show-overflow-tooltip":"",align:"center",prop:"payAmount",label:"实际金额"},{default:a(({row:o})=>[g("p",qe,[n(M),m(b(o.payAmount||0),1)])]),_:1})):c("",!0),t(e).checkList.includes("payTime")?(r(),u(f,{key:6,"show-overflow-tooltip":"",align:"center",prop:"payTime",label:"支付时间"},{default:a(({row:o})=>[m(b(o.payTime?o.payTime:"-"),1)]),_:1})):c("",!0),t(e).checkList.includes("billStatus")?(r(),u(f,{key:7,align:"center","show-overflow-tooltip":"",prop:"",label:"账单状态"},{default:a(({row:o})=>[o.billStatus===1?(r(),u(x,{key:0,type:"warning",effect:"dark"},{default:a(()=>[m("待支付")]),_:1})):c("",!0),o.billStatus===2?(r(),u(x,{key:1,type:"success",effect:"dark"},{default:a(()=>[m("已支付")]),_:1})):c("",!0),o.billStatus===3?(r(),u(x,{key:2,type:"danger",effect:"dark"},{default:a(()=>[m("已拒绝")]),_:1})):c("",!0)]),_:1})):c("",!0),t(e).checkList.includes("notes")?(r(),u(f,{key:8,"show-overflow-tooltip":"",align:"center",prop:"notes",label:"说明"},{default:a(({row:o})=>[n(B,{style:{color:"#333","font-weight":"700"}},{default:a(()=>[m(b(o.notes?o.notes:"-"),1)]),_:2},1024)]),_:1})):c("",!0),n(A,{align:"center",prop:"i",label:"操作",fixed:"right","show-overflow-tooltip":"",width:"260"},{default:a(({row:o})=>[o.billStatus===1?(r(),L(D,{key:0},[n(w,{size:"small",plain:"",type:"primary",onClick:S=>V(o.id,1)},{default:a(()=>[m(" 支付 ")]),_:2},1032,["onClick"]),n(w,{size:"small",plain:"",type:"danger",onClick:S=>V(o.id,2)},{default:a(()=>[m(" 拒绝支付 ")]),_:2},1032,["onClick"])],64)):c("",!0)]),_:1})]),_:1},8,["border","size","stripe","data"])),[[ce,t(e).loading]]),n(ue,{"current-page":t(_).page,total:t(_).total,"page-size":t(_).size,"page-sizes":t(_).sizes,layout:t(_).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Q,onCurrentChange:h},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),t(e).formMode==="dialog"||t(e).formMode==="drawer"?(r(),u(Be,{key:0,id:t(e).formModeProps.id,modelValue:t(e).formModeProps.visible,"onUpdate:modelValue":l[14]||(l[14]=o=>t(e).formModeProps.visible=o),mode:t(e).formMode,onSuccess:d},null,8,["id","modelValue","mode"])):c("",!0)],2)}}}),at=Ne(Je,[["__scopeId","data-v-3da827e7"]]);export{at as default};
