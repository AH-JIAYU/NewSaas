
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as v,d as D,r as b,n as U,E as z,a as r,q as C,s as R,i as a,o as c,b as f,f as l,w as o,g as S,F as _,t as y,e as $,y as j,z as I,L as q}from"./index-DK9KDSNt.js";const B={list:u=>v.post("bill/getMemberBillList",u),create:u=>v.post("bill/addMemberSettlement",u),getMemberBillAvailableBalance:u=>v.post("bill/getMemberBillAvailableBalance",u),changestatus:u=>v.post("bill/updateMemberBill",u)},O=D({__name:"index",props:{id:{default:""}},setup(u,{expose:M}){const i=b(!1),g=b(),e=b({minimumAmount:"",settlementType:1,settlementAmount:"",addMemberSettlementInfoList:[]}),p=b({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),V=b({settlementAmount:[{required:!0,message:"请输入正数，且最多两位小数",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入有效的正数，且最多两位小数",trigger:"blur"}]}),L=async()=>{try{i.value=!0;const s=await B.getMemberBillAvailableBalance({});s.data&&(p.value.memberSettlementInfoList=s.data.memberBillAvailableBalanceInfoList,e.value.minimumAmount=s.data.minimumAmount),i.value=!1}catch{}finally{i.value=!1}},h=s=>{e.value.addMemberSettlementInfoList=[];const m=p.value.memberSettlementInfoList.filter(n=>s.includes(n.id));for(let n=0;n<m.length;n++)e.value.addMemberSettlementInfoList.push(m[n])};return U(async()=>{await L()}),M({submit(){return new Promise(s=>{g.value&&g.value.validate(m=>{if(e.value.settlementType===2){for(let n of e.value.addMemberSettlementInfoList)n.settlementAmount||(n.settlementAmount=e.value.minimumAmount);e.value.settlementAmount=""}else e.value.addMemberSettlementInfoList=[],e.value.settlementAmount||(e.value.settlementAmount=e.value.minimumAmount);if(m)try{i.value=!0,B.create(e.value).then(()=>{i.value=!1,z.success({message:"新增成功",center:!0}),s()})}catch{}finally{i.value=!1}})})}}),(s,m)=>{const n=r("el-radio"),E=r("el-radio-group"),d=r("ElFormItem"),A=r("ElInput"),x=r("el-option"),k=r("el-select"),w=r("ElInputNumber"),F=r("ElForm"),N=C("loading");return R((c(),f("div",null,[l(F,{ref_key:"formRef",ref:g,model:a(e),rules:a(V),"label-width":"9rem"},{default:o(()=>[l(d,{label:"结算方式"},{default:o(()=>[l(E,{modelValue:a(e).settlementType,"onUpdate:modelValue":m[0]||(m[0]=t=>a(e).settlementType=t)},{default:o(()=>[l(n,{value:1,size:"large"},{default:o(()=>[S(" 全部结算 ")]),_:1}),l(n,{value:2,size:"large"},{default:o(()=>[S(" 指定结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(e).settlementType===1?(c(),f(_,{key:0},[l(d,{label:"最低结算额度"},{default:o(()=>[l(A,{disabled:"",placeholder:"",value:a(e).minimumAmount},null,8,["value"])]),_:1}),l(d,{label:"结算金额"},{default:o(()=>[l(A,{modelValue:a(e).settlementAmount,"onUpdate:modelValue":m[1]||(m[1]=t=>a(e).settlementAmount=t),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(c(),f(_,{key:1},[l(d,{label:"指定会员"},{default:o(()=>[l(k,{placeholder:"Select",modelValue:a(p).memberSettlementInfoSelect,"onUpdate:modelValue":m[2]||(m[2]=t=>a(p).memberSettlementInfoSelect=t),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:h},{default:o(()=>[(c(!0),f(_,null,y(a(p).memberSettlementInfoList,t=>(c(),$(x,{key:t.id,value:t.id,label:t.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"最低结算额度"},{default:o(()=>[l(A,{disabled:"",placeholder:"",value:a(e).minimumAmount},null,8,["value"])]),_:1}),(c(!0),f(_,null,y(a(e).addMemberSettlementInfoList,t=>(c(),f(_,null,[l(d,{label:""},{default:o(()=>[j("p",null,I(t.memberId)+" - "+I(t.memberName)+" - 可用余额："+I(t.availableBalance),1)]),_:2},1024),l(d,{label:"结算金额"},{default:o(()=>[l(w,{"controls-position":"right",modelValue:t.settlementAmount,"onUpdate:modelValue":T=>t.settlementAmount=T,max:t.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[N,a(i)]])}}}),P=q(O,[["__scopeId","data-v-3614c4ed"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"}));export{P as D,B as a,H as i};
