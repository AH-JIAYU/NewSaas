
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as v,E as L,r as p,c as M,d as Z,G,ak as I,a as d,al as J,am as j,i as t,o as m,b as k,f as n,w as s,F as $,n as A,e as g}from"./index-QzTLBS9C.js";import{u as H}from"./otherFunctions_basicDictionary-0g0PKaVr.js";import{a as K}from"./configuration_role-BVRVbv_V.js";const D={list:o=>v.post("staff/get/getStaffList",o),create:o=>v.post("staff/insertStaff",o),edit:o=>v.post("staff/updateStaff",o),delete:o=>v.post("staff/deleteStaff",o)},Q=L("buttonPermission",()=>{const o=p([]),h=M(async()=>{if(o.value.length)return o.value;const{data:_}=await K.list();return _});return{role:o,getRole:h}}),W=Q,le=Z({__name:"index",props:["id","row"],setup(o,{expose:h}){const _=H(),O=W(),N=p(),R=p(),B=o,b=p(!1),F=p(!1),c=p(),e=p({id:"",email:"",phone:"",name:"",country:"",password:"",role:null,active:!0,type:"phone"}),T=(i,a,r)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?r():r(new Error("请输入合法手机号"))},z=(i,a,r)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?r():r(new Error("请输入合法邮箱"))},q=()=>{e.value.phone.includes("@")?y.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:z,trigger:"blur"}]:y.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:T,trigger:"blur"}]},y=p({name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]});G(async()=>{b.value=!0,R.value=await _.getCountry(),N.value=await O.getRole,b.value=!1,B.id&&(e.value=JSON.parse(B.row))});const P=i=>{(i!==e.value.phone||i!==e.value.email)&&(F.value=!0)};h({submit(){return new Promise(i=>{e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?c.value&&c.value.validate(a=>{a&&(delete e.value.id,e.value==="phone"?delete e.value.email:delete e.value.phone,D.create(e.value).then(()=>{I.success({message:"新增成功",center:!0}),E(),i()}))}):c.value&&c.value.validate(a=>{if(a){const{id:r,phone:u,email:V,password:w,name:x,country:S,active:C,type:f,role:U}=e.value,l={id:r,phone:u,email:V,password:w,name:x,country:S,active:C,type:f,role:U};f==="phone"?(l.email="",delete l.email):(l.phone="",delete l.phone),l.password||delete l.password,F.value||(delete l.phone,delete l.email),D.edit(l).then(()=>{I.success({message:"编辑成功",center:!0}),E(),i()})}})})},onCancel:E});function E(){e.value={}}return(i,a)=>{const r=d("ElInput"),u=d("ElFormItem"),V=d("ElOption"),w=d("ElSelect"),x=d("el-option"),S=d("el-select"),C=d("el-switch"),f=d("ElForm"),U=J("loading");return j((m(),k("div",null,[n(f,{ref_key:"formRef",ref:c,model:t(e),rules:t(y),"label-width":"130px","label-suffix":"："},{default:s(()=>[n(u,{label:"用户名",prop:"name"},{default:s(()=>[n(r,{modelValue:t(e).name,"onUpdate:modelValue":a[0]||(a[0]=l=>t(e).name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),n(u,{label:"国家",prop:"country"},{default:s(()=>[n(w,{modelValue:t(e).country,"onUpdate:modelValue":a[1]||(a[1]=l=>t(e).country=l),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:s(()=>[(m(!0),k($,null,A(t(R),l=>(m(),g(V,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),t(e).country==="CN"?(m(),g(u,{key:0,label:"手机号",prop:"phone"},{default:s(()=>[n(r,{modelValue:t(e).phone,"onUpdate:modelValue":a[2]||(a[2]=l=>t(e).phone=l),placeholder:"请输入手机号",onChange:P,onBlur:q},null,8,["modelValue"])]),_:1})):(m(),g(u,{key:1,label:"邮箱",prop:"email"},{default:s(()=>[n(r,{modelValue:t(e).email,"onUpdate:modelValue":a[3]||(a[3]=l=>t(e).email=l),placeholder:"请输入邮箱",onChange:P,onBlur:q},null,8,["modelValue"])]),_:1})),n(u,{label:"密码",prop:"password"},{default:s(()=>[n(r,{modelValue:t(e).password,"onUpdate:modelValue":a[4]||(a[4]=l=>t(e).password=l),placeholder:"需要修改密码时直接修改即可"},null,8,["modelValue"])]),_:1}),n(u,{label:"角色",prop:"role"},{default:s(()=>[n(S,{modelValue:t(e).role,"onUpdate:modelValue":a[5]||(a[5]=l=>t(e).role=l),placeholder:"请选择角色"},{default:s(()=>[(m(!0),k($,null,A(t(N),l=>(m(),g(x,{key:l.id,label:l.roleName,value:l.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(u,{label:"是否启用",prop:"active"},{default:s(()=>[n(C,{modelValue:t(e).active,"onUpdate:modelValue":a[6]||(a[6]=l=>t(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[U,t(b)]])}}});export{le as _,D as a,W as u};
