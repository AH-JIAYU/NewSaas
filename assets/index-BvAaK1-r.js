
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ce,m as j,aj as me,r as d,l as fe,u as pe,c as ge,n as ve,a as c,o as v,e as x,w as l,v as _,f as o,g as V,A as h,i as e,b as H,t as J,F as O,p as G,E as Q,M as _e}from"./index-BDq3fI5e.js";import{a as he}from"./department-Bs28s7yo.js";import{a as be}from"./position_manage-CFCuA6eT.js";import{a as we}from"./configuration_role-CtxVXTRc.js";import{u as ye}from"./configuration_manager-DzYLesIb.js";const ke={class:"card-header"},xe={class:"leftTitle"},Ve={class:"card-header"},Ce={class:"leftTitle"},Ie={class:"card-header"},Se={class:"leftTitle"},Ee={class:"flex-c"},Ne=ce({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success","getList"],["update:modelValue"]),setup(K,{emit:W}){const{t}=me(),X=ye(),Y=d([]),T=d(),ee=fe(),ae=d(),L=d(),q=d(),le=d(!1),F=d(),Z=d(),f=K,C=W,b=d(),U=pe(K,"modelValue"),te=ge(()=>f.id===""?t("configuration.user.new.addUser"):t("configuration.user.new.editUser")),oe={children:"children",label:"name"},g=d(),ne=d([]),a=d({id:f.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"123456",roleList:[],role:"",active:!0,positionId:"",organizationalStructureId:""}),m=d([]),se=(u,n,r)=>{const i=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[\d]))\d{8}$/;a.value.phone?i.test(a.value.phone)?r():r(new Error(t("configuration.user.new.enterPhoneNumber"))):r()},re=(u,n,r)=>{const i=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a.value.email?i.test(a.value.email)?r():r(new Error(t("configuration.user.new.enterEmail"))):r()},I=d({userName:[{required:!0,message:t("configuration.user.new.enterName")}],positionId:[{required:!0,message:t("configuration.user.new.positionSelect"),trigger:"change"}],password:[{required:!0,trigger:"blur",message:t("configuration.user.new.enterPassword")},{min:6,max:18,trigger:"blur",message:t("configuration.user.new.6to18")}],name:[{required:!0,message:t("configuration.user.new.enterUsername"),trigger:"blur"}],phone:[{validator:se,trigger:"blur"}],email:[{validator:re,trigger:"blur"}]}),ue=u=>{Array.isArray(u)&&u.length>1&&(a.value.roleList=[u[u.length-1]])};function ie(){a.value.email||(I.value.email=[],g.value.clearValidate("email")),a.value.phone||(I.value.phone=[],g.value.clearValidate("phone")),m.value=b.value.getCheckedKeys(!1);const u=b.value.getCheckedKeys(),n=b.value.getHalfCheckedKeys(),r=u.concat(n);a.value.organizationalStructureId=r[0],a.value.roleList.length>0?a.value.role=a.value.roleList[0]:(a.value.role="",a.value.roleList=[]),a.value.id?g.value&&g.value.validate(i=>{if(i){const{id:p,phone:z,email:B,password:E,name:y,country:k,active:P,type:A,role:M,positionId:R,organizationalStructureId:N,userName:D}=a.value,s={id:p,phone:z,email:B,password:E,name:y,country:k,active:P,type:A,role:M,positionId:R,organizationalStructureId:N,userName:D};Z.value===s.phone&&delete s.phone,F.value===s.email&&delete s.email,s.password||delete s.password,G.edit(s).then(()=>{Q.success({message:t("common.editSuccess"),center:!0}),C("success"),C("getList"),S()})}}):g.value&&g.value.validate(i=>{i&&G.create(a.value).then(()=>{Q.success({message:t("common.addSuccess"),center:!0}),C("success"),C("getList"),S()})})}function S(){U.value=!1}const $=u=>u==null?void 0:u.reduce((n,r)=>Array.isArray(r)?n.concat($(r)):n.concat(r),[]),de=(u,n)=>{n?(b.value.getCheckedKeys().forEach(i=>{i!==u.id&&b.value.setChecked(i,!1)}),m.value=[u.id]):m.value=m.value.filter(r=>r!==u.id)};return ve(async()=>{m.value=[],m.value.push(f.parentId);const{data:u}=await be.list({page:1,limit:10,id:null,name:"",active:null});u&&(T.value=u.data),Y.value=await X.getStaff();const n=await we.list({id:null,name:""});n.data&&(L.value=n.data);const r=await he.list({name:""});r.data&&(q.value=r.data),ae.value=await ee.getCountry(),f.id!==""&&f.row&&(I.value.password=[],a.value=JSON.parse(f.row),a.value.roleList=[a.value.role],m.value||(m.value=[]),m.value.push(f.parentId),F.value=a.value.email,Z.value=a.value.phone,le.value=!0),ne.value=$(f.dataList)}),(u,n)=>{const r=c("el-input"),i=c("el-form-item"),p=c("el-col"),z=c("el-option"),B=c("el-select"),E=c("el-text"),y=c("el-row"),k=c("el-card"),P=c("el-tree"),A=c("el-checkbox"),M=c("el-checkbox-group"),R=c("ElForm"),N=c("ElButton"),D=c("ElDrawer");return v(),x(D,{modelValue:U.value,"onUpdate:modelValue":n[7]||(n[7]=s=>U.value=s),title:e(te),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:l(()=>[_("div",Ee,[o(N,{size:"large",onClick:S},{default:l(()=>[V(h(e(t)("common.cancel")),1)]),_:1}),o(N,{type:"primary",size:"large",onClick:ie},{default:l(()=>[V(h(e(t)("common.confirm")),1)]),_:1})])]),default:l(()=>[o(R,{ref_key:"formRef",ref:g,model:e(a),rules:e(I),"label-width":"100px","validate-on-rule-change":!1},{default:l(()=>[o(k,{class:"box-card"},{header:l(()=>[_("div",ke,[_("div",xe,h(e(t)("configuration.user.detail.basicInformation")),1)])]),default:l(()=>[o(y,{gutter:24},{default:l(()=>[o(p,{span:8},{default:l(()=>[o(i,{label:e(t)("configuration.user.username"),prop:"userName"},{default:l(()=>[o(r,{modelValue:e(a).userName,"onUpdate:modelValue":n[0]||(n[0]=s=>e(a).userName=s),maxlength:20,placeholder:e(t)("configuration.user.new.enterUsername"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(p,{span:8},{default:l(()=>[o(i,{label:e(t)("configuration.user.name"),prop:""},{default:l(()=>[o(r,{modelValue:e(a).name,"onUpdate:modelValue":n[1]||(n[1]=s=>e(a).name=s),placeholder:e(t)("configuration.user.new.name"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(p,{span:8},{default:l(()=>[o(i,{label:e(t)("configuration.user.detail.phoneNumber"),prop:"phone"},{default:l(()=>[o(r,{modelValue:e(a).phone,"onUpdate:modelValue":n[2]||(n[2]=s=>e(a).phone=s),placeholder:e(t)("configuration.user.new.phoneNumber"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(p,{span:8},{default:l(()=>[o(i,{label:e(t)("configuration.user.email"),prop:"email"},{default:l(()=>[o(r,{modelValue:e(a).email,"onUpdate:modelValue":n[3]||(n[3]=s=>e(a).email=s),placeholder:e(t)("configuration.user.new.email"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(p,{span:8},{default:l(()=>[o(i,{label:e(t)("configuration.user.position"),prop:""},{default:l(()=>[o(B,{modelValue:e(a).positionId,"onUpdate:modelValue":n[4]||(n[4]=s=>e(a).positionId=s),placeholder:e(t)("configuration.user.new.positionSelect"),clearable:"",filterable:"",onChange:n[5]||(n[5]=()=>{})},{default:l(()=>[(v(!0),H(O,null,J(e(T),s=>(v(),x(z,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(p,{span:8},{default:l(()=>[o(i,{label:e(t)("configuration.user.new.initialPassword"),prop:""},{default:l(()=>[o(E,null,{default:l(()=>[V("123456")]),_:1})]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),o(k,{class:"box-card"},{header:l(()=>[_("div",Ve,[_("div",Ce,h(e(t)("configuration.user.detail.departtmentInformation")),1)])]),default:l(()=>[o(y,{gutter:24},{default:l(()=>[o(i,{label:e(t)("configuration.user.detail.assignDepartments")},{default:l(()=>[o(P,{style:{"max-width":"600px"},ref_key:"treeRef",ref:b,data:e(q),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":e(m),"default-expand-all":"",props:oe,onCheckChange:de},null,8,["data","default-checked-keys"])]),_:1},8,["label"])]),_:1})]),_:1}),o(k,{class:"box-card"},{header:l(()=>[_("div",Ie,[_("div",Se,h(e(t)("configuration.user.detail.roleInformation")),1)])]),default:l(()=>[o(y,{gutter:24},{default:l(()=>[o(i,{label:e(t)("configuration.user.detail.assignRoles")},{default:l(()=>{var s;return[(s=e(L))!=null&&s.length?(v(),x(M,{key:0,style:{"margin-left":"1.5rem"},modelValue:e(a).roleList,"onUpdate:modelValue":n[6]||(n[6]=w=>e(a).roleList=w),onChange:ue},{default:l(()=>[(v(!0),H(O,null,J(e(L),w=>(v(),x(A,{key:w.id,label:w.roleName,value:w.roleName},{default:l(()=>[V(h(w.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):(v(),x(E,{key:1},{default:l(()=>[V(h(e(t)("common.nodata")),1)]),_:1}))]}),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ae=_e(Ne,[["__scopeId","data-v-59a6abf5"]]);export{Ae as default};
