
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as N,d as _e,r as d,a1 as be,am as ye,k as Ve,a as i,p as we,q as Ee,i as t,o as g,b as S,f as a,w as s,S as xe,I as C,bi as he,s as I,F as A,t as D,e as F,g as P,E as _,a0 as Pe,aG as Ie,aH as Ue,R as Ne,ao as G}from"./index-B1sH2CRZ.js";const L={list:()=>N.post("user/getUserInfo"),edit:v=>N.post("user/update",v),uploadAvatar:v=>N.post("user/uploadAvatar",v)},k=v=>(Ie("data-v-90f6822d"),v=v(),Ue(),v),Se=k(()=>I("h2",null,"个人信息",-1)),Ce=k(()=>I("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Fe=["src"],ke=k(()=>I("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),M=_e({name:"personalSetting",__name:"setting",emits:["success"],setup(v,{expose:$,emit:H}){const V=d(!1),J=be(),R=H,Z="http://47.96.98.102:9100/user/uploadAvatar",Y=ye(),T=d([]),c=d(!1),B=d(!1),b=d(!1),K=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],w=d(),E=d(),e=d({type:"company",name:"",phone:"",email:"",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),m=d({oldPassword:"",password:"",confirmPassword:""}),Q=d({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,l,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?n():n(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,l,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?n():n(new Error("请输入合法手机号"))},trigger:"blur"}]}),W=d({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(r,l,n)=>{l===m.value.oldPassword?n(new Error("新密码不能与旧密码一致")):n()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(r,l,n)=>{l!==m.value.password?n(new Error("两次输入的密码不一致")):n()},trigger:"blur"}]}),q=r=>{(r!==e.value.phone||r!==e.value.email)&&(B.value=!0)};function X(){w.value&&w.value.validate(async r=>{if(r){if(c.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,B.value||(delete e.value.phone,delete e.value.email),(await L.edit(e.value)).status===-1)return _.warning({message:"修改失败",center:!0});R("success"),c.value=!1,_.success({message:"修改成功",center:!0}),y()}})}const ee=J.token,le=d({Token:ee}),z=d(""),x=d(!1),f=d([]),ae=async()=>{V.value=!1,_.success({message:"删除成功",center:!0})},te=(r,l)=>{r.status===-1?(Pe.error(r.error,{zIndex:2e3}),f.value=f.value.filter(n=>n.name!==l.name)):V.value=!0},oe=async()=>{_.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},se=r=>{z.value=r.url,x.value=!0},re=()=>{E.value&&E.value.validate(async r=>{if(r)try{if(c.value=!0,delete m.value.confirmPassword,(await L.edit(m.value)).status===-1)return _.warning({message:"修改失败",center:!0});R("success"),c.value=!1,_.success({message:"修改成功",center:!0}),y()}catch{}finally{c.value=!1}})};async function ne(r){e.value=r,f.value.push({name:"file",url:e.value.avatar}),e.value.avatar!==""&&(V.value=!0),b.value=!0}function y(){w.value.resetFields(),E.value.resetFields(),Object.assign(e,{}),f.value=[],Object.assign(m,{}),b.value=!1}return Ve(async()=>{try{c.value=!0,T.value=await Y.getCountry(),c.value=!1}catch{}finally{c.value=!1}}),$({showEdit:ne}),(r,l)=>{const n=i("el-icon"),U=i("el-upload"),ue=i("el-dialog"),u=i("ElFormItem"),p=i("ElInput"),de=i("ElOption"),ie=i("ElSelect"),me=i("el-option"),ce=i("el-select"),pe=i("el-switch"),h=i("ElButton"),O=i("ElForm"),j=i("ElTabPane"),ve=i("ElTabs"),fe=i("el-drawer"),ge=we("loading");return Ee((g(),S("div",null,[a(fe,{modelValue:t(b),"onUpdate:modelValue":l[14]||(l[14]=o=>C(b)?b.value=o:null),title:"修改用户信息",direction:"rtl","before-close":y,style:{height:"100%"},size:"40%"},{default:s(()=>[a(ve,{"tab-position":"left"},{default:s(()=>[a(j,{label:"个人信息",class:"basic"},{default:s(()=>[Se,a(O,{ref_key:"userFormRef",ref:w,model:t(e),rules:t(Q),"label-width":"120px","el-width":"120px"},{default:s(()=>[a(u,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[a(U,{class:xe({hide_box:t(V)}),"file-list":t(f),"onUpdate:fileList":l[0]||(l[0]=o=>C(f)?f.value=o:null),headers:t(le),action:Z,"list-type":"picture-card",limit:1,"on-preview":se,"on-remove":ae,"on-success":te,"on-exceed":oe},{tip:s(()=>[Ce]),default:s(()=>[a(n,{class:"el-icon--upload"},{default:s(()=>[a(t(he))]),_:1})]),_:1},8,["class","file-list","headers"]),a(ue,{modelValue:t(x),"onUpdate:modelValue":l[1]||(l[1]=o=>C(x)?x.value=o:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[I("img",{"w-full":"",src:t(z),alt:"Preview Image"},null,8,Fe)]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"用户名"},{default:s(()=>[a(p,{disabled:"",modelValue:t(e).name,"onUpdate:modelValue":l[2]||(l[2]=o=>t(e).name=o),placeholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),a(u,{label:"国家"},{default:s(()=>[a(ie,{modelValue:t(e).country,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).country=o),disabled:""},{default:s(()=>[(g(!0),S(A,null,D(t(T),o=>(g(),F(de,{label:o.chineseName,value:o.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(u,{prop:"",label:"货币类型"},{default:s(()=>[a(ce,{modelValue:t(e).currencyType,"onUpdate:modelValue":l[4]||(l[4]=o=>t(e).currencyType=o),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(g(),S(A,null,D(K,o=>a(me,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"公司名称"},{default:s(()=>[a(p,{modelValue:t(e).companyName,"onUpdate:modelValue":l[5]||(l[5]=o=>t(e).companyName=o),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1}),a(u,{label:"公司税号"},{default:s(()=>[a(p,{modelValue:t(e).taxId,"onUpdate:modelValue":l[6]||(l[6]=o=>t(e).taxId=o),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1}),a(u,{label:"法人姓名"},{default:s(()=>[a(p,{modelValue:t(e).legalPersonName,"onUpdate:modelValue":l[7]||(l[7]=o=>t(e).legalPersonName=o),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1}),t(e).country==="CN"?(g(),F(u,{key:0,prop:"phone",label:"手机号码"},{default:s(()=>[a(p,{modelValue:t(e).phone,"onUpdate:modelValue":l[8]||(l[8]=o=>t(e).phone=o),placeholder:"请输入你的手机号码",disabled:"",onChange:q},null,8,["modelValue"])]),_:1})):(g(),F(u,{key:1,prop:"email",label:"电子邮箱"},{default:s(()=>[a(p,{modelValue:t(e).email,"onUpdate:modelValue":l[9]||(l[9]=o=>t(e).email=o),placeholder:"请输入你的电子邮箱",disabled:"",onChange:q},null,8,["modelValue"])]),_:1})),a(u,{prop:"isInvitation",label:"合作邀约"},{default:s(()=>[a(pe,{modelValue:t(e).isInvitation,"onUpdate:modelValue":l[10]||(l[10]=o=>t(e).isInvitation=o),"inline-prompt":"","active-text":"启用","inactive-text":"禁用","active-value":2,"inactive-value":1},null,8,["modelValue"])]),_:1}),a(u,null,{default:s(()=>[a(h,{onClick:X,type:"primary"},{default:s(()=>[P(" 保存 ")]),_:1}),a(h,{onClick:y,type:"primary"},{default:s(()=>[P(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(j,{label:"账户管理",class:"security"},{default:s(()=>[ke,a(O,{ref_key:"accountFormRef",ref:E,model:t(m),rules:t(W),"label-width":"120px"},{default:s(()=>[a(u,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[a(p,{modelValue:t(m).oldPassword,"onUpdate:modelValue":l[11]||(l[11]=o=>t(m).oldPassword=o),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),a(u,{prop:"password",label:"新密码"},{default:s(()=>[a(p,{modelValue:t(m).password,"onUpdate:modelValue":l[12]||(l[12]=o=>t(m).password=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[a(p,{modelValue:t(m).confirmPassword,"onUpdate:modelValue":l[13]||(l[13]=o=>t(m).confirmPassword=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,null,{default:s(()=>[a(h,{onClick:re,type:"primary"},{default:s(()=>[P(" 保存 ")]),_:1}),a(h,{onClick:y,type:"primary"},{default:s(()=>[P(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[ge,t(c)]])}}});typeof G=="function"&&G(M);const Re=Ne(M,[["__scopeId","data-v-90f6822d"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));export{L as a,ze as b,Re as s};
