
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ne,M as se,aM as re,p as ie,r as P,l as ue,B as T,H as ce,a as i,al as me,o as r,b as S,f as a,w as n,i as t,F as x,n as pe,e as u,g as m,D as g,G as de,am as be,j as p,Q as fe,aN as ge,E as A,L as he,aO as _e,aP as ve,ak as ke,aK as ye,aL as we,C as Ce,P as Le}from"./index-BfeO8snE.js";import{_ as Se}from"./index.vue_vue_type_style_index_0_lang-CnYMjZaN.js";import{_ as Ee}from"./index.vue_vue_type_script_setup_true_lang-BPqApWtY.js";import{_ as Me}from"./index.vue_vue_type_script_setup_true_lang-CDaKbplg.js";import{a as E}from"./index-CFFUg_RN.js";import{u as ze}from"./useTabbar-C8iQNKGJ.js";const Ie=h=>(ye("data-v-e3669a6f"),h=h(),we(),h),Be=Ie(()=>Ce("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),Pe=ne({name:"SurveyBillManagementList",__name:"list",setup(h){const D=se(),{pagination:f,getParams:H,onSizeChange:V,onCurrentChange:F,onSortChange:$}=re(),U=ze(),M=ie(),_=P([{label:"会员ID/姓名",prop:"memberId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税",prop:"taxesFees",sortable:!0,checked:!0},{label:"实际金额",prop:"payAmount",sortable:!0,checked:!0},{label:"支付时间",prop:"payTime",sortable:!0,checked:!0},{label:"说明",prop:"notes",sortable:!0,checked:!0},{label:"账单状态",prop:"billStatus",sortable:!0,checked:!0}]),e=P({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],formMode:"dialog",formModeProps:{visible:!1,id:""},search:{member:"",billStatus:""},billStatusList:["待支付","已支付","已拒绝"],batch:{enable:!1,selectionDataList:[]},dataList:[]});ue(()=>{_.value.forEach(s=>{s.checked&&e.value.checkList.push(s.prop)}),c(),e.value.formMode==="router"&&T.on("get-data-list",()=>{c()})}),ce(()=>{e.value.formMode==="router"&&T.off("get-data-list")});function c(){e.value.loading=!0;const s={...H(),...e.value.search};e.value.search.member&&(/^\d+$/.test(s.member)?s.memberId=s.member:s.memberName=s.member),E.list(s).then(o=>{e.value.loading=!1,e.value.dataList=o.data.memberBillInfoList,f.value.total=o.data.total})}function N(){Object.assign(e.value.search,{member:"",billStatus:""}),c()}function R(s){V(s).then(()=>c())}function w(s=1){F(s).then(()=>c())}function O({prop:s,order:o}){$(s,o).then(()=>c())}function j(){e.value.formMode==="router"?M.settings.tabbar.enable&&M.settings.tabbar.mergeTabsBy!=="activeMenu"?U.open({name:"routerName"}):D.push({name:"routerName"}):(e.value.formModeProps.id="",e.value.formModeProps.visible=!0)}async function z(s,o){o===2?ge.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async v=>{(await E.changestatus({id:s,type:o,notes:v.value})).status===1&&A.success({message:"操作成功"}),c()}):((await E.changestatus({id:s,type:o})).status===1&&A.success({message:"操作成功"}),c())}return(s,o)=>{const v=i("ElInput"),k=i("ElFormItem"),Q=i("el-option"),G=i("el-select"),I=he,C=i("ElButton"),K=i("ElForm"),q=Ee,J=i("ElDivider"),y=i("el-button"),W=Se,X=_e,Y=ve,Z=i("el-row"),B=i("el-table-column"),d=i("ElTableColumn"),ee=i("ElTable"),te=i("ElPagination"),oe=ke,le=me("loading");return r(),S("div",{class:fe({"absolute-container":t(e).tableAutoHeight})},[a(oe,null,{default:n(()=>[a(q,{"show-toggle":!1},{default:n(({fold:l,toggle:L})=>[a(K,{model:t(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:n(()=>[a(k,null,{default:n(()=>[a(v,{modelValue:t(e).search.member,"onUpdate:modelValue":o[0]||(o[0]=b=>t(e).search.member=b),placeholder:"会员ID/会员姓名",clearable:"",onClear:o[1]||(o[1]=b=>w())},null,8,["modelValue"])]),_:1}),a(k,null,{default:n(()=>[a(G,{modelValue:t(e).search.billStatus,"onUpdate:modelValue":o[2]||(o[2]=b=>t(e).search.billStatus=b),"value-key":"",placeholder:"账单状态",clearable:"",filterable:""},{default:n(()=>[(r(!0),S(x,null,pe(t(e).billStatusList,(b,ae)=>(r(),u(Q,{key:b,value:ae+1,label:b},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(k,null,{default:n(()=>[a(C,{type:"primary",onClick:o[3]||(o[3]=b=>w())},{icon:n(()=>[a(I,{name:"i-ep:search"})]),default:n(()=>[m(" 筛选 ")]),_:1}),a(C,{onClick:N},{icon:n(()=>[Be]),default:n(()=>[m(" 重置 ")]),_:1}),a(C,{disabled:"",link:"",onClick:L},{icon:n(()=>[a(I,{name:l?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:n(()=>[m(" "+g(l?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(J,{"border-style":"dashed"}),a(Z,null,{default:n(()=>[a(W,null,{default:n(()=>[a(y,{size:"default",type:"primary",onClick:j},{default:n(()=>[m(" 添加结算 ")]),_:1})]),_:1}),a(Y,null,{default:n(()=>[a(y,{size:"default"},{default:n(()=>[m(" 导出 ")]),_:1}),a(X,{border:t(e).border,"onUpdate:border":o[4]||(o[4]=l=>t(e).border=l),tableAutoHeight:t(e).tableAutoHeight,"onUpdate:tableAutoHeight":o[5]||(o[5]=l=>t(e).tableAutoHeight=l),checkList:t(e).checkList,"onUpdate:checkList":o[6]||(o[6]=l=>t(e).checkList=l),columns:t(_),"onUpdate:columns":o[7]||(o[7]=l=>de(_)?_.value=l:null),"line-height":t(e).lineHeight,"onUpdate:lineHeight":o[8]||(o[8]=l=>t(e).lineHeight=l),stripe:t(e).stripe,"onUpdate:stripe":o[9]||(o[9]=l=>t(e).stripe=l),style:{"margin-left":"12px"},onQueryData:c},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),be((r(),u(ee,{border:t(e).border,size:t(e).lineHeight,stripe:t(e).stripe,class:"my-4",data:t(e).dataList,"highlight-current-row":"",height:"100%",onSortChange:O,onSelectionChange:o[10]||(o[10]=l=>t(e).batch.selectionDataList=l)},{default:n(()=>[a(B,{align:"center","show-overflow-tooltip":"",type:"selection"}),t(e).checkList.includes("memberId")?(r(),u(d,{key:0,"show-overflow-tooltip":"",align:"center",prop:"",label:"会员ID/姓名",width:"250"},{default:n(({row:l})=>[m(g(l.memberId)+"/ "+g(l.memberName),1)]),_:1})):p("",!0),t(e).checkList.includes("billTime")?(r(),u(d,{key:1,"show-overflow-tooltip":"",align:"center",prop:"billTime",label:"账单日期"})):p("",!0),t(e).checkList.includes("billAmount")?(r(),u(d,{key:2,"show-overflow-tooltip":"",align:"center",prop:"billAmount",label:"账单金额"})):p("",!0),t(e).checkList.includes("taxesFees")?(r(),u(d,{key:3,"show-overflow-tooltip":"",align:"center",prop:"taxesFees",label:"税"})):p("",!0),t(e).checkList.includes("payAmount")?(r(),u(d,{key:4,"show-overflow-tooltip":"",align:"center",prop:"payAmount",label:"实际金额"})):p("",!0),t(e).checkList.includes("payTime")?(r(),u(d,{key:5,"show-overflow-tooltip":"",align:"center",prop:"payTime",label:"支付时间"})):p("",!0),t(e).checkList.includes("notes")?(r(),u(d,{key:6,"show-overflow-tooltip":"",align:"center",prop:"notes",label:"说明"},{default:n(({row:l})=>[m(g(l.notes?l.notes:"-"),1)]),_:1})):p("",!0),t(e).checkList.includes("billStatus")?(r(),u(d,{key:7,align:"center","show-overflow-tooltip":"",prop:"",label:"账单状态"},{default:n(({row:l})=>[m(g(t(e).billStatusList[l.billStatus-1]),1)]),_:1})):p("",!0),a(B,{align:"center",prop:"i",label:"操作","show-overflow-tooltip":"",width:"260"},{default:n(({row:l})=>[l.billStatus===1?(r(),S(x,{key:0},[a(y,{size:"small",plain:"",type:"primary",onClick:L=>z(l.id,1)},{default:n(()=>[m(" 支付 ")]),_:2},1032,["onClick"]),a(y,{size:"small",plain:"",type:"danger",onClick:L=>z(l.id,2)},{default:n(()=>[m(" 拒绝支付 ")]),_:2},1032,["onClick"])],64)):p("",!0)]),_:1})]),_:1},8,["border","size","stripe","data"])),[[le,t(e).loading]]),a(te,{"current-page":t(f).page,total:t(f).total,"page-size":t(f).size,"page-sizes":t(f).sizes,layout:t(f).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:R,onCurrentChange:w},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),t(e).formMode==="dialog"||t(e).formMode==="drawer"?(r(),u(Me,{key:0,id:t(e).formModeProps.id,modelValue:t(e).formModeProps.visible,"onUpdate:modelValue":o[11]||(o[11]=l=>t(e).formModeProps.visible=l),mode:t(e).formMode,onSuccess:c},null,8,["id","modelValue","mode"])):p("",!0)],2)}}}),Fe=Le(Pe,[["__scopeId","data-v-e3669a6f"]]);export{Fe as default};
