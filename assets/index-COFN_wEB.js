
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as de,m as J,r as u,l as ie,u as ce,c as me,n as pe,a as d,o as c,e as f,w as e,f as o,g,i as s,b as C,t as q,F,y as h,z as fe,j as O,p as G,E as Q,aH as ve,aI as _e,L as ge}from"./index-D3RVrWA-.js";import{a as he}from"./department-CX8IL40m.js";import{a as be}from"./position_manage-Cvptat3E.js";import{u as ye}from"./tenant_role-Cu6joLsP.js";import{u as Ne}from"./configuration_manager-CsR-8c2x.js";import"./configuration_role-Pvc7NG3_.js";const W=v=>(ve("data-v-b9e3250a"),v=v(),_e(),v),Ve=W(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"基本信息")],-1)),we={class:"card-header"},ke={class:"leftTitle"},xe={key:0,style:{"margin-left":"20px","font-size":"14px"}},Ie=W(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"角色信息")],-1)),Se=de({__name:"index",props:J(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:J(["success","getList"],["update:modelValue"]),setup(v,{emit:X}){const Y=Ne(),K=u([]),H=u(),ee=ie(),ae=u(),le=ye(),z=u(),k=u(),te=u(!1),Z=u(),$=u(),b=v,B=X,x=u(),L=ce(v,"modelValue"),oe=me(()=>b.id===""?"新增用户":"编辑用户"),re={children:"children",label:"name"},m=u();u([]);const l=u({id:b.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",organizationalStructureId:""}),_=u([]),I=u({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(i,t,r)=>{const n=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;l.value.phoneNumber?n.test(l.value.phoneNumber)?r():r(new Error("请输入合法手机号")):r()},trigger:"blur"}],email:[{validator:(i,t,r)=>{const n=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;l.value.email?n.test(l.value.email)?r():r(new Error("请输入合法邮箱")):r()},trigger:"blur"}]});function se(){l.value.email||(I.value.email=[],m.value.clearValidate("email")),l.value.phoneNumber||(I.value.phoneNumber=[],m.value.clearValidate("phoneNumber")),_.value=x.value.getCheckedKeys(!1);const i=x.value.getCheckedKeys(),t=x.value.getHalfCheckedKeys(),r=i.concat(t);l.value.organizationalStructureId=r[0],l.value.id?m.value&&m.value.validate(n=>{if(n){const{id:p,phoneNumber:U,email:P,password:y,name:N,country:V,active:R,type:A,role:D,positionId:M,organizationalStructureId:E,userName:T}=l.value,a={id:p,phoneNumber:U,email:P,password:y,name:N,country:V,active:R,type:A,role:D,positionId:M,organizationalStructureId:E,userName:T};$.value===a.phoneNumber&&delete a.phoneNumber,Z.value===a.email&&delete a.email,a.password||delete a.password,G.edit(a).then(()=>{Q.success({message:"编辑成功",center:!0}),B("success"),S()})}}):m.value&&m.value.validate(n=>{n&&G.create(l.value).then(()=>{Q.success({message:"新增成功",center:!0}),B("success"),B("getList"),S()})})}function S(){L.value=!1}const ne=(i,t)=>{t?j(i.id):ue()},j=i=>{const t=r=>{r.forEach(n=>{n.disabled=n.id!==i,n.children&&t(n.children)})};t(k.value)},ue=()=>{const i=t=>{t.forEach(r=>{r.disabled=!1,r.children&&i(r.children)})};i(k.value)};return pe(async()=>{_.value=[];const{data:i}=await be.list({page:1,limit:10,id:null,name:"",active:null});H.value=i.data,K.value=await Y.getStaff(),z.value=await le.getRole();const t=await he.list({name:""});if(k.value=t.data,ae.value=await ee.getCountry(),b.id!==""&&b.row){I.value.password=[],l.value=JSON.parse(b.row);const r=l.value.organizationalStructureId;_.value=Array.isArray(r)?r:[r],Z.value=l.value.email,$.value=l.value.phoneNumber,te.value=!0}_.value.length>0&&j(_.value[0])}),(i,t)=>{const r=d("el-input"),n=d("el-form-item"),p=d("el-col"),U=d("el-option"),P=d("el-select"),y=d("el-row"),N=d("el-card"),V=d("el-text"),R=d("el-tree"),A=d("el-radio"),D=d("el-radio-group"),M=d("ElForm"),E=d("ElButton"),T=d("ElDrawer");return c(),f(T,{modelValue:L.value,"onUpdate:modelValue":t[7]||(t[7]=a=>L.value=a),title:s(oe),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:e(()=>[o(E,{size:"large",onClick:S},{default:e(()=>[g(" 取消 ")]),_:1}),o(E,{type:"primary",size:"large",onClick:se},{default:e(()=>[g(" 确定 ")]),_:1})]),default:e(()=>[o(M,{ref_key:"formRef",ref:m,model:s(l),rules:s(I),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[o(N,{class:"box-card"},{header:e(()=>[Ve]),default:e(()=>[o(y,{gutter:24},{default:e(()=>[o(p,{span:8},{default:e(()=>[o(n,{label:"用户名",prop:"userName"},{default:e(()=>[o(r,{modelValue:s(l).userName,"onUpdate:modelValue":t[0]||(t[0]=a=>s(l).userName=a),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"姓名",prop:""},{default:e(()=>[o(r,{modelValue:s(l).name,"onUpdate:modelValue":t[1]||(t[1]=a=>s(l).name=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"手机号",prop:"phoneNumber"},{default:e(()=>[o(r,{modelValue:s(l).phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=a=>s(l).phoneNumber=a),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"邮箱",prop:"email"},{default:e(()=>[o(r,{modelValue:s(l).email,"onUpdate:modelValue":t[3]||(t[3]=a=>s(l).email=a),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"职位",prop:""},{default:e(()=>[o(P,{modelValue:s(l).positionId,"onUpdate:modelValue":t[4]||(t[4]=a=>s(l).positionId=a),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[5]||(t[5]=()=>{})},{default:e(()=>[(c(!0),C(F,null,q(s(H),a=>(c(),f(U,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(N,{class:"box-card"},{header:e(()=>[h("div",we,[h("div",ke,[g(" 部门信息"),s(l).enableChargePerson?(c(),C("span",xe,[g("负责人:"),(c(!0),C(F,null,q(s(K),a=>(c(),f(V,{key:a.id},{default:e(()=>[a.id===s(l).id?(c(),f(V,{key:0},{default:e(()=>[g(fe(a.name),1)]),_:2},1024)):O("",!0)]),_:2},1024))),128))])):O("",!0)])])]),default:e(()=>[o(y,{gutter:24},{default:e(()=>[o(n,{label:"分配部门:"},{default:e(()=>[o(R,{style:{"max-width":"600px"},ref_key:"treeRef",ref:x,data:s(k),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":s(_),"default-expand-all":"",props:re,onCheckChange:ne},null,8,["data","default-checked-keys"])]),_:1})]),_:1})]),_:1}),o(N,{class:"box-card"},{header:e(()=>[Ie]),default:e(()=>[o(y,{gutter:24},{default:e(()=>[o(n,{label:"分配角色:"},{default:e(()=>{var a;return[(a=s(z))!=null&&a.length?(c(),f(D,{key:0,modelValue:s(l).role,"onUpdate:modelValue":t[6]||(t[6]=w=>s(l).role=w)},{default:e(()=>[(c(!0),C(F,null,q(s(z),w=>(c(),f(A,{key:w.id,value:w.roleName,label:w.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(c(),f(V,{key:1},{default:e(()=>[g("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ae=ge(Se,[["__scopeId","data-v-b9e3250a"]]);export{Ae as default};
