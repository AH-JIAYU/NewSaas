
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{ad as C,d as Ve,r as d,az as we,ac as Ee,o as he,a2 as i,al as xe,a3 as Pe,h as t,a as g,i as S,f as a,w as s,A as Ie,k as F,bo as Ue,b as I,N as D,O as L,c as k,g as P,ai as _,I as Ne,aH as Ce,aI as Se,y as Fe,an as M}from"./index-JYvP5qSa.js";const $={list:()=>C.post("user/getUserInfo"),edit:v=>C.post("user/update",v),uploadAvatar:v=>C.post("user/uploadAvatar",v)},T=v=>(Ce("data-v-3e2d10ef"),v=v(),Se(),v),ke=T(()=>I("h2",null,"个人信息",-1)),Te=T(()=>I("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Re=["src"],ze=T(()=>I("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),G=Ve({name:"personalSetting",__name:"setting",emits:["success"],setup(v,{expose:H,emit:J}){const V=d(!1),Z=we(),R=J,Y="https://saas-api.surveysaas.com/api/user/uploadAvatar",K=Ee(),z=d([]),m=d(!1),B=d(!1),b=d(!1),Q=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],w=d(),E=d(),l=d({type:"company",name:"",phone:"",email:"",currencyType:"",companyName:"",legalPersonName:"",taxId:"",isInvitation:1}),c=d({oldPassword:"",password:"",confirmPassword:""}),W=(r,e,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(l.value.phone)?n():n(new Error("请输入合法手机号"))},X=(r,e,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l.value.email)?n():n(new Error("请输入合法邮箱"))},U=(r,e,n)=>{/[\s\u4e00-\u9fa5]/.test(e)?n(new Error("密码中带有空格或汉字")):n()},ee=d({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:X,trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:W,trigger:"blur"}]}),le=d({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:U,trigger:"blur"},{validator:(r,e,n)=>{e===c.value.oldPassword?n(new Error("新密码不能与旧密码一致")):n()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:U,trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:U,trigger:"blur"},{validator:(r,e,n)=>{e!==c.value.password?n(new Error("两次输入的密码不一致")):n()},trigger:"blur"}]}),O=r=>{(r!==l.value.phone||r!==l.value.email)&&(B.value=!0)};function ae(){w.value&&w.value.validate(async r=>{if(r)try{if(m.value=!0,l.value.type==="personal"?(delete l.value.companyName,delete l.value.legalPersonName,delete l.value.taxId,delete l.value.country,delete l.value.avatar):(delete l.value.country,delete l.value.avatar),l.value.country==="CN"?delete l.value.email:delete l.value.phone,B.value||(delete l.value.phone,delete l.value.email),(await $.edit(l.value)).status===-1)return _.warning({message:"修改失败",center:!0});R("success"),m.value=!1,_.success({message:"修改成功",center:!0}),y()}catch{}finally{m.value=!1}})}const te=Z.token,oe=d({Token:te}),q=d(""),h=d(!1),f=d([]),se=async()=>{V.value=!1,_.success({message:"删除成功",center:!0})},re=(r,e)=>{r.status===-1?(Ne.error(r.error,{zIndex:2e3}),f.value=f.value.filter(n=>n.name!==e.name)):V.value=!0},ne=async()=>{_.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},ue=r=>{q.value=r.url,h.value=!0},de=()=>{E.value&&E.value.validate(async r=>{if(r)try{if(m.value=!0,delete c.value.confirmPassword,(await $.edit(c.value)).status===-1)return _.warning({message:"修改失败",center:!0});R("success"),m.value=!1,_.success({message:"修改成功",center:!0}),y()}catch{}finally{m.value=!1}})};async function ie(r){l.value=r,f.value.push({name:"file",url:l.value.avatar}),l.value.avatar!==""&&(V.value=!0),b.value=!0}function y(){w.value.resetFields(),E.value.resetFields(),Object.assign(l,{}),f.value=[],Object.assign(c,{}),b.value=!1}return he(async()=>{try{m.value=!0,z.value=await K.getCountry(),m.value=!1}catch{}finally{m.value=!1}}),H({showEdit:ie}),(r,e)=>{const n=i("el-icon"),N=i("el-upload"),ce=i("el-dialog"),u=i("ElFormItem"),p=i("ElInput"),me=i("ElOption"),pe=i("ElSelect"),ve=i("el-option"),fe=i("el-select"),ge=i("el-switch"),x=i("ElButton"),A=i("ElForm"),j=i("ElTabPane"),_e=i("ElTabs"),be=i("el-drawer"),ye=xe("loading");return Pe((g(),S("div",null,[a(be,{modelValue:t(b),"onUpdate:modelValue":e[14]||(e[14]=o=>F(b)?b.value=o:null),title:"修改用户信息",direction:"rtl","before-close":y,style:{height:"100%"},size:"40%"},{default:s(()=>[a(_e,{"tab-position":"left"},{default:s(()=>[a(j,{label:"个人信息",class:"basic"},{default:s(()=>[ke,a(A,{ref_key:"userFormRef",ref:w,model:t(l),rules:t(ee),"label-width":"120px","el-width":"120px"},{default:s(()=>[a(u,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[a(N,{class:Ie({hide_box:t(V)}),"file-list":t(f),"onUpdate:fileList":e[0]||(e[0]=o=>F(f)?f.value=o:null),headers:t(oe),action:Y,"list-type":"picture-card",limit:1,"on-preview":ue,"on-remove":se,"on-success":re,"on-exceed":ne},{tip:s(()=>[Te]),default:s(()=>[a(n,{class:"el-icon--upload"},{default:s(()=>[a(t(Ue))]),_:1})]),_:1},8,["class","file-list","headers"]),a(ce,{modelValue:t(h),"onUpdate:modelValue":e[1]||(e[1]=o=>F(h)?h.value=o:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[I("img",{"w-full":"",src:t(q),alt:"Preview Image"},null,8,Re)]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"用户名"},{default:s(()=>[a(p,{disabled:"",modelValue:t(l).name,"onUpdate:modelValue":e[2]||(e[2]=o=>t(l).name=o),placeholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),a(u,{label:"区域"},{default:s(()=>[a(pe,{modelValue:t(l).country,"onUpdate:modelValue":e[3]||(e[3]=o=>t(l).country=o),disabled:""},{default:s(()=>[(g(!0),S(D,null,L(t(z),o=>(g(),k(me,{label:o.chineseName,value:o.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(u,{prop:"",label:"货币类型"},{default:s(()=>[a(fe,{modelValue:t(l).currencyType,"onUpdate:modelValue":e[4]||(e[4]=o=>t(l).currencyType=o),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(g(),S(D,null,L(Q,o=>a(ve,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"公司名称"},{default:s(()=>[a(p,{modelValue:t(l).companyName,"onUpdate:modelValue":e[5]||(e[5]=o=>t(l).companyName=o),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1}),a(u,{label:"公司税号"},{default:s(()=>[a(p,{modelValue:t(l).taxId,"onUpdate:modelValue":e[6]||(e[6]=o=>t(l).taxId=o),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1}),a(u,{label:"法人姓名"},{default:s(()=>[a(p,{modelValue:t(l).legalPersonName,"onUpdate:modelValue":e[7]||(e[7]=o=>t(l).legalPersonName=o),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1}),t(l).country==="CN"?(g(),k(u,{key:0,prop:"phone",label:"手机号码"},{default:s(()=>[a(p,{modelValue:t(l).phone,"onUpdate:modelValue":e[8]||(e[8]=o=>t(l).phone=o),placeholder:"请输入你的手机号码",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})):(g(),k(u,{key:1,prop:"",label:"电子邮箱"},{default:s(()=>[a(p,{modelValue:t(l).email,"onUpdate:modelValue":e[9]||(e[9]=o=>t(l).email=o),placeholder:"请输入你的电子邮箱",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})),a(u,{prop:"isInvitation",label:"合作邀约"},{default:s(()=>[a(ge,{modelValue:t(l).isInvitation,"onUpdate:modelValue":e[10]||(e[10]=o=>t(l).isInvitation=o),"inline-prompt":"","active-text":"启用","inactive-text":"禁用","active-value":2,"inactive-value":1},null,8,["modelValue"])]),_:1}),a(u,null,{default:s(()=>[a(x,{onClick:ae,type:"primary"},{default:s(()=>[P(" 保存 ")]),_:1}),a(x,{onClick:y,type:"primary"},{default:s(()=>[P(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(j,{label:"账户管理",class:"security"},{default:s(()=>[ze,a(A,{ref_key:"accountFormRef",ref:E,model:t(c),rules:t(le),"label-width":"120px"},{default:s(()=>[a(u,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[a(p,{modelValue:t(c).oldPassword,"onUpdate:modelValue":e[11]||(e[11]=o=>t(c).oldPassword=o),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),a(u,{prop:"password",label:"新密码"},{default:s(()=>[a(p,{modelValue:t(c).password,"onUpdate:modelValue":e[12]||(e[12]=o=>t(c).password=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[a(p,{modelValue:t(c).confirmPassword,"onUpdate:modelValue":e[13]||(e[13]=o=>t(c).confirmPassword=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,null,{default:s(()=>[a(x,{onClick:de,type:"primary"},{default:s(()=>[P(" 保存 ")]),_:1}),a(x,{onClick:y,type:"primary"},{default:s(()=>[P(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[ye,t(m)]])}}});typeof M=="function"&&M(G);const Be=Fe(G,[["__scopeId","data-v-3e2d10ef"]]),qe=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{$ as a,qe as b,Be as s};
