
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as H,s as M}from"./apiLoading-B4EcSydr.js";import{a as U}from"./projectManagement-CXlLuWb3.js";import{a as F}from"./survey_vip_department-CDew2uFj.js";import{u as O}from"./survey_vipGroup-CNYuBrmz.js";import{d as P,r as n,n as Q,a as s,q as J,o as d,b as W,f as i,w as t,y as X,g as u,s as Y,e as v,z as C,i as o,j as I,A as Z,E as $,L as ee}from"./index-DmRfvvua.js";import"./survey_vipGroup-Dm6q3OjF.js";const te={style:{flex:"auto"}},oe=P({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(le,{expose:V,emit:L}){const S=O(),h=n([]),r=n(),p=n([]),j={children:"children",label:"name"},E=L,f=n(!1),k=n(),e=n({list:[],title:null,vipGroupList:[],form:{projectId:"",allocationType:3,groupSupplierIdList:[]}}),N=n({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择至少一项"}]});async function T(l,a){e.value.list=[{...l}],e.value.form.projectId=l.projectId,e.value.vipGroupList=await H(S.getGroupNameList()),a==="reassign"?e.value.title="重新分配":e.value.title="分配",f.value=!0}function b(){k.value.resetFields(),Object.assign(e.value.form,{projectId:"",groupSupplierIdList:[]}),f.value=!1}const K=(l,a)=>{a?(r.value.getCheckedKeys().forEach(_=>{_!==l.id&&r.value.setChecked(_,!1)}),p.value=[l.id]):p.value=p.value.filter(y=>y!==l.id),p.value=r.value.getCheckedKeys(!1);const m=r.value.getCheckedKeys(),w=r.value.getHalfCheckedKeys(),g=m.concat(w);e.value.form.groupSupplierIdList=g};function R(){k.value.validate(async l=>{if(l){const{status:a}=await M(U.allocation(e.value.form));a===1&&$.success({message:"分配成功",center:!0}),b(),E("fetch-data")}})}function G(){e.value.form.groupSupplierIdList=[]}return Q(async()=>{const l=await F.list({name:""});l.data&&(h.value=l.data)}),V({showEdit:T}),(l,a)=>{const m=s("el-table-column"),w=s("el-table"),g=s("el-radio"),y=s("el-radio-group"),_=s("el-form-item"),z=s("el-tree"),B=s("el-text"),q=s("el-form"),x=s("el-button"),A=s("el-dialog"),D=J("loading");return d(),W("div",null,[i(A,{modelValue:o(f),"onUpdate:modelValue":a[1]||(a[1]=c=>Z(f)?f.value=c:null),title:o(e).title,width:"700","before-close":b},{footer:t(()=>[X("div",te,[i(x,{onClick:b},{default:t(()=>[u(" 取消 ")]),_:1}),i(x,{type:"primary",onClick:R},{default:t(()=>[u(" 确定 ")]),_:1})])]),default:t(()=>[Y((d(),v(w,{data:o(e).list,"row-key":"id"},{default:t(()=>[i(m,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),i(m,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"projectName"}),i(m,{align:"left","show-overflow-tooltip":"",label:"配额/限量",prop:"name"},{default:t(({row:c})=>[u(C(c.limitedQuantity||0)+"/ "+C(c.num||0),1)]),_:1})]),_:1},8,["data"])),[[D,!1]]),i(q,{ref_key:"formRef",ref:k,"label-width":"6rem",rules:o(N),model:o(e).form,inline:!1,style:{"margin-top":"1.25rem"}},{default:t(()=>[i(_,{label:"分配目标"},{default:t(()=>[i(y,{modelValue:o(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=c=>o(e).form.allocationType=c),class:"ml-4",onChange:G},{default:t(()=>[i(g,{value:3,size:"large"},{default:t(()=>[u(" 部门 ")]),_:1}),o(e).title==="重新分配"?(d(),v(g,{key:0,value:5,size:"large"},{default:t(()=>[u(" 取消分配 ")]),_:1})):I("",!0)]),_:1},8,["modelValue"])]),_:1}),o(e).form.allocationType===3&&o(e).form.allocationType!==5?(d(),v(_,{key:0,label:"部门",prop:""},{default:t(()=>[o(h).length>0?(d(),v(z,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:r,data:o(h),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":o(p),"default-expand-all":"",props:j,onCheckChange:K},null,8,["data","default-checked-keys"])):(d(),v(B,{key:1},{default:t(()=>[u("暂无数据")]),_:1}))]),_:1})):I("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),de=ee(oe,[["__scopeId","data-v-cdfcb4c3"]]);export{de as default};
