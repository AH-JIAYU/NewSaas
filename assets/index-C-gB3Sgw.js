
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import E from"./index-C1iaX_FT.js";import{k as u,d as V,r as s,a0 as D,a1 as f,a as h,o as I,b as R,f as n,w as i,g as p,i as z,ai as g,_ as B}from"./index-Cw-g3-rV.js";import"./index-CVtRDxYI.js";import"./index-Cv_5Dw3_.js";import"./index-DFJLODe7.js";import"./index.vue_vue_type_script_setup_true_lang-C7ZN0uL1.js";const N={list:a=>u.post("project/getProjectList",a),create:a=>u.post("project/addProject",a),edit:a=>u.post("project/updateProject",a),detail:a=>u.post("project/getProject",a)},S=V({name:"ProjeckEdit",__name:"index",emits:["fetch-data"],setup(a,{expose:j,emit:T}){const k=T,c=s(!1),m=s(""),r=s([]);function w(e){r.value.push(e)}D("validateTopTabs",w);const d=s([]);let o=f([]);const v=s();async function y(e){e?(m.value="编辑",P(e)):(m.value="添加",o=f([{name:"项目名称",addProjectQuotaInfoList:[]}])),c.value=!0}function P(e){o.length=0,o.push({...e}),e.children&&e.children.length&&e.children.forEach(t=>{o.push({...t})})}async function b(){const e=[];r.value.forEach(l=>{e.push(l.validate())});const t=await Promise.allSettled(e);d.value=t.map(l=>l.status)}async function x(){if(await b(),d.value.every(e=>e==="fulfilled")){const e=o[0];e.addProjectInfoList=o.slice(1),console.log("masterData",e);const{status:t}=await N.create(e);t===1&&g.success({message:"新增成功",center:!0})}else v.value.activeLeftTab=d.value.indexOf("rejected"),g.warning({message:"请完善表单",center:!0})}function _(){o=f([]),k("fetch-data"),c.value=!1,r.value=[]}return j({showEdit:y}),(e,t)=>{const l=h("el-button"),L=h("el-drawer");return I(),R("div",null,[n(L,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=C=>c.value=C),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:"",onClose:_},{footer:i(()=>[n(l,{onClick:_},{default:i(()=>[p(" 取消 ")]),_:1}),n(l,{type:"warning",onClick:t[0]||(t[0]=()=>{})},{default:i(()=>[p(" 暂存 ")]),_:1}),n(l,{type:"primary",onClick:x},{default:i(()=>[p(" 确定 ")]),_:1})]),default:i(()=>[n(E,{onValidate:b,ref_key:"LeftTabsRef",ref:v,"left-tabs-data":z(o),"validate-top-tabs":r.value,"validate-all":d.value},null,8,["left-tabs-data","validate-top-tabs","validate-all"])]),_:1},8,["modelValue"])])}}}),$=B(S,[["__scopeId","data-v-cc80017c"]]);export{$ as default};
