
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Ce,r as v,l as Ie,aO as Le,n as we,Z as Ne,a as u,q as xe,o as i,b as _,v as C,f as o,j as f,w as n,s as Ee,aA as A,F as x,t as E,g as c,i as b,aN as Ve,e as s,A as y,p as V,aP as $,E as M,_ as De,aQ as Se,ap as ze,M as Be,ao as T}from"./index-BL1kLiLm.js";import{_ as Ue}from"./index-wvHHnhmk.js";import He from"./index-BhDkK49S.js";import Pe from"./index-Dx1fhlkm.js";import{u as Re}from"./department-DeJWmiTf.js";import{u as Ae}from"./position_manage-DcVLVOXD.js";import"./index-CQsjDEZM.js";import"./position_manage-iX5eTbcz.js";import"./tenant_role-DGgVGLaY.js";import"./configuration_role-BZHm_b7Q.js";import"./configuration_manager-nQ0fE4Ne.js";import"./department-CDTo8POA.js";const $e={class:"absolute-container"},Me={class:"page-main"},Te={class:"leftTree"},Fe={key:0,class:"leftData",span:3},je={class:"dataForm-container"},Ke={class:"copyId tableSmall"},Oe={class:"id oneLine"},F=Ce({name:"user",__name:"index",setup(Qe){const I=Ae(),D=v(),j=Ie(),K=v([]),L=Re(),S=v(),{pagination:h,getParams:qe,onSizeChange:O,onCurrentChange:Q,onSortChange:q}=Le(),w=v([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),J=[{label:"启用",value:!0},{label:"禁用",value:!1}],Z={children:"children",label:"name"},G=v(),z=v(),d=v({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),B=v(),W=v(),e=v({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),X=v();async function r(){const a={...e.value.search},l=await V.list(a);l.data&&(e.value.dataList=l.data.data,h.value.total=+l.data.total)}we(async()=>{try{d.value.loading=!0,K.value=await j.getCountry(),S.value=await(L==null?void 0:L.getDepartment())||[],D.value=await(I==null?void 0:I.getPositionManage())||[],r(),w.value.forEach(a=>{a.checked&&e.value.checkList.push(a.prop)}),d.value.loading=!1}catch{}finally{d.value.loading=!1}}),Ne(()=>d.value.search,a=>{G.value.filter(a)});function Y(a){return new Promise(l=>{$.confirm(`确认${a.active?"禁用":"启用"}「${a.name}」吗？`,"确认信息").then(()=>{try{d.value.loading=!0,V.edit({id:a.id,account:null,name:null,sex:null,phoneNumber:null,active:!a.active}).then(()=>(M.success({message:`${a.active?"禁用":"启用"}成功`,center:!0}),r(),d.value.loading=!1,l(!0))).catch(()=>(d.value.loading=!1,l(!1)))}catch{}finally{d.value.loading=!1}}).catch(()=>l(!1))})}function ee(a){var l;h.value.page=1,(l=a==null?void 0:a.children)!=null&&l.length?(e.value.search.id="",e.value.search.departmentId=a.id,r()):(e.value.search.id=a.id,e.value.search.departmentId="",r())}function te(a){O(a).then(()=>{e.value.search.limit=a,r()})}function ae(a=1){Q(a).then(()=>{e.value.search.page=a,r()})}function le({prop:a,order:l}){q(a,l).then(()=>r())}function ne(a){e.value.dialog.id="",e.value.dialog.visible=!0,e.value.dialog.level=1,a&&(e.value.dialog.parentId=a.id,e.value.dialog.level=Number(a.level)+1)}const oe=a=>{B.value=a[0]};function ie(){const{name:a,id:l}=B.value;$.confirm(`确认将「${a}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{V.reset({id:l}).then(()=>{M.success({message:"重置成功",center:!0}),r()})}).catch(()=>{})}function se(a){e.value.row=JSON.stringify(a),e.value.dialog.id=a.id,e.value.dialog.parentId=a.parentId,e.value.dialog.visible=!0}function re(a){z.value.showEdit(a)}function ue(){Object.assign(e.value.search,{id:"",userName:"",departmentId:null,active:null}),r()}return(a,l)=>{const U=u("el-tree"),H=u("ElInput"),de=u("el-option"),ce=u("el-select"),P=De,k=u("ElButton"),pe=u("ElSpace"),N=u("el-button"),R=u("el-col"),me=Se,ve=u("el-row"),g=u("ElTableColumn"),fe=u("ElSwitch"),ge=Ue,p=u("el-text"),he=u("el-empty"),_e=u("ElTable"),be=u("ElPagination"),ye=ze,ke=xe("loading");return i(),_("div",$e,[C("div",Me,[C("div",Te,[d.value.tree.length?(i(),_("div",Fe,[o(U,{style:{"max-width":"37.5rem","min-height":"45.4375rem",padding:"10px"},data:d.value.tree,ref_key:"treeRef",ref:X,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,props:Z,onNodeClick:ee},null,8,["data"])])):f("",!0),o(ye,null,{default:n(()=>[Ee((i(),_("div",je,[o(pe,null,{default:n(()=>[o(H,{modelValue:e.value.search.id,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value.search.id=t),placeholder:"员工ID",clearable:"",style:{width:"12.5rem"},onKeydown:A(r,["enter"])},null,8,["modelValue"]),o(H,{modelValue:e.value.search.userName,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value.search.userName=t),placeholder:"用户名",clearable:"",style:{width:"12.5rem"},onKeydown:A(r,["enter"])},null,8,["modelValue"]),o(ce,{modelValue:e.value.search.active,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.search.active=t),"value-key":"",placeholder:"状态",style:{width:"12.5rem"},clearable:"",filterable:"",onChange:r},{default:n(()=>[(i(),_(x,null,E(J,t=>o(de,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o(k,{type:"primary",onClick:r},{icon:n(()=>[o(P,{name:"i-ep:search"})]),_:1}),o(k,{onClick:ue},{icon:n(()=>[o(P,{name:"i-ep:refresh"})]),_:1})]),_:1}),o(ve,{style:{"margin-bottom":".3125rem"},gutter:24},{default:n(()=>[o(R,{style:{"margin-bottom":"1.5625rem"},span:10},{default:n(()=>[o(N,{type:"primary",size:"default",onClick:ne},{default:n(()=>[c(" 新增 ")]),_:1}),o(N,{type:"primary",size:"default",onClick:ie},{default:n(()=>[c(" 重置密码 ")]),_:1})]),_:1}),o(R,{style:{display:"flex","justify-content":"flex-end"},span:14},{default:n(()=>[o(N,{size:"default",onClick:l[3]||(l[3]=()=>{})},{default:n(()=>[c(" 导出 ")]),_:1}),o(me,{border:e.value.border,"onUpdate:border":l[4]||(l[4]=t=>e.value.border=t),tableAutoHeight:e.value.tableAutoHeight,"onUpdate:tableAutoHeight":l[5]||(l[5]=t=>e.value.tableAutoHeight=t),checkList:e.value.checkList,"onUpdate:checkList":l[6]||(l[6]=t=>e.value.checkList=t),columns:w.value,"onUpdate:columns":l[7]||(l[7]=t=>w.value=t),"line-height":e.value.lineHeight,"onUpdate:lineHeight":l[8]||(l[8]=t=>e.value.lineHeight=t),stripe:e.value.stripe,"onUpdate:stripe":l[9]||(l[9]=t=>e.value.stripe=t),style:{"margin-left":".75rem"},onQueryData:r},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),o(_e,{ref_key:"userItemRef",ref:W,data:e.value.dataList,border:e.value.border,size:e.value.lineHeight,stripe:e.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:le,onSelectionChange:l[10]||(l[10]=t=>e.value.selectionDataList=t),"row-key":"id","default-expand-all":"",onSelect:oe},{empty:n(()=>[o(he,{image:b(Ve),"image-size":300},null,8,["image"])]),default:n(()=>[o(g,{type:"selection",align:"left",fixed:""}),e.value.checkList.includes("active")?(i(),s(g,{key:0,align:"left",prop:"active",label:"状态"},{default:n(t=>[o(fe,{modelValue:t.row.active,"onUpdate:modelValue":m=>t.row.active=m,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>Y(t.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):f("",!0),e.value.checkList.includes("id")?(i(),s(g,{key:1,align:"left",width:"180",prop:"id",label:"员工ID"},{default:n(({row:t})=>[C("div",Ke,[C("div",Oe,"ID: "+y(t.id),1),o(ge,{class:"copy",content:t.id},null,8,["content"])])]),_:1})):f("",!0),e.value.checkList.includes("userName")?(i(),s(g,{key:2,align:"left",width:"130",prop:"userName",label:"用户名"},{default:n(({row:t})=>[o(p,{class:"tableBig"},{default:n(()=>[c(y(t.userName?t.userName:"-"),1)]),_:2},1024)]),_:1})):f("",!0),e.value.checkList.includes("phoneNumber")?(i(),s(g,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:n(({row:t})=>[o(p,{class:"tableBig"},{default:n(()=>[c(y(t.phoneNumber?t.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):f("",!0),e.value.checkList.includes("email")?(i(),s(g,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:n(({row:t})=>[o(p,{class:"tableBig"},{default:n(()=>[c(y(t.email?t.email:"-"),1)]),_:2},1024)]),_:1})):f("",!0),e.value.checkList.includes("departmentId")?(i(),s(g,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:n(({row:t})=>[t.departmentId?(i(),s(p,{key:0,class:"tableBig"},{default:n(()=>[(i(!0),_(x,null,E(S.value,m=>(i(),s(p,null,{default:n(()=>[t.departmentId===m.id?(i(),s(p,{key:0},{default:n(()=>[c(y(m.name?m.name:"-"),1)]),_:2},1024)):f("",!0)]),_:2},1024))),256))]),_:2},1024)):(i(),s(p,{key:1,class:"tableBig"},{default:n(()=>[c("-")]),_:1}))]),_:1})):f("",!0),e.value.checkList.includes("positionId")?(i(),s(g,{key:6,align:"left",prop:"positionId",label:"职位"},{default:n(({row:t})=>[t.positionId?(i(),s(p,{key:0,class:"tableBig"},{default:n(()=>[(i(!0),_(x,null,E(D.value,m=>(i(),s(p,null,{default:n(()=>[t.positionId===m.id?(i(),s(p,{key:0},{default:n(()=>[c(y(m.name?m.name:"-"),1)]),_:2},1024)):f("",!0)]),_:2},1024))),256))]),_:2},1024)):(i(),s(p,{key:1,class:"tableBig"},{default:n(()=>[c("-")]),_:1}))]),_:1})):f("",!0),o(g,{label:"操作",fixed:"right",width:"200",align:"left"},{default:n(t=>[o(k,{type:"primary",size:"small",plain:"",onClick:m=>se(t.row)},{default:n(()=>[c(" 编辑 ")]),_:2},1032,["onClick"]),o(k,{type:"warning",size:"small",plain:"",onClick:m=>re(t.row)},{default:n(()=>[c(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"]),o(be,{"current-page":b(h).page,total:b(h).total,"page-size":b(h).size,"page-sizes":b(h).sizes,layout:b(h).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:te,onCurrentChange:ae},null,8,["current-page","total","page-size","page-sizes","layout"])])),[[ke,d.value.loading]])]),_:1})]),e.value.dialog.visible?(i(),s(He,{key:0,id:e.value.dialog.id,modelValue:e.value.dialog.visible,"onUpdate:modelValue":l[11]||(l[11]=t=>e.value.dialog.visible=t),"catalogue-id":e.value.search.catalogueId,"parent-id":e.value.dialog.parentId,level:e.value.dialog.level,tree:d.value.tree,dataList:e.value.dataList,row:e.value.row,onSuccess:r},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):f("",!0),o(Pe,{ref_key:"detailRef",ref:z},null,512)])])}}});typeof T=="function"&&T(F);const it=Be(F,[["__scopeId","data-v-84f40abb"]]);export{it as default};
