
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as de,ad as ce,r as E,aN as me,o as pe,e as $,m as fe,aj as S,a3 as s,al as ge,b as u,j as M,g as t,w as a,a4 as B,ax as _e,O as N,P as D,c as g,h as r,t as _,i as v,aM as ve,k as I,B as he,aS as L,ai as T,_ as be,ao as ye,aH as Ce,aI as Ee,f as Me,aG as we,z as Se,an as U}from"./index-BnVk3aZr.js";import{_ as ke}from"./index.vue_vue_type_script_setup_true_lang-Clie07wY.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-BeqzWPZ5.js";import{u as Pe}from"./tenant_role-CnRCbrmi.js";import{u as Ve}from"./useTabbar-Dj4FxfpO.js";import"./index.vue_vue_type_script_setup_true_lang-CUvZx_4q.js";import"./configuration_role-C9y9FGXu.js";const ze=h=>(Ce("data-v-edc13d67"),h=h(),Ee(),h),$e=ze(()=>Me("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),F=de({name:"manager",__name:"list",setup(h){const j=ce(),k=E([]),G=Pe(),x=E(),{pagination:m,onSizeChange:H,onCurrentChange:O,onSortChange:R}=me(),P=Ve(),e=E({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",row:""},editProps:{visible:!1,id:""},search:{name:"",role:""},batch:{enable:!0,selectionDataList:[]},dataList:[]});E(),pe(async()=>{d(),k.value=await j.getCountry(),x.value=await G.getRole(),e.value.formMode==="router"&&$.on("get-data-list",()=>{d()})}),fe(()=>{e.value.formMode==="router"&&$.off("get-data-list")});function d(){try{e.value.loading=!0,S.list(e.value.search).then(o=>{var n;e.value.loading=!1,o.data&&o.status===1&&(e.value.dataList=o.data,m.value.total=(n=o.data)==null?void 0:n.length,e.value.dataList.forEach(y=>{y.statusLoading=!1}))})}catch{}finally{e.value.loading=!1}}function A(){Object.assign(e.value.search,{name:"",role:""}),d()}function K(o){H(o).then(()=>d())}function b(o=1){O(o).then(()=>d())}function J({prop:o,order:n}){R(o,n).then(()=>d())}function q(){e.value.formMode==="router"?P.open({name:"pagesExampleGeneralManagerCreate"}):(e.value.formModeProps.id="",e.value.formModeProps.row="",e.value.formModeProps.visible=!0)}function Q(o){e.value.formMode==="router"?P.open({name:"pagesExampleGeneralManagerEdit",params:{id:o.id}}):(e.value.formModeProps.id=o.id,e.value.formModeProps.row=JSON.stringify(o),e.value.formModeProps.visible=!0)}function W(o){return new Promise(n=>{L.confirm(`确认${o.active?"禁用":"启用"}「${o.name}」吗？`,"确认信息").then(()=>{try{e.value.loading=!0,S.edit({id:o.id,account:null,name:null,sex:null,phoneNumber:null,active:!o.active}).then(()=>(T.success({message:`${o.active?"禁用":"启用"}成功`,center:!0}),d(),e.value.loading=!1,n(!0))).catch(()=>(e.value.loading=!1,n(!1)))}catch{}finally{e.value.loading=!1}}).catch(()=>n(!1))})}function X(o){L.confirm(`确认删除「${o.name}」用户吗？`,"确认信息").then(()=>{try{e.value.loading=!1,S.delete({id:o.id}).then(()=>{e.value.loading=!1,d(),T.success({message:"删除成功",center:!0})})}catch{}finally{e.value.loading=!1}}).catch(()=>{})}return(o,n)=>{const y=s("ElInput"),w=s("ElFormItem"),Y=s("el-option"),Z=s("el-select"),V=be,p=s("ElButton"),ee=s("ElForm"),ae=ke,te=s("ElDivider"),z=s("ElSpace"),C=s("el-text"),f=s("ElTableColumn"),le=s("el-tag"),oe=s("ElSwitch"),ne=s("el-empty"),se=s("ElTable"),re=s("ElPagination"),ie=ye,ue=ge("loading");return u(),M("div",{class:he({"absolute-container":e.value.tableAutoHeight})},[t(ie,null,{default:a(()=>[t(ae,{"show-toggle":!1},{default:a(({fold:l,toggle:c})=>[t(ee,{model:e.value.search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:a(()=>[B(t(w,null,{default:a(()=>[t(y,{modelValue:e.value.search.name,"onUpdate:modelValue":n[0]||(n[0]=i=>e.value.search.name=i),placeholder:"请输入姓名",clearable:"",onKeydown:n[1]||(n[1]=_e(i=>b(),["enter"])),onClear:n[2]||(n[2]=i=>b())},null,8,["modelValue"])]),_:2},1536),[[we,!l]]),t(w,{prop:"role"},{default:a(()=>[t(Z,{modelValue:e.value.search.role,"onUpdate:modelValue":n[3]||(n[3]=i=>e.value.search.role=i),placeholder:"请选择角色"},{default:a(()=>[(u(!0),M(N,null,D(x.value,i=>(u(),g(Y,{key:i.id,label:i.roleName,value:i.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:a(()=>[t(p,{type:"primary",onClick:n[4]||(n[4]=i=>b())},{icon:a(()=>[t(V,{name:"i-ep:search"})]),default:a(()=>[r(" 筛选 ")]),_:1}),t(p,{onClick:A},{icon:a(()=>[$e]),default:a(()=>[r(" 重置 ")]),_:1}),t(p,{link:"",onClick:c},{icon:a(()=>[t(V,{name:l?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:a(()=>[r(" "+_(l?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),t(te,{"border-style":"dashed"}),t(z,{wrap:""},{default:a(()=>[t(p,{type:"primary",size:"default",onClick:q},{default:a(()=>[r(" 新增用户 ")]),_:1})]),_:1}),B((u(),g(se,{class:"my-4",data:e.value.dataList,stripe:"","highlight-current-row":"",border:"",height:"100%",onSortChange:J,onSelectionChange:n[5]||(n[5]=l=>e.value.batch.selectionDataList=l)},{empty:a(()=>[t(ne,{image:v(ve),"image-size":300},null,8,["image"])]),default:a(()=>[t(f,{prop:"account",sortable:"",label:"帐号"},{default:a(({row:l})=>[l.country==="CN"?(u(),g(C,{key:0,class:"mx-1"},{default:a(()=>[r(_(l.phone),1)]),_:2},1024)):(u(),g(C,{key:1,class:"mx-1"},{default:a(()=>[r(_(l.email),1)]),_:2},1024))]),_:1}),t(f,{prop:"name",label:"姓名",width:"150",align:"left"},{default:a(({row:l})=>[t(C,{class:"mx-1"},{default:a(()=>[r(_(l.name?l.name:"暂无数据"),1)]),_:2},1024)]),_:1}),t(f,{prop:"role",align:"left",width:"150",label:"角色"},{default:a(({row:l})=>[t(C,{class:"mx-1"},{default:a(()=>[r(_(l.role?l.role:"暂无数据"),1)]),_:2},1024)]),_:1}),t(f,{prop:"mobile",label:"区域",width:"150",align:"left"},{default:a(({row:l})=>[(u(!0),M(N,null,D(k.value,c=>(u(),M("div",{key:c.id,class:"mx-1"},[c.code===l.country?(u(),g(le,{key:0,type:"primary",class:"mx-1"},{default:a(()=>[r(_(c.chineseName),1)]),_:2},1024)):I("",!0)]))),128))]),_:1}),t(f,{label:"状态",width:"100",align:"left"},{default:a(l=>[t(oe,{modelValue:l.row.active,"onUpdate:modelValue":c=>l.row.active=c,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>W(l.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1}),t(f,{label:"操作",width:"200",align:"left",fixed:"right"},{default:a(l=>[t(z,null,{default:a(()=>[t(p,{type:"primary",size:"small",plain:"",onClick:c=>Q(l.row)},{default:a(()=>[r(" 编辑 ")]),_:2},1032,["onClick"]),t(p,{type:"danger",size:"small",plain:"",onClick:c=>X(l.row)},{default:a(()=>[r(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ue,e.value.loading]]),t(re,{"current-page":v(m).page,total:v(m).total,"page-size":v(m).size,"page-sizes":v(m).sizes,layout:v(m).layout,"hide-on-single-page":!1,class:"pagination",background:"",onCurrentChange:b,onSizeChange:K},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),e.value.formMode==="dialog"||e.value.formMode==="drawer"?(u(),g(xe,{key:0,id:e.value.formModeProps.id,modelValue:e.value.formModeProps.visible,"onUpdate:modelValue":n[6]||(n[6]=l=>e.value.formModeProps.visible=l),row:e.value.formModeProps.row,mode:e.value.formMode,onSuccess:d},null,8,["id","modelValue","row","mode"])):I("",!0)],2)}}});typeof U=="function"&&U(F);const Fe=Se(F,[["__scopeId","data-v-edc13d67"]]);export{Fe as default};
