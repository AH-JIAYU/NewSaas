
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ne,m as j,r as d,l as de,u as ue,c as ie,n as ce,a as u,o as c,e as f,w as e,f as o,g,i as r,b as C,t as T,F as q,y as h,z as me,j as J,p as pe,E as fe,aH as ve,aI as _e,L as ge}from"./index-B-NpraQI.js";import{a as he}from"./department-CjAByfyh.js";import{a as ye}from"./position_manage-CVJ6xXGK.js";import{u as be}from"./tenant_role-DA5PRa5A.js";import{u as Ve}from"./configuration_manager-BkI8UcDI.js";import"./configuration_role-COeVhKOH.js";const O=v=>(ve("data-v-980d81b4"),v=v(),_e(),v),we=O(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"基本信息")],-1)),ke={class:"card-header"},xe={class:"leftTitle"},Ie={key:0,style:{"margin-left":"20px","font-size":"14px"}},Se=O(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"角色信息")],-1)),Ee=ne({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success","getList"],["update:modelValue"]),setup(v,{emit:G}){const Q=Ve(),F=d([]),K=d(),W=de(),X=d(),Y=be(),N=d(),x=d(),ee=d(!1),H=d(),Z=d(),y=v,ae=G,I=d(),z=ue(v,"modelValue"),le=ie(()=>y.id===""?"新增用户":"编辑用户"),te={children:"children",label:"name"},m=d();d([]);const l=d({id:y.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",organizationalStructureId:""}),_=d([]),S=d({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{validator:(i,t,s)=>{const n=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;l.value.phone?n.test(l.value.phone)?s():s(new Error("请输入合法手机号")):s()},trigger:"blur"}],email:[{validator:(i,t,s)=>{const n=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;l.value.email?n.test(l.value.email)?s():s(new Error("请输入合法邮箱")):s()},trigger:"blur"}]});function oe(){l.value.email||(S.value.email=[],m.value.clearValidate("email")),l.value.phone||(S.value.phone=[],m.value.clearValidate("phone")),_.value=I.value.getCheckedKeys(!1);const i=I.value.getCheckedKeys(),t=I.value.getHalfCheckedKeys(),s=i.concat(t);l.value.organizationalStructureId=s[0],l.value.id?m.value&&m.value.validate(n=>{if(n){const{id:p,phone:U,email:L,password:b,name:V,country:w,active:P,type:R,role:A,positionId:D,organizationalStructureId:E,userName:M}=l.value,a={id:p,phone:U,email:L,password:b,name:V,country:w,active:P,type:R,role:A,positionId:D,organizationalStructureId:E,userName:M};Z.value===a.phone&&delete a.phone,H.value===a.email&&delete a.email,a.password||delete a.password,pe.edit(a).then(()=>{fe.success({message:"编辑成功",center:!0}),ae("success"),B()})}}):m.value&&m.value.validate(n=>{if(n){console.log("form.value",l.value);return}})}function B(){z.value=!1}const se=(i,t)=>{t?$(i.id):re()},$=i=>{const t=s=>{s.forEach(n=>{n.disabled=n.id!==i,n.children&&t(n.children)})};t(x.value)},re=()=>{const i=t=>{t.forEach(s=>{s.disabled=!1,s.children&&i(s.children)})};i(x.value)};return ce(async()=>{_.value=[];const{data:i}=await ye.list({page:1,limit:10,id:null,name:"",active:null});K.value=i.data,F.value=await Q.getStaff(),N.value=await Y.getRole();const t=await he.list({name:""});if(x.value=t.data,X.value=await W.getCountry(),y.id!==""&&y.row){S.value.password=[],l.value=JSON.parse(y.row);const s=l.value.organizationalStructureId;_.value=Array.isArray(s)?s:[s],H.value=l.value.email,Z.value=l.value.phone,ee.value=!0}_.value.length>0&&$(_.value[0])}),(i,t)=>{const s=u("el-input"),n=u("el-form-item"),p=u("el-col"),U=u("el-option"),L=u("el-select"),b=u("el-row"),V=u("el-card"),w=u("el-text"),P=u("el-tree"),R=u("el-radio"),A=u("el-radio-group"),D=u("ElForm"),E=u("ElButton"),M=u("ElDrawer");return c(),f(M,{modelValue:z.value,"onUpdate:modelValue":t[7]||(t[7]=a=>z.value=a),title:r(le),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:B},{footer:e(()=>[o(E,{size:"large",onClick:B},{default:e(()=>[g(" 取消 ")]),_:1}),o(E,{type:"primary",size:"large",onClick:oe},{default:e(()=>[g(" 确定 ")]),_:1})]),default:e(()=>[o(D,{ref_key:"formRef",ref:m,model:r(l),rules:r(S),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[o(V,{class:"box-card"},{header:e(()=>[we]),default:e(()=>[o(b,{gutter:24},{default:e(()=>[o(p,{span:8},{default:e(()=>[o(n,{label:"用户名",prop:"userName"},{default:e(()=>[o(s,{modelValue:r(l).userName,"onUpdate:modelValue":t[0]||(t[0]=a=>r(l).userName=a),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"姓名",prop:""},{default:e(()=>[o(s,{modelValue:r(l).name,"onUpdate:modelValue":t[1]||(t[1]=a=>r(l).name=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"手机号",prop:"phone"},{default:e(()=>[o(s,{modelValue:r(l).phone,"onUpdate:modelValue":t[2]||(t[2]=a=>r(l).phone=a),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"邮箱",prop:"email"},{default:e(()=>[o(s,{modelValue:r(l).email,"onUpdate:modelValue":t[3]||(t[3]=a=>r(l).email=a),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,{span:8},{default:e(()=>[o(n,{label:"职位",prop:""},{default:e(()=>[o(L,{modelValue:r(l).positionId,"onUpdate:modelValue":t[4]||(t[4]=a=>r(l).positionId=a),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[5]||(t[5]=()=>{})},{default:e(()=>[(c(!0),C(q,null,T(r(K),a=>(c(),f(U,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(V,{class:"box-card"},{header:e(()=>[h("div",ke,[h("div",xe,[g(" 部门信息"),r(l).enableChargePerson?(c(),C("span",Ie,[g("负责人:"),(c(!0),C(q,null,T(r(F),a=>(c(),f(w,{key:a.id},{default:e(()=>[a.id===r(l).id?(c(),f(w,{key:0},{default:e(()=>[g(me(a.name),1)]),_:2},1024)):J("",!0)]),_:2},1024))),128))])):J("",!0)])])]),default:e(()=>[o(b,{gutter:24},{default:e(()=>[o(n,{label:"分配部门:"},{default:e(()=>[o(P,{style:{"max-width":"600px"},ref_key:"treeRef",ref:I,data:r(x),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":r(_),"default-expand-all":"",props:te,onCheckChange:se},null,8,["data","default-checked-keys"])]),_:1})]),_:1})]),_:1}),o(V,{class:"box-card"},{header:e(()=>[Se]),default:e(()=>[o(b,{gutter:24},{default:e(()=>[o(n,{label:"分配角色:"},{default:e(()=>{var a;return[(a=r(N))!=null&&a.length?(c(),f(A,{key:0,modelValue:r(l).role,"onUpdate:modelValue":t[6]||(t[6]=k=>r(l).role=k)},{default:e(()=>[(c(!0),C(q,null,T(r(N),k=>(c(),f(R,{key:k.id,value:k.roleName,label:k.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(c(),f(w,{key:1},{default:e(()=>[g("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ae=ge(Ee,[["__scopeId","data-v-980d81b4"]]);export{Ae as default};
