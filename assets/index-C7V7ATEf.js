
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as be,aK as he,r as f,a5 as P,c as ve,k as we,a as s,p as ke,o as p,b as q,f as a,w as e,i as o,az as M,F as Ce,t as Ie,e as u,g as i,H as v,I as w,q as A,aq as xe,j as g,S as je,N as Le,aM as Ne,aN as Se,ap as ze,aG as Re,aH as Te,s as G,R as De}from"./index-BMr8ipAC.js";import{_ as Ee}from"./index.vue_vue_type_style_index_0_lang-CGcKD7S1.js";import{_ as Ve}from"./index.vue_vue_type_script_setup_true_lang-BsfC8ruC.js";import{_ as $e,a as K}from"./index.vue_vue_type_script_setup_true_lang-DHtFGRDs.js";import{u as Ue}from"./user_customer-BBIhenfV.js";/* empty css                      */import"./user_customer-DiQH-RWU.js";const O=I=>(Re("data-v-14a46730"),I=I(),Te(),I),Fe=O(()=>G("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),He=O(()=>G("br",null,null,-1)),Be=be({name:"preInvestigationRecords",__name:"index",setup(I){const Q=Ue(),{getParams:J,pagination:d,onSizeChange:W,onCurrentChange:X}=he(),x=f(!1),V=f([]);f("");const _=f([]),j=f(!0),L=f(!1),N=f("default"),S=f(!1),z=f([{prop:"projectId",label:"项目ID",sortable:!0,checked:!0},{prop:"projectName",label:"项目名称",sortable:!0,checked:!0},{prop:"allocationType",label:"分配类型",sortable:!0,checked:!0},{prop:"passNumber",label:"通过数/提交数",sortable:!0,checked:!0},{prop:"passRate",label:"通过率",sortable:!0,checked:!0}]),r=P({projectId:"",projectName:"",allocationType:""}),$=f(),y=P({allocationTypeList:["未分配","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],viceStatusList:["待审","免审","过IR","时间果断","超时完成","超量完成","审核成功","审核失败","数据冻结","时间段过载","ip不一致","id重复参与","和解"],customerList:[],vipList:[],vipGroupList:[],tenantSupplierList:[],expandedRows:[]});function Y(){r.pageNo=1,C()}function Z(n){W(n).then(()=>C())}function k(n=1){X(n).then(()=>C())}async function U(n){const t=y.expandedRows.indexOf(n.id);if(t!==-1?y.expandedRows.splice(t,1):y.expandedRows.push(n.id),!n.children){const R=await K.childList({projectId:n.projectId});n.children=R.data.projectScreenMemberChildInfoList}}function ee(n){$.value.showEdit(n)}const te=ve(()=>V.value.filter(t=>{if(t.projectId.includes(r.projectId)&&t.projectName.includes(r.projectName)&&(!r.allocationType||t.allocationType===r.allocationType))return!0}).slice((d.value.page-1)*d.value.size,d.value.page*d.value.size));async function C(){try{x.value=!0;const n={...J(),...r},{data:t}=await K.list(n);V.value=t.projectSurveyScreenInfoList,d.value.total=t.projectSurveyScreenInfoList.length,x.value=!1}catch{}finally{x.value=!1}}function ae(){Object.assign(r,{projectId:"",projectName:"",allocationType:""}),C()}return we(async()=>{y.customerList=await Q.getCustomerList(),z.value.forEach(n=>{n.checked&&_.value.push(n.prop)}),C()}),(n,t)=>{const R=s("el-input"),E=s("el-form-item"),oe=s("el-option"),le=s("el-select"),F=Le,T=s("ElButton"),ne=s("ElFormItem"),se=s("ElForm"),ie=Ve,re=s("ElDivider"),pe=Ee,H=s("el-button"),ce=Ne,ue=Se,de=s("el-row"),b=s("el-table-column"),h=s("el-text"),D=s("ElTableColumn"),B=s("el-table"),me=s("el-empty"),fe=s("ElPagination"),_e=ze,ge=ke("loading");return p(),q("div",{class:je({"absolute-container":o(S)})},[a(_e,null,{default:e(()=>[a(ie,{"show-toggle":!1},{default:e(({fold:l,toggle:m})=>[a(se,{model:o(r),size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:e(()=>[a(E,{label:""},{default:e(()=>[a(R,{modelValue:o(r).projectId,"onUpdate:modelValue":t[0]||(t[0]=c=>o(r).projectId=c),modelModifiers:{trim:!0},clearable:"",inline:!1,placeholder:"项目ID",onKeydown:t[1]||(t[1]=M(c=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),a(E,{label:""},{default:e(()=>[a(R,{modelValue:o(r).projectName,"onUpdate:modelValue":t[2]||(t[2]=c=>o(r).projectName=c),modelModifiers:{trim:!0},clearable:"",inline:!1,placeholder:"项目名称",onKeydown:t[3]||(t[3]=M(c=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),a(E,{label:""},{default:e(()=>[a(le,{modelValue:o(r).allocationType,"onUpdate:modelValue":t[4]||(t[4]=c=>o(r).allocationType=c),clearable:"",placeholder:"分配类型",onChange:t[5]||(t[5]=c=>k())},{default:e(()=>[(p(!0),q(Ce,null,Ie(o(y).allocationTypeList,(c,ye)=>(p(),u(oe,{label:c,value:ye+1},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(ne,null,{default:e(()=>[a(T,{type:"primary",onClick:t[6]||(t[6]=c=>k())},{icon:e(()=>[a(F,{name:"i-ep:search"})]),default:e(()=>[i(" 筛选 ")]),_:1}),a(T,{onClick:ae},{icon:e(()=>[Fe]),default:e(()=>[i(" 重置 ")]),_:1}),a(T,{link:"",onClick:m,disabled:""},{icon:e(()=>[a(F,{name:l?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:e(()=>[i(" "+v(l?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(re,{"border-style":"dashed"}),a(de,null,{default:e(()=>[a(pe),a(ue,null,{default:e(()=>[a(H,{size:"default"},{default:e(()=>[i(" 导出 ")]),_:1}),a(ce,{border:o(j),"onUpdate:border":t[7]||(t[7]=l=>w(j)?j.value=l:null),tableAutoHeight:o(S),"onUpdate:tableAutoHeight":t[8]||(t[8]=l=>w(S)?S.value=l:null),checkList:o(_),"onUpdate:checkList":t[9]||(t[9]=l=>w(_)?_.value=l:null),columns:o(z),"onUpdate:columns":t[10]||(t[10]=l=>w(z)?z.value=l:null),"line-height":o(N),"onUpdate:lineHeight":t[11]||(t[11]=l=>w(N)?N.value=l:null),stripe:o(L),"onUpdate:stripe":t[12]||(t[12]=l=>w(L)?L.value=l:null),style:{"margin-left":"12px"},onQueryData:Y},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),A((p(),u(B,{border:o(j),data:o(te),size:o(N),stripe:o(L),"row-key":"id","expand-row-keys":o(y).expandedRows,onExpandChange:U},{empty:e(()=>[a(me,{class:"vab-data-empty",description:"暂无数据"})]),default:e(()=>[a(b,{type:"expand",width:"55"},{default:e(l=>[a(B,{data:l.row.children,"highlight-current-row":"",class:"hide-table-header",border:"",height:"100%"},{default:e(()=>[a(b,{width:"55"}),a(b,{width:"300",prop:"memberChildName",label:"名称+ID",align:"center"},{default:e(m=>[a(h,null,{default:e(()=>[i(v(m.row.memberChildName),1)]),_:2},1024),He,A(a(h,{type:"danger"},{default:e(()=>[i("随机id:"+v(m.row.randomIdentityId),1)]),_:2},1536),[[xe,m.row.randomIdentityId]])]),_:1}),a(D,{prop:"status",label:"状态",align:"center"},{default:e(m=>[m.row.status===1?(p(),u(h,{key:0,type:"success"},{default:e(()=>[i("前置问卷通过")]),_:1})):(p(),u(h,{key:1,type:"danger"},{default:e(()=>[i("前置问卷未通过")]),_:1}))]),_:1}),a(D,{width:"200",align:"center",fixed:"right",label:"操作"},{default:e(m=>[a(T,{type:"primary",size:"small",plain:"",onClick:c=>ee(m.row)},{default:e(()=>[i(" 查看问卷详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])]),_:1}),o(_).includes("projectId")?(p(),u(b,{key:0,width:"300",align:"center",prop:"projectId","show-overflow-tooltip":"",label:"项目ID"})):g("",!0),o(_).includes("projectName")?(p(),u(b,{key:1,align:"center",prop:"projectName","show-overflow-tooltip":"",label:"项目名称"})):g("",!0),o(_).includes("allocationType")?(p(),u(b,{key:2,align:"center","show-overflow-tooltip":"",width:"100",label:"分配类型"},{default:e(({row:l})=>[l.allocationType===3?(p(),u(h,{key:0,class:"mx-1",type:"primary"},{default:e(()=>[i("会员组")]),_:1})):g("",!0),l.allocationType===2?(p(),u(h,{key:1,class:"mx-1",type:"success"},{default:e(()=>[i("供应商")]),_:1})):g("",!0),l.allocationType===1?(p(),u(h,{key:2,class:"mx-1",type:"warning"},{default:e(()=>[i("未分配")]),_:1})):g("",!0)]),_:1})):g("",!0),o(_).includes("passNumber")?(p(),u(b,{key:3,align:"center","show-overflow-tooltip":"",label:"通过数/提交数"},{default:e(({row:l})=>[i(v(l.passNumber||0)+"/ "+v(l.submitNumber||0),1)]),_:1})):g("",!0),o(_).includes("passRate")?(p(),u(D,{key:4,align:"center","show-overflow-tooltip":"",prop:"passRate",label:"通过率"},{default:e(({row:l})=>[i(v(l.passRate+"%"),1)]),_:1})):g("",!0),a(D,{align:"center","show-overflow-tooltip":"",prop:"",fixed:"right",label:"操作",width:"200"},{default:e(({row:l})=>[a(H,{plain:"",type:"primary",size:"small",onClick:m=>U(l)},{default:e(()=>[i(v(o(y).expandedRows.includes(l.id)?"收起":"展开"),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["border","data","size","stripe","expand-row-keys"])),[[ge,o(x)]]),a(fe,{"current-page":o(d).page,total:o(d).total,"page-size":o(d).size,"page-sizes":o(d).sizes,layout:o(d).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Z,onCurrentChange:k},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),a($e,{ref_key:"questionnaireDetailsRef",ref:$},null,512)],2)}}}),Qe=De(Be,[["__scopeId","data-v-14a46730"]]);export{Qe as default};
