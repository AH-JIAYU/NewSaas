
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as P}from"./index.vue_vue_type_script_setup_true_lang-B-G1PXuE.js";import{x as b,af as Q,d as E,r as C,a as T,o as f,b as I,f as a,w as i,s as t,g as s,H as l,i as y,F as M,t as O,S,I as $,aL as A,aM as F,R as H}from"./index-ClKnHj-s.js";const z={list:d=>b.post("tenantBind/getProjectAllocationList",d),meList:d=>b.post("tenantBind/getProjectMeAllocationList",d),getTenantMeasurementList:d=>b.post("tenantBind/getTenantMeasurementList",d),getQuestionnaireClickList:d=>b.post("tenantBind/getQuestionnaireClickList",d)},R=Q("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),q=R,w=d=>(A("data-v-836a55c8"),d=d(),F(),d),U={class:"details"},J={class:"details-left"},K={class:"project box"},W=w(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),X={class:"item-left"},Y={class:"tenant"},Z={key:0,class:"tenantName"},ee={class:"tenantLength"},te={class:"tenantName"},se={class:"price flex-b"},ne={class:"viewAll"},ae={class:"details-right"},le={key:0,class:"clickId"},oe={class:"clickIdItem"},ie={class:"clickIdItem-title"},ce={class:"supplierName"},re={class:"clickIdItem-content"},pe={key:1,class:"nodata"},ue={style:{flex:"auto"}},de=E({name:"Edit",__name:"index",setup(d,{expose:N}){const k=q(),v=C(!1);C();const u=C({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function G(c,m=0){const n={linkId:c.linkId,projectId:c.projectId,source:m},_=await z.getTenantMeasurementList(n),o=_.data.tenantMeasurementInfoList;_.data.tenantMeasurementInfo&&o.unshift(_.data.tenantMeasurementInfo);const g=o.findIndex(p=>p.allocationTenantId===_.data.currentTenantId);o.splice(0,g);const h=o.filter(p=>p.type===1),e=o.filter(p=>p.type===2),r=o.filter(p=>p.type===3),L=[...h];if(e.length){const p=e.map(x=>x.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=p,L.push(e[0])}else if(r.length){const p=r.map(x=>x.memberGroupOrSupperId);r[0].length=r.length,r[0].memberGroupOrSupperIdList=p,L.push(r[0])}L.forEach(p=>p.visible=!1),u.value.currentTenantId=_.data.currentTenantId,u.value.tenantMeasurementInfoList=L,v.value=!0}const B=async(c,m)=>{u.value.select=Number(m);const n={type:c.type,projectId:c.projectId,tenantId:c.allocationTenantId,supplierIdList:c.type===2?c.memberGroupOrSupperIdList:[],memberGroupIdList:c.type===3?c.memberGroupOrSupperIdList:[]},_=await z.getQuestionnaireClickList(n);u.value.clickIdList=V(_.data.questionnaireClickInfoList),c.type===2?u.value.clickIdList=u.value.clickIdList.filter(o=>o.peopleType===2):c.type===3&&(u.value.clickIdList=u.value.clickIdList.filter(o=>o.peopleType===1))};function V(c){return c.reduce((m,n)=>{const{supplierId:_,supplierName:o,projectQuestionnaireClickId:g,surveyStatus:h,price:e,peopleType:r}=n;let L=m.find(p=>p.supplierId===_);return L?L.list.push({projectQuestionnaireClickId:g,surveyStatus:h,price:e}):m.push({supplierId:_,peopleType:r,supplierName:o,list:[{projectQuestionnaireClickId:g,surveyStatus:h,price:e}]}),m},[])}function j(){v.value=!1}function D(){j()}return N({showEdit:G}),(c,m)=>{const n=T("el-text"),_=P,o=T("el-button"),g=T("el-empty"),h=T("el-drawer");return f(),I("div",null,[a(h,{modelValue:y(v),"onUpdate:modelValue":m[0]||(m[0]=e=>$(v)?v.value=e:null),title:"详情",size:"60%","before-close":j},{footer:i(()=>[t("div",ue,[a(o,{onClick:j},{default:i(()=>[s(" 取消 ")]),_:1}),a(o,{type:"primary",onClick:D},{default:i(()=>[s(" 确定 ")]),_:1})])]),default:i(()=>[t("div",U,[t("div",J,[t("div",K,[t("div",null,[a(n,{tag:"b"},{default:i(()=>[s(l(y(u).tenantMeasurementInfoList[0].projectName),1)]),_:1})]),t("div",null,[a(n,{type:"info"},{default:i(()=>[s("ID："+l(y(u).tenantMeasurementInfoList[0].projectId),1)]),_:1})])]),(f(!0),I(M,null,O(y(u).tenantMeasurementInfoList,(e,r)=>(f(),I("div",{class:"link",key:e.allocationTenantId},[W,t("div",{class:S({"item box":!0,select:r===y(u).select})},[t("div",X,[t("div",Y,[(e==null?void 0:e.length)>1?(f(),I("p",Z,[s(" 已分配数： "),t("span",ee,l(e==null?void 0:e.length),1),s(),t("span",{class:S("type"+e.type)},l(y(k).typeList[e.type-1]),3)])):(f(),I(M,{key:1},[t("p",null,[t("span",te,l(e.tenantName),1),t("span",{class:S("type"+e.type)},l(y(k).typeList[e.type-1]),3)]),a(n,{type:"info"},{default:i(()=>[s("ID："+l(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",se,[t("p",null,[s(" 原价: "),a(_),s(l(e.doMoneyPrice),1)]),t("p",null,[s(" 参数: "),a(n,{size:"large"},{default:i(()=>[s(l(e.participationNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:i(()=>[s(" / ")]),_:1}),a(n,{type:"success",size:"large"},{default:i(()=>[s(l(e.doneNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:i(()=>[s(" / ")]),_:1}),a(n,{type:"warning",size:"large"},{default:i(()=>[s(l(e.num||0),1)]),_:2},1024),a(n,{size:"large"},{default:i(()=>[s(" / ")]),_:1}),a(n,{size:"large"},{default:i(()=>[s(l(e.limitedQuantity||0),1)]),_:2},1024)])])]),t("div",ne,[a(o,{type:"primary",round:"",onClick:L=>B(e,r)},{default:i(()=>[s("查看全部")]),_:2},1032,["onClick"])])],2)]))),128))]),t("div",ae,[y(u).clickIdList.length?(f(),I("div",le,[(f(!0),I(M,null,O(y(u).clickIdList,e=>(f(),I("div",oe,[t("div",ie,[t("div",null,[t("span",ce,l(e.supplierName),1),t("span",{class:S("peopleType"+e.peopleType)},l(y(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[a(n,{type:"info"},{default:i(()=>[s("ID： "+l(e.supplierId),1)]),_:2},1024)])]),t("div",re,[t("ul",null,[(f(!0),I(M,null,O(e.list,r=>(f(),I("li",null,[t("span",null,l(r.projectQuestionnaireClickId),1),t("span",{class:S("surveyStatus"+r.surveyStatus)},l(y(k).surveyStatusList[r.surveyStatus-1]),3)]))),256))])])]))),256))])):(f(),I("div",pe,[a(g,{description:"暂无数据"})]))])])]),_:1},8,["modelValue"])])}}}),_e=H(de,[["__scopeId","data-v-836a55c8"]]),ye=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{z as a,_e as e,ye as i,q as u};
