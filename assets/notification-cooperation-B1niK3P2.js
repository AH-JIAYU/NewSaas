
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as G,aL as J,r as u,a as c,o as U,b as w,y as n,z as I,i as l,f as r,w as o,g as s,j as R,e as Q,A as W,b8 as b,E as X,_ as Y,aH as Z,aI as ee,L as te}from"./index-UIIVoe2v.js";import{u as ae}from"./index-mr6zt6id.js";import{a as oe}from"./department-Bl6_5mMd.js";import"./index-2x956K2I.js";import"./index-Coouml4D.js";const v=g=>(Z("data-v-469423de"),g=g(),ee(),g),re={class:"news p-4"},le=v(()=>n("div",{class:"type"},[n("span"),s(" 合作邀约")],-1)),se={class:"news-content"},ne={class:"content"},ie={class:"time"},ce={key:0,class:"footer"},de=v(()=>n("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),ue=v(()=>n("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),pe={style:{display:"flex"}},me=v(()=>n("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),ve=v(()=>n("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),ge=G({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(g,{expose:V,emit:S}){const k=S,y=J(),e=u({rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(t,a,d)=>{if(/^(100|[1-9]?\d)$/.test(a)==!1)return d(new Error("请输入 0 到 100 之间的数字"));d()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),p=u(!1);u([]);const T=u(),E={children:"children",label:"name"},A=async t=>{e.value.chargeUserId="",e.value=t;const a=await oe.list({name:""});a.data&&(C.value=a.data),q()},C=u([]);u();const f=u(),B=(t,a)=>{a?(f.value.getCheckedKeys().forEach(m=>{m!==t.id&&f.value.setChecked(m,!1)}),e.value.chargeUserId=t.id,f.value.getCheckedNodes(),e.value.chargeUserName=t.name):(e.value.chargeUserId=[e.value.chargeUserId].filter(d=>d!==t.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="")),e.value.chargeUserId||(e.value.chargeUserName=""),console.log(e.value.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.chargeUserId,"data.value.form.chargeUserId")},q=async()=>{const t={id:e.value.id,type:1};await b.updateTenantAudit(t),await y.getUnreadTodo()},z=async()=>{const t={id:e.value.id,type:2};k("delSelectId"),await b.updateTenantAudit(t),await y.getUnreadTodo()},F=async()=>{T.value.validate(async t=>{if(t){if(Array.isArray(e.value.chargeUserId)&&(e.value.chargeUserId=e.value.chargeUserId[0]),e.value.receiveProjectType==1&&!e.value.chargeUserId){X.warning({message:"请选择部门",center:!0});return}const a={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType[0],receiveProjectType:e.value.receiveProjectType[0]};k("delSelectId"),await b.updateTenantAudit(a),await y.getUnreadTodo()}})},$=u();function D(t){e.value.chargeUserId=t.chargeUserId,e.value.invitationType=t.invitationType,e.value.chargeUserName=t.chargeUserName}const K=t=>{Array.isArray(t)&&t.length>1&&(e.value.sendProjectType=[t[t.length-1]])},L=t=>{Array.isArray(t)&&t.length>1&&(e.value.receiveProjectType=[t[t.length-1]])};return V({showEdit:A}),(t,a)=>{const d=c("el-button"),m=c("el-input"),_=c("el-form-item"),N=Y,P=c("el-tooltip"),h=c("el-checkbox"),x=c("el-checkbox-group"),M=c("el-tree-select"),H=c("ElForm"),j=c("ElButton"),O=c("el-dialog");return U(),w("div",re,[le,n("div",se,[n("div",ne,"尊贵的"+I(l(e).beInvitedName),1),n("div",ie," 您好，我是"+I(l(e).invitationName||"-")+"诚挚邀请您与我们一同协作共赢！若有疑问请联系"+I(l(e).phoneOrEmail)+"。 ",1),l(e).auditStatus===1?(U(),w("div",ce,[r(d,{onClick:z},{default:o(()=>[s("拒绝合作")]),_:1}),r(d,{type:"primary",onClick:a[0]||(a[0]=i=>p.value=!0)},{default:o(()=>[s(" 同意合作 ")]),_:1})])):R("",!0)]),r(O,{modelValue:l(p),"onUpdate:modelValue":a[6]||(a[6]=i=>W(p)?p.value=i:null),title:"添加PM",class:"hezuoDrawer"},{footer:o(()=>[r(j,{size:"large",onClick:a[5]||(a[5]=i=>p.value=!1)},{default:o(()=>[s(" 取消 ")]),_:1}),r(j,{type:"primary",size:"large",onClick:F},{default:o(()=>[s(" 确定 ")]),_:1})]),default:o(()=>[r(H,{ref_key:"FormRef",ref:T,rules:l(e).rules,model:l(e),"label-width":"7rem",labelPosition:"left"},{default:o(()=>[r(_,{label:"价格比例",prop:"priceRatio"},{default:o(()=>[r(m,{modelValue:l(e).priceRatio,"onUpdate:modelValue":a[1]||(a[1]=i=>l(e).priceRatio=i),clearable:""},{append:o(()=>[s("%")]),_:1},8,["modelValue"])]),_:1}),r(_,{label:"项目分配方式","label-width":"7rem"}),r(_,{prop:"sendProjectType","label-width":"7rem"},{label:o(()=>[n("span",null,[r(P,{effect:"dark",placement:"top-start"},{content:o(()=>[de,ue]),default:o(()=>[r(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),s(" 发送项目 ")])]),default:o(()=>[r(x,{modelValue:l(e).sendProjectType,"onUpdate:modelValue":a[2]||(a[2]=i=>l(e).sendProjectType=i),onChange:K},{default:o(()=>[r(h,{value:1},{default:o(()=>[s(" 自动 ")]),_:1}),r(h,{value:2},{default:o(()=>[s(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n("div",pe,[r(_,{prop:"receiveProjectType",style:{"margin-right":"1.5625rem"}},{label:o(()=>[n("span",null,[r(P,{effect:"dark",placement:"top-start"},{content:o(()=>[me,ve]),default:o(()=>[r(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),s(" 接收项目 ")])]),default:o(()=>[r(x,{modelValue:l(e).receiveProjectType,"onUpdate:modelValue":a[3]||(a[3]=i=>l(e).receiveProjectType=i),onChange:L},{default:o(()=>[r(h,{value:1},{default:o(()=>[s(" 自动 ")]),_:1}),r(h,{value:2},{default:o(()=>[s(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).receiveProjectType==1?(U(),Q(M,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:f,modelValue:l(e).chargeUserId,"onUpdate:modelValue":a[4]||(a[4]=i=>l(e).chargeUserId=i),data:l(C),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:E,onCheckChange:B,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):R("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),r(ae,{ref_key:"userRef",ref:$,onUserData:D},null,512)])}}}),be=te(ge,[["__scopeId","data-v-469423de"]]);export{be as default};
