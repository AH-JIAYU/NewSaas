
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ye,al as _e,K as ve,aL as be,s as he,r as z,k as Ce,B as N,F as we,c as Pe,a as u,l as Ie,o as c,b as h,f as o,w as r,i as n,az as Le,a2 as k,a3 as ke,e as g,g as p,C as j,n as Se,j as B,O as Ve,E as C,aM as U,J as Ee,an as Me,N as $e}from"./index-BdHtZquS.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-BfuXSoc2.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-KZ4B39BD.js";import{s as w}from"./apiLoading-CyvCFwB9.js";import{a as y}from"./otherFunctions_screenLibrary-DI45L_QP.js";import{_ as ze}from"./index.vue_vue_type_script_setup_true_lang--7RFbwlx.js";import{u as Ne}from"./index-BFjIDoUS.js";import{u as je}from"./stagedData-Bn1mGoBY.js";import{u as Be}from"./useTabbar-BTFEhxWQ.js";/* empty css                      */const Ue=ye({name:"screen_library",__name:"list",setup(Fe){const F=_e(),T=Ne(),P=je(),O=ve(),{pagination:m,getParams:A,onSizeChange:K,onCurrentChange:R,onSortChange:H}=be(),J=Be(),M=he(),e=z({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),$=z();Ce(async()=>{d(),e.value.countryList=await F.getCountry(),e.value.formMode==="router"&&N.on("get-data-list",()=>{d()})}),we(()=>{e.value.formMode==="router"&&N.off("get-data-list")});function d(){e.value.loading=!0;const t={...A(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};y.list(t).then(a=>{e.value.loading=!1,e.value.dataList=a.data.getCountryListInfoList,m.value.total=a.data.getCountryListInfoList.length})}const x=Pe(()=>e.value.dataList.slice((m.value.page-1)*m.value.size,m.value.page*m.value.size));function q(t){K(t).then(()=>d())}function I(t=1){R(t).then(()=>d())}function D({prop:t,order:a}){H(t,a).then(()=>d())}function G(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function Q(t){t.getProjectProblemCategoryInfoList.unshift({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add"})}function W(t,a,_){$.value.validateField(`[${a}].getProjectProblemCategoryInfoList[${_}].categoryName`,async v=>{if(v){const{data:S,status:L}=await w(y.create(t));L===1&&C.success({message:"新增成功",center:!0}),await d()}})}function X(t,a){const _=e.value.dataList.findIndex(v=>v.countryId===t.countryId);e.value.dataList[_].getProjectProblemCategoryInfoList.splice(a,1)}async function Y(t){const{status:a}=await w(y.update(t));a===1&&C.success({message:"修改「默认国家」成功",center:!0}),d(),P.projectManagementList=null}async function Z(t){const{status:a}=await w(y.edit(t));a===1&&C.success({message:"修改「状态」成功",center:!0}),d(),P.projectManagementList=null}function ee(t){T.countryId=t.countryId,e.value.formMode==="router"?M.settings.tabbar.enable&&M.settings.tabbar.mergeTabsBy!=="activeMenu"?J.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):O.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function te(t){U.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:a}=await w(y.delete({countryId:t.countryId}));a===1&&C.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),P.projectManagementList=null}function ae(t){U.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:a}=await w(y.delete({projectProblemCategoryId:t.projectProblemCategoryId}));a===1&&C.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),P.projectManagementList=null}return(t,a)=>{const _=u("ElOption"),v=u("el-select"),S=u("ElFormItem"),L=Ee,f=u("ElButton"),oe=u("ElForm"),ne=xe,le=u("ElDivider"),re=u("ElSpace"),V=u("el-table-column"),ie=u("el-input"),se=u("el-form-item"),E=u("ElSwitch"),b=u("ElTableColumn"),ue=u("el-table"),de=u("el-empty"),ce=u("ElTable"),me=u("el-form"),pe=u("ElPagination"),fe=Me,ge=Ie("loading");return c(),h("div",{class:Ve({"absolute-container":n(e).tableAutoHeight})},[o(fe,null,{default:r(()=>[o(ne,{"show-toggle":!1},{default:r(({fold:i,toggle:l})=>[o(oe,{model:n(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:r(()=>[o(S,{label:""},{default:r(()=>[o(v,{onKeydown:a[0]||(a[0]=Le(s=>I(),["enter"])),onClear:a[1]||(a[1]=s=>I()),filterable:"",modelValue:n(e).search.countryId,"onUpdate:modelValue":a[2]||(a[2]=s=>n(e).search.countryId=s),placeholder:"国家"},{default:r(()=>[(c(!0),h(k,null,ke(n(e).countryList,s=>(c(),g(_,{label:s.chineseName,value:s.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(S,null,{default:r(()=>[o(f,{type:"primary",onClick:a[3]||(a[3]=s=>I())},{icon:r(()=>[o(L,{name:"i-ep:search"})]),default:r(()=>[p(" 筛选 ")]),_:1}),o(f,{link:"",disabled:"",onClick:l},{icon:r(()=>[o(L,{name:i?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:r(()=>[p(" "+j(i?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),o(le,{"border-style":"dashed"}),o(re,{wrap:""},{default:r(()=>[o(f,{type:"primary",size:"default",onClick:G},{default:r(()=>[p(" 新增前置问卷库 ")]),_:1})]),_:1}),o(me,{ref_key:"formRef",ref:$,rules:n(e).rules,model:n(x)},{default:r(()=>[Se((c(),g(ce,{class:"my-4",border:"",data:n(x),"highlight-current-row":"",height:"100%",onSortChange:D,onSelectionChange:a[5]||(a[5]=i=>n(e).batch.selectionDataList=i),"default-expand-all":!0},{empty:r(()=>[o(de,{description:"暂无数据"})]),default:r(()=>[o(V,{type:"expand",width:"55"},{default:r(i=>[o(ue,{data:i.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",border:"",height:"100%",onSortChange:D,onSelectionChange:a[4]||(a[4]=l=>n(e).batch.selectionDataList=l)},{default:r(()=>[o(V,{width:"55"}),o(V,{width:"500",prop:"categoryName",label:"问卷名称",align:"center"},{default:r(l=>[l.row.type==="add"?(c(),g(se,{key:0,prop:`[${i.$index}].getProjectProblemCategoryInfoList[${l.$index}].categoryName`,rules:n(e).rules.categoryName},{default:r(()=>[o(ie,{modelValue:l.row.categoryName,"onUpdate:modelValue":s=>l.row.categoryName=s},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(c(),h(k,{key:1},[p(j(l.row.categoryName),1)],64))]),_:2},1024),o(b,{prop:"status",label:"状态"},{default:r(l=>[l.row.type==="add"?(c(),g(E,{key:0,modelValue:l.row.status,"onUpdate:modelValue":s=>l.row.status=s,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])):(c(),g(E,{key:1,onChange:s=>Z(l.row),modelValue:l.row.status,"onUpdate:modelValue":s=>l.row.status=s,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),o(b,{width:"250",align:"center",fixed:"right",label:"操作"},{default:r(l=>[l.row.type==="add"?(c(),h(k,{key:0},[o(f,{type:"primary",size:"small",plain:"",onClick:s=>W(l.row,i.$index,l.$index)},{default:r(()=>[p(" 提交 ")]),_:2},1032,["onClick"]),o(f,{type:"danger",size:"small",plain:"",onClick:s=>X(l.row,l.$index)},{default:r(()=>[p(" 取消 ")]),_:2},1032,["onClick"])],64)):(c(),h(k,{key:1},[o(f,{type:"success",size:"small",plain:"",onClick:s=>ee(l.row)},{default:r(()=>[p(" 设计问卷 ")]),_:2},1032,["onClick"]),o(f,{type:"danger",size:"small",plain:"",onClick:s=>ae(l.row)},{default:r(()=>[p(" 删除 ")]),_:2},1032,["onClick"])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),o(b,{prop:"countryName",label:"国家/标题",width:"500"}),o(b,{prop:"isDefault",label:"默认/状态"},{default:r(i=>[o(E,{onChange:l=>Y(i.row),modelValue:i.row.isDefault,"onUpdate:modelValue":l=>i.row.isDefault=l,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),o(b,{label:"操作",width:"250",align:"center",fixed:"right"},{default:r(i=>[o(f,{type:"primary",size:"small",plain:"",onClick:l=>Q(i.row)},{default:r(()=>[p(" 新增问卷 ")]),_:2},1032,["onClick"]),o(f,{type:"danger",size:"small",plain:"",onClick:l=>te(i.row)},{default:r(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,n(e).loading]])]),_:1},8,["rules","model"]),o(pe,{"current-page":n(m).page,total:n(m).total,"page-size":n(m).size,"page-sizes":n(m).sizes,layout:n(m).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:q,onCurrentChange:I},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),n(e).editProps.visible?(c(),g(ze,{key:0,id:n(e).editProps.id,countryId:n(e).editProps.countryId,modelValue:n(e).editProps.visible,"onUpdate:modelValue":a[6]||(a[6]=i=>n(e).editProps.visible=i),row:n(e).editProps.row,onSuccess:d},null,8,["id","countryId","modelValue","row"])):B("",!0),n(e).formMode==="dialog"||n(e).formMode==="drawer"?(c(),g(De,{key:1,id:n(e).formModeProps.id,modelValue:n(e).formModeProps.visible,"onUpdate:modelValue":a[7]||(a[7]=i=>n(e).formModeProps.visible=i),mode:n(e).formMode,details:n(e).formModeProps.details,title:n(e).formModeProps.title,onSuccess:d},null,8,["id","modelValue","mode","details","title"])):B("",!0)],2)}}}),We=$e(Ue,[["__scopeId","data-v-a5bd1c43"]]);export{We as default};
