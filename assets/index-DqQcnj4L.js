
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as B,_ as fe}from"./jiantou-BFtAGxsy.js";import{o as O,s as ge}from"./apiLoading-DPcrQezB.js";import{a as X}from"./projectManagement-Cmjx_Af4.js";import{a as me}from"./user_cooperation-Co0ewwgy.js";import{a as Ie}from"./survey_vip_department-BXoo1hls.js";import{U as ve}from"./user_supplier-COYX46nJ.js";import{u as Ae}from"./survey_vipGroup-qw71bU_D.js";import{d as Se,r as u,n as Le,a as v,q as he,o as m,b as S,f as r,w as s,y as A,g as I,s as ye,i as t,e as x,j as h,F as Z,t as F,A as be,E as J,aH as je,aI as _e,L as ke}from"./index-B3Wu2qSz.js";const Ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAmtJREFUOE+dlTtIXEEUhr9ZFxWfaOEDg6/CxiZWBkEEsbARIqwoJLLXLoEISZdyy3QJRIidd8FANAG1sFJEsDCIQrRRRMyVbCEq4qsQXXficXa9d/eqwUyz7Jkz3/xz5sx/FXcMHYkEqa3tBZ4Dz4CKZFrsOvYLpSZJJMbUwMB55nKVGdC2/QL4ADy5azNPbBel3qpweMybdwtMqvoIvPkHKHN6GMcZVJFIXCZcoG1/AV49EpZKH1KWNXgL1NFoL1p/S4OVlUFLCxQXw8EBrK5CTEp473ipLOur0iMjuSj121N4s6K7G4qK3NUXFzA+DldX9xFjOE6d0tFoGK3ttKycHOjr8y+cnjZqH1KpbXsi2R5uWnk5dHb6ly0twfr6Q8AfStu2HLc2LSs7G7q6oKDADctRp6bg9PQhYEyAl0DQl1VZCR0dEAjA4SGsrEBFhdnk5AQ2NuDc19fx+4HBIPT0mEtYXITWVojHIZEwm8jv7CwcHXm13AD/pL2KwkJoaIDqanPLoqymBkpLYX7eHFkurbERsrJgZsYLdAT4HQjdRkMhyM93k+bmoL0dtrZgbw8uL0FaqK3NAEdHvcBJAcrbdaP9/eZIqbGwAM3NsL8P29umbURtU5PJmJAmSQ6lLJV8w3LTxgykZUpKIC8PcnMNQJTIsc/OoKoKdnagvh6Wl2FzM4XbReu6m7fsU3lXY0hdpW5S1+NjWFszil11feI8XnP4/B9Ok8INK8t6LX8y7Uugj3WcIRznnc++UlslneeTzyz8ZRDreS8O453yOfZNTcWBAgGxNPkEPPX06S7w8zo2ieOMpVR5gX8BZ0fYI9liOMMAAAAASUVORK5CYII=",Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAoBJREFUOE+dlU1IVFEYhp/TDJYiCEYU0VRGiYugSIKgqJsQgVEMEU0xA4UWGCUUREQgTbioRVCkkBtNS4f8CSdq1cImKHCX/aCrspxZTAitJCPHTp577u+MU9i3uZzvO+c97/dz3itYxIy4DBIigiCMZBewxtwmyCAZQ5Bkiv5UXPzMPy7yHUanjAK3EKxb7DKPLwtcTDWIfu8+B9BktZ47wIV/APnDkg7SNKfiIqeTsMzolPcRNC0JzN3cnmoQzQ6g0SUjwGPlKAnA2VqoLIWhcZiY9l9RvRIiW2H6B/S8hVmTFyCJpRpFnzAeyBVIJu3CN+3UB5TN/IJwAualXgcEDByHyjK9Hp6Ae6MOYIY0VcLokqeAbptHyz6o2+Syqn/ksigNwrMoBJbp+MhnaH3lyUASE0anHDbHwzKV0s0DULEcuseg950/5dg2aNyh2V95UVCSIcVQpbvRe0ylpmrp1CevUyo2/9sthROWZBTDOQRB27m6HG7sh1VlkPgAT8b9aPVbNEPVlOsv4duML+VcAeDl3XCoWm9SLA73uUwVM1VD9S1Sw5xKOQ3uq2itgz0b3FvPPIVP3/U6VAEPj7qx11+hZcSXwRcFOAgcs935gLNzkHivO3ukRs+nbQWAkqRKOYqgtxjg+edwcLMGHPgIPX9neFpYyjJpi0E+w5ODkLUKX16ia1iEYZYpqsy37GUZroHatVZTJNx+o2dOmWrGtb36xSgby/qm4IRSHlccumTbkpXGpirpSDWKc2rpl68Qbf+hOO1McalAvuzLLOW566i0byo8C0kGuKoUxrulQLHNmmoFiizIfXhB7rcjrTkVKJUeRZIkbf4CbPFyMP8AN7LhTtHVZc8AAAAASUVORK5CYII=",j=C=>(je("data-v-736db437"),C=C(),_e(),C),Te=j(()=>A("span",{class:"icon-class"},[A("img",{src:Ve,alt:"",style:{"margin-right":"0.25rem"}}),I(" 供应商")],-1)),Ue=j(()=>A("img",{src:B,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ee={key:1},xe=j(()=>A("span",{class:"icon-class"},[A("img",{src:fe,alt:"",style:{"margin-right":"0.25rem"}}),I(" 调查站")],-1)),Ne=j(()=>A("img",{src:B,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Re={key:1},we=j(()=>A("span",{class:"icon-class"},[A("img",{src:Ce,alt:"",style:{"margin-right":"0.25rem"}}),I(" 合作商")],-1)),Ke=j(()=>A("img",{src:B,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Pe={key:1},Oe={style:{flex:"auto"}},Be=Se({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(C,{expose:q,emit:z}){const D=ve();Ae();const Q=z,T=u(!1),_=u(!1),N=u(),y=u(),b=u([]),Y={children:"children",label:"name"};u([]);const e=u({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),c=u({projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),d=u({projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),i=u({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),G=u({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]}),R=u([]),U=u();async function W(a,l){if(e.value.list=[{...a}],l==="reassign"){e.value.title="重新分配";const L=await O(X.getProjectAllocation({projectId:a.projectId}));e.value.form.projectId=a.projectId;const{getProjectAllocationInfoList:E}=L.data;E.forEach(n=>{n.allocationType===2?d.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet}:n.allocationType===3?i.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet}:n.allocationType===4&&(c.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet},U.value=n.groupSupplierIdSet)})}else e.value.title="分配",e.value.form.projectId=a.projectId,c.value.projectId=a.projectId,d.value.projectId=a.projectId,i.value.projectId=a.projectId;e.value.tenantSupplierList=await O(D.getTenantSupplierList(a.projectId)),e.value.tenantSupplierList.length==d.value.groupSupplierIdList.length?e.value.selectAll.supplier=!0:e.value.selectAll.supplier=!1;const p=await Ie.list({name:""});e.value.departmentList=p.data;const f=JSON.parse(JSON.stringify(p.data));R.value=H(f),R.value.length==i.value.groupSupplierIdList.length?e.value.selectAll.member=!0:e.value.selectAll.member=!1;const g=await O(me.getAllocationBindList({projectId:a.projectId}));b.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(b.value=e.value.form.groupSupplierIdList),e.value.tenantList=g.data.allocationBindInfoList,e.value.tenantList.length==c.value.groupSupplierIdList.length?e.value.selectAll.tenant=!0:e.value.selectAll.tenant=!1,_.value=!0}const H=a=>a.reduce((l,p)=>{const{children:f,...g}=p;return l.push(g),p.children&&p.children.length>0&&(l=l.concat(H(p.children))),l},[]);function $(){c.value.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(a=>{c.value.groupSupplierIdList.push(a.beInvitationTenantId)})}function ee(){d.value.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(a=>{d.value.groupSupplierIdList.push(a.tenantSupplierId)})}const le=()=>{e.value.tenantSupplierList.length==d.value.groupSupplierIdList.length?e.value.selectAll.supplier=!0:e.value.selectAll.supplier=!1},te=()=>{e.value.tenantList.length==c.value.groupSupplierIdList.length?e.value.selectAll.tenant=!0:e.value.selectAll.tenant=!1},ae=()=>{i.value.groupSupplierIdList=[],e.value.departmentList.forEach(a=>{M(a)}),y.value.setCheckedKeys(i.value.groupSupplierIdList)};function M(a){i.value.groupSupplierIdList.push(a.id),a.children&&a.children.length&&a.children.forEach(l=>{M(l)})}function oe(){i.value.groupSupplierIdList=[],e.value.selectAll.member?(ae(),y.value.setCheckedKeys(i.value.groupSupplierIdList)):(e.value.selectAll.member=!1,i.value.groupSupplierIdList=[],y.value.setCheckedKeys([]))}const se=(a,l)=>{l?b.value.includes(a.id)||b.value.push(a.id):b.value=b.value.filter(L=>L!==a.id);const p=y.value.getCheckedKeys(),f=y.value.getHalfCheckedKeys(),g=[...p,...f];i.value.groupSupplierIdList=g,R.value.length==g.length?e.value.selectAll.member=!0:e.value.selectAll.member=!1},k=u(!1),V=u(!1),ne=()=>{V.value=!V.value,V.value?k.value=!0:k.value=!1},ie=()=>{Object.assign(c.value,{projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),Object.assign(d.value,{projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),Object.assign(i.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.tenant=!1,e.value.selectAll.supplier=!1,e.value.selectAll.member=!1};function w(){N.value.resetFields(),ie(),_.value=!1,k.value=!1,V.value=null}function re(){N.value.validate(async a=>{if(a)try{T.value=!0;let l={addProjectAllocationInfoList:[]};if(c.value.groupSupplierIdList.length&&(c.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(c.value)),d.value.groupSupplierIdList.length&&(d.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(d.value)),i.value.groupSupplierIdList.length&&(i.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(i.value)),e.value.title!=="分配")l.addProjectAllocationInfoList.length||(k.value=!0),l.addProjectAllocationInfoList.map(f=>{f.projectId||(f.projectId=e.value.form.projectId),f.allocationType===4&&(f.deleteSet=[],U.value&&U.value.length&&U.value.filter(g=>{f.groupSupplierIdList.map(L=>{g!==L&&f.deleteSet.push(g)})}))});else if(!l.addProjectAllocationInfoList.length){J.warning({message:"至少选择一个分配目标",center:!0});return}k.value&&(l={addProjectAllocationInfoList:[{projectId:e.value.form.projectId,allocationType:5,groupSupplierIdList:[],deleteSet:[]}]});const{status:p}=await ge(X.allocation(l));T.value=!1,p===1&&J.success({message:"分配成功",center:!0}),w(),Q("fetch-data")}catch{}finally{T.value=!1}})}const K=a=>{};return Le(async()=>{}),q({showEdit:W}),(a,l)=>{const p=v("el-table-column"),f=v("el-table"),g=v("el-checkbox"),L=v("el-option"),E=v("el-select"),n=v("el-form-item"),pe=v("el-tree-select"),P=v("el-button"),ue=v("el-form"),ce=v("el-dialog"),de=he("loading");return m(),S("div",null,[r(ce,{modelValue:t(_),"onUpdate:modelValue":l[10]||(l[10]=o=>be(_)?_.value=o:null),title:t(e).title,width:"700","before-close":w},{footer:s(()=>[A("div",Oe,[r(P,{onClick:w},{default:s(()=>[I(" 取消 ")]),_:1}),r(P,{type:"primary",onClick:re},{default:s(()=>[I(" 确定 ")]),_:1})])]),default:s(()=>[ye((m(),x(f,{data:t(e).list,"row-key":"id"},{default:s(()=>[r(p,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),r(p,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),r(p,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[de,t(T)]]),r(ue,{ref_key:"formRef",ref:N,"label-width":"90px",rules:t(G),model:t(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:s(()=>[r(n,{style:{"margin-top":"1rem"}},{label:s(()=>[Te]),default:s(()=>[r(E,{modelValue:t(d).groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=o=>t(d).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:"",onChange:le},{header:s(()=>[r(g,{modelValue:t(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=o=>t(e).selectAll.supplier=o),onChange:ee,style:{display:"flex",height:"unset"}},{default:s(()=>[I("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantSupplierList.length==0?(m(),S("span",{key:0,class:"prefix-class",onClick:l[1]||(l[1]=o=>K("供应商"))},[I(" 请先维护供应商数据 "),Ue])):h("",!0),t(d).groupSupplierIdList.length==0&&t(e).tenantSupplierList.length!=0?(m(),S("span",Ee,"请先选择供应商数据")):h("",!0)]),default:s(()=>[(m(!0),S(Z,null,F(t(e).tenantSupplierList,o=>(m(),x(L,{label:o.supplierAccord,key:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,null,{label:s(()=>[xe]),default:s(()=>[r(pe,{ref_key:"treeRef",ref:y,modelValue:t(i).groupSupplierIdList,"onUpdate:modelValue":l[5]||(l[5]=o=>t(i).groupSupplierIdList=o),data:t(e).departmentList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:Y,onCheckChange:se,"check-strictly":!0,"check-on-click-node":!0,multiple:!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},{header:s(()=>[r(g,{modelValue:t(e).selectAll.member,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).selectAll.member=o),onChange:oe,style:{display:"flex",height:"unset"}},{default:s(()=>[I("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).departmentList.length==0?(m(),S("span",{key:0,class:"prefix-class",onClick:l[4]||(l[4]=o=>K("调查站"))},[I(" 请先维护调查站数据 "),Ne])):h("",!0),!t(i).groupSupplierIdList.length&&t(e).departmentList.length!=0?(m(),S("span",Re,"请先选择调查站数据")):h("",!0)]),_:1},8,["modelValue","data"])]),_:1}),r(n,null,{label:s(()=>[we]),default:s(()=>[r(E,{modelValue:t(c).groupSupplierIdList,"onUpdate:modelValue":l[8]||(l[8]=o=>t(c).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:"",onChange:te},{header:s(()=>[r(g,{modelValue:t(e).selectAll.tenant,"onUpdate:modelValue":l[6]||(l[6]=o=>t(e).selectAll.tenant=o),onChange:$,style:{display:"flex",height:"unset"}},{default:s(()=>[I("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantList.length==0?(m(),S("span",{key:0,class:"prefix-class",onClick:l[7]||(l[7]=o=>K("合作商"))},[I(" 请先维护合作商数据 "),Ke])):h("",!0),t(c).groupSupplierIdList.length==0&&t(e).tenantList.length!=0?(m(),S("span",Pe,"请先选择合作商数据")):h("",!0)]),default:s(()=>[(m(!0),S(Z,null,F(t(e).tenantList,o=>(m(),x(L,{label:o.beInvitationTenantName,key:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e).title=="重新分配"?(m(),x(n,{key:0},{label:s(()=>[r(P,{type:t(V)?"primary":"",onClick:l[9]||(l[9]=o=>ne()),style:{"border-radius":"1.875rem"}},{default:s(()=>[I(" 取消分配 ")]),_:1},8,["type"])]),_:1})):h("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),He=ke(Be,[["__scopeId","data-v-736db437"]]),Qe=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{Ve as _,He as a,Ce as b,Qe as i};
