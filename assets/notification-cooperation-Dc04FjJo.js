
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as X,aD as Y,r as s,aL as Z,a as u,o as R,b as z,y as r,z as I,i as o,f as n,w as a,g as c,j as F,e as ee,A as te,ba as C,E as ae,_ as le,aH as ne,aI as re,L as oe}from"./index-7bVKZbtb.js";import{a as se}from"./department-BwKNFRYH.js";import{u as ie}from"./index-Ch1Wd0q2.js";import ce from"./index-BaxExzH8.js";import"./index-Cjb5ZsYK.js";import"./index-A-Pfn8-d.js";import"./configuration_site_setting-Wha7XGRo.js";const p=f=>(ne("data-v-4b156ca9"),f=f(),re(),f),de={class:"news p-4"},ue=p(()=>r("div",{class:"type"},[r("span"),c(" 合作邀约")],-1)),pe={class:"news-content"},me={class:"content"},ve={class:"time"},ge=p(()=>r("div",null,"您好！",-1)),fe={style:{margin:".25rem 0"}},ye={key:0,class:"footer"},_e=p(()=>r("div",{style:{display:"flex","align-items":"center"}},[r("span",{style:{display:"inline-block",width:"8px",height:"8px",background:"#FF8181","border-radius":"50%","margin-right":"4px"}}),r("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式")],-1)),he={style:{display:"flex","align-items":"center"}},xe=p(()=>r("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),be=p(()=>r("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),ke={style:{"margin-top":"6px","margin-bottom":"0px"}},Ie={style:{display:"flex","flex-direction":"column"}},Te={style:{display:"flex","align-items":"center"}},Ue=p(()=>r("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),Re=p(()=>r("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),Ce=X({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(f,{expose:q,emit:A}){const y=Y(),T=y.currencyType,m=s();s(1);const w=s(""),P=A,U=Z(),e=s({rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(l,t,i)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return i(new Error("请输入 0 到 100 之间的数字"));i()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),v=s(!1);s([]);const j=s(),B={children:"children",label:"name"},D=async l=>{e.value.chargeUserId="",e.value=l,m.value=l.currencyType;const t=await se.list({name:""});t.data&&(N.value=t.data),L()},N=s([]);s();const _=s(),K=(l,t)=>{t?(_.value.getCheckedKeys().forEach(g=>{g!==l.id&&_.value.setChecked(g,!1)}),e.value.chargeUserId=l.id,_.value.getCheckedNodes(),e.value.chargeUserName=l.name):(e.value.chargeUserId=[e.value.chargeUserId].filter(i=>i!==l.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="")),e.value.chargeUserId||(e.value.chargeUserName="")},L=async()=>{const l={id:e.value.id,type:1};await C.updateTenantAudit(l),await U.getUnreadTodo()},H=async()=>{const l={id:e.value.id,type:2};P("delSelectId"),await C.updateTenantAudit(l),await U.getUnreadTodo()},M=async()=>{j.value.validate(async l=>{if(l){if(Array.isArray(e.value.chargeUserId)&&(e.value.chargeUserId=e.value.chargeUserId[0]),e.value.receiveProjectType==1&&!e.value.chargeUserId){ae.warning({message:"请选择部门",center:!0});return}if(!y.originalExchangeRate){w.value.showEdit();return}T===m.value?e.value.exchangeRate=1:T===1&&m.value===2?e.value.exchangeRate=y.originalExchangeRate:T===2&&m.value===1&&(e.value.exchangeRate=(1/y.originalExchangeRate).toFixed(2));const t={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType,receiveProjectType:e.value.receiveProjectType,exchangeRate:e.value.exchangeRate};P("delSelectId"),await C.updateTenantAudit(t),await U.getUnreadTodo()}})},G=s();function S(l){e.value.chargeUserId=l.chargeUserId,e.value.invitationType=l.invitationType,e.value.chargeUserName=l.chargeUserName}const h=s(null),x=s(null),b=(l,t)=>{t&&(l==="发送"?(h.value=t,e.value.sendProjectType=t):(x.value=t,e.value.receiveProjectType=t))},J=()=>{h.value=null,x.value=null,e.value.sendProjectType=null,e.value.receiveProjectType=null};return q({showEdit:D}),(l,t)=>{const i=u("el-button"),g=u("el-input"),k=u("el-form-item"),E=le,V=u("el-tooltip"),O=u("el-tree-select"),Q=u("ElForm"),$=u("ElButton"),W=u("el-dialog");return R(),z("div",de,[ue,r("div",pe,[r("div",me,"尊贵的"+I(o(e).beInvitedName),1),r("div",ve,[ge,r("div",fe,"我是"+I(o(e).invitationName)+",诚挚邀请贵司与我们合作,实现共赢！",1),r("div",null,"我方货币类型为"+I(o(m)===1?"美元":"人民币")+"，达成合作后我方发布项目以 "+I(o(m)===1?"美元":"人民币")+" 计价，望悉知。",1)]),o(e).auditStatus===1?(R(),z("div",ye,[n(i,{onClick:H},{default:a(()=>[c("拒绝合作")]),_:1}),n(i,{type:"primary",onClick:t[0]||(t[0]=d=>v.value=!0)},{default:a(()=>[c(" 同意合作 ")]),_:1})])):F("",!0)]),n(W,{modelValue:o(v),"onUpdate:modelValue":t[8]||(t[8]=d=>te(v)?v.value=d:null),title:"合作配置",class:"hezuoDrawer",onClose:J},{footer:a(()=>[n($,{size:"large",onClick:t[7]||(t[7]=d=>v.value=!1)},{default:a(()=>[c(" 取消 ")]),_:1}),n($,{type:"primary",size:"large",onClick:M},{default:a(()=>[c(" 确定 ")]),_:1})]),default:a(()=>[n(Q,{ref_key:"FormRef",ref:j,rules:o(e).rules,model:o(e),"label-width":"7rem",labelPosition:"left"},{default:a(()=>[n(k,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[n(g,{modelValue:o(e).priceRatio,"onUpdate:modelValue":t[1]||(t[1]=d=>o(e).priceRatio=d),clearable:""},{append:a(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),n(k,{"label-width":"7.5rem"},{label:a(()=>[_e]),_:1}),n(k,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[r("span",he,[n(V,{effect:"dark",placement:"top-start"},{content:a(()=>[xe,be]),default:a(()=>[n(E,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:a(()=>[r("div",ke,[n(i,{type:o(h)===1?"primary":"",size:"small",onClick:t[2]||(t[2]=d=>b("发送",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),n(i,{type:o(h)===2?"primary":"",size:"small",onClick:t[3]||(t[3]=d=>b("发送",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),r("div",Ie,[n(k,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[r("span",Te,[n(V,{effect:"dark",placement:"top-start"},{content:a(()=>[Ue,Re]),default:a(()=>[n(E,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:a(()=>[r("div",null,[n(i,{type:o(x)===1?"primary":"",size:"small",onClick:t[4]||(t[4]=d=>b("接收",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),n(i,{type:o(x)===2?"primary":"",size:"small",onClick:t[5]||(t[5]=d=>b("接收",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),o(e).receiveProjectType==1?(R(),ee(O,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:_,modelValue:o(e).chargeUserId,"onUpdate:modelValue":t[6]||(t[6]=d=>o(e).chargeUserId=d),data:o(N),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:B,onCheckChange:K,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):F("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),n(ie,{ref_key:"userRef",ref:G,onUserData:S},null,512),n(ce,{ref_key:"exchangeRateRef",ref:w,onUserData:S},null,512)])}}}),ze=oe(Ce,[["__scopeId","data-v-4b156ca9"]]);export{ze as default};
