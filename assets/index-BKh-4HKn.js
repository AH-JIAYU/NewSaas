
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ie,m as Z,O as me,r as n,al as pe,u as ce,c as fe,k as ge,a as d,o as u,e as c,w as a,f as o,g as v,i as r,b,t as I,F as x,s as V,H as _e,j,l as H,E as K,aJ as ve,aK as be,R as Ve}from"./index-DXIwLSJH.js";import{a as ye}from"./department-Cx1hK506.js";import{a as he}from"./position_manage-CYpgskiu.js";import{u as we}from"./department-BI_5BK9L.js";import{u as Ne}from"./tenant_role-BMPORwvM.js";import{u as Ie}from"./configuration_manager-B33yod48.js";import"./configuration_role-Br8L6_ja.js";const Q=g=>(ve("data-v-7d512bfe"),g=g(),be(),g),xe=Q(()=>V("div",{class:"card-header"},[V("div",{class:"leftTitle"},"基本信息")],-1)),Ee=Q(()=>V("div",{class:"card-header"},[V("div",{class:"leftTitle"},"角色信息")],-1)),Se={class:"card-header"},ke={class:"leftTitle"},Ce={key:0,style:{"margin-left":"20px","font-size":"14px"}},Be=ie({__name:"index",props:Z({catalogueId:{default:""},parentId:{default:""},id:{default:""},tree:{},dataList:{},row:{},level:{default:1}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:Z(["success"],["update:modelValue"]),setup(g,{emit:W}){me();const X=Ie(),R=n([]),q=n([]),z=n(),Y=pe(),ee=n(),ae=Ne(),A=n(),le=we(),T=n(),te=n(!1),F=n(),P=n(),oe=n(),_=g,$=W,L=ce(g,"modelValue"),re=fe(()=>_.id===""?"新增用户":"编辑用户"),y=n(),se=n([]),l=n({id:_.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),ue=(i,t,s)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(l.value.phoneNumber)?s():s(new Error("请输入合法手机号"))},ne=(i,t,s)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l.value.email)?s():s(new Error("请输入合法邮箱"))},G=()=>{l.value.phoneNumber.includes("@")?E.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:ne,trigger:"blur"}]:E.value.phoneNumber=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:ue,trigger:"blur"}]},E=n({userName:[{required:!0,message:"请输入用户名"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{required:!1,message:"请输入手机号",trigger:"blur"}],email:[{required:!1,message:"请输入邮箱",trigger:"blur"}]}),J=async i=>{const{data:t}=await ye.departmentGroup({id:i});q.value=t,oe.value=t[0].director};function de(){l.value.id===""?y.value&&y.value.validate(i=>{i&&(delete l.value.id,H.create(l.value).then(()=>{K.success({message:"新增成功",center:!0}),$("success"),S()}))}):y.value&&y.value.validate(i=>{if(i){const{id:t,phoneNumber:s,email:m,password:f,name:k,country:C,active:h,type:w,role:B,groupId:D,positionId:N,departmentId:M,userName:U}=l.value,p={id:t,phoneNumber:s,email:m,password:f,name:k,country:C,active:h,type:w,role:B,groupId:D,positionId:N,departmentId:M,userName:U};P.value===p.phoneNumber&&delete p.phoneNumber,F.value===p.email&&delete p.email,p.password||delete p.password,H.edit(p).then(()=>{K.success({message:"编辑成功",center:!0}),$("success"),S()})}})}function S(){L.value=!1}const O=i=>i.reduce((t,s)=>Array.isArray(s)?t.concat(O(s)):t.concat(s),[]);return ge(async()=>{const{data:i}=await he.list({page:1,limit:10,id:null,name:"",active:null});z.value=i.data,R.value=await X.getStaff(),A.value=await ae.getRole(),T.value=await le.getDepartment(),ee.value=await Y.getCountry(),_.id!==""&&_.row&&(E.value.password=[],l.value=JSON.parse(_.row),F.value=l.value.email,P.value=l.value.phoneNumber,l.value.departmentId&&J(l.value.departmentId),te.value=!0),se.value=O(_.dataList)}),(i,t)=>{const s=d("el-input"),m=d("el-form-item"),f=d("el-col"),k=d("el-option"),C=d("el-select"),h=d("el-row"),w=d("el-card"),B=d("el-radio"),D=d("el-radio-group"),N=d("el-text"),M=d("ElForm"),U=d("ElButton"),p=d("ElDrawer");return u(),c(p,{modelValue:L.value,"onUpdate:modelValue":t[9]||(t[9]=e=>L.value=e),title:r(re),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:a(()=>[o(U,{size:"large",onClick:S},{default:a(()=>[v(" 取消 ")]),_:1}),o(U,{type:"primary",size:"large",onClick:de},{default:a(()=>[v(" 确定 ")]),_:1})]),default:a(()=>[o(M,{ref_key:"formRef",ref:y,model:r(l),rules:r(E),"label-width":"100px"},{default:a(()=>[o(w,{class:"box-card"},{header:a(()=>[xe]),default:a(()=>[o(h,{gutter:24},{default:a(()=>[o(f,{span:8},{default:a(()=>[o(m,{label:"用户名",prop:"userName"},{default:a(()=>[o(s,{modelValue:r(l).userName,"onUpdate:modelValue":t[0]||(t[0]=e=>r(l).userName=e),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:a(()=>[o(m,{label:"姓名",prop:"name"},{default:a(()=>[o(s,{modelValue:r(l).name,"onUpdate:modelValue":t[1]||(t[1]=e=>r(l).name=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:a(()=>[o(m,{label:"手机号",prop:"phoneNumber"},{default:a(()=>[o(s,{modelValue:r(l).phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=e=>r(l).phoneNumber=e),placeholder:"请输入手机号",clearable:"",onBlur:G},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:a(()=>[o(m,{label:"邮箱",prop:"email"},{default:a(()=>[o(s,{modelValue:r(l).email,"onUpdate:modelValue":t[3]||(t[3]=e=>r(l).email=e),placeholder:"请输入邮箱",clearable:"",onBlur:G},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:a(()=>[o(m,{label:"部门"},{default:a(()=>[o(C,{modelValue:r(l).departmentId,"onUpdate:modelValue":t[4]||(t[4]=e=>r(l).departmentId=e),placeholder:"请选择部门",clearable:"",filterable:"",onChange:J},{default:a(()=>[(u(!0),b(x,null,I(r(T),e=>(u(),c(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:a(()=>[o(m,{label:"职位",prop:""},{default:a(()=>[o(C,{modelValue:r(l).positionId,"onUpdate:modelValue":t[5]||(t[5]=e=>r(l).positionId=e),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[6]||(t[6]=()=>{})},{default:a(()=>[(u(!0),b(x,null,I(r(z),e=>(u(),c(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(w,{class:"box-card"},{header:a(()=>[Ee]),default:a(()=>[o(h,{gutter:24},{default:a(()=>[o(m,{label:"分配角色:"},{default:a(()=>[o(D,{modelValue:r(l).role,"onUpdate:modelValue":t[7]||(t[7]=e=>r(l).role=e)},{default:a(()=>[(u(!0),b(x,null,I(r(A),e=>(u(),c(B,{key:e.id,value:e.roleName,label:e.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(w,{class:"box-card"},{header:a(()=>[V("div",Se,[V("div",ke,[v(" 小组信息"),r(l).director?(u(),b("span",Ce,[v("负责人:"),(u(!0),b(x,null,I(r(R),e=>(u(),c(N,{key:e.id},{default:a(()=>[e.id===r(l).director?(u(),c(N,{key:0},{default:a(()=>[v(_e(e.name),1)]),_:2},1024)):j("",!0)]),_:2},1024))),128))])):j("",!0)])])]),default:a(()=>[o(h,{gutter:24},{default:a(()=>[o(m,{label:"分配小组:"},{default:a(()=>[r(q).length?(u(),c(D,{key:0,modelValue:r(l).groupId,"onUpdate:modelValue":t[8]||(t[8]=e=>r(l).groupId=e)},{default:a(()=>[(u(!0),b(x,null,I(r(q),e=>(u(),c(B,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(u(),c(N,{key:1},{default:a(()=>[v("-")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ae=Ve(Be,[["__scopeId","data-v-7d512bfe"]]);export{Ae as default};
