
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ue,m as H,r as d,l as de,u as ie,c as ce,n as me,a as i,q as pe,o as m,e as f,w as a,y as h,f as t,g as V,s as fe,i as r,b as Z,t as $,F as J,z as ve,p as O,E as j,aH as _e,aI as ge,L as he}from"./index-Dr8SQZX-.js";import{a as be}from"./department-Bp1tuCrJ.js";import{a as ye}from"./position_manage-CDUHTVmA.js";import{a as ke}from"./configuration_role-ClbEpbec.js";import{u as Ne}from"./tenant_role-B-w6UD06.js";import{u as xe}from"./configuration_manager-CfAcej2D.js";const A=b=>(_e("data-v-708071ad"),b=b(),ge(),b),Ve=A(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"基本信息")],-1)),we=A(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"}," 部门信息 ")],-1)),Ie=A(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"角色信息")],-1)),Ce={class:"flex-c"},Se=ue({__name:"index",props:H(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:H(["success","getList"],["update:modelValue"]),setup(b,{emit:G}){const Q=xe(),W=d([]),M=d(),X=de(),Y=d();Ne();const E=d(),L=d([]),ee=d(!1),P=d(),T=d(),y=b,z=G,v=d(null),B=ie(b,"modelValue"),ae=ce(()=>y.id?"编辑用户":"新增用户"),le={children:"children",label:"name"},w=d(!1),_=d();d([]);const e=d({id:y.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",roleList:[],role:"",active:!0,positionId:"",organizationalStructureId:""}),g=d([]),I=d({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(n,l,s)=>{const o=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;e.value.phoneNumber?o.test(e.value.phoneNumber)?s():s(new Error("请输入合法手机号")):s()},trigger:"blur"}],email:[{validator:(n,l,s)=>{const o=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e.value.email?o.test(e.value.email)?s():s(new Error("请输入合法邮箱")):s()},trigger:"blur"}]}),te=n=>{Array.isArray(n)&&n.length>1&&(e.value.roleList=[n[n.length-1]])};function oe(){var n;if(e.value.email||(I.value.email=[],_.value.clearValidate("email")),e.value.phoneNumber||(I.value.phoneNumber=[],_.value.clearValidate("phoneNumber")),(n=v.value)!=null&&n.getCheckedKeys()){g.value=v.value.getCheckedKeys(!1);const l=v.value.getCheckedKeys(),s=v.value.getHalfCheckedKeys(),o=l.concat(s);e.value.organizationalStructureId=o[0]}e.value.roleList.length>0?e.value.role=e.value.roleList[0]:(e.value.role="",e.value.roleList=[]),e.value.id?_.value&&_.value.validate(l=>{if(l){const{id:s,phoneNumber:o,email:p,password:U,name:D,country:N,active:x,type:K,role:S,positionId:F,organizationalStructureId:R,userName:q}=e.value,c={id:s,phoneNumber:o,email:p,password:U,name:D,country:N,active:x,type:K,role:S,positionId:e.value.positionId?e.value.positionId:"",organizationalStructureId:R,userName:q};T.value===c.phoneNumber&&delete c.phoneNumber,P.value===c.email&&delete c.email,c.password||delete c.password,O.edit(c).then(()=>{j.success({message:"编辑成功",center:!0}),z("success"),C()})}}):_.value&&_.value.validate(l=>{l&&O.create(e.value).then(()=>{j.success({message:"新增成功",center:!0}),z("success"),z("getList"),C()})})}function C(){B.value=!1}const se=(n,l)=>{l?(v.value.getCheckedKeys().forEach(o=>{o!==n.id&&v.value.setChecked(o,!1)}),g.value=[n.id]):g.value=g.value.filter(s=>s!==n.id)};return me(async()=>{try{w.value=!0,g.value=[];const{data:n}=await ye.list({page:1,limit:10,id:null,name:"",active:null});n&&(M.value=n.data),W.value=await Q.getStaff();const l=await ke.list({id:null,name:""});l.data&&(E.value=l.data);const s=await be.list({name:""});if(s.data&&(L.value=s.data),Y.value=await X.getCountry(),e.value.roleList=[],y.id!==""&&y.row){I.value.password=[],e.value=JSON.parse(y.row),e.value.roleList=[e.value.role];const o=e.value.organizationalStructureId;o&&(g.value=Array.isArray(o)?o:[o]),P.value=e.value.email,T.value=e.value.phoneNumber,ee.value=!0}w.value=!1}catch{}finally{w.value=!1}}),(n,l)=>{const s=i("el-input"),o=i("el-form-item"),p=i("el-col"),U=i("el-option"),D=i("el-select"),N=i("el-row"),x=i("el-card"),K=i("el-tree"),S=i("el-text"),F=i("el-checkbox"),R=i("el-checkbox-group"),q=i("ElForm"),c=i("ElButton"),re=i("ElDrawer"),ne=pe("loading");return m(),f(re,{modelValue:B.value,"onUpdate:modelValue":l[7]||(l[7]=u=>B.value=u),title:r(ae),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:C},{footer:a(()=>[h("div",Ce,[t(c,{size:"large",onClick:C},{default:a(()=>[V(" 取消 ")]),_:1}),t(c,{type:"primary",size:"large",onClick:oe},{default:a(()=>[V(" 确定 ")]),_:1})])]),default:a(()=>[fe((m(),f(q,{ref_key:"formRef",ref:_,model:r(e),rules:r(I),"label-width":"100px","validate-on-rule-change":!1},{default:a(()=>[t(x,{class:"box-card"},{header:a(()=>[Ve]),default:a(()=>[t(N,{gutter:24},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(o,{label:"用户名",prop:"userName"},{default:a(()=>[t(s,{modelValue:r(e).userName,"onUpdate:modelValue":l[0]||(l[0]=u=>r(e).userName=u),maxlength:20,placeholder:"请输入用户名",clearable:"",disabled:!!y.id},null,8,["modelValue","disabled"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(o,{label:"姓名",prop:""},{default:a(()=>[t(s,{modelValue:r(e).name,"onUpdate:modelValue":l[1]||(l[1]=u=>r(e).name=u),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(o,{label:"手机号",prop:"phoneNumber"},{default:a(()=>[t(s,{modelValue:r(e).phoneNumber,"onUpdate:modelValue":l[2]||(l[2]=u=>r(e).phoneNumber=u),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(o,{label:"邮箱",prop:"email"},{default:a(()=>[t(s,{modelValue:r(e).email,"onUpdate:modelValue":l[3]||(l[3]=u=>r(e).email=u),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(o,{label:"职位",prop:""},{default:a(()=>[t(D,{modelValue:r(e).positionId,"onUpdate:modelValue":l[4]||(l[4]=u=>r(e).positionId=u),placeholder:"请选择职位",clearable:"",filterable:"",onChange:l[5]||(l[5]=()=>{})},{default:a(()=>[(m(!0),Z(J,null,$(r(M),u=>(m(),f(U,{key:u.id,label:u.name,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(o,{label:"初始密码",prop:""},{default:a(()=>[t(s,{clearable:"",value:"123456",disabled:""})]),_:1})]),_:1})]),_:1})]),_:1}),t(x,{class:"box-card"},{header:a(()=>[we]),default:a(()=>[t(N,{gutter:24},{default:a(()=>[t(o,{label:"分配部门:"},{default:a(()=>[r(L).length>0?(m(),f(K,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:v,data:r(L),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":r(g),"default-expand-all":"",props:le,onCheckChange:se},null,8,["data","default-checked-keys"])):(m(),f(S,{key:1},{default:a(()=>[V("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1}),t(x,{class:"box-card"},{header:a(()=>[Ie]),default:a(()=>[t(N,{gutter:24},{default:a(()=>[t(o,{label:"分配角色:",prop:"z"},{default:a(()=>{var u;return[(u=r(E))!=null&&u.length?(m(),f(R,{key:0,style:{"margin-left":"1.5rem"},modelValue:r(e).roleList,"onUpdate:modelValue":l[6]||(l[6]=k=>r(e).roleList=k),onChange:te},{default:a(()=>[(m(!0),Z(J,null,$(r(E),k=>(m(),f(F,{key:k.id,label:k.roleName,value:k.roleName},{default:a(()=>[V(ve(k.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):(m(),f(S,{key:1},{default:a(()=>[V("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[ne,r(w)]])]),_:1},8,["modelValue","title"])}}}),qe=he(Se,[["__scopeId","data-v-708071ad"]]);export{qe as default};
