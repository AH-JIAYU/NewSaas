
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as k,s as W}from"./apiLoading-BIPKmmFn.js";import{a as T}from"./projectManagement-IDDDkc0I.js";import{c as X}from"./user_cooperation-C0bVKHSV.js";import{a as Y}from"./survey_vip_department-Dl0-Z7mk.js";import{U as Z}from"./user_supplier-L5__bKsi.js";import{u as $}from"./survey_vipGroup-BIO1MZTO.js";import{d as ee,r as _,n as le,a as n,q as te,o as s,b as V,f as r,w as t,y as ae,g as c,s as oe,i as l,e as u,j as I,F as j,t as A,A as re,E as ie,L as ne}from"./index-Ce2QFOMs.js";import"./user_supplier-DJmhD5fW.js";import"./survey_vipGroup-D-eYLotR.js";const se={style:{flex:"auto"}},pe=ee({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(ue,{expose:U,emit:E}){const N=Z();$();const B=E,h=_(!1),y=_(!1),L=_(),v=_(),f=_([]),K={children:"children",label:"name"},e=_({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]},selectAll:{supplier:!1,member:!1}}),R=_({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]});async function z(i,a){if(e.value.list=[{...i}],a==="reassign"){e.value.title="重新分配";const d=await k(T.getProjectAllocation({projectId:i.projectId})),{groupSupplierIdSet:g,...p}=d.data;e.value.form=p,e.value.form.groupSupplierIdList=g}else e.value.title="分配",e.value.form.projectId=i.projectId;e.value.tenantSupplierList=await k(N.getTenantSupplierList(i.projectId));const m=await Y.list({name:""});e.value.departmentList=m.data;const b=await k(X.getAllocationBindList({projectId:i.projectId}));f.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(f.value=e.value.form.groupSupplierIdList),e.value.tenantList=b.data.allocationBindInfoList,y.value=!0}function F(){e.value.form.groupSupplierIdList=[]}function q(){e.value.form.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(i=>{e.value.form.groupSupplierIdList.push(i.tenantSupplierId)})}const D=(i,a)=>{a?(v.value.getCheckedKeys().forEach(p=>{p!==i.id&&v.value.setChecked(p,!1)}),f.value=[i.id]):f.value=f.value.filter(g=>g!==i.id),f.value=v.value.getCheckedKeys(!1);const m=v.value.getCheckedKeys(),b=v.value.getHalfCheckedKeys(),d=m.concat(b);e.value.form.groupSupplierIdList=d};function S(){L.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),y.value=!1}function H(){L.value.validate(async i=>{if(i)try{h.value=!0;const{status:a}=await W(T.allocation(e.value.form));h.value=!1,a===1&&ie.success({message:"分配成功",center:!0}),S(),B("fetch-data")}catch{}finally{h.value=!1}})}return le(async()=>{}),U({showEdit:z}),(i,a)=>{const m=n("el-table-column"),b=n("el-table"),d=n("el-radio"),g=n("el-radio-group"),p=n("el-form-item"),M=n("el-checkbox"),x=n("el-option"),w=n("el-select"),P=n("el-tree"),G=n("el-text"),O=n("el-form"),C=n("el-button"),J=n("el-dialog"),Q=te("loading");return s(),V("div",null,[r(J,{modelValue:l(y),"onUpdate:modelValue":a[4]||(a[4]=o=>re(y)?y.value=o:null),title:"分配",width:"700","before-close":S},{footer:t(()=>[ae("div",se,[r(C,{onClick:S},{default:t(()=>[c(" 取消 ")]),_:1}),r(C,{type:"primary",onClick:H},{default:t(()=>[c(" 确定 ")]),_:1})])]),default:t(()=>[oe((s(),u(b,{data:l(e).list,"row-key":"id"},{default:t(()=>[r(m,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),r(m,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),r(m,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[Q,l(h)]]),r(O,{ref_key:"formRef",ref:L,"label-width":"80px",rules:l(R),model:l(e).form,inline:!1},{default:t(()=>[r(p,{label:"分配目标"},{default:t(()=>[r(g,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=o=>l(e).form.allocationType=o),class:"ml-4",onChange:F},{default:t(()=>[r(d,{value:2,size:"large"},{default:t(()=>[c(" 供应商 ")]),_:1}),r(d,{value:3,size:"large"},{default:t(()=>[c(" 部门 ")]),_:1}),r(d,{value:4,size:"large"},{default:t(()=>[c("租户 ")]),_:1}),l(e).title==="重新分配"?(s(),u(d,{key:0,value:5,size:"large"},{default:t(()=>[c(" 取消分配 ")]),_:1})):I("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===2&&l(e).form.allocationType!==5?(s(),u(p,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:t(()=>[r(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[2]||(a[2]=o=>l(e).form.groupSupplierIdList=o),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:t(()=>[r(M,{modelValue:l(e).selectAll.supplier,"onUpdate:modelValue":a[1]||(a[1]=o=>l(e).selectAll.supplier=o),onChange:q,style:{display:"flex",height:"unset"}},{default:t(()=>[c("全选")]),_:1},8,["modelValue"])]),default:t(()=>[(s(!0),V(j,null,A(l(e).tenantSupplierList,o=>(s(),u(x,{label:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):I("",!0),l(e).form.allocationType===3&&l(e).form.allocationType!==5?(s(),u(p,{key:1,label:"部门",prop:"groupSupplierIdList"},{default:t(()=>[l(e).departmentList.length>0?(s(),u(P,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:v,data:l(e).departmentList,"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":l(f),"default-expand-all":"",props:K,onCheckChange:D},null,8,["data","default-checked-keys"])):(s(),u(G,{key:1},{default:t(()=>[c("暂无数据")]),_:1}))]),_:1})):I("",!0),l(e).form.allocationType===4&&l(e).form.allocationType!==5?(s(),u(p,{key:2,label:"租户",prop:"groupSupplierIdList"},{default:t(()=>[r(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[3]||(a[3]=o=>l(e).form.groupSupplierIdList=o),placeholder:"请选择租户",clearable:"",filterable:"",multiple:"","collapse-tags":"","multiple-limit":1},{default:t(()=>[(s(!0),V(j,null,A(l(e).tenantList,o=>(s(),u(x,{label:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):I("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),he=ne(pe,[["__scopeId","data-v-8cc08603"]]);export{he as default};
