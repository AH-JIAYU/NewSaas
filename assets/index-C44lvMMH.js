
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as L}from"./project_settlement-BWUdEFHD.js";import M from"./index-DwIaZhvD.js";import{d as q,aj as F,r as u,a as c,q as P,o as j,b as A,f as t,w as r,v as d,g as p,s as $,e as N,A as m,i as s,j as H,E as C,M as J}from"./index-CBBxVEK9.js";const G={class:"border"},K={class:"pp"},Q={class:"neip"},W={class:"border"},X={class:"pp"},Y={class:"neip"},Z={class:"shenhe"},ee={class:"beizhu"},le={class:"po"},ae={class:"flex-c"},te=q({name:"ProjectReview",__name:"index",emits:["success"],setup(re,{expose:k,emit:x}){const{t:a}=F(),I=u(),T=x,_=u(!1),i=u(),e=u({projectId:"",projectName:"",settlementType:"",remark:"",projectSettlementBuilderList:[],po:"",arr:""}),D=(v,l,n)=>{const y=l.replace(/\s+/g,"");/^[\d\n]*$/.test(y)?n():n(new Error(a("recordChange.numEnter")))},z=u({settlementType:[{required:!0,message:a("recordChange.chooseType"),trigger:"change"}],arr:[{required:!0,message:a("recordChange.idEnter"),trigger:"blur"},{validator:D,trigger:"blur"}]}),h=u();u(!1);const g=u(!1);async function B(v){v&&(i.value=JSON.parse(v),e.value.projectId=i.value.projectId,e.value.projectName=i.value.projectName),g.value=!0}async function E(){h.value&&h.value.validate(async v=>{try{if(v){_.value=!0,delete e.value.projectName,e.value.settlementType===1||e.value.settlementType===2?e.value.projectSettlementBuilderList=e.value.arr.split(`
`).map(n=>n.replace(/\s+/g,"")).filter(n=>n.length>0)||[]:e.value.projectSettlementBuilderList=[],delete e.value.arr;const{status:l}=await L.review(e.value);l===1?(new BroadcastChannel("televiseChannel").postMessage("我在子页面提交了,需要刷新列表"),T("success"),_.value=!1,C.success({message:a("recordChange.success"),center:!0}),V()):C.error({message:a("recordChange.failure"),center:!0})}else C({message:a("recordChange.check"),type:"warning"})}catch{}finally{_.value=!1}})}function V(){h.value.resetFields(),Object.assign(e.value,{projectId:"",projectName:"",settlementType:"",remark:"",projectSettlementBuilderList:[],po:"",arr:""}),e.value.arr=[],g.value=!1}return k({showEdit:B}),(v,l)=>{const n=c("el-input"),y=c("el-row"),f=c("el-radio"),R=c("el-radio-group"),b=c("el-form-item"),S=c("el-form"),w=c("el-button"),U=c("el-drawer"),O=P("loading");return j(),A("div",null,[t(U,{modelValue:g.value,"onUpdate:modelValue":l[8]||(l[8]=o=>g.value=o),title:s(a)("recordChange.projectAudit"),size:"50%","before-close":V},{footer:r(()=>[d("div",ae,[t(w,{onClick:l[7]||(l[7]=o=>g.value=!1)},{default:r(()=>[p(" 取消 ")]),_:1}),t(w,{type:"primary",onClick:E},{default:r(()=>[p(" 确定 ")]),_:1})])]),default:r(()=>[$((j(),N(S,{ref_key:"formRef",ref:h,model:e.value,rules:z.value,"label-width":"174px",inline:!1},{default:r(()=>[t(y,{style:{margin:"0"},gutter:20},{default:r(()=>[d("div",G,[d("p",K,m(s(a)("recordChange.projectID")),1),d("p",Q,[t(n,{modelValue:i.value.projectId,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value.projectId=o),placeholder:s(a)("recordChange.projectIDEnter"),disabled:"",clearable:""},null,8,["modelValue","placeholder"])])]),d("div",W,[d("p",X,m(s(a)("recordChange.projectName")),1),d("p",Y,[t(n,{modelValue:i.value.projectName,"onUpdate:modelValue":l[1]||(l[1]=o=>i.value.projectName=o),disabled:"",placeholder:s(a)("recordChange.projectNameEnter"),clearable:""},null,8,["modelValue","placeholder"])])])]),_:1}),d("div",Z,[t(b,{prop:"settlementType",style:{display:"flex","align-items":"center"},label:s(a)("recordChange.auditMethod")},{default:r(()=>[t(R,{modelValue:e.value.settlementType,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.settlementType=o)},{default:r(()=>[t(f,{value:1,size:"large"},{default:r(()=>[p(m(s(a)("recordChange.successID")),1)]),_:1}),t(f,{value:2,size:"large"},{default:r(()=>[p(m(s(a)("recordChange.failureID")),1)]),_:1}),t(f,{value:3,size:"large"},{default:r(()=>[p(m(s(a)("recordChange.allPass")),1)]),_:1}),t(f,{value:4,size:"large"},{default:r(()=>[p(m(s(a)("recordChange.allFailure")),1)]),_:1}),t(f,{value:5,size:"large"},{default:r(()=>[p(m(s(a)("recordChange.dataFreezing")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),d("div",ee,[t(b,{label:s(a)("recordChange.remark")},{default:r(()=>[t(n,{class:"custom-input",modelValue:e.value.remark,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.remark=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),d("div",le,[t(b,{label:s(a)("recordChange.PONumber")},{default:r(()=>[t(n,{modelValue:e.value.po,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.po=o),class:"custom-input",placeholder:"",clearable:"",onChange:l[5]||(l[5]=()=>{})},null,8,["modelValue"])]),_:1},8,["label"])]),e.value.settlementType===1||e.value.settlementType===2?(j(),N(y,{key:0,style:{margin:"0",width:"100%"},gutter:20},{default:r(()=>[t(b,{style:{width:"100%"},prop:"arr"},{default:r(()=>[t(n,{modelValue:e.value.arr,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.arr=o),placeholder:s(a)("recordChange.onlyOne"),type:"textarea",rows:15},null,8,["modelValue","placeholder"])]),_:1})]),_:1})):H("",!0)]),_:1},8,["model","rules"])),[[O,_.value]]),t(M,{ref_key:"progressDetailsRef",ref:I},null,512)]),_:1},8,["modelValue","title"])])}}}),de=J(te,[["__scopeId","data-v-3f988c11"]]);export{de as default};
