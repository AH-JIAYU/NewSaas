
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ye,aN as he,r as c,a3 as ge,c as be,n as Te,a as v,q as ke,o as r,b as Ie,f as l,w as o,g as f,i as a,A as T,s as Ce,e as u,aM as Pe,y,j as m,z as k,N as $,aO as B,E,b9 as je,ba as Ne,_ as Se,be as Ue,ap as ze,L as Be}from"./index-CDcFrPzE.js";import{_ as Ee}from"./index-CJ95okTh.js";import{_ as Re}from"./index.vue_vue_type_style_index_0_lang-BFfhDeyP.js";import $e from"./index-D7DyESyO.js";import xe from"./index-CyT3Cnfr.js";import{c as C}from"./user_cooperation-oFpsLdNZ.js";import De from"./index-jjsXPlDb.js";import"./index-B1BSnhPY.js";import"./index-CaLduACg.js";import"./department-C4UdYaqe.js";const Le={class:"fontC-System"},Me={class:"copyId tableSmall"},Ae={class:"id oneLine beInvitationTenantId"},Fe={class:"tableBig"},He={class:"flex-s"},qe={class:"fontC-System"},we={class:"fontC-System"},Oe={class:"fontC-System"},Qe={class:"fontC-System"},Ve=ye({name:"cooperation",__name:"index",setup(Je){const{pagination:h,getParams:w,onSizeChange:O,onCurrentChange:Q}=he(),p=c(!1),R=c([]),x=c(),D=c(),V=c(),P=c(!1),j=c(!1),N=c(!1),S=c("default"),d=c([]),L=c(),U=c([{label:"合作商id",checked:!0,sortable:!0,prop:"beInvitationTenantId"},{label:"合作商名称",checked:!0,sortable:!0,prop:"beInvitationTenantName"},{label:"PM",checked:!0,sortable:!0,prop:"userName"},{label:"状态",checked:!0,sortable:!0,prop:"bindStatus"},{label:"价格比例",checked:!0,sortable:!0,prop:"priceRatio"},{label:"待审金额",checked:!0,sortable:!0,prop:"pendBalance"},{label:"可用金额",checked:!0,sortable:!0,prop:"availableBalance"},{label:"发送项目",checked:!0,sortable:!0,prop:"sendProjectType"},{label:"接收项目",checked:!0,sortable:!0,prop:"receiveProjectType"},{label:"负责部门/PM",checked:!0,sortable:!0,prop:"userName"}]),z=c();function J(n){n?z.value=n.id:z.value=""}function G(){x.value.showEdit()}function K(n){B.prompt("是否确认进行解约?","终止合作",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"说明",inputPattern:/^.{0,500}$/,inputErrorMessage:"不能超过500个字符",type:"warning"}).then(async e=>{const{data:{flag:s}}=await C.updateRescindTenant({beInvitationTenantId:n.beInvitationTenantId,remark:e.value});s&&E({type:"success",message:"已终止合作"}),I()}).catch(()=>{})}function W(n){D.value.showEdit(n)}const X=ge({});function Y(n){O(n).then(()=>I())}function Z(n=1){Q(n).then(()=>I())}function g(){h.value.page=1,I()}async function I(){try{p.value=!0;const n={...w(),...X},{data:e}=await C.list(n);R.value=e.tenantBindInfoList,h.value.total=Number(e.total),p.value=!1}catch{}finally{p.value=!1}}function ee(n){V.value=n}const te=be(()=>{const n=R.value.filter(i=>i.bindStatus===2);let e=R.value.filter(i=>i.bindStatus===4);e=Array.from(new Map(e.map(i=>[i.beInvitationTenantId,i])).values());const s=n.map(i=>i.beInvitationTenantId);return e.forEach(i=>{s.includes(i.beInvitationTenantId)||n.push(i)}),n});function ne(n,e){L.value.showEdit(n,e)}Te(()=>{U.value.forEach(n=>{n.checked&&d.value.push(n.prop)}),g()});const M=(n,e)=>{(e.sendProjectType==1&&n=="手动"||e.sendProjectType==2&&n=="自动")&&B.confirm(`确认将发送状态改为${n}吗？`,"确认信息").then(()=>{try{p.value=!0;let s={id:e.id,chargeUserId:e.chargeUserId,invitationType:e.invitationType,chargeUserName:e.chargeUserName,sendProjectType:!e.sendProjectType,receiveProjectType:e.receiveProjectType};C.updateInvitationBindUser(s).then(()=>{p.value=!1,g(),E.success({message:"修改成功",center:!0})})}catch{}finally{p.value=!1}}).catch(()=>{})},A=c(),F=(n,e)=>{let s=JSON.parse(JSON.stringify(e));if(s.receiveProjectType=!e.receiveProjectType,e.receiveProjectType==1&&n=="手动")B.confirm(`确认将接收状态改为${n}吗？`,"确认信息").then(()=>{try{p.value=!0;let i={id:e.id,chargeUserId:e.chargeUserId,invitationType:e.invitationType,chargeUserName:e.chargeUserName,sendProjectType:e.sendProjectType,receiveProjectType:!e.receiveProjectType};C.updateInvitationBindUser(i).then(()=>{p.value=!1,g(),E.success({message:"修改成功",center:!0})})}catch{}finally{p.value=!1}}).catch(()=>{});else if(e.receiveProjectType==2&&n=="自动"){let i={chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,id:e.id};A.value.showEdit(i,"请选择负责部门/人")}};function ae(n){B.confirm(`确认将接收状态改为${name}吗？`,"确认信息").then(()=>{try{p.value=!0;let e={id:n.id,chargeUserId:n.chargeUserId,invitationType:n.invitationType,chargeUserName:n.chargeUserName,sendProjectType:n.sendProjectType,receiveProjectType:!n.receiveProjectType};C.updateInvitationBindUser(e).then(()=>{p.value=!1,g(),E.success({message:"修改成功",center:!0})})}catch{}finally{p.value=!1}}).catch(()=>{})}return(n,e)=>{const s=v("el-button"),i=Re,oe=je,le=Ne,ie=v("el-row"),_=v("el-table-column"),H=v("el-text"),se=v("el-tooltip"),re=Ee,ce=Se,q=Ue,ue=v("ElSpace"),pe=v("el-empty"),de=v("el-table"),fe=v("ElPagination"),me=ze,_e=v("userDialog"),ve=ke("loading");return r(),Ie("div",{class:$({"absolute-container":a(N)})},[l(me,null,{default:o(()=>[l(ie,null,{default:o(()=>[l(i,null,{default:o(()=>[l(s,{type:"primary",size:"default",onClick:G},{default:o(()=>[f(" 邀约公司 ")]),_:1})]),_:1}),l(le,null,{default:o(()=>[l(s,{size:"default"},{default:o(()=>[f(" 导出 ")]),_:1}),l(oe,{border:a(P),"onUpdate:border":e[0]||(e[0]=t=>T(P)?P.value=t:null),tableAutoHeight:a(N),"onUpdate:tableAutoHeight":e[1]||(e[1]=t=>T(N)?N.value=t:null),checkList:a(d),"onUpdate:checkList":e[2]||(e[2]=t=>T(d)?d.value=t:null),columns:a(U),"onUpdate:columns":e[3]||(e[3]=t=>T(U)?U.value=t:null),"line-height":a(S),"onUpdate:lineHeight":e[4]||(e[4]=t=>T(S)?S.value=t:null),stripe:a(j),"onUpdate:stripe":e[5]||(e[5]=t=>T(j)?j.value=t:null),style:{"margin-left":"12px"},onQueryData:g},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),Ce((r(),u(de,{border:a(P),data:a(te),size:a(S),stripe:a(j),onSelectionChange:ee,"highlight-current-row":"",onCurrentChange:J},{empty:o(()=>[l(pe,{image:a(Pe),"image-size":300},null,8,["image"])]),default:o(()=>[l(_,{align:"left",type:"selection"}),a(d).includes("bindStatus")?(r(),u(_,{key:0,align:"left",prop:"bindStatus","show-overflow-tooltip":"",label:"状态",width:"100"},{default:o(({row:t})=>[y("div",Le,[t.bindStatus===2?(r(),u(H,{key:0,type:"success"},{default:o(()=>[f("合作")]),_:1})):m("",!0),t.bindStatus===4?(r(),u(H,{key:1,type:"danger"},{default:o(()=>[f("解约")]),_:1})):m("",!0)])]),_:1})):m("",!0),a(d).includes("bindStatus")?(r(),u(_,{key:1,align:"left",prop:"sendProjectType","show-overflow-tooltip":"",label:"发送项目",width:"160"},{default:o(({row:t})=>[l(s,{type:t.sendProjectType===1?"primary":"",size:"small",onClick:b=>M("自动",t)},{default:o(()=>[f("自动 ")]),_:2},1032,["type","onClick"]),l(s,{type:t.sendProjectType===2?"primary":"",size:"small",onClick:b=>M("手动",t)},{default:o(()=>[f("手动")]),_:2},1032,["type","onClick"])]),_:1})):m("",!0),a(d).includes("receiveProjectType")?(r(),u(_,{key:2,align:"left",prop:"receiveProjectType","show-overflow-tooltip":"",label:"接收项目",width:"160"},{default:o(({row:t})=>[l(s,{type:t.receiveProjectType===1?"primary":"",size:"small",onClick:b=>F("自动",t)},{default:o(()=>[f("自动 ")]),_:2},1032,["type","onClick"]),l(s,{type:t.receiveProjectType===2?"primary":"",size:"small",onClick:b=>F("手动",t)},{default:o(()=>[f("手动")]),_:2},1032,["type","onClick"])]),_:1})):m("",!0),a(d).includes("beInvitationTenantId")?(r(),u(_,{key:3,align:"left",prop:"beInvitationTenantId",width:"280",label:"合作商ID"},{default:o(({row:t})=>[y("div",Me,[y("div",Ae,[l(se,{effect:"dark",content:t.beInvitationTenantId,placement:"top-start"},{default:o(()=>[f(k(t.beInvitationTenantId),1)]),_:2},1032,["content"])]),l(re,{content:t.beInvitationTenantId,class:$({rowCopy:"rowCopy",current:t.id===a(z)})},null,8,["content","class"])])]),_:1})):m("",!0),a(d).includes("beInvitationTenantName")?(r(),u(_,{key:4,align:"left",prop:"beInvitationTenantName","show-overflow-tooltip":"",label:"合作商名称"},{default:o(({row:t})=>[y("div",Fe,k(t.beInvitationTenantName),1)]),_:1})):m("",!0),a(d).includes("userName")?(r(),u(_,{key:5,align:"left",prop:"userName","show-overflow-tooltip":"",label:"负责部门/PM"},{default:o(({row:t})=>[y("div",He,[y("div",qe,k(t.userName),1),t.projectType!==2?(r(),u(ce,{key:0,onClick:b=>ne(t,"chargeUserId"),class:$({edit:"edit",current:t.id===a(z)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):m("",!0)])]),_:1})):m("",!0),a(d).includes("priceRatio")?(r(),u(_,{key:6,align:"left",prop:"priceRatio","show-overflow-tooltip":"",label:"价格比例"},{default:o(({row:t})=>[y("div",we,k(t.priceRatio)+"%",1)]),_:1})):m("",!0),a(d).includes("pendBalance")?(r(),u(_,{key:7,align:"left",prop:"pendBalance","show-overflow-tooltip":"",label:"待审金额"},{default:o(({row:t})=>[y("div",Oe,[l(q),f(k(t.pendBalance||0),1)])]),_:1})):m("",!0),a(d).includes("availableBalance")?(r(),u(_,{key:8,align:"left",prop:"availableBalance","show-overflow-tooltip":"",label:"可用金额"},{default:o(({row:t})=>[y("div",Qe,[l(q),f(k(t.availableBalance||0),1)])]),_:1})):m("",!0),l(_,{align:"left",fixed:"right",prop:"i",label:"操作",width:"200"},{default:o(({row:t})=>[l(ue,null,{default:o(()=>[t.bindStatus===2?(r(),u(s,{key:0,type:"danger",plain:"",size:"small",onClick:b=>K(t)},{default:o(()=>[f(" 终止合作 ")]),_:2},1032,["onClick"])):m("",!0),l(s,{size:"small",type:"danger",onClick:b=>W(t)},{default:o(()=>[f(" 合作配置 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["border","data","size","stripe"])),[[ve,a(p)]]),l(fe,{"current-page":a(h).page,total:a(h).total,"page-size":a(h).size,"page-sizes":a(h).sizes,layout:a(h).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","total","page-size","page-sizes","layout"]),l($e,{ref_key:"editRef",ref:x,onFetchData:g},null,512),l(xe,{ref_key:"proportionRef",ref:D,onFetchData:g},null,512)]),_:1}),l(De,{ref_key:"QuickEditRef",ref:L,onFetchData:I},null,512),l(_e,{ref_key:"userRef",ref:A,onUserData:ae},null,512)],2)}}}),ot=Be(Ve,[["__scopeId","data-v-02b1663b"]]);export{ot as default};
