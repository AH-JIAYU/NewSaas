
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as T,d as te,aN as ae,r as c,k as oe,a as f,p as ne,q as se,o as n,b as I,f as t,w as e,s as N,g as m,F as k,t as y,e as i,H as v,j as w,E as de,aJ as re,aK as ue,R as ie}from"./index-lihZnDlK.js";import{a as ce}from"./department-DO9yWr6Y.js";import{u as me}from"./department-BKQXja9r.js";import{u as pe}from"./configuration_manager-BgHz6wwS.js";const fe={list:_=>T.post("team/getGroupTeam",_),create:_=>T.post("team/insertGroupTeam",_),edit:_=>T.post("team/updateGroupTeam",_),delete:_=>T.post("team/deleteGroupTeam",_)},j=_=>(re("data-v-3261c0e4"),_=_(),ue(),_),_e=j(()=>N("div",{class:"card-header"},[N("span",null,"组长")],-1)),ve=j(()=>N("div",{class:"card-header"},[N("span",null,"组员")],-1)),he={style:{flex:"auto"}},be=te({name:"Edit",__name:"index",emits:["success"],setup(_,{expose:A,emit:ge}){ae();const S=c(),K=c(),P=me(),g=c(),J=pe(),x=c([]),R=c(""),q=c(),z=c(!1);c([]),c();const C=c(!1),h=c([]),D=c([]),E=c();c({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{chineseName:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),c({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1});const b=c({groupId:null,userInfo:[],menuId:[]}),O={children:"children",label:"name"},U=c({commission:[{validator:(s,r,a)=>{/^[0-9]*\.?[0-9]*$/.test(r)?a():a(new Error("请输入有效的数字或小数"))},trigger:"blur"}]});async function Q(s){R.value=s!=null&&s.id?"编辑":"新增";const r=JSON.parse(s);b.value.groupId=r.id;const a={page:1,limit:10,groupId:r.id},o=await fe.list(a);E.value=o.data.departmentId;const u=await ce.createEvery();g.value=u.data.result,g.value=g.value.filter(p=>p.id===E.value),o.data.data.forEach(p=>{var V,L;p.isLeader?D.value.push(p):((L=(V=b.value)==null?void 0:V.menuId)==null||L.push(p.memberId),h.value.push(p))}),C.value=!0}oe(async()=>{g.value=await P.getDepartment(),x.value=await J.getStaff(),q.value=new Date});function G(s,r){const a=s.findIndex(o=>o.memberId===r);a!==-1&&s.splice(a,1)}function B(s,r){s.some(a=>a.id===r.id)||s.push(r)}function W(s){h.value=h.value.filter(a=>a.id!==s.id),S.value.getNode(s.id).checked?s.children&&s.children.length?s.children.forEach(a=>B(h.value,a)):B(h.value,s):s.children&&s.children.length?s.children.forEach(a=>G(h.value,a.id)):G(h.value,s.id)}function X(){return new Promise(s=>{const r=S.value.getCheckedKeys(),a=S.value.getHalfCheckedKeys();r.concat(a),delete b.value.menuId;let o=0;if(D.value.forEach(u=>{u.commission&&(o+=u.commission);let p={userId:u.id,commission:u.commission};b.value.userInfo.push(p)}),h.value.forEach(u=>{u.commission&&(o+=u.commission);let p;u.memberId?p={userId:u.memberId,commission:u.commission}:p={userId:u.id,commission:u.commission},b.value.userInfo.push(p)}),o>100){de.warning({message:"提成比例不能超过100",center:!0});return}console.log("groupLeaderList.value",D.value),console.log("dataList.value",h.value),console.log("form.value",b.value),console.log("number",o)})}return A({showEdit:Q}),(s,r)=>{const a=f("el-table-column"),o=f("el-text"),u=f("el-input"),p=f("el-form-item"),V=f("el-form"),L=f("el-empty"),F=f("el-table"),H=f("el-card"),Y=f("el-tree"),M=f("el-col"),Z=f("el-row"),$=f("el-button"),ee=f("el-drawer"),le=ne("loading");return se((n(),I("div",null,[t(ee,{modelValue:C.value,"onUpdate:modelValue":r[2]||(r[2]=l=>C.value=l),title:R.value,size:"60%"},{footer:e(()=>[N("div",he,[t($,{type:"",onClick:r[1]||(r[1]=l=>C.value=!1)},{default:e(()=>[m(" 取消 ")]),_:1}),t($,{type:"primary",onClick:X},{default:e(()=>[m(" 确定 ")]),_:1})])]),default:e(()=>[t(H,{class:"box-card"},{header:e(()=>[_e]),default:e(()=>[t(F,{data:D.value,border:""},{empty:e(()=>[t(L,{description:"暂无数据"})]),default:e(()=>[t(a,{align:"center",type:"index",label:"序号",width:"80"}),t(a,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"}),t(a,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"用户名"},{default:e(({row:l})=>[l.memberId?(n(!0),I(k,{key:0},y(x.value,d=>(n(),i(o,null,{default:e(()=>[l.memberId===d.id?(n(),i(o,{key:0},{default:e(()=>[m(v(d.name),1)]),_:2},1024)):w("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(v(l.name),1)]),_:2},1024))]),_:1}),t(a,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"姓名"},{default:e(({row:l})=>[l.memberId?(n(!0),I(k,{key:0},y(x.value,d=>(n(),i(o,null,{default:e(()=>[l.memberId===d.id?(n(),i(o,{key:0},{default:e(()=>[m(v(d.name),1)]),_:2},1024)):w("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(v(l.name),1)]),_:2},1024))]),_:1}),t(a,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:l})=>[(n(!0),I(k,null,y(g.value,d=>(n(),i(o,null,{default:e(()=>[E.value===d.id?(n(),i(o,{key:0},{default:e(()=>[m(v(d.name),1)]),_:2},1024)):w("",!0)]),_:2},1024))),256))]),_:1}),t(a,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:l})=>[t(V,{model:l,rules:U.value},{default:e(()=>[t(p,{prop:"commission"},{default:e(()=>[t(u,{modelValue:l.commission,"onUpdate:modelValue":d=>l.commission=d,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[m("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1}),t(H,{class:"box-card"},{header:e(()=>[ve]),default:e(()=>[t(Z,{gutter:20},{default:e(()=>[t(M,{class:"leftData",span:8},{default:e(()=>[t(u,{modelValue:b.value.invoiceAmount,"onUpdate:modelValue":r[0]||(r[0]=l=>b.value.invoiceAmount=l),placeholder:"可输入关键字查找",clearable:""},null,8,["modelValue"]),t(Y,{style:{"max-width":"37.5rem","min-height":"20.125rem","margin-top":"20px"},data:g.value,ref_key:"treeRef",ref:S,"show-checkbox":"","node-key":"id","default-checked-keys":b.value.menuId,"default-expanded-keys":b.value.menuId,"default-expand-all":"",props:O,onCheck:W},null,8,["data","default-checked-keys","default-expanded-keys"])]),_:1}),t(M,{span:16},{default:e(()=>[t(F,{ref_key:"tableRef",ref:K,data:h.value,border:""},{empty:e(()=>[t(L,{description:"暂无数据"})]),default:e(()=>[t(a,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"},{default:e(({row:l})=>[l.memberId?(n(),i(o,{key:0},{default:e(()=>[m(v(l.memberId),1)]),_:2},1024)):(n(),i(o,{key:1},{default:e(()=>[m(v(l.id),1)]),_:2},1024))]),_:1}),t(a,{align:"center","show-overflow-tooltip":"",prop:"userName",label:"用户名"},{default:e(({row:l})=>[l.memberId?(n(!0),I(k,{key:0},y(x.value,d=>(n(),i(o,null,{default:e(()=>[l.memberId===d.id?(n(),i(o,{key:0},{default:e(()=>[m(v(d.name),1)]),_:2},1024)):w("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(v(l.userName?l.userName:"-"),1)]),_:2},1024))]),_:1}),t(a,{align:"center","show-overflow-tooltip":"",prop:"name",label:"姓名"},{default:e(({row:l})=>[l.memberId?(n(!0),I(k,{key:0},y(x.value,d=>(n(),i(o,null,{default:e(()=>[l.memberId===d.id?(n(),i(o,{key:0},{default:e(()=>[m(v(d.name),1)]),_:2},1024)):w("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(v(l.name),1)]),_:2},1024))]),_:1}),t(a,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:l})=>[(n(!0),I(k,null,y(g.value,d=>(n(),i(o,null,{default:e(()=>[E.value===d.id?(n(),i(o,{key:0},{default:e(()=>[m(v(d.name),1)]),_:2},1024)):w("",!0)]),_:2},1024))),256))]),_:1}),t(a,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:l})=>[t(V,{model:l,rules:U.value},{default:e(()=>[t(p,{prop:"commission"},{default:e(()=>[t(u,{modelValue:l.commission,"onUpdate:modelValue":d=>l.commission=d,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[m("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])),[[le,z.value]])}}}),xe=ie(be,[["__scopeId","data-v-3261c0e4"]]);export{xe as default};
