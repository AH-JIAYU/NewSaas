
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as U}from"./file-Dx1DcfIL.js";import{k as d,d as T,r as u,a as i,o as A,b as Q,f as e,w as t,y as D,g as w,ah as R}from"./index-C4R2SyQS.js";import{D as S}from"./download-C8PHVIy1.js";const L={list:s=>d.post("projectMaterial/getProjectMaterialList",s),create:s=>d.post("projectMaterial/addProjectMaterialDetails",s),delete:s=>d.post("projectMaterial/deleteProjectMaterial",s),deleteMaterialDetails:s=>d.post("projectMaterial/deleteProjectMaterialDetails",s)},$={style:{flex:"auto"}},F=["src"],K=T({name:"Details",__name:"index",emits:["fetchData"],setup(s,{expose:b,emit:y}){const j=y,n=u(!1),l=u({showData:{},idList:[],materialUrlList:[]}),h=u(""),c=u(!1);async function M(a){l.value.showData=a,n.value=!0,await V(a.materialUrl)}const V=async a=>{a.length&&a.forEach(async o=>{const m=await U.detail({fileName:o.materialUrl});o.url=m.data.fileUrl,o.name=o.materialUrl})},x=a=>{h.value=a.url,c.value=!0},N=async(a,o)=>{a.id?l.value.idList.push(a.id):await U.delete({fileName:a.response.data.qiNiuUrl})},C=()=>{R.warning({message:"上传失败了,换张图片试试吧",center:!0})},E=(a,o)=>{l.value.materialUrlList.push(a.data.qiNiuUrl)};function P(){l.value.showData.materialUrl.forEach(a=>{S(a.url,a.name)})}async function g(){l.value.materialUrlList.length&&await L.create({id:l.value.showData.id,materialUrlList:l.value.materialUrlList}),l.value.idList.length&&await L.deleteMaterialDetails({idList:l.value.idList}),n.value=!1,j("fetchData"),l.value.idList=[],l.value.materialUrlList=[]}return b({showEdit:M}),(a,o)=>{const m=i("el-divider"),p=i("el-input"),f=i("el-form-item"),_=i("el-col"),k=i("el-row"),v=i("el-button"),I=i("el-upload"),B=i("el-form"),q=i("el-dialog"),z=i("el-drawer");return A(),Q("div",null,[e(z,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=r=>n.value=r),title:"详情",direction:"rtl","before-close":g,size:"40%"},{footer:t(()=>[D("div",$,[e(v,{onClick:g},{default:t(()=>[w(" 关闭 ")]),_:1})])]),default:t(()=>[e(m,{"content-position":"left"}),e(B,{"label-width":"80px",inline:!1},{default:t(()=>[e(k,{gutter:20},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(f,{label:"项目ID"},{default:t(()=>[e(p,{disabled:"",value:l.value.showData.projectId},null,8,["value"])]),_:1})]),_:1}),e(_,{span:8},{default:t(()=>[e(f,{label:"项目名称"},{default:t(()=>[e(p,{disabled:"",value:l.value.showData.projectName},null,8,["value"])]),_:1})]),_:1}),e(_,{span:8},{default:t(()=>[e(f,{label:"会员名称"},{default:t(()=>[e(p,{disabled:"",value:l.value.showData.memberChildName},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(I,{"file-list":l.value.showData.materialUrl,"onUpdate:fileList":o[0]||(o[0]=r=>l.value.showData.materialUrl=r),class:"upload-demo",action:"http://47.96.98.102:9100/project/uploadQiniu","on-preview":x,"on-remove":N,"on-success":E,"on-error":C,"list-type":"picture"},{trigger:t(()=>[e(v,{type:"primary",class:"m-4"},{default:t(()=>[w("上传")]),_:1})]),default:t(()=>[e(v,{type:"primary",onClick:P},{default:t(()=>[w(" 下载 ")]),_:1})]),_:1},8,["file-list"])]),_:1}),e(q,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=r=>c.value=r),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:t(()=>[D("img",{"w-full":"",src:h.value,alt:"Preview Image"},null,8,F)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}});export{K as _,L as a};
