
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as le,l as ae,$ as te,r as m,a3 as U,a4 as oe,n as ne,a as d,q as re,o as c,b as I,s as se,i as a,e as V,w as l,f as e,ar as de,F as P,t as B,y as v,g as S,A as ue,_ as ie}from"./index-DkeSsSat.js";import{u as me,v as ce}from"./index-B-6FpLwx.js";import{u as pe}from"./survey_vipGroup-whcx85tn.js";import{a as fe}from"./survey_vip_department-CWDVs_YR.js";const ve=v("div",{class:"card-header"},[v("span",null,"基本信息")],-1),be=v("div",{class:"card-header"},[v("span",null,"权限信息")],-1),_e={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"0 1rem"}},ge=v("div",{class:"card-header"},[v("div",{class:"leftTitle"}," 部门信息 ")],-1),xe=le({__name:"index",props:{leftTab:Object,tabIndex:Number},setup(R){const q=ae(),K=me();pe();const G=te("validateTopTabs"),z=R,h=m(!1),b=m(),p=m([]),L=m([]),C=m("basicSettings"),N=m(),k=U({vipLevelList:[],vipGroupList:[],countryList:[]}),D={children:"children",label:"name"},f=U({memberNickname:[{required:!0,message:"请输入会员昵称",trigger:"blur"},{min:2,max:50,message:"内容在2-50个字之间",trigger:"blur"}],memberLevelId:[{required:!0,message:"请选择会员等级",trigger:"change"}],subordinateCountryId:[{required:!0,message:"请选择区域",trigger:"change"}]}),$=(u,n,i)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(o.value.memberPhone)?i():i(new Error("请输入合法手机号"))},j=(u,n,i)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(o.value.emailAddress)?i():i(new Error("请输入合法邮箱"))},E=u=>{u&&(o.value.countryType=u==="343"?1:2,u==="343"?(f.emailAddress&&delete f.emailAddress,f.memberPhone=[{required:!0,message:"请输入手机号码",trigger:"blur"},{validator:$,trigger:"blur"}]):(f.memberPhone&&delete f.memberPhone,f.emailAddress=[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:j,trigger:"blur"}]))},F=(u,n)=>{n?(b.value.getCheckedKeys().forEach(g=>{g!==u.id&&b.value.setChecked(g,!1)}),p.value=[u.id]):p.value=p.value.filter(_=>_!==u.id),p.value=b.value.getCheckedKeys(!1);const i=b.value.getCheckedKeys(),r=b.value.getHalfCheckedKeys(),s=i.concat(r);o.value.memberGroupId=s[0]},A=async()=>{k.vipLevelList=await K.getLevelNameList()},O=async()=>{await A();const u=await fe.list({name:""});L.value=u.data,k.countryList=await q.getCountry()},T=m(null),o=m(z.leftTab);p.value=[],o.value.memberGroupId&&p.value.push(o.value.memberGroupId),oe(()=>{G(T.value)});const Z=()=>{N.value.showEdit()};return ne(async()=>{try{h.value=!0,await O(),E(o.value.subordinateCountryId),h.value=!1}catch{}finally{h.value=!1}}),(u,n)=>{const i=d("el-input"),r=d("el-form-item"),s=d("el-col"),_=d("el-option"),g=d("el-select"),x=d("el-row"),w=d("el-card"),y=d("el-switch"),H=d("el-divider"),M=ie,Q=d("el-button"),J=d("el-tree"),W=d("el-text"),X=d("el-tab-pane"),Y=d("el-tabs"),ee=re("loading");return c(),I("div",null,[se((c(),V(Y,{modelValue:a(C),"onUpdate:modelValue":n[11]||(n[11]=t=>ue(C)?C.value=t:null)},{default:l(()=>[e(X,{label:"会员信息",name:"basicSettings"},{default:l(()=>[e(a(de),{ref_key:"formRef",ref:T,model:a(o),rules:a(f),"label-width":"100px","validate-on-rule-change":!1},{default:l(()=>[e(w,{class:"box-card"},{header:l(()=>[ve]),default:l(()=>[e(x,{gutter:24},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"会员名称",prop:"memberNickname"},{default:l(()=>[e(i,{modelValue:a(o).memberNickname,"onUpdate:modelValue":n[0]||(n[0]=t=>a(o).memberNickname=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"所属区域",prop:"subordinateCountryId"},{default:l(()=>[e(g,{clearable:"",filterable:"",modelValue:a(o).subordinateCountryId,"onUpdate:modelValue":n[1]||(n[1]=t=>a(o).subordinateCountryId=t),onChange:E},{default:l(()=>[(c(!0),I(P,null,B(a(k).countryList,t=>(c(),V(_,{key:t.id,value:t.id,label:t.chineseName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"会员姓名"},{default:l(()=>[e(i,{clearable:"",modelValue:a(o).memberName,"onUpdate:modelValue":n[2]||(n[2]=t=>a(o).memberName=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"手机号码",prop:"memberPhone"},{default:l(()=>[e(i,{clearable:"",modelValue:a(o).memberPhone,"onUpdate:modelValue":n[3]||(n[3]=t=>a(o).memberPhone=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"电子邮箱",prop:"emailAddress"},{default:l(()=>[e(i,{clearable:"",modelValue:a(o).emailAddress,"onUpdate:modelValue":n[4]||(n[4]=t=>a(o).emailAddress=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:l(()=>[e(r,{label:"初始密码"},{default:l(()=>[e(i,{clearable:"",value:"123456",disabled:""})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{class:"box-card"},{header:l(()=>[be]),default:l(()=>[e(x,{gutter:20},{default:l(()=>[e(s,{span:4},{default:l(()=>[e(r,{label:"会员状态"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:a(o).memberStatus,"onUpdate:modelValue":n[5]||(n[5]=t=>a(o).memberStatus=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:4},{default:l(()=>[e(r,{label:"B2B"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:a(o).b2bStatus,"onUpdate:modelValue":n[6]||(n[6]=t=>a(o).b2bStatus=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:4},{default:l(()=>[e(r,{label:"B2C"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:a(o).b2cStatus,"onUpdate:modelValue":n[7]||(n[7]=t=>a(o).b2cStatus=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:5},{default:l(()=>[e(r,{label:"免审"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:a(o).exemptionTrial,"onUpdate:modelValue":n[8]||(n[8]=t=>a(o).exemptionTrial=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:4},{default:l(()=>[e(r,{label:"随机身份"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:a(o).randomStatus,"onUpdate:modelValue":n[9]||(n[9]=t=>a(o).randomStatus=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(H,{"content-position":"center"}),e(x,{gutter:20},{default:l(()=>[e(s,{span:8},{default:l(()=>[e(r,{label:"会员等级",prop:"memberLevelId"},{default:l(()=>[e(g,{clearable:"",filterable:"",modelValue:a(o).memberLevelId,"onUpdate:modelValue":n[10]||(n[10]=t=>a(o).memberLevelId=t)},{empty:l(()=>[v("div",_e,[S(" 暂无数据 "),e(Q,{type:"primary",link:"",onClick:Z,size:"small"},{default:l(()=>[S(" 快捷新增 "),e(M,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:"2px",margin:"0 2px"}})]),_:1})])]),default:l(()=>[(c(!0),I(P,null,B(a(k).vipLevelList,t=>(c(),V(_,{key:t.memberLevelId,value:t.memberLevelId,label:t.levelNameOrAdditionRatio},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{class:"box-card"},{header:l(()=>[ge]),default:l(()=>[e(x,{gutter:24},{default:l(()=>[e(r,{label:"分配部门:"},{default:l(()=>[a(L).length>0?(c(),V(J,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:b,data:a(L),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":a(p),"default-expand-all":"",props:D,onCheckChange:F},null,8,["data","default-checked-keys"])):(c(),V(W,{key:1},{default:l(()=>[S("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])),[[ee,a(h)]]),e(ce,{ref_key:"EditRef",ref:N,onQueryData:A},null,512)])}}});export{xe as _};
