
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ae,J as le,aO as se,y as ne,r as k,n as ie,z as E,C as re,a as p,q as ue,o as i,b as S,f as n,w as l,i as o,g as m,B as me,s as ce,e as r,aN as pe,v as g,A as f,j as u,F as de,O as fe,aP as be,E as I,aQ as ge,aR as he,be as _e,ap as ye,M as ke}from"./index-DFP_ze2i.js";import{_ as ve}from"./index-DzLbUHWV.js";import{_ as we}from"./index.vue_vue_type_style_index_0_lang-BpGMeAAN.js";import{_ as Se}from"./index-CsRzL_1Q.js";import{_ as Ce}from"./index.vue_vue_type_script_setup_true_lang-DH2Z4Kg4.js";import{a as C}from"./index-C3fB9ymE.js";import{u as Le}from"./useTabbar-Dp4mHQpL.js";import"./index-BHtaVN9N.js";import"./index.vue_vue_type_script_setup_true_lang-YU-WPf6J.js";import"./sortable.esm-C0-Qcoum.js";const xe={key:0,class:"hoverSvg"},Me={class:"fineBom"},Ne={class:"c-fx"},Te={class:"weightColor"},ze={style:{"font-weight":"700"}},Ae={style:{"font-weight":"700"}},Ee={style:{"font-weight":"700"}},Ie=ae({name:"billManagement",__name:"list",setup(Pe){const P=le(),{pagination:b,getParams:B,onSizeChange:D,onCurrentChange:H,onSortChange:F}=se(),U=Le(),L=ne(),x=k(),V=k("formSearch-billManagement"),h=k([{label:"会员ID",prop:"memberId",sortable:!0,checked:!0},{label:"会员名称",prop:"memberName",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税",prop:"taxesFees",sortable:!0,checked:!0},{label:"实际金额",prop:"payAmount",sortable:!0,checked:!0},{label:"支付时间",prop:"payTime",sortable:!0,checked:!0},{label:"账单状态",prop:"billStatus",sortable:!0,checked:!0},{label:"说明",prop:"notes",sortable:!0,checked:!0}]),e=k({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],formMode:"dialog",formModeProps:{visible:!1,id:""},search:{memberId:"",memberName:"",member:"",billStatus:""},billStatusList:[{label:"待支付",value:1},{label:"已支付",value:2},{label:"已拒绝",value:3}],batch:{enable:!1,selectionDataList:[]},dataList:[]});function c(){try{e.value.loading=!0;const s={...B(),...e.value.search};e.value.search.member&&(/^\d+$/.test(s.member)?s.memberId=s.member:s.memberName=s.member),C.list(s).then(a=>{e.value.loading=!1,e.value.dataList=a.data.memberBillInfoList,b.value.total=a.data.total})}catch{}finally{e.value.loading=!1}}function $(){Object.assign(e.value.search,{memberId:"",memberName:"",member:"",billStatus:""}),c()}function O(s){D(s).then(()=>c())}function M(s=1){H(s).then(()=>c())}function R({prop:s,order:a}){F(s,a).then(()=>c())}function j(){e.value.formMode==="router"?L.settings.tabbar.enable&&L.settings.tabbar.mergeTabsBy!=="activeMenu"?U.open({name:"routerName"}):P.push({name:"routerName"}):(e.value.formModeProps.id="",e.value.formModeProps.visible=!0)}async function N(s,a){a===2?be.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async _=>{(await C.changestatus({id:s,type:a,notes:_.value})).status===1&&I.success({message:"操作成功"}),c()}):((await C.changestatus({id:s,type:a})).status===1&&I.success({message:"操作成功"}),c())}ie(()=>{h.value.forEach(s=>{s.checked&&e.value.checkList.push(s.prop)}),c(),e.value.formMode==="router"&&E.on("get-data-list",()=>{c()}),x.value=[{index:1,show:!0,type:"input",modelName:"memberId",placeholder:"会员ID"},{index:2,show:!0,type:"input",modelName:"memberName",placeholder:"会员姓名"},{index:3,show:!0,type:"select",modelName:"billStatus",placeholder:"账单状态",option:"billStatus",optionLabel:"label",optionValue:"value"}]});const Q={billStatus:()=>e.value.billStatusList};return re(()=>{e.value.formMode==="router"&&E.off("get-data-list")}),(s,a)=>{const _=Se,T=p("ElDivider"),y=p("el-button"),q=we,J=ge,G=he,K=p("el-row"),z=p("el-table-column"),W=ve,A=p("el-text"),d=p("ElTableColumn"),v=_e,w=p("el-tag"),X=p("el-empty"),Y=p("ElTable"),Z=p("ElPagination"),ee=ye,te=ue("loading");return i(),S("div",{class:fe({"absolute-container":o(e).tableAutoHeight})},[n(ee,null,{default:l(()=>[n(_,{formSearchList:o(x),formSearchName:o(V),onCurrentChange:M,onOnReset:$,model:o(e).search,formOption:Q},null,8,["formSearchList","formSearchName","model"]),n(T,{"border-style":"dashed"}),n(K,null,{default:l(()=>[n(q,null,{default:l(()=>[n(y,{size:"default",type:"primary",onClick:j},{default:l(()=>[m(" 新增结算 ")]),_:1})]),_:1}),n(G,null,{default:l(()=>[n(y,{size:"default"},{default:l(()=>[m(" 导出 ")]),_:1}),n(J,{border:o(e).border,"onUpdate:border":a[0]||(a[0]=t=>o(e).border=t),tableAutoHeight:o(e).tableAutoHeight,"onUpdate:tableAutoHeight":a[1]||(a[1]=t=>o(e).tableAutoHeight=t),checkList:o(e).checkList,"onUpdate:checkList":a[2]||(a[2]=t=>o(e).checkList=t),columns:o(h),"onUpdate:columns":a[3]||(a[3]=t=>me(h)?h.value=t:null),"line-height":o(e).lineHeight,"onUpdate:lineHeight":a[4]||(a[4]=t=>o(e).lineHeight=t),stripe:o(e).stripe,"onUpdate:stripe":a[5]||(a[5]=t=>o(e).stripe=t),style:{"margin-left":"12px"},onQueryData:c},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),ce((i(),r(Y,{border:o(e).border,size:o(e).lineHeight,stripe:o(e).stripe,class:"my-4",data:o(e).dataList,"highlight-current-row":"",height:"100%",onSortChange:R,onSelectionChange:a[6]||(a[6]=t=>o(e).batch.selectionDataList=t)},{empty:l(()=>[n(X,{image:o(pe),"image-size":300},null,8,["image"])]),default:l(()=>[n(z,{align:"left",type:"selection"}),o(e).checkList.includes("memberId")?(i(),r(d,{key:0,"show-overflow-tooltip":"",align:"left",prop:"",label:"会员ID",width:"200"},{default:l(({row:t})=>[t.memberId?(i(),S("div",xe,[g("p",Me,"ID："+f(t.memberId),1),g("span",Ne,[n(W,{class:"copy",content:t.memberId},null,8,["content"])])])):(i(),r(A,{key:1},{default:l(()=>[m("-")]),_:1}))]),_:1})):u("",!0),o(e).checkList.includes("memberName")?(i(),r(d,{key:1,"show-overflow-tooltip":"",align:"left",prop:"",label:"会员名称",width:"120"},{default:l(({row:t})=>[g("p",Te,f(t.memberName?t.memberName:"-"),1)]),_:1})):u("",!0),o(e).checkList.includes("billTime")?(i(),r(d,{key:2,"show-overflow-tooltip":"",align:"left",prop:"billTime",label:"账单日期"})):u("",!0),o(e).checkList.includes("billAmount")?(i(),r(d,{key:3,"show-overflow-tooltip":"",align:"left",prop:"billAmount",label:"账单金额"},{default:l(({row:t})=>[g("p",ze,[n(v),m(f(t.billAmount||0),1)])]),_:1})):u("",!0),o(e).checkList.includes("taxesFees")?(i(),r(d,{key:4,"show-overflow-tooltip":"",align:"left",prop:"taxesFees",label:"税"},{default:l(({row:t})=>[g("p",Ae,[n(v),m(f(t.taxesFees||0),1)])]),_:1})):u("",!0),o(e).checkList.includes("payAmount")?(i(),r(d,{key:5,"show-overflow-tooltip":"",align:"left",prop:"payAmount",label:"实际金额"},{default:l(({row:t})=>[g("p",Ee,[n(v),m(f(t.payAmount||0),1)])]),_:1})):u("",!0),o(e).checkList.includes("payTime")?(i(),r(d,{key:6,"show-overflow-tooltip":"",align:"left",prop:"payTime",label:"支付时间"},{default:l(({row:t})=>[m(f(t.payTime?t.payTime:"-"),1)]),_:1})):u("",!0),o(e).checkList.includes("billStatus")?(i(),r(d,{key:7,align:"left","show-overflow-tooltip":"",prop:"",label:"账单状态"},{default:l(({row:t})=>[t.billStatus===1?(i(),r(w,{key:0,type:"warning",effect:"dark"},{default:l(()=>[m("待支付")]),_:1})):u("",!0),t.billStatus===2?(i(),r(w,{key:1,type:"success",effect:"dark"},{default:l(()=>[m("已支付")]),_:1})):u("",!0),t.billStatus===3?(i(),r(w,{key:2,type:"danger",effect:"dark"},{default:l(()=>[m("已拒绝")]),_:1})):u("",!0)]),_:1})):u("",!0),o(e).checkList.includes("notes")?(i(),r(d,{key:8,"show-overflow-tooltip":"",align:"left",prop:"notes",label:"说明"},{default:l(({row:t})=>[n(A,{style:{color:"#333","font-weight":"700"}},{default:l(()=>[m(f(t.notes?t.notes:"-"),1)]),_:2},1024)]),_:1})):u("",!0),n(z,{align:"left",prop:"i",label:"操作",fixed:"right","show-overflow-tooltip":"",width:"260"},{default:l(({row:t})=>[t.billStatus===1?(i(),S(de,{key:0},[n(y,{size:"small",plain:"",type:"primary",onClick:oe=>N(t.id,1)},{default:l(()=>[m(" 支付 ")]),_:2},1032,["onClick"]),n(y,{size:"small",plain:"",type:"danger",onClick:oe=>N(t.id,2)},{default:l(()=>[m(" 拒绝支付 ")]),_:2},1032,["onClick"])],64)):u("",!0)]),_:1})]),_:1},8,["border","size","stripe","data"])),[[te,o(e).loading]]),n(Z,{"current-page":o(b).page,total:o(b).total,"page-size":o(b).size,"page-sizes":o(b).sizes,layout:o(b).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:O,onCurrentChange:M},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),o(e).formMode==="dialog"||o(e).formMode==="drawer"?(i(),r(Ce,{key:0,id:o(e).formModeProps.id,modelValue:o(e).formModeProps.visible,"onUpdate:modelValue":a[7]||(a[7]=t=>o(e).formModeProps.visible=t),mode:o(e).formMode,onSuccess:c},null,8,["id","modelValue","mode"])):u("",!0)],2)}}}),Qe=ke(Ie,[["__scopeId","data-v-424662d2"]]);export{Qe as default};
