
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as H}from"./group_team-8VxxtYc-.js";import{a as ie}from"./department-irxEtP0I.js";import{u as ce}from"./department-iWo_tVUZ.js";import{u as me}from"./configuration_manager-D0v14_uR.js";import{u as fe}from"./position_manage-B0JWt3p4.js";import{d as pe,aN as _e,r as u,k as ve,a as c,p as he,q as ge,o as d,b as y,f as s,w as e,s as R,g as v,e as _,H as g,F as N,t as S,j as V,E as $,aJ as be,aK as Ie,R as ke}from"./index-Cv0hhvIB.js";import"./position_manage-D1WEz_75.js";const ye=w=>(be("data-v-a0a61428"),w=w(),Ie(),w),we=ye(()=>R("div",{class:"card-header"},[R("span",null,"组成员")],-1)),xe={style:{flex:"auto"}},Ne=pe({name:"Edit",__name:"index",emits:["success"],setup(w,{expose:J,emit:O}){_e();const U=u(),q=u(),L=fe(),B=u(),z=ce(),b=u(),A=me(),C=u([]),G=O,M=u(""),K=u(),Q=u(!1);u([]);const E=u(),I=u(!1),m=u([]),T=u([]),D=u();u({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{chineseName:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});const k=u(null),f=u({groupId:null,userInfo:[],menuId:[]}),W={children:"children",label:"name"},X=u({commission:[{validator:(t,n,o)=>{/^[0-9]*[.]?[0-9]+$/.test(n)?o():o(new Error("请输入有效的数字或小数"))},trigger:"blur"}]});async function Y(t){M.value=t!=null&&t.id?"编辑":"新增";const n=JSON.parse(t);f.value.groupId=n.id,D.value=n.departmentId;const o={page:1,limit:10,groupId:n.id},p=await H.list(o);p!=null&&p.data.data&&p.data.data.forEach(a=>{var h,x;(x=(h=f.value)==null?void 0:h.menuId)==null||x.push(a.id),m.value.push(a)});const r=await ie.createEvery();b.value=r.data.result,b.value=b.value.filter(a=>a.id===D.value),I.value=!0}const Z=()=>{k&&(console.log("userName",k),m.value=b.value[0].children.filter(t=>t.userName.includes(k.value)),console.log("dataList.value",m.value))};ve(async()=>{B.value=await(L==null?void 0:L.getPositionManage())||[],b.value=await z.getDepartment(),C.value=await A.getStaff(),K.value=new Date});function j(t,n){const o=t.findIndex(p=>p.memberId===n);o!==-1&&t.splice(o,1)}function F(t,n){t.some(o=>o.id===n.id)||t.push(n)}function ee(t){m.value=m.value.filter(o=>o.id!==t.id),U.value.getNode(t.id).checked?t.children&&t.children.length?t.children.forEach(o=>F(m.value,o)):F(m.value,t):t.children&&t.children.length?t.children.forEach(o=>j(m.value,o.id)):j(m.value,t.id)}function te(){return new Promise(t=>{E.value&&E.value.validate(n=>{if(n){f.value.userInfo=[],delete f.value.menuId;let o=0;T.value.forEach(r=>{r.commission&&(o+=r.commission);let a={userId:r.memberId,commission:r.commission};f.value.userInfo.push(a)}),m.value.forEach(r=>{r.commission&&(o+=r.commission);let a;r.memberId?a={userId:r.memberId,commission:r.commission}:a={userId:r.id,commission:r.commission},f.value.userInfo.push(a)});const p=new Set;if(f.value.userInfo=f.value.userInfo.filter(r=>{const{userId:a}=r;return p.has(a)?!1:(p.add(a),!0)}),o>100){$.warning({message:"提成比例不能超过100",center:!0});return}H.edit(f.value).then(()=>{$.success({message:"操作成功",center:!0}),G("success"),I.value=!1,t()})}})})}const ae=()=>{Object.assign(f.value,{groupId:null,userInfo:[],menuId:[]}),T.value=[],m.value=[]};return J({showEdit:Y}),(t,n)=>{const o=c("el-input"),p=c("el-tree"),r=c("el-col"),a=c("el-text"),h=c("el-table-column"),x=c("el-form-item"),le=c("el-form"),oe=c("el-empty"),ne=c("el-table"),se=c("el-row"),re=c("el-card"),P=c("el-button"),ue=c("el-drawer"),de=he("loading");return ge((d(),y("div",null,[s(ue,{modelValue:I.value,"onUpdate:modelValue":n[2]||(n[2]=l=>I.value=l),title:M.value,onClose:ae,size:"60%"},{footer:e(()=>[R("div",xe,[s(P,{type:"",onClick:n[1]||(n[1]=l=>I.value=!1)},{default:e(()=>[v(" 取消 ")]),_:1}),s(P,{type:"primary",onClick:te},{default:e(()=>[v(" 确定 ")]),_:1})])]),default:e(()=>[s(re,{class:"box-card"},{header:e(()=>[we]),default:e(()=>[s(se,{gutter:20},{default:e(()=>[s(r,{class:"leftData",span:8},{default:e(()=>[s(o,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=l=>k.value=l),placeholder:"可输入用户名查找",clearable:"",onBlur:Z},null,8,["modelValue"]),s(p,{style:{"max-width":"37.5rem","min-height":"20.125rem","margin-top":"20px"},data:b.value,ref_key:"treeRef",ref:U,"show-checkbox":"","node-key":"id","default-checked-keys":f.value.menuId,"default-expanded-keys":f.value.menuId,"default-expand-all":"",props:W,onCheck:ee},null,8,["data","default-checked-keys","default-expanded-keys"])]),_:1}),s(r,{span:16},{default:e(()=>[s(ne,{ref_key:"tableRef",ref:q,data:m.value,border:""},{empty:e(()=>[s(oe,{description:"暂无数据"})]),default:e(()=>[s(h,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"},{default:e(({row:l})=>[l.id?(d(),_(a,{key:0},{default:e(()=>[v(g(l.id),1)]),_:2},1024)):(d(),_(a,{key:1},{default:e(()=>[v(g(l.id),1)]),_:2},1024))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"userName",label:"用户名"},{default:e(({row:l})=>[l.id?(d(!0),y(N,{key:0},S(C.value,i=>(d(),_(a,null,{default:e(()=>[l.id===i.id?(d(),_(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(d(),_(a,{key:1},{default:e(()=>[v(g(l.userName?l.userName:"-"),1)]),_:2},1024))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"name",label:"姓名"},{default:e(({row:l})=>[l.id?(d(!0),y(N,{key:0},S(C.value,i=>(d(),_(a,null,{default:e(()=>[l.id===i.id?(d(),_(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(d(),_(a,{key:1},{default:e(()=>[v(g(l.name),1)]),_:2},1024))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"职位"},{default:e(({row:l})=>[(d(!0),y(N,null,S(B.value,i=>(d(),_(a,null,{default:e(()=>[l.positionId===i.id?(d(),_(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256))]),_:1}),s(h,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:l})=>[(d(!0),y(N,null,S(b.value,i=>(d(),_(a,null,{default:e(()=>[D.value===i.id?(d(),_(a,{key:0},{default:e(()=>[v(g(i.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256))]),_:1}),s(h,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:l})=>[s(le,{model:l,ref_key:"formRef",ref:E,rules:X.value},{default:e(()=>[s(x,{prop:"commission"},{default:e(()=>[s(o,{modelValue:l.commission,"onUpdate:modelValue":i=>l.commission=i,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[v("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])),[[de,Q.value]])}}}),Ue=ke(Ne,[["__scopeId","data-v-a0a61428"]]);export{Ue as default};
