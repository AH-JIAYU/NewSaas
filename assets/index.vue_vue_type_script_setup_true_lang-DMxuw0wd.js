
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{E as z,r as d,c as M,d as Z,G,au as P,ak as I,a as i,al as J,am as L,i as o,o as p,b as U,f as t,w as u,F as A,n as D,e as f}from"./index-BqrqSrYO.js";import{u as j}from"./otherFunctions_basicDictionary-hKuUthyl.js";import{a as H}from"./configuration_role-CP2iotFR.js";const K=z("buttonPermission",()=>{const m=d([]),g=M(async()=>{if(m.value.length)return m.value;const{data:h}=await H.list();return h});return{role:m,getRole:g}}),Q=K,ee=Z({__name:"index",props:["id","row"],setup(m,{expose:g}){const h=j(),O=Q(),N=d(),R=d(),k=m,_=d(!1),B=d(!1),c=d(),e=d({id:"",email:"",phone:"",name:"",country:"",password:"",role:null,active:!0,type:"phone"}),T=(s,a,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?n():n(new Error("请输入合法手机号"))},$=(s,a,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?n():n(new Error("请输入合法邮箱"))},F=()=>{e.value.phone.includes("@")?b.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:$,trigger:"blur"}]:b.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:T,trigger:"blur"}]},b=d({name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]});G(async()=>{_.value=!0,R.value=await h.getCountry(),N.value=await O.getRole,_.value=!1,k.id&&(e.value=JSON.parse(k.row))});const q=s=>{(s!==e.value.phone||s!==e.value.email)&&(B.value=!0)};g({submit(){return new Promise(s=>{e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?c.value&&c.value.validate(a=>{a&&(delete e.value.id,e.value==="phone"?delete e.value.email:delete e.value.phone,P.create(e.value).then(()=>{I.success({message:"新增成功",center:!0}),y(),s()}))}):c.value&&c.value.validate(a=>{if(a){const{id:n,phone:r,email:E,password:V,name:w,country:x,active:C,type:v,role:S}=e.value,l={id:n,phone:r,email:E,password:V,name:w,country:x,active:C,type:v,role:S};v==="phone"?(l.email="",delete l.email):(l.phone="",delete l.phone),l.password||delete l.password,B.value||(delete l.phone,delete l.email),P.edit(l).then(()=>{I.success({message:"编辑成功",center:!0}),y(),s()})}})})},onCancel:y});function y(){e.value={}}return(s,a)=>{const n=i("ElInput"),r=i("ElFormItem"),E=i("ElOption"),V=i("ElSelect"),w=i("el-option"),x=i("el-select"),C=i("el-switch"),v=i("ElForm"),S=J("loading");return L((p(),U("div",null,[t(v,{ref_key:"formRef",ref:c,model:o(e),rules:o(b),"label-width":"130px","label-suffix":"："},{default:u(()=>[t(r,{label:"用户名",prop:"name"},{default:u(()=>[t(n,{modelValue:o(e).name,"onUpdate:modelValue":a[0]||(a[0]=l=>o(e).name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(r,{label:"国家",prop:"country"},{default:u(()=>[t(V,{modelValue:o(e).country,"onUpdate:modelValue":a[1]||(a[1]=l=>o(e).country=l),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:u(()=>[(p(!0),U(A,null,D(o(R),l=>(p(),f(E,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(e).country==="CN"?(p(),f(r,{key:0,label:"手机号",prop:"phone"},{default:u(()=>[t(n,{modelValue:o(e).phone,"onUpdate:modelValue":a[2]||(a[2]=l=>o(e).phone=l),placeholder:"请输入手机号",onChange:q,onBlur:F},null,8,["modelValue"])]),_:1})):(p(),f(r,{key:1,label:"邮箱",prop:"email"},{default:u(()=>[t(n,{modelValue:o(e).email,"onUpdate:modelValue":a[3]||(a[3]=l=>o(e).email=l),placeholder:"请输入邮箱",onChange:q,onBlur:F},null,8,["modelValue"])]),_:1})),t(r,{label:"密码",prop:"password"},{default:u(()=>[t(n,{modelValue:o(e).password,"onUpdate:modelValue":a[4]||(a[4]=l=>o(e).password=l),placeholder:"需要修改密码时直接修改即可"},null,8,["modelValue"])]),_:1}),t(r,{label:"角色",prop:"role"},{default:u(()=>[t(x,{modelValue:o(e).role,"onUpdate:modelValue":a[5]||(a[5]=l=>o(e).role=l),placeholder:"请选择角色"},{default:u(()=>[(p(!0),U(A,null,D(o(N),l=>(p(),f(w,{key:l.id,label:l.roleName,value:l.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"是否启用",prop:"active"},{default:u(()=>[t(C,{modelValue:o(e).active,"onUpdate:modelValue":a[6]||(a[6]=l=>o(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[S,o(_)]])}}});export{ee as _,Q as u};
