
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as S,ag as P,d as Q,r as x,b as T,o as I,e as m,g as a,w as u,t,h as l,H as o,j as d,F as j,v as N,S as b,bs as E,aN as $,k as A,I as F,be as H,aI as R,aJ as q,R as w}from"./index-B7Avs_NU.js";const z={list:_=>S.post("tenantBind/getProjectAllocationList",_),meList:_=>S.post("tenantBind/getProjectMeAllocationList",_),getTenantMeasurementList:_=>S.post("tenantBind/getTenantMeasurementList",_),getQuestionnaireClickList:_=>S.post("tenantBind/getQuestionnaireClickList",_)},J=P("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),U=J,K=_=>(R("data-v-f511bf81"),_=_(),q(),_),W={class:"details"},X={class:"details-left"},Y={class:"project box"},Z=K(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),ee=["onClick"],te={class:"item-left"},se={class:"tenant"},ne={key:0,class:"tenantName"},ae={class:"tenantLength"},le={class:"tenantName"},oe={class:"price flex-b"},ie={class:"viewAll"},ce={key:0,class:"details-right"},re={key:0,class:"clickId"},pe={class:"clickIdItem"},ue={class:"clickIdItem-title"},de={class:"supplierName"},_e={class:"clickIdItem-content"},fe={key:1,class:"nodata"},Ie={style:{flex:"auto"}},me=Q({name:"Edit",__name:"index",setup(_,{expose:O}){const k=U(),v=x(!1);x();const s=x({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function G(c,y=0){const n={linkId:c.linkId,projectId:c.projectId,source:y},f=await z.getTenantMeasurementList(n),i=f.data.tenantMeasurementInfoList;f.data.tenantMeasurementInfo&&i.unshift(f.data.tenantMeasurementInfo);const g=i.findIndex(p=>p.allocationTenantId===f.data.currentTenantId);i.splice(0,g);const h=i.filter(p=>p.type===1),e=i.filter(p=>p.type===2),r=i.filter(p=>p.type===3),L=[...h];if(e.length){const p=e.map(C=>C.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=p,L.push(e[0])}else if(r.length){const p=r.map(C=>C.memberGroupOrSupperId);r[0].length=r.length,r[0].memberGroupOrSupperIdList=p,L.push(r[0])}L.forEach(p=>p.visible=!1),s.value.currentTenantId=f.data.currentTenantId,s.value.tenantMeasurementInfoList=L,v.value=!0}const V=async(c,y)=>{s.value.select=s.value.select===y?"":y,s.value.clickIdList=[];const n={type:c.type,projectId:c.projectId,tenantId:c.allocationTenantId,supplierIdList:c.type===2?c.memberGroupOrSupperIdList:[],memberGroupIdList:c.type===3?c.memberGroupOrSupperIdList:[]},f=await z.getQuestionnaireClickList(n);s.value.clickIdList=B(f.data.questionnaireClickInfoList),c.type===2?s.value.clickIdList=s.value.clickIdList.filter(i=>i.peopleType===2):c.type===3&&(s.value.clickIdList=s.value.clickIdList.filter(i=>i.peopleType===1))};function B(c){return c.reduce((y,n)=>{const{supplierId:f,supplierName:i,projectQuestionnaireClickId:g,surveyStatus:h,price:e,peopleType:r}=n;let L=y.find(p=>p.supplierId===f);return L?L.list.push({projectQuestionnaireClickId:g,surveyStatus:h,price:e}):y.push({supplierId:f,peopleType:r,supplierName:i,list:[{projectQuestionnaireClickId:g,surveyStatus:h,price:e}]}),y},[])}function M(){v.value=!1,s.value={select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]}}function D(){M()}return O({showEdit:G}),(c,y)=>{const n=T("el-text"),f=H,i=T("el-button"),g=T("el-empty"),h=T("el-drawer");return I(),m("div",null,[a(h,{modelValue:d(v),"onUpdate:modelValue":y[0]||(y[0]=e=>F(v)?v.value=e:null),title:"详情",size:"60%","before-close":M},{footer:u(()=>[t("div",Ie,[a(i,{onClick:M},{default:u(()=>[l(" 取消 ")]),_:1}),a(i,{type:"primary",onClick:D},{default:u(()=>[l(" 确定 ")]),_:1})])]),default:u(()=>[t("div",W,[t("div",X,[t("div",Y,[t("div",null,[a(n,{tag:"b"},{default:u(()=>{var e;return[l(o((e=d(s).tenantMeasurementInfoList[0])==null?void 0:e.projectName),1)]}),_:1})]),t("div",null,[a(n,{type:"info"},{default:u(()=>{var e;return[l("ID："+o((e=d(s).tenantMeasurementInfoList[0])==null?void 0:e.projectId),1)]}),_:1})])]),(I(!0),m(j,null,N(d(s).tenantMeasurementInfoList,(e,r)=>(I(),m("div",{class:"link",key:e.allocationTenantId},[Z,t("div",{class:b({"item box":!0,select:r===d(s).select}),onClick:L=>V(e,r)},[t("div",te,[t("div",se,[(e==null?void 0:e.length)>1?(I(),m("p",ne,[l(" 已分配数： "),t("span",ae,o(e==null?void 0:e.length),1),t("span",{class:b("type"+e.type)},o(d(k).typeList[e.type-1]),3)])):(I(),m(j,{key:1},[t("p",null,[t("span",le,o(e.tenantName),1),t("span",{class:b("type"+e.type)},o(d(k).typeList[e.type-1]),3)]),a(n,{type:"info"},{default:u(()=>[l("ID："+o(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",oe,[t("p",null,[l(" 原价: "),a(f),l(o(e.doMoneyPrice),1)]),t("p",null,[l(" 参数: "),a(n,{size:"large"},{default:u(()=>[l(o(e.participationNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{type:"success",size:"large"},{default:u(()=>[l(o(e.doneNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{type:"warning",size:"large"},{default:u(()=>[l(o(e.num||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{size:"large"},{default:u(()=>[l(o(e.limitedQuantity||0),1)]),_:2},1024)])])]),t("div",ie,[a(i,{type:"primary",circle:"",size:"small",icon:d(E)},null,8,["icon"])])],10,ee)]))),128))]),d(s).select!==""?(I(),m("div",ce,[d(s).clickIdList.length?(I(),m("div",re,[(I(!0),m(j,null,N(d(s).clickIdList,e=>(I(),m("div",pe,[t("div",ue,[t("div",null,[t("span",de,o(e.supplierName),1),t("span",{class:b("peopleType"+e.peopleType)},o(d(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[a(n,{type:"info"},{default:u(()=>[l("ID： "+o(e.supplierId),1)]),_:2},1024)])]),t("div",_e,[t("ul",null,[(I(!0),m(j,null,N(e.list,r=>(I(),m("li",null,[t("span",null,o(r.projectQuestionnaireClickId),1),t("span",{class:b("surveyStatus"+r.surveyStatus)},o(d(k).surveyStatusList[r.surveyStatus-1]),3)]))),256))])])]))),256))])):(I(),m("div",fe,[a(g,{image:d($),"image-size":300},null,8,["image"])]))])):A("",!0)])]),_:1},8,["modelValue"])])}}}),ye=w(me,[["__scopeId","data-v-f511bf81"]]),ve=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{z as a,ve as i,ye as o,U as u};
