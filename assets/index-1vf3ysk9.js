
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as q,s as z}from"./apiLoading-CMqTE2KY.js";import{a as A}from"./projectManagement-BgMecCfF.js";import{a as D}from"./survey_vip_department-C8RlE5fN.js";import{u as H}from"./survey_vipGroup-Cp-ZSDx1.js";import{d as M,r as s,n as F,a,q as O,o as _,b as P,f as l,w as t,y as Q,g as v,s as U,e as w,z as C,i as n,A as J,E as W,L as X}from"./index-V1RbChf9.js";import"./survey_vipGroup-Ceh2re0A.js";const Y={style:{flex:"auto"}},Z=M({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup($,{expose:I,emit:L}){const S=H(),g=s([]),r=s(),c=s([]),V={children:"children",label:"name"},j=L,d=s(!1),h=s(),o=s({list:[],vipGroupList:[],form:{projectId:"",allocationType:3,groupSupplierIdList:[]}}),E=s({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择至少一项"}]});async function K(e){o.value.list=[{...e}],o.value.form.projectId=e.projectId,o.value.vipGroupList=await q(S.getGroupNameList()),d.value=!0}function y(){h.value.resetFields(),Object.assign(o.value.form,{projectId:"",groupSupplierIdList:[]}),d.value=!1}const N=(e,i)=>{i?(r.value.getCheckedKeys().forEach(f=>{f!==e.id&&r.value.setChecked(f,!1)}),c.value=[e.id]):c.value=c.value.filter(p=>p!==e.id),c.value=r.value.getCheckedKeys(!1);const u=r.value.getCheckedKeys(),k=r.value.getHalfCheckedKeys(),b=u.concat(k);o.value.form.groupSupplierIdList=b[0]};function G(){h.value.validate(async e=>{if(e){const{status:i}=await z(A.allocation(o.value.form));i===1&&W.success({message:"分配成功",center:!0}),y(),j("fetch-data")}})}return F(async()=>{const e=await D.list({name:""});e.data&&(g.value=e.data)}),I({showEdit:K}),(e,i)=>{const u=a("el-table-column"),k=a("el-table"),b=a("el-tree"),p=a("el-text"),f=a("el-form-item"),R=a("el-form"),x=a("el-button"),B=a("el-dialog"),T=O("loading");return _(),P("div",null,[l(B,{modelValue:n(d),"onUpdate:modelValue":i[0]||(i[0]=m=>J(d)?d.value=m:null),title:"分配",width:"700","before-close":y},{footer:t(()=>[Q("div",Y,[l(x,{onClick:y},{default:t(()=>[v(" 取消 ")]),_:1}),l(x,{type:"primary",onClick:G},{default:t(()=>[v(" 确定 ")]),_:1})])]),default:t(()=>[U((_(),w(k,{data:n(o).list,"row-key":"id"},{default:t(()=>[l(u,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),l(u,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"projectName"}),l(u,{align:"left","show-overflow-tooltip":"",label:"配额/限量",prop:"name"},{default:t(({row:m})=>[v(C(m.limitedQuantity||0)+"/ "+C(m.num||0),1)]),_:1})]),_:1},8,["data"])),[[T,!1]]),l(R,{ref_key:"formRef",ref:h,"label-width":"6rem",rules:n(E),model:n(o).form,inline:!1,style:{"margin-top":"1.25rem"}},{default:t(()=>[l(f,{label:"部门",prop:""},{default:t(()=>[n(g).length>0?(_(),w(b,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:r,data:n(g),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":n(c),"default-expand-all":"",props:V,onCheckChange:N},null,8,["data","default-checked-keys"])):(_(),w(p,{key:1},{default:t(()=>[v("暂无数据")]),_:1}))]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),ne=X(Z,[["__scopeId","data-v-1e3dec5f"]]);export{ne as default};
