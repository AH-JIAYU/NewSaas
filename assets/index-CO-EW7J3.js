
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as g,d as U,r as _,n as z,E as A,a as u,q as C,s as j,i as a,o as c,b as p,f as t,w as n,g as B,F as v,t as V,e as R,y as O,z as S,L as P}from"./index-wfZ6lyFc.js";const M={list:r=>g.post("bill/getMemberBillList",r),create:r=>g.post("bill/addMemberSettlement",r),getMemberBillAvailableBalance:r=>g.post("bill/getMemberBillAvailableBalance",r),changestatus:r=>g.post("bill/updateMemberBill",r)},q=U({__name:"index",props:{id:{default:""}},setup(r,{expose:L}){const i=_(!1),y=_(),e=_({minimumAmount:"",settlementType:1,settlementAmount:"",addMemberSettlementInfoList:[]}),f=_({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),h=_({}),E=async()=>{try{i.value=!0;const s=await M.getMemberBillAvailableBalance({});s.data&&(f.value.memberSettlementInfoList=s.data.memberBillAvailableBalanceInfoList,e.value.minimumAmount=s.data.minimumAmount),i.value=!1}catch{}finally{i.value=!1}},x=s=>{e.value.addMemberSettlementInfoList=[];const o=f.value.memberSettlementInfoList.filter(m=>s.includes(m.id));for(let m=0;m<o.length;m++)e.value.addMemberSettlementInfoList.push(o[m])};return z(async()=>{await E()}),L({submit(){return new Promise(s=>{y.value&&y.value.validate(o=>{const m=e.value.addMemberSettlementInfoList.every(b=>typeof b.settlementAmount=="number"&&b.settlementAmount>=e.value.minimumAmount);if(o)if(m&&e.value.settlementAmount>=e.value.minimumAmount)try{i.value=!0,M.create(e.value).then(()=>{i.value=!1,A.success({message:"新增成功",center:!0}),s()})}catch{}finally{i.value=!1}else A.warning({message:"“结算金额”小于“最低结算金额”",center:!0})})})}}),(s,o)=>{const m=u("el-radio"),b=u("el-radio-group"),d=u("ElFormItem"),I=u("ElInput"),k=u("el-option"),w=u("el-select"),F=u("ElInputNumber"),N=u("ElForm"),T=C("loading");return j((c(),p("div",null,[t(N,{ref_key:"formRef",ref:y,model:a(e),rules:a(h),"label-width":"9rem"},{default:n(()=>[t(d,{label:"结算方式"},{default:n(()=>[t(b,{modelValue:a(e).settlementType,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).settlementType=l)},{default:n(()=>[t(m,{value:1,size:"large"},{default:n(()=>[B(" 全部结算 ")]),_:1}),t(m,{value:2,size:"large"},{default:n(()=>[B(" 指定结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(e).settlementType===1?(c(),p(v,{key:0},[t(d,{label:"最低结算额度"},{default:n(()=>[t(I,{disabled:"",placeholder:"",value:a(e).minimumAmount},null,8,["value"])]),_:1}),t(d,{label:"结算金额"},{default:n(()=>[t(I,{modelValue:a(e).settlementAmount,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).settlementAmount=l),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(c(),p(v,{key:1},[t(d,{label:"指定会员"},{default:n(()=>[t(w,{placeholder:"Select",modelValue:a(f).memberSettlementInfoSelect,"onUpdate:modelValue":o[2]||(o[2]=l=>a(f).memberSettlementInfoSelect=l),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:x},{default:n(()=>[(c(!0),p(v,null,V(a(f).memberSettlementInfoList,l=>(c(),R(k,{key:l.id,value:l.id,label:l.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"最低结算额度"},{default:n(()=>[t(I,{disabled:"",placeholder:"",value:a(e).minimumAmount},null,8,["value"])]),_:1}),(c(!0),p(v,null,V(a(e).addMemberSettlementInfoList,l=>(c(),p(v,null,[t(d,{label:""},{default:n(()=>[O("p",null,S(l.memberId)+" - "+S(l.memberName)+" - 可用余额："+S(l.availableBalance),1)]),_:2},1024),t(d,{label:"结算金额"},{default:n(()=>[t(F,{"controls-position":"right",modelValue:l.settlementAmount,"onUpdate:modelValue":D=>l.settlementAmount=D,max:l.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[T,a(i)]])}}}),$=P(q,[["__scopeId","data-v-ec61e479"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));export{$ as D,M as a,H as i};
