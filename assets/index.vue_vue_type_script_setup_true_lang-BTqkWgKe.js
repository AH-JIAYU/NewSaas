
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-Cn-XphP6.js";import{a as p}from"./user_supplier-CW4UzGsQ.js";import{u as U}from"./stagedData-DHqXY5dn.js";import{U as I}from"./index.vue_vue_type_script_setup_true_lang-D3STLhKw.js";import{d as N,r as f,a0 as z,a1 as m,B as A,a as g,o as h,b as M,f as i,w as r,g as v,e as j,j as F,i as P,al as w,ai as _}from"./index-C5nmrkzE.js";const O=N({__name:"index",emits:["fetch-data"],setup($,{expose:y,emit:T}){const u=U(),c=I(),C=T,l=f(!1),o=f(""),n=f([]);function k(e){n.value.push(e)}z("validateTopTabs",k);let s=m([]);async function D(e){if(!e)o.value="添加",s=u.usersupplier||[w(c.initialTopTabsData)];else{o.value="编辑";const{data:a}=await p.detail({tenantSupplierId:e.tenantSupplierId});S(a)}l.value=!0}function S(e){s.length=0,s.push({...e})}function x(e){const a=new Set;for(const t of e){if(a.has(t.customerAccord))return!0;a.add(t.customerAccord)}return!1}function V(){u.usersupplier=w(s),s=m([]),l.value=!1,n.value=[]}function b(){s=m([]),l.value=!1,n.value=[],o.value==="添加"&&(u.usersupplier=null)}async function B(){const e=[];n.value.forEach(a=>{e.push(a.validate())});try{if((await Promise.all(e)).every(t=>t))if(x(s))_.warning({message:"客户名称重复",center:!0});else{if(o.value==="添加"){const t={addTenantSupplierInfoList:s},{status:d}=await p.create(t);d===1&&_.success({message:"新增成功",center:!0})}else{const{status:t}=await p.edit(s[0]);t===1&&_.success({message:"修改成功",center:!0})}C("fetch-data"),b()}}catch(a){console.error("Form validation failed:",a)}}return A(async()=>{c.customer=[],await c.getCustomerList()}),y({showEdit:D}),(e,a)=>{const t=g("el-button"),d=g("el-drawer");return h(),M("div",null,[i(d,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=E=>l.value=E),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:""},{footer:r(()=>[i(t,{onClick:b},{default:r(()=>[v(" 取消 ")]),_:1}),o.value==="添加"?(h(),j(t,{key:0,type:"warning",onClick:V},{default:r(()=>[v(" 暂存 ")]),_:1})):F("",!0),i(t,{type:"primary",onClick:B},{default:r(()=>[v(" 确定 ")]),_:1})]),default:r(()=>[i(L,{title:o.value,"left-tabs-data":P(s),"validate-top-tabs":n.value},null,8,["title","left-tabs-data","validate-top-tabs"])]),_:1},8,["modelValue"])])}}});export{O as _};
