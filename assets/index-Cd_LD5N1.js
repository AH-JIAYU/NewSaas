
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as T,d as oe,aN as ne,r as c,k as se,a as _,p as re,q as de,o as n,b as y,f as a,w as e,s as S,g as m,F as w,t as x,e as i,H as b,j as V,E as ue,aJ as ie,aK as ce,R as me}from"./index-DmgRXF6j.js";import{a as fe}from"./department-Ch7AqBso.js";import{u as pe}from"./department-BDCzQiHM.js";import{u as _e}from"./configuration_manager-BOxv71ET.js";const ve={list:v=>T.post("team/getGroupTeam",v),create:v=>T.post("team/insertGroupTeam",v),edit:v=>T.post("team/updateGroupTeam",v),delete:v=>T.post("team/deleteGroupTeam",v)},A=v=>(ie("data-v-1e658596"),v=v(),ce(),v),he=A(()=>S("div",{class:"card-header"},[S("span",null,"组长")],-1)),be=A(()=>S("div",{class:"card-header"},[S("span",null,"组员")],-1)),ge={style:{flex:"auto"}},Ie=oe({name:"Edit",__name:"index",emits:["success"],setup(v,{expose:K,emit:ke}){ne();const N=c(),P=c(),J=pe(),k=c(),O=_e(),L=c([]),U=c(""),q=c(),z=c(!1);c([]);const D=c(),E=c(!1),g=c([]),C=c([]),R=c();c({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{chineseName:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),c({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1});const f=c({groupId:null,userInfo:[],menuId:[]}),Q={children:"children",label:"name"},G=c({commission:[{validator:(s,u,t)=>{/^[0-9]*[.]?[0-9]+$/.test(u)?t():t(new Error("请输入有效的数字或小数"))},trigger:"blur"}]});async function W(s){U.value=s!=null&&s.id?"编辑":"新增";const u=JSON.parse(s);f.value.groupId=u.id;const t={page:1,limit:10,groupId:u.id},o=await ve.list(t);R.value=o.data.departmentId;const I=await fe.createEvery();k.value=I.data.result,k.value=k.value.filter(h=>h.id===R.value),o.data.data.forEach(h=>{var d,p;h.isLeader?C.value.push(h):((p=(d=f.value)==null?void 0:d.menuId)==null||p.push(h.memberId),g.value.push(h))}),E.value=!0}se(async()=>{k.value=await J.getDepartment(),L.value=await O.getStaff(),q.value=new Date});function j(s,u){const t=s.findIndex(o=>o.memberId===u);t!==-1&&s.splice(t,1)}function B(s,u){s.some(t=>t.id===u.id)||s.push(u)}function X(s){g.value=g.value.filter(t=>t.id!==s.id),N.value.getNode(s.id).checked?s.children&&s.children.length?s.children.forEach(t=>B(g.value,t)):B(g.value,s):s.children&&s.children.length?s.children.forEach(t=>j(g.value,t.id)):j(g.value,s.id)}function Y(){return new Promise(s=>{D.value&&D.value.validate(u=>{if(u){f.value.userInfo=[];const t=N.value.getCheckedKeys(),o=N.value.getHalfCheckedKeys();t.concat(o),delete f.value.menuId;let I=0;C.value.forEach(d=>{d.commission&&(I+=d.commission);let p={userId:d.id,commission:d.commission};f.value.userInfo.push(p)}),g.value.forEach(d=>{d.commission&&(I+=d.commission);let p;d.memberId?p={userId:d.memberId,commission:d.commission}:p={userId:d.id,commission:d.commission},f.value.userInfo.push(p)});const h=new Set;if(f.value.userInfo=f.value.userInfo.filter(d=>{const{userId:p}=d;return h.has(p)?!1:(h.add(p),!0)}),I>100){ue.warning({message:"提成比例不能超过100",center:!0});return}console.log("groupLeaderList.value",C.value),console.log("dataList.value",g.value),console.log("form.value",f.value),console.log("number",I);return}})})}const Z=()=>{Object.assign(f.value,{groupId:null,userInfo:[],menuId:[]}),C.value=[],g.value=[]};return K({showEdit:W}),(s,u)=>{const t=_("el-table-column"),o=_("el-text"),I=_("el-input"),h=_("el-form-item"),d=_("el-form"),p=_("el-empty"),F=_("el-table"),H=_("el-card"),ee=_("el-tree"),M=_("el-col"),le=_("el-row"),$=_("el-button"),ae=_("el-drawer"),te=re("loading");return de((n(),y("div",null,[a(ae,{modelValue:E.value,"onUpdate:modelValue":u[2]||(u[2]=l=>E.value=l),title:U.value,onClose:Z,size:"60%"},{footer:e(()=>[S("div",ge,[a($,{type:"",onClick:u[1]||(u[1]=l=>E.value=!1)},{default:e(()=>[m(" 取消 ")]),_:1}),a($,{type:"primary",onClick:Y},{default:e(()=>[m(" 确定 ")]),_:1})])]),default:e(()=>[a(H,{class:"box-card"},{header:e(()=>[he]),default:e(()=>[a(F,{data:C.value,border:""},{empty:e(()=>[a(p,{description:"暂无数据"})]),default:e(()=>[a(t,{align:"center",type:"index",label:"序号",width:"80"}),a(t,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"}),a(t,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"用户名"},{default:e(({row:l})=>[l.memberId?(n(!0),y(w,{key:0},x(L.value,r=>(n(),i(o,null,{default:e(()=>[l.memberId===r.id?(n(),i(o,{key:0},{default:e(()=>[m(b(r.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(b(l.name),1)]),_:2},1024))]),_:1}),a(t,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"姓名"},{default:e(({row:l})=>[l.memberId?(n(!0),y(w,{key:0},x(L.value,r=>(n(),i(o,null,{default:e(()=>[l.memberId===r.id?(n(),i(o,{key:0},{default:e(()=>[m(b(r.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(b(l.name),1)]),_:2},1024))]),_:1}),a(t,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:l})=>[(n(!0),y(w,null,x(k.value,r=>(n(),i(o,null,{default:e(()=>[R.value===r.id?(n(),i(o,{key:0},{default:e(()=>[m(b(r.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256))]),_:1}),a(t,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:l})=>[a(d,{model:l,ref_key:"formRef",ref:D,rules:G.value},{default:e(()=>[a(h,{prop:"commission"},{default:e(()=>[a(I,{modelValue:l.commission,"onUpdate:modelValue":r=>l.commission=r,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[m("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1}),a(H,{class:"box-card"},{header:e(()=>[be]),default:e(()=>[a(le,{gutter:20},{default:e(()=>[a(M,{class:"leftData",span:8},{default:e(()=>[a(I,{modelValue:f.value.invoiceAmount,"onUpdate:modelValue":u[0]||(u[0]=l=>f.value.invoiceAmount=l),placeholder:"可输入关键字查找",clearable:""},null,8,["modelValue"]),a(ee,{style:{"max-width":"37.5rem","min-height":"20.125rem","margin-top":"20px"},data:k.value,ref_key:"treeRef",ref:N,"show-checkbox":"","node-key":"id","default-checked-keys":f.value.menuId,"default-expanded-keys":f.value.menuId,"default-expand-all":"",props:Q,onCheck:X},null,8,["data","default-checked-keys","default-expanded-keys"])]),_:1}),a(M,{span:16},{default:e(()=>[a(F,{ref_key:"tableRef",ref:P,data:g.value,border:""},{empty:e(()=>[a(p,{description:"暂无数据"})]),default:e(()=>[a(t,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"},{default:e(({row:l})=>[l.memberId?(n(),i(o,{key:0},{default:e(()=>[m(b(l.memberId),1)]),_:2},1024)):(n(),i(o,{key:1},{default:e(()=>[m(b(l.id),1)]),_:2},1024))]),_:1}),a(t,{align:"center","show-overflow-tooltip":"",prop:"userName",label:"用户名"},{default:e(({row:l})=>[l.memberId?(n(!0),y(w,{key:0},x(L.value,r=>(n(),i(o,null,{default:e(()=>[l.memberId===r.id?(n(),i(o,{key:0},{default:e(()=>[m(b(r.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(b(l.userName?l.userName:"-"),1)]),_:2},1024))]),_:1}),a(t,{align:"center","show-overflow-tooltip":"",prop:"name",label:"姓名"},{default:e(({row:l})=>[l.memberId?(n(!0),y(w,{key:0},x(L.value,r=>(n(),i(o,null,{default:e(()=>[l.memberId===r.id?(n(),i(o,{key:0},{default:e(()=>[m(b(r.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(n(),i(o,{key:1},{default:e(()=>[m(b(l.name),1)]),_:2},1024))]),_:1}),a(t,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:l})=>[(n(!0),y(w,null,x(k.value,r=>(n(),i(o,null,{default:e(()=>[R.value===r.id?(n(),i(o,{key:0},{default:e(()=>[m(b(r.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256))]),_:1}),a(t,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:l})=>[a(d,{model:l,ref_key:"formRef",ref:D,rules:G.value},{default:e(()=>[a(h,{prop:"commission"},{default:e(()=>[a(I,{modelValue:l.commission,"onUpdate:modelValue":r=>l.commission=r,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[m("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])),[[te,z.value]])}}}),Le=me(Ie,[["__scopeId","data-v-1e658596"]]);export{Le as default};
