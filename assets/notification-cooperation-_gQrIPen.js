
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as O,aL as G,r as d,a as c,o as y,b as j,y as u,z as U,i as l,f as o,w as r,g as s,j as w,e as J,A as Q,b8 as I,E as W,_ as X,aH as Y,aI as Z,L as ee}from"./index-CIMs2gPi.js";import{u as ae}from"./index-D8dv6D8d.js";import{a as te}from"./department-CMp3x2mX.js";import"./index-CiXkFC33.js";import"./index-IJaXvYHN.js";const oe=g=>(Y("data-v-4157c794"),g=g(),Z(),g),re={class:"news p-4"},le=oe(()=>u("div",{class:"type"},[u("span"),s(" 合作邀约")],-1)),se={class:"news-content"},ne={class:"content"},ce={class:"time"},ie={key:0,class:"footer"},de={style:{display:"flex"}},ue=O({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(g,{expose:R,emit:V}){const b=V,h=G(),e=d({rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(a,t,i)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return i(new Error("请输入 0 到 100 之间的数字"));i()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),p=d(!1);d([]);const k=d(),S={children:"children",label:"name"},E=async a=>{e.value.chargeUserId="",e.value=a;const t=await te.list({name:""});t.data&&(T.value=t.data),B()},T=d([]);d();const f=d(),A=(a,t)=>{t?(f.value.getCheckedKeys().forEach(m=>{m!==a.id&&f.value.setChecked(m,!1)}),e.value.chargeUserId=a.id,f.value.getCheckedNodes(),e.value.chargeUserName=a.name):(e.value.chargeUserId=[e.value.chargeUserId].filter(i=>i!==a.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="")),e.value.chargeUserId||(e.value.chargeUserName=""),console.log(e.value.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.chargeUserId,"data.value.form.chargeUserId")},B=async()=>{const a={id:e.value.id,type:1};await I.updateTenantAudit(a),await h.getUnreadTodo()},q=async()=>{const a={id:e.value.id,type:2};b("delSelectId"),await I.updateTenantAudit(a),await h.getUnreadTodo()},z=async()=>{k.value.validate(async a=>{if(a){if(Array.isArray(e.value.chargeUserId)&&(e.value.chargeUserId=e.value.chargeUserId[0]),e.value.receiveProjectType==1&&!e.value.chargeUserId){W.warning({message:"请选择部门",center:!0});return}const t={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType[0],receiveProjectType:e.value.receiveProjectType[0]};b("delSelectId"),await I.updateTenantAudit(t),await h.getUnreadTodo()}})},F=d();function $(a){e.value.chargeUserId=a.chargeUserId,e.value.invitationType=a.invitationType,e.value.chargeUserName=a.chargeUserName}const D=a=>{Array.isArray(a)&&a.length>1&&(e.value.sendProjectType=[a[a.length-1]])},K=a=>{Array.isArray(a)&&a.length>1&&(e.value.receiveProjectType=[a[a.length-1]])};return R({showEdit:E}),(a,t)=>{const i=c("el-button"),m=c("el-input"),v=c("el-form-item"),C=X,N=c("el-tooltip"),_=c("el-checkbox"),P=c("el-checkbox-group"),L=c("el-tree-select"),M=c("ElForm"),x=c("ElButton"),H=c("el-dialog");return y(),j("div",re,[le,u("div",se,[u("div",ne,"尊贵的"+U(l(e).beInvitedName),1),u("div",ce," 您好，我是"+U(l(e).invitationName||"-")+"诚挚邀请您与我们一同协作共赢！若有疑问请联系"+U(l(e).phoneOrEmail)+"。 ",1),l(e).auditStatus===1?(y(),j("div",ie,[o(i,{onClick:q},{default:r(()=>[s("拒绝合作")]),_:1}),o(i,{type:"primary",onClick:t[0]||(t[0]=n=>p.value=!0)},{default:r(()=>[s(" 同意合作 ")]),_:1})])):w("",!0)]),o(H,{modelValue:l(p),"onUpdate:modelValue":t[6]||(t[6]=n=>Q(p)?p.value=n:null),title:"添加PM",class:"hezuoDrawer"},{footer:r(()=>[o(x,{size:"large",onClick:t[5]||(t[5]=n=>p.value=!1)},{default:r(()=>[s(" 取消 ")]),_:1}),o(x,{type:"primary",size:"large",onClick:z},{default:r(()=>[s(" 确定 ")]),_:1})]),default:r(()=>[o(M,{ref_key:"FormRef",ref:k,rules:l(e).rules,model:l(e),"label-width":"7rem",labelPosition:"left"},{default:r(()=>[o(v,{label:"价格比例",prop:"priceRatio"},{default:r(()=>[o(m,{modelValue:l(e).priceRatio,"onUpdate:modelValue":t[1]||(t[1]=n=>l(e).priceRatio=n),clearable:""},{append:r(()=>[s("%")]),_:1},8,["modelValue"])]),_:1}),o(v,{label:"项目分配方式","label-width":"7rem"}),o(v,{prop:"sendProjectType","label-width":"7rem"},{label:r(()=>[u("span",null,[o(N,{effect:"dark",content:"1111111",placement:"top-start"},{default:r(()=>[o(C,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),s(" 发送项目 ")])]),default:r(()=>[o(P,{modelValue:l(e).sendProjectType,"onUpdate:modelValue":t[2]||(t[2]=n=>l(e).sendProjectType=n),onChange:D},{default:r(()=>[o(_,{value:1},{default:r(()=>[s(" 自动 ")]),_:1}),o(_,{value:2},{default:r(()=>[s(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u("div",de,[o(v,{prop:"receiveProjectType",style:{"margin-right":"1.5625rem"}},{label:r(()=>[u("span",null,[o(N,{effect:"dark",content:"1111111",placement:"top-start"},{default:r(()=>[o(C,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),s(" 接收项目 ")])]),default:r(()=>[o(P,{modelValue:l(e).receiveProjectType,"onUpdate:modelValue":t[3]||(t[3]=n=>l(e).receiveProjectType=n),onChange:K},{default:r(()=>[o(_,{value:1},{default:r(()=>[s(" 自动 ")]),_:1}),o(_,{value:2},{default:r(()=>[s(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).receiveProjectType==1?(y(),J(L,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:f,modelValue:l(e).chargeUserId,"onUpdate:modelValue":t[4]||(t[4]=n=>l(e).chargeUserId=n),data:l(T),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:S,onCheckChange:A,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):w("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(ae,{ref_key:"userRef",ref:F,onUserData:$},null,512)])}}}),he=ee(ue,[["__scopeId","data-v-4157c794"]]);export{he as default};
