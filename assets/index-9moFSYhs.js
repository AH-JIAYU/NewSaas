
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ce,C as O,ae as me,r as d,ad as fe,D as pe,F as ge,o as ve,a3 as c,al as _e,b as f,c as g,w as l,f as y,g as n,h as V,t as v,i as e,a4 as he,j as Z,P as $,O as H,aj as J,ai as G,z as be}from"./index-D3JQ81m5.js";import{a as ye}from"./department-BK3Ox7Vz.js";import{a as we}from"./position_manage--Pvj7B47.js";import{a as ke}from"./configuration_role-CRUcODEA.js";import{u as Ne}from"./tenant_role-o9dpcflx.js";import{u as xe}from"./configuration_manager-p6wXzaUo.js";const Ve={class:"card-header"},Ce={class:"leftTitle"},Ie={class:"card-header"},Se={class:"leftTitle"},Ee={class:"card-header"},Le={class:"leftTitle"},ze={class:"flex-c"},Ue=ce({__name:"index",props:O(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:O(["success","getList"],["update:modelValue"]),setup(M,{emit:Q}){const{t}=me(),W=xe(),X=d([]),T=d(),Y=fe(),ee=d();Ne();const L=d(),z=d([]),ae=d(!1),q=d(),F=d(),w=M,U=Q,_=d(null),D=pe(M,"modelValue"),le=ge(()=>w.id?t("configuration.user.new.editUser"):t("configuration.user.new.addUser")),te={children:"children",label:"name"},C=d(!1),h=d();d([]);const a=d({id:w.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",roleList:[],role:"",active:!0,positionId:"",organizationalStructureId:""}),b=d([]),oe=(i,o,s)=>{const r=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[\d]))\d{8}$/;a.value.phoneNumber?r.test(a.value.phoneNumber)?s():s(new Error(t("configuration.user.new.enterPhoneNumber"))):s()},ne=(i,o,s)=>{const r=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a.value.email?r.test(a.value.email)?s():s(new Error(t("configuration.user.new.enterEmail"))):s()},I=d({userName:[{required:!0,message:t("configuration.user.new.enterName")}],positionId:[{required:!0,message:t("configuration.user.new.positionSelect"),trigger:"change"}],role:[{required:!0,message:t("configuration.user.new.roleSelect"),trigger:"change"}],password:[{required:!0,trigger:"blur",message:t("configuration.user.new.enterPassword")},{min:6,max:18,trigger:"blur",message:t("configuration.user.new.6to18")}],name:[{required:!0,message:t("configuration.user.new.enterUsername"),trigger:"blur"}],phoneNumber:[{validator:oe,trigger:"blur"}],email:[{validator:ne,trigger:"blur"}]}),re=i=>{Array.isArray(i)&&i.length>1&&(a.value.roleList=[i[i.length-1]])};function se(){var i;if(a.value.email||(I.value.email=[],h.value.clearValidate("email")),a.value.phoneNumber||(I.value.phoneNumber=[],h.value.clearValidate("phoneNumber")),(i=_.value)!=null&&i.getCheckedKeys()){b.value=_.value.getCheckedKeys(!1);const o=_.value.getCheckedKeys(),s=_.value.getHalfCheckedKeys(),r=o.concat(s);a.value.organizationalStructureId=r[0]}a.value.roleList.length>0?a.value.role=a.value.roleList[0]:(a.value.role="",a.value.roleList=[]),a.value.id?h.value&&h.value.validate(o=>{if(o){const{id:s,phoneNumber:r,email:p,password:P,name:B,country:N,active:x,type:R,role:E,positionId:j,organizationalStructureId:K,userName:A}=a.value,m={id:s,phoneNumber:r,email:p,password:P,name:B,country:N,active:x,type:R,role:E,positionId:a.value.positionId?a.value.positionId:"",organizationalStructureId:K,userName:A};F.value===m.phoneNumber&&delete m.phoneNumber,q.value===m.email&&delete m.email,m.password||delete m.password,J.edit(m).then(()=>{G.success({message:t("configuration.user.new.editSuccess"),center:!0}),U("success"),S()})}}):h.value&&h.value.validate(o=>{o&&J.create(a.value).then(()=>{G.success({message:t("configuration.user.new.addSuccess"),center:!0}),U("success"),U("getList"),S()})})}function S(){D.value=!1}const ie=(i,o)=>{o?(_.value.getCheckedKeys().forEach(r=>{r!==i.id&&_.value.setChecked(r,!1)}),b.value=[i.id]):b.value=b.value.filter(s=>s!==i.id)};return ve(async()=>{try{C.value=!0,b.value=[];const{data:i}=await we.list({page:1,limit:10,id:null,name:"",active:null});i&&(T.value=i.data),X.value=await W.getStaff();const o=await ke.list({id:null,name:""});o.data&&(L.value=o.data);const s=await ye.list({name:""});if(s.data&&(z.value=s.data),ee.value=await Y.getCountry(),a.value.roleList=[],w.id!==""&&w.row){I.value.password=[],a.value=JSON.parse(w.row),a.value.roleList=[a.value.role];const r=a.value.organizationalStructureId;r&&(b.value=Array.isArray(r)?r:[r]),q.value=a.value.email,F.value=a.value.phoneNumber,ae.value=!0}C.value=!1}catch{}finally{C.value=!1}}),(i,o)=>{const s=c("el-input"),r=c("el-form-item"),p=c("el-col"),P=c("el-option"),B=c("el-select"),N=c("el-row"),x=c("el-card"),R=c("el-tree"),E=c("el-text"),j=c("el-checkbox"),K=c("el-checkbox-group"),A=c("ElForm"),m=c("ElButton"),ue=c("ElDrawer"),de=_e("loading");return f(),g(ue,{modelValue:D.value,"onUpdate:modelValue":o[7]||(o[7]=u=>D.value=u),title:e(le),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:l(()=>[y("div",ze,[n(m,{size:"large",onClick:S},{default:l(()=>[V(v(e(t)("common.cancel")),1)]),_:1}),n(m,{type:"primary",size:"large",onClick:se},{default:l(()=>[V(v(e(t)("common.confirm")),1)]),_:1})])]),default:l(()=>[he((f(),g(A,{ref_key:"formRef",ref:h,model:e(a),rules:e(I),"label-width":"100px","validate-on-rule-change":!1},{default:l(()=>[n(x,{class:"box-card"},{header:l(()=>[y("div",Ve,[y("div",Ce,v(e(t)("configuration.user.detail.basicInformation")),1)])]),default:l(()=>[n(N,{gutter:24},{default:l(()=>[n(p,{span:8},{default:l(()=>[n(r,{label:e(t)("configuration.user.username"),prop:"userName"},{default:l(()=>[n(s,{modelValue:e(a).userName,"onUpdate:modelValue":o[0]||(o[0]=u=>e(a).userName=u),maxlength:20,placeholder:e(t)("configuration.user.new.enterUsername"),clearable:"",disabled:!!w.id},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"])]),_:1}),n(p,{span:8},{default:l(()=>[n(r,{label:e(t)("configuration.user.name"),prop:""},{default:l(()=>[n(s,{modelValue:e(a).name,"onUpdate:modelValue":o[1]||(o[1]=u=>e(a).name=u),placeholder:e(t)("configuration.user.new.name"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(p,{span:8},{default:l(()=>[n(r,{label:e(t)("configuration.user.detail.phoneNumber"),prop:"phoneNumber"},{default:l(()=>[n(s,{modelValue:e(a).phoneNumber,"onUpdate:modelValue":o[2]||(o[2]=u=>e(a).phoneNumber=u),placeholder:e(t)("configuration.user.new.phoneNumber"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(p,{span:8},{default:l(()=>[n(r,{label:e(t)("configuration.user.email"),prop:"email"},{default:l(()=>[n(s,{modelValue:e(a).email,"onUpdate:modelValue":o[3]||(o[3]=u=>e(a).email=u),placeholder:e(t)("configuration.user.new.email"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(p,{span:8},{default:l(()=>[n(r,{label:e(t)("configuration.user.position"),prop:""},{default:l(()=>[n(B,{modelValue:e(a).positionId,"onUpdate:modelValue":o[4]||(o[4]=u=>e(a).positionId=u),placeholder:e(t)("configuration.user.new.positionSelect"),clearable:"",filterable:"",onChange:o[5]||(o[5]=()=>{})},{default:l(()=>[(f(!0),Z(H,null,$(e(T),u=>(f(),g(P,{key:u.id,label:u.name,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(p,{span:8},{default:l(()=>[n(r,{label:e(t)("configuration.user.new.initialPassword"),prop:""},{default:l(()=>[n(s,{clearable:"",value:"123456",disabled:""})]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),n(x,{class:"box-card"},{header:l(()=>[y("div",Ie,[y("div",Se,v(e(t)("configuration.user.detail.departtmentInformation")),1)])]),default:l(()=>[n(N,{gutter:24},{default:l(()=>[n(r,{label:e(t)("configuration.user.detail.assignDepartments")},{default:l(()=>[e(z).length>0?(f(),g(R,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:_,data:e(z),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":e(b),"default-expand-all":"",props:te,onCheckChange:ie},null,8,["data","default-checked-keys"])):(f(),g(E,{key:1},{default:l(()=>[V(v(e(t)("common.nodata")),1)]),_:1}))]),_:1},8,["label"])]),_:1})]),_:1}),n(x,{class:"box-card"},{header:l(()=>[y("div",Ee,[y("div",Le,v(e(t)("configuration.user.detail.roleInformation")),1)])]),default:l(()=>[n(N,{gutter:24},{default:l(()=>[n(r,{label:e(t)("configuration.user.detail.assignRoles"),prop:"z"},{default:l(()=>{var u;return[(u=e(L))!=null&&u.length?(f(),g(K,{key:0,style:{"margin-left":"1.5rem"},modelValue:e(a).roleList,"onUpdate:modelValue":o[6]||(o[6]=k=>e(a).roleList=k),onChange:re},{default:l(()=>[(f(!0),Z(H,null,$(e(L),k=>(f(),g(j,{key:k.id,label:k.roleName,value:k.roleName},{default:l(()=>[V(v(k.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):(f(),g(E,{key:1},{default:l(()=>[V(v(e(t)("common.nodata")),1)]),_:1}))]}),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[de,e(C)]])]),_:1},8,["modelValue","title"])}}}),Me=be(Ue,[["__scopeId","data-v-913f1498"]]);export{Me as default};
