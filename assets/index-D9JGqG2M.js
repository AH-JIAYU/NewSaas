
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as w,r as m,a as s,o as b,b as J,f as r,w as a,g as i,i as l,y as v,e as K,j as O,A as $,_ as z,aH as H,aI as L,E as M,L as G}from"./index-D2mxR2r5.js";import{c as U}from"./user_cooperation-DagDscaa.js";import{u as Q}from"./index-Ct_BvCIg.js";import"./index-XuqAS12h.js";import"./index-BRnTwaka.js";import"./department-CP-Ae3Xv.js";const W=p=>(H("data-v-edb885b1"),p=p(),L(),p),X=W(()=>v("span",{style:{"font-weight":"700","font-size":"15px"}},"项目分配方式",-1)),Y={style:{display:"flex"},class:"inviteDialog"},Z=w({__name:"index",emits:["fetch-data"],setup(p,{expose:I,emit:x}){const N=x,c=m(!1),g=m(),e=m({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(o,t,u)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return u(new Error("请输入 0 到 100 之间的数字"));u()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}});m([]);async function k(o){e.value.form.id=o.id,e.value.form.priceRatio=o.priceRatio,e.value.form.sendProjectType=o.sendProjectType?[o.sendProjectType]:null,e.value.form.receiveProjectType=o.receiveProjectType?[o.receiveProjectType]:null,e.value.form.chargeUserName=o.userName,e.value.form.invitationType=o.invitationType,e.value.form.chargeUserId=o.userId,c.value=!0}function y(){c.value=!1,e.value.form={},g.value.resetFields()}const _=m();function R(){_.value.showEdit(e.value.form,"请选择负责部门/人")}async function C(o){await U.updateInvitationBindUser({id:e.value.form.id,chargeUserId:o.chargeUserId,invitationType:o.invitationType,chargeUserName:o.chargeUserName,sendProjectType:o.sendProjectType,receiveProjectType:o.receiveProjectType})}async function V(){await U.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio}),M.success({message:"修改成功",center:!0})}async function E(){g.value.validate(o=>{if(o){let t=JSON.parse(JSON.stringify(e.value.form));t.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,t.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,t.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",e.value.form.departmentId="",t.chargeUserId=null,t.chargeUserName="",t.invitationType=""),C(t),V(),N("fetch-data"),y()}})}const S=o=>{Array.isArray(o)&&o.length>1&&(e.value.form.sendProjectType=[o[o.length-1]])},B=o=>{Array.isArray(o)&&o.length>1&&(e.value.form.receiveProjectType=[o[o.length-1]])};function A(o){e.value.form.chargeUserId=o.chargeUserId,e.value.form.invitationType=o.invitationType,e.value.form.chargeUserName=o.chargeUserName}const D=o=>{o.preventDefault()};return I({showEdit:k}),(o,t)=>{const u=s("el-input"),d=s("el-form-item"),h=z,T=s("el-tooltip"),f=s("el-checkbox"),P=s("el-checkbox-group"),q=s("ElForm"),j=s("el-button"),F=s("el-dialog");return b(),J("div",null,[r(F,{modelValue:l(c),"onUpdate:modelValue":t[4]||(t[4]=n=>$(c)?c.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置"},{footer:a(()=>[r(j,{onClick:y},{default:a(()=>[i(" 关闭 ")]),_:1}),r(j,{type:"primary",onClick:E},{default:a(()=>[i(" 确认 ")]),_:1})]),default:a(()=>[r(q,{ref_key:"formRef",ref:g,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left"},{default:a(()=>[r(d,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[r(u,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":t[0]||(t[0]=n=>l(e).form.priceRatio=n),clearable:""},{append:a(()=>[i("%")]),_:1},8,["modelValue"])]),_:1}),r(d,{"label-width":"7rem"},{label:a(()=>[X]),_:1}),v("div",Y,[r(d,{prop:"sendProjectType","label-width":"7rem"},{label:a(()=>[v("span",null,[r(T,{effect:"dark",content:"",placement:"top-start"},{default:a(()=>[r(h,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),i(" 发送项目 ")])]),default:a(()=>[r(P,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":t[1]||(t[1]=n=>l(e).form.sendProjectType=n),onChange:S},{default:a(()=>[r(f,{value:1},{default:a(()=>[i(" 自动 ")]),_:1}),r(f,{value:2},{default:a(()=>[i(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"receiveProjectType",style:{"margin-left":"40px"}},{label:a(()=>[v("span",null,[r(T,{effect:"dark",content:"",placement:"top-start"},{default:a(()=>[r(h,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),i(" 接收项目 ")])]),default:a(()=>[r(P,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":t[2]||(t[2]=n=>l(e).form.receiveProjectType=n),onChange:B},{default:a(()=>[r(f,{value:1},{default:a(()=>[i(" 自动 ")]),_:1}),r(f,{value:2},{default:a(()=>[i(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(e).form.receiveProjectType&&l(e).form.receiveProjectType[0]==1?(b(),K(u,{key:0,placeholder:"请选择接收项目负责人",onKeydown:D,onClick:R,modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":t[3]||(t[3]=n=>l(e).form.chargeUserName=n)},null,8,["modelValue"])):O("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),r(Q,{ref_key:"userRef",ref:_,onUserData:A},null,512)])}}}),ie=G(Z,[["__scopeId","data-v-edb885b1"]]);export{ie as default};
