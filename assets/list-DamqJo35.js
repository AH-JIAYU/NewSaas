
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ie,O as ue,aK as me,y as ce,r as V,k as pe,G as A,J as de,a as r,p as be,o as i,b as E,f as a,w as n,i as t,az as B,F as H,t as fe,e as c,g as u,H as f,I as ge,q as _e,j as d,S as he,aL as ve,E as N,N as ke,aM as ye,aN as we,ba as Ce,ap as Le,aG as Se,aH as Ee,s as Ie,R as Me}from"./index-BMr8ipAC.js";import{_ as ze}from"./index.vue_vue_type_style_index_0_lang-CGcKD7S1.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-BsfC8ruC.js";import{_ as Te}from"./index.vue_vue_type_script_setup_true_lang-GyjUtAVl.js";import{a as I}from"./index-wxRi8uOO.js";import{u as Ve}from"./useTabbar-CS5S-xu8.js";const Ae=k=>(Se("data-v-fd44a6a1"),k=k(),Ee(),k),Be=Ae(()=>Ie("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),He=ie({name:"billManagement",__name:"list",setup(k){const P=ue(),{pagination:g,getParams:$,onSizeChange:D,onCurrentChange:F,onSortChange:U}=me(),R=Ve(),M=ce(),y=V([{label:"会员ID/姓名",prop:"memberId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税",prop:"taxesFees",sortable:!0,checked:!0},{label:"实际金额",prop:"payAmount",sortable:!0,checked:!0},{label:"支付时间",prop:"payTime",sortable:!0,checked:!0},{label:"说明",prop:"notes",sortable:!0,checked:!0},{label:"账单状态",prop:"billStatus",sortable:!0,checked:!0}]),e=V({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],formMode:"dialog",formModeProps:{visible:!1,id:""},search:{memberId:"",memberName:"",member:"",billStatus:""},billStatusList:["待支付","已支付","已拒绝"],batch:{enable:!1,selectionDataList:[]},dataList:[]});pe(()=>{y.value.forEach(s=>{s.checked&&e.value.checkList.push(s.prop)}),p(),e.value.formMode==="router"&&A.on("get-data-list",()=>{p()})}),de(()=>{e.value.formMode==="router"&&A.off("get-data-list")});function p(){try{e.value.loading=!0;const s={...$(),...e.value.search};e.value.search.member&&(/^\d+$/.test(s.member)?s.memberId=s.member:s.memberName=s.member),I.list(s).then(o=>{e.value.loading=!1,e.value.dataList=o.data.memberBillInfoList,g.value.total=o.data.total})}catch{}finally{e.value.loading=!1}}function K(){Object.assign(e.value.search,{memberId:"",memberName:"",member:"",billStatus:""}),p()}function O(s){D(s).then(()=>p())}function _(s=1){F(s).then(()=>p())}function j({prop:s,order:o}){U(s,o).then(()=>p())}function G(){e.value.formMode==="router"?M.settings.tabbar.enable&&M.settings.tabbar.mergeTabsBy!=="activeMenu"?R.open({name:"routerName"}):P.push({name:"routerName"}):(e.value.formModeProps.id="",e.value.formModeProps.visible=!0)}async function z(s,o){o===2?ve.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async h=>{(await I.changestatus({id:s,type:o,notes:h.value})).status===1&&N.success({message:"操作成功"}),p()}):((await I.changestatus({id:s,type:o})).status===1&&N.success({message:"操作成功"}),p())}return(s,o)=>{const h=r("ElInput"),v=r("ElFormItem"),q=r("el-option"),J=r("el-select"),x=ke,C=r("ElButton"),Q=r("ElForm"),W=xe,X=r("ElDivider"),w=r("el-button"),Y=ze,Z=ye,ee=we,te=r("el-row"),T=r("el-table-column"),b=r("ElTableColumn"),L=Ce,oe=r("el-empty"),le=r("ElTable"),ae=r("ElPagination"),ne=Le,se=be("loading");return i(),E("div",{class:he({"absolute-container":t(e).tableAutoHeight})},[a(ne,null,{default:n(()=>[a(W,{"show-toggle":!1},{default:n(({fold:l,toggle:S})=>[a(Q,{model:t(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:n(()=>[a(v,null,{default:n(()=>[a(h,{modelValue:t(e).search.memberId,"onUpdate:modelValue":o[0]||(o[0]=m=>t(e).search.memberId=m),placeholder:"会员ID",clearable:"",onKeydown:o[1]||(o[1]=B(m=>_(),["enter"]))},null,8,["modelValue"])]),_:1}),a(v,null,{default:n(()=>[a(h,{modelValue:t(e).search.memberName,"onUpdate:modelValue":o[2]||(o[2]=m=>t(e).search.memberName=m),placeholder:"会员姓名",clearable:"",onKeydown:o[3]||(o[3]=B(m=>_(),["enter"]))},null,8,["modelValue"])]),_:1}),a(v,null,{default:n(()=>[a(J,{modelValue:t(e).search.billStatus,"onUpdate:modelValue":o[4]||(o[4]=m=>t(e).search.billStatus=m),"value-key":"",placeholder:"账单状态",clearable:"",filterable:"",onChange:o[5]||(o[5]=m=>_())},{default:n(()=>[(i(!0),E(H,null,fe(t(e).billStatusList,(m,re)=>(i(),c(q,{key:m,value:re+1,label:m},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,null,{default:n(()=>[a(C,{type:"primary",onClick:o[6]||(o[6]=m=>_())},{icon:n(()=>[a(x,{name:"i-ep:search"})]),default:n(()=>[u(" 筛选 ")]),_:1}),a(C,{onClick:K},{icon:n(()=>[Be]),default:n(()=>[u(" 重置 ")]),_:1}),a(C,{disabled:"",link:"",onClick:S},{icon:n(()=>[a(x,{name:l?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:n(()=>[u(" "+f(l?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(X,{"border-style":"dashed"}),a(te,null,{default:n(()=>[a(Y,null,{default:n(()=>[a(w,{size:"default",type:"primary",onClick:G},{default:n(()=>[u(" 新增结算 ")]),_:1})]),_:1}),a(ee,null,{default:n(()=>[a(w,{size:"default"},{default:n(()=>[u(" 导出 ")]),_:1}),a(Z,{border:t(e).border,"onUpdate:border":o[7]||(o[7]=l=>t(e).border=l),tableAutoHeight:t(e).tableAutoHeight,"onUpdate:tableAutoHeight":o[8]||(o[8]=l=>t(e).tableAutoHeight=l),checkList:t(e).checkList,"onUpdate:checkList":o[9]||(o[9]=l=>t(e).checkList=l),columns:t(y),"onUpdate:columns":o[10]||(o[10]=l=>ge(y)?y.value=l:null),"line-height":t(e).lineHeight,"onUpdate:lineHeight":o[11]||(o[11]=l=>t(e).lineHeight=l),stripe:t(e).stripe,"onUpdate:stripe":o[12]||(o[12]=l=>t(e).stripe=l),style:{"margin-left":"12px"},onQueryData:p},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),_e((i(),c(le,{border:t(e).border,size:t(e).lineHeight,stripe:t(e).stripe,class:"my-4",data:t(e).dataList,"highlight-current-row":"",height:"100%",onSortChange:j,onSelectionChange:o[13]||(o[13]=l=>t(e).batch.selectionDataList=l)},{empty:n(()=>[a(oe,{description:"暂无数据"})]),default:n(()=>[a(T,{align:"center",type:"selection"}),t(e).checkList.includes("memberId")?(i(),c(b,{key:0,"show-overflow-tooltip":"",align:"center",prop:"",label:"会员ID/姓名",width:"250"},{default:n(({row:l})=>[u(f(l.memberId)+"/ "+f(l.memberName),1)]),_:1})):d("",!0),t(e).checkList.includes("billTime")?(i(),c(b,{key:1,"show-overflow-tooltip":"",align:"center",prop:"billTime",label:"账单日期"})):d("",!0),t(e).checkList.includes("billAmount")?(i(),c(b,{key:2,"show-overflow-tooltip":"",align:"center",prop:"billAmount",label:"账单金额"},{default:n(({row:l})=>[a(L),u(f(l.billAmount||0),1)]),_:1})):d("",!0),t(e).checkList.includes("taxesFees")?(i(),c(b,{key:3,"show-overflow-tooltip":"",align:"center",prop:"taxesFees",label:"税"},{default:n(({row:l})=>[a(L),u(f(l.taxesFees||0),1)]),_:1})):d("",!0),t(e).checkList.includes("payAmount")?(i(),c(b,{key:4,"show-overflow-tooltip":"",align:"center",prop:"payAmount",label:"实际金额"},{default:n(({row:l})=>[a(L),u(f(l.payAmount||0),1)]),_:1})):d("",!0),t(e).checkList.includes("payTime")?(i(),c(b,{key:5,"show-overflow-tooltip":"",align:"center",prop:"payTime",label:"支付时间"})):d("",!0),t(e).checkList.includes("notes")?(i(),c(b,{key:6,"show-overflow-tooltip":"",align:"center",prop:"notes",label:"说明"},{default:n(({row:l})=>[u(f(l.notes?l.notes:"-"),1)]),_:1})):d("",!0),t(e).checkList.includes("billStatus")?(i(),c(b,{key:7,align:"center","show-overflow-tooltip":"",prop:"",label:"账单状态"},{default:n(({row:l})=>[u(f(t(e).billStatusList[l.billStatus-1]),1)]),_:1})):d("",!0),a(T,{align:"center",prop:"i",label:"操作",fixed:"right","show-overflow-tooltip":"",width:"260"},{default:n(({row:l})=>[l.billStatus===1?(i(),E(H,{key:0},[a(w,{size:"small",plain:"",type:"primary",onClick:S=>z(l.id,1)},{default:n(()=>[u(" 支付 ")]),_:2},1032,["onClick"]),a(w,{size:"small",plain:"",type:"danger",onClick:S=>z(l.id,2)},{default:n(()=>[u(" 拒绝支付 ")]),_:2},1032,["onClick"])],64)):d("",!0)]),_:1})]),_:1},8,["border","size","stripe","data"])),[[se,t(e).loading]]),a(ae,{"current-page":t(g).page,total:t(g).total,"page-size":t(g).size,"page-sizes":t(g).sizes,layout:t(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:O,onCurrentChange:_},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),t(e).formMode==="dialog"||t(e).formMode==="drawer"?(i(),c(Te,{key:0,id:t(e).formModeProps.id,modelValue:t(e).formModeProps.visible,"onUpdate:modelValue":o[14]||(o[14]=l=>t(e).formModeProps.visible=l),mode:t(e).formMode,onSuccess:p},null,8,["id","modelValue","mode"])):d("",!0)],2)}}}),Re=Me(He,[["__scopeId","data-v-fd44a6a1"]]);export{Re as default};
