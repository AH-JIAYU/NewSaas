
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as k,d as ye,r as d,a1 as be,al as Ve,k as we,a as i,p as Ee,q as xe,i as a,o as f,b as C,f as t,w as s,S as he,I as S,bh as Pe,s as U,F as D,t as L,e as _,j as F,g as I,E as y,a0 as Ie,aJ as Ue,aK as Ne,R as ke,an as M}from"./index-lJjzSOFx.js";const $={list:()=>k.post("user/getUserInfo"),edit:v=>k.post("user/update",v),uploadAvatar:v=>k.post("user/uploadAvatar",v)},R=v=>(Ue("data-v-93ed20d1"),v=v(),Ne(),v),Ce=R(()=>U("h2",null,"个人信息",-1)),Se=R(()=>U("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Fe=["src"],Re=R(()=>U("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),G=ye({name:"personalSetting",__name:"setting",emits:["success"],setup(v,{expose:J,emit:Z}){const w=d(!1),H=be(),T=Z,K="http://47.96.98.102:9100user/uploadAvatar",Y=Ve(),B=d([]),c=d(!1),q=d(!1),b=d(!1),Q=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],E=d(),x=d(),e=d({type:"company",name:"",phone:"",email:"",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),m=d({oldPassword:"",password:"",confirmPassword:""}),W=d({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,l,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?n():n(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,l,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?n():n(new Error("请输入合法手机号"))},trigger:"blur"}]}),X=d({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(r,l,n)=>{l===m.value.oldPassword?n(new Error("新密码不能与旧密码一致")):n()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(r,l,n)=>{l!==m.value.password?n(new Error("两次输入的密码不一致")):n()},trigger:"blur"}]}),z=r=>{(r!==e.value.phone||r!==e.value.email)&&(q.value=!0)};function ee(){E.value&&E.value.validate(async r=>{if(r){if(c.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,q.value||(delete e.value.phone,delete e.value.email),(await $.edit(e.value)).status===-1)return y.warning({message:"修改失败",center:!0});T("success"),c.value=!1,y.success({message:"修改成功",center:!0}),V()}})}const le=H.token,ae=d({Token:le}),j=d(""),h=d(!1),g=d([]),te=async()=>{w.value=!1,y.success({message:"删除成功",center:!0})},oe=(r,l)=>{console.log("上传成功",r,l),r.status===-1?(Ie.error(r.error,{zIndex:2e3}),g.value=g.value.filter(n=>n.name!==l.name)):w.value=!0},se=async()=>{y.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},re=r=>{j.value=r.url,h.value=!0},ne=()=>{x.value&&x.value.validate(async r=>{if(r)try{if(c.value=!0,delete m.value.confirmPassword,(await $.edit(m.value)).status===-1)return y.warning({message:"修改失败",center:!0});T("success"),c.value=!1,y.success({message:"修改成功",center:!0}),V()}catch{}finally{c.value=!1}})};async function ue(r){e.value=r,g.value.push({name:"file",url:e.value.avatar}),e.value.avatar!==""&&(w.value=!0),b.value=!0}function V(){E.value.resetFields(),x.value.resetFields(),Object.assign(e,{}),g.value=[],Object.assign(m,{}),b.value=!1}return we(async()=>{try{c.value=!0,B.value=await Y.getCountry(),c.value=!1}catch{}finally{c.value=!1}}),J({showEdit:ue}),(r,l)=>{const n=i("el-icon"),N=i("el-upload"),de=i("el-dialog"),u=i("ElFormItem"),p=i("ElInput"),ie=i("ElOption"),me=i("ElSelect"),ce=i("el-option"),pe=i("el-select"),fe=i("el-switch"),P=i("ElButton"),O=i("ElForm"),A=i("ElTabPane"),ve=i("ElTabs"),ge=i("el-drawer"),_e=Ee("loading");return xe((f(),C("div",null,[t(ge,{modelValue:a(b),"onUpdate:modelValue":l[14]||(l[14]=o=>S(b)?b.value=o:null),title:"修改用户信息",direction:"rtl","before-close":V,style:{height:"100%"},size:"40%"},{default:s(()=>[t(ve,{"tab-position":"left"},{default:s(()=>[t(A,{label:"个人信息",class:"basic"},{default:s(()=>[Ce,t(O,{ref_key:"userFormRef",ref:E,model:a(e),rules:a(W),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:s(()=>[t(u,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[t(N,{class:he({hide_box:a(w)}),"file-list":a(g),"onUpdate:fileList":l[0]||(l[0]=o=>S(g)?g.value=o:null),headers:a(ae),action:K,"list-type":"picture-card",limit:1,"on-preview":re,"on-remove":te,"on-success":oe,"on-exceed":se},{tip:s(()=>[Se]),default:s(()=>[t(n,{class:"el-icon--upload"},{default:s(()=>[t(a(Pe))]),_:1})]),_:1},8,["class","file-list","headers"]),t(de,{modelValue:a(h),"onUpdate:modelValue":l[1]||(l[1]=o=>S(h)?h.value=o:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[U("img",{"w-full":"",src:a(j),alt:"Preview Image"},null,8,Fe)]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"用户名"},{default:s(()=>[t(p,{disabled:"",modelValue:a(e).name,"onUpdate:modelValue":l[2]||(l[2]=o=>a(e).name=o),placeholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),t(u,{label:"国家"},{default:s(()=>[t(me,{modelValue:a(e).country,"onUpdate:modelValue":l[3]||(l[3]=o=>a(e).country=o),disabled:""},{default:s(()=>[(f(!0),C(D,null,L(a(B),o=>(f(),_(ie,{label:o.chineseName,value:o.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),t(u,{prop:"",label:"货币类型"},{default:s(()=>[t(pe,{modelValue:a(e).currencyType,"onUpdate:modelValue":l[4]||(l[4]=o=>a(e).currencyType=o),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(f(),C(D,null,L(Q,o=>t(ce,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(e).type==="company"?(f(),_(u,{key:0,label:"公司名称"},{default:s(()=>[t(p,{modelValue:a(e).companyName,"onUpdate:modelValue":l[5]||(l[5]=o=>a(e).companyName=o),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):F("",!0),a(e).type==="company"?(f(),_(u,{key:1,label:"公司税号"},{default:s(()=>[t(p,{modelValue:a(e).taxId,"onUpdate:modelValue":l[6]||(l[6]=o=>a(e).taxId=o),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):F("",!0),a(e).type==="company"?(f(),_(u,{key:2,label:"法人姓名"},{default:s(()=>[t(p,{modelValue:a(e).legalPersonName,"onUpdate:modelValue":l[7]||(l[7]=o=>a(e).legalPersonName=o),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):F("",!0),a(e).country==="CN"?(f(),_(u,{key:3,prop:"phone",label:"手机号码"},{default:s(()=>[t(p,{modelValue:a(e).phone,"onUpdate:modelValue":l[8]||(l[8]=o=>a(e).phone=o),placeholder:"请输入你的手机号码",disabled:"",onChange:z},null,8,["modelValue"])]),_:1})):(f(),_(u,{key:4,prop:"email",label:"电子邮箱"},{default:s(()=>[t(p,{modelValue:a(e).email,"onUpdate:modelValue":l[9]||(l[9]=o=>a(e).email=o),placeholder:"请输入你的电子邮箱",disabled:"",onChange:z},null,8,["modelValue"])]),_:1})),t(u,{prop:"isInvitation",label:"合作邀约"},{default:s(()=>[t(fe,{modelValue:a(e).isInvitation,"onUpdate:modelValue":l[10]||(l[10]=o=>a(e).isInvitation=o),"inline-prompt":"","active-text":"启用","inactive-text":"禁用","active-value":2,"inactive-value":1},null,8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(P,{onClick:ee,type:"primary"},{default:s(()=>[I(" 保存 ")]),_:1}),t(P,{onClick:V,type:"primary"},{default:s(()=>[I(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(A,{label:"账户管理",class:"security"},{default:s(()=>[Re,t(O,{ref_key:"accountFormRef",ref:x,model:a(m),rules:a(X),"label-width":"120px","label-suffix":"："},{default:s(()=>[t(u,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[t(p,{modelValue:a(m).oldPassword,"onUpdate:modelValue":l[11]||(l[11]=o=>a(m).oldPassword=o),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),t(u,{prop:"password",label:"新密码"},{default:s(()=>[t(p,{modelValue:a(m).password,"onUpdate:modelValue":l[12]||(l[12]=o=>a(m).password=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),t(u,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[t(p,{modelValue:a(m).confirmPassword,"onUpdate:modelValue":l[13]||(l[13]=o=>a(m).confirmPassword=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(P,{onClick:ne,type:"primary"},{default:s(()=>[I(" 保存 ")]),_:1}),t(P,{onClick:V,type:"primary"},{default:s(()=>[I(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[_e,a(c)]])}}});typeof M=="function"&&M(G);const Te=ke(G,[["__scopeId","data-v-93ed20d1"]]),je=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{$ as a,je as b,Te as s};
