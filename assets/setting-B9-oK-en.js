
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as C,d as _e,r as u,a1 as Ve,ao as we,k as Ee,a as d,p as xe,q as Pe,i as l,o as m,b as U,f as o,w as s,S as he,I as S,bh as Ue,s as I,F,t as R,e as g,j as T,g as k,E as b,aJ as ke,aK as Ie,R as Ne,ap as G}from"./index-Ke106btl.js";const J={list:()=>C.post("user/getUserInfo"),edit:v=>C.post("user/update",v),uploadAvatar:v=>C.post("user/uploadAvatar",v)},B=v=>(ke("data-v-f2020971"),v=v(),Ie(),v),Ce=B(()=>I("h2",null,"个人信息",-1)),Se=B(()=>I("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Fe=["src"],Re=B(()=>I("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),Z=_e({name:"personalSetting",__name:"setting",emits:["success"],setup(v,{expose:H,emit:K}){const w=u(!1),Y=Ve(),q=K,Q="http://47.96.98.102:9100/user/uploadAvatar",W=we(),j=u([]),f=u(!1),z=u(!1),y=u(!1),X=[{label:"公司",value:"company"}],ee=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],E=u(),x=u(),e=u({type:"company",name:"",phone:"",email:"",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),p=u({oldPassword:"",password:"",confirmPassword:""}),le=u({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(n,t,i)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?i():i(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(n,t,i)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?i():i(new Error("请输入合法手机号"))},trigger:"blur"}]}),ae=u({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(n,t,i)=>{t===p.value.oldPassword?i(new Error("新密码不能与旧密码一致")):i()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(n,t,i)=>{t!==p.value.password?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]}),O=n=>{(n!==e.value.phone||n!==e.value.email)&&(z.value=!0)};function te(){E.value&&E.value.validate(async n=>{if(n){if(f.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,z.value||(delete e.value.phone,delete e.value.email),(await J.edit(e.value)).status===-1)return b.warning({message:"修改失败",center:!0});q("success"),f.value=!1,b.success({message:"修改成功",center:!0}),V()}})}const oe=Y.token,se=u({Token:oe}),A=u(""),P=u(!1),_=u([]),re=async()=>{w.value=!1,b.success({message:"删除成功",center:!0})},ne=()=>{w.value=!0},ue=async()=>{b.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},de=n=>{A.value=n.url,P.value=!0},ie=()=>{x.value&&x.value.validate(async n=>{if(n){if(f.value=!0,delete p.value.confirmPassword,(await J.edit(p.value)).status===-1)return b.warning({message:"修改失败",center:!0});q("success"),f.value=!1,b.success({message:"修改成功",center:!0}),V()}})};async function pe(n){e.value=n,_.value.push({name:"file",url:e.value.avatar}),e.value.avatar!==""&&(w.value=!0),y.value=!0}function V(){E.value.resetFields(),x.value.resetFields(),Object.assign(e,{}),_.value=[],Object.assign(p,{}),y.value=!1}return Ee(async()=>{f.value=!0,j.value=await W.getCountry(),f.value=!1}),H({showEdit:pe}),(n,t)=>{const i=d("el-icon"),N=d("el-upload"),me=d("el-dialog"),r=d("ElFormItem"),D=d("el-option"),L=d("el-select"),c=d("ElInput"),ce=d("ElOption"),ve=d("ElSelect"),fe=d("el-switch"),h=d("ElButton"),M=d("ElForm"),$=d("ElTabPane"),ge=d("ElTabs"),be=d("el-drawer"),ye=xe("loading");return Pe((m(),U("div",null,[o(be,{modelValue:l(y),"onUpdate:modelValue":t[15]||(t[15]=a=>S(y)?y.value=a:null),title:"修改用户信息",direction:"rtl","before-close":V,style:{height:"100%"},size:"40%"},{default:s(()=>[o(ge,{"tab-position":"left"},{default:s(()=>[o($,{label:"个人信息",class:"basic"},{default:s(()=>[Ce,o(M,{ref_key:"userFormRef",ref:E,model:l(e),rules:l(le),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:s(()=>[o(r,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[o(N,{class:he({hide_box:l(w)}),"file-list":l(_),"onUpdate:fileList":t[0]||(t[0]=a=>S(_)?_.value=a:null),headers:l(se),action:Q,"list-type":"picture-card",limit:1,"on-preview":de,"on-remove":re,"on-success":ne,"on-exceed":ue},{tip:s(()=>[Se]),default:s(()=>[o(i,{class:"el-icon--upload"},{default:s(()=>[o(l(Ue))]),_:1})]),_:1},8,["class","file-list","headers"]),o(me,{modelValue:l(P),"onUpdate:modelValue":t[1]||(t[1]=a=>S(P)?P.value=a:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[I("img",{"w-full":"",src:l(A),alt:"Preview Image"},null,8,Fe)]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"账户类型"},{default:s(()=>[o(L,{modelValue:l(e).type,"onUpdate:modelValue":t[2]||(t[2]=a=>l(e).type=a),"value-key":"",placeholder:"账户类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(m(),U(F,null,R(X,a=>o(D,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"用户名"},{default:s(()=>[o(c,{disabled:"",modelValue:l(e).name,"onUpdate:modelValue":t[3]||(t[3]=a=>l(e).name=a),placeholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),o(r,{label:"国家"},{default:s(()=>[o(ve,{modelValue:l(e).country,"onUpdate:modelValue":t[4]||(t[4]=a=>l(e).country=a),disabled:""},{default:s(()=>[(m(!0),U(F,null,R(l(j),a=>(m(),g(ce,{label:a.chineseName,value:a.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(r,{prop:"",label:"货币类型"},{default:s(()=>[o(L,{modelValue:l(e).currencyType,"onUpdate:modelValue":t[5]||(t[5]=a=>l(e).currencyType=a),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(m(),U(F,null,R(ee,a=>o(D,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(e).type==="company"?(m(),g(r,{key:0,label:"公司名称"},{default:s(()=>[o(c,{modelValue:l(e).companyName,"onUpdate:modelValue":t[6]||(t[6]=a=>l(e).companyName=a),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):T("",!0),l(e).type==="company"?(m(),g(r,{key:1,label:"公司税号"},{default:s(()=>[o(c,{modelValue:l(e).taxId,"onUpdate:modelValue":t[7]||(t[7]=a=>l(e).taxId=a),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):T("",!0),l(e).type==="company"?(m(),g(r,{key:2,label:"法人姓名"},{default:s(()=>[o(c,{modelValue:l(e).legalPersonName,"onUpdate:modelValue":t[8]||(t[8]=a=>l(e).legalPersonName=a),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):T("",!0),l(e).country==="CN"?(m(),g(r,{key:3,prop:"phone",label:"手机号码"},{default:s(()=>[o(c,{modelValue:l(e).phone,"onUpdate:modelValue":t[9]||(t[9]=a=>l(e).phone=a),placeholder:"请输入你的手机号码",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})):(m(),g(r,{key:4,prop:"email",label:"电子邮箱"},{default:s(()=>[o(c,{modelValue:l(e).email,"onUpdate:modelValue":t[10]||(t[10]=a=>l(e).email=a),placeholder:"请输入你的电子邮箱",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})),o(r,{prop:"isInvitation",label:"合作邀约"},{default:s(()=>[o(fe,{modelValue:l(e).isInvitation,"onUpdate:modelValue":t[11]||(t[11]=a=>l(e).isInvitation=a),"inline-prompt":"","active-text":"启用","inactive-text":"禁用","active-value":2,"inactive-value":1},null,8,["modelValue"])]),_:1}),o(r,null,{default:s(()=>[o(h,{onClick:te,type:"primary"},{default:s(()=>[k(" 保存 ")]),_:1}),o(h,{onClick:V,type:"primary"},{default:s(()=>[k(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),o($,{label:"账户管理",class:"security"},{default:s(()=>[Re,o(M,{ref_key:"accountFormRef",ref:x,model:l(p),rules:l(ae),"label-width":"120px","label-suffix":"："},{default:s(()=>[o(r,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[o(c,{modelValue:l(p).oldPassword,"onUpdate:modelValue":t[12]||(t[12]=a=>l(p).oldPassword=a),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),o(r,{prop:"password",label:"新密码"},{default:s(()=>[o(c,{modelValue:l(p).password,"onUpdate:modelValue":t[13]||(t[13]=a=>l(p).password=a),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(r,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[o(c,{modelValue:l(p).confirmPassword,"onUpdate:modelValue":t[14]||(t[14]=a=>l(p).confirmPassword=a),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(r,null,{default:s(()=>[o(h,{onClick:ie,type:"primary"},{default:s(()=>[k(" 保存 ")]),_:1}),o(h,{onClick:V,type:"primary"},{default:s(()=>[k(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[ye,l(f)]])}}});typeof G=="function"&&G(Z);const Te=Ne(Z,[["__scopeId","data-v-f2020971"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{J as a,ze as b,Te as s};
