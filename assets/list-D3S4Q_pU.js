
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as re,O as ie,aI as ue,t as de,r as ce,G as me,H as V,J as pe,c as fe,a as u,al as ge,o as f,b as z,f as t,w as l,i as n,az as _e,F as ye,n as ve,e as b,g as p,I as be,am as he,l as w,j as M,R as Ce,ak as h,aJ as D,N as Ie,s as Pe,aG as we,aH as Se,_ as Ee}from"./index-DvpS3Rvf.js";import{_ as Le}from"./index.vue_vue_type_script_setup_true_lang-CkMsCv3T.js";import{_ as ke}from"./index.vue_vue_type_script_setup_true_lang-C4XFpQfU.js";import{s as C}from"./apiLoading-Dy0iFzr4.js";import{a as _}from"./otherFunctions_screenLibrary-BuyMrBSm.js";import{_ as Ve}from"./index.vue_vue_type_script_setup_true_lang-D2aM_sr7.js";import{u as ze}from"./otherFunctions_basicDictionary-AOYO3EFU.js";import{u as Me}from"./index-Cyt-AV2o.js";import{u as De}from"./useTabbar-Bvzc_QtC.js";import"./basicDictionary-rzgFCeB7.js";const $e=y=>(we("data-v-76da0b2c"),y=y(),Se(),y),Be={m:"4"},xe=$e(()=>w("div",{m:"4"},[w("h2",null,"该国家下所有问卷")],-1)),Ne=re({name:"OtherFunctionsScreenLibraryList",__name:"list",setup(y){const $=ze(),B=Me(),x=ie(),{pagination:c,getParams:N,onSizeChange:j,onCurrentChange:F,onSortChange:T}=ue(),U=De(),S=de(),e=ce({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[]});me(async()=>{d(),e.value.countryList=await $.getCountry(),e.value.formMode==="router"&&V.on("get-data-list",()=>{d()})}),pe(()=>{e.value.formMode==="router"&&V.off("get-data-list")});function d(){e.value.loading=!0;const a={...N(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};_.list(a).then(o=>{e.value.loading=!1,e.value.dataList=o.data.getCountryListInfoList,c.value.total=o.data.getCountryListInfoList.length})}const O=fe(()=>e.value.dataList.slice((c.value.page-1)*c.value.size,c.value.page*c.value.size));function H(a){j(a).then(()=>d())}function v(a=1){F(a).then(()=>d())}function J({prop:a,order:o}){T(a,o).then(()=>d())}function E(a){e.value.editProps.id="",e.value.editProps.countryId=a?a.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function A(a){e.value.editProps.id=a.projectProblemCategoryId,e.value.editProps.row=JSON.stringify(a),e.value.editProps.visible=!0}async function G(a){const{status:o}=await C(_.update(a));o===1&&h.success({message:"修改「默认国家」成功",center:!0}),d()}async function K(a){const{status:o}=await C(_.edit(a));o===1&&h.success({message:"修改「状态」成功",center:!0}),d()}function R(a){B.countryId=a.countryId,e.value.formMode==="router"?S.settings.tabbar.enable&&S.settings.tabbar.mergeTabsBy!=="activeMenu"?U.open({name:"screenLibraryEdit",params:{id:a.projectProblemCategoryId}}):x.push({name:"screenLibraryEdit",params:{id:a.projectProblemCategoryId}}):(e.value.formModeProps.id=a.projectProblemCategoryId,e.value.formModeProps.details=a.details,e.value.formModeProps.visible=!0)}function q(a){D.confirm(`确认删除「${a.countryId}」吗？`,"确认信息").then(async()=>{const{status:o}=await C(_.delete({countryId:a.countryId}));o===1&&h.success({message:"删除成功",center:!0}),d()}).catch(()=>{})}function Q(a){D.confirm(`确认删除「${a.categoryName}」吗？`,"确认信息").then(async()=>{const{status:o}=await C(_.delete({projectProblemCategoryId:a.projectProblemCategoryId}));o===1&&h.success({message:"删除成功",center:!0}),d()}).catch(()=>{})}return(a,o)=>{const W=u("ElOption"),X=u("el-select"),L=u("ElFormItem"),I=Ie,m=u("ElButton"),Y=u("ElForm"),Z=Le,ee=u("ElDivider"),te=u("ElSpace"),P=u("el-table-column"),k=u("ElSwitch"),g=u("ElTableColumn"),ae=u("el-table"),oe=u("ElTable"),ne=u("ElPagination"),le=Pe,se=ge("loading");return f(),z("div",{class:Ce({"absolute-container":n(e).tableAutoHeight})},[t(le,null,{default:l(()=>[t(Z,{"show-toggle":!1},{default:l(({fold:s,toggle:r})=>[t(Y,{model:n(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:l(()=>[t(L,{label:"国家"},{default:l(()=>[t(X,{onKeydown:o[0]||(o[0]=_e(i=>v(),["enter"])),onClear:o[1]||(o[1]=i=>v()),filterable:"",modelValue:n(e).search.countryId,"onUpdate:modelValue":o[2]||(o[2]=i=>n(e).search.countryId=i),placeholder:"Select"},{default:l(()=>[(f(!0),z(ye,null,ve(n(e).countryList,i=>(f(),b(W,{label:i.chineseName,value:i.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),t(L,null,{default:l(()=>[t(m,{type:"primary",onClick:o[3]||(o[3]=i=>v())},{icon:l(()=>[t(I,{name:"i-ep:search"})]),default:l(()=>[p(" 筛选 ")]),_:1}),t(m,{link:"",disabled:"",onClick:r},{icon:l(()=>[t(I,{name:s?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:l(()=>[p(" "+be(s?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),t(ee,{"border-style":"dashed"}),t(te,{wrap:""},{default:l(()=>[t(m,{type:"primary",size:"default",onClick:E},{icon:l(()=>[t(I,{name:"i-ep:plus"})]),default:l(()=>[p(" 新增前置问卷库 ")]),_:1})]),_:1}),he((f(),b(oe,{class:"my-4",border:"",stripe:"",data:n(O),"highlight-current-row":"",height:"100%",onSortChange:J,onSelectionChange:o[4]||(o[4]=s=>n(e).batch.selectionDataList=s)},{default:l(()=>[t(P,{type:"expand",width:"55"},{default:l(({row:s})=>[w("div",Be,[xe,t(ae,{data:s.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header"},{default:l(()=>[t(P,{prop:"categoryName",label:"问卷名称"}),t(g,{prop:"status",label:"状态"},{default:l(r=>[t(k,{onChange:i=>K(r.row),modelValue:r.row.status,"onUpdate:modelValue":i=>r.row.status=i,"active-value":1,"inactive-value":2},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1024),t(P,{prop:"createTime",label:"创建时间"}),t(g,{width:"250",align:"center",label:"操作",fixed:"right"},{default:l(r=>[t(m,{type:"primary",size:"small",plain:"",onClick:i=>A(r.row)},{default:l(()=>[p(" 编辑 ")]),_:2},1032,["onClick"]),t(m,{type:"primary",size:"small",plain:"",onClick:i=>R(r.row)},{default:l(()=>[p(" 设计问卷 ")]),_:2},1032,["onClick"]),t(m,{type:"danger",size:"small",plain:"",onClick:i=>Q(r.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["data"])])]),_:1}),t(g,{prop:"countryName",label:"国家"}),t(g,{prop:"isDefault",label:"默认"},{default:l(s=>[t(k,{onChange:r=>G(s.row),modelValue:s.row.isDefault,"onUpdate:modelValue":r=>s.row.isDefault=r,"active-value":1,"inactive-value":2},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),t(g,{label:"操作",width:"250",align:"center",fixed:"right"},{default:l(s=>[t(m,{type:"primary",size:"small",plain:"",onClick:r=>E(s.row)},{default:l(()=>[p(" 新增问卷 ")]),_:2},1032,["onClick"]),t(m,{type:"danger",size:"small",plain:"",onClick:r=>q(s.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,n(e).loading]]),t(ne,{"current-page":n(c).page,total:n(c).total,"page-size":n(c).size,"page-sizes":n(c).sizes,layout:n(c).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:H,onCurrentChange:v},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),n(e).editProps.visible?(f(),b(Ve,{key:0,id:n(e).editProps.id,countryId:n(e).editProps.countryId,modelValue:n(e).editProps.visible,"onUpdate:modelValue":o[5]||(o[5]=s=>n(e).editProps.visible=s),row:n(e).editProps.row,onSuccess:d},null,8,["id","countryId","modelValue","row"])):M("",!0),n(e).formMode==="dialog"||n(e).formMode==="drawer"?(f(),b(ke,{key:1,id:n(e).formModeProps.id,modelValue:n(e).formModeProps.visible,"onUpdate:modelValue":o[6]||(o[6]=s=>n(e).formModeProps.visible=s),mode:n(e).formMode,details:n(e).formModeProps.details,onSuccess:d},null,8,["id","modelValue","mode","details"])):M("",!0)],2)}}}),Re=Ee(Ne,[["__scopeId","data-v-76da0b2c"]]);export{Re as default};
