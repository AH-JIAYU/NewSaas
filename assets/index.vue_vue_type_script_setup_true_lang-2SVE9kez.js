
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as v,d as P,r as i,k as G,a as s,p as H,q as K,o as p,b as g,f as t,w as o,s as R,g as f,F as S,t as w,e as Q,E as M,v as W,N as X}from"./index-68hOHSHJ.js";import{u as Z}from"./user_customer-B5nHxkd7.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-CIRU4Pn8.js";const T={list:d=>v.post("tenant-invoice/getTenantInvoices",d),create:d=>v.post("tenant-invoice/insertTenantInvoice",d),edit:d=>v.post("tenant-invoice/updateById",d),delete:d=>v.post("tenant-invoice/deleteById",d)},le={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"0 1rem"}},te={style:{flex:"auto"}},ue=P({name:"Edit",__name:"index",emits:["success"],setup(d,{expose:E,emit:Y}){const A=Z(),y=Y,C=i(""),_=i(),B=i(!1),k=i([]),m=i(),r=i(!1),x=i(),h=[{lable:"未收款",value:1},{lable:"部分收款",value:2},{lable:"已完结",value:3},{lable:"坏账",value:4}],a=i({id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""}),L=i({invoiceCode:[{required:!0,trigger:"blur",message:"请输入姓名"}],tenantCustomerId:[{required:!0,trigger:"change",message:"请选择客户"}]});function N(){return new Promise(n=>{a.value.id?m.value&&m.value.validate(l=>{if(l){const b=W(a.value);T.edit(b).then(()=>{M.success({message:"编辑成功",center:!0}),y("success"),r.value=!1,n()})}}):m.value&&m.value.validate(l=>{l&&(delete a.value.id,T.create(a.value).then(()=>{M.success({message:"新增成功",center:!0}),y("success"),r.value=!1,n()}))})})}async function $(n){n?a.value=JSON.parse(n):a.value={id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""},C.value=n!=null&&n.id?"编辑":"新增",r.value=!0}const q=()=>{x.value.showEdit()},D=async()=>{k.value=await A.getCustomerList()};return G(async()=>{_.value=new Date,await D()}),E({showEdit:$}),(n,l)=>{const b=s("el-option"),F=X,V=s("el-button"),I=s("el-select"),u=s("el-form-item"),c=s("el-input"),O=s("ElOption"),U=s("el-date-picker"),j=s("el-form"),z=s("el-dialog"),J=H("loading");return K((p(),g("div",null,[t(z,{modelValue:r.value,"onUpdate:modelValue":l[10]||(l[10]=e=>r.value=e),title:C.value,width:"700"},{footer:o(()=>[R("div",te,[t(V,{type:"",onClick:l[9]||(l[9]=e=>r.value=!1)},{default:o(()=>[f(" 取消 ")]),_:1}),t(V,{type:"primary",onClick:N},{default:o(()=>[f(" 确定 ")]),_:1})])]),default:o(()=>[t(j,{ref_key:"formRef",ref:m,"label-width":"80px",model:a.value,rules:L.value,inline:!1},{default:o(()=>[t(u,{label:"客户简称",prop:"tenantCustomerId"},{default:o(()=>[t(I,{modelValue:a.value.tenantCustomerId,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value.tenantCustomerId=e),placeholder:"请选择客户",clearable:"",filterable:""},{empty:o(()=>[R("div",le,[f(" 暂无数据 "),t(V,{type:"primary",link:"",size:"small",onClick:q},{default:o(()=>[f(" 快捷新增 "),t(F,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:"2px",margin:"0 2px"}})]),_:1})])]),default:o(()=>[(p(!0),g(S,null,w(k.value,e=>(p(),Q(b,{key:e.tenantCustomerId,value:e.tenantCustomerId,label:e.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{prop:"invoiceCode",label:"发票编号"},{default:o(()=>[t(c,{modelValue:a.value.invoiceCode,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.invoiceCode=e),placeholder:"请输入发票编号",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{label:"发票金额"},{default:o(()=>[t(c,{modelValue:a.value.invoiceAmount,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.invoiceAmount=e),modelModifiers:{number:!0},placeholder:"请输入发票金额",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{label:"手续费(税)"},{default:o(()=>[t(c,{modelValue:a.value.invoiceTax,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.invoiceTax=e),modelModifiers:{number:!0},placeholder:"请输入手续费",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{label:"实际收款"},{default:o(()=>[t(c,{modelValue:a.value.actualReceipts,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.actualReceipts=e),modelModifiers:{number:!0},placeholder:"请输入实际收款",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{label:"发票状态"},{default:o(()=>[t(I,{modelValue:a.value.invoiceStatus,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.invoiceStatus=e),placeholder:"请选择发票状态",clearable:"",filterable:""},{default:o(()=>[(p(),g(S,null,w(h,e=>t(O,{label:e.lable,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(u,{style:{width:"100%"},label:"开票日期"},{default:o(()=>[t(U,{modelValue:a.value.invoiceDate,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.invoiceDate=e),"default-time":_.value,type:"datetime",placeholder:"请选择开票日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),t(u,{label:"收款日期"},{default:o(()=>[t(U,{modelValue:a.value.paymentDate,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.paymentDate=e),"default-time":_.value,type:"datetime",placeholder:"请选择收款日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),t(u,{label:"备注"},{default:o(()=>[t(c,{modelValue:a.value.remark,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.remark=e),placeholder:"备注说明",clearable:"",rows:5,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ee,{ref_key:"editRef",ref:x,onFetchData:D},null,512)])),[[J,B.value]])}}});export{ue as _,T as a};
