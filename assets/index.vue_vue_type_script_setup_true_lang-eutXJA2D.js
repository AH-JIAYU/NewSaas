
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{ad as f,d as G,r as d,o as H,a2 as m,al as K,a3 as Q,a as g,i as C,f as a,w as n,b as U,g as _,N as h,O as E,c as W,ai as y,am as X,_ as Z}from"./index-Ciz6FZao.js";import{u as ee}from"./user_customer-Bxdosl7g.js";import le from"./index-CBAWodt-.js";const D={list:i=>f.post("tenant-invoice/getTenantInvoices",i),create:i=>f.post("tenant-invoice/insertTenantInvoice",i),edit:i=>f.post("tenant-invoice/updateById",i),delete:i=>f.post("tenant-invoice/deleteById",i),queryAllInvitation:i=>f.post("tenantBind/queryAllInvitation",i)},te={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"0 1rem"}},ae={style:{flex:"auto"}},ie=G({name:"Edit",__name:"index",emits:["success"],setup(i,{expose:L,emit:q}){const B=ee(),I=q,k=d(""),b=d(),s=d(!1),x=d([]),c=d(),v=d(!1),w=d(),Y=[{lable:"未收款",value:1},{lable:"部分收款",value:2},{lable:"已完结",value:3},{lable:"坏账",value:4}],l=d({id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""}),N=d({invoiceCode:[{required:!0,trigger:"blur",message:"请输入发票编号"}],tenantCustomerId:[{required:!0,trigger:"change",message:"请选择客户"}],invoiceStatus:[{required:!0,trigger:"change",message:"请选择发票状态"}],invoiceAmount:[{required:!0,trigger:"blur",message:"请输入发票金额"},{validator:(o,e,u)=>{e?/^\d+(\.\d{1,10})?$/.test(e)?u():u(new Error("格式不正确，请输入有效的金额")):u(new Error("请输入发票金额"))},trigger:"blur"}],invoiceDate:[{required:!0,trigger:"change",message:"请选择开票日期"}]});function M(){return new Promise(o=>{if(!/^\d*$/.test(l.value.invoiceTax)){y.warning("请输入有效的数字");return}if(!/^\d*$/.test(l.value.actualReceipts)){y.warning("请输入有效的数字");return}l.value.id?c.value&&c.value.validate(e=>{if(e)try{s.value=!0;const u=X(l.value);D.edit(u).then(()=>{s.value=!1,y.success({message:"编辑成功",center:!0}),I("success"),v.value=!1,o()})}catch{}finally{s.value=!1}}):c.value&&c.value.validate(e=>{if(e)try{s.value=!0,delete l.value.id,D.create(l.value).then(()=>{s.value=!1,y.success({message:"新增成功",center:!0}),I("success"),v.value=!1,o()})}catch{}finally{s.value=!1}})})}async function $(o){try{s.value=!0,await A(),o?l.value=JSON.parse(o):l.value={id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""},k.value=o!=null&&o.id?"编辑":"新增",s.value=!1,v.value=!0}catch{}finally{s.value=!1}}const O=()=>{w.value.showEdit()},A=async()=>{let o=await B.getCustomerList();const{data:e}=await D.queryAllInvitation({page:1,limit:-1}),u=e&&Array.isArray(e.tenantNameList)?e.tenantNameList:[];x.value=[...o,...u]};H(async()=>{b.value=new Date});const F=()=>{c.value.resetFields(),Object.assign(l.value,{id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""})};return L({showEdit:$}),(o,e)=>{const u=m("el-option"),S=Z,V=m("el-button"),R=m("el-select"),r=m("el-form-item"),p=m("el-input"),j=m("ElOption"),T=m("el-date-picker"),z=m("el-form"),J=m("el-dialog"),P=K("loading");return Q((g(),C("div",null,[a(J,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value=t),title:k.value,width:"700",onClose:F},{footer:n(()=>[U("div",ae,[a(V,{type:"",onClick:e[9]||(e[9]=t=>v.value=!1)},{default:n(()=>[_(" 取消 ")]),_:1}),a(V,{type:"primary",onClick:M},{default:n(()=>[_(" 确定 ")]),_:1})])]),default:n(()=>[a(z,{ref_key:"formRef",ref:c,"label-width":"7rem",model:l.value,rules:N.value,inline:!1},{default:n(()=>[a(r,{label:"客户简称",prop:"tenantCustomerId"},{default:n(()=>[a(R,{modelValue:l.value.tenantCustomerId,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.tenantCustomerId=t),placeholder:"请选择客户",clearable:"",filterable:""},{empty:n(()=>[U("div",te,[_(" 暂无数据 "),a(V,{type:"primary",link:"",size:"small",onClick:O},{default:n(()=>[_(" 快捷新增 "),a(S,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:"0.125rem",margin:"0 0.125rem"}})]),_:1})])]),default:n(()=>[(g(!0),C(h,null,E(x.value,t=>(g(),W(u,{key:t.tenantCustomerId,value:t.tenantCustomerId,label:t.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{prop:"invoiceCode",label:"发票编号"},{default:n(()=>[a(p,{modelValue:l.value.invoiceCode,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.invoiceCode=t),placeholder:"请输入发票编号",clearable:""},null,8,["modelValue"])]),_:1}),a(r,{prop:"invoiceAmount",label:"发票金额"},{default:n(()=>[a(p,{modelValue:l.value.invoiceAmount,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.invoiceAmount=t),placeholder:"请输入发票金额",clearable:""},null,8,["modelValue"])]),_:1}),a(r,{label:"手续费(税)"},{default:n(()=>[a(p,{modelValue:l.value.invoiceTax,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.invoiceTax=t),placeholder:"请输入手续费",clearable:""},null,8,["modelValue"])]),_:1}),a(r,{label:"实际收款"},{default:n(()=>[a(p,{modelValue:l.value.actualReceipts,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.actualReceipts=t),placeholder:"请输入实际收款",clearable:""},null,8,["modelValue"])]),_:1}),a(r,{prop:"invoiceStatus",label:"发票状态"},{default:n(()=>[a(R,{modelValue:l.value.invoiceStatus,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.invoiceStatus=t),placeholder:"请选择发票状态",clearable:"",filterable:""},{default:n(()=>[(g(),C(h,null,E(Y,t=>a(j,{label:t.lable,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(r,{style:{width:"100%"},prop:"invoiceDate",label:"开票日期"},{default:n(()=>[a(T,{modelValue:l.value.invoiceDate,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.invoiceDate=t),"default-time":b.value,type:"datetime",placeholder:"请选择开票日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(r,{label:"收款日期"},{default:n(()=>[a(T,{modelValue:l.value.paymentDate,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.paymentDate=t),"default-time":b.value,type:"datetime",placeholder:"请选择收款日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(r,{label:"备注"},{default:n(()=>[a(p,{modelValue:l.value.remark,"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.remark=t),placeholder:"备注说明",clearable:"",rows:5,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(le,{ref_key:"editRef",ref:w,onFetchData:A},null,512)])),[[P,s.value]])}}});export{ie as _,D as a};
