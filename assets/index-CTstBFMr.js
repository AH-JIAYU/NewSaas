
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as he,aN as ge,r,$ as be,c as ke,n as Te,a as y,q as Ie,o as s,b as Ce,f as o,w as n,g as c,i as l,A as T,s as Pe,e as u,aM as je,y as _,j as d,z as g,N as L,aO as Be,E,b8 as Se,b9 as Ne,_ as Ue,bd as ze,ao as Ee,L as Re}from"./index-D7AuJkCI.js";import{_ as Le}from"./index-Dbdxiwn3.js";import{_ as xe}from"./index.vue_vue_type_style_index_0_lang-B7zdY-wi.js";import $e from"./index-DW1Y_vdy.js";import De from"./index-DZpFge2C.js";import Ae from"./index-CIWy3v_7.js";import Me from"./index-6tesE54x.js";import{a as C}from"./user_cooperation-DFR61tmV.js";import we from"./index-pHCTzlEb.js";import"./index-Dixwg_mL.js";import"./index-CfqZ-NGw.js";import"./department-Du5pYq8M.js";const Fe={class:"fontC-System"},He={class:"copyId tableSmall"},qe={class:"id oneLine beInvitationTenantId"},Oe={class:"tableBig"},Qe={class:"flex-s"},Ve={class:"fontC-System"},Je={class:"fontC-System"},Ge={class:"fontC-System"},Ke={class:"fontC-System"},We={class:"fontC-System"},Xe={class:"fontC-System"},Ye=he({name:"cooperation",__name:"index",setup(Ze){const{pagination:b,getParams:O,onSizeChange:Q,onCurrentChange:V}=ge(),f=r(!1),R=r([]),x=r(),$=r(),J=r(),P=r(!1),j=r(!1),B=r(!1),S=r("default"),p=r([]),D=r(),N=r([{label:"合作商ID",checked:!0,sortable:!0,prop:"beInvitationTenantId"},{label:"合作商名称",checked:!0,sortable:!0,prop:"beInvitationTenantName"},{label:"PM",checked:!0,sortable:!0,prop:"userName"},{label:"状态",checked:!0,sortable:!0,prop:"bindStatus"},{label:"价格比例",checked:!0,sortable:!0,prop:"priceRatio"},{label:"待审金额",checked:!0,sortable:!0,prop:"pendBalance"},{label:"可用金额",checked:!0,sortable:!0,prop:"availableBalance"},{label:"个人待审金额",checked:!0,sortable:!0,prop:"personalPendBalance"},{label:"个人可用金额",checked:!0,sortable:!0,prop:"personalAvailableBalance"},{label:"发送项目",checked:!0,sortable:!0,prop:"sendProjectType"},{label:"接收项目",checked:!0,sortable:!0,prop:"receiveProjectType"},{label:"负责部门/PM",checked:!0,sortable:!0,prop:"userName"}]),U=r();function G(a){a?U.value=a.id:U.value=""}function K(){x.value.showEdit()}function W(a){Be.prompt("是否确认进行解约?","终止合作",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"说明",inputPattern:/^.{0,500}$/,inputErrorMessage:"不能超过500个字符",type:"warning"}).then(async e=>{const{data:{flag:i}}=await C.updateRescindTenant({beInvitationTenantId:a.beInvitationTenantId,remark:e.value});i&&E({type:"success",message:"已终止合作"}),I()}).catch(()=>{})}const A=r();function X(a){A.value.showEdit(a)}function Y(a){$.value.showEdit(a)}const Z=be({});function ee(a){Q(a).then(()=>I())}function te(a=1){V(a).then(()=>I())}function h(){b.value.page=1,I()}async function I(){try{f.value=!0;const a={...O(),...Z},{data:e}=await C.list(a);R.value=e.tenantBindInfoList,b.value.total=Number(e.total),f.value=!1}catch{}finally{f.value=!1}}function ae(a){J.value=a}const ne=ke(()=>{const a=R.value.filter(m=>m.bindStatus===2);let e=R.value.filter(m=>m.bindStatus===4);e=Array.from(new Map(e.map(m=>[m.beInvitationTenantId,m])).values());const i=a.map(m=>m.beInvitationTenantId);return e.forEach(m=>{i.includes(m.beInvitationTenantId)||a.push(m)}),a});function le(a,e){D.value.showEdit(a,e)}Te(()=>{N.value.forEach(a=>{a.checked&&p.value.push(a.prop)}),h()});const M=(a,e)=>{if(e.sendProjectType==1&&a=="手动"||e.sendProjectType==2&&a=="自动")try{f.value=!0;let i={id:e.id,chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,sendProjectType:e.sendProjectType==1?2:1,receiveProjectType:e.receiveProjectType};C.updateInvitationBindUser(i).then(()=>{f.value=!1,h(),E.success({message:"修改成功",center:!0})})}catch{}finally{f.value=!1}},w=r(),F=r(null),H=(a,e)=>{if(F.value=e.id,JSON.parse(JSON.stringify(e)),e.receiveProjectType==1&&a=="手动")try{f.value=!0;let i={id:e.id,chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,sendProjectType:e.sendProjectType,receiveProjectType:e.receiveProjectType==1?2:1};C.updateInvitationBindUser(i).then(()=>{f.value=!1,h(),E.success({message:"修改成功",center:!0})})}catch{}finally{f.value=!1}else if(e.receiveProjectType==2&&a=="自动"){let i={chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,id:e.id};w.value.showEdit(i,"请选择负责部门/人")}};function oe(a){try{f.value=!0;let e={id:F.value,chargeUserId:a.chargeUserId,invitationType:a.invitationType,chargeUserName:a.chargeUserName,sendProjectType:a.sendProjectType,receiveProjectType:a.receiveProjectType==1?2:1};Array.isArray(e.chargeUserId)&&(e.chargeUserId=e.chargeUserId[0]),C.updateInvitationBindUser(e).then(()=>{f.value=!1,h(),E.success({message:"修改成功",center:!0})})}catch{}finally{f.value=!1}}return(a,e)=>{const i=y("el-button"),m=xe,ie=Se,se=Ne,re=y("el-row"),v=y("el-table-column"),q=y("el-text"),ce=y("el-tooltip"),ue=Le,pe=Ue,z=ze,de=y("ElSpace"),fe=y("el-empty"),me=y("el-table"),ve=y("ElPagination"),_e=Ee,ye=Ie("loading");return s(),Ce("div",{class:L({"absolute-container":l(B)})},[o(_e,null,{default:n(()=>[o(re,null,{default:n(()=>[o(m,null,{default:n(()=>[o(i,{type:"primary",size:"default",onClick:K},{default:n(()=>[c(" 邀约公司 ")]),_:1})]),_:1}),o(se,null,{default:n(()=>[o(i,{size:"default"},{default:n(()=>[c(" 导出 ")]),_:1}),o(ie,{border:l(P),"onUpdate:border":e[0]||(e[0]=t=>T(P)?P.value=t:null),tableAutoHeight:l(B),"onUpdate:tableAutoHeight":e[1]||(e[1]=t=>T(B)?B.value=t:null),checkList:l(p),"onUpdate:checkList":e[2]||(e[2]=t=>T(p)?p.value=t:null),columns:l(N),"onUpdate:columns":e[3]||(e[3]=t=>T(N)?N.value=t:null),"line-height":l(S),"onUpdate:lineHeight":e[4]||(e[4]=t=>T(S)?S.value=t:null),stripe:l(j),"onUpdate:stripe":e[5]||(e[5]=t=>T(j)?j.value=t:null),style:{"margin-left":"12px"},onQueryData:h},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),Pe((s(),u(me,{border:l(P),data:l(ne),size:l(S),stripe:l(j),onSelectionChange:ae,"highlight-current-row":"",onCurrentChange:G},{empty:n(()=>[o(fe,{image:l(je),"image-size":300},null,8,["image"])]),default:n(()=>[o(v,{align:"left",type:"selection"}),l(p).includes("bindStatus")?(s(),u(v,{key:0,align:"left",prop:"bindStatus","show-overflow-tooltip":"",label:"状态",width:"100"},{default:n(({row:t})=>[_("div",Fe,[t.bindStatus===2?(s(),u(q,{key:0,type:"success"},{default:n(()=>[c("合作")]),_:1})):d("",!0),t.bindStatus===4?(s(),u(q,{key:1,type:"danger"},{default:n(()=>[c("解约")]),_:1})):d("",!0)])]),_:1})):d("",!0),l(p).includes("bindStatus")?(s(),u(v,{key:1,align:"left",prop:"sendProjectType",label:"发送项目",width:"160"},{default:n(({row:t})=>[o(i,{type:t.sendProjectType===1?"primary":"",size:"small",onClick:k=>M("自动",t)},{default:n(()=>[c("自动 ")]),_:2},1032,["type","onClick"]),o(i,{type:t.sendProjectType===2?"primary":"",size:"small",onClick:k=>M("手动",t)},{default:n(()=>[c("手动")]),_:2},1032,["type","onClick"])]),_:1})):d("",!0),l(p).includes("receiveProjectType")?(s(),u(v,{key:2,align:"left",prop:"receiveProjectType",label:"接收项目",width:"160"},{default:n(({row:t})=>[o(i,{type:t.receiveProjectType===1?"primary":"",size:"small",onClick:k=>H("自动",t)},{default:n(()=>[c("自动 ")]),_:2},1032,["type","onClick"]),o(i,{type:t.receiveProjectType===2?"primary":"",size:"small",onClick:k=>H("手动",t)},{default:n(()=>[c("手动")]),_:2},1032,["type","onClick"])]),_:1})):d("",!0),l(p).includes("beInvitationTenantId")?(s(),u(v,{key:3,align:"left",prop:"beInvitationTenantId",width:"200",label:"合作商ID"},{default:n(({row:t})=>[_("div",He,[_("div",qe,[o(ce,{effect:"dark",content:t.beInvitationTenantId,placement:"top-start"},{default:n(()=>[c(g(t.beInvitationTenantId),1)]),_:2},1032,["content"])]),o(ue,{content:t.beInvitationTenantId,class:L({rowCopy:"rowCopy",current:t.id===l(U)})},null,8,["content","class"])])]),_:1})):d("",!0),l(p).includes("beInvitationTenantName")?(s(),u(v,{key:4,align:"left",prop:"beInvitationTenantName","show-overflow-tooltip":"",width:"130",label:"合作商公司名称"},{default:n(({row:t})=>[_("div",Oe,g(t.beInvitationTenantName),1)]),_:1})):d("",!0),l(p).includes("userName")?(s(),u(v,{key:5,align:"left",prop:"userName",width:"100","show-overflow-tooltip":"",label:"负责部门"},{default:n(({row:t})=>[_("div",Qe,[_("div",Ve,g(t.userName?t.userName:"-"),1),t.projectType!==2?(s(),u(pe,{key:0,onClick:k=>le(t,"chargeUserId"),class:L({edit:"edit",current:t.id===l(U)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):d("",!0)])]),_:1})):d("",!0),l(p).includes("priceRatio")?(s(),u(v,{key:6,align:"left",prop:"priceRatio","show-overflow-tooltip":"",label:"价格比例"},{default:n(({row:t})=>[_("div",Je,g(t.priceRatio)+"%",1)]),_:1})):d("",!0),l(p).includes("pendBalance")?(s(),u(v,{key:7,align:"left",prop:"pendBalance","show-overflow-tooltip":"",label:"待审金额"},{default:n(({row:t})=>[_("div",Ge,[o(z),c(g(t.pendBalance||0),1)])]),_:1})):d("",!0),l(p).includes("availableBalance")?(s(),u(v,{key:8,align:"left",prop:"availableBalance","show-overflow-tooltip":"",label:"可用金额"},{default:n(({row:t})=>[_("div",Ke,[o(z),c(g(t.availableBalance||0),1)])]),_:1})):d("",!0),l(p).includes("personalPendBalance")?(s(),u(v,{key:9,align:"left",prop:"personalPendBalance","show-overflow-tooltip":"",width:"120",label:"个人待审金额"},{default:n(({row:t})=>[_("div",We,[o(z),c(g(t.personalPendBalance||0),1)])]),_:1})):d("",!0),l(p).includes("personalAvailableBalance")?(s(),u(v,{key:10,align:"left",width:"120",prop:"personalAvailableBalance","show-overflow-tooltip":"",label:"个人可用金额"},{default:n(({row:t})=>[_("div",Xe,[o(z),c(g(t.personalAvailableBalance||0),1)])]),_:1})):d("",!0),o(v,{align:"left",fixed:"right",prop:"i",label:"操作",width:"280"},{default:n(({row:t})=>[o(de,null,{default:n(()=>[o(i,{size:"small",type:"primary",plain:"",onClick:k=>Y(t)},{default:n(()=>[c(" 合作配置 ")]),_:2},1032,["onClick"]),t.bindStatus===2?(s(),u(i,{key:0,type:"danger",plain:"",size:"small",onClick:k=>W(t)},{default:n(()=>[c(" 终止合作 ")]),_:2},1032,["onClick"])):d("",!0),o(i,{type:"warning",plain:"",size:"small",onClick:k=>X(t)},{default:n(()=>[c(" 财务日志 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["border","data","size","stripe"])),[[ye,l(f)]]),o(ve,{"current-page":l(b).page,total:l(b).total,"page-size":l(b).size,"page-sizes":l(b).sizes,layout:l(b).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:ee,onCurrentChange:te},null,8,["current-page","total","page-size","page-sizes","layout"]),o($e,{ref_key:"editRef",ref:x,onFetchData:h},null,512),o(De,{ref_key:"proportionRef",ref:$,onFetchData:h},null,512),o(Ae,{ref_key:"financialLogRef",ref:A,onFetchData:h},null,512)]),_:1}),o(we,{ref_key:"QuickEditRef",ref:D,onFetchData:I},null,512),o(Me,{ref_key:"userRef",ref:w,onUserData:oe},null,512)],2)}}}),dt=Re(Ye,[["__scopeId","data-v-c5697216"]]);export{dt as default};
