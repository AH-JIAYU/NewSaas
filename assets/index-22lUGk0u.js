
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-BwWtNJB1.js";import{x as C,af as $,d as E,r as z,a as k,o as i,b as p,f as r,w as l,s as t,g as a,F as S,t as M,S as x,i as c,H as n,e as U,j,I as w,aJ as F,aK as H,R}from"./index-DmgRXF6j.js";const G={list:d=>C.post("tenantBind/getProjectAllocationList",d),getTenantMeasurementList:d=>C.post("tenantBind/getTenantMeasurementList",d),getQuestionnaireClickList:d=>C.post("tenantBind/getQuestionnaireClickList",d)},q=$("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"]})),A=q,O=d=>(F("data-v-bc024d40"),d=d(),H(),d),J={class:"milestone"},K={class:"left"},W={class:"left-top-left p-4"},X={class:"project"},Y={class:"projectName flex-b"},Z={class:"projectId"},ee={class:"price flex-b"},te={key:0,class:"left-top-right p-4"},se={class:"tenant"},ne={key:0,class:"left-bottom"},ae=O(()=>t("div",{class:"line"},null,-1)),oe={class:"allocation"},le=O(()=>t("div",{class:"arrow"},null,-1)),re={key:0,class:"right"},ie={class:"clickIdItem m-2"},ce={class:"clickIdItem-left"},ue={class:"clickIdItem-right"},pe={class:"title"},de=O(()=>t("li",null,"点击ID:",-1)),_e={key:0},fe={style:{flex:"auto"}},Ie=E({name:"Edit",__name:"index",setup(d,{expose:N}){const g=A(),b=z(!1),y=z({currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function V(o){const m={linkId:o.linkId,projectId:o.projectId},_=await G.getTenantMeasurementList(m),u=_.data.tenantMeasurementInfoList.findIndex(s=>s.allocationTenantId===_.data.currentTenantId),f=_.data.tenantMeasurementInfoList;f.splice(0,u);const h=f.filter(s=>s.type===1),I=f.filter(s=>s.type===2),e=f.filter(s=>s.type===3),v=[...h];if(I.length){const s=I.map(L=>L.memberGroupOrSupperId);I[0].length=I.length,I[0].memberGroupOrSupperIdList=s,v.push(I[0])}else if(e.length){const s=e.map(L=>L.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=s,v.push(e[0])}y.value.currentTenantId=_.data.currentTenantId,y.value.tenantMeasurementInfoList=v,b.value=!0}const B=async o=>{if(!o.visible){const m={type:o.type,projectId:o.projectId,tenantId:o.allocationTenantId,supplierIdList:o.type===2?o.memberGroupOrSupperIdList:[],memberGroupIdList:o.type===3?o.memberGroupOrSupperIdList:[]},_=await G.getQuestionnaireClickList(m);y.value.clickIdList=Q(_.data.questionnaireClickInfoList),o.visible=!0}};function Q(o){return o.reduce((m,_)=>{const{supplierId:u,supplierName:f,projectQuestionnaireClickId:h,surveyStatus:I,price:e}=_;let v=m.find(s=>s.supplierId===u);return v?v.list.push({projectQuestionnaireClickId:h,surveyStatus:I,price:e}):m.push({supplierId:u,supplierName:f,list:[{projectQuestionnaireClickId:h,surveyStatus:I,price:e}]}),m},[])}function T(){b.value=!1}function P(){T()}return N({showEdit:V}),(o,m)=>{const _=D,u=k("el-text"),f=k("el-button"),h=k("el-popover"),I=k("el-drawer");return i(),p("div",null,[r(I,{modelValue:c(b),"onUpdate:modelValue":m[0]||(m[0]=e=>w(b)?b.value=e:null),title:"项目测查",size:"60%","before-close":T},{footer:l(()=>[t("div",fe,[r(f,{onClick:T},{default:l(()=>[a(" 取消 ")]),_:1}),r(f,{type:"primary",onClick:P},{default:l(()=>[a(" 确定 ")]),_:1})])]),default:l(()=>[t("div",J,[(i(!0),p(S,null,M(c(y).tenantMeasurementInfoList,(e,v)=>(i(),p("div",{class:"item",key:e.allocationTenantId},[t("div",K,[t("div",{class:x({"left-top":!0,"flex-b":!0,currentTenant:e.allocationTenantId===c(y).currentTenantId&&e.type===1})},[t("div",W,[t("div",X,[t("div",Y,[t("b",null,n(e.projectName),1),t("span",null,n(c(g).projectStatusList[e.projectStatus-1]),1)]),t("div",Z,n(e.projectId),1)]),t("div",ee,[t("p",null,[a(" 原价： "),r(_),a(" "+n(e.doMoneyPrice),1)]),t("p",null,[a(" 参数： "),r(u,{size:"large"},{default:l(()=>[a(n(e.participationNumber||0),1)]),_:2},1024),r(u,{size:"large"},{default:l(()=>[a(" / ")]),_:1}),r(u,{type:"success",size:"large"},{default:l(()=>[a(n(e.doneNumber||0),1)]),_:2},1024),r(u,{size:"large"},{default:l(()=>[a(" / ")]),_:1}),r(u,{type:"warning",size:"large"},{default:l(()=>[a(n(e.num||0),1)]),_:2},1024),r(u,{size:"large"},{default:l(()=>[a(" / ")]),_:1}),r(u,{size:"large"},{default:l(()=>[a(n(e.limitedQuantity||0),1)]),_:2},1024)])])]),e.allocationTenantId!==c(y).currentTenantId||e.type!==1?(i(),p("div",te,[t("p",{class:x("type"+e.type)},n(c(g).typeList[e.type-1]),3),t("div",se,[(e==null?void 0:e.length)>1?(i(),U(f,{key:0,type:"primary",link:""},{default:l(()=>[a(" 查看更多("+n(e==null?void 0:e.length)+") ",1)]),_:2},1024)):(i(),p(S,{key:1},[t("p",null,n(e.tenantName),1),t("p",null,n(e.allocationTenantId),1)],64))])])):j("",!0)],2),c(y).tenantMeasurementInfoList.length!==v+1?(i(),p("div",ne,[ae,t("div",oe,n(e.tenantName)+"-分配-"+n(c(g).typeList[c(y).tenantMeasurementInfoList[v+1].type-1]),1),le])):j("",!0)]),e.allocationTenantId!==c(y).currentTenantId||e.type!=1?(i(),p("div",re,[r(h,{visible:e.visible,"onUpdate:visible":s=>e.visible=s,placement:"right",width:350,trigger:"click"},{reference:l(()=>[r(f,{style:{padding:"0.5rem"},type:"primary",link:"",onClick:s=>B(e)},{default:l(()=>[a(" 》 ")]),_:2},1032,["onClick"])]),default:l(()=>[(i(!0),p(S,null,M(c(y).clickIdList,s=>(i(),p("div",ie,[t("div",ce,[t("span",{class:x("type"+e.type)},n(c(g).typeList[e.type-1]),3)]),t("div",ue,[t("div",pe,n(s.supplierName)+"   "+n(s.supplierId),1),t("ul",null,[de,(i(!0),p(S,null,M(s.list,L=>(i(),p("li",null,[t("span",null,n(L.projectQuestionnaireClickId),1),t("span",null,"  "+n(c(g).surveyStatusList[L.surveyStatus-1]),1),L.surveyStatus===1?(i(),p("span",_e,[a("   "),r(_),a(n(L.price),1)])):j("",!0)]))),256))])])]))),256))]),_:2},1032,["visible","onUpdate:visible"])])):j("",!0)]))),128))])]),_:1},8,["modelValue"])])}}}),ye=R(Ie,[["__scopeId","data-v-bc024d40"]]),Le=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{G as a,ye as e,Le as i,A as u};
