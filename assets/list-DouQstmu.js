
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as U,d as ee,a1 as le,r as f,k as ae,a as i,p as te,q as oe,o as se,b as ne,f as e,w as l,S as ue,i as re,bk as ie,s as y,g,E as h,a0 as de,aB as pe,ap as me,aG as fe,aH as ce,R as ve}from"./index-Czfzf8F4.js";import{u as _e}from"./index-CG9aDL-R.js";import ge from"./index-YeIUw9dp.js";import"./clipboard-zEQ9nh5E.js";const W={list:()=>U.post("supplier-config/getSupplierConfig"),create:d=>U.post("supplier-config/insertSupplierConfig",d),edit:d=>U.post("supplier-config/updateSupplierConfig",d)},ye={getTenantLogo:d=>U.post("tenant-logo/getTenantLogo",d),uploadLogo:d=>U.post("tenant-logo/upload",d)},O=d=>(fe("data-v-9084068f"),d=d(),ce(),d),Ve=O(()=>y("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),be=["src"],xe=O(()=>y("span",{class:"red"},null,-1)),we=O(()=>y("span",{style:{"margin-right":"10px"}},"已生效",-1)),he=O(()=>y("span",{class:"green"},null,-1)),Ue=O(()=>y("span",{style:{"margin-right":"10px"}},"未生效",-1)),Oe=ee({name:"site_setting",__name:"list",setup(d){const V=le(),$=f(),z="http://47.96.98.102:9100/tenant-logo/upload",{toClipboard:B}=_e(),A=f("基本设置"),m=f(!1),v=f(),t=f({id:"",registerOffOrOn:!0,registerExamineOffOrOn:!1,keyWords:"",webName:"",supplierURL:"",externalSite:"",defaultPriceRatio:null,taxRate:null,minimumAmount:null,phone:"",email:"",qqCode:"",address:""}),C=f({webName:[{required:!0,message:"请输入网站名称",trigger:"blur"}],supplierURL:[{required:!0,message:"请输入供应商网址",trigger:"blur"},{validator:(s,a,r)=>{/^[\p{L}\p{N}]+$/u.test(a)?r():r(new Error("请输入英文字母，或数字"))},trigger:"submit"}],phone:[{required:!1,trigger:"submit",message:"请输入手机号"},{validator:(s,a,r)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(t.value.phone)?r():r(new Error("请输入合法手机号"))},trigger:"submit"}],email:[{required:!1,trigger:"submit",message:"请输入邮箱"},{validator:(s,a,r)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.value.email)?r():r(new Error("请输入合法邮箱"))},trigger:"submit"}]});ae(()=>{m.value=!0,V.logo&&(c.value=[{name:"logo",url:V.logo}]),E(),m.value=!1});async function E(){try{const{data:s}=await W.list();t.value=s||t.value}catch{}finally{m.value=!1}}const D=async()=>{var a;c.value=[];const s=await ye.getTenantLogo();s.data&&(V.setLogo(s.data.logoUrl),c.value.push({name:"file",url:(a=s==null?void 0:s.data)==null?void 0:a.logoUrl}))},G=()=>{$.value.showEdit()},F=()=>{const s=`${t.value.supplierURL}.front-supplier.surveyssaas.com`;B(s),h({type:"success",message:"复制成功"})},H=V.token,J=f({Token:H}),M=f(""),L=f(!1),c=f([]),Q=async()=>{h.success({message:"删除成功",center:!0}),V.delLogo()},Z=(s,a)=>{s.status===-1?(de.error(s.error,{zIndex:2e3}),c.value=c.value.filter(r=>r.name!==a.name)):D()},j=async()=>{h.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},K=s=>{M.value=s.url,L.value=!0};function R(){t.value.email===""&&(C.value.email=[],v.value.clearValidate("email")),t.value.phone===""&&(C.value.phone=[],v.value.clearValidate("phone")),t.value.id?v.value&&v.value.validate(s=>{if(s)try{let{id:a,keyWords:r,registerExamineOffOrOn:b,registerOffOrOn:S,supplierURL:P,webName:q,externalSite:n,defaultPriceRatio:k,taxRate:u,minimumAmount:p,phone:I,email:_,qqCode:x,address:w}=t.value;const N={id:a,keyWords:r,registerExamineOffOrOn:b,registerOffOrOn:S,supplierURL:P,webName:q,externalSite:n,defaultPriceRatio:k,taxRate:u,minimumAmount:p,phone:I,email:_,qqCode:x,address:w};m.value=!0,W.edit(N).then(T=>{m.value=!1,T.status===1&&(E(),h.success({message:"修改成功",center:!0}))})}catch{}finally{m.value=!1}}):v.value&&v.value.validate(s=>{if(s)try{m.value=!0,delete t.value.id,!t.value.keyWords&&(t.value.keyWords="keyWords"),W.create(t.value).then(()=>{m.value=!1,E(),h.success({message:"新增成功",center:!0})})}catch{}finally{m.value=!1}})}return(s,a)=>{const r=pe,b=i("el-icon"),S=i("el-upload"),P=i("el-dialog"),q=i("ElFormItem"),n=i("el-col"),k=i("el-switch"),u=i("el-form-item"),p=i("el-input"),I=i("el-text"),_=i("el-button"),x=i("el-row"),w=i("el-tab-pane"),N=i("el-form"),T=i("el-tabs"),X=me,Y=te("loading");return oe((se(),ne("div",null,[e(r,{title:"站点设置管理"}),e(X,null,{default:l(()=>[e(T,{modelValue:A.value,"onUpdate:modelValue":a[14]||(a[14]=o=>A.value=o)},{default:l(()=>[e(N,{ref_key:"formRef",ref:v,model:t.value,rules:C.value,"label-width":"100px","label-position":"right",inline:!1},{default:l(()=>[e(w,{label:"基础设置",name:"基本设置"},{default:l(()=>[e(x,{gutter:20},{default:l(()=>[e(n,{span:24},{default:l(()=>[e(q,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"网址Logo"},{default:l(()=>[e(S,{class:ue({hide_box:c.value.length}),"file-list":c.value,"onUpdate:fileList":a[0]||(a[0]=o=>c.value=o),headers:J.value,action:z,"list-type":"picture-card",limit:1,"on-preview":K,"on-remove":Q,"on-success":Z,"on-exceed":j},{tip:l(()=>[Ve]),default:l(()=>[e(b,{class:"el-icon--upload"},{default:l(()=>[e(re(ie))]),_:1})]),_:1},8,["class","file-list","headers"]),e(P,{modelValue:L.value,"onUpdate:modelValue":a[1]||(a[1]=o=>L.value=o),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:l(()=>[y("img",{"w-full":"",src:M.value,alt:"Preview Image"},null,8,be)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:3},{default:l(()=>[e(u,{label:"注册开关"},{default:l(()=>[e(k,{modelValue:t.value.registerOffOrOn,"onUpdate:modelValue":a[2]||(a[2]=o=>t.value.registerOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:l(()=>[e(u,{label:"注册审核"},{default:l(()=>[e(k,{modelValue:t.value.registerExamineOffOrOn,"onUpdate:modelValue":a[3]||(a[3]=o=>t.value.registerExamineOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"网站名称",prop:"webName"},{default:l(()=>[e(p,{modelValue:t.value.webName,"onUpdate:modelValue":a[4]||(a[4]=o=>t.value.webName=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"keyWords"},{default:l(()=>[e(p,{modelValue:t.value.keyWords,"onUpdate:modelValue":a[5]||(a[5]=o=>t.value.keyWords=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"个性化域名",prop:"supplierURL"},{default:l(()=>[e(p,{modelValue:t.value.supplierURL,"onUpdate:modelValue":a[6]||(a[6]=o=>t.value.supplierURL=o),style:{width:"8rem"}},null,8,["modelValue"]),e(I,{class:"mx-1"},{default:l(()=>[g(".front-supplier.surveyssaas.com")]),_:1}),e(_,{class:"copy",type:"primary",link:"",onClick:F},{default:l(()=>[g("复制")]),_:1})]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"顶级域名"},{default:l(()=>[e(p,{modelValue:t.value.externalSite,"onUpdate:modelValue":a[7]||(a[7]=o=>t.value.externalSite=o),style:{width:"8rem"}},null,8,["modelValue"]),xe,we,he,Ue,e(_,{class:"copy",onClick:G,type:"primary",link:""},{default:l(()=>[g("解析记录")]),_:1})]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(_,{type:"primary",onClick:R},{default:l(()=>[g(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{label:"高级设置",name:"高级设置"},{default:l(()=>[e(x,{gutter:20},{default:l(()=>[e(n,{span:24},{default:l(()=>[e(u,{label:"最低结算金额",prop:""},{default:l(()=>[e(p,{modelValue:t.value.minimumAmount,"onUpdate:modelValue":a[8]||(a[8]=o=>t.value.minimumAmount=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"供应商税点",prop:""},{default:l(()=>[e(p,{modelValue:t.value.taxRate,"onUpdate:modelValue":a[9]||(a[9]=o=>t.value.taxRate=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},{append:l(()=>[g("%")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(_,{type:"primary",onClick:R},{default:l(()=>[g(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{label:"联系我们",name:"联系我们"},{default:l(()=>[e(x,{gutter:20},{default:l(()=>[e(n,{span:24},{default:l(()=>[e(u,{label:"电子邮箱",prop:"email"},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.email,"onUpdate:modelValue":a[10]||(a[10]=o=>t.value.email=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"手机号码",prop:"phone"},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.phone,"onUpdate:modelValue":a[11]||(a[11]=o=>t.value.phone=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"QQ号码",prop:""},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.qqCode,"onUpdate:modelValue":a[12]||(a[12]=o=>t.value.qqCode=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,{label:"公司地址",prop:""},{default:l(()=>[e(p,{style:{width:"18rem"},modelValue:t.value.address,"onUpdate:modelValue":a[13]||(a[13]=o=>t.value.address=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(_,{type:"primary",onClick:R},{default:l(()=>[g("确认")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1}),e(ge,{ref_key:"recordRef",ref:$,onFetchData:E},null,512)])),[[Y,m.value]])}}}),qe=ve(Oe,[["__scopeId","data-v-9084068f"]]);export{qe as default};
