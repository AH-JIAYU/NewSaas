
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as h}from"./file-Dt_RRgdx.js";import{a as U}from"./projectManagement_materials-BODAlktZ.js";import{D as M}from"./download-C8PHVIy1.js";import{d as P,r,b as i,o as T,e as A,g as e,w as t,t as g,h as _,E as Q}from"./index-VWAStke3.js";const R={style:{flex:"auto"}},S=["src"],O=P({name:"Details",__name:"index",emits:["fetchData"],setup(F,{expose:D,emit:b}){const L=b,n=r(!1),l=r({showData:{},idList:[],materialUrlList:[]}),v=r(""),u=r(!1);async function y(a){l.value.showData=a,n.value=!0,await V(a.materialUrl)}const V=async a=>{a.length&&a.forEach(async o=>{const d=await h.detail({fileName:o.materialUrl});o.url=d.data.fileUrl,o.name=o.materialUrl})},x=a=>{v.value=a.url,u.value=!0},N=async(a,o)=>{a.id?l.value.idList.push(a.id):await h.delete({fileName:a.response.data.qiNiuUrl})},E=()=>{Q.warning({message:"上传失败了,换张图片试试吧",center:!0})},C=(a,o)=>{l.value.materialUrlList.push(a.data.qiNiuUrl)};function k(){l.value.showData.materialUrl.forEach(a=>{M(a.url,a.name)})}async function w(){l.value.materialUrlList.length&&await U.create({id:l.value.showData.id,materialUrlList:l.value.materialUrlList}),l.value.idList.length&&await U.deleteMaterialDetails({idList:l.value.idList}),n.value=!1,L("fetchData"),l.value.idList=[],l.value.materialUrlList=[]}return D({showEdit:y}),(a,o)=>{const d=i("el-divider"),c=i("el-input"),m=i("el-form-item"),p=i("el-col"),I=i("el-row"),f=i("el-button"),j=i("el-upload"),B=i("el-form"),q=i("el-dialog"),z=i("el-drawer");return T(),A("div",null,[e(z,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=s=>n.value=s),title:"详情",direction:"rtl","before-close":w,size:"40%"},{footer:t(()=>[g("div",R,[e(f,{onClick:w},{default:t(()=>[_(" 关闭 ")]),_:1})])]),default:t(()=>[e(d,{"content-position":"left"}),e(B,{"label-width":"80px",inline:!1},{default:t(()=>[e(I,{gutter:20},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(m,{label:"项目ID"},{default:t(()=>[e(c,{disabled:"",value:l.value.showData.projectId},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(m,{label:"项目名称"},{default:t(()=>[e(c,{disabled:"",value:l.value.showData.projectName},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(m,{label:"会员名称"},{default:t(()=>[e(c,{disabled:"",value:l.value.showData.memberChildName},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(j,{"file-list":l.value.showData.materialUrl,"onUpdate:fileList":o[0]||(o[0]=s=>l.value.showData.materialUrl=s),class:"upload-demo",action:"http://47.96.98.102:9100/project/uploadQiniu","on-preview":x,"on-remove":N,"on-success":C,"on-error":E,"list-type":"picture"},{trigger:t(()=>[e(f,{type:"primary",class:"m-4"},{default:t(()=>[_("上传")]),_:1})]),default:t(()=>[e(f,{type:"primary",onClick:k},{default:t(()=>[_(" 下载 ")]),_:1})]),_:1},8,["file-list"])]),_:1}),e(q,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=s=>u.value=s),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:t(()=>[g("img",{"w-full":"",src:v.value,alt:"Preview Image"},null,8,S)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}});export{O as _};
