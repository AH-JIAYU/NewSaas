
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as se,m as Z,O as de,r as i,am as ie,u as me,c as pe,l as ce,b as m,o as u,f as p,w as e,g as o,h as _,j as r,e as y,v as x,F as E,t as h,H as fe,k as j,p as H,E as K,aI as ve,aJ as _e,R as ge}from"./index-Bgpn2lkb.js";import{a as be}from"./department-CT2Pe4Lu.js";import{a as Ve}from"./position_manage-CLGAPFTn.js";import{u as ye}from"./department-BGNQaZ1m.js";import{u as he}from"./tenant_role-RWa-ztYu.js";import{u as Ne}from"./configuration_manager-C4Dn6d99.js";import"./configuration_role-BumZyDQb.js";const Q=g=>(ve("data-v-d30315fe"),g=g(),_e(),g),we=Q(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"基本信息")],-1)),Ie=Q(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"角色信息")],-1)),xe={class:"card-header"},Ee={class:"leftTitle"},Se={key:0,style:{"margin-left":"20px","font-size":"14px"}},ke=se({__name:"index",props:Z(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:Z(["success"],["update:modelValue"]),setup(g,{emit:W}){de();const X=Ne(),A=i([]),M=i([]),q=i(),Y=ie(),ee=i(),ae=he(),R=i(),le=ye(),F=i(),te=i(!1),P=i(),$=i(),oe=i(),b=g,G=W,z=me(g,"modelValue"),re=pe(()=>b.id===""?"新增用户":"编辑用户"),v=i(),ne=i([]),l=i({id:b.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),S=i({userName:[{required:!0,message:"请输入用户名"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(s,t,n)=>{const d=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;l.value.phoneNumber?d.test(l.value.phoneNumber)?n():n(new Error("请输入合法手机号")):n()},trigger:"blur"}],email:[{validator:(s,t,n)=>{const d=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;l.value.email?d.test(l.value.email)?n():n(new Error("请输入合法邮箱")):n()},trigger:"blur"}]}),J=async s=>{const{data:t}=await be.departmentGroup({id:s});M.value=t,oe.value=t[0].director};function ue(){l.value.email||(S.value.email=[],v.value.clearValidate("email")),l.value.phoneNumber||(S.value.phoneNumber=[],v.value.clearValidate("phoneNumber")),l.value.id?v.value&&v.value.validate(s=>{if(s){const{id:t,phoneNumber:n,email:d,password:f,name:C,country:D,active:N,type:w,role:U,groupId:B,positionId:V,departmentId:T,userName:L}=l.value,c={id:t,phoneNumber:n,email:d,password:f,name:C,country:D,active:N,type:w,role:U,groupId:B,positionId:V,departmentId:T,userName:L};$.value===c.phoneNumber&&delete c.phoneNumber,P.value===c.email&&delete c.email,c.password||delete c.password,H.edit(c).then(()=>{K.success({message:"编辑成功",center:!0}),G("success"),k()})}}):v.value&&v.value.validate(s=>{s&&H.create(l.value).then(()=>{K.success({message:"新增成功",center:!0}),G("success"),k()})})}function k(){z.value=!1}const O=s=>s==null?void 0:s.reduce((t,n)=>Array.isArray(n)?t.concat(O(n)):t.concat(n),[]);return ce(async()=>{const{data:s}=await Ve.list({page:1,limit:10,id:null,name:"",active:null});q.value=s.data,A.value=await X.getStaff(),R.value=await ae.getRole(),F.value=await le.getDepartment(),ee.value=await Y.getCountry(),b.id!==""&&b.row&&(S.value.password=[],l.value=JSON.parse(b.row),P.value=l.value.email,$.value=l.value.phoneNumber,l.value.departmentId&&J(l.value.departmentId),te.value=!0),ne.value=O(b.dataList)}),(s,t)=>{const n=m("el-input"),d=m("el-form-item"),f=m("el-col"),C=m("el-option"),D=m("el-select"),N=m("el-row"),w=m("el-card"),U=m("el-radio"),B=m("el-radio-group"),V=m("el-text"),T=m("ElForm"),L=m("ElButton"),c=m("ElDrawer");return u(),p(c,{modelValue:z.value,"onUpdate:modelValue":t[9]||(t[9]=a=>z.value=a),title:r(re),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:k},{footer:e(()=>[o(L,{size:"large",onClick:k},{default:e(()=>[_(" 取消 ")]),_:1}),o(L,{type:"primary",size:"large",onClick:ue},{default:e(()=>[_(" 确定 ")]),_:1})]),default:e(()=>[o(T,{ref_key:"formRef",ref:v,model:r(l),rules:r(S),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[o(w,{class:"box-card"},{header:e(()=>[we]),default:e(()=>[o(N,{gutter:24},{default:e(()=>[o(f,{span:8},{default:e(()=>[o(d,{label:"用户名",prop:"userName"},{default:e(()=>[o(n,{modelValue:r(l).userName,"onUpdate:modelValue":t[0]||(t[0]=a=>r(l).userName=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(d,{label:"姓名",prop:"name"},{default:e(()=>[o(n,{modelValue:r(l).name,"onUpdate:modelValue":t[1]||(t[1]=a=>r(l).name=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(d,{label:"手机号",prop:"phoneNumber"},{default:e(()=>[o(n,{modelValue:r(l).phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=a=>r(l).phoneNumber=a),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(d,{label:"邮箱",prop:"email"},{default:e(()=>[o(n,{modelValue:r(l).email,"onUpdate:modelValue":t[3]||(t[3]=a=>r(l).email=a),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(d,{label:"部门"},{default:e(()=>[o(D,{modelValue:r(l).departmentId,"onUpdate:modelValue":t[4]||(t[4]=a=>r(l).departmentId=a),placeholder:"请选择部门",clearable:"",filterable:"",onChange:J},{default:e(()=>[(u(!0),y(E,null,x(r(F),a=>(u(),p(C,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(d,{label:"职位",prop:""},{default:e(()=>[o(D,{modelValue:r(l).positionId,"onUpdate:modelValue":t[5]||(t[5]=a=>r(l).positionId=a),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[6]||(t[6]=()=>{})},{default:e(()=>[(u(!0),y(E,null,x(r(q),a=>(u(),p(C,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(w,{class:"box-card"},{header:e(()=>[Ie]),default:e(()=>[o(N,{gutter:24},{default:e(()=>[o(d,{label:"分配角色:"},{default:e(()=>{var a;return[(a=r(R))!=null&&a.length?(u(),p(B,{key:0,modelValue:r(l).role,"onUpdate:modelValue":t[7]||(t[7]=I=>r(l).role=I)},{default:e(()=>[(u(!0),y(E,null,x(r(R),I=>(u(),p(U,{key:I.id,value:I.roleName,label:I.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(u(),p(V,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1}),o(w,{class:"box-card"},{header:e(()=>[h("div",xe,[h("div",Ee,[_(" 小组信息"),r(l).director?(u(),y("span",Se,[_("负责人:"),(u(!0),y(E,null,x(r(A),a=>(u(),p(V,{key:a.id},{default:e(()=>[a.id===r(l).director?(u(),p(V,{key:0},{default:e(()=>[_(fe(a.name),1)]),_:2},1024)):j("",!0)]),_:2},1024))),128))])):j("",!0)])])]),default:e(()=>[o(N,{gutter:24},{default:e(()=>[o(d,{label:"分配小组:"},{default:e(()=>[r(M).length?(u(),p(B,{key:0,modelValue:r(l).groupId,"onUpdate:modelValue":t[8]||(t[8]=a=>r(l).groupId=a)},{default:e(()=>[(u(!0),y(E,null,x(r(M),a=>(u(),p(U,{key:a.id,value:a.id,label:a.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(u(),p(V,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ae=ge(ke,[["__scopeId","data-v-d30315fe"]]);export{Ae as default};
