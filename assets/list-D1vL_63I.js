
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Pe}from"./index-DbONgp_9.js";import{_ as Me}from"./index-Dc4DI-Oe.js";import{d as Te,aN as Fe,r as p,l as Ae,n as Q,X as U,a as v,q as Ge,o as r,b as z,y,f as o,w as i,g as f,aA as $,s as R,e as u,z as C,az as P,aq as W,F as M,t as T,i as L,aM as He,j as g,aO as F,E as A,p as G,_ as Ke,aH as Oe,aI as je,L as qe,ao as Y}from"./index-CTDaT2Z5.js";import{a as H}from"./department-DVBzUfez.js";import{u as Je}from"./department-CuSTJ5vm.js";import{u as Xe}from"./position_manage-Fl-0qL5r.js";import Qe from"./index-C1nMlGGP.js";import We from"./index-DKzQZ4wP.js";import Ye from"./index-labCQIqh.js";import Ze from"./index-DRR2G5tA.js";import ea from"./index-C2ShkBGP.js";import"./index-DKWiqhyZ.js";import"./position_manage-DNNWXLok.js";import"./configuration_manager-4_JVXkqt.js";import"./tenantDictionary-CGdEIKC_.js";import"./tenant_role-D4dJkjYZ.js";import"./configuration_role-B6U9bSOJ.js";const aa=E=>(Oe("data-v-7c22af31"),E=E(),je(),E),la={class:"absolute-container"},ta={class:"page-main"},ia={class:"custom-tree-node"},oa=["title"],na={class:"code"},ra={class:"actions"},sa={class:"dictionary-container"},ua={class:"copyId tableSmall"},da={class:"id oneLine"},ca={class:"dictionary-container"},pa=aa(()=>y("div",{class:"empty"},"请在左侧新增或选择一个部门",-1)),va=[pa],Z=Te({name:"department",__name:"list",setup(E){const{pagination:I,getParams:ma,onSizeChange:ee,onCurrentChange:ae,onSortChange:le}=Fe(),x=Xe(),K=p(),te=Ae(),ie=p([]),B=Je(),O=p(),oe=p([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),ne=[{label:"启用",value:!0},{label:"禁用",value:!1}],re=p(),j=p(),b=p({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),q=p(),se=p(),t=p({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),J=p(),n=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),m=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",name:""},row:"",loading:!1});p();const s=p({loading:!1,search:{organizationalStructureId:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});async function S(){try{n.value.loading=!0,s.value.search.organizationalStructureId="";const e={...n.value.search},l=await H.list(e);n.value.tree=l.data,n.value.loading=!1}catch{}finally{n.value.loading=!1}}Q(()=>{S()}),U(()=>n.value.search,e=>{J.value.filter(e)});function ue(e,l){return e?l.label.includes(e):!0}function de(e){n.value.currentData=e,n.value.dialog.parentId="",n.value.dialog.id="",n.value.dialog.visible=!0}function ce(e){m.value.currentData=e,m.value.dialog.parentId=(e==null?void 0:e.id)??"",m.value.dialog.name=(e==null?void 0:e.name)??"",m.value.dialog.id="",m.value.dialog.visible=!0}function pe(e,l){n.value.currentNode=e,n.value.currentData=l,n.value.row=JSON.stringify(l),n.value.dialog.parentId=e.parent.data.id??"",n.value.dialog.id=l.id,n.value.dialog.visible=!0}function ve(e,l){F.confirm(`确认删除「${l.name}」吗？`,"确认信息").then(()=>{H.delete({id:l.id}).then(()=>{A.success({message:"删除成功",center:!0});const d=e.parent,D=d.data.children||d.data,w=D.findIndex(V=>V.id===l.id);D.splice(w,1),n.value.tree=[...n.value.tree]})})}function me(e){console.log("data",e),I.value.page=1,e.id&&(t.value.dialog.parentId=e.id),s.value.search.organizationalStructureId=e.id}U(()=>s.value.search.organizationalStructureId,()=>{X()});async function X(){try{s.value.loading=!0;const e={...s.value.search},l=await H.itemlist(e);s.value.loading=!1,s.value.dataList=l.data,s.value.dataList.forEach(d=>{d.enableLoading=!1}),I.value.total=l.data.length}catch{}finally{s.value.loading=!1}}async function h(){const e={...t.value.search},l=await G.list(e);l.data&&(t.value.dataList=l.data.data,I.value.total=+l.data.total)}Q(async()=>{try{b.value.loading=!0,ie.value=await te.getCountry(),O.value=await(B==null?void 0:B.getDepartment())||[],K.value=await(x==null?void 0:x.getPositionManage())||[],h(),oe.value.forEach(e=>{e.checked&&t.value.checkList.push(e.prop)}),b.value.loading=!1}catch{}finally{b.value.loading=!1}}),U(()=>b.value.search,e=>{re.value.filter(e)});function ge(e){return new Promise(l=>{F.confirm(`确认${e.active?"禁用":"启用"}「${e.name}」吗？`,"确认信息").then(()=>{try{b.value.loading=!0,G.edit({id:e.id,account:null,name:null,sex:null,phoneNumber:null,active:!e.active}).then(()=>(A.success({message:`${e.active?"禁用":"启用"}成功`,center:!0}),h(),b.value.loading=!1,l(!0))).catch(()=>(b.value.loading=!1,l(!1)))}catch{}finally{b.value.loading=!1}}).catch(()=>l(!1))})}function fe(e){ee(e).then(()=>{t.value.search.limit=e,h()})}function he(e=1){ae(e).then(()=>{t.value.search.page=e,h()})}function _e({prop:e,order:l}){le(e,l).then(()=>h())}function ye(e){console.log("row",e),console.log("userForm.value.dialog.parentId",t.value.dialog.parentId),t.value.dialog.id="",t.value.dialog.visible=!0,t.value.dialog.level=1}const be=e=>{q.value=e[0]};function ke(){const{name:e,id:l}=q.value;F.confirm(`确认将「${e}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{G.reset({id:l}).then(()=>{A.success({message:"重置成功",center:!0}),h()})}).catch(()=>{})}function Ie(e){t.value.row=JSON.stringify(e),t.value.dialog.id=e.id,t.value.dialog.parentId=e.parentId,t.value.dialog.visible=!0}function we(e){j.value.showEdit(e)}function Ce(){Object.assign(t.value.search,{id:"",userName:"",departmentId:null,active:null}),h()}return(e,l)=>{const d=v("ElButton"),D=v("ElButtonGroup"),w=Ke,V=v("ElInput"),Le=v("ElTree"),Se=v("ElScrollbar"),De=v("el-option"),Ve=v("ElSelect"),Ee=v("ElSpace"),k=v("ElTableColumn"),Ne=v("ElSwitch"),ze=Me,_=v("el-text"),xe=v("el-empty"),Be=v("ElTable"),Ue=v("ElPagination"),$e=Pe,Re=Ge("loading");return r(),z("div",la,[y("div",ta,[o($e,{"hide-left-side-toggle":""},{leftSide:i(()=>[o(D,{class:"btns"},{default:i(()=>[o(d,{type:"primary",class:"add",onClick:l[0]||(l[0]=a=>de())},{default:i(()=>[f(" 新增部门 ")]),_:1})]),_:1}),o(V,{modelValue:n.value.search.name,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.search.name=a),placeholder:"请输入关键词筛选",clearable:"",class:"search",onKeydown:$(S,["enter"])},{append:i(()=>[o(d,{onClick:S},{default:i(()=>[o(w,{name:"i-ep:search"})]),_:1})]),_:1},8,["modelValue"]),o(Se,{class:"tree"},{default:i(()=>[R((r(),u(Le,{ref_key:"dictionaryRef",ref:J,data:n.value.tree,"filter-node-method":ue,"default-expand-all":"",onNodeClick:me},{default:i(({node:a,data:c})=>[y("div",ia,[y("div",{class:"label",title:a.label},C(c.name),9,oa),y("div",na,C(c.organizationalStructurePersonList.map(N=>N.userName).join("，")),1),y("div",ra,[o(D,null,{default:i(()=>[o(d,{type:"primary",plain:"",size:"default",onClick:P(N=>ce(c),["stop"])},{icon:i(()=>[o(w,{name:"i-ep:plus"})]),_:2},1032,["onClick"]),o(d,{type:"info",plain:"",size:"default",onClick:P(N=>pe(a,c),["stop"])},{icon:i(()=>[o(w,{name:"i-ep:edit"})]),_:2},1032,["onClick"]),o(d,{type:"danger",plain:"",size:"default",onClick:P(N=>ve(a,c),["stop"])},{icon:i(()=>[o(w,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["data","filter-node-method"])),[[Re,n.value.loading]])]),_:1})]),default:i(()=>[R(y("div",sa,[o(Ee,{wrap:""},{default:i(()=>[o(d,{type:"primary",onClick:l[2]||(l[2]=a=>ye())},{default:i(()=>[f(" 新增员工 ")]),_:1}),o(d,{onClick:ke},{default:i(()=>[f(" 重置密码 ")]),_:1}),o(Ve,{modelValue:t.value.search.active,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.search.active=a),"value-key":"",placeholder:"用户状态",style:{width:"200px"},clearable:"",filterable:""},{default:i(()=>[(r(),z(M,null,T(ne,a=>o(De,{key:a.label,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o(V,{modelValue:t.value.search.id,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.search.id=a),placeholder:"员工ID",clearable:"",style:{width:"200px"},onKeydown:$(h,["enter"])},null,8,["modelValue"]),o(V,{modelValue:t.value.search.userName,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.search.userName=a),placeholder:"用户名",clearable:"",style:{width:"200px"},onKeydown:$(h,["enter"])},null,8,["modelValue"]),o(d,{type:"primary",onClick:h},{icon:i(()=>[o(w,{name:"i-ep:search"})]),_:1}),o(d,{onClick:Ce},{icon:i(()=>[o(w,{name:"i-ep:refresh"})]),_:1})]),_:1}),o(Be,{ref_key:"userItemRef",ref:se,data:t.value.dataList,border:t.value.border,size:t.value.lineHeight,stripe:t.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:_e,onSelectionChange:l[6]||(l[6]=a=>t.value.selectionDataList=a),"row-key":"id","default-expand-all":"",onSelect:be},{empty:i(()=>[o(xe,{image:L(He),"image-size":300},null,8,["image"])]),default:i(()=>[o(k,{type:"selection",align:"left",fixed:""}),t.value.checkList.includes("active")?(r(),u(k,{key:0,align:"left",prop:"active",label:"状态"},{default:i(a=>[o(Ne,{modelValue:a.row.active,"onUpdate:modelValue":c=>a.row.active=c,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>ge(a.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):g("",!0),t.value.checkList.includes("id")?(r(),u(k,{key:1,align:"left",width:"180",prop:"id",label:"员工ID"},{default:i(({row:a})=>[y("div",ua,[y("div",da,"ID: "+C(a.id),1),o(ze,{class:"copy",content:a.id},null,8,["content"])])]),_:1})):g("",!0),t.value.checkList.includes("userName")?(r(),u(k,{key:2,align:"left",width:"130",prop:"userName",label:"用户名"},{default:i(({row:a})=>[o(_,{class:"tableBig"},{default:i(()=>[f(C(a.userName?a.userName:"-"),1)]),_:2},1024)]),_:1})):g("",!0),t.value.checkList.includes("phoneNumber")?(r(),u(k,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:i(({row:a})=>[o(_,{class:"tableBig"},{default:i(()=>[f(C(a.phoneNumber?a.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):g("",!0),t.value.checkList.includes("email")?(r(),u(k,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:i(({row:a})=>[o(_,{class:"tableBig"},{default:i(()=>[f(C(a.email?a.email:"-"),1)]),_:2},1024)]),_:1})):g("",!0),t.value.checkList.includes("departmentId")?(r(),u(k,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:i(({row:a})=>[a.departmentId?(r(),u(_,{key:0,class:"tableBig"},{default:i(()=>[(r(!0),z(M,null,T(O.value,c=>(r(),u(_,null,{default:i(()=>[a.departmentId===c.id?(r(),u(_,{key:0},{default:i(()=>[f(C(c.name?c.name:"-"),1)]),_:2},1024)):g("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),u(_,{key:1,class:"tableBig"},{default:i(()=>[f("-")]),_:1}))]),_:1})):g("",!0),t.value.checkList.includes("positionId")?(r(),u(k,{key:6,align:"left",prop:"positionId",label:"职位"},{default:i(({row:a})=>[a.positionId?(r(),u(_,{key:0,class:"tableBig"},{default:i(()=>[(r(!0),z(M,null,T(K.value,c=>(r(),u(_,null,{default:i(()=>[a.positionId===c.id?(r(),u(_,{key:0},{default:i(()=>[f(C(c.name?c.name:"-"),1)]),_:2},1024)):g("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),u(_,{key:1,class:"tableBig"},{default:i(()=>[f("-")]),_:1}))]),_:1})):g("",!0),o(k,{label:"操作",fixed:"right",width:"200",align:"left"},{default:i(a=>[o(d,{type:"primary",size:"small",plain:"",onClick:c=>Ie(a.row)},{default:i(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),o(d,{type:"warning",size:"small",plain:"",onClick:c=>we(a.row)},{default:i(()=>[f(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"]),o(Ue,{"current-page":L(I).page,total:L(I).total,"page-size":L(I).size,"page-sizes":L(I).sizes,layout:L(I).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:fe,onCurrentChange:he},null,8,["current-page","total","page-size","page-sizes","layout"])],512),[[W,s.value.search.organizationalStructureId]]),R(y("div",ca,va,512),[[W,!s.value.search.organizationalStructureId]])]),_:1}),n.value.dialog.visible?(r(),u(Qe,{key:0,id:n.value.dialog.id,modelValue:n.value.dialog.visible,"onUpdate:modelValue":l[7]||(l[7]=a=>n.value.dialog.visible=a),row:n.value.row,"parent-id":n.value.dialog.parentId,tree:n.value.tree,onGetList:S},null,8,["id","modelValue","row","parent-id","tree"])):g("",!0),m.value.dialog.visible?(r(),u(We,{key:1,id:m.value.dialog.id,modelValue:m.value.dialog.visible,"onUpdate:modelValue":l[8]||(l[8]=a=>m.value.dialog.visible=a),row:m.value.row,"parent-id":m.value.dialog.parentId,name:m.value.dialog.name,tree:m.value.tree,onGetList:S},null,8,["id","modelValue","row","parent-id","name","tree"])):g("",!0),s.value.dialog.visible?(r(),u(Ye,{key:2,id:s.value.dialog.id,modelValue:s.value.dialog.visible,"onUpdate:modelValue":l[9]||(l[9]=a=>s.value.dialog.visible=a),"catalogue-id":s.value.search.organizationalStructureId,"parent-id":s.value.dialog.parentId,level:s.value.dialog.level,tree:n.value.tree,dataList:s.value.dataList,row:s.value.row,onSuccess:X},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):g("",!0),t.value.dialog.visible?(r(),u(Ze,{key:3,id:t.value.dialog.id,modelValue:t.value.dialog.visible,"onUpdate:modelValue":l[10]||(l[10]=a=>t.value.dialog.visible=a),"catalogue-id":t.value.search.catalogueId,"parent-id":t.value.dialog.parentId,level:t.value.dialog.level,tree:b.value.tree,dataList:t.value.dataList,row:t.value.row,onSuccess:h},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):g("",!0),o(ea,{ref_key:"detailRef",ref:j},null,512)])])}}});typeof Y=="function"&&Y(Z);const xa=qe(Z,[["__scopeId","data-v-7c22af31"]]);export{xa as default};
