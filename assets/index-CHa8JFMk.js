
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as L}from"./survey_vipGroup-v-Vy4OPV.js";import{o as h,s as E}from"./apiLoading-C0msQP1F.js";import{u as O}from"./survey_vipGroup-CWYzVnw2.js";import{u as P}from"./survey_vip-DpzfeXLz.js";import{d as Q,r as c,a5 as W,c as X,a as s,o as m,e as f,w as t,s as N,f as e,g as y,i as r,b,t as k,H as F,j as Y,F as x,I as Z,E as U,R as ee}from"./index-DQuRfXxB.js";import"./survey_vip-CEyb59Tn.js";const te={style:{float:"left"}},ae={key:0,style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},le={class:"radius p-2 flex gap-2"},oe={class:"dialog-footer"},re=Q({__name:"index",emits:["fetch-data"],setup(se,{expose:B,emit:R}){const T=O(),M=P(),q=R,d=c(!1),g=c([]),v=c("新增会员组"),l=c({memberGroupName:"",groupStatus:2,groupMemberIdList:[],groupLeaderMemberId:""}),_=c({}),z=W({memberGroupName:[{required:!0,message:"请输入会员组名称",trigger:"blur"}],groupStatus:[{required:!0,message:"请选择组状态",trigger:"change"}]});async function j(u){if(!u)v.value="新增会员组";else{v.value="编辑会员组";const{data:o}=await h(L.detail({memberGroupId:u.memberGroupId}));l.value=o}g.value=await h(M.getNickNameList()),d.value=!0}const D=u=>{const o=l.value.groupMemberIdList.findIndex(V=>V===u.memberId);l.value.groupMemberIdList.splice(o,1)},w=X(()=>{const u=l.value.groupMemberIdList.includes(l.value.groupLeaderMemberId);return l.value.groupLeaderMemberId=u?l.value.groupLeaderMemberId:"",g.value.filter(o=>l.value.groupMemberIdList.includes(o.memberId))});function I(){d.value=!1,_.value.resetFields()}const H=()=>{_.value&&_.value.validate(async u=>{if(u){if(l.value.memberGroupId){const{status:o}=await E(L.edit(l.value));o===1&&U.success({message:"编辑成功",center:!0})}else{const{status:o}=await E(L.create(l.value));o===1&&U.success({message:"新增成功",center:!0})}T.GroupNameList=null,M.NickNameList=null,I(),q("fetch-data")}})};return B({showEdit:j}),(u,o)=>{const V=s("el-input"),i=s("el-form-item"),n=s("el-col"),p=s("el-row"),$=s("el-switch"),G=s("el-option"),S=s("el-select"),A=s("el-tag"),J=s("ElForm"),C=s("el-button"),K=s("el-drawer");return m(),f(K,{modelValue:r(d),"onUpdate:modelValue":o[4]||(o[4]=a=>Z(d)?d.value=a:null),"close-on-click-modal":!1,size:"50%",title:r(v),onClose:I},{footer:t(()=>[N("div",oe,[e(C,{onClick:I},{default:t(()=>[y(" 取消 ")]),_:1}),e(C,{type:"primary",onClick:H},{default:t(()=>[y(" 确定 ")]),_:1})])]),default:t(()=>[e(J,{ref_key:"formRef",ref:_,rules:r(z),model:r(l),"label-width":"100px"},{default:t(()=>[e(p,{gutter:10},{default:t(()=>[e(n,{span:8},{default:t(()=>[e(i,{label:"会员组名称",prop:"memberGroupName"},{default:t(()=>[e(V,{modelValue:r(l).memberGroupName,"onUpdate:modelValue":o[0]||(o[0]=a=>r(l).memberGroupName=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:8}),e(n,{span:8})]),_:1}),e(p,{gutter:10},{default:t(()=>[e(n,{span:8},{default:t(()=>[e(i,{label:"组状态",prop:"groupStatus"},{default:t(()=>[e($,{"active-value":2,"inactive-value":1,"active-text":"开启","inactive-text":"关闭","inline-prompt":"",modelValue:r(l).groupStatus,"onUpdate:modelValue":o[1]||(o[1]=a=>r(l).groupStatus=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:8})]),_:1}),e(p,{gutter:10},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(i,{label:"组成员",prop:"groupMemberIdList"},{default:t(()=>[e(S,{multiple:"","collapse-tags":"","collapse-tags-tooltip":"",modelValue:r(l).groupMemberIdList,"onUpdate:modelValue":o[2]||(o[2]=a=>r(l).groupMemberIdList=a),placeholder:"模糊搜索",clearable:""},{default:t(()=>[(m(!0),b(x,null,k(r(g),a=>(m(),f(G,{value:a.memberId,label:a.memberNickname,disabled:a.memberType===1},{default:t(()=>[N("span",te,F(a.memberNickname),1),a.memberType===1?(m(),b("span",ae," 已在其他组中 ")):Y("",!0)]),_:2},1032,["value","label","disabled"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{gutter:10},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(i,null,{default:t(()=>[N("div",le,[(m(!0),b(x,null,k(r(w),a=>(m(),f(A,{key:a,closable:"","disable-transitions":!1,onClose:ue=>D(a)},{default:t(()=>[y(F(a.memberNickname),1)]),_:2},1032,["onClose"]))),128))])]),_:1})]),_:1})]),_:1}),e(p,{gutter:10},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(i,{label:"组长"},{default:t(()=>[e(S,{modelValue:r(l).groupLeaderMemberId,"onUpdate:modelValue":o[3]||(o[3]=a=>r(l).groupLeaderMemberId=a),placeholder:"模糊搜索"},{default:t(()=>[(m(!0),b(x,null,k(r(w),a=>(m(),f(G,{value:a.memberId,label:a.memberNickname},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),_e=ee(re,[["__scopeId","data-v-6aa52e26"]]);export{_e as default};
