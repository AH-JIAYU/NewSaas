
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as de,m as G,r as d,l as ie,u as ce,c as pe,n as me,a as i,o as c,e as _,w as e,y as h,f as l,g,i as s,b as N,t as q,F as A,z as fe,j as J,p as O,E as Q,aG as ve,aH as _e,L as ge}from"./index-BDWalcy-.js";import{a as he}from"./department-DqumlB9E.js";import{a as ye}from"./position_manage-DLIYrV4R.js";import{u as be}from"./tenant_role-BqEkPNe0.js";import{u as Ve}from"./configuration_manager-Ca3gHjq-.js";import"./configuration_role-DthradBD.js";const W=y=>(ve("data-v-15617757"),y=y(),_e(),y),ke=W(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"基本信息")],-1)),we={class:"card-header"},xe={class:"leftTitle"},Se={key:0,style:{"margin-left":"20px","font-size":".875rem"}},Ce=W(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"角色信息")],-1)),Ie={class:"flex-c"},Ee=de({__name:"index",props:G(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:G(["success","getList"],["update:modelValue"]),setup(y,{emit:X}){const Y=Ve(),D=d([]),F=d(),ee=ie(),ae=d(),le=be(),z=d(),H=d(),te=d(!1),Z=d(),$=d(),m=y,S=X,b=d(),L=ce(y,"modelValue"),oe=pe(()=>m.id===""?"新增用户":"编辑用户"),se={children:"children",label:"name"},v=d(),ne=d([]),t=d({id:m.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",organizationalStructureId:""}),p=d([]),C=d({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{validator:(u,o,n)=>{const r=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;t.value.phone?r.test(t.value.phone)?n():n(new Error("请输入合法手机号")):n()},trigger:"blur"}],email:[{validator:(u,o,n)=>{const r=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;t.value.email?r.test(t.value.email)?n():n(new Error("请输入合法邮箱")):n()},trigger:"blur"}]});function re(){t.value.email||(C.value.email=[],v.value.clearValidate("email")),t.value.phone||(C.value.phone=[],v.value.clearValidate("phone")),p.value=b.value.getCheckedKeys(!1);const u=b.value.getCheckedKeys(),o=b.value.getHalfCheckedKeys(),n=u.concat(o);t.value.organizationalStructureId=n[0],t.value.id?v.value&&v.value.validate(r=>{if(r){const{id:f,phone:B,email:P,password:V,name:k,country:w,active:U,type:M,role:R,positionId:K,organizationalStructureId:E,userName:T}=t.value,a={id:f,phone:B,email:P,password:V,name:k,country:w,active:U,type:M,role:R,positionId:K,organizationalStructureId:E,userName:T};$.value===a.phone&&delete a.phone,Z.value===a.email&&delete a.email,a.password||delete a.password,O.edit(a).then(()=>{Q.success({message:"编辑成功",center:!0}),S("success"),S("getList"),I()})}}):v.value&&v.value.validate(r=>{r&&O.create(t.value).then(()=>{Q.success({message:"新增成功",center:!0}),S("success"),S("getList"),I()})})}function I(){L.value=!1}const j=u=>u==null?void 0:u.reduce((o,n)=>Array.isArray(n)?o.concat(j(n)):o.concat(n),[]),ue=(u,o)=>{o?(b.value.getCheckedKeys().forEach(r=>{r!==u.id&&b.value.setChecked(r,!1)}),p.value=[u.id]):p.value=p.value.filter(n=>n!==u.id)};return me(async()=>{p.value=[],p.value.push(m.parentId);const{data:u}=await ye.list({page:1,limit:10,id:null,name:"",active:null});F.value=u.data,D.value=await Y.getStaff(),z.value=await le.getRole();const o=await he.list({name:""});o.data&&(H.value=o.data),ae.value=await ee.getCountry(),m.id!==""&&m.row&&(C.value.password=[],t.value=JSON.parse(m.row),p.value||(p.value=[]),p.value.push(m.parentId),Z.value=t.value.email,$.value=t.value.phone,te.value=!0),ne.value=j(m.dataList)}),(u,o)=>{const n=i("el-input"),r=i("el-form-item"),f=i("el-col"),B=i("el-option"),P=i("el-select"),V=i("el-text"),k=i("el-row"),w=i("el-card"),U=i("el-tree"),M=i("el-radio"),R=i("el-radio-group"),K=i("ElForm"),E=i("ElButton"),T=i("ElDrawer");return c(),_(T,{modelValue:L.value,"onUpdate:modelValue":o[7]||(o[7]=a=>L.value=a),title:s(oe),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:I},{footer:e(()=>[h("div",Ie,[l(E,{size:"large",onClick:I},{default:e(()=>[g(" 取消 ")]),_:1}),l(E,{type:"primary",size:"large",onClick:re},{default:e(()=>[g(" 确定 ")]),_:1})])]),default:e(()=>[l(K,{ref_key:"formRef",ref:v,model:s(t),rules:s(C),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[l(w,{class:"box-card"},{header:e(()=>[ke]),default:e(()=>[l(k,{gutter:24},{default:e(()=>[l(f,{span:8},{default:e(()=>[l(r,{label:"用户名",prop:"userName"},{default:e(()=>[l(n,{modelValue:s(t).userName,"onUpdate:modelValue":o[0]||(o[0]=a=>s(t).userName=a),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:8},{default:e(()=>[l(r,{label:"姓名",prop:""},{default:e(()=>[l(n,{modelValue:s(t).name,"onUpdate:modelValue":o[1]||(o[1]=a=>s(t).name=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:8},{default:e(()=>[l(r,{label:"手机号",prop:"phone"},{default:e(()=>[l(n,{modelValue:s(t).phone,"onUpdate:modelValue":o[2]||(o[2]=a=>s(t).phone=a),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:8},{default:e(()=>[l(r,{label:"邮箱",prop:"email"},{default:e(()=>[l(n,{modelValue:s(t).email,"onUpdate:modelValue":o[3]||(o[3]=a=>s(t).email=a),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:8},{default:e(()=>[l(r,{label:"职位",prop:""},{default:e(()=>[l(P,{modelValue:s(t).positionId,"onUpdate:modelValue":o[4]||(o[4]=a=>s(t).positionId=a),placeholder:"请选择职位",clearable:"",filterable:"",onChange:o[5]||(o[5]=()=>{})},{default:e(()=>[(c(!0),N(A,null,q(s(F),a=>(c(),_(B,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(f,{span:8},{default:e(()=>[l(r,{label:"初始密码",prop:""},{default:e(()=>[l(V,null,{default:e(()=>[g("123456")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(w,{class:"box-card"},{header:e(()=>[h("div",we,[h("div",xe,[g(" 部门信息"),s(t).enableChargePerson?(c(),N("span",Se,[g("PM:"),(c(!0),N(A,null,q(s(D),a=>(c(),_(V,{key:a.id},{default:e(()=>[a.id===s(t).id?(c(),_(V,{key:0},{default:e(()=>[g(fe(a.userName),1)]),_:2},1024)):J("",!0)]),_:2},1024))),128))])):J("",!0)])])]),default:e(()=>[l(k,{gutter:24},{default:e(()=>[l(r,{label:"分配部门:"},{default:e(()=>[l(U,{style:{"max-width":"600px"},ref_key:"treeRef",ref:b,data:s(H),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":s(p),"default-expand-all":"",props:se,onCheckChange:ue},null,8,["data","default-checked-keys"])]),_:1})]),_:1})]),_:1}),l(w,{class:"box-card"},{header:e(()=>[Ce]),default:e(()=>[l(k,{gutter:24},{default:e(()=>[l(r,{label:"分配角色:"},{default:e(()=>{var a;return[(a=s(z))!=null&&a.length?(c(),_(R,{key:0,modelValue:s(t).role,"onUpdate:modelValue":o[6]||(o[6]=x=>s(t).role=x)},{default:e(()=>[(c(!0),N(A,null,q(s(z),x=>(c(),_(M,{key:x.id,value:x.roleName,label:x.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(c(),_(V,{key:1},{default:e(()=>[g("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ke=ge(Ee,[["__scopeId","data-v-15617757"]]);export{Ke as default};
