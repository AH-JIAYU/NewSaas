
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-BjbLTB7h.js";import{s as C,ae as $,d as w,r as G,a as k,o as r,b as p,f as i,w as l,p as t,g as a,F as S,q as M,Q as x,i as c,D as n,e as E,j,G as U,aJ as q,aK as F,P as A}from"./index-DIUeIGtu.js";const V={list:d=>C.post("tenantBind/getProjectAllocationList",d),getTenantMeasurementList:d=>C.post("tenantBind/getTenantMeasurementList",d),getQuestionnaireClickList:d=>C.post("tenantBind/getQuestionnaireClickList",d)},H=$("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"]})),J=H,O=d=>(q("data-v-002a148a"),d=d(),F(),d),K={class:"milestone"},R={class:"left"},W={class:"left-top-left p-4"},X={class:"project"},Y={class:"projectName flex-b"},Z={class:"projectId"},ee={class:"price flex-b"},te={key:0,class:"left-top-right p-4"},se={class:"tenant"},ne={key:0,class:"left-bottom"},ae=O(()=>t("div",{class:"line"},null,-1)),oe={class:"allocation"},le=O(()=>t("div",{class:"arrow"},null,-1)),ie={key:0,class:"right"},re={class:"clickIdItem m-2"},ce={class:"clickIdItem-left"},ue={class:"clickIdItem-right"},pe={class:"title"},de=O(()=>t("li",null,"点击ID:",-1)),_e={key:0},fe={style:{flex:"auto"}},Ie=w({name:"Edit",__name:"index",setup(d,{expose:N}){const h=J(),b=G(!1),m=G({currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function B(o){const y={linkId:o.linkId,projectId:o.projectId},_=await V.getTenantMeasurementList(y),u=_.data.tenantMeasurementInfoList.findIndex(s=>s.allocationTenantId===_.data.currentTenantId),f=_.data.tenantMeasurementInfoList;f.splice(0,u);const g=f.filter(s=>s.type===1),I=f.filter(s=>s.type===2),e=f.filter(s=>s.type===3),v=[...g];if(I.length){const s=I.map(L=>L.memberGroupOrSupperId);I[0].length=I.length,I[0].memberGroupOrSupperIdList=s,v.push(I[0])}else{const s=e.map(L=>L.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=s,v.push(e[0])}m.value.currentTenantId=_.data.currentTenantId,m.value.tenantMeasurementInfoList=v,b.value=!0}const z=async o=>{if(!o.visible){const y={type:o.type,projectId:o.projectId,tenantId:o.allocationTenantId,supplierIdList:o.type===2?o.memberGroupOrSupperIdList:[],memberGroupIdList:o.type===3?o.memberGroupOrSupperIdList:[]},_=await V.getQuestionnaireClickList(y);m.value.clickIdList=Q(_.data.questionnaireClickInfoList),o.visible=!0}};function Q(o){return o.reduce((y,_)=>{const{supplierId:u,supplierName:f,projectQuestionnaireClickId:g,surveyStatus:I,price:e}=_;let v=y.find(s=>s.supplierId===u);return v?v.list.push({projectQuestionnaireClickId:g,surveyStatus:I,price:e}):y.push({supplierId:u,supplierName:f,list:[{projectQuestionnaireClickId:g,surveyStatus:I,price:e}]}),y},[])}function T(){b.value=!1}function P(){T()}return N({showEdit:B}),(o,y)=>{const _=D,u=k("el-text"),f=k("el-button"),g=k("el-popover"),I=k("el-drawer");return r(),p("div",null,[i(I,{modelValue:c(b),"onUpdate:modelValue":y[0]||(y[0]=e=>U(b)?b.value=e:null),title:"项目测查",size:"60%","before-close":T},{footer:l(()=>[t("div",fe,[i(f,{onClick:T},{default:l(()=>[a(" 取消 ")]),_:1}),i(f,{type:"primary",onClick:P},{default:l(()=>[a(" 确定 ")]),_:1})])]),default:l(()=>[t("div",K,[(r(!0),p(S,null,M(c(m).tenantMeasurementInfoList,(e,v)=>(r(),p("div",{class:"item",key:e.allocationTenantId},[t("div",R,[t("div",{class:x({"left-top":!0,"flex-b":!0,currentTenant:e.allocationTenantId===c(m).currentTenantId&&e.type===1})},[t("div",W,[t("div",X,[t("div",Y,[t("b",null,n(e.projectName),1),t("span",null,n(c(h).projectStatusList[e.projectStatus-1]),1)]),t("div",Z,n(e.projectId),1)]),t("div",ee,[t("p",null,[a(" 原价： "),i(_),a(" "+n(e.doMoneyPrice),1)]),t("p",null,[a(" 参数： "),i(u,{size:"large"},{default:l(()=>[a(n(e.participationNumber||0),1)]),_:2},1024),i(u,{size:"large"},{default:l(()=>[a(" / ")]),_:1}),i(u,{type:"success",size:"large"},{default:l(()=>[a(n(e.doneNumber||0),1)]),_:2},1024),i(u,{size:"large"},{default:l(()=>[a(" / ")]),_:1}),i(u,{type:"warning",size:"large"},{default:l(()=>[a(n(e.num||0),1)]),_:2},1024),i(u,{size:"large"},{default:l(()=>[a(" / ")]),_:1}),i(u,{size:"large"},{default:l(()=>[a(n(e.limitedQuantity||0),1)]),_:2},1024)])])]),e.allocationTenantId!==c(m).currentTenantId||e.type!==1?(r(),p("div",te,[t("p",{class:x("type"+e.type)},n(c(h).typeList[e.type-1]),3),t("div",se,[e.length>1?(r(),E(f,{key:0,type:"primary",link:"",onClick:s=>z(e)},{default:l(()=>[a(" 查看更多("+n(e.length)+") ",1)]),_:2},1032,["onClick"])):(r(),p(S,{key:1},[t("p",null,n(e.tenantName),1),t("p",null,n(e.allocationTenantId),1)],64))])])):j("",!0)],2),c(m).tenantMeasurementInfoList.length!==v+1?(r(),p("div",ne,[ae,t("div",oe,n(e.tenantName)+"-分配-"+n(c(h).typeList[c(m).tenantMeasurementInfoList[v+1].type-1]),1),le])):j("",!0)]),e.allocationTenantId!==c(m).currentTenantId||e.type!=1?(r(),p("div",ie,[i(g,{visible:e.visible,"onUpdate:visible":s=>e.visible=s,placement:"right",width:350,trigger:"click",onShow:s=>z(e)},{reference:l(()=>[i(f,{style:{padding:"0.5rem"},type:"primary",link:""},{default:l(()=>[a(" 》 ")]),_:1})]),default:l(()=>[(r(!0),p(S,null,M(c(m).clickIdList,s=>(r(),p("div",re,[t("div",ce,[t("span",{class:x("type"+e.type)},n(c(h).typeList[e.type-1]),3)]),t("div",ue,[t("div",pe,n(s.supplierName)+"   "+n(s.supplierId),1),t("ul",null,[de,(r(!0),p(S,null,M(s.list,L=>(r(),p("li",null,[t("span",null,n(L.projectQuestionnaireClickId),1),t("span",null,"  "+n(c(h).surveyStatusList[L.surveyStatus-1]),1),L.surveyStatus===1?(r(),p("span",_e,[a("   "),i(_),a(n(L.price),1)])):j("",!0)]))),256))])])]))),256))]),_:2},1032,["visible","onUpdate:visible","onShow"])])):j("",!0)]))),128))])]),_:1},8,["modelValue"])])}}}),me=A(Ie,[["__scopeId","data-v-002a148a"]]),Le=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"}));export{V as a,me as e,Le as i,J as u};
