
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as D,r as d,a as c,o as j,b as F,f as t,w as r,g as i,i as l,y as f,e as J,j as K,A as O,_ as L,E as M,L as $}from"./index-Bn2GMQXG.js";import{c as U}from"./user_cooperation-DqVUItJS.js";import{u as z}from"./index-CJpx5TKK.js";import"./index-D-btMl2l.js";import"./index-BAH3-LM4.js";import"./department-DQERDib2.js";const G={style:{display:"flex"},class:"inviteDialog"},H=D({__name:"index",emits:["fetch-data"],setup(Q,{expose:b,emit:k}){const x=k,s=d(!1),p=d(),e=d({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}});d([]);async function N(o){e.value.form.id=o.id,e.value.form.priceRatio=o.priceRatio,e.value.form.sendProjectType=o.sendProjectType?[o.sendProjectType]:null,e.value.form.receiveProjectType=o.receiveProjectType?[o.receiveProjectType]:null,e.value.form.chargeUserName=o.userName,e.value.form.invitationType=o.invitationType,e.value.form.chargeUserId=o.userId,s.value=!0}function v(){s.value=!1,e.value.form={},p.value.resetFields()}const y=d();function C(){y.value.showEdit("","请选择负责部门/人")}async function I(o){await U.updateInvitationBindUser({id:e.value.form.id,chargeUserId:o.chargeUserId,invitationType:o.invitationType,chargeUserName:o.chargeUserName,sendProjectType:o.sendProjectType,receiveProjectType:o.receiveProjectType})}async function R(){await U.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio}),M.success({message:"修改成功",center:!0})}async function V(){p.value.validate(o=>{if(o){let a=JSON.parse(JSON.stringify(e.value.form));a.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,a.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,a.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",e.value.form.departmentId="",a.chargeUserId=null,a.chargeUserName="",a.invitationType=""),I(a),R(),x("fetch-data"),v()}})}const B=o=>{Array.isArray(o)&&o.length>1&&(e.value.form.sendProjectType=[o[o.length-1]])},E=o=>{Array.isArray(o)&&o.length>1&&(e.value.form.receiveProjectType=[o[o.length-1]])},A=o=>{o.preventDefault()};return b({showEdit:N}),(o,a)=>{const _=c("el-input"),u=c("el-form-item"),g=L,h=c("el-tooltip"),m=c("el-checkbox"),T=c("el-checkbox-group"),q=c("ElForm"),P=c("el-button"),S=c("el-dialog");return j(),F("div",null,[t(S,{modelValue:l(s),"onUpdate:modelValue":a[4]||(a[4]=n=>O(s)?s.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置"},{footer:r(()=>[t(P,{onClick:v},{default:r(()=>[i(" 关闭 ")]),_:1}),t(P,{type:"primary",onClick:V},{default:r(()=>[i(" 确认 ")]),_:1})]),default:r(()=>[t(q,{ref_key:"formRef",ref:p,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left"},{default:r(()=>[t(u,{label:"价格比例",prop:"priceRatio"},{default:r(()=>[t(_,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":a[0]||(a[0]=n=>l(e).form.priceRatio=n),clearable:""},{append:r(()=>[i("%")]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"项目分配方式","label-width":"7rem"}),f("div",G,[t(u,{prop:"sendProjectType","label-width":"7rem"},{label:r(()=>[f("span",null,[t(h,{effect:"dark",content:"1111111",placement:"top-start"},{default:r(()=>[t(g,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),i(" 发送项目 ")])]),default:r(()=>[t(T,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":a[1]||(a[1]=n=>l(e).form.sendProjectType=n),onChange:B},{default:r(()=>[t(m,{value:1},{default:r(()=>[i(" 自动 ")]),_:1}),t(m,{value:2},{default:r(()=>[i(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(u,{prop:"receiveProjectType",style:{"margin-left":"40px"}},{label:r(()=>[f("span",null,[t(h,{effect:"dark",content:"1111111",placement:"top-start"},{default:r(()=>[t(g,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),i(" 接收项目 ")])]),default:r(()=>[t(T,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":a[2]||(a[2]=n=>l(e).form.receiveProjectType=n),onChange:E},{default:r(()=>[t(m,{value:1},{default:r(()=>[i(" 自动 ")]),_:1}),t(m,{value:2},{default:r(()=>[i(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(e).form.receiveProjectType&&l(e).form.receiveProjectType[0]==1?(j(),J(_,{key:0,placeholder:"请选择接收项目负责人",onKeydown:A,onClick:C,modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":a[3]||(a[3]=n=>l(e).form.chargeUserName=n)},null,8,["modelValue"])):K("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),t(z,{ref_key:"userRef",ref:y},null,512)])}}}),oe=$(H,[["__scopeId","data-v-db3e6720"]]);export{oe as default};
