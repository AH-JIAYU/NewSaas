
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{u as T}from"./user_customer-B93FXzVn.js";import{a as z}from"./project_settlement-BJC-rBVp.js";import{d as H,r,n as J,a as d,q as G,s as K,o as m,b as f,f as a,w as o,y as Q,g as V,F as c,z as W,t as U,e as D,j as y,E as k}from"./index-C3YtDUn5.js";const X={style:{flex:"auto"}},le=H({name:"SettlementEdit",__name:"index",emits:["success"],setup(Y,{expose:M,emit:j}){const S=j,q=T(),P=r([]),i=r(!1),b=r(),n=r(),l=r({id:"",projectId:"",clientId:"",doMoneyPrice:"",settlementDone:"",systemDone:"",settlementPo:"",remark:"",status:null}),v=r(""),_=r(""),E={systemDone:" 系统/审核",settlementPo:"结算PO号",remark:"备注"},L=r({clientId:[{required:!0,message:"请选择所属客户",trigger:"change"}],doMoneyPrice:[{required:!0,message:"请选择所属客户",trigger:"blur"}],settlementDone:[{required:!0,message:"请输入结算完成数",trigger:"blur"},{pattern:/^\d+$/,message:"请输入纯数字",trigger:"blur"}],systemDone:[{required:!0,message:"请输入系统完成数",trigger:"blur"},{pattern:/^\d+$/,message:"请输入纯数字",trigger:"blur"}]}),N=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],p=r(!1);function O(){b.value&&b.value.validate(async g=>{if(g)try{if(!/^\d+$/.test(l.value.settlementDone)||!/^\d+$/.test(l.value.systemDone)){k.warning({message:"系统或审核完成数请输入正整数",center:!0});return}i.value=!0;const{status:e}=await z.edit(l.value);e===1?(S("success"),i.value=!1,k.success({message:"操作成功",center:!0}),w()):(i.value=!1,k.error({message:"操作失败，请联系工作人员",center:!0}))}catch{}finally{i.value=!1}})}async function $(g,e){_.value=(E[e]||"")+"编辑",v.value=e,n.value=JSON.parse(g),l.value.id=n.value.id,l.value.projectId=n.value.projectId,l.value.clientId=n.value.clientId,l.value.doMoneyPrice=n.value.projectAmount,l.value.settlementDone=n.value.settlementDone,l.value.systemDone=n.value.systemDone,l.value.settlementPo=n.value.settlementPo,l.value.remark=n.value.remark,l.value.status=n.value.status,p.value=!0}function w(){b.value.resetFields(),Object.assign(l.value,{id:"",projectId:"",clientId:"",doMoneyPrice:"",settlementDone:"",systemDone:"",settlementPo:"",remark:"",status:null}),p.value=!1}return J(async()=>{P.value=await q.getCustomerList()}),M({showEdit:$}),(g,e)=>{const B=d("el-text"),u=d("el-form-item"),C=d("el-option"),I=d("el-select"),s=d("el-input"),R=d("el-form"),x=d("el-button"),A=d("el-dialog"),F=G("loading");return K((m(),f("div",null,[a(A,{modelValue:p.value,"onUpdate:modelValue":e[19]||(e[19]=t=>p.value=t),title:_.value,width:"600","before-close":w},{footer:o(()=>[Q("div",X,[a(x,{onClick:e[18]||(e[18]=t=>p.value=!1)},{default:o(()=>[V(" 取消 ")]),_:1}),a(x,{type:"primary",onClick:O},{default:o(()=>[V(" 确定 ")]),_:1})])]),default:o(()=>[a(R,{ref_key:"formRef",ref:b,model:l.value,rules:L.value,"label-width":"100px",inline:!1},{default:o(()=>[v.value?y("",!0):(m(),f(c,{key:0},[a(u,{label:"项目ID"},{default:o(()=>[a(B,{class:"mx-1"},{default:o(()=>[V(W(l.value.projectId),1)]),_:1})]),_:1}),a(u,{prop:"clientId",label:"所属客户"},{default:o(()=>[a(I,{modelValue:l.value.clientId,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.clientId=t),placeholder:"请选择所属客户",disabled:!!l.value.id,clearable:"",filterable:""},{default:o(()=>[(m(!0),f(c,null,U(P.value,t=>(m(),D(C,{key:t.tenantCustomerId,value:t.tenantCustomerId,label:t.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(u,{prop:"doMoneyPrice",label:"项目价"},{default:o(()=>[a(s,{modelValue:l.value.doMoneyPrice,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.doMoneyPrice=t),disabled:!!l.value.id,placeholder:"",clearable:"",onChange:e[2]||(e[2]=()=>{})},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"系统完成数"},{default:o(()=>[a(s,{modelValue:l.value.systemDone,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.systemDone=t),placeholder:"",clearable:"",onChange:e[4]||(e[4]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"审核完成数"},{default:o(()=>[a(s,{modelValue:l.value.settlementDone,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.settlementDone=t),placeholder:"",clearable:"",onChange:e[6]||(e[6]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"结算PO号"},{default:o(()=>[a(s,{modelValue:l.value.settlementPo,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.settlementPo=t),placeholder:"",clearable:"",onChange:e[8]||(e[8]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"备注"},{default:o(()=>[a(s,{maxlength:"200","show-word-limit":"",style:{width:"100%"},type:"textarea",rows:5,modelValue:l.value.remark,"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.remark=t),clearable:""},null,8,["modelValue"])]),_:1}),a(u,{label:"状态"},{default:o(()=>[a(I,{placeholder:"结算状态",modelValue:l.value.status,"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.status=t),clearable:l.value.id=="",filterable:""},{default:o(()=>[(m(),f(c,null,U(N,t=>a(C,{key:t.value,value:t.value,label:t.label,disabled:l.value.id!=""},null,8,["value","label","disabled"])),64))]),_:1},8,["modelValue","clearable"])]),_:1})],64)),v.value==="systemDone"?(m(),f(c,{key:1},[a(u,{label:"系统完成数"},{default:o(()=>[a(s,{modelValue:l.value.systemDone,"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.systemDone=t),placeholder:"",clearable:"",onChange:e[12]||(e[12]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"审核完成数"},{default:o(()=>[a(s,{modelValue:l.value.settlementDone,"onUpdate:modelValue":e[13]||(e[13]=t=>l.value.settlementDone=t),placeholder:"",clearable:"",onChange:e[14]||(e[14]=()=>{})},null,8,["modelValue"])]),_:1})],64)):y("",!0),v.value==="settlementPo"?(m(),D(u,{key:2,label:"结算PO号"},{default:o(()=>[a(s,{modelValue:l.value.settlementPo,"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.settlementPo=t),placeholder:"",clearable:"",onChange:e[16]||(e[16]=()=>{})},null,8,["modelValue"])]),_:1})):y("",!0),v.value==="remark"?(m(),D(u,{key:3,label:"备注"},{default:o(()=>[a(s,{maxlength:"200","show-word-limit":"",style:{width:"100%"},type:"textarea",rows:5,modelValue:l.value.remark,"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.remark=t),clearable:""},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])),[[F,i.value]])}}});export{le as _};
