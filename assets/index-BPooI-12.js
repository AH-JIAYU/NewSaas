
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as I,s as M}from"./apiLoading-BAxzax6u.js";import{a as j}from"./projectManagement-GGoJ2mDE.js";import{U as q}from"./user_supplier-lS8pTkAv.js";import{u as H}from"./survey_vipGroup-LZ4xY7pu.js";import{d as O,r as f,l as P,a as i,al as J,o as s,b as S,f as a,w as o,I as K,g as m,am as Q,e as p,i as l,j as y,F as T,n as k,p as W,E as X,_ as Y}from"./index-Bh_VDJMf.js";import"./user_supplier-wf7XFkH3.js";import"./survey_vipGroup-D4AOHYXQ.js";const Z={style:{flex:"auto"}},$=O({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(ee,{expose:h,emit:x}){const G=q(),C=H(),N=x,u=f(!1),_=f(),e=f({title:"分配",list:[],tenantSupplierList:[],vipGroupList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]}}),U=f({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择至少一项"}]});async function E(n,r){if(e.value.list=[{...n}],r==="reassign"){e.value.title="重新分配";const d=await I(j.getProjectAllocation({projectId:n.projectId})),{groupSupplierIdSet:v,...c}=d.data;e.value.form=c,e.value.form.groupSupplierIdList=v}else e.value.title="分配",e.value.form.projectId=n.projectId;e.value.tenantSupplierList=await I(G.getTenantSupplierList(n.projectId)),e.value.vipGroupList=await I(C.getGroupNameList()),u.value=!0}function B(){e.value.form.groupSupplierIdList=[]}function g(){_.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),u.value=!1}function R(){_.value.validate(async n=>{if(n){const{status:r}=await M(j.allocation(e.value.form));r===1&&X.success({message:"分配成功",center:!0}),g(),N("fetch-data")}})}return P(async()=>{}),h({showEdit:E}),(n,r)=>{const d=i("el-table-column"),v=i("el-table"),c=i("el-radio"),z=i("el-radio-group"),b=i("el-form-item"),L=i("el-option"),V=i("el-select"),A=i("el-form"),w=i("el-button"),F=i("el-dialog"),D=J("loading");return s(),S("div",null,[a(F,{modelValue:l(u),"onUpdate:modelValue":r[3]||(r[3]=t=>W(u)?u.value=t:null),title:"分配",width:"700","before-close":g},{footer:o(()=>[K("div",Z,[a(w,{type:"primary",onClick:R},{default:o(()=>[m(" 确定 ")]),_:1}),a(w,{onClick:g},{default:o(()=>[m(" 取消 ")]),_:1})])]),default:o(()=>[Q((s(),p(v,{data:l(e).list,"row-key":"id"},{default:o(()=>[a(d,{align:"center","show-overflow-tooltip":"",label:"客户简称",prop:"clientName"}),a(d,{align:"center","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),a(d,{align:"center","show-overflow-tooltip":"",label:"项目名称",prop:"name"})]),_:1},8,["data"])),[[D,!1]]),a(A,{ref_key:"formRef",ref:_,"label-width":"80px",rules:l(U),model:l(e).form,inline:!1},{default:o(()=>[a(b,{label:"分配目标"},{default:o(()=>[a(z,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":r[0]||(r[0]=t=>l(e).form.allocationType=t),class:"ml-4",onChange:B},{default:o(()=>[a(c,{value:2,size:"large"},{default:o(()=>[m(" 供应商 ")]),_:1}),a(c,{value:3,size:"large"},{default:o(()=>[m(" 会员组 ")]),_:1}),l(e).title==="重新分配"?(s(),p(c,{key:0,value:4,size:"large"},{default:o(()=>[m(" 取消分配 ")]),_:1})):y("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===2&&l(e).form.allocationType!==4?(s(),p(b,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:o(()=>[a(V,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":r[1]||(r[1]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:o(()=>[(s(!0),S(T,null,k(l(e).tenantSupplierList,t=>(s(),p(L,{label:t.supplierAccord,value:t.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):y("",!0),l(e).form.allocationType===3&&l(e).form.allocationType!==4?(s(),p(b,{key:1,label:"会员组",prop:"groupSupplierIdList"},{default:o(()=>[a(V,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":r[2]||(r[2]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择会员组",clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:o(()=>[(s(!0),S(T,null,k(l(e).vipGroupList,t=>(s(),p(L,{label:t.memberGroupName,value:t.memberGroupId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),ne=Y($,[["__scopeId","data-v-d0784f43"]]);export{ne as default};
