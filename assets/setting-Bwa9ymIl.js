
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as W,m as K,u as me,r as f,a as d,o as p,b as E,f as l,w as r,e as _,F as h,aH as S,az as Q,am as X,aE as ce,i as a,j as I,ak as C,L as fe,_ as ee,k as Y,M as ge,D as ve,al as ye,a3 as q,a4 as D,g as z,l as he,aK as be,aL as _e,n as G}from"./index-BEU4aNZB.js";import{u as we}from"./otherFunctions_basicDictionary-DtlvvSBs.js";const Ve={class:"upload-container"},Ee={key:1,class:"image"},ke={class:"mask"},Pe={class:"actions"},Ue={key:0,class:"el-upload__tip"},$e={style:{display:"inline-block"}},Se=W({name:"ImageUpload",__name:"index",props:K({action:{},headers:{},data:{},name:{default:"file"},size:{default:2},width:{default:150},height:{default:150},placeholder:{default:""},notip:{type:Boolean,default:!1},ext:{default:()=>["jpg","png","gif","bmp"]}},{modelValue:{default:""},modelModifiers:{}}),emits:K(["onSuccess"],["update:modelValue"]),setup(g,{emit:T}){const k=g,N=T,v=me(g,"modelValue"),m=f({imageViewerVisible:!1,progress:{preview:"",percent:0}});function w(){m.value.imageViewerVisible=!0}function x(){m.value.imageViewerVisible=!1}function V(){v.value=""}const j=s=>{const n=s.name.split(".").at(-1)??"",b=k.ext.includes(n),U=s.size/1024/1024<k.size;return b||C.error(`上传图片只支持 ${k.ext.join(" / ")} 格式！`),U||C.error(`上传图片大小不能超过 ${k.size}MB！`),b&&U&&(m.value.progress.preview=URL.createObjectURL(s)),b&&U},M=s=>{m.value.progress.percent=~~s.percent},P=s=>{m.value.progress.preview="",m.value.progress.percent=0,N("onSuccess",s)};return(s,e)=>{const n=fe,b=d("ElImage"),U=d("ElProgress"),B=d("ElUpload"),O=d("ElAlert"),F=d("ElImageViewer");return p(),E("div",Ve,[l(B,{"show-file-list":!1,headers:s.headers,action:s.action,data:s.data,name:s.name,"before-upload":j,"on-progress":M,"on-success":P,drag:"",class:"image-upload"},{default:r(()=>[v.value===""?(p(),_(b,{key:0,src:v.value===""?s.placeholder:v.value,style:S(`width:${s.width}px;height:${s.height}px;`),fit:"fill"},{error:r(()=>[h("div",{class:"image-slot",style:S(`width:${s.width}px;height:${s.height}px;`)},[l(n,{name:"i-ep:plus",class:"icon"})],4)]),_:1},8,["src","style"])):(p(),E("div",Ee,[l(b,{src:v.value,style:S(`width:${s.width}px;height:${s.height}px;`),fit:"fill"},null,8,["src","style"]),h("div",ke,[h("div",Pe,[h("span",{title:"预览",onClick:Q(w,["stop"])},[l(n,{name:"i-ep:zoom-in",class:"icon"})]),h("span",{title:"移除",onClick:Q(V,["stop"])},[l(n,{name:"i-ep:delete",class:"icon"})])])])])),X(h("div",{class:"progress",style:S(`width:${s.width}px;height:${s.height}px;`)},[l(b,{src:a(m).progress.preview,style:S(`width:${s.width}px;height:${s.height}px;`),fit:"fill"},null,8,["src","style"]),l(U,{type:"circle",width:Math.min(s.width,s.height)*.8,percentage:a(m).progress.percent},null,8,["width","percentage"])],4),[[ce,v.value===""&&a(m).progress.percent]])]),_:1},8,["headers","action","data","name"]),s.notip?I("",!0):(p(),E("div",Ue,[h("div",$e,[l(O,{title:`上传图片支持 ${s.ext.join(" / ")} 格式，且图片大小不超过 ${s.size}MB，建议图片尺寸为 ${s.width}*${s.height}`,type:"info","show-icon":"",closable:!1},null,8,["title"])])])),a(m).imageViewerVisible?(p(),_(F,{key:1,"url-list":[v.value],teleported:"",onClose:x},null,8,["url-list"])):I("",!0)])}}}),Ie=ee(Se,[["__scopeId","data-v-efadaafa"]]),J={list:()=>Y.post("user/getUserInfo"),edit:g=>Y.post("user/update",g)},le=g=>(be("data-v-78b29805"),g=g(),_e(),g),Ce=le(()=>h("h2",null,"个人信息",-1)),Ne=le(()=>h("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),ae=W({name:"personalSetting",__name:"setting",emits:["success"],setup(g,{expose:T,emit:k}){const N=k,v=we(),m=f([]),w=f(!1);ge();const x=f(!1),V=f(!1),j=[{label:"公司",value:"company"},{label:"个人",value:"personal"}],M=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}];f([]);const P=f(),s=f(),e=f({type:"personal",name:"",phone:"15288888888",email:"88888@qq.com",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),n=f({oldPassword:"",password:"",confirmPassword:""}),B=f({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(u,t,c)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?c():c(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(u,t,c)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?c():c(new Error("请输入合法手机号"))},trigger:"blur"}]}),O=f({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(u,t,c)=>{t===n.value.oldPassword?c(new Error("新密码不能与旧密码一致")):c()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(u,t,c)=>{t!==n.value.password?c(new Error("两次输入的密码不一致")):c()},trigger:"blur"}]}),F=u=>{(u!==e.value.phone||u!==e.value.email)&&(x.value=!0)};function oe(){P.value&&P.value.validate(async u=>{if(u){if(w.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,x.value||(delete e.value.phone,delete e.value.email),(await J.edit(e.value)).status===-1)return;N("success"),w.value=!1,C.success({message:"修改成功",center:!0}),$()}})}const te=()=>{s.value&&s.value.validate(async u=>{if(u){if(w.value=!0,delete n.value.confirmPassword,console.log("accountForm.value",n.value),(await J.edit(n.value)).status===-1)return;N("success"),w.value=!1,C.success({message:"修改成功",center:!0}),$()}})};async function se(u){e.value=u,V.value=!0}function $(){P.value.resetFields(),s.value.resetFields(),Object.assign(e,{}),Object.assign(n,{}),V.value=!1}function re(u){u.error===""?e.value.headimg=u.data.path:C.warning(u.error)}return ve(async()=>{m.value=await v.getCountry()}),T({showEdit:se}),(u,t)=>{const c=Ie,i=d("ElFormItem"),L=d("el-option"),A=d("el-select"),y=d("ElInput"),ne=d("ElOption"),ue=d("ElSelect"),R=d("ElButton"),H=d("ElForm"),Z=d("ElTabPane"),ie=d("ElTabs"),de=d("el-drawer"),pe=ye("loading");return X((p(),E("div",null,[l(de,{modelValue:a(V),"onUpdate:modelValue":t[13]||(t[13]=o=>he(V)?V.value=o:null),title:"修改用户信息",direction:"rtl","before-close":$,style:{height:"100%"},size:"40%"},{default:r(()=>[l(ie,{"tab-position":"left"},{default:r(()=>[l(Z,{label:"个人信息",class:"basic"},{default:r(()=>[Ce,l(H,{ref_key:"userFormRef",ref:P,model:a(e),rules:a(B),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:r(()=>[l(i,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:r(()=>[l(c,{url:a(e).imgUrl,"onUpdate:url":t[0]||(t[0]=o=>a(e).imgUrl=o),action:"http://saas-api.surveysaas.com/project/uploadQiniu",name:"image",notip:"",class:"headimg-upload",onOnSuccess:re},null,8,["url"])]),_:1}),l(i,{label:"账户类型"},{default:r(()=>[l(A,{modelValue:a(e).type,"onUpdate:modelValue":t[1]||(t[1]=o=>a(e).type=o),"value-key":"",placeholder:"账户类型",clearable:"",filterable:""},{default:r(()=>[(p(),E(q,null,D(j,o=>l(L,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"用户名"},{default:r(()=>[l(y,{disabled:"",modelValue:a(e).name,"onUpdate:modelValue":t[2]||(t[2]=o=>a(e).name=o),laceholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),l(i,{label:"国家"},{default:r(()=>[l(ue,{modelValue:a(e).country,"onUpdate:modelValue":t[3]||(t[3]=o=>a(e).country=o),disabled:""},{default:r(()=>[(p(!0),E(q,null,D(a(m),o=>(p(),_(ne,{label:o.chineseName,value:o.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),l(i,{prop:"",label:"货币类型"},{default:r(()=>[l(A,{modelValue:a(e).currencyType,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).currencyType=o),"value-key":"",placeholder:"请选择货币类型",clearable:"",filterable:""},{default:r(()=>[(p(),E(q,null,D(M,o=>l(L,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(e).type==="company"?(p(),_(i,{key:0,label:"公司名称"},{default:r(()=>[l(y,{modelValue:a(e).companyName,"onUpdate:modelValue":t[5]||(t[5]=o=>a(e).companyName=o),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):I("",!0),a(e).type==="company"?(p(),_(i,{key:1,label:"公司税号"},{default:r(()=>[l(y,{modelValue:a(e).taxId,"onUpdate:modelValue":t[6]||(t[6]=o=>a(e).taxId=o),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):I("",!0),a(e).type==="company"?(p(),_(i,{key:2,label:"法人姓名"},{default:r(()=>[l(y,{modelValue:a(e).legalPersonName,"onUpdate:modelValue":t[7]||(t[7]=o=>a(e).legalPersonName=o),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):I("",!0),a(e).country==="CN"?(p(),_(i,{key:3,prop:"phone",label:"手机号码"},{default:r(()=>[l(y,{modelValue:a(e).phone,"onUpdate:modelValue":t[8]||(t[8]=o=>a(e).phone=o),placeholder:"请输入你的手机号码",onChange:F},null,8,["modelValue"])]),_:1})):(p(),_(i,{key:4,prop:"email",label:"电子邮箱"},{default:r(()=>[l(y,{modelValue:a(e).email,"onUpdate:modelValue":t[9]||(t[9]=o=>a(e).email=o),placeholder:"请输入你的电子邮箱",onChange:F},null,8,["modelValue"])]),_:1})),l(i,null,{default:r(()=>[l(R,{onClick:oe,type:"primary"},{default:r(()=>[z(" 保存 ")]),_:1}),l(R,{onClick:$,type:"primary"},{default:r(()=>[z(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),l(Z,{label:"账户管理",class:"security"},{default:r(()=>[Ne,l(H,{ref_key:"accountFormRef",ref:s,model:a(n),rules:a(O),"label-width":"120px","label-suffix":"："},{default:r(()=>[l(i,{prop:"oldPassword",label:"旧密码"},{default:r(()=>[l(y,{modelValue:a(n).oldPassword,"onUpdate:modelValue":t[10]||(t[10]=o=>a(n).oldPassword=o),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),l(i,{prop:"password",label:"新密码"},{default:r(()=>[l(y,{modelValue:a(n).password,"onUpdate:modelValue":t[11]||(t[11]=o=>a(n).password=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(i,{prop:"confirmPassword",label:"确认新密码"},{default:r(()=>[l(y,{modelValue:a(n).confirmPassword,"onUpdate:modelValue":t[12]||(t[12]=o=>a(n).confirmPassword=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(i,null,{default:r(()=>[l(R,{onClick:te,type:"primary"},{default:r(()=>[z(" 保存 ")]),_:1}),l(R,{onClick:$,type:"primary"},{default:r(()=>[z(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[pe,a(w)]])}}});typeof G=="function"&&G(ae);const xe=ee(ae,[["__scopeId","data-v-78b29805"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{J as a,ze as b,xe as s};
