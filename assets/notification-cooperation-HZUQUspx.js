
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Z,aD as ee,r as s,aL as te,a as u,o as R,b as z,y as n,z as k,i as o,f as l,w as a,g as c,j as A,e as ae,A as re,ba as C,E as le,_ as ne,aH as oe,aI as se,L as ie}from"./index-CFkZrq6v.js";import{a as ce}from"./department-CkA3Y3YH.js";import{u as de}from"./index-Bs6L_LV7.js";import ue from"./index-CTRDbWYC.js";import"./index-CdUZSmAh.js";import"./index-Dcx1LF-Q.js";import"./configuration_site_setting-CURGuGJ5.js";const p=f=>(oe("data-v-5bb29dbf"),f=f(),se(),f),pe={class:"news p-4"},ge=p(()=>n("div",{class:"type"},[n("span"),c(" 合作邀约")],-1)),me={class:"news-content"},ve={class:"content"},fe={class:"time"},ye=p(()=>n("div",null,"您好！",-1)),_e={style:{margin:".25rem 0"}},he={key:0,class:"footer"},be=p(()=>n("div",{style:{display:"flex","align-items":"center"}},[n("span",{style:{display:"inline-block",width:"8px",height:"8px",background:"#FF8181","border-radius":"50%","margin-right":"4px"}}),n("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式")],-1)),xe={style:{display:"flex","align-items":"center"}},Te=p(()=>n("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),ke=p(()=>n("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),Ie={style:{"margin-top":"6px","margin-bottom":"0px"}},Ue={style:{display:"flex","flex-direction":"column"}},Re={style:{display:"flex","align-items":"center"}},Ce=p(()=>n("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),we=p(()=>n("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),Pe=Z({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(f,{expose:B,emit:D}){const y=ee(),I=y.currencyType,g=s();s(1);const w=s(""),P=D,U=te(),j=(r,t,i)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return i(new Error("请输入 0 到 100 之间的数字"));i()},F=s({priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:j}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}),e=s({priceRatio:null,rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:j}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),m=s(!1);s([]);const N=s(""),K={children:"children",label:"name"},L=async r=>{e.value.chargeUserId="",e.value=r,g.value=r.currencyType;const t=await ce.list({name:""});t.data&&(S.value=t.data),M()},S=s([]);s();const _=s(),H=(r,t)=>{t?(_.value.getCheckedKeys().forEach(v=>{v!==r.id&&_.value.setChecked(v,!1)}),e.value.chargeUserId=r.id,_.value.getCheckedNodes(),e.value.chargeUserName=r.name):(e.value.chargeUserId=[e.value.chargeUserId].filter(i=>i!==r.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="")),e.value.chargeUserId||(e.value.chargeUserName="")},M=async()=>{const r={id:e.value.id,type:1};await C.updateTenantAudit(r),await U.getUnreadTodo()},G=async()=>{const r={id:e.value.id,type:2};P("delSelectId"),await C.updateTenantAudit(r),await U.getUnreadTodo()},J=async()=>{N.value.validate(async r=>{if(r){if(Array.isArray(e.value.chargeUserId)&&(e.value.chargeUserId=e.value.chargeUserId[0]),e.value.receiveProjectType==1&&!e.value.chargeUserId){le.warning({message:"请选择部门",center:!0});return}if(!y.originalExchangeRate){w.value.showEdit();return}I===g.value?e.value.exchangeRate=1:I===1&&g.value===2?e.value.exchangeRate=y.originalExchangeRate:I===2&&g.value===1&&(e.value.exchangeRate=(1/y.originalExchangeRate).toFixed(2));const t={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType,receiveProjectType:e.value.receiveProjectType,exchangeRate:e.value.exchangeRate};P("delSelectId"),await C.updateTenantAudit(t),await U.getUnreadTodo()}})},O=s();function E(r){e.value.chargeUserId=r.chargeUserId,e.value.invitationType=r.invitationType,e.value.chargeUserName=r.chargeUserName}const h=s(null),b=s(null),x=(r,t)=>{t&&(r==="发送"?(h.value=t,e.value.sendProjectType=t):(b.value=t,e.value.receiveProjectType=t))},Q=()=>{h.value=null,b.value=null,e.value.sendProjectType=null,e.value.receiveProjectType=null};return B({showEdit:L}),(r,t)=>{const i=u("el-button"),v=u("el-input"),T=u("el-form-item"),V=ne,$=u("el-tooltip"),W=u("el-tree-select"),X=u("ElForm"),q=u("ElButton"),Y=u("el-dialog");return R(),z("div",pe,[ge,n("div",me,[n("div",ve,"尊贵的"+k(o(e).beInvitedName),1),n("div",fe,[ye,n("div",_e,"我是"+k(o(e).invitationName)+",诚挚邀请贵司与我们合作,实现共赢！",1),n("div",null,"我方货币类型为"+k(o(g)===1?"美元":"人民币")+"，达成合作后我方发布项目以 "+k(o(g)===1?"美元":"人民币")+" 计价，望悉知。",1)]),o(e).auditStatus===1?(R(),z("div",he,[l(i,{onClick:G},{default:a(()=>[c("拒绝合作")]),_:1}),l(i,{type:"primary",onClick:t[0]||(t[0]=d=>m.value=!0)},{default:a(()=>[c(" 同意合作 ")]),_:1})])):A("",!0)]),l(Y,{modelValue:o(m),"onUpdate:modelValue":t[8]||(t[8]=d=>re(m)?m.value=d:null),title:"合作配置",class:"hezuoDrawer",onClose:Q},{footer:a(()=>[l(q,{size:"large",onClick:t[7]||(t[7]=d=>m.value=!1)},{default:a(()=>[c(" 取消 ")]),_:1}),l(q,{type:"primary",size:"large",onClick:J},{default:a(()=>[c(" 确定 ")]),_:1})]),default:a(()=>[l(X,{ref_key:"formRef",ref:N,rules:o(F),model:o(e),"label-width":"7rem",labelPosition:"left"},{default:a(()=>[l(T,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[l(v,{modelValue:o(e).priceRatio,"onUpdate:modelValue":t[1]||(t[1]=d=>o(e).priceRatio=d),clearable:""},{append:a(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),l(T,{"label-width":"7.5rem"},{label:a(()=>[be]),_:1}),l(T,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[n("span",xe,[l($,{effect:"dark",placement:"top-start"},{content:a(()=>[Te,ke]),default:a(()=>[l(V,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:a(()=>[n("div",Ie,[l(i,{type:o(h)===1?"primary":"",size:"small",onClick:t[2]||(t[2]=d=>x("发送",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),l(i,{type:o(h)===2?"primary":"",size:"small",onClick:t[3]||(t[3]=d=>x("发送",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),n("div",Ue,[l(T,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[n("span",Re,[l($,{effect:"dark",placement:"top-start"},{content:a(()=>[Ce,we]),default:a(()=>[l(V,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:a(()=>[n("div",null,[l(i,{type:o(b)===1?"primary":"",size:"small",onClick:t[4]||(t[4]=d=>x("接收",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),l(i,{type:o(b)===2?"primary":"",size:"small",onClick:t[5]||(t[5]=d=>x("接收",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),o(e).receiveProjectType==1?(R(),ae(W,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:_,modelValue:o(e).chargeUserId,"onUpdate:modelValue":t[6]||(t[6]=d=>o(e).chargeUserId=d),data:o(S),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:K,onCheckChange:H,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):A("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),l(de,{ref_key:"userRef",ref:O,onUserData:E},null,512),l(ue,{ref_key:"exchangeRateRef",ref:w,onUserData:E},null,512)])}}}),ze=ie(Pe,[["__scopeId","data-v-5bb29dbf"]]);export{ze as default};
