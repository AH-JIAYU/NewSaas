
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as $,d as ce,aO as pe,r as n,l as me,b as r,q as de,o as i,e as N,g as t,w as l,h as s,s as fe,f as p,j as m,aN as _e,H as u,k as b,F as H,S as be,bd as ge,aP as ve,E as M,aQ as he,aR as ye,bc as ke,ap as Se,R as we}from"./index-Bym8jAMP.js";import{_ as Ce}from"./index.vue_vue_type_style_index_0_lang-DiVFr2jf.js";import{_ as xe}from"./index-Cjbs729j.js";import{U as Te}from"./user_supplier-Bz7--6S5.js";import"./index.vue_vue_type_script_setup_true_lang-C8jC1RES.js";import"./sortable.esm-C0-Qcoum.js";import"./user_supplier-CuygYZkj.js";const I={list:v=>$.post("bill/getTenantSupplierBillList",v),changestatus:v=>$.post("bill/updateTenantSupplierBill",v)},ze=ce({name:"supplierSettlement",__name:"list",setup(v){const V=Te(),{getParams:O,pagination:f,onSizeChange:j,onCurrentChange:q}=pe(),{format:Q}=ge(),G=n(""),h=n(!0);n();const S=n(!1),c=n([]),w=n(!0);n(!1);const C=n("default"),x=n(!1),J=n([]),D=[{label:"待收票",value:1},{label:"待支付",value:2},{label:"已支付",value:3},{label:"已拒绝",value:4}],K=V.payMethod,F=n(),W=n("formSearch-supplierSettlement"),T=n([{label:"供应商ID",prop:"supplierId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税费",prop:"taxesFees",sortable:!0,checked:!0},{label:"实付金额",prop:"payAmount",sortable:!0,checked:!0},{label:"状态",prop:"billStatus",sortable:!0,checked:!0}]),z=n({supplierId:"",billStatus:"",time:[],beginTime:"",endTime:""}),B=n([]);function X(o){J.value=o}function Y(){Object.assign(z.value,{supplierId:0,billStatus:0,time:[],beginTime:"",endTime:""})}function Z(o){j(o).then(()=>g())}function A(o=1){q(o).then(()=>g())}async function g(){try{h.value=!0;const o={...O(),...z.value},a=await I.list(o);B.value=a.data.tenantSupplierBillInfoList,f.value.total=a.data.total,h.value=!1}catch{}finally{h.value=!1}}async function L(o,a){a===3?ve.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async y=>{(await I.changestatus({id:o,type:a,notes:y.value})).status===1&&M.success({message:"操作成功"}),g()}):((await I.changestatus({id:o,type:a})).status===1&&M.success({message:"操作成功"}),g())}return me(()=>{T.value.forEach(o=>{o.checked&&c.value.push(o.prop)}),g(),F.value=[{index:1,show:!0,type:"input",modelName:"supplierId",placeholder:"供应商ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startplaceholder:"创建开始日期",endplaceholder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"billStatus",placeholder:"状态",option:D,optionLabel:"label",optionValue:"value"}]}),(o,a)=>{const y=xe,P=r("ElDivider"),ee=Ce,k=r("el-button"),te=he,le=ye,R=r("el-row"),_=r("el-col"),d=r("el-table-column"),ae=r("el-tag"),E=ke,oe=r("ElTableColumn"),ne=r("el-empty"),se=r("el-table"),ie=r("ElPagination"),re=Se,ue=de("loading");return i(),N("div",{class:be({"absolute-container":S.value})},[t(re,null,{default:l(()=>[t(y,{formSearchList:F.value,formSearchName:W.value,onCurrentChange:A,onOnReset:Y,model:z.value},null,8,["formSearchList","formSearchName","model"]),t(P,{"border-style":"dashed"}),t(R,{gutter:24},{default:l(()=>[t(ee),t(le,null,{default:l(()=>[t(k,{size:"default",onClick:a[0]||(a[0]=()=>{})},{default:l(()=>[s(" 导出 ")]),_:1}),t(te,{border:w.value,"onUpdate:border":a[1]||(a[1]=e=>w.value=e),tableAutoHeight:S.value,"onUpdate:tableAutoHeight":a[2]||(a[2]=e=>S.value=e),checkList:c.value,"onUpdate:checkList":a[3]||(a[3]=e=>c.value=e),columns:T.value,"onUpdate:columns":a[4]||(a[4]=e=>T.value=e),"line-height":C.value,"onUpdate:lineHeight":a[5]||(a[5]=e=>C.value=e),stripe:x.value,"onUpdate:stripe":a[6]||(a[6]=e=>x.value=e),style:{"margin-left":"12px"},onQueryData:A},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),fe((i(),p(se,{ref_key:"tableSortRef",ref:G,style:{"margin-top":"10px"},"row-key":"id",data:B.value,border:w.value,size:C.value,stripe:x.value,onSelectionChange:X},{empty:l(()=>[t(ne,{image:m(_e),"image-size":300},null,8,["image"])]),default:l(()=>[t(d,{type:"expand"},{default:l(e=>[t(R,{gutter:20,style:{margin:"10px 0"}},{default:l(()=>[t(_,{span:1}),t(_,{span:3},{default:l(()=>[s(" 付款方式: "+u(m(K)[e.row.billStatus-1].label),1)]),_:2},1024),t(_,{span:3},{default:l(()=>[s("账户名称: "+u(e.row.accountName),1)]),_:2},1024),t(_,{span:3},{default:l(()=>[s("收款账号: "+u(e.row.collectionAccount),1)]),_:2},1024),t(_,{span:3},{default:l(()=>[s("银行名称: "+u(e.row.bankName),1)]),_:2},1024),t(_,{span:3},{default:l(()=>[s("结算周期: "+u(e.row.settlementCycle),1)]),_:2},1024)]),_:2},1024)]),_:1}),c.value.includes("supplierId")?(i(),p(d,{key:0,prop:"supplierId","show-overflow-tooltip":"",align:"center",label:"供应商ID"})):b("",!0),c.value.includes("billTime")?(i(),p(d,{key:1,prop:"billTime","show-overflow-tooltip":"",align:"center",label:"账单日期"},{default:l(({row:e})=>[t(ae,{effect:"plain",type:"info"},{default:l(()=>[s(u(m(Q)(e.billTime)),1)]),_:2},1024)]),_:1})):b("",!0),c.value.includes("billAmount")?(i(),p(d,{key:2,prop:"billAmount","show-overflow-tooltip":"",align:"center",label:"账单金额"},{default:l(({row:e})=>[t(E),s(u(e.billAmount||0),1)]),_:1})):b("",!0),c.value.includes("taxesFees")?(i(),p(d,{key:3,prop:"taxesFees","show-overflow-tooltip":"",align:"center",label:"税费"},{default:l(({row:e})=>[t(E),s(u(e.taxesFees||0),1)]),_:1})):b("",!0),c.value.includes("payAmount")?(i(),p(d,{key:4,prop:"payAmount","show-overflow-tooltip":"",align:"center",label:"实付金额"},{default:l(({row:e})=>[t(E),s(u(e.payAmount||0),1)]),_:1})):b("",!0),c.value.includes("billStatus")?(i(),p(oe,{key:5,align:"center","show-overflow-tooltip":"",prop:"",label:"状态"},{default:l(({row:e})=>[s(u(D[e.billStatus-1]),1)]),_:1})):b("",!0),t(d,{align:"center",fixed:"right",label:"操作",width:"170"},{default:l(({row:e})=>[e.billStatus===1?(i(),p(k,{key:0,size:"small",plain:"",type:"primary",onClick:U=>L(e.id,1)},{default:l(()=>[s(" 确认收票 ")]),_:2},1032,["onClick"])):e.billStatus===2?(i(),N(H,{key:1},[t(k,{size:"small",plain:"",onClick:U=>L(e.id,2)},{default:l(()=>[s(" 支付 ")]),_:2},1032,["onClick"]),t(k,{size:"small",plain:"",type:"danger",onClick:U=>L(e.id,3)},{default:l(()=>[s(" 拒绝 ")]),_:2},1032,["onClick"])],64)):(i(),N(H,{key:2},[s("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[ue,h.value]]),t(ie,{"current-page":m(f).page,total:m(f).total,"page-size":m(f).size,"page-sizes":m(f).sizes,layout:m(f).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Z,onCurrentChange:A},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),Be=we(ze,[["__scopeId","data-v-aa30f77a"]]);export{Be as default};
