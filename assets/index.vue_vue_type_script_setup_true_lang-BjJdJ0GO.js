
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as E}from"./index.vue_vue_type_script_setup_true_lang-4uRg-9q9.js";import{a as f}from"./user_customer-Um3Ufjwv.js";import{ah as V,r as c,d as L,a0 as I,a1 as p,a as C,o as z,b as B,f as l,w as u,g as v,i as P,al as F,ai as h}from"./index-AWq_1fCc.js";const M=V("stagedData",()=>{const _=c(),i=c();return{userCustomer:_,usersupplier:i}}),Q=M,q=L({__name:"index",emits:["fetch-data"],setup(_,{expose:i,emit:b}){const d=Q(),w=b,o=c(!1),n=c(""),r=c([]);function y(e){r.value.push(e)}I("validateTopTabs",y);let s=p([]);const D=[{customerAccord:"客户名称",customerShortName:"",companyName:"",customerName:"",customerPhone:"",emailAddress:"",chargeName:"",settlementCycle:null,customerStatus:null,antecedentQuestionnaire:null,riskControl:null,turnover:null,rateAudit:null}];async function S(e){if(!e)n.value="添加",s=d.userCustomer||F(D);else{n.value="编辑";const{data:t}=await f.detail({tenantCustomerId:e.tenantCustomerId});k(t)}o.value=!0}function k(e){s.length=0,s.push({...e}),e.children&&e.children.length&&e.children.forEach(t=>{s.push({...t})})}function T(e){const t=new Set;for(const a of e){if(t.has(a.customerAccord))return!0;t.add(a.customerAccord)}return!1}function x(){d.userCustomer=s,s=p([]),o.value=!1,r.value=[]}function g(){s=p([]),o.value=!1,r.value=[],n.value==="添加"&&(d.userCustomer=null)}async function N(){const e=[];r.value.forEach(t=>{e.push(t.validate())});try{if((await Promise.all(e)).every(a=>a))if(T(s))h.warning({message:"客户名称重复",center:!0});else{if(n.value==="添加"){const a={tenantCustomerInfoList:s},{status:m}=await f.create(a);m===1&&h.success({message:"新增成功",center:!0})}else{const{status:a}=await f.edit(s[0]);a===1&&h.success({message:"修改成功",center:!0})}w("fetch-data"),g()}}catch(t){console.error("Form validation failed:",t)}}return i({showEdit:S}),(e,t)=>{const a=C("el-button"),m=C("el-drawer");return z(),B("div",null,[l(m,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=A=>o.value=A),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%"},{footer:u(()=>[l(a,{onClick:g},{default:u(()=>[v(" 取消 ")]),_:1}),l(a,{type:"warning",onClick:x},{default:u(()=>[v(" 暂存 ")]),_:1}),l(a,{type:"primary",onClick:N},{default:u(()=>[v(" 确定 ")]),_:1})]),default:u(()=>[l(E,{title:n.value,"left-tabs-data":P(s),"validate-top-tabs":r.value},null,8,["title","left-tabs-data","validate-top-tabs"])]),_:1},8,["modelValue"])])}}});export{q as _};
