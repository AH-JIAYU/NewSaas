
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as v,d as D,r as b,n as U,E as z,a as u,q as C,s as R,i as t,o as c,b as p,f as l,w as n,g as y,F as _,t as B,e as j,y as O,z as S,L as P}from"./index-BZpHbMuZ.js";const V={list:r=>v.post("bill/getMemberBillList",r),create:r=>v.post("bill/addMemberSettlement",r),getMemberBillAvailableBalance:r=>v.post("bill/getMemberBillAvailableBalance",r),changestatus:r=>v.post("bill/updateMemberBill",r)},q=D({__name:"index",props:{id:{default:""}},setup(r,{expose:A}){const i=b(!1),g=b(),a=b({minimumAmount:"",settlementType:1,settlementAmount:"",addMemberSettlementInfoList:[]}),f=b({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),M=b({}),L=async()=>{try{i.value=!0;const m=await V.getMemberBillAvailableBalance({});m.data&&(f.value.memberSettlementInfoList=m.data.memberBillAvailableBalanceInfoList,a.value.minimumAmount=m.data.minimumAmount),i.value=!1}catch{}finally{i.value=!1}},h=m=>{a.value.addMemberSettlementInfoList=[];const o=f.value.memberSettlementInfoList.filter(s=>m.includes(s.id));for(let s=0;s<o.length;s++)a.value.addMemberSettlementInfoList.push(o[s])};return U(async()=>{await L()}),A({submit(){return new Promise(m=>{g.value&&g.value.validate(o=>{if(o)try{i.value=!0,V.create(a.value).then(()=>{i.value=!1,z.success({message:"新增成功",center:!0}),m()})}catch{}finally{i.value=!1}})})}}),(m,o)=>{const s=u("el-radio"),E=u("el-radio-group"),d=u("ElFormItem"),I=u("ElInput"),x=u("el-option"),k=u("el-select"),w=u("ElInputNumber"),F=u("ElForm"),N=C("loading");return R((c(),p("div",null,[l(F,{ref_key:"formRef",ref:g,model:t(a),rules:t(M),"label-width":"9rem"},{default:n(()=>[l(d,{label:"结算方式"},{default:n(()=>[l(E,{modelValue:t(a).settlementType,"onUpdate:modelValue":o[0]||(o[0]=e=>t(a).settlementType=e)},{default:n(()=>[l(s,{value:1,size:"large"},{default:n(()=>[y(" 全部结算 ")]),_:1}),l(s,{value:2,size:"large"},{default:n(()=>[y(" 指定结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(a).settlementType===1?(c(),p(_,{key:0},[l(d,{label:"最低结算额度"},{default:n(()=>[l(I,{disabled:"",placeholder:"",value:t(a).minimumAmount},null,8,["value"])]),_:1}),l(d,{label:"结算金额"},{default:n(()=>[l(I,{modelValue:t(a).settlementAmount,"onUpdate:modelValue":o[1]||(o[1]=e=>t(a).settlementAmount=e),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(c(),p(_,{key:1},[l(d,{label:"指定会员"},{default:n(()=>[l(k,{placeholder:"Select",modelValue:t(f).memberSettlementInfoSelect,"onUpdate:modelValue":o[2]||(o[2]=e=>t(f).memberSettlementInfoSelect=e),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:h},{default:n(()=>[(c(!0),p(_,null,B(t(f).memberSettlementInfoList,e=>(c(),j(x,{key:e.id,value:e.id,label:e.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"最低结算额度"},{default:n(()=>[l(I,{disabled:"",placeholder:"",value:t(a).minimumAmount},null,8,["value"])]),_:1}),(c(!0),p(_,null,B(t(a).addMemberSettlementInfoList,e=>(c(),p(_,null,[l(d,{label:""},{default:n(()=>[O("p",null,S(e.memberId)+" - "+S(e.memberName)+" - 可用余额："+S(e.availableBalance),1)]),_:2},1024),l(d,{label:"结算金额"},{default:n(()=>[l(w,{"controls-position":"right",modelValue:e.settlementAmount,"onUpdate:modelValue":T=>e.settlementAmount=T,max:e.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[N,t(i)]])}}}),$=P(q,[["__scopeId","data-v-c317f854"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));export{$ as D,V as a,H as i};
