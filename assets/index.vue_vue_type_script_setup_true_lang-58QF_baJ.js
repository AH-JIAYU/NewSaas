
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as f,d as P,r as s,k as G,a as r,p as H,q as K,o as _,b as g,f as a,w as o,s as S,g as b,F as w,t as M,e as Q,E as T,v as W,N as X}from"./index-C66yBkEV.js";import{u as Z}from"./user_customer-BIFRoZkv.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-CvYBXZdv.js";const h={list:d=>f.post("tenant-invoice/getTenantInvoices",d),create:d=>f.post("tenant-invoice/insertTenantInvoice",d),edit:d=>f.post("tenant-invoice/updateById",d),delete:d=>f.post("tenant-invoice/deleteById",d)},le={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"0 1rem"}},ae={style:{flex:"auto"}},ue=P({name:"Edit",__name:"index",emits:["success"],setup(d,{expose:E,emit:Y}){const A=Z(),C=Y,k=s(""),y=s(),n=s(!1),D=s([]),c=s(),m=s(!1),x=s(),B=[{lable:"未收款",value:1},{lable:"部分收款",value:2},{lable:"已完结",value:3},{lable:"坏账",value:4}],t=s({id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""}),L=s({invoiceCode:[{required:!0,trigger:"blur",message:"请输入姓名"}],tenantCustomerId:[{required:!0,trigger:"change",message:"请选择客户"}]});function N(){return new Promise(u=>{t.value.id?c.value&&c.value.validate(e=>{if(e)try{n.value=!0;const v=W(t.value);h.edit(v).then(()=>{n.value=!1,T.success({message:"编辑成功",center:!0}),C("success"),m.value=!1,u()})}catch{}finally{n.value=!1}}):c.value&&c.value.validate(e=>{if(e)try{n.value=!0,delete t.value.id,h.create(t.value).then(()=>{n.value=!1,T.success({message:"新增成功",center:!0}),C("success"),m.value=!1,u()})}catch{}finally{n.value=!1}})})}async function $(u){try{n.value=!0,u?t.value=JSON.parse(u):t.value={id:null,tenantCustomerId:"",invoiceCode:"",invoiceAmount:null,invoiceTax:null,actualReceipts:null,invoiceStatus:null,invoiceDate:"",paymentDate:"",remark:""},k.value=u!=null&&u.id?"编辑":"新增",n.value=!1,m.value=!0}catch{}finally{n.value=!1}}const q=()=>{x.value.showEdit()},I=async()=>{D.value=await A.getCustomerList()};return G(async()=>{y.value=new Date,await I()}),E({showEdit:$}),(u,e)=>{const v=r("el-option"),F=X,V=r("el-button"),U=r("el-select"),i=r("el-form-item"),p=r("el-input"),O=r("ElOption"),R=r("el-date-picker"),j=r("el-form"),z=r("el-dialog"),J=H("loading");return K((_(),g("div",null,[a(z,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=l=>m.value=l),title:k.value,width:"700"},{footer:o(()=>[S("div",ae,[a(V,{type:"",onClick:e[9]||(e[9]=l=>m.value=!1)},{default:o(()=>[b(" 取消 ")]),_:1}),a(V,{type:"primary",onClick:N},{default:o(()=>[b(" 确定 ")]),_:1})])]),default:o(()=>[a(j,{ref_key:"formRef",ref:c,"label-width":"5.3125rem",model:t.value,rules:L.value,inline:!1},{default:o(()=>[a(i,{label:"客户简称",prop:"tenantCustomerId"},{default:o(()=>[a(U,{modelValue:t.value.tenantCustomerId,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.tenantCustomerId=l),placeholder:"请选择客户",clearable:"",filterable:""},{empty:o(()=>[S("div",le,[b(" 暂无数据 "),a(V,{type:"primary",link:"",size:"small",onClick:q},{default:o(()=>[b(" 快捷新增 "),a(F,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:".125rem",margin:"0 .125rem"}})]),_:1})])]),default:o(()=>[(_(!0),g(w,null,M(D.value,l=>(_(),Q(v,{key:l.tenantCustomerId,value:l.tenantCustomerId,label:l.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{prop:"invoiceCode",label:"发票编号"},{default:o(()=>[a(p,{modelValue:t.value.invoiceCode,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.invoiceCode=l),placeholder:"请输入发票编号",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"发票金额"},{default:o(()=>[a(p,{modelValue:t.value.invoiceAmount,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.invoiceAmount=l),modelModifiers:{number:!0},placeholder:"请输入发票金额",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"手续费(税)"},{default:o(()=>[a(p,{modelValue:t.value.invoiceTax,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.invoiceTax=l),modelModifiers:{number:!0},placeholder:"请输入手续费",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"实际收款"},{default:o(()=>[a(p,{modelValue:t.value.actualReceipts,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.actualReceipts=l),modelModifiers:{number:!0},placeholder:"请输入实际收款",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"发票状态"},{default:o(()=>[a(U,{modelValue:t.value.invoiceStatus,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.invoiceStatus=l),placeholder:"请选择发票状态",clearable:"",filterable:""},{default:o(()=>[(_(),g(w,null,M(B,l=>a(O,{label:l.lable,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(i,{style:{width:"100%"},label:"开票日期"},{default:o(()=>[a(R,{modelValue:t.value.invoiceDate,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.invoiceDate=l),"default-time":y.value,type:"datetime",placeholder:"请选择开票日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(i,{label:"收款日期"},{default:o(()=>[a(R,{modelValue:t.value.paymentDate,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.paymentDate=l),"default-time":y.value,type:"datetime",placeholder:"请选择收款日期","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(i,{label:"备注"},{default:o(()=>[a(p,{modelValue:t.value.remark,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.remark=l),placeholder:"备注说明",clearable:"",rows:5,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(ee,{ref_key:"editRef",ref:x,onFetchData:I},null,512)])),[[J,n.value]])}}});export{ue as _,h as a};
