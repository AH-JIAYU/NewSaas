
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as $e,am as Ee,r as i,aO as Pe,a5 as Be,c as Oe,l as Ae,b as y,q as He,s as te,o,e as w,g as a,w as l,h as r,f as s,j as g,aN as Ue,t as d,H as f,k as c,F as le,v as Ve,S as L,E as ne,aQ as Fe,aR as Me,bd as Je,N as qe,ap as Qe,R as Ye}from"./index-D7Sst9VF.js";import{_ as Ge}from"./index-DFK48xBm.js";import{_ as Ke}from"./index.vue_vue_type_style_index_0_lang-CmFAJyPs.js";import{_ as We}from"./index-CaP4xy9m.js";import{_ as Xe}from"./index.vue_vue_type_script_setup_true_lang-DZA6EHkV.js";import Ze from"./index-Bbs3kVgB.js";import{_ as et}from"./index.vue_vue_type_script_setup_true_lang-DSLbmYzB.js";import tt from"./index-DOCOd79x.js";import lt from"./index-CH-ePuw6.js";import{u as nt}from"./user_customer-WeyHeXqW.js";import{u as at}from"./configuration_manager-CjvOdz7z.js";import{a as ot}from"./project_settlement-BgMXN1HY.js";import"./index-B6EhJAmM.js";import"./index.vue_vue_type_script_setup_true_lang-C4I_GVgn.js";import"./sortable.esm-C0-Qcoum.js";import"./user_customer-BztjzJoc.js";const st={class:"copyId"},it={class:"id oneLine tableSmall"},rt={class:"oneLine tableBig"},ct={class:"oneLine"},ut={class:"oneLine"},dt={class:"tableBig"},pt={key:0,class:"oneLine"},mt=["src"],ft={class:"tableBig"},_t={class:"flex-c tableBig"},yt={class:"oneLine",style:{width:"calc(100% - 20px)"}},gt={class:"flex-c tableBig"},ht={class:"oneLine",style:{width:"calc(100% - 40px)"}},vt={class:"flex-c tableBig"},bt={class:"oneLine",style:{width:"calc(100% - 20px)"}},kt=$e({name:"settlement",__name:"list",setup(St){const F=Ee(),M=i(),ae=nt(),J=i(),oe=at(),se=i(),ie=i([]),{pagination:k,onSizeChange:re,onCurrentChange:ce}=Pe(),ue=i(""),S=i(!0),x=i(),q=i(),Q=i(),z=i(),Y=i(),T=i(!1),R=i(!1),p=i([]);i(!1);const $=i("default"),E=i(!1),C=i([]),P=i([{label:"项目ID",prop:"projectId",sortable:!0,checked:!0},{label:"项目名称",prop:"projectName",sortable:!0,checked:!0},{label:"客户简称/标识",prop:"customerName",sortable:!0,checked:!0},{label:"原价",prop:"projectAmount",sortable:!0,checked:!0},{label:"所属国家",prop:"countryId",sortable:!0,checked:!0},{label:"系统/审核完成数",prop:"systemDone",sortable:!0,checked:!0},{label:"结算PO号",prop:"settlementPo",sortable:!0,checked:!0},{label:"结算状态",prop:"status",sortable:!0,checked:!0},{label:"节点时间",prop:"nodeTime",sortable:!0,checked:!0},{label:"备注",prop:"remark",sortable:!0,checked:!0}]),G=i(),de=i("formSearch-settlement"),K=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],h=Be({page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:"",timeType:"",time:[],startTime:"",endTime:""}),W=i([]);function pe(t){C.value=t}const I=i();function me(t){t?I.value=t.projectId:I.value=""}function fe(t){if(C.value.length)x.value.showEdit(t,C.value);else return ne({message:"请选择至少一条数据",type:"warning"})}function _e(){q.value.showEdit()}function ye(t){if(C.value.length)x.value.showEdit(t,C.value);else return ne({message:"请选择至少一条数据",type:"warning"})}async function X(t){Q.value.showEdit(JSON.stringify(t))}function ge(t){z.value.showEdit(JSON.stringify(t),"")}function B(t,n){z.value.showEdit(JSON.stringify(t),n)}function he(t){Y.value.showEdit(JSON.stringify(t))}function ve(t){re(t).then(()=>{h.limit=t,b()})}function O(t=1){ce(t).then(()=>{h.page=t,b()})}function be(){Object.assign(h,{page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:"",timeType:"",time:[],startTime:"",endTime:""}),ie.value=[],b()}const ke=t=>{if(!t||t.length===0)return"";const n=m=>{const N=m.getFullYear(),u=m.getMonth()+1,H=m.getDate();return`${N}-${u}-${H}`};if(t.length===1){const m=new Date(parseInt(t[0]));return n(m)}else if(t.length===2){const[m,N]=t.map(u=>new Date(parseInt(u)));return`${n(m)} - ${n(N)}`}return""},D=Oe(()=>t=>M.value.filter(m=>t.includes(m.id)).map(m=>m.chineseName));async function b(){try{S.value=!0;const t={...h};Array.isArray(h.countryId)&&(t.countryId=t.countryId.join(",")),h.time&&h.time.length&&(t.beginTime=t.time[0]||"",t.endTime=t.time[1]||""),h.settlementStatus?t.settlementStatus=[t.settlementStatus]:t.settlementStatus=[];const{data:n}=await ot.list(t);W.value=n.projectSettlementList,k.value.total=+n.total,S.value=!1}catch{}finally{S.value=!1}}Ae(async()=>{M.value=await F.getCountry(),J.value=await ae.getCustomerList(),se.value=await oe.getStaff(),P.value.forEach(t=>{t.checked&&p.value.push(t.prop)}),b(),G.value=[{index:1,show:!0,type:"input",modelName:"projectId",placeholder:"项目ID"},{index:2,show:!0,type:"input",modelName:"projectName",placeholder:"项目名称"},{index:3,show:!0,type:"input",modelName:"projectIdentification",placeholder:"项目标识"},{index:4,show:!0,type:"select",modelName:"countryData",placeholder:"国家",option:"global",optionLabel:"chineseName",optionValue:"id"},{index:5,show:!0,type:"select",modelName:"customerId",placeholder:"客户简称",option:"customerId",optionLabel:"tenantCustomerId",optionValue:"tenantCustomerId"},{index:6,show:!0,type:"select",modelName:"settlementStatus",placeholder:"结算状态",option:"settlementStatus",optionLabel:"label",optionValue:"value"},{index:7,show:!0,type:"select",modelName:"timeType",placeholder:"时间类型",option:"timeType",optionLabel:"label",optionValue:"value"},{index:8,show:!0,type:"datetimerange",modelName:"timeArr",startPlaceHolder:"开始日期",endPlaceHolder:"结束日期"}]});const Se={customerId:()=>J.value,settlementStatus:()=>K,timeType:()=>K};function A(t,n){switch(t){case"auditing":X(n);break;case"edit":ge(n);break;case"refundDetails":he(n);break}}return(t,n)=>{const m=We,N=y("ElDivider"),u=y("el-button"),H=Ke,Ce=Fe,Ie=Me,Ne=y("el-row"),_=y("el-table-column"),Z=Ge,De=Je,U=y("el-tag"),je=y("el-link"),we=y("el-tooltip"),j=y("el-text"),V=qe,Le=y("ElSpace"),xe=y("el-empty"),ze=y("el-table"),Te=y("ElPagination"),Re=Qe,ee=He("loading");return te((o(),w("div",{class:L({"absolute-container":T.value})},[a(Re,null,{default:l(()=>[a(m,{formSearchList:G.value,formSearchName:de.value,onCurrentChange:O,onOnReset:be,model:h,formOption:Se},null,8,["formSearchList","formSearchName","model"]),a(N,{"border-style":"dashed"}),a(Ne,{gutter:24},{default:l(()=>[a(H,null,{default:l(()=>[a(u,{type:"primary",size:"default",onClick:_e},{default:l(()=>[r(" 新增结算 ")]),_:1}),a(u,{type:"primary",size:"default",onClick:n[0]||(n[0]=e=>fe(1))},{default:l(()=>[r(" 开票 ")]),_:1}),a(u,{type:"primary",size:"default",onClick:n[1]||(n[1]=e=>ye(2))},{default:l(()=>[r(" 结算 ")]),_:1})]),_:1}),a(Ie,null,{default:l(()=>[a(u,{size:"default",onClick:n[2]||(n[2]=()=>{})},{default:l(()=>[r(" 导出 ")]),_:1}),a(Ce,{border:R.value,"onUpdate:border":n[3]||(n[3]=e=>R.value=e),tableAutoHeight:T.value,"onUpdate:tableAutoHeight":n[4]||(n[4]=e=>T.value=e),checkList:p.value,"onUpdate:checkList":n[5]||(n[5]=e=>p.value=e),columns:P.value,"onUpdate:columns":n[6]||(n[6]=e=>P.value=e),"line-height":$.value,"onUpdate:lineHeight":n[7]||(n[7]=e=>$.value=e),stripe:E.value,"onUpdate:stripe":n[8]||(n[8]=e=>E.value=e),style:{"margin-left":"0.75rem"},onQueryData:O},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),te((o(),s(ze,{ref_key:"tableSortRef",ref:ue,style:{"margin-top":"10px"},"row-key":"id",data:W.value,border:R.value,size:$.value,stripe:E.value,"highlight-current-row":"",onSelectionChange:pe,onCurrentChange:me},{empty:l(()=>[a(xe,{image:g(Ue),"image-size":300},null,8,["image"])]),default:l(()=>[a(_,{align:"left",type:"selection"}),p.value.includes("projectId")?(o(),s(_,{key:0,"show-overflow-tooltip":"",prop:"projectId",align:"left",width:"150",label:"项目"},{default:l(({row:e})=>[d("div",st,[d("div",it,"ID: "+f(e.projectId),1),a(Z,{class:"copy",content:e.projectId},null,8,["content"])])]),_:1})):c("",!0),p.value.includes("projectName")?(o(),s(_,{key:1,"show-overflow-tooltip":"",prop:"projectName",align:"left",width:"150",label:"名称/标识"},{default:l(({row:e})=>[d("b",rt,"名: "+f(e.projectName?e.projectName:"-"),1),d("div",ct,"标: "+f(e.customerName.split("/")[1]!=="null"?e.customerName.split("/")[1]:"-"),1)]),_:1})):c("",!0),p.value.includes("customerName")?(o(),s(_,{key:2,"show-overflow-tooltip":"",prop:"customerName",width:"130",align:"left",label:"客户"},{default:l(({row:e})=>[d("div",ut,[d("b",dt,f(e.customerName.split("/")[0]),1),e.projectType!==2?(o(),w("div",pt,[d("img",{src:e.avatar,alt:"",class:"avatar"},null,8,mt),d("span",null,f(e.userName),1)])):c("",!0)])]),_:1})):c("",!0),p.value.includes("projectAmount")?(o(),s(_,{key:3,"show-overflow-tooltip":"",align:"left",label:"原价",width:"80"},{default:l(({row:e})=>[d("div",ft,[a(De),r(f(e.projectAmount||0),1)])]),_:1})):c("",!0),p.value.includes("countryId")?(o(),s(_,{key:4,"show-overflow-tooltip":"",align:"left",label:"国家",width:"80"},{default:l(({row:e})=>[e.countryId?(o(),w(le,{key:0},[e.countryId.length>=g(F).country.length?(o(),s(U,{key:0,type:"primary"},{default:l(()=>[r("全球")]),_:1})):g(D)(e.countryId).length>1?(o(),s(we,{key:1,class:"box-item",effect:"dark",content:g(D)(e.countryId).join(","),placement:"top"},{default:l(()=>[a(je,{type:"primary"},{default:l(()=>[a(U,{type:"primary"},{default:l(()=>[r("×"+f(g(D)(e.countryId).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])):(o(!0),w(le,{key:2},Ve(g(D)(e.countryId),v=>(o(),s(U,{key:v,type:"primary"},{default:l(()=>[r(f(v),1)]),_:2},1024))),128))],64)):c("",!0)]),_:1})):c("",!0),p.value.includes("systemDone")?(o(),s(_,{key:5,"show-overflow-tooltip":"",prop:"systemDone",align:"left",width:"130",label:"系统/审核完成数"},{default:l(({row:e})=>[d("div",_t,[d("div",yt,[a(j,null,{default:l(()=>[r(f(e.systemDone?e.systemDone:0),1)]),_:2},1024),r(" /"),a(j,{class:"mx-1",type:"success"},{default:l(()=>[r(f(e.settlementDone?e.settlementDone:0),1)]),_:2},1024)]),a(V,{onClick:v=>B(e,"systemDone"),class:L({edit:"edit",current:e.projectId===I.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):c("",!0),p.value.includes("settlementDone")?(o(),s(_,{key:6,"show-overflow-tooltip":"",prop:"settlementDone",align:"left",label:"结算完成数"})):c("",!0),p.value.includes("settlementPo")?(o(),s(_,{key:7,"show-overflow-tooltip":"",prop:"settlementPo",align:"left",label:"结算PO号"},{default:l(({row:e})=>[d("div",gt,[d("div",ht,f(e.settlementPo?e.settlementPo:"-"),1),e.settlementPo?(o(),s(Z,{key:0,class:"copy",content:e.settlementPo},null,8,["content"])):c("",!0),a(V,{onClick:v=>B(e,"settlementPo"),class:L({edit:"edit",current:e.projectId===I.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):c("",!0),p.value.includes("nodeTime")?(o(),s(_,{key:8,"show-overflow-tooltip":"",prop:"nodeTime",align:"left",label:"节点"},{default:l(({row:e})=>[e.status===1?(o(),s(u,{key:0,size:"small",class:"p-1",type:"warning"},{default:l(()=>[r("待审核")]),_:1})):c("",!0),e.status===3?(o(),s(u,{key:1,size:"small",class:"p-1",type:"success"},{default:l(()=>[r("已开票")]),_:1})):c("",!0),e.status===4?(o(),s(u,{key:2,size:"small",class:"p-1",type:"info"},{default:l(()=>[r("已结算")]),_:1})):c("",!0),e.status===2?(o(),s(u,{key:3,size:"small",class:"p-1",type:"primary"},{default:l(()=>[r("已审核")]),_:1})):c("",!0),e.status===5?(o(),s(u,{key:4,size:"small",class:"p-1",type:"danger"},{default:l(()=>[r("已冻结")]),_:1})):c("",!0),e.nodeTime.length?(o(),s(j,{key:5,class:"mx-1 tableBig"},{default:l(()=>[r(f(ke(e.nodeTime)),1)]),_:2},1024)):(o(),s(j,{key:6,class:"mx-1 tableBig"},{default:l(()=>[r("-")]),_:1}))]),_:1})):c("",!0),p.value.includes("remark")?(o(),s(_,{key:9,"show-overflow-tooltip":"",prop:"remark",align:"left",label:"备注"},{default:l(({row:e})=>[d("div",vt,[d("div",bt,f(e.remark?e.remark:"-"),1),a(V,{onClick:v=>B(e,"remark"),class:L({edit:"edit",current:e.projectId===I.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):c("",!0),a(_,{align:"left",fixed:"right",label:"操作",width:"250"},{default:l(({row:e})=>[a(Le,null,{default:l(()=>[e.status===1?(o(),s(u,{key:0,type:"primary",size:"small",plain:"",onClick:v=>X(e)},{default:l(()=>[r(" 审核 ")]),_:2},1032,["onClick"])):c("",!0),e.status===5?(o(),s(u,{key:1,type:"primary",size:"small",plain:"",onClick:v=>A("auditing",e)},{default:l(()=>[r(" 重审 ")]),_:2},1032,["onClick"])):c("",!0),a(u,{type:"warning",size:"small",plain:"",onClick:v=>A("edit",e)},{default:l(()=>[r(" 结算编辑 ")]),_:2},1032,["onClick"]),a(u,{type:"danger",size:"small",plain:"",onClick:v=>A("refundDetails",e)},{default:l(()=>[r(" 退款详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","border","size","stripe"])),[[ee,S.value]]),a(Te,{"current-page":g(k).page,total:g(k).total,"page-size":g(k).size,"page-sizes":g(k).sizes,layout:g(k).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:ve,onCurrentChange:O},null,8,["current-page","total","page-size","page-sizes","layout"]),a(Xe,{onSuccess:b,ref_key:"invoicingRef",ref:x},null,512),a(Ze,{onSuccess:b,ref_key:"auditingRef",ref:Q},null,512),a(et,{onSuccess:b,ref_key:"editRef",ref:z},null,512),a(tt,{ref_key:"refundRef",ref:Y},null,512),a(lt,{onSuccess:b,ref_key:"addSettlementRef",ref:q},null,512)]),_:1})],2)),[[ee,S.value]])}}}),At=Ye(kt,[["__scopeId","data-v-926fdaf0"]]);export{At as default};
