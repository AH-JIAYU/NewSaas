
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as K,s as ne}from"./apiLoading-CZkQQOsa.js";import{a as D}from"./projectManagement-C68tm61W.js";import{a as ue}from"./user_cooperation-CLizG9cQ.js";import{a as ce}from"./survey_vip_department-Rzevefnm.js";import{U as de}from"./user_supplier-BhMC-Rkt.js";import{u as Ae}from"./survey_vipGroup-DvnlbsBd.js";import{d as ge,r as n,n as fe,a as m,q as me,o as u,b as S,f as i,w as s,y as I,g as d,s as Ie,i as t,e as w,j as y,F as H,t as M,A as ve,E as Q,aH as Se,aI as Le,L as ye}from"./index--qq4lFqn.js";const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAmtJREFUOE+dlTtIXEEUhr9ZFxWfaOEDg6/CxiZWBkEEsbARIqwoJLLXLoEISZdyy3QJRIidd8FANAG1sFJEsDCIQrRRRMyVbCEq4qsQXXficXa9d/eqwUyz7Jkz3/xz5sx/FXcMHYkEqa3tBZ4Dz4CKZFrsOvYLpSZJJMbUwMB55nKVGdC2/QL4ADy5azNPbBel3qpweMybdwtMqvoIvPkHKHN6GMcZVJFIXCZcoG1/AV49EpZKH1KWNXgL1NFoL1p/S4OVlUFLCxQXw8EBrK5CTEp473ipLOur0iMjuSj121N4s6K7G4qK3NUXFzA+DldX9xFjOE6d0tFoGK3ttKycHOjr8y+cnjZqH1KpbXsi2R5uWnk5dHb6ly0twfr6Q8AfStu2HLc2LSs7G7q6oKDADctRp6bg9PQhYEyAl0DQl1VZCR0dEAjA4SGsrEBFhdnk5AQ2NuDc19fx+4HBIPT0mEtYXITWVojHIZEwm8jv7CwcHXm13AD/pL2KwkJoaIDqanPLoqymBkpLYX7eHFkurbERsrJgZsYLdAT4HQjdRkMhyM93k+bmoL0dtrZgbw8uL0FaqK3NAEdHvcBJAcrbdaP9/eZIqbGwAM3NsL8P29umbURtU5PJmJAmSQ6lLJV8w3LTxgykZUpKIC8PcnMNQJTIsc/OoKoKdnagvh6Wl2FzM4XbReu6m7fsU3lXY0hdpW5S1+NjWFszil11feI8XnP4/B9Ok8INK8t6LX8y7Uugj3WcIRznnc++UlslneeTzyz8ZRDreS8O453yOfZNTcWBAgGxNPkEPPX06S7w8zo2ieOMpVR5gX8BZ0fYI9liOMMAAAAASUVORK5CYII=",N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAS1JREFUKFN1kr8vQ1EUxz+HRl5EYhEaSRMSTBIDo/DKYDCwWVjKZrAYREgaJTF0MJD4kdbSjT/AxAsREgYSo0gs/gDLE1575Op77VV1l3ty7vfzzflxhfC4aY2RYAZhGugBPlAeBPYv5uUx0okJxo+0o9jAKcJw9FBzb3opWTc5cY/VocQVwtA/4ii95qVkywBLKDu2OJ2E8xe4fLWySsAnveLm9K7WPd4C2Qk4vP8DLRvgCyHW1gyDnVVHA80NwIb3CyqIm1cfcPrbYbKvCjQ1wmgXnD1D9rqSL9QtyYgzY+AHkPGgqCEgrBhgEWHXbnp1BH4gW2z24tMt4cJu7MYTrfD2bjmX3cpjNZG7p3EcTuouzoxT2K4szi4lmdcphdnwawTALSUOvAV5inTfDOJhkx1Lf7QAAAAASUVORK5CYII=",he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAklJREFUOE+VlF9Ik2EUxp/HjbZSgoqJZFiLIBeEgoOEiBZ02UAoWFCwdbUNEvKui0CFLrorUHBdaVHQqGiw0V1oRNGFhiGUdtGWDlquMMJs4fpOfPv7fdvrau/d953n/b3nHM55CMWREY8Vfd0+oQwA6AfYUZKlITJPtsRS2V9R56WpXO111v6QeOiCUG4A3Kd6zPAvQ5Er9N6OGnUVoJ6V5u6+SeDyP0CmsIhEWuaWBjkyk9cDFeCfeHiClFAzsLJWgHHLmchgBShPgz7R+EAJ6zoBOI4UQ6sLwMorpYyCi/RG7lMmA3Zx2JMAyo0HDp4G9nuA94+BHj9otRUh+Rzk7V3AdRZIPgNS0wa4pDm75KQkwn6BTJme9YyCre2Q+TuGppQUArDXD/xchcwMm64VstTiwScg9fGonlPXwR17Grdz4xtk+lqNRh5RS4T0cg+ogLL2Efj9w3xpWxu4+xCgBqZ14CYAqxK4/BLIrZmB9l1g1/EtgMg3Bn5ZADbX6zNsP9oIGFyp24pSD+XzGyD33Qy07QT3urcqOUUtEXwI8Nx/l9zqADuPqYEiMRZ3F/eUwK8fgPyGOUOLDXS4lECCAeo7LO7DSVPZJ4fBtuqcK+dnPQN5PmoMZT5lc87CLtdl2dEDdPY3nsPlF0D2XUVDkfO681TNIREaa9ZpyjQRRizeibD+bbavPtdYs45DYByzi0N19lV5reg8t0xmoSxe0hRe1R3GGK5z7EJPJwN2OLb7RLQBkL0ASu4tGQCvKYxhbjFazsoI/AvM0v9Xs8g/iwAAAABJRU5ErkJggg==",je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAoBJREFUOE+dlU1IVFEYhp/TDJYiCEYU0VRGiYugSIKgqJsQgVEMEU0xA4UWGCUUREQgTbioRVCkkBtNS4f8CSdq1cImKHCX/aCrspxZTAitJCPHTp577u+MU9i3uZzvO+c97/dz3itYxIy4DBIigiCMZBewxtwmyCAZQ5Bkiv5UXPzMPy7yHUanjAK3EKxb7DKPLwtcTDWIfu8+B9BktZ47wIV/APnDkg7SNKfiIqeTsMzolPcRNC0JzN3cnmoQzQ6g0SUjwGPlKAnA2VqoLIWhcZiY9l9RvRIiW2H6B/S8hVmTFyCJpRpFnzAeyBVIJu3CN+3UB5TN/IJwAualXgcEDByHyjK9Hp6Ae6MOYIY0VcLokqeAbptHyz6o2+Syqn/ksigNwrMoBJbp+MhnaH3lyUASE0anHDbHwzKV0s0DULEcuseg950/5dg2aNyh2V95UVCSIcVQpbvRe0ylpmrp1CevUyo2/9sthROWZBTDOQRB27m6HG7sh1VlkPgAT8b9aPVbNEPVlOsv4duML+VcAeDl3XCoWm9SLA73uUwVM1VD9S1Sw5xKOQ3uq2itgz0b3FvPPIVP3/U6VAEPj7qx11+hZcSXwRcFOAgcs935gLNzkHivO3ukRs+nbQWAkqRKOYqgtxjg+edwcLMGHPgIPX9neFpYyjJpi0E+w5ODkLUKX16ia1iEYZYpqsy37GUZroHatVZTJNx+o2dOmWrGtb36xSgby/qm4IRSHlccumTbkpXGpirpSDWKc2rpl68Qbf+hOO1McalAvuzLLOW566i0byo8C0kGuKoUxrulQLHNmmoFiizIfXhB7rcjrTkVKJUeRZIkbf4CbPFyMP8AN7LhTtHVZc8AAAAASUVORK5CYII=",j=E=>(Se("data-v-2a4be657"),E=E(),Le(),E),Ve=j(()=>I("span",{class:"icon-class"},[I("img",{src:be,alt:"",style:{"margin-right":"0.25rem"}}),d(" 供应商")],-1)),ke=j(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ce={key:1},Ee=j(()=>I("span",{class:"icon-class"},[I("img",{src:he,alt:"",style:{"margin-right":"0.25rem"}}),d(" 调查站")],-1)),Re=j(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ue={key:1},_e=j(()=>I("span",{class:"icon-class"},[I("img",{src:je,alt:"",style:{"margin-right":"0.25rem"}}),d(" 合作商")],-1)),we=j(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Te={key:1},Pe={style:{flex:"auto"}},xe=ge({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(E,{expose:z,emit:J}){const Y=de();Ae();const Z=J,R=n(!1),V=n(!1),T=n(),b=n(),h=n([]),X={children:"children",label:"name"};n([]);const e=n({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),A=n({projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),g=n({projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),p=n({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),F=n({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]}),U=n();async function G(a,l){if(e.value.list=[{...a}],l==="reassign"){e.value.title="重新分配";const f=await K(D.getProjectAllocation({projectId:a.projectId}));e.value.form.projectId=a.projectId;const{getProjectAllocationInfoList:L}=f.data;L.forEach(r=>{r.allocationType===2?g.value={allocationType:r.allocationType,projectId:r.projectId,groupSupplierIdList:r.groupSupplierIdSet}:r.allocationType===3?p.value={allocationType:r.allocationType,projectId:r.projectId,groupSupplierIdList:r.groupSupplierIdSet}:r.allocationType===4&&(A.value={allocationType:r.allocationType,projectId:r.projectId,groupSupplierIdList:r.groupSupplierIdSet},U.value=r.groupSupplierIdSet)})}else e.value.title="分配",e.value.form.projectId=a.projectId,A.value.projectId=a.projectId,g.value.projectId=a.projectId,p.value.projectId=a.projectId;e.value.tenantSupplierList=await K(Y.getTenantSupplierList(a.projectId));const v=await ce.list({name:""});e.value.departmentList=v.data;const c=await K(ue.getAllocationBindList({projectId:a.projectId}));h.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(h.value=e.value.form.groupSupplierIdList),e.value.tenantList=c.data.allocationBindInfoList,V.value=!0}function q(){A.value.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(a=>{A.value.groupSupplierIdList.push(a.beInvitationTenantId)})}function W(){g.value.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(a=>{g.value.groupSupplierIdList.push(a.tenantSupplierId)})}const $=()=>{p.value.groupSupplierIdList=[],e.value.departmentList.forEach(a=>{O(a)}),b.value.setCheckedKeys(p.value.groupSupplierIdList)};function O(a){p.value.groupSupplierIdList.push(a.id),a.children&&a.children.length&&a.children.forEach(l=>{O(l)})}function ee(){p.value.groupSupplierIdList=[],e.value.selectAll.member?($(),b.value.setCheckedKeys(p.value.groupSupplierIdList)):(e.value.selectAll.member=!1,p.value.groupSupplierIdList=[],b.value.setCheckedKeys([]))}const le=(a,l)=>{l?h.value.includes(a.id)||h.value.push(a.id):h.value=h.value.filter(L=>L!==a.id);const v=b.value.getCheckedKeys(),c=b.value.getHalfCheckedKeys(),f=[...v,...c];p.value.groupSupplierIdList=f},k=n(!1),C=n(!1),te=()=>{C.value=!C.value,C.value?k.value=!0:k.value=!1},ae=()=>{Object.assign(A.value,{projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),Object.assign(g.value,{projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),Object.assign(p.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.tenant=!1,e.value.selectAll.supplier=!1,e.value.selectAll.member=!1};function P(){T.value.resetFields(),ae(),V.value=!1,k.value=!1,C.value=null}function oe(){T.value.validate(async a=>{if(a)try{R.value=!0;let l={addProjectAllocationInfoList:[]};if(A.value.groupSupplierIdList.length&&(A.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(A.value)),g.value.groupSupplierIdList.length&&(g.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(g.value)),p.value.groupSupplierIdList.length&&(p.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(p.value)),e.value.title!=="分配")l.addProjectAllocationInfoList.length||(k.value=!0),l.addProjectAllocationInfoList.map(c=>{c.projectId||(c.projectId=e.value.form.projectId),c.allocationType===4&&(c.deleteSet=[],U.value&&U.value.length&&U.value.filter(f=>{c.groupSupplierIdList.map(L=>{f!==L&&c.deleteSet.push(f)})}))});else if(!l.addProjectAllocationInfoList.length){Q.warning({message:"至少选择一个分配目标",center:!0});return}k.value&&(l={addProjectAllocationInfoList:[{projectId:e.value.form.projectId,allocationType:5,groupSupplierIdList:[],deleteSet:[]}]});const{status:v}=await ne(D.allocation(l));R.value=!1,v===1&&Q.success({message:"分配成功",center:!0}),P(),Z("fetch-data")}catch{}finally{R.value=!1}})}const x=a=>{};return fe(async()=>{}),z({showEdit:G}),(a,l)=>{const v=m("el-table-column"),c=m("el-table"),f=m("el-checkbox"),L=m("el-option"),r=m("el-select"),_=m("el-form-item"),se=m("el-tree-select"),B=m("el-button"),ie=m("el-form"),pe=m("el-dialog"),re=me("loading");return u(),S("div",null,[i(pe,{modelValue:t(V),"onUpdate:modelValue":l[10]||(l[10]=o=>ve(V)?V.value=o:null),title:t(e).title,width:"700","before-close":P},{footer:s(()=>[I("div",Pe,[i(B,{onClick:P},{default:s(()=>[d(" 取消 ")]),_:1}),i(B,{type:"primary",onClick:oe},{default:s(()=>[d(" 确定 ")]),_:1})])]),default:s(()=>[Ie((u(),w(c,{data:t(e).list,"row-key":"id"},{default:s(()=>[i(v,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),i(v,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),i(v,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[re,t(R)]]),i(ie,{ref_key:"formRef",ref:T,"label-width":"90px",rules:t(F),model:t(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:s(()=>[i(_,{style:{"margin-top":"1rem"}},{label:s(()=>[Ve]),default:s(()=>[i(r,{modelValue:t(g).groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=o=>t(g).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[i(f,{modelValue:t(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=o=>t(e).selectAll.supplier=o),onChange:W,style:{display:"flex",height:"unset"}},{default:s(()=>[d("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantSupplierList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[1]||(l[1]=o=>x("供应商"))},[d(" 请先维护供应商数据 "),ke])):y("",!0),t(g).groupSupplierIdList.length==0&&t(e).tenantSupplierList.length!=0?(u(),S("span",Ce,"请先选择供应商数据")):y("",!0)]),default:s(()=>[(u(!0),S(H,null,M(t(e).tenantSupplierList,o=>(u(),w(L,{label:o.supplierAccord,key:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(_,null,{label:s(()=>[Ee]),default:s(()=>[i(se,{ref_key:"treeRef",ref:b,modelValue:t(p).groupSupplierIdList,"onUpdate:modelValue":l[5]||(l[5]=o=>t(p).groupSupplierIdList=o),data:t(e).departmentList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:X,onCheckChange:le,"check-strictly":!0,"check-on-click-node":!0,multiple:!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},{header:s(()=>[i(f,{modelValue:t(e).selectAll.member,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).selectAll.member=o),onChange:ee,style:{display:"flex",height:"unset"}},{default:s(()=>[d("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).departmentList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[4]||(l[4]=o=>x("调查站"))},[d(" 请先维护调查站数据 "),Re])):y("",!0),!t(p).groupSupplierIdList.length&&t(e).departmentList.length!=0?(u(),S("span",Ue,"请先选择调查站数据")):y("",!0)]),_:1},8,["modelValue","data"])]),_:1}),i(_,null,{label:s(()=>[_e]),default:s(()=>[i(r,{modelValue:t(A).groupSupplierIdList,"onUpdate:modelValue":l[8]||(l[8]=o=>t(A).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[i(f,{modelValue:t(e).selectAll.tenant,"onUpdate:modelValue":l[6]||(l[6]=o=>t(e).selectAll.tenant=o),onChange:q,style:{display:"flex",height:"unset"}},{default:s(()=>[d("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[7]||(l[7]=o=>x("合作商"))},[d(" 请先维护合作商数据 "),we])):y("",!0),t(A).groupSupplierIdList.length==0&&t(e).tenantList.length!=0?(u(),S("span",Te,"请先选择合作商数据")):y("",!0)]),default:s(()=>[(u(!0),S(H,null,M(t(e).tenantList,o=>(u(),w(L,{label:o.beInvitationTenantName,key:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e).title=="重新分配"?(u(),w(_,{key:0},{label:s(()=>[i(B,{type:t(C)?"primary":"",onClick:l[9]||(l[9]=o=>te()),style:{"border-radius":"1.875rem"}},{default:s(()=>[d(" 取消分配 ")]),_:1},8,["type"])]),_:1})):y("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),Be=ye(xe,[["__scopeId","data-v-2a4be657"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{be as _,Be as a,je as b,ze as i};
