
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ie,m as j,r as d,l as ce,u as me,c as pe,n as fe,a as i,q as ve,o as c,e as p,w as a,y,f as t,g as f,s as _e,i as o,b as E,t as T,F as q,z as J,j as O,p as G,E as Q,aH as ge,aI as he,L as be}from"./index-CDcFrPzE.js";import{a as ye}from"./department-C4UdYaqe.js";import{a as ke}from"./position_manage-BxBBKxVo.js";import{a as xe}from"./configuration_role-C9O3TVMj.js";import{u as Ne}from"./tenant_role-CramahWu.js";import{u as Ve}from"./configuration_manager-DIbVN_R6.js";const W=k=>(ge("data-v-c232dc86"),k=k(),he(),k),we=W(()=>y("div",{class:"card-header"},[y("div",{class:"leftTitle"},"基本信息")],-1)),Ce={class:"card-header"},Ie={class:"leftTitle"},Se={key:0,style:{"margin-left":"20px","font-size":"14px"}},Ee=W(()=>y("div",{class:"card-header"},[y("div",{class:"leftTitle"},"角色信息")],-1)),Le={class:"flex-c"},ze=ie({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success","getList"],["update:modelValue"]),setup(k,{emit:X}){const Y=Ve(),F=d([]),$=d(),ee=ce(),ae=d();Ne();const L=d(),z=d([]),le=d(!1),H=d(),Z=d(),N=k,B=X,_=d(null),U=me(k,"modelValue"),te=pe(()=>N.id===""?"新增用户":"编辑用户"),oe={children:"children",label:"name"},C=d(!1),g=d();d([]);const e=d({id:N.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",roleList:[],role:"",active:!0,positionId:"",organizationalStructureId:""}),h=d([]),I=d({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(u,l,r)=>{const s=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;e.value.phoneNumber?s.test(e.value.phoneNumber)?r():r(new Error("请输入合法手机号")):r()},trigger:"blur"}],email:[{validator:(u,l,r)=>{const s=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e.value.email?s.test(e.value.email)?r():r(new Error("请输入合法邮箱")):r()},trigger:"blur"}]}),se=u=>{Array.isArray(u)&&u.length>1&&(e.value.roleList=[u[u.length-1]])};function re(){var u;if(e.value.email||(I.value.email=[],g.value.clearValidate("email")),e.value.phoneNumber||(I.value.phoneNumber=[],g.value.clearValidate("phoneNumber")),(u=_.value)!=null&&u.getCheckedKeys()){h.value=_.value.getCheckedKeys(!1);const l=_.value.getCheckedKeys(),r=_.value.getHalfCheckedKeys(),s=l.concat(r);e.value.organizationalStructureId=s[0]}e.value.roleList.length>0?(e.value.role=e.value.roleList[0],delete e.value.roleList):e.value.role="",e.value.id?g.value&&g.value.validate(l=>{if(l){const{id:r,phoneNumber:s,email:v,password:K,name:P,country:b,active:V,type:w,role:A,positionId:D,organizationalStructureId:M,userName:R}=e.value,m={id:r,phoneNumber:s,email:v,password:K,name:P,country:b,active:V,type:w,role:A,positionId:D,organizationalStructureId:M,userName:R};Z.value===m.phoneNumber&&delete m.phoneNumber,H.value===m.email&&delete m.email,m.password||delete m.password,G.edit(m).then(()=>{Q.success({message:"编辑成功",center:!0}),B("success"),S()})}}):g.value&&g.value.validate(l=>{l&&G.create(e.value).then(()=>{Q.success({message:"新增成功",center:!0}),B("success"),B("getList"),S()})})}function S(){U.value=!1}const ne=(u,l)=>{l?(_.value.getCheckedKeys().forEach(s=>{s!==u.id&&_.value.setChecked(s,!1)}),h.value=[u.id]):h.value=h.value.filter(r=>r!==u.id)};return fe(async()=>{try{C.value=!0,h.value=[];const{data:u}=await ke.list({page:1,limit:10,id:null,name:"",active:null});u&&($.value=u.data),F.value=await Y.getStaff();const l=await xe.list({id:null,name:""});l.data&&(L.value=l.data);const r=await ye.list({name:""});if(r.data&&(z.value=r.data),ae.value=await ee.getCountry(),N.id!==""&&N.row){I.value.password=[],e.value=JSON.parse(N.row),e.value.roleList=[e.value.role];const s=e.value.organizationalStructureId;s&&(h.value=Array.isArray(s)?s:[s]),H.value=e.value.email,Z.value=e.value.phoneNumber,le.value=!0}C.value=!1}catch{}finally{C.value=!1}}),(u,l)=>{const r=i("el-input"),s=i("el-form-item"),v=i("el-col"),K=i("el-option"),P=i("el-select"),b=i("el-text"),V=i("el-row"),w=i("el-card"),A=i("el-tree"),D=i("el-checkbox"),M=i("el-checkbox-group"),R=i("ElForm"),m=i("ElButton"),ue=i("ElDrawer"),de=ve("loading");return c(),p(ue,{modelValue:U.value,"onUpdate:modelValue":l[7]||(l[7]=n=>U.value=n),title:o(te),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:a(()=>[y("div",Le,[t(m,{size:"large",onClick:S},{default:a(()=>[f(" 取消 ")]),_:1}),t(m,{type:"primary",size:"large",onClick:re},{default:a(()=>[f(" 确定 ")]),_:1})])]),default:a(()=>[_e((c(),p(R,{ref_key:"formRef",ref:g,model:o(e),rules:o(I),"label-width":"100px","validate-on-rule-change":!1},{default:a(()=>[t(w,{class:"box-card"},{header:a(()=>[we]),default:a(()=>[t(V,{gutter:24},{default:a(()=>[t(v,{span:8},{default:a(()=>[t(s,{label:"用户名",prop:"userName"},{default:a(()=>[t(r,{modelValue:o(e).userName,"onUpdate:modelValue":l[0]||(l[0]=n=>o(e).userName=n),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:a(()=>[t(s,{label:"姓名",prop:""},{default:a(()=>[t(r,{modelValue:o(e).name,"onUpdate:modelValue":l[1]||(l[1]=n=>o(e).name=n),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:a(()=>[t(s,{label:"手机号",prop:"phoneNumber"},{default:a(()=>[t(r,{modelValue:o(e).phoneNumber,"onUpdate:modelValue":l[2]||(l[2]=n=>o(e).phoneNumber=n),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:a(()=>[t(s,{label:"邮箱",prop:"email"},{default:a(()=>[t(r,{modelValue:o(e).email,"onUpdate:modelValue":l[3]||(l[3]=n=>o(e).email=n),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:a(()=>[t(s,{label:"职位",prop:""},{default:a(()=>[t(P,{modelValue:o(e).positionId,"onUpdate:modelValue":l[4]||(l[4]=n=>o(e).positionId=n),placeholder:"请选择职位",clearable:"",filterable:"",onChange:l[5]||(l[5]=()=>{})},{default:a(()=>[(c(!0),E(q,null,T(o($),n=>(c(),p(K,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:a(()=>[t(s,{label:"初始密码",prop:""},{default:a(()=>[t(b,null,{default:a(()=>[f("123456")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:a(()=>[y("div",Ce,[y("div",Ie,[f(" 部门信息"),o(e).enableChargePerson?(c(),E("span",Se,[f("负责人:"),(c(!0),E(q,null,T(o(F),n=>(c(),p(b,{key:n.id},{default:a(()=>[n.id===o(e).id?(c(),p(b,{key:0},{default:a(()=>[f(J(n.name),1)]),_:2},1024)):O("",!0)]),_:2},1024))),128))])):O("",!0)])])]),default:a(()=>[t(V,{gutter:24},{default:a(()=>[t(s,{label:"分配部门:"},{default:a(()=>[o(z).length>0?(c(),p(A,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:_,data:o(z),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":o(h),"default-expand-all":"",props:oe,onCheckChange:ne},null,8,["data","default-checked-keys"])):(c(),p(b,{key:1},{default:a(()=>[f("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:a(()=>[Ee]),default:a(()=>[t(V,{gutter:24},{default:a(()=>[t(s,{label:"分配角色:"},{default:a(()=>{var n;return[(n=o(L))!=null&&n.length?(c(),p(M,{key:0,modelValue:o(e).roleList,"onUpdate:modelValue":l[6]||(l[6]=x=>o(e).roleList=x),onChange:se},{default:a(()=>[(c(!0),E(q,null,T(o(L),x=>(c(),p(D,{key:x.id,label:x.roleName,value:x.roleName},{default:a(()=>[f(J(x.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):(c(),p(b,{key:1},{default:a(()=>[f("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[de,o(C)]])]),_:1},8,["modelValue","title"])}}}),Te=be(ze,[["__scopeId","data-v-c232dc86"]]);export{Te as default};
