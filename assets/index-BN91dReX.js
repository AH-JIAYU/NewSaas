
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as M,af as E,d as H,r as O,a as j,o as f,b as I,f as o,w as p,y as t,g as u,z as n,i as d,F as x,t as z,N as b,bw as $,j as D,aM as F,A as q,aH as w,aI as R,L as U}from"./index-CgGiKMhT.js";const V={list:_=>M.post("tenantBind/getProjectAllocationList",_),meList:_=>M.post("tenantBind/getProjectMeAllocationList",_),getTenantMeasurementList:_=>M.post("tenantBind/getTenantMeasurementList",_),getQuestionnaireClickList:_=>M.post("tenantBind/getQuestionnaireClickList",_)},J=E("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),K=J,W=_=>(w("data-v-a2ccadb7"),_=_(),R(),_),X={class:"details"},Y={class:"details-left"},Z={class:"project box"},ee={class:"link"},te=W(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),se=["onClick"],ne={class:"item-left"},ae={class:"tenant"},le={key:0,class:"tenantName"},ie={class:"tenantLength"},oe={class:"tenantName"},ce={class:"price flex-b"},re={key:0,class:"viewAll"},pe={key:0,class:"details-right"},ue={key:0,class:"clickId"},de={class:"clickIdItem"},_e={class:"clickIdItem-title"},fe={class:"supplierName"},Ie={class:"clickIdItem-content"},ye={key:1,class:"nodata"},me={style:{flex:"auto"}},Le=H({name:"Edit",__name:"index",setup(_,{expose:G}){const k=K(),g=O(!1);O();const s=O({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function B(i,y=0){const a={linkId:i.linkId,projectId:i.projectId,source:y},c=await V.getTenantMeasurementList(a),l=c.data.tenantMeasurementInfoList;c.data.tenantMeasurementInfo&&l.unshift(c.data.tenantMeasurementInfo);const h=l.findIndex(r=>r.allocationTenantId===c.data.currentTenantId);l.splice(0,h);const e=l.findIndex(r=>r.allocationTenantId===c.data.currentTenantId),m=l[e].allocationHierarchy;l.splice(m+1);const S=l.filter(r=>r.type===1),L=l.filter(r=>r.type===2),v=l.filter(r=>r.type===3),T=[...S];if(L.length){const r=L.map(N=>N.memberGroupOrSupperId);L[0].length=L.length,L[0].memberGroupOrSupperIdList=r,T.push(L[0])}else if(v.length){const r=v.map(N=>N.memberGroupOrSupperId);v[0].length=v.length,v[0].memberGroupOrSupperIdList=r,T.push(v[0])}T.forEach(r=>r.visible=!1),s.value.currentTenantId=c.data.currentTenantId,s.value.tenantMeasurementInfoList=T,g.value=!0}const P=async(i,y)=>{if(i.totality==0)return;s.value.select=s.value.select===y?"":y,s.value.clickIdList=[];const a={type:i.type,projectId:i.projectId,tenantId:i.allocationTenantId,supplierIdList:i.type===2?i.memberGroupOrSupperIdList:[],memberGroupIdList:i.type===3?i.memberGroupOrSupperIdList:[]},c=await V.getQuestionnaireClickList(a);s.value.clickIdList=Q(c.data.questionnaireClickInfoList),i.type===2?s.value.clickIdList=s.value.clickIdList.filter(l=>l.peopleType===2):i.type===3&&(s.value.clickIdList=s.value.clickIdList.filter(l=>l.peopleType===1))};function Q(i){return i.reduce((y,a)=>{const{supplierId:c,supplierName:l,projectQuestionnaireClickId:h,surveyStatus:e,price:m,peopleType:S}=a;let L=y.find(v=>v.supplierId===c);return L?L.list.push({projectQuestionnaireClickId:h,surveyStatus:e,price:m}):y.push({supplierId:c,peopleType:S,supplierName:l,list:[{projectQuestionnaireClickId:h,surveyStatus:e,price:m}]}),y},[])}function C(){g.value=!1,s.value={select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]}}function A(){C()}return G({showEdit:B}),(i,y)=>{const a=j("el-text"),c=j("el-button"),l=j("el-empty"),h=j("el-drawer");return f(),I("div",null,[o(h,{modelValue:d(g),"onUpdate:modelValue":y[0]||(y[0]=e=>q(g)?g.value=e:null),title:"详情",size:"60%","before-close":C},{footer:p(()=>[t("div",me,[o(c,{onClick:C},{default:p(()=>[u(" 取消 ")]),_:1}),o(c,{type:"primary",onClick:A},{default:p(()=>[u(" 确定 ")]),_:1})])]),default:p(()=>[t("div",X,[t("div",Y,[t("div",Z,[t("div",null,[o(a,{tag:"b"},{default:p(()=>{var e;return[u(n((e=d(s).tenantMeasurementInfoList[0])==null?void 0:e.projectName),1)]}),_:1})]),t("div",null,[o(a,{type:"info"},{default:p(()=>{var e;return[u("ID："+n((e=d(s).tenantMeasurementInfoList[0])==null?void 0:e.projectId),1)]}),_:1})])]),(f(!0),I(x,null,z(d(s).tenantMeasurementInfoList,(e,m)=>(f(),I("div",{key:e.allocationTenantId},[t("div",ee,[te,t("div",{class:b({"item box":!0,select:m===d(s).select}),onClick:S=>P(e,m)},[t("div",ne,[t("div",ae,[(e==null?void 0:e.length)>1?(f(),I("p",le,[u(" 已分配数： "),t("span",ie,n(e==null?void 0:e.length),1),t("span",{class:b("type"+e.type)},n(d(k).typeList[e.type-1]),3)])):(f(),I(x,{key:1},[t("p",null,[t("span",oe,n(e.tenantName),1),t("span",{class:b("type"+e.type)},n(d(k).typeList[e.type-1]),3)]),o(a,{type:"info"},{default:p(()=>[u("ID："+n(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",ce,[t("p",null," 项目价: "+n(e.currencyType===1?"$":"￥")+" "+n(e.doMoneyPrice),1),t("p",null,[u(" 参数: "),o(a,{size:"large"},{default:p(()=>[u(n(e.participationNumber||0),1)]),_:2},1024),o(a,{size:"large"},{default:p(()=>[u(" / ")]),_:1}),o(a,{type:"success",size:"large"},{default:p(()=>[u(n(e.doneNumber||0),1)]),_:2},1024),o(a,{size:"large"},{default:p(()=>[u(" / ")]),_:1}),o(a,{type:"warning",size:"large"},{default:p(()=>[u(n(e.num||0),1)]),_:2},1024),o(a,{size:"large"},{default:p(()=>[u(" / ")]),_:1}),o(a,{size:"large"},{default:p(()=>[u(n(e.limitedQuantity||0),1)]),_:2},1024)])])]),e.totality!=0?(f(),I("div",re,[o(c,{type:"primary",circle:"",size:"small",icon:d($)},null,8,["icon"])])):D("",!0)],10,se)])]))),128))]),d(s).select!==""?(f(),I("div",pe,[d(s).clickIdList.length?(f(),I("div",ue,[(f(!0),I(x,null,z(d(s).clickIdList,e=>(f(),I("div",de,[t("div",_e,[t("div",null,[t("span",fe,n(e.supplierName),1),t("span",{class:b("peopleType"+e.peopleType)},n(d(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[o(a,{type:"info"},{default:p(()=>[u("ID： "+n(e.supplierId),1)]),_:2},1024)])]),t("div",Ie,[t("ul",null,[(f(!0),I(x,null,z(e.list,m=>(f(),I("li",null,[t("span",null,n(m.projectQuestionnaireClickId),1),t("span",{class:b("surveyStatus"+m.surveyStatus)},n(d(k).surveyStatusList[m.surveyStatus-1]),3)]))),256))])])]))),256))])):(f(),I("div",ye,[o(l,{image:d(F),"image-size":300},null,8,["image"])]))])):D("",!0)])]),_:1},8,["modelValue"])])}}}),ve=U(Le,[["__scopeId","data-v-a2ccadb7"]]),he=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{V as a,he as i,ve as o,K as u};
