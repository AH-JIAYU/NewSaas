
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as F}from"./department-urBbSri_.js";import{d as K,r as t,a3 as M,n as P,a as s,o as _,b as q,f as n,w as r,y as A,g as p,i as l,e as k,A as D,L as S}from"./index-aj2M0Wo9.js";const j={class:"flex-c"},z=K({__name:"index",emits:["userData"],setup(G,{expose:y,emit:I}){const d=t(!1);t([]);const i=t([]),m=t(),e=t({type:1,tenantStaffList:[],roleList:[],title:"",project:[],form:{chargeUserId:null,chargeUserName:""}}),N={children:"children",label:"name"},x=M({chargeUserId:[{required:!0,message:"请选择负责人",trigger:"change"}]});t(!1);async function b(c,a,o){const f=await F.list({name:""});f.data&&(i.value=f.data),d.value=!0,e.value.title=a,e.value.form.invitationType=2,o&&(e.value.project=o,e.value.form.chargeUserName=o.chargeUserName,e.value.form.chargeUserId=o.chargeUserId)}function C(){d.value=!1,h.value.resetFields()}const V=I,h=t();function w(){h.value.validate(c=>{if(c){let a={chargeUserId:e.value.form.chargeUserId,chargeUserName:e.value.form.chargeUserName,invitationType:e.value.form.invitationType};d.value=!1,V("userData",a)}})}P(async()=>{}),y({showEdit:b});const v=t(),R=(c,a)=>{if(a){m.value.getCheckedKeys().forEach(u=>{u!==c.id&&m.value.setChecked(u,!1)}),e.value.form.chargeUserId=c.id;const f=m.value.getCheckedNodes();e.value.form.chargeUserName=f.map(u=>u.name)[0],setTimeout(()=>{v.value.blur()},100)}else e.value.form.chargeUserId=[e.value.form.chargeUserId].filter(o=>o!==c.id),e.value.form.chargeUserId.length==0&&(e.value.form.chargeUserId="");e.value.form.chargeUserId||(e.value.form.chargeUserName=""),console.log(e.value.form.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.form.chargeUserId,"data.value.form.chargeUserId")};return(c,a)=>{const o=s("el-tree"),f=s("el-text"),u=s("el-option"),T=s("el-select"),E=s("el-form-item"),B=s("ElForm"),U=s("el-button"),L=s("el-dialog");return _(),q("div",null,[n(L,{modelValue:l(d),"onUpdate:modelValue":a[1]||(a[1]=g=>D(d)?d.value=g:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"请选择项目负责人",class:"userClass"},{footer:r(()=>[A("div",j,[n(U,{onClick:C},{default:r(()=>[p(" 取消 ")]),_:1}),n(U,{type:"primary",onClick:w},{default:r(()=>[p(" 确认 ")]),_:1})])]),default:r(()=>[n(B,{ref_key:"formRef",ref:h,rules:l(x),model:l(e).form},{default:r(()=>[n(E,{label:"负责人",prop:"chargeUserId"},{default:r(()=>[n(T,{modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":a[0]||(a[0]=g=>l(e).form.chargeUserName=g),placeholder:"请选择负责人",ref_key:"selectTreeRef",ref:v},{default:r(()=>[n(u,{value:l(e).form.chargeUserId,style:{height:"auto"}},{default:r(()=>[l(i).length>0?(_(),k(o,{key:0,ref_key:"treeRef",ref:m,disabled:!0,data:l(i),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":[l(e).form.chargeUserId],"default-expand-all":"",props:N,onCheckChange:R,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["data","default-checked-keys"])):(_(),k(f,{key:1},{default:r(()=>[p("暂无数据")]),_:1}))]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),O=S(z,[["__scopeId","data-v-49f15c2b"]]);export{O as default};
