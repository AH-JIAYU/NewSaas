
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as we,aM as Re,aj as ke,r as m,c as f,$ as Q,n as Ie,a as i,q as je,o as p,b as G,f as o,w as t,i as e,az as J,F as Ce,t as xe,e as u,g as c,A as d,B as j,s as W,aN as Ne,v as B,aH as Se,j as b,O as Te,_ as Le,aP as ze,aQ as Ee,ao as De,aI as Ve,aJ as Fe,M as Pe}from"./index-DZ7Gqds7.js";import{_ as Ue}from"./index.vue_vue_type_style_index_0_lang-Bx5EbcAn.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-AEqSa9Df.js";import{q as $e,a as X}from"./index-Cxi67h1T.js";import{u as qe}from"./user_customer-BUPaC45p.js";/* empty css                      */const Y=x=>(Ve("data-v-8c12368f"),x=x(),Fe(),x),He=Y(()=>B("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),Ae={style:{"padding-left":"20px"}},Ke=Y(()=>B("br",null,null,-1)),Me={class:"tableBig"},Oe=we({name:"preInvestigationRecords",__name:"index",setup(x){const Z=qe(),{getParams:ee,pagination:_,onSizeChange:te,onCurrentChange:oe}=Re(),{t:l}=ke(),N=m(!1),H=m([]);m("");const h=m([]),S=m(!0),T=m(!0),L=m("default"),z=m(!1),ae=m();m("formSearch-preInvestigationRecords");const E=m([{prop:"projectId",label:f(()=>l("preRecords.projectID")),sortable:!0,checked:!0},{prop:"projectName",label:f(()=>l("preRecords.projectName")),sortable:!0,checked:!0},{prop:"allocationType",label:f(()=>l("preRecords.allocationType")),sortable:!0,checked:!0},{prop:"passNumber",label:f(()=>l("preRecords.number")),sortable:!0,checked:!0},{prop:"passRate",label:f(()=>l("preRecords.throughRate")),sortable:!0,checked:!0}]),s=Q({projectId:"",projectName:"",allocationType:[]}),A=m(),R=Q({allocationTypeList:[f(()=>l("preRecords.undistributed")),f(()=>l("preRecords.supplier")),f(()=>l("preRecords.internalStation"))],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],viceStatusList:["待审","免审","过IR","时间果断","超时完成","超量完成","审核成功","审核失败","数据冻结","时间段过载","ip不一致","id重复参与","和解"],customerList:[],vipList:[],vipGroupList:[],tenantSupplierList:[],expandedRows:[]});function le(){s.pageNo=1,I()}function ne(r){te(r).then(()=>I())}function re(r=1){oe(r).then(()=>I())}async function K(r){const n=R.expandedRows.indexOf(r.id);if(n!==-1?R.expandedRows.splice(n,1):R.expandedRows.push(r.id),!r.children){const v=await X.childList({projectId:r.projectId});r.children=v.data.projectScreenMemberChildInfoList}}function se(r){A.value.showEdit(r)}const C=f(()=>{const r=H.value.filter(w=>{const $=s.projectId?w.projectId==s.projectId:!0,q=s.projectName?w.projectName==s.projectName:!0,D=s.allocationType?w.allocationType==s.allocationType:!0;return $&&q&&D}),n=(_.value.page-1)*_.value.size,v=n+_.value.size;return _.value.total=r.length,r.slice(n,v)});async function I(){try{N.value=!0;const r={...ee(),...s},{data:n,status:v}=await X.list(r);n&&v===1&&(H.value=n.projectSurveyScreenInfoList,_.value.total=n.projectSurveyScreenInfoList.length),N.value=!1}catch{}finally{N.value=!1}}function ie(){Object.assign(s,{projectId:"",projectName:"",allocationType:""}),I()}return Ie(async()=>{R.customerList=await Z.getCustomerList(),E.value.forEach(r=>{r.checked&&h.value.push(r.prop)}),I(),ae.value=[{index:1,show:!0,type:"input",modelName:"projectId",placeholder:f(()=>l("preRecords.projectID"))},{index:2,show:!0,type:"input",modelName:"projectName",placeholder:f(()=>l("preRecords.projectName"))},{index:3,show:!0,type:"select",modelName:"allocationType",placeholder:f(()=>l("preRecords.allocationType")),option:"allocationType",optionLabel:"label",optionValue:"value",multiple:!0}]}),(r,n)=>{const v=i("ElInput"),w=i("ElFormItem"),$=i("el-option"),q=i("el-select"),D=Le,V=i("ElButton"),ce=i("ElForm"),pe=Be,de=i("ElDivider"),ue=Ue,M=i("el-button"),me=ze,fe=Ee,_e=i("el-row"),k=i("el-table-column"),F=i("el-text"),P=i("ElTableColumn"),O=i("el-table"),U=i("el-tag"),ye=i("el-empty"),he=i("ElPagination"),ge=De,be=je("loading");return p(),G("div",{class:Te({"absolute-container":e(z)})},[o(ge,null,{default:t(()=>[o(pe,{"show-toggle":!1},{default:t(({fold:a,toggle:y})=>[o(ce,{model:e(s),size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:t(()=>[o(w,null,{default:t(()=>[o(v,{modelValue:e(s).projectId,"onUpdate:modelValue":n[0]||(n[0]=g=>e(s).projectId=g),placeholder:e(l)("preRecords.projectID"),clearable:"",onKeydown:J(e(C),["enter"]),onClear:e(C)},null,8,["modelValue","placeholder","onKeydown","onClear"])]),_:1}),o(w,null,{default:t(()=>[o(v,{modelValue:e(s).projectName,"onUpdate:modelValue":n[1]||(n[1]=g=>e(s).projectName=g),placeholder:e(l)("preRecords.projectName"),clearable:"",onKeydown:J(e(C),["enter"]),onClear:e(C)},null,8,["modelValue","placeholder","onKeydown","onClear"])]),_:1}),o(w,null,{default:t(()=>[o(q,{modelValue:e(s).allocationType,"onUpdate:modelValue":n[2]||(n[2]=g=>e(s).allocationType=g),"value-key":"",placeholder:e(l)("preRecords.allocationType"),clearable:"",filterable:""},{default:t(()=>[(p(!0),G(Ce,null,xe(e(R).allocationTypeList,(g,ve)=>(p(),u($,{key:g,label:g,value:ve+1},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),o(w,null,{default:t(()=>[o(V,{type:"primary",onClick:I},{icon:t(()=>[o(D,{name:"i-ep:search"})]),default:t(()=>[c(" "+d(e(l)("preRecords.sift")),1)]),_:1}),o(V,{onClick:ie},{icon:t(()=>[He]),default:t(()=>[c(" "+d(e(l)("preRecords.reset")),1)]),_:1}),o(V,{link:"",onClick:y},{icon:t(()=>[o(D,{name:a?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:t(()=>[c(" "+d(a?e(l)("preRecords.expand"):e(l)("preRecords.collapse")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),o(de,{"border-style":"dashed"}),o(_e,null,{default:t(()=>[o(ue),o(fe,null,{default:t(()=>[o(M,{size:"default"},{default:t(()=>[c(d(e(l)("preRecords.export")),1)]),_:1}),o(me,{border:e(S),"onUpdate:border":n[3]||(n[3]=a=>j(S)?S.value=a:null),tableAutoHeight:e(z),"onUpdate:tableAutoHeight":n[4]||(n[4]=a=>j(z)?z.value=a:null),checkList:e(h),"onUpdate:checkList":n[5]||(n[5]=a=>j(h)?h.value=a:null),columns:e(E),"onUpdate:columns":n[6]||(n[6]=a=>j(E)?E.value=a:null),"line-height":e(L),"onUpdate:lineHeight":n[7]||(n[7]=a=>j(L)?L.value=a:null),stripe:e(T),"onUpdate:stripe":n[8]||(n[8]=a=>j(T)?T.value=a:null),style:{"margin-left":"12px"},onQueryData:le},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),W((p(),u(O,{border:e(S),data:e(C),size:e(L),stripe:e(T),"row-key":"id","expand-row-keys":e(R).expandedRows,onExpandChange:K},{empty:t(()=>[o(ye,{image:e(Ne),"image-size":300},null,8,["image"])]),default:t(()=>[o(k,{type:"expand",width:"55"},{default:t(a=>[o(O,{data:a.row.children,"highlight-current-row":"",class:"hide-table-header",border:"",height:"100%"},{default:t(()=>[o(k,{width:"55"}),o(k,{width:"300",prop:"memberChildName",label:"名称+ID",align:"left"},{default:t(y=>[B("div",Ae,[o(F,{class:"fontC-System"},{default:t(()=>[c(d(y.row.memberChildName),1)]),_:2},1024),Ke,W(o(F,{type:"danger",class:"fontC-System"},{default:t(()=>[c("随机id:"+d(y.row.randomIdentityId),1)]),_:2},1536),[[Se,y.row.randomIdentityId]])])]),_:1}),o(P,{prop:"status",label:"状态",align:"left"},{default:t(y=>[y.row.status===1?(p(),u(F,{key:0,type:"success",class:"fontC-System"},{default:t(()=>[c("前置问卷通过")]),_:1})):(p(),u(F,{key:1,type:"danger",class:"fontC-System"},{default:t(()=>[c("前置问卷未通过")]),_:1}))]),_:1}),o(P,{width:"200",align:"left",fixed:"right",label:"操作"},{default:t(y=>[o(V,{type:"primary",size:"small",plain:"",onClick:g=>se(y.row)},{default:t(()=>[c(" 查看问卷详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])]),_:1}),e(h).includes("projectId")?(p(),u(k,{key:0,width:"300",align:"left",prop:"projectId","show-overflow-tooltip":"",label:e(l)("preRecords.projectID")},null,8,["label"])):b("",!0),e(h).includes("projectName")?(p(),u(k,{key:1,align:"left",prop:"projectName","show-overflow-tooltip":"",label:e(l)("preRecords.projectName")},{default:t(({row:a})=>[B("div",Me,d(a.projectName),1)]),_:1},8,["label"])):b("",!0),e(h).includes("allocationType")?(p(),u(k,{key:2,align:"left","show-overflow-tooltip":"",width:"100",label:e(l)("preRecords.allocationType")},{default:t(({row:a})=>[a.allocationType===1?(p(),u(U,{key:0,effect:"plain",type:"info",class:"mx-1"},{default:t(()=>[c(d(e(l)("preRecords.undistributed")),1)]),_:1})):b("",!0),a.allocationType===2?(p(),u(U,{key:1,effect:"dark",style:{"background-color":"#fb6868",border:"none"},class:"mx-1",type:"primary"},{default:t(()=>[c(d(e(l)("preRecords.supplier")),1)]),_:1})):b("",!0),a.allocationType===3?(p(),u(U,{key:2,effect:"dark",style:{"background-color":"#05c9be",border:"none"},class:"mx-1",type:"warning"},{default:t(()=>[c(d(e(l)("preRecords.internalStation")),1)]),_:1})):b("",!0),a.allocationType===4?(p(),u(U,{key:3,effect:"dark",style:{"background-color":"#ffac54",border:"none"},class:"mx-1",type:"warning"},{default:t(()=>[c(d(e(l)("preRecords.partner")),1)]),_:1})):b("",!0)]),_:1},8,["label"])):b("",!0),e(h).includes("passNumber")?(p(),u(k,{key:3,align:"left","show-overflow-tooltip":"",label:e(l)("preRecords.number")},{default:t(({row:a})=>[c(d(a.passNumber||0)+"/ "+d(a.submitNumber||0),1)]),_:1},8,["label"])):b("",!0),e(h).includes("passRate")?(p(),u(P,{key:4,align:"left","show-overflow-tooltip":"",prop:"passRate",label:e(l)("preRecords.throughRate")},{default:t(({row:a})=>[c(d(a.passRate.toFixed(2)+"%"),1)]),_:1},8,["label"])):b("",!0),o(P,{align:"left","show-overflow-tooltip":"",prop:"",fixed:"right",label:e(l)("preRecords.control"),width:"200"},{default:t(({row:a})=>[o(M,{plain:"",type:"primary",size:"small",onClick:y=>K(a)},{default:t(()=>[c(d(e(R).expandedRows.includes(a.id)?"收起":"展开"),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["border","data","size","stripe","expand-row-keys"])),[[be,e(N)]]),o(he,{"current-page":e(_).page,total:e(_).total,"page-size":e(_).size,"page-sizes":e(_).sizes,layout:e(_).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:ne,onCurrentChange:re},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),o($e,{ref_key:"questionnaireDetailsRef",ref:A},null,512)],2)}}}),Ze=Pe(Oe,[["__scopeId","data-v-8c12368f"]]);export{Ze as default};
