
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as S}from"./configuration_role-Boj5RuYc.js";import{k as G,af as M,r as c,d as T,bv as z,n as H,an as J,E as P,a as _,q as O,s as D,i as a,o as k,b as I,f as h,w as p,e as C,y as x,z as K,F as Q,t as W,g as X,j as E,L as Y}from"./index-Bn2GMQXG.js";const Z={list:()=>G.get("role/getRoleButton")},j=M("buttonPermission",()=>{const v=c([]);return{permissions:v,getPermissions:async()=>{if(v.value.length)return v.value;const{data:g}=await Z.list();return v.value=g,g}}}),ee=j,te={class:"custom-tree-node"},oe={class:"menu"},se={class:"permission"},le={key:0,class:"permissions"},ae=T({__name:"index",props:["id","row"],setup(v,{expose:V}){const g=v,N=z(),U=ee(),n=c(!1),R=c(),y=c(),L=c([]),i=c([]),e=c({id:g.id??null,menuId:[],permission:[],roleName:"",remark:""}),$=c({roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]});H(async()=>{try{n.value=!0,e.value.id!==""&&await q(),i.value=await U.getPermissions(),L.value=N.routesRaw,n.value=!1}catch{}finally{n.value=!1}});async function q(){n.value=!0;const{menuId:o,...t}=JSON.parse(g.row);e.value=t;const r=await N.obtainLevel1AndLevel2Routing();e.value.menuId=o.filter(s=>!r.some(l=>l.id===s)),n.value=!1}function B(o){var t;return(t=i==null?void 0:i.value)==null?void 0:t.filter(r=>o===r.menuId)}const A=o=>{const t=[];t.push(o),y.value.getNode(o.id).checked?t.map(s=>{var d;const l=(d=i==null?void 0:i.value)==null?void 0:d.filter(u=>s.id===u.menuId);l&&l.length&&l.forEach(u=>{e.value.permission.push(u.id)})}):t.map(s=>{var d;const l=(d=i==null?void 0:i.value)==null?void 0:d.filter(u=>s.id===u.menuId);if(l&&l.length){let u=l.map(m=>m.id);e.value.permission=e.value.permission.filter(m=>!u.some(b=>b===m))}})};return V({submit(){n.value=!0;const o=J(e.value);return new Promise((t,r)=>{try{o.menuId=y.value.getCheckedKeys(!1);const s=y.value.getCheckedKeys(),l=y.value.getHalfCheckedKeys(),d=s.concat(l);o.menuId=d,e.value.menuId=d,R.value.validate(async u=>{if(!u)return n.value=!1,r(new Error("验证不通过"));try{o.id===""?(await S.create(o),P.success({message:"新增成功",center:!0})):(await S.edit(o),P.success({message:"编辑成功",center:!0})),t()}catch(m){r(m)}finally{n.value=!1}})}catch(s){n.value=!1,r(s)}})}}),(o,t)=>{const r=_("ElInput"),s=_("ElFormItem"),l=_("ElCheckbox"),d=_("ElCheckboxGroup"),u=_("el-tree"),m=_("ElForm"),b=O("loading");return D((k(),I("div",null,[h(m,{ref_key:"formRef",ref:R,model:a(e),rules:a($),"label-width":"120px"},{default:p(()=>[h(s,{label:"角色名称",prop:"roleName"},{default:p(()=>[h(r,{modelValue:a(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=f=>a(e).roleName=f),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),h(s,{label:"备注",prop:"remark"},{default:p(()=>[h(r,{modelValue:a(e).remark,"onUpdate:modelValue":t[1]||(t[1]=f=>a(e).remark=f),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),a(n)?E("",!0):(k(),C(s,{key:0,label:"权限"},{default:p(()=>[a(e).menuId?(k(),C(u,{key:0,ref_key:"treeRef",ref:y,data:a(L),style:{width:"100%"},"default-checked-keys":a(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"",onCheckChange:A,"default-expand-all":"",border:""},{default:p(({data:f})=>{var F;return[x("div",te,[x("div",oe,K(f.meta.title),1),x("div",se,[(F=B(f.id))!=null&&F.length?(k(),I("div",le,[h(d,{modelValue:a(e).permission,"onUpdate:modelValue":t[2]||(t[2]=w=>a(e).permission=w)},{default:p(()=>[(k(!0),I(Q,null,W(B(f.id),w=>(k(),C(l,{key:w.id,value:w.id},{default:p(()=>[X(K(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):E("",!0)])])]}),_:1},8,["data","default-checked-keys"])):E("",!0)]),_:1}))]),_:1},8,["model","rules"])])),[[b,a(n)]])}}}),ue=Y(ae,[["__scopeId","data-v-7611a015"]]);export{ue as default};
