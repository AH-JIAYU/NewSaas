
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Me}from"./index-BZ9FJqBH.js";import{_ as Te}from"./index-dxrxARyz.js";import{d as Fe,aN as Ge,r as p,l as Ae,n as W,X as U,a as v,q as He,o as r,b as z,y,f as o,w as i,g as f,aA as $,s as R,e as s,z as C,az as P,aq as Y,F as M,t as T,i as S,aM as Ke,j as g,aO as F,E as G,p as A,_ as Oe,aH as je,aI as qe,L as Je,ao as Z}from"./index-DY9KDIay.js";import{a as H}from"./department-DhcrOIFK.js";import{u as Xe}from"./department-lk0CXhv2.js";import{u as Qe}from"./position_manage-DQfw1E5R.js";import We from"./index-8NSDzX01.js";import Ye from"./index-gsxCRAky.js";import Ze from"./index-DqBWCzeX.js";import ea from"./index-CggJUljn.js";import aa from"./index-IY3tT6SN.js";import"./index-DPLutZJj.js";import"./position_manage-s1ouCkxw.js";import"./tenantDictionary-DEHMUNVU.js";import"./tenant_role-pHYrN0Q3.js";import"./configuration_role-Dys__b8f.js";import"./configuration_manager-CcVBPnro.js";const la=E=>(je("data-v-c7175e18"),E=E(),qe(),E),ta={class:"absolute-container"},ia={class:"page-main"},oa={class:"custom-tree-node"},na=["title"],ra={class:"code"},sa={class:"actions"},ua={class:"dictionary-container"},da={class:"copyId tableSmall"},ca={class:"id oneLine"},pa={class:"dictionary-container"},va=la(()=>y("div",{class:"empty"},"请在左侧新增或选择一个部门",-1)),ma=[va],ee=Fe({name:"department",__name:"list",setup(E){const{pagination:I,getParams:ga,onSizeChange:ae,onCurrentChange:le,onSortChange:te}=Ge(),x=Qe(),K=p(),ie=Ae(),oe=p([]),B=Xe(),O=p(),ne=p([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),re=[{label:"启用",value:!0},{label:"禁用",value:!1}],se=p(),j=p(),b=p({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),q=p(),ue=p(),t=p({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),J=p(),n=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),m=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",name:""},row:"",loading:!1});p();const d=p({loading:!1,search:{organizationalStructureId:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});async function L(){try{n.value.loading=!0;const e={...n.value.search},l=await H.list(e);n.value.tree=l.data,n.value.loading=!1}catch{}finally{n.value.loading=!1}}W(()=>{L()}),U(()=>n.value.search,e=>{J.value.filter(e)});function de(e,l){return e?l.label.includes(e):!0}function ce(e){n.value.currentData=e,n.value.dialog.parentId="",n.value.dialog.id="",n.value.dialog.visible=!0}function pe(e){m.value.currentData=e,m.value.dialog.parentId=(e==null?void 0:e.id)??"",m.value.dialog.name=(e==null?void 0:e.name)??"",m.value.dialog.id="",m.value.dialog.visible=!0}function ve(e,l){n.value.currentNode=e,n.value.currentData=l,n.value.row=JSON.stringify(l),n.value.dialog.parentId=e.parent.data.id??"",n.value.dialog.id=l.id,n.value.dialog.visible=!0}function me(e,l){F.confirm(`确认删除「${l.name}」吗？`,"确认信息").then(()=>{H.delete({id:l.id}).then(()=>{G.success({message:"删除成功",center:!0});const c=e.parent,D=c.data.children||c.data,w=D.findIndex(V=>V.id===l.id);D.splice(w,1),n.value.tree=[...n.value.tree]})})}function ge(e){I.value.page=1,e.id&&(t.value.dialog.parentId=e.id),d.value.search.organizationalStructureId=e.id}U(()=>d.value.search.organizationalStructureId,()=>{X()});async function X(){try{d.value.loading=!0;const e={...d.value.search},l=await H.itemlist(e);d.value.loading=!1,t.value.dataList=l.data,d.value.dataList.forEach(c=>{c.enableLoading=!1}),I.value.total=l.data.length}catch{}finally{d.value.loading=!1}}async function h(){const e={...t.value.search},l=await A.list(e);l.data&&(t.value.dataList=l.data.data,I.value.total=+l.data.total)}W(async()=>{try{b.value.loading=!0,oe.value=await ie.getCountry(),O.value=await(B==null?void 0:B.getDepartment())||[],K.value=await(x==null?void 0:x.getPositionManage())||[],h(),ne.value.forEach(e=>{e.checked&&t.value.checkList.push(e.prop)}),b.value.loading=!1}catch{}finally{b.value.loading=!1}}),U(()=>b.value.search,e=>{se.value.filter(e)});function fe(e){return new Promise(l=>{F.confirm(`确认${e.active?"禁用":"启用"}「${e.name}」吗？`,"确认信息").then(()=>{try{b.value.loading=!0,A.edit({id:e.id,account:null,name:null,sex:null,phoneNumber:null,active:!e.active}).then(()=>(G.success({message:`${e.active?"禁用":"启用"}成功`,center:!0}),h(),b.value.loading=!1,l(!0))).catch(()=>(b.value.loading=!1,l(!1)))}catch{}finally{b.value.loading=!1}}).catch(()=>l(!1))})}function he(e){ae(e).then(()=>{t.value.search.limit=e,h()})}function _e(e=1){le(e).then(()=>{t.value.search.page=e,h()})}function ye({prop:e,order:l}){te(e,l).then(()=>h())}function be(e){t.value.dialog.id="",t.value.dialog.visible=!0,t.value.dialog.level=1}const ke=e=>{q.value=e[0]};function Ie(){const{name:e,id:l}=q.value;F.confirm(`确认将「${e}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{A.reset({id:l}).then(()=>{G.success({message:"重置成功",center:!0}),h()})}).catch(()=>{})}function we(e){t.value.row=JSON.stringify(e),t.value.dialog.id=e.id,t.value.dialog.visible=!0}function Ce(e){j.value.showEdit(e)}function Le(){Object.assign(t.value.search,{id:"",userName:"",departmentId:null,active:null}),h()}return(e,l)=>{const c=v("ElButton"),D=v("ElButtonGroup"),w=Oe,V=v("ElInput"),Se=v("ElTree"),De=v("ElScrollbar"),Ve=v("el-option"),Ee=v("ElSelect"),Ne=v("ElSpace"),k=v("ElTableColumn"),ze=v("ElSwitch"),xe=Te,_=v("el-text"),Be=v("el-empty"),Ue=v("ElTable"),$e=v("ElPagination"),Re=Me,Pe=He("loading");return r(),z("div",ta,[y("div",ia,[o(Re,{"hide-left-side-toggle":""},{leftSide:i(()=>[o(D,{class:"btns"},{default:i(()=>[o(c,{type:"primary",class:"add",onClick:l[0]||(l[0]=a=>ce())},{default:i(()=>[f(" 新增部门 ")]),_:1})]),_:1}),o(V,{modelValue:n.value.search.name,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.search.name=a),placeholder:"请输入关键词筛选",clearable:"",class:"search",onKeydown:$(L,["enter"])},{append:i(()=>[o(c,{onClick:L},{default:i(()=>[o(w,{name:"i-ep:search"})]),_:1})]),_:1},8,["modelValue"]),o(De,{class:"tree"},{default:i(()=>[R((r(),s(Se,{ref_key:"dictionaryRef",ref:J,data:n.value.tree,"filter-node-method":de,"default-expand-all":"",onNodeClick:ge},{default:i(({node:a,data:u})=>{var Q;return[y("div",oa,[y("div",{class:"label",title:a.label},C(u.name),9,na),y("div",ra,C((Q=u==null?void 0:u.organizationalStructurePersonList)==null?void 0:Q.map(N=>N.userName).join("，")),1),y("div",sa,[o(D,null,{default:i(()=>[o(c,{type:"primary",plain:"",size:"default",onClick:P(N=>pe(u),["stop"])},{icon:i(()=>[o(w,{name:"i-ep:plus"})]),_:2},1032,["onClick"]),o(c,{type:"info",plain:"",size:"default",onClick:P(N=>ve(a,u),["stop"])},{icon:i(()=>[o(w,{name:"i-ep:edit"})]),_:2},1032,["onClick"]),o(c,{type:"danger",plain:"",size:"default",onClick:P(N=>me(a,u),["stop"])},{icon:i(()=>[o(w,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["data","filter-node-method"])),[[Pe,n.value.loading]])]),_:1})]),default:i(()=>[R(y("div",ua,[o(Ne,{wrap:""},{default:i(()=>[o(c,{type:"primary",onClick:l[2]||(l[2]=a=>be())},{default:i(()=>[f(" 新增员工 ")]),_:1}),o(c,{onClick:Ie},{default:i(()=>[f(" 重置密码 ")]),_:1}),o(Ee,{modelValue:t.value.search.active,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.search.active=a),"value-key":"",placeholder:"用户状态",style:{width:"200px"},clearable:"",filterable:""},{default:i(()=>[(r(),z(M,null,T(re,a=>o(Ve,{key:a.label,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o(V,{modelValue:t.value.search.id,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.search.id=a),placeholder:"员工ID",clearable:"",style:{width:"200px"},onKeydown:$(h,["enter"])},null,8,["modelValue"]),o(V,{modelValue:t.value.search.userName,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.search.userName=a),placeholder:"用户名",clearable:"",style:{width:"200px"},onKeydown:$(h,["enter"])},null,8,["modelValue"]),o(c,{type:"primary",onClick:h},{icon:i(()=>[o(w,{name:"i-ep:search"})]),_:1}),o(c,{onClick:Le},{icon:i(()=>[o(w,{name:"i-ep:refresh"})]),_:1})]),_:1}),o(Ue,{ref_key:"userItemRef",ref:ue,data:t.value.dataList,border:t.value.border,size:t.value.lineHeight,stripe:t.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:ye,onSelectionChange:l[6]||(l[6]=a=>t.value.selectionDataList=a),"row-key":"id","default-expand-all":"",onSelect:ke},{empty:i(()=>[o(Be,{image:S(Ke),"image-size":300},null,8,["image"])]),default:i(()=>[o(k,{type:"selection",align:"left",fixed:""}),t.value.checkList.includes("active")?(r(),s(k,{key:0,align:"left",prop:"active",label:"状态"},{default:i(a=>[o(ze,{modelValue:a.row.active,"onUpdate:modelValue":u=>a.row.active=u,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>fe(a.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):g("",!0),t.value.checkList.includes("id")?(r(),s(k,{key:1,align:"left",width:"180",prop:"id",label:"员工ID"},{default:i(({row:a})=>[y("div",da,[y("div",ca,"ID: "+C(a.id),1),o(xe,{class:"copy",content:a.id},null,8,["content"])])]),_:1})):g("",!0),t.value.checkList.includes("userName")?(r(),s(k,{key:2,align:"left",width:"130",prop:"userName",label:"用户名"},{default:i(({row:a})=>[o(_,{class:"tableBig"},{default:i(()=>[f(C(a.userName?a.userName:"-"),1)]),_:2},1024)]),_:1})):g("",!0),t.value.checkList.includes("phoneNumber")?(r(),s(k,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:i(({row:a})=>[o(_,{class:"tableBig"},{default:i(()=>[f(C(a.phoneNumber?a.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):g("",!0),t.value.checkList.includes("email")?(r(),s(k,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:i(({row:a})=>[o(_,{class:"tableBig"},{default:i(()=>[f(C(a.email?a.email:"-"),1)]),_:2},1024)]),_:1})):g("",!0),t.value.checkList.includes("departmentId")?(r(),s(k,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:i(({row:a})=>[a.departmentId?(r(),s(_,{key:0,class:"tableBig"},{default:i(()=>[(r(!0),z(M,null,T(O.value,u=>(r(),s(_,null,{default:i(()=>[a.departmentId===u.id?(r(),s(_,{key:0},{default:i(()=>[f(C(u.name?u.name:"-"),1)]),_:2},1024)):g("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),s(_,{key:1,class:"tableBig"},{default:i(()=>[f("-")]),_:1}))]),_:1})):g("",!0),t.value.checkList.includes("positionId")?(r(),s(k,{key:6,align:"left",prop:"positionId",label:"职位"},{default:i(({row:a})=>[a.positionId?(r(),s(_,{key:0,class:"tableBig"},{default:i(()=>[(r(!0),z(M,null,T(K.value,u=>(r(),s(_,null,{default:i(()=>[a.positionId===u.id?(r(),s(_,{key:0},{default:i(()=>[f(C(u.name?u.name:"-"),1)]),_:2},1024)):g("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),s(_,{key:1,class:"tableBig"},{default:i(()=>[f("-")]),_:1}))]),_:1})):g("",!0),o(k,{label:"操作",fixed:"right",width:"200",align:"left"},{default:i(a=>[o(c,{type:"primary",size:"small",plain:"",onClick:u=>we(a.row)},{default:i(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),o(c,{type:"warning",size:"small",plain:"",onClick:u=>Ce(a.row)},{default:i(()=>[f(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"]),o($e,{"current-page":S(I).page,total:S(I).total,"page-size":S(I).size,"page-sizes":S(I).sizes,layout:S(I).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:he,onCurrentChange:_e},null,8,["current-page","total","page-size","page-sizes","layout"])],512),[[Y,d.value.search.organizationalStructureId]]),R(y("div",pa,ma,512),[[Y,!d.value.search.organizationalStructureId]])]),_:1}),n.value.dialog.visible?(r(),s(We,{key:0,id:n.value.dialog.id,modelValue:n.value.dialog.visible,"onUpdate:modelValue":l[7]||(l[7]=a=>n.value.dialog.visible=a),row:n.value.row,"parent-id":n.value.dialog.parentId,tree:n.value.tree,onGetList:L},null,8,["id","modelValue","row","parent-id","tree"])):g("",!0),m.value.dialog.visible?(r(),s(Ye,{key:1,id:m.value.dialog.id,modelValue:m.value.dialog.visible,"onUpdate:modelValue":l[8]||(l[8]=a=>m.value.dialog.visible=a),row:m.value.row,"parent-id":m.value.dialog.parentId,name:m.value.dialog.name,tree:m.value.tree,onGetList:L},null,8,["id","modelValue","row","parent-id","name","tree"])):g("",!0),d.value.dialog.visible?(r(),s(Ze,{key:2,id:d.value.dialog.id,modelValue:d.value.dialog.visible,"onUpdate:modelValue":l[9]||(l[9]=a=>d.value.dialog.visible=a),"catalogue-id":d.value.search.organizationalStructureId,"parent-id":d.value.dialog.parentId,level:d.value.dialog.level,tree:n.value.tree,dataList:d.value.dataList,row:d.value.row,onSuccess:X},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):g("",!0),t.value.dialog.visible?(r(),s(ea,{key:3,id:t.value.dialog.id,modelValue:t.value.dialog.visible,"onUpdate:modelValue":l[10]||(l[10]=a=>t.value.dialog.visible=a),"catalogue-id":t.value.search.catalogueId,"parent-id":t.value.dialog.parentId,level:t.value.dialog.level,tree:b.value.tree,dataList:t.value.dataList,row:t.value.row,onSuccess:h,onGetList:L},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):g("",!0),o(aa,{ref_key:"detailRef",ref:j},null,512)])])}}});typeof Z=="function"&&Z(ee);const Ba=Je(ee,[["__scopeId","data-v-c7175e18"]]);export{Ba as default};
