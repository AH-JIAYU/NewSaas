
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as h}from"./file-D01kfqIO.js";import{a as U}from"./projectManagement_materials-D4EwGORN.js";import{D as P}from"./download-C8PHVIy1.js";import{d as T,r,a as s,o as A,b as Q,f as e,w as t,y as g,g as _,E as R}from"./index-BusLwhud.js";const S={style:{flex:"auto"}},F=["src"],W=T({name:"Details",__name:"index",emits:["fetchData"],setup(G,{expose:D,emit:b}){const L=b,n=r(!1),l=r({showData:{},idList:[],materialUrlList:[]}),v=r(""),u=r(!1),y="https://saas-api.surveysaas.com/api/project/uploadQiniu";async function V(a){l.value.showData=a,n.value=!0,await x(a.materialUrl)}const x=async a=>{a.length&&a.forEach(async o=>{const d=await h.detail({fileName:o.materialUrl});o.url=d.data.fileUrl,o.name=o.materialUrl})},N=a=>{v.value=a.url,u.value=!0},E=async(a,o)=>{a.id?l.value.idList.push(a.id):await h.delete({fileName:a.response.data.qiNiuUrl})},C=()=>{R.warning({message:"上传失败了,换张图片试试吧",center:!0})},k=(a,o)=>{l.value.materialUrlList.push(a.data.qiNiuUrl)};function I(){l.value.showData.materialUrl.forEach(a=>{P(a.url,a.name)})}async function w(){l.value.materialUrlList.length&&await U.create({id:l.value.showData.id,materialUrlList:l.value.materialUrlList}),l.value.idList.length&&await U.deleteMaterialDetails({idList:l.value.idList}),n.value=!1,L("fetchData"),l.value.idList=[],l.value.materialUrlList=[]}return D({showEdit:V}),(a,o)=>{const d=s("el-divider"),c=s("el-input"),m=s("el-form-item"),p=s("el-col"),j=s("el-row"),f=s("el-button"),B=s("el-upload"),q=s("el-form"),z=s("el-dialog"),M=s("el-drawer");return A(),Q("div",null,[e(M,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=i=>n.value=i),title:"详情",direction:"rtl","before-close":w,size:"40%"},{footer:t(()=>[g("div",S,[e(f,{onClick:w},{default:t(()=>[_(" 关闭 ")]),_:1})])]),default:t(()=>[e(d,{"content-position":"left"}),e(q,{"label-width":"80px",inline:!1},{default:t(()=>[e(j,{gutter:20},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(m,{label:"项目ID"},{default:t(()=>[e(c,{disabled:"",value:l.value.showData.projectId},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(m,{label:"项目名称"},{default:t(()=>[e(c,{disabled:"",value:l.value.showData.projectName},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(m,{label:"会员名称"},{default:t(()=>[e(c,{disabled:"",value:l.value.showData.memberChildName},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(B,{"file-list":l.value.showData.materialUrl,"onUpdate:fileList":o[0]||(o[0]=i=>l.value.showData.materialUrl=i),class:"upload-demo",action:y,"on-preview":N,"on-remove":E,"on-success":k,"on-error":C,"list-type":"picture"},{trigger:t(()=>[e(f,{type:"primary",class:"m-4"},{default:t(()=>[_("上传")]),_:1})]),default:t(()=>[e(f,{type:"primary",onClick:I},{default:t(()=>[_(" 下载 ")]),_:1})]),_:1},8,["file-list"])]),_:1}),e(z,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=i=>u.value=i),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:t(()=>[g("img",{"w-full":"",src:v.value,alt:"Preview Image"},null,8,F)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}});export{W as _};
