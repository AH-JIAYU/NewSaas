
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as M,aB as Y,r as n,a as f,o as b,b as w,f as l,w as r,g as c,i as o,v as u,e as G,j as S,B as H,aE as Q,E as I,_ as W,aI as X,aJ as Z,M as ee}from"./index-BZvN0JzH.js";import{a as te}from"./user_cooperation-1_cSaoSC.js";import{u as re}from"./index-c3kTEPLq.js";import{a as ae}from"./department-D_cKzrpY.js";import"./index-CFL7PP9D.js";import"./index-BbIxvKcn.js";import"./clipboard-BY_j97GQ.js";const U=y=>(X("data-v-8a688ee5"),y=y(),Z(),y),le={key:0},oe={style:{display:"flex","align-items":"center"}},ne=U(()=>u("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),se=U(()=>u("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),ie={style:{"margin-top":"6px","margin-bottom":"0px"}},ce={style:{display:"flex","flex-direction":"column"}},ue={style:{display:"flex","align-items":"center"}},de=U(()=>u("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),me=U(()=>u("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),fe=M({__name:"index",emits:["fetch-data"],setup(y,{expose:V,emit:E}){const C=Y(),T=C.currencyType,h=n();n();const $=E,p=n(!1);n(""),n(1);const x=n(),k=n(),B={children:"children",label:"name"},t=n({form:{},tenantUserList:[],tenantStaffList:[],chargeUserId:null,departmentId:null,chargeUserName:"",rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(a,e,s)=>{if(/^(100|[1-9]?\d)$/.test(e)==!1)return s(new Error("请输入 0 到 100 之间的数字"));s()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),N=n([]);n();async function q(a){t.value.form.exchangeRate=C.originalExchangeRate,t.value.form.chargeUserId="",h.value=a.currencyType,t.value.form.tenantName=a.tenantName,t.value.form.beInvitationTenantId=a.tenantId,t.value.form.phoneOrEmail=Q.local.get("account"),p.value=!0;const e=await ae.list({name:""});e.data&&(N.value=e.data)}const z=(a,e)=>{e?(x.value.getCheckedKeys().forEach(d=>{d!==a.id&&x.value.setChecked(d,!1)}),t.value.form.chargeUserId=a.id,t.value.form.chargeUserName=a.name):(t.value.form.chargeUserId=[t.value.form.chargeUserId].filter(s=>s!==a.id),t.value.form.chargeUserId.length==0&&(t.value.form.chargeUserId="")),t.value.form.chargeUserId||(t.value.form.chargeUserName="")};function R(){p.value=!1,t.value.form={},k.value.resetFields()}async function D(){k.value.validate(a=>{if(a){let e=JSON.parse(JSON.stringify(t.value.form));if(T===h.value&&(e.exchangeRate=1),T===1?e.currencyType="USD":T===2&&(e.currencyType="CNY"),h.value===1?e.beCurrencyType="USD":h.value===2&&(e.beCurrencyType="CNY"),Array.isArray(e.chargeUserId)&&(e.chargeUserId=e.chargeUserId[0]),e.receiveProjectType==1&&!e.chargeUserId){I.warning({message:"请选择部门",center:!0});return}if(!e.exchangeRate){I.warning({message:"请先设置汇率",center:!0});return}e.invitationType=2,e.receiveProjectType==2&&(t.value.form.chargeUserId=null,t.value.form.chargeUserName="",e.chargeUserId=null,e.chargeUserName="",e.invitationType=""),e.invitationType=2,te.addInvitationBind(e).then(s=>{s.status==-1?I.success({message:s.error,center:!0}):(I.success({message:"发送成功",center:!0}),$("fetch-data"),R())})}})}V({showEdit:q});const F=n();function J(a){t.value.form.chargeUserId=a.chargeUserId,t.value.form.invitationType=a.invitationType,t.value.form.chargeUserName=a.chargeUserName}const _=n(null),g=n(null),v=(a,e)=>{e&&(a==="发送"?(_.value=e,t.value.form.sendProjectType=e):(g.value=e,t.value.form.receiveProjectType=e))},K=()=>{_.value=null,g.value=null,t.value.form.sendProjectType=null,t.value.form.receiveProjectType=null};return(a,e)=>{const s=f("el-input"),d=f("el-form-item"),P=W,j=f("el-tooltip"),m=f("el-button"),L=f("el-tree-select"),O=f("ElForm"),A=f("el-dialog");return b(),w("div",null,[l(A,{modelValue:o(p),"onUpdate:modelValue":e[7]||(e[7]=i=>H(p)?p.value=i:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"邀约公司",class:"yaoyueDrawer",onClose:K},{footer:r(()=>[l(m,{onClick:R},{default:r(()=>[c(" 关闭 ")]),_:1}),l(m,{type:"primary",onClick:D},{default:r(()=>[c(" 发送邀约 ")]),_:1})]),default:r(()=>[l(O,{ref_key:"formRef",ref:k,rules:o(t).rules,model:o(t).form,"label-width":"7rem",labelPosition:"left",class:"hezuoDrawer"},{default:r(()=>[o(t).form.beInvitationTenantId?(b(),w("div",le,[l(d,{label:"价格比例",prop:"priceRatio"},{default:r(()=>[l(s,{modelValue:o(t).form.priceRatio,"onUpdate:modelValue":e[0]||(e[0]=i=>o(t).form.priceRatio=i),clearable:"",placeholder:"请输入0-100之间的数字"},{append:r(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),l(d,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:r(()=>[u("span",oe,[l(j,{effect:"dark",placement:"top-start"},{content:r(()=>[ne,se]),default:r(()=>[l(P,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:r(()=>[u("div",ie,[l(m,{type:o(_)===1?"primary":"",size:"small",onClick:e[1]||(e[1]=i=>v("发送",1))},{default:r(()=>[c("自动 ")]),_:1},8,["type"]),l(m,{type:o(_)===2?"primary":"",size:"small",onClick:e[2]||(e[2]=i=>v("发送",2))},{default:r(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),u("div",ce,[l(d,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:r(()=>[u("span",ue,[l(j,{effect:"dark",placement:"top-start"},{content:r(()=>[de,me]),default:r(()=>[l(P,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:r(()=>[u("div",null,[l(m,{type:o(g)===1?"primary":"",size:"small",onClick:e[3]||(e[3]=i=>v("接收",1))},{default:r(()=>[c("自动 ")]),_:1},8,["type"]),l(m,{type:o(g)===2?"primary":"",size:"small",onClick:e[4]||(e[4]=i=>v("接收",2))},{default:r(()=>[c("手动")]),_:1},8,["type"]),l(m,{type:o(g)===3?"primary":"",size:"small",onClick:e[5]||(e[5]=i=>v("拒绝",3))},{default:r(()=>[c("拒绝")]),_:1},8,["type"])])]),_:1}),o(t).form.receiveProjectType==1?(b(),G(L,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:x,modelValue:o(t).form.chargeUserId,"onUpdate:modelValue":e[6]||(e[6]=i=>o(t).form.chargeUserId=i),data:o(N),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",style:{width:"15.625rem"},props:B,onCheckChange:z,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["modelValue","data"])):S("",!0)])])):S("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),l(re,{ref_key:"userRef",ref:F,onUserData:J},null,512)])}}}),Te=ee(fe,[["__scopeId","data-v-8a688ee5"]]);export{Te as default};
