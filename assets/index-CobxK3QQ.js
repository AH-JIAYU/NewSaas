
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as I}from"./index.vue_vue_type_script_setup_true_lang-CRYHVazX.js";import{c as f}from"./user_customer-D8n9FH3J.js";import{o as z,s as w}from"./apiLoading-Ck_cG2Pf.js";import{u as R}from"./stagedData-28WxR7-b.js";import{u as j}from"./user_customer-BEztDqfd.js";import{d as U,r as i,a2 as q,a3 as p,a as h,o as y,b as M,f as c,w as u,y as O,g as v,e as P,j as $,i as F,N as G,aq as H,E as d,L as J}from"./index-Dp-ZPQFq.js";import"./index-Dg5XG23t.js";import"./index-xVjSPWYe.js";import"./index-BZ40tgIK.js";import"./index-B7La74Q6.js";import"./department-N6q9vQ4i.js";import"./position_manage-C54My7e5.js";import"./configuration_role-Dkd_VCZy.js";import"./tenant_role-DFrfHUWV.js";import"./configuration_manager-CqZCjXnI.js";import"./configuration_siteSetting-CzIh7BrB.js";import"./configuration_site_setting-CR6AvfNj.js";const K={class:"flex-c"},Q=U({__name:"index",emits:["fetch-data"],setup(W,{expose:T,emit:k}){const m=R(),_=j(),x=k,l=i(!1),o=i(""),b=i(),r=i([]),n=i([]);function L(e){n.value.push(e)}q("validateTopTabs",L);let t=p([]);async function D(e){if(!e)o.value="新增",t=m.userCustomer||[{..._.initialTopTabsData}];else{o.value="编辑";const{data:a}=await z(f.detail({tenantCustomerId:e.tenantCustomerId}));V(a)}r.value=[],l.value=!0}function V(e){t.length=0,t.push({...e})}function S(e){const a=new Set;for(const s of e){if(a.has(s.customerAccord))return!0;a.add(s.customerAccord)}return!1}function E(){m.userCustomer=H(t),t=p([]),l.value=!1,n.value=[]}function g(){t=p([]),l.value=!1,n.value=[],o.value==="新增"&&(m.userCustomer=null)}async function C(){const e=[];n.value.forEach(s=>{e.push(s.validate())});const a=await Promise.allSettled(e);r.value=a.map(s=>s.status)}async function A(){if(await C(),r.value.every(e=>e==="fulfilled"))if(S(t))d.warning({message:"客户名称重复",center:!0});else{if(o.value==="新增"){const e={tenantCustomerInfoList:t},{status:a}=await w(f.create(e));a===1&&d.success({message:"新增成功",center:!0})}else{t[0].riskControl===1&&(t[0].turnover=null,t[0].rateAudit=null);const{status:e}=await w(f.edit(t[0]));e===1&&d.success({message:"修改成功",center:!0})}_.customer=null,x("fetch-data"),g()}else b.value.activeLeftTab=r.value.indexOf("rejected"),d.warning({message:"请完善表单",center:!0})}return T({showEdit:D}),(e,a)=>{const s=h("el-button"),N=h("el-drawer");return y(),M("div",null,[c(N,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=B=>l.value=B),class:G(o.value==="新增"?"hide-drawer-header":"edit-drawer"),"append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%"},{footer:u(()=>[O("div",K,[c(s,{onClick:g},{default:u(()=>[v(" 取消 ")]),_:1}),o.value==="新增"?(y(),P(s,{key:0,type:"warning",onClick:E},{default:u(()=>[v(" 暂存 ")]),_:1})):$("",!0),c(s,{type:"primary",onClick:A},{default:u(()=>[v(" 确定 ")]),_:1})])]),default:u(()=>[c(I,{onValidate:C,ref_key:"LeftTabsRef",ref:b,title:o.value,"left-tabs-data":F(t),"validate-top-tabs":n.value,"validate-all":r.value},null,8,["title","left-tabs-data","validate-top-tabs","validate-all"])]),_:1},8,["modelValue","class"])])}}}),pe=J(Q,[["__scopeId","data-v-bb927eee"]]);export{pe as default};
