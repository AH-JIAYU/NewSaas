
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as he,am as Ce,O as Ie,aO as we,y as Pe,r as j,l as Se,G as B,J as ke,c as Le,b as s,q as Ve,o as c,e as S,g as a,w as o,j as n,F as x,v as Ee,f as g,h as m,H as M,s as xe,aN as Me,k as U,S as $e,E as h,aP as F,N as De,ap as ze,aI as Ne,aJ as je,t as Be,R as Ue}from"./index-Ca4QanMD.js";import{_ as Fe}from"./index.vue_vue_type_script_setup_true_lang-BwYgqRlf.js";import{_ as Te}from"./index.vue_vue_type_script_setup_true_lang---325P_S.js";import{s as C}from"./apiLoading-Bzk_TULZ.js";import{G as y}from"./otherFunctions_screenLibrary-D0gBzBEN.js";import{_ as Oe}from"./index.vue_vue_type_script_setup_true_lang-DY-bfwPA.js";import{u as Re}from"./index-B2OKqVH8.js";import{u as Ae}from"./stagedData-D3YRbEZA.js";import{u as Ge}from"./useTabbar-DvmgK1f6.js";/* empty css                      */const He=I=>(Ne("data-v-f8d1085a"),I=I(),je(),I),Je=He(()=>Be("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),qe=he({name:"screen_library",__name:"list",setup(I){const T=Ce(),O=Re(),w=Ae(),R=Ie(),{pagination:p,getParams:A,onSizeChange:G,onCurrentChange:H,onSortChange:J}=we(),q=Ge(),$=Pe(),e=j({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),D=j();Se(async()=>{d(),e.value.countryList=await T.getCountry(),e.value.formMode==="router"&&B.on("get-data-list",()=>{d()})}),ke(()=>{e.value.formMode==="router"&&B.off("get-data-list")});function d(){try{e.value.loading=!0;const t={...A(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};y.list(t).then(l=>{e.value.loading=!1,e.value.dataList=l.data.getCountryListInfoList,p.value.total=l.data.getCountryListInfoList.length})}catch{}finally{e.value.loading=!1}}const z=Le(()=>e.value.dataList.slice((p.value.page-1)*p.value.size,p.value.page*p.value.size));function K(t){G(t).then(()=>d())}function k(t=1){H(t).then(()=>d())}function N({prop:t,order:l}){J(t,l).then(()=>d())}function Q(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function W(t){t.getProjectProblemCategoryInfoList.unshift({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add"})}function X(t,l,_){D.value.validateField(`[${l}].getProjectProblemCategoryInfoList[${_}].categoryName`,async v=>{if(v){const{data:L,status:P}=await C(y.create(t));P===1&&h.success({message:"新增成功",center:!0}),await d()}})}function Y(t,l){const _=e.value.dataList.findIndex(v=>v.countryId===t.countryId);e.value.dataList[_].getProjectProblemCategoryInfoList.splice(l,1)}async function Z(t){const{status:l}=await C(y.update(t));l===1&&h.success({message:"修改「默认国家」成功",center:!0}),d(),w.projectManagementList=null}async function ee(t){const{status:l}=await C(y.edit(t));l===1&&h.success({message:"修改「状态」成功",center:!0}),d(),w.projectManagementList=null}function te(t){O.countryId=t.countryId,e.value.formMode==="router"?$.settings.tabbar.enable&&$.settings.tabbar.mergeTabsBy!=="activeMenu"?q.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):R.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function ae(t){F.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:l}=await C(y.delete({countryId:t.countryId}));l===1&&h.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),w.projectManagementList=null}function oe(t){F.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:l}=await C(y.delete({projectProblemCategoryId:t.projectProblemCategoryId}));l===1&&h.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),w.projectManagementList=null}function ne(){Object.assign(e.value.search,{countryId:""}),d()}return(t,l)=>{const _=s("ElOption"),v=s("el-select"),L=s("ElFormItem"),P=De,f=s("ElButton"),le=s("ElForm"),re=Fe,ie=s("ElDivider"),se=s("ElSpace"),V=s("el-table-column"),E=s("ElSwitch"),b=s("ElTableColumn"),ue=s("el-input"),de=s("el-form-item"),ce=s("el-text"),me=s("el-table"),pe=s("el-tag"),fe=s("el-empty"),ge=s("ElTable"),ye=s("el-form"),_e=s("ElPagination"),ve=ze,be=Ve("loading");return c(),S("div",{class:$e({"absolute-container":n(e).tableAutoHeight})},[a(ve,null,{default:o(()=>[a(re,{"show-toggle":!1},{default:o(({fold:i,toggle:r})=>[a(le,{model:n(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:o(()=>[a(L,{label:""},{default:o(()=>[a(v,{onChange:l[0]||(l[0]=u=>k()),clearable:"",filterable:"",modelValue:n(e).search.countryId,"onUpdate:modelValue":l[1]||(l[1]=u=>n(e).search.countryId=u),placeholder:"国家"},{default:o(()=>[(c(!0),S(x,null,Ee(n(e).countryList,u=>(c(),g(_,{label:u.chineseName,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(L,null,{default:o(()=>[a(f,{type:"primary",onClick:l[2]||(l[2]=u=>k())},{icon:o(()=>[a(P,{name:"i-ep:search"})]),default:o(()=>[m(" 筛选 ")]),_:1}),a(f,{onClick:ne},{icon:o(()=>[Je]),default:o(()=>[m(" 重置 ")]),_:1}),a(f,{link:"",disabled:"",onClick:r},{icon:o(()=>[a(P,{name:i?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:o(()=>[m(" "+M(i?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(ie,{"border-style":"dashed"}),a(se,{wrap:""},{default:o(()=>[a(f,{type:"primary",size:"default",onClick:Q},{default:o(()=>[m(" 新增前置问卷库 ")]),_:1})]),_:1}),a(ye,{ref_key:"formRef",ref:D,rules:n(e).rules,model:n(z)},{default:o(()=>[xe((c(),g(ge,{class:"my-4",data:n(z),"highlight-current-row":"",height:"100%",onSortChange:N,onSelectionChange:l[4]||(l[4]=i=>n(e).batch.selectionDataList=i),"default-expand-all":!0},{empty:o(()=>[a(fe,{image:n(Me),"image-size":300},null,8,["image"])]),default:o(()=>[a(V,{type:"expand",width:"55"},{default:o(i=>[a(me,{data:i.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",height:"100%",onSortChange:N,onSelectionChange:l[3]||(l[3]=r=>n(e).batch.selectionDataList=r)},{default:o(()=>[a(V,{width:"55"}),a(b,{prop:"status",label:"状态",align:"center"},{default:o(r=>[r.row.type==="add"?(c(),g(E,{key:0,modelValue:r.row.status,"onUpdate:modelValue":u=>r.row.status=u,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])):(c(),g(E,{key:1,onChange:u=>ee(r.row),modelValue:r.row.status,"onUpdate:modelValue":u=>r.row.status=u,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),a(V,{width:"500",prop:"categoryName",label:"问卷名称",align:"center"},{default:o(r=>[r.row.type==="add"?(c(),g(de,{key:0,prop:`[${i.$index}].getProjectProblemCategoryInfoList[${r.$index}].categoryName`,rules:n(e).rules.categoryName},{default:o(()=>[a(ue,{modelValue:r.row.categoryName,"onUpdate:modelValue":u=>r.row.categoryName=u},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(c(),g(ce,{key:1,class:"tableBig"},{default:o(()=>[m(M(r.row.categoryName),1)]),_:2},1024))]),_:2},1024),a(b,{width:"250",align:"center",fixed:"right",label:"操作"},{default:o(r=>[r.row.type==="add"?(c(),S(x,{key:0},[a(f,{type:"primary",size:"small",plain:"",onClick:u=>X(r.row,i.$index,r.$index)},{default:o(()=>[m(" 提交 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:u=>Y(r.row,r.$index)},{default:o(()=>[m(" 取消 ")]),_:2},1032,["onClick"])],64)):(c(),S(x,{key:1},[a(f,{type:"warning",size:"small",plain:"",onClick:u=>te(r.row)},{default:o(()=>[m(" 设计问卷 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:u=>oe(r.row)},{default:o(()=>[m(" 删除 ")]),_:2},1032,["onClick"])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),a(b,{prop:"isDefault",label:"默认/状态",align:"center"},{default:o(i=>[a(E,{onChange:r=>Z(i.row),modelValue:i.row.isDefault,"onUpdate:modelValue":r=>i.row.isDefault=r,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),a(b,{prop:"countryName",label:"国家/标题",width:"500",align:"center"},{default:o(({row:i})=>[a(pe,{type:"primary"},{default:o(()=>[m(M(i.countryName),1)]),_:2},1024)]),_:1}),a(b,{label:"操作",width:"250",align:"center",fixed:"right"},{default:o(i=>[a(f,{type:"primary",size:"small",plain:"",onClick:r=>W(i.row)},{default:o(()=>[m(" 新增问卷 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:r=>ae(i.row)},{default:o(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[be,n(e).loading]])]),_:1},8,["rules","model"]),a(_e,{"current-page":n(p).page,total:n(p).total,"page-size":n(p).size,"page-sizes":n(p).sizes,layout:n(p).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:K,onCurrentChange:k},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),n(e).editProps.visible?(c(),g(Oe,{key:0,id:n(e).editProps.id,countryId:n(e).editProps.countryId,modelValue:n(e).editProps.visible,"onUpdate:modelValue":l[5]||(l[5]=i=>n(e).editProps.visible=i),row:n(e).editProps.row,onSuccess:d},null,8,["id","countryId","modelValue","row"])):U("",!0),n(e).formMode==="dialog"||n(e).formMode==="drawer"?(c(),g(Te,{key:1,id:n(e).formModeProps.id,modelValue:n(e).formModeProps.visible,"onUpdate:modelValue":l[6]||(l[6]=i=>n(e).formModeProps.visible=i),mode:n(e).formMode,details:n(e).formModeProps.details,title:n(e).formModeProps.title,onSuccess:d},null,8,["id","modelValue","mode","details","title"])):U("",!0)],2)}}}),nt=Ue(qe,[["__scopeId","data-v-f8d1085a"]]);export{nt as default};
