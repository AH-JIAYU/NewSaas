
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as C,d as ye,$ as be,r as n,l as _e,a as d,al as Ve,am as we,i as a,o as p,b as h,f as o,w as s,G as F,be as Ee,C as k,F as S,n as I,e as g,j as T,g as U,E as y,aK as Pe,aL as xe,P as he,aj as G}from"./index-DgKsYSiF.js";import{u as Ue}from"./otherFunctions_basicDictionary-BJ3xacyA.js";const M={list:()=>C.post("user/getUserInfo"),edit:f=>C.post("user/update",f),uploadAvatar:f=>C.post("user/uploadAvatar",f)},R=f=>(Pe("data-v-e8a16a97"),f=f(),xe(),f),ke=R(()=>k("h2",null,"个人信息",-1)),Ne=R(()=>k("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Ce=["src"],Fe=R(()=>k("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),J=ye({name:"personalSetting",__name:"setting",emits:["success"],setup(f,{expose:Z,emit:H}){const K=be(),q=H,Y="http://47.96.98.102:9100/user/uploadAvatar",Q=Ue(),B=n([]),v=n(!1),j=n(!1),b=n(!1),W=[{label:"公司",value:"company"},{label:"个人",value:"personal"}],X=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],w=n(),E=n(),e=n({type:"personal",name:"",phone:"15288888888",email:"88888@qq.com",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),m=n({oldPassword:"",password:"",confirmPassword:""}),ee=n({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,t,i)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?i():i(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,t,i)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?i():i(new Error("请输入合法手机号"))},trigger:"blur"}]}),le=n({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(r,t,i)=>{t===m.value.oldPassword?i(new Error("新密码不能与旧密码一致")):i()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(r,t,i)=>{t!==m.value.password?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]}),L=r=>{(r!==e.value.phone||r!==e.value.email)&&(j.value=!0)};function ae(){w.value&&w.value.validate(async r=>{if(r){if(v.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,j.value||(delete e.value.phone,delete e.value.email),console.log("userForm.value",e.value),(await M.edit({type:e.value.type})).status===-1)return y.warning({message:"修改失败",center:!0});q("success"),v.value=!1,y.success({message:"修改成功",center:!0}),V()}})}const te=K.token,oe=n({Token:te}),O=n(""),P=n(!1),_=n([]),se=async()=>{y.success({message:"删除成功",center:!0})},re=()=>{},ue=async()=>{y.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},ne=r=>{O.value=r.url,P.value=!0},de=()=>{E.value&&E.value.validate(async r=>{if(r){if(v.value=!0,delete m.value.confirmPassword,(await M.edit(m.value)).status===-1)return y.warning({message:"修改失败",center:!0});q("success"),v.value=!1,y.success({message:"修改成功",center:!0}),V()}})};async function ie(r){e.value=r,_.value.push({name:"file",url:e.value.avatar}),b.value=!0}function V(){w.value.resetFields(),E.value.resetFields(),Object.assign(e,{}),_.value=[],Object.assign(m,{}),b.value=!1}return _e(async()=>{v.value=!0,B.value=await Q.getCountry(),v.value=!1}),Z({showEdit:ie}),(r,t)=>{const i=d("el-icon"),N=d("el-upload"),me=d("el-dialog"),u=d("ElFormItem"),z=d("el-option"),A=d("el-select"),c=d("ElInput"),pe=d("ElOption"),ce=d("ElSelect"),x=d("ElButton"),D=d("ElForm"),$=d("ElTabPane"),fe=d("ElTabs"),ve=d("el-drawer"),ge=Ve("loading");return we((p(),h("div",null,[o(ve,{modelValue:a(b),"onUpdate:modelValue":t[14]||(t[14]=l=>F(b)?b.value=l:null),title:"修改用户信息",direction:"rtl","before-close":V,style:{height:"100%"},size:"40%"},{default:s(()=>[o(fe,{"tab-position":"left"},{default:s(()=>[o($,{label:"个人信息",class:"basic"},{default:s(()=>[ke,o(D,{ref_key:"userFormRef",ref:w,model:a(e),rules:a(ee),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:s(()=>[o(u,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[o(N,{"file-list":a(_),"onUpdate:fileList":t[0]||(t[0]=l=>F(_)?_.value=l:null),headers:a(oe),action:Y,"list-type":"picture-card",limit:1,"on-preview":ne,"on-remove":se,"on-success":re,"on-exceed":ue},{tip:s(()=>[Ne]),default:s(()=>[o(i,{class:"el-icon--upload"},{default:s(()=>[o(a(Ee))]),_:1})]),_:1},8,["file-list","headers"]),o(me,{modelValue:a(P),"onUpdate:modelValue":t[1]||(t[1]=l=>F(P)?P.value=l:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[k("img",{"w-full":"",src:a(O),alt:"Preview Image"},null,8,Ce)]),_:1},8,["modelValue"])]),_:1}),o(u,{label:"账户类型"},{default:s(()=>[o(A,{modelValue:a(e).type,"onUpdate:modelValue":t[2]||(t[2]=l=>a(e).type=l),"value-key":"",placeholder:"账户类型",clearable:"",filterable:""},{default:s(()=>[(p(),h(S,null,I(W,l=>o(z,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(u,{label:"用户名"},{default:s(()=>[o(c,{disabled:"",modelValue:a(e).name,"onUpdate:modelValue":t[3]||(t[3]=l=>a(e).name=l),laceholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),o(u,{label:"国家"},{default:s(()=>[o(ce,{modelValue:a(e).country,"onUpdate:modelValue":t[4]||(t[4]=l=>a(e).country=l),disabled:""},{default:s(()=>[(p(!0),h(S,null,I(a(B),l=>(p(),g(pe,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(u,{prop:"",label:"货币类型"},{default:s(()=>[o(A,{modelValue:a(e).currencyType,"onUpdate:modelValue":t[5]||(t[5]=l=>a(e).currencyType=l),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(p(),h(S,null,I(X,l=>o(z,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(e).type==="company"?(p(),g(u,{key:0,label:"公司名称"},{default:s(()=>[o(c,{modelValue:a(e).companyName,"onUpdate:modelValue":t[6]||(t[6]=l=>a(e).companyName=l),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):T("",!0),a(e).type==="company"?(p(),g(u,{key:1,label:"公司税号"},{default:s(()=>[o(c,{modelValue:a(e).taxId,"onUpdate:modelValue":t[7]||(t[7]=l=>a(e).taxId=l),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):T("",!0),a(e).type==="company"?(p(),g(u,{key:2,label:"法人姓名"},{default:s(()=>[o(c,{modelValue:a(e).legalPersonName,"onUpdate:modelValue":t[8]||(t[8]=l=>a(e).legalPersonName=l),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):T("",!0),a(e).country==="CN"?(p(),g(u,{key:3,prop:"phone",label:"手机号码"},{default:s(()=>[o(c,{modelValue:a(e).phone,"onUpdate:modelValue":t[9]||(t[9]=l=>a(e).phone=l),placeholder:"请输入你的手机号码",disabled:"",onChange:L},null,8,["modelValue"])]),_:1})):(p(),g(u,{key:4,prop:"email",label:"电子邮箱"},{default:s(()=>[o(c,{modelValue:a(e).email,"onUpdate:modelValue":t[10]||(t[10]=l=>a(e).email=l),placeholder:"请输入你的电子邮箱",disabled:"",onChange:L},null,8,["modelValue"])]),_:1})),o(u,null,{default:s(()=>[o(x,{onClick:ae,type:"primary"},{default:s(()=>[U(" 保存 ")]),_:1}),o(x,{onClick:V,type:"primary"},{default:s(()=>[U(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),o($,{label:"账户管理",class:"security"},{default:s(()=>[Fe,o(D,{ref_key:"accountFormRef",ref:E,model:a(m),rules:a(le),"label-width":"120px","label-suffix":"："},{default:s(()=>[o(u,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[o(c,{modelValue:a(m).oldPassword,"onUpdate:modelValue":t[11]||(t[11]=l=>a(m).oldPassword=l),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),o(u,{prop:"password",label:"新密码"},{default:s(()=>[o(c,{modelValue:a(m).password,"onUpdate:modelValue":t[12]||(t[12]=l=>a(m).password=l),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(u,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[o(c,{modelValue:a(m).confirmPassword,"onUpdate:modelValue":t[13]||(t[13]=l=>a(m).confirmPassword=l),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(u,null,{default:s(()=>[o(x,{onClick:de,type:"primary"},{default:s(()=>[U(" 保存 ")]),_:1}),o(x,{onClick:V,type:"primary"},{default:s(()=>[U(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[ge,a(v)]])}}});typeof G=="function"&&G(J);const Se=he(J,[["__scopeId","data-v-e8a16a97"]]),Be=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"}));export{M as a,Be as b,Se as s};
