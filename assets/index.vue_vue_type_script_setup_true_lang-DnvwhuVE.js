
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as f,d as Q,r as x,a3 as w,a as n,o as i,b as I,f as r,w as a,C as y,g,i as t,e as u,F as N,n as T,D as C,j as b,am as U,aE as q,G as W,an as X,E as S,L as Y}from"./index-DZI9-0T5.js";import{o as E,s as M}from"./apiLoading-9Dy-fl_u.js";const h={list:s=>f.post("projectDispatch/getProjectDispatchList",s),getProjectList:s=>f.post("projectDispatch/getNotDispatchProjectList",s),create:s=>f.post("projectDispatch/addProjectDispatch",s),edit:s=>f.post("projectDispatch/updateProjectDispatch",s),delete:s=>f.post("projectDispatch/deleteProjectDispatch",s),getAllocationGroupOrSupplier:s=>f.post("projectDispatch/getAllocationGroupOrSupplier",s)},Z={style:{float:"left"}},ee={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},te={style:{flex:"auto"}},ae=Q({name:"Edit",__name:"index",emits:["fetch-data"],setup(s,{expose:z,emit:A}){const B=A,_=x(),F=w({projectId:[{required:!0,message:"请选择项目",trigger:"change"}],dispatchType:[{required:!0,message:"请选择调度类型",trigger:"change"}],dataType:[{required:!0,message:"请选择调度目标",trigger:"change"}],groupSupplierId:[{required:!0,message:"请选择至少一个",trigger:"change"}]}),d=x(!1),e=w({title:"",projectList:[],memberGroupNameInfoList:[],supplierNameInfoList:[],form:{projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""}});async function O(p,l){const c=await E(h.getProjectList({}));e.projectList=c.data.getNotDispatchProjectInfoList,l?p.isDispatch===1?S.warning({message:"该项目已经调度，请前往「项目调度」进行编辑",center:!0}):(e.title="新增",e.form.projectId=p.projectId,await j(p.projectId),d.value=!0):(p?(e.title="编辑",e.form=X(p),await j(p.projectId)):e.title="新增",d.value=!0)}const j=async p=>{if(p){const l=await E(h.getAllocationGroupOrSupplier({projectId:p}));e.memberGroupNameInfoList=l.data.getAllocationMemberGroupNameInfoList,e.supplierNameInfoList=l.data.getAllocationSupplierNameInfoList,e.supplierNameInfoList.length&&!e.memberGroupNameInfoList.length&&(e.form.dataType=1),!e.supplierNameInfoList.length&&e.memberGroupNameInfoList.length&&(e.form.dataType=2)}},R=()=>{e.form.groupSupplierId=[],_.value.clearValidate(["groupSupplierId"])};function v(){_.value.resetFields(),e.form={projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},d.value=!1}function $(){_.value&&_.value.validate(async p=>{if(p){if(e.title==="新增"){const{status:l}=await M(h.create(e.form));l===1&&S.success({message:"新增成功"})}else{const{status:l}=await M(h.edit(e.form));l===1&&S.success({message:"修改成功"})}v(),B("fetch-data")}})}return z({showEdit:O}),(p,l)=>{const c=n("el-radio"),D=n("el-radio-group"),m=n("el-form-item"),k=Y,G=n("el-tooltip"),L=n("el-option"),V=n("el-select"),H=n("el-input"),J=n("el-form"),P=n("el-button"),K=n("el-dialog");return i(),I("div",null,[r(K,{modelValue:t(d),"onUpdate:modelValue":l[6]||(l[6]=o=>W(d)?d.value=o:null),title:t(e).title,width:"600","before-close":v},{footer:a(()=>[y("div",te,[r(P,{onClick:v},{default:a(()=>[g(" 取消 ")]),_:1}),r(P,{type:"primary",onClick:$},{default:a(()=>[g(" 确定 ")]),_:1})])]),default:a(()=>[r(J,{ref_key:"formRef",ref:_,"label-width":"130px",style:{position:"relative"},model:t(e).form,rules:t(F),inline:!1},{default:a(()=>[r(m,{label:"调度类型",prop:"dispatchType",style:{"align-items":"center"}},{default:a(()=>[r(D,{modelValue:t(e).form.dispatchType,"onUpdate:modelValue":l[0]||(l[0]=o=>t(e).form.dispatchType=o),class:"ml-4"},{default:a(()=>[r(c,{value:1,size:"large"},{default:a(()=>[g(" 指定关闭 ")]),_:1}),r(c,{value:2,size:"large"},{default:a(()=>[g(" 指定价格 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(G,{class:"tooltips",content:"选中某供应商后，该供应商无法参与该项目的调查",placement:"top"},{default:a(()=>[r(k,{style:{position:"absolute",left:"14.375rem",top:".8125rem"},class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),r(G,{class:"tooltips",content:"举例: 供应商：河南供应商； 指定价格：100； 说明：指定河南供应商，该供应商下会员参与该项目都为100；",placement:"top"},{default:a(()=>[r(k,{style:{position:"absolute",left:"21.375rem",top:".8125rem"},class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),t(e).title==="新增"?(i(),u(m,{key:0,label:"项目ID/名称",prop:"projectId"},{default:a(()=>[r(V,{placeholder:"",modelValue:t(e).form.projectId,"onUpdate:modelValue":l[1]||(l[1]=o=>t(e).form.projectId=o),clearable:"",disabled:"",filterable:"",onChange:j},{default:a(()=>[(i(!0),I(N,null,T(t(e).projectList,o=>(i(),u(L,{key:o.projectId,label:o.projectName,value:o.projectId},{default:a(()=>[y("span",Z,C(o.projectName),1),y("span",ee,C(o.projectId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),U(y("div",null,[U(r(m,{prop:"dataType",label:"调度目标",style:{"align-items":"center"}},{default:a(()=>[r(D,{modelValue:t(e).form.dataType,"onUpdate:modelValue":l[2]||(l[2]=o=>t(e).form.dataType=o),class:"ml-4",onChange:R},{default:a(()=>[r(c,{value:1,size:"large"},{default:a(()=>[g(" 供应商 ")]),_:1}),r(c,{value:2,size:"large"},{default:a(()=>[g(" 会员组 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[q,t(e).supplierNameInfoList.length&&t(e).memberGroupNameInfoList.length]]),t(e).supplierNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===1?(i(),u(m,{key:0,label:"供应商",prop:"groupSupplierId"},{default:a(()=>[r(V,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).form.groupSupplierId=o),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:a(()=>[(i(!0),I(N,null,T(t(e).supplierNameInfoList,o=>(i(),u(L,{key:o.projectId,label:o.supplierName,value:o.supplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),t(e).memberGroupNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===2?(i(),u(m,{key:1,label:"会员组",prop:"groupSupplierId"},{default:a(()=>[r(V,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":l[4]||(l[4]=o=>t(e).form.groupSupplierId=o),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:a(()=>[(i(!0),I(N,null,T(t(e).memberGroupNameInfoList,o=>(i(),u(L,{key:o.projectId,label:o.memberGroupName,value:o.memberGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0)],512),[[q,t(e).form.projectId]]),t(e).form.dispatchType===2?(i(),u(m,{key:1,label:"指定价格"},{default:a(()=>[r(H,{placeholder:"",modelValue:t(e).form.doMoneyPrice,"onUpdate:modelValue":l[5]||(l[5]=o=>t(e).form.doMoneyPrice=o),clearable:""},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{ae as _,h as a};
