
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import C from"./index-UyQpT-H2.js";import{o as M}from"./apiLoading-C_lzfaAz.js";import{u as Q,a as b}from"./index-C3gp8gmz.js";import{u as R}from"./stagedData-CdllaVJT.js";import{d as z,r as l,a3 as B,a4 as f,a as j,o as N,b as H,f as i,w as c,g as v,i as O,an as p,ak as L,_ as U}from"./index-CK7oE2zh.js";import"./index.vue_vue_type_script_setup_true_lang-U4yzWR1x.js";import"./index-DfNHbmXl.js";import"./index-DFJLODe7.js";import"./otherFunctions_basicDictionary-DfN-gQED.js";import"./basicDictionary-CJWWopkW.js";import"./user_customer-BHCGkjZM.js";import"./user_customer-Bpp33sSR.js";const q=z({name:"ProjeckEdit",__name:"index",emits:["fetch-data"],setup(F,{expose:_,emit:y}){const h=Q(),m=R(),T=y,r=l(!1),d=l(""),n=l([]);function I(t){n.value.push(t)}B("validateTopTabs",I);const u=l([]);let o=f([]);const g=l();async function A(t){if(t){d.value="编辑";const a=await M(b.detail({projectId:t.projectId}));console.log("res.data",a.data),D(t)}else{d.value="添加";const a=p(h.initialTopTabsData);o=m.projectManagementList||f([a])}r.value=!0}function D(t){o.length=0;const{getProjectInfoList:a,...e}=p(t);o.push(e),a&&a.length&&a.forEach(s=>{o.push({...s})})}function V(){m.projectManagementList=p(o),o=f([]),r.value=!1,n.value=[]}async function w(){const t=[];n.value.forEach(e=>{t.push(e.validate())});const a=await Promise.allSettled(t);u.value=a.map(e=>e.status)}function P(t){const a=new Set;for(const e of t){if(a.has(e.name))return!0;a.add(e.name)}return!1}const k=()=>{const t=p(o);let a=t[0];return a.addProjectInfoList=t.slice(1),a.data&&delete a.data,a.addProjectQuotaInfoList=a.addProjectQuotaInfoList.map(e=>(Array.isArray(e.answerValueList)||(e.answerValueList=[e.answerValueList]),Array.isArray(e.projectAnswerIdList)||(e.projectAnswerIdList=[e.projectAnswerIdList]),e)),a.addProjectInfoList.forEach(e=>{e.data&&delete e.data,e.addProjectQuotaInfoList=e.addProjectQuotaInfoList.map(s=>(Array.isArray(s.answerValueList)||(s.answerValueList=[s.answerValueList]),Array.isArray(s.projectAnswerIdList)||(s.projectAnswerIdList=[s.projectAnswerIdList]),s))}),console.log("masterData",a),a};async function x(){if(await w(),u.value.every(t=>t==="fulfilled"))if(P(o))L.warning({message:"项目名称重复",center:!0});else{const t=k();console.log("params",t);const{status:a}=await b.create(t);a===1&&L.success({message:"新增成功",center:!0})}else g.value.activeLeftTab=u.value.indexOf("rejected"),L.warning({message:"请完善表单",center:!0})}function E(){o=f([]),T("fetch-data"),r.value=!1,n.value=[],d.value==="添加"&&(m.projectManagementList=null)}return _({showEdit:A}),(t,a)=>{const e=j("el-button"),s=j("el-drawer");return N(),H("div",null,[i(s,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=S=>r.value=S),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%"},{footer:c(()=>[i(e,{onClick:E},{default:c(()=>[v(" 取消 ")]),_:1}),i(e,{type:"warning",onClick:V},{default:c(()=>[v(" 暂存 ")]),_:1}),i(e,{type:"primary",onClick:x},{default:c(()=>[v(" 确定 ")]),_:1})]),default:c(()=>[i(C,{onValidate:w,ref_key:"LeftTabsRef",ref:g,"left-tabs-data":O(o),"validate-top-tabs":n.value,"validate-all":u.value,title:d.value},null,8,["left-tabs-data","validate-top-tabs","validate-all","title"])]),_:1},8,["modelValue"])])}}}),oa=U(q,[["__scopeId","data-v-e7a19d83"]]);export{oa as default};
