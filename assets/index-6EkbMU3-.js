
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{ae as Y,r as p,d as pe,m as Q,ao as me,u as ce,c as fe,k as ge,a as s,o as i,e as g,w as l,f as t,g as z,i as n,b as E,q as M,F as I,an as W,E as X,aJ as ve,aK as _e,p as _,P as be}from"./index-DcqAaBhZ.js";import{u as Ve}from"./department-CZx5TpIo.js";import{u as ye}from"./tenant_role-CBY2cve3.js";import{a as we}from"./position_manage-QlMqtdlO.js";import{g as he}from"./group_manage-Djhm8EI5.js";const Ee=Y("PositionManage",()=>{const r=p([]);return{PositionManage:r,getPositionManage:async()=>{if(r.value.length)return r.value;const{data:v}=await we.list({page:1,limit:10,id:null,name:"",active:null});return r.value=v.data,v.data}}}),Me=Ee,Ie=Y("groupManage",()=>{const r=p([]);return{groupManage:r,getGroupManage:async()=>{if(r.value.length)return r.value;const{data:v}=await he.list({page:1,limit:10,id:null,name:"",active:null});return r.value=v.data,v.data}}}),xe=Ie,T=r=>(ve("data-v-20671764"),r=r(),_e(),r),Se=T(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"},"基本信息")],-1)),Ce=T(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"},"角色信息")],-1)),Ne=T(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"},[z(" 小组信息"),_("span",{style:{"margin-left":"20px","font-size":"14px"}},"负责人:迪迦")])],-1)),Pe=pe({__name:"index",props:Q({catalogueId:{default:""},parentId:{default:""},id:{default:""},tree:{},dataList:{},row:{},level:{default:1}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:Q(["success"],["update:modelValue"]),setup(r,{emit:P}){const v=xe(),A=p(),ee=Me(),L=p(),ae=me(),G=p(),le=ye(),O=p(),te=Ve(),R=p(),F=p(!1),$=p(!1),b=r,j=P,U=ce(r,"modelValue"),oe=fe(()=>b.id===""?"新增用户":"编辑用户"),V=p(),ne=p([]),a=p({id:b.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),re=(c,o,u)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(a.value.phone)?u():u(new Error("请输入合法手机号"))},ue=(c,o,u)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a.value.email)?u():u(new Error("请输入合法邮箱"))},J=()=>{a.value.phone.includes("@")?x.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:ue,trigger:"blur"}]:x.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:re,trigger:"blur"}]},x=p({userName:[{required:!0,message:"请输入用户名"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]}),Z=c=>{(c!==a.value.phone||c!==a.value.email)&&($.value=!0)};function se(){a.value.type=a.value.country==="CN"?"phone":"email",a.value.id===""?V.value&&V.value.validate(c=>{c&&(console.log("form.value",a.value),delete a.value.id,a.value.type==="phone"?delete a.value.email:delete a.value.phone,W.create(a.value).then(()=>{X.success({message:"新增成功",center:!0}),j("success"),S()}))}):V.value&&V.value.validate(c=>{if(c){const{id:o,phone:u,email:d,password:f,name:k,country:B,active:C,type:y,role:q,groupId:D,positionId:w,departmentId:h,userName:N}=a.value,m={id:o,phone:u,email:d,password:f,name:k,country:B,active:C,type:y,role:q,groupId:D,positionId:w,departmentId:h,userName:N};y==="phone"?(m.email="",delete m.email):(m.phone="",delete m.phone),m.password||delete m.password,$.value||(delete m.phone,delete m.email),W.edit(m).then(()=>{X.success({message:"编辑成功",center:!0}),j("success"),S()})}})}function S(){U.value=!1}const K=c=>c.reduce((o,u)=>Array.isArray(u)?o.concat(K(u)):o.concat(u),[]);return ge(async()=>{L.value=await ee.PositionManage,O.value=await le.getRole(),R.value=await te.department,A.value=await v.groupManage,G.value=await ae.getCountry(),b.id!==""&&b.row&&(x.value.password=[],a.value=JSON.parse(b.row),F.value=!0),ne.value=K(b.dataList)}),(c,o)=>{const u=s("el-input"),d=s("el-form-item"),f=s("el-col"),k=s("ElOption"),B=s("ElSelect"),C=s("el-option"),y=s("el-select"),q=s("ElInput"),D=s("el-switch"),w=s("el-row"),h=s("el-card"),N=s("el-radio"),m=s("el-radio-group"),de=s("ElForm"),H=s("ElButton"),ie=s("ElDrawer");return i(),g(ie,{modelValue:U.value,"onUpdate:modelValue":o[13]||(o[13]=e=>U.value=e),title:n(oe),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:l(()=>[t(H,{size:"large",onClick:S},{default:l(()=>[z(" 取消 ")]),_:1}),t(H,{type:"primary",size:"large",onClick:se},{default:l(()=>[z(" 确定 ")]),_:1})]),default:l(()=>[t(de,{ref_key:"formRef",ref:V,model:n(a),rules:n(x),"label-width":"100px"},{default:l(()=>[t(h,{class:"box-card"},{header:l(()=>[Se]),default:l(()=>[t(w,{gutter:24},{default:l(()=>[t(f,{span:8},{default:l(()=>[t(d,{label:"用户名",prop:"userName"},{default:l(()=>[t(u,{modelValue:n(a).userName,"onUpdate:modelValue":o[0]||(o[0]=e=>n(a).userName=e),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:l(()=>[t(d,{label:"姓名",prop:"name"},{default:l(()=>[t(u,{modelValue:n(a).name,"onUpdate:modelValue":o[1]||(o[1]=e=>n(a).name=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:l(()=>[t(d,{label:"国家",prop:"country"},{default:l(()=>[t(B,{modelValue:n(a).country,"onUpdate:modelValue":o[2]||(o[2]=e=>n(a).country=e),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:l(()=>[(i(!0),E(I,null,M(n(G),e=>(i(),g(k,{label:e.chineseName,value:e.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(a).country==="CN"?(i(),g(f,{key:0,span:8},{default:l(()=>[t(d,{label:"手机号",prop:"phone"},{default:l(()=>[t(u,{modelValue:n(a).phone,"onUpdate:modelValue":o[3]||(o[3]=e=>n(a).phone=e),placeholder:"请输入手机号",clearable:"",onChange:Z,onBlur:J},null,8,["modelValue"])]),_:1})]),_:1})):(i(),g(f,{key:1,span:8},{default:l(()=>[t(d,{label:"邮箱",prop:"email"},{default:l(()=>[t(u,{modelValue:n(a).email,"onUpdate:modelValue":o[4]||(o[4]=e=>n(a).email=e),placeholder:"请输入邮箱",clearable:"",onChange:Z,onBlur:J},null,8,["modelValue"])]),_:1})]),_:1})),t(f,{span:8},{default:l(()=>[t(d,{label:"部门"},{default:l(()=>[t(y,{modelValue:n(a).departmentId,"onUpdate:modelValue":o[5]||(o[5]=e=>n(a).departmentId=e),placeholder:"请选择部门",clearable:"",filterable:"",onChange:o[6]||(o[6]=()=>{})},{default:l(()=>[(i(!0),E(I,null,M(n(R),e=>(i(),g(C,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:l(()=>[t(d,{label:"职位",prop:"positionId"},{default:l(()=>[t(y,{modelValue:n(a).positionId,"onUpdate:modelValue":o[7]||(o[7]=e=>n(a).positionId=e),placeholder:"请选择职位",clearable:"",filterable:"",onChange:o[8]||(o[8]=()=>{})},{default:l(()=>[(i(!0),E(I,null,M(n(L),e=>(i(),g(C,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:l(()=>[t(d,{label:"密码",prop:"password"},{default:l(()=>[t(q,{disabled:n(F),modelValue:n(a).password,"onUpdate:modelValue":o[9]||(o[9]=e=>n(a).password=e),placeholder:"需要修改密码时请前往当前账号个人中心"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:l(()=>[t(d,{label:"是否启用",prop:"active"},{default:l(()=>[t(D,{modelValue:n(a).active,"onUpdate:modelValue":o[10]||(o[10]=e=>n(a).active=e),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(h,{class:"box-card"},{header:l(()=>[Ce]),default:l(()=>[t(w,{gutter:24},{default:l(()=>[t(d,{label:"分配角色:"},{default:l(()=>[t(m,{modelValue:n(a).role,"onUpdate:modelValue":o[11]||(o[11]=e=>n(a).role=e)},{default:l(()=>[(i(!0),E(I,null,M(n(O),e=>(i(),g(N,{key:e.id,value:e.id,label:e.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(h,{class:"box-card"},{header:l(()=>[Ne]),default:l(()=>[t(w,{gutter:24},{default:l(()=>[t(d,{label:"分配小组:"},{default:l(()=>[t(m,{modelValue:n(a).groupId,"onUpdate:modelValue":o[12]||(o[12]=e=>n(a).groupId=e)},{default:l(()=>[(i(!0),E(I,null,M(n(A),e=>(i(),g(N,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ue=be(Pe,[["__scopeId","data-v-20671764"]]),Te=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ue as D,Me as a,Te as i,xe as u};
