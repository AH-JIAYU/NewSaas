
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as se,m as j,I as ue,r as u,l as de,u as ie,c as ce,n as me,a as d,o as i,e as v,w as a,f as t,g,i as r,b as k,t as P,F as T,y as b,z as pe,j as J,p as O,E as G,aH as fe,aI as ve,L as _e}from"./index-CAqsVIP2.js";import{a as ge}from"./department-DgktKm4G.js";import{a as be}from"./position_manage-faWnTYMq.js";import{u as he}from"./tenant_role-BBm_u63a.js";import{u as ye}from"./configuration_manager-CevEaP7X.js";import"./configuration_role-Dfnmmm83.js";const Q=_=>(fe("data-v-cbd35437"),_=_(),ve(),_),Ve=Q(()=>b("div",{class:"card-header"},[b("div",{class:"leftTitle"},"基本信息")],-1)),Ie={class:"card-header"},Se={class:"leftTitle"},Ne={key:0,style:{"margin-left":"20px","font-size":"14px"}},we=Q(()=>b("div",{class:"card-header"},[b("div",{class:"leftTitle"},"角色信息")],-1)),xe=se({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success"],["update:modelValue"]),setup(_,{emit:W}){ue();const X=ye(),q=u([]),A=u(),Y=de(),ee=u(),ae=he(),z=u(),F=u(),le=u(!1),K=u(),H=u();u();const m=_,Z=W,S=u(),E=ie(_,"modelValue"),te=ce(()=>m.id===""?"新增用户":"编辑用户"),oe={children:"children",label:"name"},p=u(),re=u([]),e=u({id:m.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",organizationalStructureId:[]}),N=u({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(c,o,n)=>{const s=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;e.value.phoneNumber?s.test(e.value.phoneNumber)?n():n(new Error("请输入合法手机号")):n()},trigger:"blur"}],email:[{validator:(c,o,n)=>{const s=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e.value.email?s.test(e.value.email)?n():n(new Error("请输入合法邮箱")):n()},trigger:"blur"}]});function ne(){e.value.email||(N.value.email=[],p.value.clearValidate("email")),e.value.phoneNumber||(N.value.phoneNumber=[],p.value.clearValidate("phoneNumber")),e.value.organizationalStructureId=S.value.getCheckedKeys(!1);const c=S.value.getCheckedKeys(),o=S.value.getHalfCheckedKeys(),n=c.concat(o);e.value.organizationalStructureId=n,e.value.id?p.value&&p.value.validate(s=>{if(s){const{id:f,phoneNumber:C,email:B,password:h,name:y,country:V,active:R,type:U,role:L,positionId:D,organizationalStructureId:x,userName:M}=e.value,l={id:f,phoneNumber:C,email:B,password:h,name:y,country:V,active:R,type:U,role:L,positionId:D,organizationalStructureId:x,userName:M};H.value===l.phoneNumber&&delete l.phoneNumber,K.value===l.email&&delete l.email,l.password||delete l.password,O.edit(l).then(()=>{G.success({message:"编辑成功",center:!0}),Z("success"),w()})}}):p.value&&p.value.validate(s=>{s&&O.create(e.value).then(()=>{G.success({message:"新增成功",center:!0}),Z("success"),w()})})}function w(){E.value=!1}const $=c=>c==null?void 0:c.reduce((o,n)=>Array.isArray(n)?o.concat($(n)):o.concat(n),[]);return me(async()=>{e.value.organizationalStructureId=[],e.value.organizationalStructureId.push(m.parentId);const{data:c}=await be.list({page:1,limit:10,id:null,name:"",active:null});A.value=c.data,q.value=await X.getStaff(),z.value=await ae.getRole();const o=await ge.list({name:""});F.value=o.data,ee.value=await Y.getCountry(),m.id!==""&&m.row&&(N.value.password=[],e.value=JSON.parse(m.row),e.value.organizationalStructureId||(e.value.organizationalStructureId=[]),e.value.organizationalStructureId.push(m.parentId),K.value=e.value.email,H.value=e.value.phoneNumber,le.value=!0),re.value=$(m.dataList)}),(c,o)=>{const n=d("el-input"),s=d("el-form-item"),f=d("el-col"),C=d("el-option"),B=d("el-select"),h=d("el-row"),y=d("el-card"),V=d("el-text"),R=d("el-tree"),U=d("el-radio"),L=d("el-radio-group"),D=d("ElForm"),x=d("ElButton"),M=d("ElDrawer");return i(),v(M,{modelValue:E.value,"onUpdate:modelValue":o[7]||(o[7]=l=>E.value=l),title:r(te),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:w},{footer:a(()=>[t(x,{size:"large",onClick:w},{default:a(()=>[g(" 取消 ")]),_:1}),t(x,{type:"primary",size:"large",onClick:ne},{default:a(()=>[g(" 确定 ")]),_:1})]),default:a(()=>[t(D,{ref_key:"formRef",ref:p,model:r(e),rules:r(N),"label-width":"100px","validate-on-rule-change":!1},{default:a(()=>[t(y,{class:"box-card"},{header:a(()=>[Ve]),default:a(()=>[t(h,{gutter:24},{default:a(()=>[t(f,{span:8},{default:a(()=>[t(s,{label:"用户名",prop:"userName"},{default:a(()=>[t(n,{modelValue:r(e).userName,"onUpdate:modelValue":o[0]||(o[0]=l=>r(e).userName=l),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(s,{label:"姓名",prop:""},{default:a(()=>[t(n,{modelValue:r(e).name,"onUpdate:modelValue":o[1]||(o[1]=l=>r(e).name=l),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(s,{label:"手机号",prop:"phoneNumber"},{default:a(()=>[t(n,{modelValue:r(e).phoneNumber,"onUpdate:modelValue":o[2]||(o[2]=l=>r(e).phoneNumber=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(s,{label:"邮箱",prop:"email"},{default:a(()=>[t(n,{modelValue:r(e).email,"onUpdate:modelValue":o[3]||(o[3]=l=>r(e).email=l),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(s,{label:"职位",prop:""},{default:a(()=>[t(B,{modelValue:r(e).positionId,"onUpdate:modelValue":o[4]||(o[4]=l=>r(e).positionId=l),placeholder:"请选择职位",clearable:"",filterable:"",onChange:o[5]||(o[5]=()=>{})},{default:a(()=>[(i(!0),k(T,null,P(r(A),l=>(i(),v(C,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(y,{class:"box-card"},{header:a(()=>[b("div",Ie,[b("div",Se,[g(" 部门信息"),r(e).director?(i(),k("span",Ne,[g("负责人:"),(i(!0),k(T,null,P(r(q),l=>(i(),v(V,{key:l.id},{default:a(()=>[l.id===r(e).director?(i(),v(V,{key:0},{default:a(()=>[g(pe(l.name),1)]),_:2},1024)):J("",!0)]),_:2},1024))),128))])):J("",!0)])])]),default:a(()=>[t(h,{gutter:24},{default:a(()=>[t(s,{label:"分配部门:"},{default:a(()=>[t(R,{style:{"max-width":"600px"},ref_key:"treeRef",ref:S,data:r(F),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":r(e).organizationalStructureId,"default-expand-all":"",props:oe},null,8,["data","default-checked-keys"])]),_:1})]),_:1})]),_:1}),t(y,{class:"box-card"},{header:a(()=>[we]),default:a(()=>[t(h,{gutter:24},{default:a(()=>[t(s,{label:"分配角色:"},{default:a(()=>{var l;return[(l=r(z))!=null&&l.length?(i(),v(L,{key:0,modelValue:r(e).role,"onUpdate:modelValue":o[6]||(o[6]=I=>r(e).role=I)},{default:a(()=>[(i(!0),k(T,null,P(r(z),I=>(i(),v(U,{key:I.id,value:I.roleName,label:I.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(i(),v(V,{key:1},{default:a(()=>[g("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),De=_e(xe,[["__scopeId","data-v-cbd35437"]]);export{De as default};
