
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Z,r as d,l as $,n as J,p as k,E as R,a as p,q as L,s as j,i as a,o as m,b as x,f as r,w as s,F as I,t as P,e as g}from"./index-CBZA2ZHR.js";import{u as G}from"./tenant_role-mHbDAEyA.js";const Q=Z({__name:"index",props:["id","row"],setup(A,{expose:D}){const C=d(!1),O=$(),z=G(),U=d(),q=d(),N=A,u=d(!1),S=d(!1),c=d(),e=d({id:"",email:"",phone:"",name:"",country:"",password:"",role:null,active:!0,type:"phone"}),M=(i,o,t)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?t():t(new Error("请输入合法手机号"))},T=(i,o,t)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?t():t(new Error("请输入合法邮箱"))},B=()=>{e.value.phone.includes("@")?v.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:T,trigger:"blur"}]:v.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:M,trigger:"blur"}]},v=d({password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]});J(async()=>{try{u.value=!0,q.value=await O.getCountry(),U.value=await z.getRole(),u.value=!1,N.id&&(e.value=JSON.parse(N.row),v.value.password=[],C.value=!0)}catch{}finally{u.value=!1}});const F=i=>{(i!==e.value.phone||i!==e.value.email)&&(S.value=!0)};D({submit(){return new Promise(i=>{e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?c.value&&c.value.validate(o=>{if(o)try{u.value=!0,delete e.value.id,e.value.type==="phone"?delete e.value.email:delete e.value.phone,k.create(e.value).then(()=>{u.value=!1,R.success({message:"新增成功",center:!0}),h(),i()})}catch{}finally{u.value=!1}}):c.value&&c.value.validate(o=>{if(o)try{u.value=!0;const{id:t,phone:n,email:y,password:b,name:_,country:w,active:E,type:f,role:V}=e.value,l={id:t,phone:n,email:y,password:b,name:_,country:w,active:E,type:f,role:V};f==="phone"?(l.email="",delete l.email):(l.phone="",delete l.phone),l.password||delete l.password,S.value||(delete l.phone,delete l.email),k.edit(l).then(()=>{u.value=!1,R.success({message:"编辑成功",center:!0}),h(),i()})}catch{}finally{u.value=!1}})})},onCancel:h});function h(){e.value={}}return(i,o)=>{const t=p("ElInput"),n=p("ElFormItem"),y=p("ElOption"),b=p("ElSelect"),_=p("el-option"),w=p("el-select"),E=p("el-switch"),f=p("ElForm"),V=L("loading");return j((m(),x("div",null,[r(f,{ref_key:"formRef",ref:c,model:a(e),rules:a(v),"label-width":"130px"},{default:s(()=>[r(n,{label:"用户名",prop:"name"},{default:s(()=>[r(t,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(n,{label:"区域",prop:"country"},{default:s(()=>[r(b,{modelValue:a(e).country,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).country=l),placeholder:"请选择区域",clearable:"",filterable:"",tabindex:"2"},{default:s(()=>[(m(!0),x(I,null,P(a(q),l=>(m(),g(y,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(e).country==="CN"?(m(),g(n,{key:0,label:"手机号",prop:"phone"},{default:s(()=>[r(t,{modelValue:a(e).phone,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).phone=l),placeholder:"请输入手机号",onChange:F,onBlur:B},null,8,["modelValue"])]),_:1})):(m(),g(n,{key:1,label:"邮箱",prop:"email"},{default:s(()=>[r(t,{modelValue:a(e).email,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).email=l),placeholder:"请输入邮箱",onChange:F,onBlur:B},null,8,["modelValue"])]),_:1})),r(n,{label:"密码",prop:"password"},{default:s(()=>[r(t,{disabled:a(C),modelValue:a(e).password,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).password=l),placeholder:"需要修改密码时请前往当前账号个人中心"},null,8,["disabled","modelValue"])]),_:1}),r(n,{label:"角色",prop:"role"},{default:s(()=>[r(w,{modelValue:a(e).role,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).role=l),placeholder:"请选择角色"},{default:s(()=>[(m(!0),x(I,null,P(a(U),l=>(m(),g(_,{key:l.id,label:l.roleName,value:l.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"是否启用",prop:"active"},{default:s(()=>[r(E,{modelValue:a(e).active,"onUpdate:modelValue":o[6]||(o[6]=l=>a(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[V,a(u)]])}}});export{Q as _};
