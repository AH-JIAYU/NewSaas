
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as M,r as m,k as A,n as J,l as O,E as k,a as n,p as P,q as b,i as o,o as f,b as g,f as t,w as s,F as T,t as C,e as $,ar as E,g as j,R as z}from"./index-lihZnDlK.js";import{u as G}from"./configuration_manager-BgHz6wwS.js";import{a as F}from"./department-DO9yWr6Y.js";const H=M({__name:"index",props:["id","row"],setup(N,{expose:U}){const V=N,h=[{label:"完成计提",value:1},{label:"审核计提",value:2},{label:"收款计提",value:3}];G();const w=m([]);m([]);const i=m(!1),d=m(),e=m({id:V.id,name:"",director:null,remark:"",commissionStatus:null,commission:null,commissionType:null}),v=m(!1);let p="";const _=m({name:[{required:!0,message:"请输入部门名称",trigger:"blur"}],director:[{required:!0,message:"请选择部门主管",trigger:"change"}],commission:[{required:!1,message:"请输入提成比例",trigger:"blur"},{validator:(r,l,u)=>{l?/^\d+(\.\d+)?$/.test(l)?u():u(new Error("请输入有效的数字")):u(new Error("请输入数字"))},trigger:"blur"}]});A(()=>{d.value.resetFields(),J(async()=>{const{data:r}=await O.list({id:"",userName:"",active:"",departmentId:""});w.value=r.data}),e.value.commissionStatus!==1&&(_.value.commission=[]),e.value.id!==""&&q()});function q(){i.value=!0,e.value=JSON.parse(V.row),p=e.value.userInfo.id,i.value=!1}const D=r=>{r===p?(p=r,v.value=!0):v.value=!1};return U({submit(){return new Promise(r=>{try{e.value.id===""?d.value&&d.value.validate(l=>{l&&(delete e.value.id,delete e.value.memberCount,e.value.commissionStatus!==1&&(_.value.commission=[],e.value.commission=0,e.value.commissionType=0),i.value=!0,F.create(e.value).then(()=>{i.value=!1,k.success({message:"新增成功",center:!0}),r()}))}):d.value&&d.value.validate(l=>{l&&(i.value=!0,delete e.value.memberCount,e.value.commissionStatus!==1&&(e.value.commission=0,e.value.commissionType=0),e.value.director===p&&delete e.value.director,v.value&&delete e.value.director,F.edit(e.value).then(()=>{i.value=!1,k.success({message:"编辑成功",center:!0}),r()}))})}catch{}finally{setTimeout(()=>{i.value=!1},1e3)}})}}),(r,l)=>{const u=n("el-input"),c=n("el-form-item"),y=n("el-option"),x=n("el-select"),I=n("el-switch"),S=n("el-col"),R=n("el-row"),B=n("ElForm"),L=P("loading");return b((f(),g("div",null,[t(B,{ref_key:"formRef",ref:d,model:o(e),rules:o(_),"label-width":"130px","label-suffix":"："},{default:s(()=>[t(c,{label:"部门名称",prop:"name"},{default:s(()=>[t(u,{modelValue:o(e).name,"onUpdate:modelValue":l[0]||(l[0]=a=>o(e).name=a),placeholder:"请输入部门名称",clearable:"",onChange:l[1]||(l[1]=()=>{})},null,8,["modelValue"])]),_:1}),t(c,{label:"部门主管",prop:"director"},{default:s(()=>[t(x,{modelValue:o(e).director,"onUpdate:modelValue":l[2]||(l[2]=a=>o(e).director=a),"value-key":"",placeholder:"请选择部门主管",clearable:"",filterable:"",onChange:D},{default:s(()=>[(f(!0),g(T,null,C(o(w),a=>(f(),$(y,{key:a.id,label:a.name,value:a.id,disabled:a.distribution!==2},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,{style:{"margin-bottom":"0px"},gutter:20},{default:s(()=>[t(S,{span:8},{default:s(()=>[t(c,{label:"部门提成",prop:"commissionStatus"},{default:s(()=>[t(I,{modelValue:o(e).commissionStatus,"onUpdate:modelValue":l[3]||(l[3]=a=>o(e).commissionStatus=a),"active-text":"启用","inactive-text":"禁用","inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:16},{default:s(()=>[b(t(c,{label:"提成发放规则",prop:"commissionType"},{default:s(()=>[t(x,{modelValue:o(e).commissionType,"onUpdate:modelValue":l[4]||(l[4]=a=>o(e).commissionType=a),"value-key":"",placeholder:"请选择发放提成方式",clearable:"",filterable:""},{default:s(()=>[(f(),g(T,null,C(h,a=>t(y,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},512),[[E,o(e).commissionStatus===1]])]),_:1})]),_:1}),b(t(c,{label:"提成比例",prop:"commission"},{default:s(()=>[t(u,{modelValue:o(e).commission,"onUpdate:modelValue":l[5]||(l[5]=a=>o(e).commission=a),modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:s(()=>[j("%")]),_:1},8,["modelValue"])]),_:1},512),[[E,o(e).commissionStatus===1]]),t(c,{label:"备注"},{default:s(()=>[t(u,{modelValue:o(e).remark,"onUpdate:modelValue":l[6]||(l[6]=a=>o(e).remark=a),type:"textarea",rows:10,placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[L,o(i)]])}}}),Y=z(H,[["__scopeId","data-v-7057251d"]]);export{Y as default};
