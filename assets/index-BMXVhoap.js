
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as V}from"./configuration_role-DE1m9Ehx.js";import{k as K,A as M,r as s,c as j,d as q,bk as A,l as H,E as C,a as n,al as J,am as L,i as o,o as v,b,f as l,w as r,C as y,D as I,F as O,n as T,e as z,g as Q,j as W,P as X}from"./index-CAB4bd2D.js";const Y={list:()=>K.get("role/get/getRoleButton")},Z=M("buttonPermission",()=>{const u=s([]),k=j(async()=>{if(u.value.length)return u.value;const{data:f}=await Y.list();return f});return{permissions:u,getPermissions:k}}),ee=Z,te={class:"custom-tree-node"},oe={class:"menu"},se={class:"permission"},le={key:0,class:"permissions"},ae=q({__name:"index",props:["id","row"],setup(u,{expose:k}){const f=u,N=s(!0),R=A(),B=ee(),i=s(!1),d=s(),g=s(),x=s([]),p=s([]),e=s({id:f.id??null,menuId:[],permission:[],roleName:"",remark:""}),S=s({roleName:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});H(async()=>{e.value.id!==""&&await F(),i.value=!0,x.value=R.routesRaw,p.value=await B.getPermissions,i.value=!1});async function F(){i.value=!0,e.value=JSON.parse(f.row),i.value=!1}function w(c){var t;return(t=p==null?void 0:p.value)==null?void 0:t.filter(_=>c===_.menuId)}return k({submit(){return e.value.menuId=g.value.getCheckedKeys().concat(g.value.getHalfCheckedKeys()),new Promise(c=>{e.value.id===""?d.value&&d.value.validate(t=>{t&&V.create(e.value).then(()=>{C.success({message:"新增成功",center:!0}),c()})}):d.value&&d.value.validate(t=>{t&&V.edit(e.value).then(()=>{C.success({message:"编辑成功",center:!0}),c()})})})}}),(c,t)=>{const _=n("ElInput"),h=n("ElFormItem"),P=n("ElCheckbox"),D=n("ElCheckboxGroup"),U=n("el-tree"),$=n("ElForm"),G=J("loading");return L((v(),b("div",null,[l($,{ref_key:"formRef",ref:d,model:o(e),rules:o(S),"label-width":"120px","label-suffix":"："},{default:r(()=>[l(h,{label:"角色码",prop:"roleName"},{default:r(()=>[l(_,{modelValue:o(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=a=>o(e).roleName=a),disabled:!!o(e).id,placeholder:"请输入角色码"},null,8,["modelValue","disabled"])]),_:1}),l(h,{label:"备注",prop:"remark"},{default:r(()=>[l(_,{modelValue:o(e).remark,"onUpdate:modelValue":t[1]||(t[1]=a=>o(e).remark=a),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),l(h,{label:"权限"},{default:r(()=>[l(U,{ref_key:"treeRef",ref:g,data:o(x),style:{width:"100%"},"default-checked-keys":o(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","check-strictly":o(N),"default-expand-all":"","highlight-current":"",border:""},{default:r(({data:a})=>{var E;return[y("div",te,[y("div",oe,I(a.meta.title),1),y("div",se,[(E=w(a.id))!=null&&E.length?(v(),b("div",le,[l(D,{modelValue:o(e).permission,"onUpdate:modelValue":t[2]||(t[2]=m=>o(e).permission=m)},{default:r(()=>[(v(!0),b(O,null,T(w(a.id),m=>(v(),z(P,{key:m.id,value:m.id},{default:r(()=>[Q(I(m.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):W("",!0)])])]}),_:1},8,["data","default-checked-keys","check-strictly"])]),_:1})]),_:1},8,["model","rules"])])),[[G,o(i)]])}}}),ue=X(ae,[["__scopeId","data-v-54300ca1"]]);export{ue as default};
