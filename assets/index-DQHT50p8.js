
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as H,aD as M,r as s,a as p,o as j,b as Y,f as l,w as a,g as c,i as o,y as n,e as G,j as Q,A as W,E as R,_ as X,aH as Z,aI as ee,L as re}from"./index-B77ntG1I.js";import{a as C}from"./user_cooperation-D1QqDDb7.js";import{u as te}from"./index-CNxNepEt.js";import{a as ae}from"./department-DT0R2wTS.js";import"./index-DFaODUYq.js";import"./index-BME0LMxK.js";const g=h=>(Z("data-v-531fac37"),h=h(),ee(),h),le=g(()=>n("div",{style:{display:"flex","align-items":"center"}},[n("span",{style:{display:"inline-block",width:"8px",height:"8px",background:"#FF8181","border-radius":"50%","margin-right":"4px"}}),n("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式")],-1)),oe={style:{display:"flex","align-items":"center"}},ne=g(()=>n("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),se=g(()=>n("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),ie={style:{"margin-top":"6px","margin-bottom":"0px"}},ce={style:{display:"flex","flex-direction":"column"}},de={style:{display:"flex","align-items":"center"}},ue=g(()=>n("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),pe=g(()=>n("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),me=H({__name:"index",emits:["fetch-data"],setup(h,{expose:N,emit:S}){const V=M().currencyType,T=s(),w=S,y=s(!1),U=s();s(1);const r=s({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(t,e,u)=>{if(/^(100|[1-9]?\d)$/.test(e)==!1)return u(new Error("请输入 0 到 100 之间的数字"));u()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),E={children:"children",label:"name"},I=s([]);s();const x=s();async function $(t){r.value.form.chargeUserId="",r.value.form.id=t.id,r.value.form.exchangeRate=t.exchangeRate,t.currencyType==="USD"?T.value=1:t.currencyType==="CNY"&&(T.value=2),r.value.form.priceRatio=t.priceRatio,r.value.form.sendProjectType=t.sendProjectType,m.value=t.sendProjectType,r.value.form.receiveProjectType=t.receiveProjectType,f.value=t.receiveProjectType,r.value.form.chargeUserName=t.userName,r.value.form.invitationType=t.invitationType,r.value.form.chargeUserId=t.userId;const e=await ae.list({name:""});e.data&&(I.value=e.data),y.value=!0}const B=(t,e)=>{e?(x.value.getCheckedKeys().forEach(d=>{d!==t.id&&x.value.setChecked(d,!1)}),r.value.form.chargeUserId=t.id,r.value.form.chargeUserName=t.name):(r.value.form.chargeUserId=[r.value.form.chargeUserId].filter(u=>u!==t.id),r.value.form.chargeUserId.length==0&&(r.value.form.chargeUserId="")),r.value.form.chargeUserId||(r.value.form.chargeUserName="")};function P(){y.value=!1,r.value.form={},U.value.resetFields()}const q=s();async function z(t){await C.updateInvitationBindUser({id:r.value.form.id,chargeUserId:t.chargeUserId,invitationType:t.invitationType,chargeUserName:t.chargeUserName,sendProjectType:t.sendProjectType,receiveProjectType:t.receiveProjectType})}async function F(){await C.updateInvitationBind({id:r.value.form.id,priceRatio:r.value.form.priceRatio,exchangeRate:r.value.form.exchangeRate}),R.success({message:"修改成功",center:!0})}async function D(){U.value.validate(t=>{if(t){let e=JSON.parse(JSON.stringify(r.value.form));if(V===T.value&&(e.exchangeRate=1),Array.isArray(e.chargeUserId)&&(e.chargeUserId=e.chargeUserId[0]),e.receiveProjectType==1&&!e.chargeUserId){R.warning({message:"请选择部门",center:!0});return}e.sendProjectType=m.value,e.receiveProjectType=f.value,e.invitationType=2,e.receiveProjectType==2&&(r.value.form.chargeUserId=null,r.value.form.chargeUserName="",e.chargeUserId=null,e.chargeUserName="",e.invitationType=""),z(e),F(),setTimeout(()=>{w("fetch-data")},1e3),P()}})}function A(t){r.value.form.chargeUserId=t.chargeUserId,r.value.form.invitationType=t.invitationType,r.value.form.chargeUserName=t.chargeUserName}const m=s(null),f=s(null),_=(t,e)=>{e&&(t==="发送"?(m.value=e,r.value.form.sendProjectType=e):(f.value=e,r.value.form.receiveProjectType=e))},K=()=>{m.value=null,f.value=null,r.value.form.sendProjectType=null,r.value.form.receiveProjectType=null};return N({showEdit:$}),(t,e)=>{const u=p("el-input"),d=p("el-form-item"),k=X,b=p("el-tooltip"),v=p("el-button"),J=p("el-tree-select"),L=p("ElForm"),O=p("el-dialog");return j(),Y("div",null,[l(O,{modelValue:o(y),"onUpdate:modelValue":e[6]||(e[6]=i=>W(y)?y.value=i:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置",class:"hezuoDrawer",onClose:K},{footer:a(()=>[l(v,{onClick:P},{default:a(()=>[c(" 关闭 ")]),_:1}),l(v,{type:"primary",onClick:D},{default:a(()=>[c(" 确认 ")]),_:1})]),default:a(()=>[l(L,{ref_key:"formRef",ref:U,rules:o(r).rules,model:o(r).form,"label-width":"7rem",labelPosition:"right"},{default:a(()=>[l(d,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[l(u,{modelValue:o(r).form.priceRatio,"onUpdate:modelValue":e[0]||(e[0]=i=>o(r).form.priceRatio=i),clearable:""},{append:a(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),l(d,{"label-width":"7.5rem"},{label:a(()=>[le]),_:1}),l(d,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[n("span",oe,[l(b,{effect:"dark",placement:"top-start"},{content:a(()=>[ne,se]),default:a(()=>[l(k,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:a(()=>[n("div",ie,[l(v,{type:o(m)===1?"primary":"",size:"small",onClick:e[1]||(e[1]=i=>_("发送",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),l(v,{type:o(m)===2?"primary":"",size:"small",onClick:e[2]||(e[2]=i=>_("发送",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),n("div",ce,[l(d,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[n("span",de,[l(b,{effect:"dark",placement:"top-start"},{content:a(()=>[ue,pe]),default:a(()=>[l(k,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:a(()=>[n("div",null,[l(v,{type:o(f)===1?"primary":"",size:"small",onClick:e[3]||(e[3]=i=>_("接收",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),l(v,{type:o(f)===2?"primary":"",size:"small",onClick:e[4]||(e[4]=i=>_("接收",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),o(r).form.receiveProjectType==1?(j(),G(J,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:x,modelValue:o(r).form.chargeUserId,"onUpdate:modelValue":e[5]||(e[5]=i=>o(r).form.chargeUserId=i),data:o(I),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:E,onCheckChange:B,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):Q("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),l(te,{ref_key:"userRef",ref:q,onUserData:A},null,512)])}}}),xe=re(me,[["__scopeId","data-v-531fac37"]]);export{xe as default};
