
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as W,aD as X,r as i,aL as Y,a as u,o as C,b as E,y as o,z as I,i as r,f as n,w as a,g as c,j as $,e as Z,A as ee,ba as w,E as te,_ as ae,aH as le,aI as ne,L as oe}from"./index-D_G0Q2kt.js";import{u as re}from"./index-Drh9leOf.js";import{a as se}from"./department-CcKVWrqY.js";import"./index-CAXRxdi9.js";import"./index-Vq8ZNA-n.js";const p=g=>(le("data-v-24fe2628"),g=g(),ne(),g),ie={class:"news p-4"},ce=p(()=>o("div",{class:"type"},[o("span"),c(" 合作邀约")],-1)),de={class:"news-content"},ue={class:"content"},pe={class:"time"},me=p(()=>o("div",null,"您好！",-1)),ve={key:0,class:"footer"},fe=p(()=>o("div",{style:{display:"flex","align-items":"center"}},[o("span",{style:{display:"inline-block",width:"8px",height:"8px",background:"#FF8181","border-radius":"50%","margin-right":"4px"}}),o("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式")],-1)),ge={style:{display:"flex","align-items":"center"}},ye=p(()=>o("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),_e=p(()=>o("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),he={style:{"margin-top":"6px","margin-bottom":"0px"}},xe={style:{display:"flex","flex-direction":"column"}},be={style:{display:"flex","align-items":"center"}},Ie=p(()=>o("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),Te=p(()=>o("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),ke=W({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(g,{expose:z,emit:F}){const T=X(),k=T.currencyType,m=i();i(1);const R=F,U=Y(),e=i({rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(l,t,s)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return s(new Error("请输入 0 到 100 之间的数字"));s()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),v=i(!1);i([]);const P=i(),q={children:"children",label:"name"},A=async l=>{e.value.chargeUserId="",e.value=l,m.value=l.currencyType,k===m.value?e.value.exchangeRate=1:k===1&&m.value===2?e.value.exchangeRate=T.originalExchangeRate:k===2&&m.value===1&&(e.value.exchangeRate=(1/T.originalExchangeRate).toFixed(2));const t=await se.list({name:""});t.data&&(j.value=t.data),D()},j=i([]);i();const y=i(),B=(l,t)=>{t?(y.value.getCheckedKeys().forEach(f=>{f!==l.id&&y.value.setChecked(f,!1)}),e.value.chargeUserId=l.id,y.value.getCheckedNodes(),e.value.chargeUserName=l.name):(e.value.chargeUserId=[e.value.chargeUserId].filter(s=>s!==l.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="")),e.value.chargeUserId||(e.value.chargeUserName="")},D=async()=>{const l={id:e.value.id,type:1};await w.updateTenantAudit(l),await U.getUnreadTodo()},K=async()=>{const l={id:e.value.id,type:2};R("delSelectId"),await w.updateTenantAudit(l),await U.getUnreadTodo()},L=async()=>{P.value.validate(async l=>{if(l){if(Array.isArray(e.value.chargeUserId)&&(e.value.chargeUserId=e.value.chargeUserId[0]),e.value.receiveProjectType==1&&!e.value.chargeUserId){te.warning({message:"请选择部门",center:!0});return}const t={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType,receiveProjectType:e.value.receiveProjectType,exchangeRate:e.value.exchangeRate};R("delSelectId"),await w.updateTenantAudit(t),await U.getUnreadTodo()}})},H=i();function M(l){e.value.chargeUserId=l.chargeUserId,e.value.invitationType=l.invitationType,e.value.chargeUserName=l.chargeUserName}const _=i(null),h=i(null),x=(l,t)=>{t&&(l==="发送"?(_.value=t,e.value.sendProjectType=t):(h.value=t,e.value.receiveProjectType=t))},G=()=>{_.value=null,h.value=null,e.value.sendProjectType=null,e.value.receiveProjectType=null};return z({showEdit:A}),(l,t)=>{const s=u("el-button"),f=u("el-input"),b=u("el-form-item"),N=ae,S=u("el-tooltip"),J=u("el-tree-select"),O=u("ElForm"),V=u("ElButton"),Q=u("el-dialog");return C(),E("div",ie,[ce,o("div",de,[o("div",ue,"尊贵的"+I(r(e).beInvitedName),1),o("div",pe,[me,o("div",null,"我是"+I(r(e).invitationName)+",诚挚邀请贵司与我们合作,实现共赢！",1),o("div",null,"我方货币类型为"+I(r(m)===1?"美元":"人民币")+"，达成合作后我方发布项目以 "+I(r(m)===1?"美元":"人民币")+" 计价，望悉知。",1)]),r(e).auditStatus===1?(C(),E("div",ve,[n(s,{onClick:K},{default:a(()=>[c("拒绝合作")]),_:1}),n(s,{type:"primary",onClick:t[0]||(t[0]=d=>v.value=!0)},{default:a(()=>[c(" 同意合作 ")]),_:1})])):$("",!0)]),n(Q,{modelValue:r(v),"onUpdate:modelValue":t[8]||(t[8]=d=>ee(v)?v.value=d:null),title:"合作配置",class:"hezuoDrawer",onClose:G},{footer:a(()=>[n(V,{size:"large",onClick:t[7]||(t[7]=d=>v.value=!1)},{default:a(()=>[c(" 取消 ")]),_:1}),n(V,{type:"primary",size:"large",onClick:L},{default:a(()=>[c(" 确定 ")]),_:1})]),default:a(()=>[n(O,{ref_key:"FormRef",ref:P,rules:r(e).rules,model:r(e),"label-width":"7rem",labelPosition:"left"},{default:a(()=>[n(b,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[n(f,{modelValue:r(e).priceRatio,"onUpdate:modelValue":t[1]||(t[1]=d=>r(e).priceRatio=d),clearable:""},{append:a(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),n(b,{"label-width":"7.5rem"},{label:a(()=>[fe]),_:1}),n(b,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[o("span",ge,[n(S,{effect:"dark",placement:"top-start"},{content:a(()=>[ye,_e]),default:a(()=>[n(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:a(()=>[o("div",he,[n(s,{type:r(_)===1?"primary":"",size:"small",onClick:t[2]||(t[2]=d=>x("发送",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),n(s,{type:r(_)===2?"primary":"",size:"small",onClick:t[3]||(t[3]=d=>x("发送",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),o("div",xe,[n(b,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[o("span",be,[n(S,{effect:"dark",placement:"top-start"},{content:a(()=>[Ie,Te]),default:a(()=>[n(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:a(()=>[o("div",null,[n(s,{type:r(h)===1?"primary":"",size:"small",onClick:t[4]||(t[4]=d=>x("接收",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),n(s,{type:r(h)===2?"primary":"",size:"small",onClick:t[5]||(t[5]=d=>x("接收",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),r(e).receiveProjectType==1?(C(),Z(J,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:y,modelValue:r(e).chargeUserId,"onUpdate:modelValue":t[6]||(t[6]=d=>r(e).chargeUserId=d),data:r(j),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:q,onCheckChange:B,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):$("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),n(re,{ref_key:"userRef",ref:H,onUserData:M},null,512)])}}}),Ne=oe(ke,[["__scopeId","data-v-24fe2628"]]);export{Ne as default};
