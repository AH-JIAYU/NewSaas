
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as re,K as ie,aL as ue,s as ce,r as A,k as me,B,F as pe,a as r,l as de,o as i,b as E,f as a,w as n,i as t,a2 as P,a3 as be,e as c,g as u,C as f,D as fe,n as ge,j as p,O as _e,aM as he,E as D,J as ke,aN as ve,aO as ye,an as Ce,aH as we,aI as Le,p as Se,N as Ee}from"./index-BdHtZquS.js";import{_ as Me}from"./index.vue_vue_type_script_setup_true_lang-BC1lkQil.js";import{_ as Ie}from"./index.vue_vue_type_style_index_0_lang-CiWQT7ji.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-BfuXSoc2.js";import{_ as ze}from"./index.vue_vue_type_script_setup_true_lang-DxdJp9EB.js";import{a as M}from"./index-BTTnuGn9.js";import{u as Te}from"./useTabbar-BTFEhxWQ.js";const Ae=_=>(we("data-v-58c7a09a"),_=_(),Le(),_),Be=Ae(()=>Se("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),Pe=re({name:"billManagement",__name:"list",setup(_){const H=ie(),{pagination:g,getParams:V,onSizeChange:F,onCurrentChange:$,onSortChange:N}=ue(),U=Te(),I=ce(),h=A([{label:"会员ID/姓名",prop:"memberId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税",prop:"taxesFees",sortable:!0,checked:!0},{label:"实际金额",prop:"payAmount",sortable:!0,checked:!0},{label:"支付时间",prop:"payTime",sortable:!0,checked:!0},{label:"说明",prop:"notes",sortable:!0,checked:!0},{label:"账单状态",prop:"billStatus",sortable:!0,checked:!0}]),e=A({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],formMode:"dialog",formModeProps:{visible:!1,id:""},search:{member:"",billStatus:""},billStatusList:["待支付","已支付","已拒绝"],batch:{enable:!1,selectionDataList:[]},dataList:[]});me(()=>{h.value.forEach(s=>{s.checked&&e.value.checkList.push(s.prop)}),m(),e.value.formMode==="router"&&B.on("get-data-list",()=>{m()})}),pe(()=>{e.value.formMode==="router"&&B.off("get-data-list")});function m(){e.value.loading=!0;const s={...V(),...e.value.search};e.value.search.member&&(/^\d+$/.test(s.member)?s.memberId=s.member:s.memberName=s.member),M.list(s).then(l=>{e.value.loading=!1,e.value.dataList=l.data.memberBillInfoList,g.value.total=l.data.total})}function O(){Object.assign(e.value.search,{member:"",billStatus:""}),m()}function R(s){F(s).then(()=>m())}function C(s=1){$(s).then(()=>m())}function j({prop:s,order:l}){N(s,l).then(()=>m())}function J(){e.value.formMode==="router"?I.settings.tabbar.enable&&I.settings.tabbar.mergeTabsBy!=="activeMenu"?U.open({name:"routerName"}):H.push({name:"routerName"}):(e.value.formModeProps.id="",e.value.formModeProps.visible=!0)}async function x(s,l){l===2?he.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async k=>{(await M.changestatus({id:s,type:l,notes:k.value})).status===1&&D.success({message:"操作成功"}),m()}):((await M.changestatus({id:s,type:l})).status===1&&D.success({message:"操作成功"}),m())}return(s,l)=>{const k=r("ElInput"),v=r("ElFormItem"),K=r("el-option"),Q=r("el-select"),z=ke,w=r("ElButton"),q=r("ElForm"),G=xe,W=r("ElDivider"),y=r("el-button"),X=Ie,Y=ve,Z=ye,ee=r("el-row"),T=r("el-table-column"),d=r("ElTableColumn"),L=Me,te=r("el-empty"),oe=r("ElTable"),le=r("ElPagination"),ae=Ce,ne=de("loading");return i(),E("div",{class:_e({"absolute-container":t(e).tableAutoHeight})},[a(ae,null,{default:n(()=>[a(G,{"show-toggle":!1},{default:n(({fold:o,toggle:S})=>[a(q,{model:t(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:n(()=>[a(v,null,{default:n(()=>[a(k,{modelValue:t(e).search.member,"onUpdate:modelValue":l[0]||(l[0]=b=>t(e).search.member=b),placeholder:"会员ID/会员姓名",clearable:"",onClear:l[1]||(l[1]=b=>C())},null,8,["modelValue"])]),_:1}),a(v,null,{default:n(()=>[a(Q,{modelValue:t(e).search.billStatus,"onUpdate:modelValue":l[2]||(l[2]=b=>t(e).search.billStatus=b),"value-key":"",placeholder:"账单状态",clearable:"",filterable:""},{default:n(()=>[(i(!0),E(P,null,be(t(e).billStatusList,(b,se)=>(i(),c(K,{key:b,value:se+1,label:b},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,null,{default:n(()=>[a(w,{type:"primary",onClick:l[3]||(l[3]=b=>C())},{icon:n(()=>[a(z,{name:"i-ep:search"})]),default:n(()=>[u(" 筛选 ")]),_:1}),a(w,{onClick:O},{icon:n(()=>[Be]),default:n(()=>[u(" 重置 ")]),_:1}),a(w,{disabled:"",link:"",onClick:S},{icon:n(()=>[a(z,{name:o?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:n(()=>[u(" "+f(o?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(W,{"border-style":"dashed"}),a(ee,null,{default:n(()=>[a(X,null,{default:n(()=>[a(y,{size:"default",type:"primary",onClick:J},{default:n(()=>[u(" 新增结算 ")]),_:1})]),_:1}),a(Z,null,{default:n(()=>[a(y,{size:"default"},{default:n(()=>[u(" 导出 ")]),_:1}),a(Y,{border:t(e).border,"onUpdate:border":l[4]||(l[4]=o=>t(e).border=o),tableAutoHeight:t(e).tableAutoHeight,"onUpdate:tableAutoHeight":l[5]||(l[5]=o=>t(e).tableAutoHeight=o),checkList:t(e).checkList,"onUpdate:checkList":l[6]||(l[6]=o=>t(e).checkList=o),columns:t(h),"onUpdate:columns":l[7]||(l[7]=o=>fe(h)?h.value=o:null),"line-height":t(e).lineHeight,"onUpdate:lineHeight":l[8]||(l[8]=o=>t(e).lineHeight=o),stripe:t(e).stripe,"onUpdate:stripe":l[9]||(l[9]=o=>t(e).stripe=o),style:{"margin-left":"12px"},onQueryData:m},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),ge((i(),c(oe,{border:t(e).border,size:t(e).lineHeight,stripe:t(e).stripe,class:"my-4",data:t(e).dataList,"highlight-current-row":"",height:"100%",onSortChange:j,onSelectionChange:l[10]||(l[10]=o=>t(e).batch.selectionDataList=o)},{empty:n(()=>[a(te,{description:"暂无数据"})]),default:n(()=>[a(T,{align:"center",type:"selection"}),t(e).checkList.includes("memberId")?(i(),c(d,{key:0,"show-overflow-tooltip":"",align:"center",prop:"",label:"会员ID/姓名",width:"250"},{default:n(({row:o})=>[u(f(o.memberId)+"/ "+f(o.memberName),1)]),_:1})):p("",!0),t(e).checkList.includes("billTime")?(i(),c(d,{key:1,"show-overflow-tooltip":"",align:"center",prop:"billTime",label:"账单日期"})):p("",!0),t(e).checkList.includes("billAmount")?(i(),c(d,{key:2,"show-overflow-tooltip":"",align:"center",prop:"billAmount",label:"账单金额"},{default:n(({row:o})=>[a(L),u(f(o.billAmount||0),1)]),_:1})):p("",!0),t(e).checkList.includes("taxesFees")?(i(),c(d,{key:3,"show-overflow-tooltip":"",align:"center",prop:"taxesFees",label:"税"},{default:n(({row:o})=>[a(L),u(f(o.taxesFees||0),1)]),_:1})):p("",!0),t(e).checkList.includes("payAmount")?(i(),c(d,{key:4,"show-overflow-tooltip":"",align:"center",prop:"payAmount",label:"实际金额"},{default:n(({row:o})=>[a(L),u(f(o.payAmount||0),1)]),_:1})):p("",!0),t(e).checkList.includes("payTime")?(i(),c(d,{key:5,"show-overflow-tooltip":"",align:"center",prop:"payTime",label:"支付时间"})):p("",!0),t(e).checkList.includes("notes")?(i(),c(d,{key:6,"show-overflow-tooltip":"",align:"center",prop:"notes",label:"说明"},{default:n(({row:o})=>[u(f(o.notes?o.notes:"-"),1)]),_:1})):p("",!0),t(e).checkList.includes("billStatus")?(i(),c(d,{key:7,align:"center","show-overflow-tooltip":"",prop:"",label:"账单状态"},{default:n(({row:o})=>[u(f(t(e).billStatusList[o.billStatus-1]),1)]),_:1})):p("",!0),a(T,{align:"center",prop:"i",label:"操作",fixed:"right","show-overflow-tooltip":"",width:"260"},{default:n(({row:o})=>[o.billStatus===1?(i(),E(P,{key:0},[a(y,{size:"small",plain:"",type:"primary",onClick:S=>x(o.id,1)},{default:n(()=>[u(" 支付 ")]),_:2},1032,["onClick"]),a(y,{size:"small",plain:"",type:"danger",onClick:S=>x(o.id,2)},{default:n(()=>[u(" 拒绝支付 ")]),_:2},1032,["onClick"])],64)):p("",!0)]),_:1})]),_:1},8,["border","size","stripe","data"])),[[ne,t(e).loading]]),a(le,{"current-page":t(g).page,total:t(g).total,"page-size":t(g).size,"page-sizes":t(g).sizes,layout:t(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:R,onCurrentChange:C},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),t(e).formMode==="dialog"||t(e).formMode==="drawer"?(i(),c(ze,{key:0,id:t(e).formModeProps.id,modelValue:t(e).formModeProps.visible,"onUpdate:modelValue":l[11]||(l[11]=o=>t(e).formModeProps.visible=o),mode:t(e).formMode,onSuccess:m},null,8,["id","modelValue","mode"])):p("",!0)],2)}}}),Oe=Ee(Pe,[["__scopeId","data-v-58c7a09a"]]);export{Oe as default};
