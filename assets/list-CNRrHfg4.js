
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Pe}from"./index-BiPEVnfN.js";import{_ as Me}from"./index-B3sQ-JKC.js";import{d as Te,aN as Fe,r as p,l as Ge,n as j,X as B,a as v,q as Ae,o as r,b as U,y as _,f as i,w as o,g as h,aA as $,s as R,e as d,z as C,az as P,aq as q,F as J,t as X,i as L,aM as He,j as f,aO as M,E as T,p as Q,_ as Ke,aH as Oe,aI as je,L as qe,ao as W}from"./index-BeWhji_N.js";import{a as F}from"./department-xzeEhQzW.js";import{u as Je}from"./department-DlRog_EM.js";import{u as Xe}from"./position_manage-Ck7qiDBs.js";import Qe from"./index-CsccFW1u.js";import We from"./index-B3FYsGGS.js";import Ye from"./index-1KpHrwBm.js";import Ze from"./index-DNDiCg_e.js";import ea from"./index-B8CQfnJm.js";import"./index-D2vnl3G-.js";import"./position_manage-VicAghVA.js";import"./tenantDictionary-CbUR3GCp.js";import"./tenant_role-CPhVSDeO.js";import"./configuration_role-D2MGWHDW.js";import"./configuration_manager-DKF298na.js";const aa=V=>(Oe("data-v-679c03cd"),V=V(),je(),V),la={class:"absolute-container"},ta={class:"page-main"},ia={class:"custom-tree-node"},oa=["title"],na={class:"code"},ra={class:"actions"},sa={class:"dictionary-container"},ua={class:"copyId tableSmall"},da={class:"id oneLine"},ca={class:"dictionary-container"},pa=aa(()=>_("div",{class:"empty"},"请在左侧新增或选择一个部门",-1)),va=[pa],Y=Te({name:"department",__name:"list",setup(V){const{pagination:S,getParams:ma,onSizeChange:Z,onCurrentChange:ee,onSortChange:ae}=Fe(),z=Xe(),G=p(),le=Ge(),te=p([]),x=Je(),ie=p(),oe=p([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),ne=[{label:"启用",value:!0},{label:"禁用",value:!1}],re=p(),A=p(),b=p({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),H=p(),se=p(),t=p({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),K=p(),n=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),m=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",name:""},row:"",loading:!1});p();const s=p({loading:!1,search:{organizationalStructureId:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});async function w(){try{n.value.loading=!0;const e={...n.value.search},l=await F.list(e);n.value.tree=l.data,n.value.loading=!1}catch{}finally{n.value.loading=!1}}j(()=>{w()}),B(()=>n.value.search,e=>{K.value.filter(e)});function ue(e,l){return e?l.label.includes(e):!0}function de(e){n.value.currentData=e,n.value.dialog.parentId="",n.value.dialog.id="",n.value.dialog.visible=!0}function ce(e){m.value.currentData=e,m.value.dialog.parentId=(e==null?void 0:e.id)??"",m.value.dialog.name=(e==null?void 0:e.name)??"",m.value.dialog.id="",m.value.dialog.visible=!0}function pe(e,l){n.value.currentNode=e,n.value.currentData=l,n.value.row=JSON.stringify(l),n.value.dialog.parentId=e.parent.data.id??"",n.value.dialog.id=l.id,n.value.dialog.visible=!0}function ve(e,l){M.confirm(`确认删除「${l.name}」吗？`,"确认信息").then(()=>{F.delete({id:l.id}).then(()=>{T.success({message:"删除成功",center:!0});const u=e.parent,N=u.data.children||u.data,k=N.findIndex(D=>D.id===l.id);N.splice(k,1),n.value.tree=[...n.value.tree]})})}function me(e){S.value.page=1,e.id&&(t.value.dialog.parentId=e.id),s.value.search.organizationalStructureId=e.id}B(()=>s.value.search.organizationalStructureId,()=>{g()});async function g(){try{s.value.loading=!0;const e={...s.value.search},l=await F.itemlist(e);s.value.loading=!1,t.value.dataList=l.data,s.value.dataList.forEach(u=>{u.enableLoading=!1}),S.value.total=l.data.length}catch{}finally{s.value.loading=!1}}j(async()=>{try{b.value.loading=!0,te.value=await le.getCountry(),ie.value=await(x==null?void 0:x.getDepartment())||[],G.value=await(z==null?void 0:z.getPositionManage())||[],oe.value.forEach(e=>{e.checked&&t.value.checkList.push(e.prop)}),b.value.loading=!1}catch{}finally{b.value.loading=!1}}),B(()=>b.value.search,e=>{re.value.filter(e)});function ge(e){return new Promise(l=>{M.confirm(`确认${e.active?"禁用":"启用"}「${e.name}」吗？`,"确认信息").then(()=>{try{b.value.loading=!0,Q.edit({id:e.id,email:e.email,phoneNumber:e.phoneNumber,userName:e.userName,country:e.country,role:e.role,positionId:e.positionId,organizationalStructureId:e.organizationalStructureId,active:!e.active}).then(()=>(T.success({message:`${e.active?"禁用":"启用"}成功`,center:!0}),g(),b.value.loading=!1,l(!0))).catch(()=>(b.value.loading=!1,l(!1)))}catch{}finally{b.value.loading=!1}}).catch(()=>l(!1))})}function fe(e){Z(e).then(()=>{t.value.search.limit=e,g()})}function he(e=1){ee(e).then(()=>{t.value.search.page=e,g()})}function _e({prop:e,order:l}){ae(e,l).then(()=>g())}function be(e){t.value.dialog.id="",t.value.dialog.visible=!0,t.value.dialog.level=1}const ye=e=>{H.value=e[0]};function ke(){const{name:e,id:l}=H.value;M.confirm(`确认将「${e}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{Q.reset({id:l}).then(()=>{T.success({message:"重置成功",center:!0}),g()})}).catch(()=>{})}function Ie(e){t.value.row=JSON.stringify(e),t.value.dialog.id=e.id,t.value.dialog.visible=!0}function Ce(e){A.value.showEdit(e)}function Se(){Object.assign(t.value.search,{id:"",userName:"",departmentId:null,active:null}),g()}return(e,l)=>{const u=v("ElButton"),N=v("ElButtonGroup"),k=Ke,D=v("ElInput"),we=v("ElTree"),Le=v("ElScrollbar"),Ne=v("el-option"),De=v("ElSelect"),Ve=v("ElSpace"),y=v("ElTableColumn"),Ee=v("ElSwitch"),ze=Me,I=v("el-text"),xe=v("el-empty"),Be=v("ElTable"),Ue=v("ElPagination"),$e=Pe,Re=Ae("loading");return r(),U("div",la,[_("div",ta,[i($e,{"hide-left-side-toggle":""},{leftSide:o(()=>[i(N,{class:"btns"},{default:o(()=>[i(u,{type:"primary",class:"add",onClick:l[0]||(l[0]=a=>de())},{default:o(()=>[h(" 新增部门 ")]),_:1})]),_:1}),i(D,{modelValue:n.value.search.name,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.search.name=a),placeholder:"请输入关键词筛选",clearable:"",class:"search",onKeydown:$(w,["enter"])},{append:o(()=>[i(u,{onClick:w},{default:o(()=>[i(k,{name:"i-ep:search"})]),_:1})]),_:1},8,["modelValue"]),i(Le,{class:"tree"},{default:o(()=>[R((r(),d(we,{ref_key:"dictionaryRef",ref:K,data:n.value.tree,"filter-node-method":ue,"default-expand-all":"",onNodeClick:me},{default:o(({node:a,data:c})=>{var O;return[_("div",ia,[_("div",{class:"label",title:a.label},C(c.name),9,oa),_("div",na,C((O=c==null?void 0:c.organizationalStructurePersonList)==null?void 0:O.map(E=>E.userName).join("，")),1),_("div",ra,[i(N,null,{default:o(()=>[i(u,{type:"primary",plain:"",size:"default",onClick:P(E=>ce(c),["stop"])},{icon:o(()=>[i(k,{name:"i-ep:plus"})]),_:2},1032,["onClick"]),i(u,{type:"info",plain:"",size:"default",onClick:P(E=>pe(a,c),["stop"])},{icon:o(()=>[i(k,{name:"i-ep:edit"})]),_:2},1032,["onClick"]),i(u,{type:"danger",plain:"",size:"default",onClick:P(E=>ve(a,c),["stop"])},{icon:o(()=>[i(k,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["data","filter-node-method"])),[[Re,n.value.loading]])]),_:1})]),default:o(()=>[R(_("div",sa,[i(Ve,{wrap:""},{default:o(()=>[i(u,{type:"primary",onClick:l[2]||(l[2]=a=>be())},{default:o(()=>[h(" 新增员工 ")]),_:1}),i(u,{onClick:ke},{default:o(()=>[h(" 重置密码 ")]),_:1}),i(De,{modelValue:t.value.search.active,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.search.active=a),"value-key":"",placeholder:"用户状态",style:{width:"200px"},clearable:"",filterable:""},{default:o(()=>[(r(),U(J,null,X(ne,a=>i(Ne,{key:a.label,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(D,{modelValue:t.value.search.id,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.search.id=a),placeholder:"员工ID",clearable:"",style:{width:"200px"},onKeydown:$(g,["enter"])},null,8,["modelValue"]),i(D,{modelValue:t.value.search.userName,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.search.userName=a),placeholder:"用户名",clearable:"",style:{width:"200px"},onKeydown:$(g,["enter"])},null,8,["modelValue"]),i(u,{type:"primary",onClick:g},{icon:o(()=>[i(k,{name:"i-ep:search"})]),_:1}),i(u,{onClick:Se},{icon:o(()=>[i(k,{name:"i-ep:refresh"})]),_:1})]),_:1}),i(Be,{ref_key:"userItemRef",ref:se,data:t.value.dataList,border:t.value.border,size:t.value.lineHeight,stripe:t.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:_e,onSelectionChange:l[6]||(l[6]=a=>t.value.selectionDataList=a),"row-key":"id","default-expand-all":"",onSelect:ye},{empty:o(()=>[i(xe,{image:L(He),"image-size":300},null,8,["image"])]),default:o(()=>[i(y,{type:"selection",align:"left",fixed:""}),t.value.checkList.includes("active")?(r(),d(y,{key:0,align:"left",prop:"active",label:"状态"},{default:o(a=>[i(Ee,{modelValue:a.row.active,"onUpdate:modelValue":c=>a.row.active=c,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>ge(a.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):f("",!0),t.value.checkList.includes("id")?(r(),d(y,{key:1,align:"left",width:"180",prop:"id",label:"员工ID"},{default:o(({row:a})=>[_("div",ua,[_("div",da,"ID: "+C(a.id),1),i(ze,{class:"copy",content:a.id},null,8,["content"])])]),_:1})):f("",!0),t.value.checkList.includes("userName")?(r(),d(y,{key:2,align:"left",width:"130",prop:"userName",label:"用户名"},{default:o(({row:a})=>[i(I,{class:"tableBig"},{default:o(()=>[h(C(a.userName?a.userName:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("phoneNumber")?(r(),d(y,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:o(({row:a})=>[i(I,{class:"tableBig"},{default:o(()=>[h(C(a.phoneNumber?a.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("email")?(r(),d(y,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:o(({row:a})=>[i(I,{class:"tableBig"},{default:o(()=>[h(C(a.email?a.email:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("departmentId")?(r(),d(y,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:o(({row:a})=>[i(I,{class:"tableBig"},{default:o(()=>[h(C(a.organizationalStructureName?a.organizationalStructureName:"-"),1)]),_:2},1024)]),_:1})):f("",!0),t.value.checkList.includes("positionId")?(r(),d(y,{key:6,align:"left",prop:"positionId",label:"职位"},{default:o(({row:a})=>[a.positionId?(r(),d(I,{key:0,class:"tableBig"},{default:o(()=>[(r(!0),U(J,null,X(G.value,c=>(r(),d(I,null,{default:o(()=>[a.positionId===c.id?(r(),d(I,{key:0},{default:o(()=>[h(C(c.name?c.name:"-"),1)]),_:2},1024)):f("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),d(I,{key:1,class:"tableBig"},{default:o(()=>[h("-")]),_:1}))]),_:1})):f("",!0),i(y,{label:"操作",fixed:"right",width:"200",align:"left"},{default:o(a=>[i(u,{type:"primary",size:"small",plain:"",onClick:c=>Ie(a.row)},{default:o(()=>[h(" 编辑 ")]),_:2},1032,["onClick"]),i(u,{type:"warning",size:"small",plain:"",onClick:c=>Ce(a.row)},{default:o(()=>[h(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"]),i(Ue,{"current-page":L(S).page,total:L(S).total,"page-size":L(S).size,"page-sizes":L(S).sizes,layout:L(S).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:fe,onCurrentChange:he},null,8,["current-page","total","page-size","page-sizes","layout"])],512),[[q,s.value.search.organizationalStructureId]]),R(_("div",ca,va,512),[[q,!s.value.search.organizationalStructureId]])]),_:1}),n.value.dialog.visible?(r(),d(Qe,{key:0,id:n.value.dialog.id,modelValue:n.value.dialog.visible,"onUpdate:modelValue":l[7]||(l[7]=a=>n.value.dialog.visible=a),row:n.value.row,"parent-id":n.value.dialog.parentId,tree:n.value.tree,onGetList:w},null,8,["id","modelValue","row","parent-id","tree"])):f("",!0),m.value.dialog.visible?(r(),d(We,{key:1,id:m.value.dialog.id,modelValue:m.value.dialog.visible,"onUpdate:modelValue":l[8]||(l[8]=a=>m.value.dialog.visible=a),row:m.value.row,"parent-id":m.value.dialog.parentId,name:m.value.dialog.name,tree:m.value.tree,onGetList:w},null,8,["id","modelValue","row","parent-id","name","tree"])):f("",!0),s.value.dialog.visible?(r(),d(Ye,{key:2,id:s.value.dialog.id,modelValue:s.value.dialog.visible,"onUpdate:modelValue":l[9]||(l[9]=a=>s.value.dialog.visible=a),"catalogue-id":s.value.search.organizationalStructureId,"parent-id":s.value.dialog.parentId,level:s.value.dialog.level,tree:n.value.tree,dataList:s.value.dataList,row:s.value.row,onSuccess:g},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):f("",!0),t.value.dialog.visible?(r(),d(Ze,{key:3,id:t.value.dialog.id,modelValue:t.value.dialog.visible,"onUpdate:modelValue":l[10]||(l[10]=a=>t.value.dialog.visible=a),"catalogue-id":t.value.search.catalogueId,"parent-id":t.value.dialog.parentId,level:t.value.dialog.level,tree:b.value.tree,dataList:t.value.dataList,row:t.value.row,onSuccess:g,onGetList:w},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):f("",!0),i(ea,{ref_key:"detailRef",ref:A},null,512)])])}}});typeof W=="function"&&W(Y);const xa=qe(Y,[["__scopeId","data-v-679c03cd"]]);export{xa as default};
