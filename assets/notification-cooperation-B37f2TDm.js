
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Z,az as ee,r as s,aL as te,a2 as u,a as R,i as z,b as n,t as T,h as o,f as r,w as a,g as c,j as B,c as ae,k as re,bd as C,ai as le,_ as ne,aH as oe,aI as se,y as ie}from"./index-o59bYei-.js";import{a as ce}from"./department-BdLYaUN0.js";import{u as de}from"./index-BcuPPC-7.js";import ue from"./index-lwq9WDzS.js";import"./index-Bt5AYvhc.js";import"./index-BInyJnHR.js";import"./clipboard-DIblU1dg.js";import"./configuration_site_setting-rJ7ZbvzN.js";const p=_=>(oe("data-v-7b95f363"),_=_(),se(),_),pe={class:"news p-4"},me=p(()=>n("div",{class:"type"},[n("span"),c(" 合作邀约")],-1)),ge={class:"news-content"},ve={class:"content"},fe={class:"time"},ye=p(()=>n("div",null,"您好！",-1)),_e={style:{margin:".25rem 0"}},he={key:0,class:"footer"},xe=p(()=>n("div",{style:{display:"flex","align-items":"center"}},[n("span",{style:{display:"inline-block",width:"8px",height:"8px",background:"#FF8181","border-radius":"50%","margin-right":"4px"}}),n("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式")],-1)),be={style:{display:"flex","align-items":"center"}},ke=p(()=>n("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),Te=p(()=>n("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),Ie={style:{"margin-top":"6px","margin-bottom":"0px"}},Ue={style:{display:"flex","flex-direction":"column"}},Re={style:{display:"flex","align-items":"center"}},Ce=p(()=>n("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),we=p(()=>n("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),Pe=Z({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(_,{expose:A,emit:F}){const h=ee(),I=h.currencyType,m=s();s(1);const w=s(""),P=F,U=te(),j=(l,t,i)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return i(new Error("请输入 0 到 100 之间的数字"));i()},D=s({priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:j}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}),e=s({priceRatio:null,rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:j}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),g=s(!1);s([]);const N=s(""),K={children:"children",label:"name"},L=async l=>{e.value.chargeUserId="",e.value=l,m.value=l.currencyType;const t=await ce.list({name:""});t.data&&(S.value=t.data),M()},S=s([]);s();const x=s(),H=(l,t)=>{t?(x.value.getCheckedKeys().forEach(y=>{y!==l.id&&x.value.setChecked(y,!1)}),e.value.chargeUserId=l.id,x.value.getCheckedNodes(),e.value.chargeUserName=l.name):(e.value.chargeUserId=[e.value.chargeUserId].filter(i=>i!==l.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="")),e.value.chargeUserId||(e.value.chargeUserName="")},M=async()=>{const l={id:e.value.id,type:1};await C.updateTenantAudit(l),await U.getUnreadTodo()},G=async()=>{const l={id:e.value.id,type:2};P("delSelectId"),await C.updateTenantAudit(l),await U.getUnreadTodo()},J=async()=>{N.value.validate(async l=>{if(l){if(Array.isArray(e.value.chargeUserId)&&(e.value.chargeUserId=e.value.chargeUserId[0]),e.value.receiveProjectType==1&&!e.value.chargeUserId){le.warning({message:"请选择部门",center:!0});return}if(!h.originalExchangeRate){w.value.showEdit();return}I===m.value?e.value.exchangeRate=1:I===1&&m.value===2?e.value.exchangeRate=h.originalExchangeRate:I===2&&m.value===1&&(e.value.exchangeRate=(1/h.originalExchangeRate).toFixed(2));const t={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType,receiveProjectType:e.value.receiveProjectType,exchangeRate:e.value.exchangeRate};P("delSelectId"),await C.updateTenantAudit(t),await U.getUnreadTodo()}})},O=s();function V(l){e.value.chargeUserId=l.chargeUserId,e.value.invitationType=l.invitationType,e.value.chargeUserName=l.chargeUserName}const b=s(null),v=s(null),f=(l,t)=>{t&&(l==="发送"?(b.value=t,e.value.sendProjectType=t):(v.value=t,e.value.receiveProjectType=t))},Q=()=>{b.value=null,v.value=null,e.value.sendProjectType=null,e.value.receiveProjectType=null};return A({showEdit:L}),(l,t)=>{const i=u("el-button"),y=u("el-input"),k=u("el-form-item"),E=ne,$=u("el-tooltip"),W=u("el-tree-select"),X=u("ElForm"),q=u("ElButton"),Y=u("el-dialog");return R(),z("div",pe,[me,n("div",ge,[n("div",ve,"尊贵的"+T(o(e).beInvitedName),1),n("div",fe,[ye,n("div",_e,"我是"+T(o(e).invitationName)+",诚挚邀请贵司与我们合作,实现共赢！",1),n("div",null,"我方货币类型为"+T(o(m)===1?"美元":"人民币")+"，达成合作后我方发布项目以 "+T(o(m)===1?"美元":"人民币")+" 计价，望悉知。",1)]),o(e).auditStatus===1?(R(),z("div",he,[r(i,{onClick:G},{default:a(()=>[c("拒绝合作")]),_:1}),r(i,{type:"primary",onClick:t[0]||(t[0]=d=>g.value=!0)},{default:a(()=>[c(" 同意合作 ")]),_:1})])):B("",!0)]),r(Y,{modelValue:o(g),"onUpdate:modelValue":t[9]||(t[9]=d=>re(g)?g.value=d:null),title:"合作配置",class:"hezuoDrawer",onClose:Q},{footer:a(()=>[r(q,{size:"large",onClick:t[8]||(t[8]=d=>g.value=!1)},{default:a(()=>[c(" 取消 ")]),_:1}),r(q,{type:"primary",size:"large",onClick:J},{default:a(()=>[c(" 确定 ")]),_:1})]),default:a(()=>[r(X,{ref_key:"formRef",ref:N,rules:o(D),model:o(e),"label-width":"7rem",labelPosition:"left"},{default:a(()=>[r(k,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[r(y,{modelValue:o(e).priceRatio,"onUpdate:modelValue":t[1]||(t[1]=d=>o(e).priceRatio=d),clearable:""},{append:a(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),r(k,{"label-width":"7.5rem"},{label:a(()=>[xe]),_:1}),r(k,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[n("span",be,[r($,{effect:"dark",placement:"top-start"},{content:a(()=>[ke,Te]),default:a(()=>[r(E,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:a(()=>[n("div",Ie,[r(i,{type:o(b)===1?"primary":"",size:"small",onClick:t[2]||(t[2]=d=>f("发送",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),r(i,{type:o(b)===2?"primary":"",size:"small",onClick:t[3]||(t[3]=d=>f("发送",2))},{default:a(()=>[c("手动")]),_:1},8,["type"])])]),_:1}),n("div",Ue,[r(k,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[n("span",Re,[r($,{effect:"dark",placement:"top-start"},{content:a(()=>[Ce,we]),default:a(()=>[r(E,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:a(()=>[n("div",null,[r(i,{type:o(v)===1?"primary":"",size:"small",onClick:t[4]||(t[4]=d=>f("接收",1))},{default:a(()=>[c("自动 ")]),_:1},8,["type"]),r(i,{type:o(v)===2?"primary":"",size:"small",onClick:t[5]||(t[5]=d=>f("接收",2))},{default:a(()=>[c("手动")]),_:1},8,["type"]),r(i,{type:o(v)===3?"primary":"",size:"small",onClick:t[6]||(t[6]=d=>f("接收",3))},{default:a(()=>[c("拒绝")]),_:1},8,["type"])])]),_:1}),o(e).receiveProjectType==1?(R(),ae(W,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:x,modelValue:o(e).chargeUserId,"onUpdate:modelValue":t[7]||(t[7]=d=>o(e).chargeUserId=d),data:o(S),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:K,onCheckChange:H,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):B("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),r(de,{ref_key:"userRef",ref:O,onUserData:V},null,512),r(ue,{ref_key:"exchangeRateRef",ref:w,onUserData:V},null,512)])}}}),Be=ie(Pe,[["__scopeId","data-v-7b95f363"]]);export{Be as default};
