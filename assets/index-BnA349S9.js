
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as be,r,n as _e,a as A,q as ke,o as f,b as L,f as i,w as o,y as v,g as c,s as je,i as t,e as U,aJ as D,j as h,F as J,t as q,A as Ce,E as Q,_ as Ve,aH as Te,aI as Ue,L as we}from"./index-Bn8qCMs0.js";import{a as H,_ as Ee}from"./jiantou-BFtAGxsy.js";import{o as w,s as Re}from"./apiLoading-B-0f9Z2R.js";import{a as Y}from"./projectManagement-Bt348miG.js";import{a as G}from"./user_cooperation-C_LQGnbg.js";import{a as W}from"./survey_vip_department-CdBn_fQu.js";import{U as Ne}from"./user_supplier-1Kv_vl3k.js";import{u as xe}from"./survey_vipGroup-CbHsFh2L.js";import Ke from"./index-C4SSN2BB.js";import Pe from"./index-U5lMl1gG.js";import Oe from"./index-C2xo6-Vz.js";const Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAmtJREFUOE+dlTtIXEEUhr9ZFxWfaOEDg6/CxiZWBkEEsbARIqwoJLLXLoEISZdyy3QJRIidd8FANAG1sFJEsDCIQrRRRMyVbCEq4qsQXXficXa9d/eqwUyz7Jkz3/xz5sx/FXcMHYkEqa3tBZ4Dz4CKZFrsOvYLpSZJJMbUwMB55nKVGdC2/QL4ADy5azNPbBel3qpweMybdwtMqvoIvPkHKHN6GMcZVJFIXCZcoG1/AV49EpZKH1KWNXgL1NFoL1p/S4OVlUFLCxQXw8EBrK5CTEp473ipLOur0iMjuSj121N4s6K7G4qK3NUXFzA+DldX9xFjOE6d0tFoGK3ttKycHOjr8y+cnjZqH1KpbXsi2R5uWnk5dHb6ly0twfr6Q8AfStu2HLc2LSs7G7q6oKDADctRp6bg9PQhYEyAl0DQl1VZCR0dEAjA4SGsrEBFhdnk5AQ2NuDc19fx+4HBIPT0mEtYXITWVojHIZEwm8jv7CwcHXm13AD/pL2KwkJoaIDqanPLoqymBkpLYX7eHFkurbERsrJgZsYLdAT4HQjdRkMhyM93k+bmoL0dtrZgbw8uL0FaqK3NAEdHvcBJAcrbdaP9/eZIqbGwAM3NsL8P29umbURtU5PJmJAmSQ6lLJV8w3LTxgykZUpKIC8PcnMNQJTIsc/OoKoKdnagvh6Wl2FzM4XbReu6m7fsU3lXY0hdpW5S1+NjWFszil11feI8XnP4/B9Ok8INK8t6LX8y7Uugj3WcIRznnc++UlslneeTzyz8ZRDreS8O453yOfZNTcWBAgGxNPkEPPX06S7w8zo2ieOMpVR5gX8BZ0fYI9liOMMAAAAASUVORK5CYII=",De="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAoBJREFUOE+dlU1IVFEYhp/TDJYiCEYU0VRGiYugSIKgqJsQgVEMEU0xA4UWGCUUREQgTbioRVCkkBtNS4f8CSdq1cImKHCX/aCrspxZTAitJCPHTp577u+MU9i3uZzvO+c97/dz3itYxIy4DBIigiCMZBewxtwmyCAZQ5Bkiv5UXPzMPy7yHUanjAK3EKxb7DKPLwtcTDWIfu8+B9BktZ47wIV/APnDkg7SNKfiIqeTsMzolPcRNC0JzN3cnmoQzQ6g0SUjwGPlKAnA2VqoLIWhcZiY9l9RvRIiW2H6B/S8hVmTFyCJpRpFnzAeyBVIJu3CN+3UB5TN/IJwAualXgcEDByHyjK9Hp6Ae6MOYIY0VcLokqeAbptHyz6o2+Syqn/ksigNwrMoBJbp+MhnaH3lyUASE0anHDbHwzKV0s0DULEcuseg950/5dg2aNyh2V95UVCSIcVQpbvRe0ylpmrp1CevUyo2/9sthROWZBTDOQRB27m6HG7sh1VlkPgAT8b9aPVbNEPVlOsv4duML+VcAeDl3XCoWm9SLA73uUwVM1VD9S1Sw5xKOQ3uq2itgz0b3FvPPIVP3/U6VAEPj7qx11+hZcSXwRcFOAgcs935gLNzkHivO3ukRs+nbQWAkqRKOYqgtxjg+edwcLMGHPgIPX9neFpYyjJpi0E+w5ODkLUKX16ia1iEYZYpqsy37GUZroHatVZTJNx+o2dOmWrGtb36xSgby/qm4IRSHlccumTbkpXGpirpSDWKc2rpl68Qbf+hOO1McalAvuzLLOW566i0byo8C0kGuKoUxrulQLHNmmoFiizIfXhB7rcjrTkVKJUeRZIkbf4CbPFyMP8AN7LhTtHVZc8AAAAASUVORK5CYII=",j=E=>(Te("data-v-f96d6cf9"),E=E(),Ue(),E),He=j(()=>v("span",{class:"icon-class"},[v("img",{src:Be,alt:"",style:{"margin-right":"0.25rem"}}),c(" 供应商")],-1)),Me={key:0,class:"prefix-class"},Xe=j(()=>v("img",{src:H,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ze={key:1},Fe=j(()=>v("span",{class:"icon-class"},[v("img",{src:Ee,alt:"",style:{"margin-right":"0.25rem"}}),c(" 调查站")],-1)),ze={key:0,class:"prefix-class"},Je=j(()=>v("img",{src:H,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),qe={key:1},Qe=j(()=>v("span",{class:"icon-class"},[v("img",{src:De,alt:"",style:{"margin-right":"0.25rem"}}),c(" 合作商")],-1)),Ye={key:0,class:"prefix-class"},Ge=j(()=>v("img",{src:H,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),We={key:1},$e={style:{flex:"auto"}},el=be({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(E,{expose:$,emit:ee}){const M=Ne();xe();const le=ee,R=r(!1),C=r(!1),K=r(),_=r(),k=r([]),te={children:"children",label:"name"};r([]);const e=r({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),g=r({projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),m=r({projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),p=r({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),ae=r({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]}),P=r([]),N=r();async function oe(a,l){if(e.value.list=[{...a}],l==="reassign"){e.value.title="重新分配";const y=await w(Y.getProjectAllocation({projectId:a.projectId}));e.value.form.projectId=a.projectId;const{getProjectAllocationInfoList:b}=y.data;b.forEach(n=>{n.allocationType===2?m.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet}:n.allocationType===3?p.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet}:n.allocationType===4&&(g.value={allocationType:n.allocationType,projectId:n.projectId,groupSupplierIdList:n.groupSupplierIdSet},N.value=n.groupSupplierIdSet)})}else e.value.title="分配",e.value.form.projectId=a.projectId,g.value.projectId=a.projectId,m.value.projectId=a.projectId,p.value.projectId=a.projectId;e.value.tenantSupplierList=await w(M.getTenantSupplierList(a.projectId)),e.value.tenantSupplierList.length==m.value.groupSupplierIdList.length?e.value.selectAll.supplier=!0:e.value.selectAll.supplier=!1;const d=await W.list({name:""});e.value.departmentList=d.data;const S=JSON.parse(JSON.stringify(d.data));P.value=X(S),P.value.length==p.value.groupSupplierIdList.length?e.value.selectAll.member=!0:e.value.selectAll.member=!1;const u=await w(G.getAllocationBindList({projectId:a.projectId}));k.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(k.value=e.value.form.groupSupplierIdList),e.value.tenantList=u.data.allocationBindInfoList,e.value.tenantList.length==g.value.groupSupplierIdList.length?e.value.selectAll.tenant=!0:e.value.selectAll.tenant=!1,C.value=!0}const X=a=>a.reduce((l,d)=>{const{children:S,...u}=d;return l.push(u),d.children&&d.children.length>0&&(l=l.concat(X(d.children))),l},[]);function se(){g.value.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(a=>{g.value.groupSupplierIdList.push(a.beInvitationTenantId)})}function ie(){m.value.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(a=>{m.value.groupSupplierIdList.push(a.tenantSupplierId)})}const ne=()=>{e.value.tenantSupplierList.length==m.value.groupSupplierIdList.length?e.value.selectAll.supplier=!0:e.value.selectAll.supplier=!1},re=()=>{e.value.tenantList.length==g.value.groupSupplierIdList.length?e.value.selectAll.tenant=!0:e.value.selectAll.tenant=!1},pe=()=>{p.value.groupSupplierIdList=[],e.value.departmentList.forEach(a=>{Z(a)}),_.value.setCheckedKeys(p.value.groupSupplierIdList)};function Z(a){p.value.groupSupplierIdList.push(a.id),a.children&&a.children.length&&a.children.forEach(l=>{Z(l)})}function ue(){p.value.groupSupplierIdList=[],e.value.selectAll.member?(pe(),_.value.setCheckedKeys(p.value.groupSupplierIdList)):(e.value.selectAll.member=!1,p.value.groupSupplierIdList=[],_.value.setCheckedKeys([]))}const de=(a,l)=>{l?k.value.includes(a.id)||k.value.push(a.id):k.value=k.value.filter(y=>y!==a.id);const d=_.value.getCheckedKeys(),S=_.value.getHalfCheckedKeys(),u=[...d,...S];p.value.groupSupplierIdList=u,P.value.length==u.length?e.value.selectAll.member=!0:e.value.selectAll.member=!1},V=r(!1),T=r(!1),ce=()=>{T.value=!T.value,T.value?V.value=!0:V.value=!1},fe=()=>{Object.assign(g.value,{projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),Object.assign(m.value,{projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),Object.assign(p.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.tenant=!1,e.value.selectAll.supplier=!1,e.value.selectAll.member=!1};function O(){K.value.resetFields(),fe(),C.value=!1,V.value=!1,T.value=null}function ge(){K.value.validate(async a=>{if(a)try{R.value=!0;let l={addProjectAllocationInfoList:[]};if(g.value.groupSupplierIdList.length&&(g.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(g.value)),m.value.groupSupplierIdList.length&&(m.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(m.value)),p.value.groupSupplierIdList.length&&(p.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(p.value)),e.value.title!=="分配")l.addProjectAllocationInfoList.length||(V.value=!0),l.addProjectAllocationInfoList.map(u=>{u.projectId||(u.projectId=e.value.form.projectId),u.allocationType===4&&(u.deleteSet=[],N.value&&N.value.length&&N.value.filter(y=>{u.groupSupplierIdList.map(b=>{y!==b&&u.deleteSet.push(y)})}))});else if(!l.addProjectAllocationInfoList.length){Q.warning({message:"至少选择一个分配目标",center:!0});return}let d="分配成功";V.value&&(d="取消分配成功",l={addProjectAllocationInfoList:[{projectId:e.value.form.projectId,allocationType:5,groupSupplierIdList:[],deleteSet:[]}]});const{status:S}=await Re(Y.allocation(l));R.value=!1,S===1&&Q.success({message:d,center:!0}),O(),le("fetch-data")}catch{}finally{R.value=!1}})}r();const I=r({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",isClick:!1},row:"",loading:!1}),F=r(),me=r(),B=(a,l)=>{a=="供应商"?F.value.showEdit():a=="调查站"&&(I.value.currentData=l,I.value.dialog.parentId="",I.value.dialog.id="",I.value.dialog.visible=!0)},ve=async()=>{e.value.tenantSupplierList=await w(M.getTenantSupplierList(e.value.form.projectId))},Ie=async()=>{const a=await W.list({name:""});e.value.departmentList=a.data},Ae=async()=>{const a=await w(G.getAllocationBindList({projectId:e.value.form.projectId}));e.value.tenantList=a.data.allocationBindInfoList};return _e(async()=>{}),$({showEdit:oe}),(a,l)=>{const d=A("el-table-column"),S=A("el-table"),u=A("el-checkbox"),y=A("el-option"),b=Ve,n=A("el-button"),z=A("el-select"),x=A("el-form-item"),ye=A("el-tree-select"),Le=A("el-form"),Se=A("el-dialog"),he=ke("loading");return f(),L("div",null,[i(Se,{modelValue:t(C),"onUpdate:modelValue":l[10]||(l[10]=s=>Ce(C)?C.value=s:null),title:t(e).title,width:"700","before-close":O},{footer:o(()=>[v("div",$e,[i(n,{onClick:O},{default:o(()=>[c(" 取消 ")]),_:1}),i(n,{type:"primary",onClick:ge},{default:o(()=>[c(" 确定 ")]),_:1})])]),default:o(()=>[je((f(),U(S,{data:t(e).list,"row-key":"id"},{default:o(()=>[i(d,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),i(d,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),i(d,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[he,t(R)]]),i(Le,{ref_key:"formRef",ref:K,"label-width":"90px",rules:t(ae),model:t(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:o(()=>[i(x,{style:{"margin-top":"1rem"}},{label:o(()=>[He]),default:o(()=>[i(z,{modelValue:t(m).groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=s=>t(m).groupSupplierIdList=s),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:"",onChange:ne},D({prefix:o(()=>[t(e).tenantSupplierList.length==0?(f(),L("span",Me,[c(" 请先维护供应商数据 "),Xe])):h("",!0),t(m).groupSupplierIdList.length==0&&t(e).tenantSupplierList.length!=0?(f(),L("span",Ze,"请先选择供应商数据")):h("",!0)]),empty:o(()=>[v("div",null,[i(n,{type:"primary",link:"",class:"buttonClass",size:"small",onClick:l[1]||(l[1]=s=>B("供应商"))},{default:o(()=>[c(" 快捷新增 "),i(b,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:"0.125rem",margin:"0 0.125rem"}})]),_:1})])]),default:o(()=>[(f(!0),L(J,null,q(t(e).tenantSupplierList,s=>(f(),U(y,{label:s.supplierAccord,key:s.supplierAccord,value:s.tenantSupplierId},null,8,["label","value"]))),128))]),_:2},[t(e).tenantSupplierList.length?{name:"header",fn:o(()=>[i(u,{modelValue:t(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=s=>t(e).selectAll.supplier=s),onChange:ie,style:{display:"flex",height:"unset"}},{default:o(()=>[c("全选")]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),i(x,null,{label:o(()=>[Fe]),default:o(()=>[i(ye,{ref_key:"treeRef",ref:_,modelValue:t(p).groupSupplierIdList,"onUpdate:modelValue":l[5]||(l[5]=s=>t(p).groupSupplierIdList=s),data:t(e).departmentList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:te,onCheckChange:de,"check-strictly":!0,"check-on-click-node":!0,multiple:!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},D({prefix:o(()=>[t(e).departmentList.length==0?(f(),L("span",ze,[c(" 请先维护调查站数据 "),Je])):h("",!0),!t(p).groupSupplierIdList.length&&t(e).departmentList.length!=0?(f(),L("span",qe,"请先选择调查站数据")):h("",!0)]),empty:o(()=>[v("div",null,[i(n,{type:"primary",link:"",class:"buttonClass",size:"small",onClick:l[4]||(l[4]=s=>B("调查站"))},{default:o(()=>[c(" 快捷新增 "),i(b,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:"0.125rem",margin:"0 0.125rem"}})]),_:1})])]),_:2},[t(e).departmentList.length?{name:"header",fn:o(()=>[i(u,{modelValue:t(e).selectAll.member,"onUpdate:modelValue":l[3]||(l[3]=s=>t(e).selectAll.member=s),onChange:ue,style:{display:"flex",height:"unset"}},{default:o(()=>[c("全选")]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","data"])]),_:1}),i(x,null,{label:o(()=>[Qe]),default:o(()=>[i(z,{modelValue:t(g).groupSupplierIdList,"onUpdate:modelValue":l[8]||(l[8]=s=>t(g).groupSupplierIdList=s),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:"",onChange:re},D({prefix:o(()=>[t(e).tenantList.length==0?(f(),L("span",Ye,[c(" 请先维护合作商数据 "),Ge])):h("",!0),t(g).groupSupplierIdList.length==0&&t(e).tenantList.length!=0?(f(),L("span",We,"请先选择合作商数据")):h("",!0)]),empty:o(()=>[v("div",null,[i(n,{type:"primary",link:"",class:"buttonClass",size:"small",onClick:l[7]||(l[7]=s=>B("合作商"))},{default:o(()=>[c(" 快捷新增 "),i(b,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:"0.125rem",margin:"0 0.125rem"}})]),_:1})])]),default:o(()=>[(f(!0),L(J,null,q(t(e).tenantList,s=>(f(),U(y,{label:s.beInvitationTenantName,key:s.beInvitationTenantName,value:s.beInvitationTenantId},null,8,["label","value"]))),128))]),_:2},[t(e).tenantList.length?{name:"header",fn:o(()=>[i(u,{modelValue:t(e).selectAll.tenant,"onUpdate:modelValue":l[6]||(l[6]=s=>t(e).selectAll.tenant=s),onChange:se,style:{display:"flex",height:"unset"}},{default:o(()=>[c("全选")]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),t(e).title=="重新分配"?(f(),U(x,{key:0},{label:o(()=>[i(n,{type:t(T)?"primary":"",onClick:l[9]||(l[9]=s=>ce()),style:{"border-radius":"1.875rem"}},{default:o(()=>[c(" 取消分配 ")]),_:1},8,["type"])]),_:1})):h("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"]),i(Pe,{ref_key:"editRef",ref:F,onFetchData:ve},null,512),t(I).dialog.visible?(f(),U(Ke,{key:0,id:t(I).dialog.id,modelValue:t(I).dialog.visible,"onUpdate:modelValue":l[11]||(l[11]=s=>t(I).dialog.visible=s),row:t(I).row,"parent-id":t(I).dialog.parentId,tree:t(I).tree,isClick:t(I).dialog.isClick,onGetList:Ie},null,8,["id","modelValue","row","parent-id","tree","isClick"])):h("",!0),i(Oe,{ref_key:"tenantRef",ref:me,onFetchData:Ae},null,512)])}}}),ll=we(el,[["__scopeId","data-v-f96d6cf9"]]),fl=Object.freeze(Object.defineProperty({__proto__:null,default:ll},Symbol.toStringTag,{value:"Module"}));export{Be as _,ll as a,De as b,fl as i};
