
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{x as C,d as _e,r as d,a1 as Ve,al as we,k as Ee,a as i,p as xe,q as Pe,i as a,o as p,b as U,f as o,w as s,S as he,I as S,bh as Ue,s as k,F,t as R,e as b,j as T,g as I,E as y,a0 as Ie,aJ as ke,aK as Ne,R as Ce,an as G}from"./index-C6aesvjM.js";const J={list:()=>C.post("user/getUserInfo"),edit:v=>C.post("user/update",v),uploadAvatar:v=>C.post("user/uploadAvatar",v)},B=v=>(ke("data-v-a297fa23"),v=v(),Ne(),v),Se=B(()=>k("h2",null,"个人信息",-1)),Fe=B(()=>k("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Re=["src"],Te=B(()=>k("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),Z=_e({name:"personalSetting",__name:"setting",emits:["success"],setup(v,{expose:H,emit:K}){const w=d(!1),Y=Ve(),q=K,Q="http://47.96.98.102:9100user/uploadAvatar",W=we(),z=d([]),f=d(!1),j=d(!1),_=d(!1),X=[{label:"公司",value:"company"}],ee=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],E=d(),x=d(),e=d({type:"company",name:"",phone:"",email:"",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),m=d({oldPassword:"",password:"",confirmPassword:""}),le=d({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,l,u)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?u():u(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,l,u)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?u():u(new Error("请输入合法手机号"))},trigger:"blur"}]}),ae=d({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(r,l,u)=>{l===m.value.oldPassword?u(new Error("新密码不能与旧密码一致")):u()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(r,l,u)=>{l!==m.value.password?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}]}),O=r=>{(r!==e.value.phone||r!==e.value.email)&&(j.value=!0)};function te(){E.value&&E.value.validate(async r=>{if(r){if(f.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,j.value||(delete e.value.phone,delete e.value.email),(await J.edit(e.value)).status===-1)return y.warning({message:"修改失败",center:!0});q("success"),f.value=!1,y.success({message:"修改成功",center:!0}),V()}})}const oe=Y.token,se=d({Token:oe}),A=d(""),P=d(!1),g=d([]),re=async()=>{w.value=!1,y.success({message:"删除成功",center:!0})},ne=(r,l)=>{console.log("上传成功",r,l),r.status===-1?(Ie.error(r.error,{zIndex:2e3}),g.value=g.value.filter(u=>u.name!==l.name)):w.value=!0},ue=async()=>{y.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},de=r=>{A.value=r.url,P.value=!0},ie=()=>{x.value&&x.value.validate(async r=>{if(r){if(f.value=!0,delete m.value.confirmPassword,(await J.edit(m.value)).status===-1)return y.warning({message:"修改失败",center:!0});q("success"),f.value=!1,y.success({message:"修改成功",center:!0}),V()}})};async function me(r){e.value=r,g.value.push({name:"file",url:e.value.avatar}),e.value.avatar!==""&&(w.value=!0),_.value=!0}function V(){E.value.resetFields(),x.value.resetFields(),Object.assign(e,{}),g.value=[],Object.assign(m,{}),_.value=!1}return Ee(async()=>{f.value=!0,z.value=await W.getCountry(),f.value=!1}),H({showEdit:me}),(r,l)=>{const u=i("el-icon"),N=i("el-upload"),pe=i("el-dialog"),n=i("ElFormItem"),D=i("el-option"),L=i("el-select"),c=i("ElInput"),ce=i("ElOption"),ve=i("ElSelect"),fe=i("el-switch"),h=i("ElButton"),M=i("ElForm"),$=i("ElTabPane"),ge=i("ElTabs"),be=i("el-drawer"),ye=xe("loading");return Pe((p(),U("div",null,[o(be,{modelValue:a(_),"onUpdate:modelValue":l[15]||(l[15]=t=>S(_)?_.value=t:null),title:"修改用户信息",direction:"rtl","before-close":V,style:{height:"100%"},size:"40%"},{default:s(()=>[o(ge,{"tab-position":"left"},{default:s(()=>[o($,{label:"个人信息",class:"basic"},{default:s(()=>[Se,o(M,{ref_key:"userFormRef",ref:E,model:a(e),rules:a(le),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:s(()=>[o(n,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[o(N,{class:he({hide_box:a(w)}),"file-list":a(g),"onUpdate:fileList":l[0]||(l[0]=t=>S(g)?g.value=t:null),headers:a(se),action:Q,"list-type":"picture-card",limit:1,"on-preview":de,"on-remove":re,"on-success":ne,"on-exceed":ue},{tip:s(()=>[Fe]),default:s(()=>[o(u,{class:"el-icon--upload"},{default:s(()=>[o(a(Ue))]),_:1})]),_:1},8,["class","file-list","headers"]),o(pe,{modelValue:a(P),"onUpdate:modelValue":l[1]||(l[1]=t=>S(P)?P.value=t:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[k("img",{"w-full":"",src:a(A),alt:"Preview Image"},null,8,Re)]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"账户类型"},{default:s(()=>[o(L,{modelValue:a(e).type,"onUpdate:modelValue":l[2]||(l[2]=t=>a(e).type=t),"value-key":"",placeholder:"账户类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(p(),U(F,null,R(X,t=>o(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"用户名"},{default:s(()=>[o(c,{disabled:"",modelValue:a(e).name,"onUpdate:modelValue":l[3]||(l[3]=t=>a(e).name=t),placeholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),o(n,{label:"国家"},{default:s(()=>[o(ve,{modelValue:a(e).country,"onUpdate:modelValue":l[4]||(l[4]=t=>a(e).country=t),disabled:""},{default:s(()=>[(p(!0),U(F,null,R(a(z),t=>(p(),b(ce,{label:t.chineseName,value:t.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(n,{prop:"",label:"货币类型"},{default:s(()=>[o(L,{modelValue:a(e).currencyType,"onUpdate:modelValue":l[5]||(l[5]=t=>a(e).currencyType=t),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(p(),U(F,null,R(ee,t=>o(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(e).type==="company"?(p(),b(n,{key:0,label:"公司名称"},{default:s(()=>[o(c,{modelValue:a(e).companyName,"onUpdate:modelValue":l[6]||(l[6]=t=>a(e).companyName=t),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):T("",!0),a(e).type==="company"?(p(),b(n,{key:1,label:"公司税号"},{default:s(()=>[o(c,{modelValue:a(e).taxId,"onUpdate:modelValue":l[7]||(l[7]=t=>a(e).taxId=t),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):T("",!0),a(e).type==="company"?(p(),b(n,{key:2,label:"法人姓名"},{default:s(()=>[o(c,{modelValue:a(e).legalPersonName,"onUpdate:modelValue":l[8]||(l[8]=t=>a(e).legalPersonName=t),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):T("",!0),a(e).country==="CN"?(p(),b(n,{key:3,prop:"phone",label:"手机号码"},{default:s(()=>[o(c,{modelValue:a(e).phone,"onUpdate:modelValue":l[9]||(l[9]=t=>a(e).phone=t),placeholder:"请输入你的手机号码",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})):(p(),b(n,{key:4,prop:"email",label:"电子邮箱"},{default:s(()=>[o(c,{modelValue:a(e).email,"onUpdate:modelValue":l[10]||(l[10]=t=>a(e).email=t),placeholder:"请输入你的电子邮箱",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})),o(n,{prop:"isInvitation",label:"合作邀约"},{default:s(()=>[o(fe,{modelValue:a(e).isInvitation,"onUpdate:modelValue":l[11]||(l[11]=t=>a(e).isInvitation=t),"inline-prompt":"","active-text":"启用","inactive-text":"禁用","active-value":2,"inactive-value":1},null,8,["modelValue"])]),_:1}),o(n,null,{default:s(()=>[o(h,{onClick:te,type:"primary"},{default:s(()=>[I(" 保存 ")]),_:1}),o(h,{onClick:V,type:"primary"},{default:s(()=>[I(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),o($,{label:"账户管理",class:"security"},{default:s(()=>[Te,o(M,{ref_key:"accountFormRef",ref:x,model:a(m),rules:a(ae),"label-width":"120px","label-suffix":"："},{default:s(()=>[o(n,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[o(c,{modelValue:a(m).oldPassword,"onUpdate:modelValue":l[12]||(l[12]=t=>a(m).oldPassword=t),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),o(n,{prop:"password",label:"新密码"},{default:s(()=>[o(c,{modelValue:a(m).password,"onUpdate:modelValue":l[13]||(l[13]=t=>a(m).password=t),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(n,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[o(c,{modelValue:a(m).confirmPassword,"onUpdate:modelValue":l[14]||(l[14]=t=>a(m).confirmPassword=t),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(n,null,{default:s(()=>[o(h,{onClick:ie,type:"primary"},{default:s(()=>[I(" 保存 ")]),_:1}),o(h,{onClick:V,type:"primary"},{default:s(()=>[I(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[ye,a(f)]])}}});typeof G=="function"&&G(Z);const Be=Ce(Z,[["__scopeId","data-v-a297fa23"]]),Oe=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{J as a,Oe as b,Be as s};
