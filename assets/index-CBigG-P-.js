
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as P}from"./group_team-HFpWA8pQ.js";import{a as ue}from"./department-CaIjgMtb.js";import{u as de}from"./department-DW9JldVy.js";import{u as ie}from"./configuration_manager-CNoUCYsk.js";import{u as ce}from"./position_manage-rcAy18Vj.js";import{d as me,aN as fe,r as u,k as pe,a as f,p as _e,q as ve,o as d,b as k,f as n,w as e,s as D,g as _,e as p,H as g,F as x,t as S,j as V,E as A,aJ as he,aK as ge,R as be}from"./index-D7ktWcYH.js";import"./position_manage-CqWNE9ak.js";const Ie=y=>(he("data-v-1950c7bc"),y=y(),ge(),y),ke=Ie(()=>D("div",{class:"card-header"},[D("span",null,"组成员")],-1)),ye={style:{flex:"auto"}},we=me({name:"Edit",__name:"index",emits:["success"],setup(y,{expose:H,emit:$}){fe();const R=u(),J=u(),C=ce(),M=u(),O=de(),b=u(),q=ie(),E=u([]),z=$,T=u(""),G=u(),K=u(!1);u([]);const L=u(),I=u(!1),v=u([]),U=u([]),N=u();u({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{chineseName:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});const c=u({groupId:null,userInfo:[],menuId:[]}),Q={children:"children",label:"name"},W=u({commission:[{validator:(a,s,o)=>{/^[0-9]*[.]?[0-9]+$/.test(s)?o():o(new Error("请输入有效的数字或小数"))},trigger:"blur"}]});async function X(a){T.value=a!=null&&a.id?"编辑":"新增";const s=JSON.parse(a);c.value.groupId=s.id;const o={page:1,limit:10,groupId:s.id},i=await P.list(o);i!=null&&i.data.data&&(N.value=i==null?void 0:i.data.data[0].departmentId,i.data.data.forEach(t=>{var h,w;(w=(h=c.value)==null?void 0:h.menuId)==null||w.push(t.id),v.value.push(t)}));const r=await ue.createEvery();b.value=r.data.result,b.value=b.value.filter(t=>t.id===N.value),I.value=!0}pe(async()=>{M.value=await(C==null?void 0:C.getPositionManage())||[],b.value=await O.getDepartment(),E.value=await q.getStaff(),G.value=new Date});function j(a,s){const o=a.findIndex(i=>i.memberId===s);o!==-1&&a.splice(o,1)}function B(a,s){a.some(o=>o.id===s.id)||a.push(s)}function Y(a){v.value=v.value.filter(o=>o.id!==a.id),R.value.getNode(a.id).checked?a.children&&a.children.length?a.children.forEach(o=>B(v.value,o)):B(v.value,a):a.children&&a.children.length?a.children.forEach(o=>j(v.value,o.id)):j(v.value,a.id)}function Z(){return new Promise(a=>{L.value&&L.value.validate(s=>{if(s){c.value.userInfo=[],delete c.value.menuId;let o=0;U.value.forEach(r=>{r.commission&&(o+=r.commission);let t={userId:r.memberId,commission:r.commission};c.value.userInfo.push(t)}),v.value.forEach(r=>{r.commission&&(o+=r.commission);let t;r.memberId?t={userId:r.memberId,commission:r.commission}:t={userId:r.id,commission:r.commission},c.value.userInfo.push(t)});const i=new Set;if(c.value.userInfo=c.value.userInfo.filter(r=>{const{userId:t}=r;return i.has(t)?!1:(i.add(t),!0)}),o>100){A.warning({message:"提成比例不能超过100",center:!0});return}P.edit(c.value).then(()=>{A.success({message:"操作成功",center:!0}),z("success"),I.value=!1,a()})}})})}const ee=()=>{Object.assign(c.value,{groupId:null,userInfo:[],menuId:[]}),U.value=[],v.value=[]};return H({showEdit:X}),(a,s)=>{const o=f("el-input"),i=f("el-tree"),r=f("el-col"),t=f("el-text"),h=f("el-table-column"),w=f("el-form-item"),te=f("el-form"),ae=f("el-empty"),le=f("el-table"),oe=f("el-row"),ne=f("el-card"),F=f("el-button"),se=f("el-drawer"),re=_e("loading");return ve((d(),k("div",null,[n(se,{modelValue:I.value,"onUpdate:modelValue":s[2]||(s[2]=l=>I.value=l),title:T.value,onClose:ee,size:"60%"},{footer:e(()=>[D("div",ye,[n(F,{type:"",onClick:s[1]||(s[1]=l=>I.value=!1)},{default:e(()=>[_(" 取消 ")]),_:1}),n(F,{type:"primary",onClick:Z},{default:e(()=>[_(" 确定 ")]),_:1})])]),default:e(()=>[n(ne,{class:"box-card"},{header:e(()=>[ke]),default:e(()=>[n(oe,{gutter:20},{default:e(()=>[n(r,{class:"leftData",span:8},{default:e(()=>[n(o,{modelValue:c.value.invoiceAmount,"onUpdate:modelValue":s[0]||(s[0]=l=>c.value.invoiceAmount=l),placeholder:"可输入关键字查找",clearable:""},null,8,["modelValue"]),n(i,{style:{"max-width":"37.5rem","min-height":"20.125rem","margin-top":"20px"},data:b.value,ref_key:"treeRef",ref:R,"show-checkbox":"","node-key":"id","default-checked-keys":c.value.menuId,"default-expanded-keys":c.value.menuId,"default-expand-all":"",props:Q,onCheck:Y},null,8,["data","default-checked-keys","default-expanded-keys"])]),_:1}),n(r,{span:16},{default:e(()=>[n(le,{ref_key:"tableRef",ref:J,data:v.value,border:""},{empty:e(()=>[n(ae,{description:"暂无数据"})]),default:e(()=>[n(h,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"},{default:e(({row:l})=>[l.id?(d(),p(t,{key:0},{default:e(()=>[_(g(l.id),1)]),_:2},1024)):(d(),p(t,{key:1},{default:e(()=>[_(g(l.id),1)]),_:2},1024))]),_:1}),n(h,{align:"center","show-overflow-tooltip":"",prop:"userName",label:"用户名"},{default:e(({row:l})=>[l.id?(d(!0),k(x,{key:0},S(E.value,m=>(d(),p(t,null,{default:e(()=>[l.id===m.id?(d(),p(t,{key:0},{default:e(()=>[_(g(m.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(d(),p(t,{key:1},{default:e(()=>[_(g(l.userName?l.userName:"-"),1)]),_:2},1024))]),_:1}),n(h,{align:"center","show-overflow-tooltip":"",prop:"name",label:"姓名"},{default:e(({row:l})=>[l.id?(d(!0),k(x,{key:0},S(E.value,m=>(d(),p(t,null,{default:e(()=>[l.id===m.id?(d(),p(t,{key:0},{default:e(()=>[_(g(m.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256)):(d(),p(t,{key:1},{default:e(()=>[_(g(l.name),1)]),_:2},1024))]),_:1}),n(h,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"职位"},{default:e(({row:l})=>[(d(!0),k(x,null,S(M.value,m=>(d(),p(t,null,{default:e(()=>[l.positionId===m.id?(d(),p(t,{key:0},{default:e(()=>[_(g(m.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256))]),_:1}),n(h,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:l})=>[(d(!0),k(x,null,S(b.value,m=>(d(),p(t,null,{default:e(()=>[N.value===m.id?(d(),p(t,{key:0},{default:e(()=>[_(g(m.name),1)]),_:2},1024)):V("",!0)]),_:2},1024))),256))]),_:1}),n(h,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:l})=>[n(te,{model:l,ref_key:"formRef",ref:L,rules:W.value},{default:e(()=>[n(w,{prop:"commission"},{default:e(()=>[n(o,{modelValue:l.commission,"onUpdate:modelValue":m=>l.commission=m,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[_("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])),[[re,K.value]])}}}),De=be(we,[["__scopeId","data-v-1950c7bc"]]);export{De as default};
