
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Qe,am as Ge,r,aO as We,a5 as Xe,c as Ze,l as et,b as c,q as tt,s as j,o as s,e as S,g as n,w as t,az as le,F as w,v as L,f as i,aq as x,h as u,H as _,j as C,aN as lt,t as m,k as p,S as P,E as me,N as nt,aQ as at,aR as ot,bc as st,ap as it,aI as ut,aJ as rt,R as ct}from"./index-C-pApz5G.js";import{_ as dt}from"./index-CThLbME_.js";import{_ as pt}from"./index.vue_vue_type_style_index_0_lang-DeHgwZlq.js";import{_ as mt}from"./index.vue_vue_type_script_setup_true_lang-B2tbmVY0.js";import{_ as ft}from"./index.vue_vue_type_script_setup_true_lang-RfxsqMtx.js";import _t from"./index-FiGSkK5o.js";import{_ as vt}from"./index.vue_vue_type_script_setup_true_lang-CwkmZx1O.js";import yt from"./index-Bji3na0O.js";import gt from"./index-dCnIXJqa.js";import{u as bt}from"./user_customer-USArxPUt.js";import{u as kt}from"./configuration_manager-B5Pn0zaZ.js";import{a as ht}from"./project_settlement-DDtNzYzc.js";import"./index-D-ZPZJfk.js";import"./user_customer-BnRsxA1k.js";const Ct=R=>(ut("data-v-21280c87"),R=R(),rt(),R),It=Ct(()=>m("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),St={class:"copyId"},jt={class:"id oneLine tableSmall"},Dt={class:"oneLine tableBig"},wt={class:"oneLine"},$t={class:"oneLine",style:{width:"calc(100% - 20px)"}},zt={class:"tableBig"},Nt={key:0,class:"oneLine"},Vt=["src"],Et={class:"tableBig"},Tt={class:"flex-c tableBig"},Lt={class:"oneLine",style:{width:"calc(100% - 20px)"}},xt={class:"flex-c tableBig"},Rt={class:"oneLine",style:{width:"calc(100% - 40px)"}},Ut={class:"flex-c tableBig"},Bt={class:"oneLine",style:{width:"calc(100% - 20px)"}},Pt=Qe({name:"settlement",__name:"list",setup(R){const ne=Ge(),O=r(),fe=bt(),ae=r(),_e=kt(),ve=r(),A=r([]),{pagination:D,onSizeChange:ye,onCurrentChange:ge}=We(),be=r(""),$=r(!0),F=r(),oe=r(),se=r(),H=r(),ie=r(),M=r(!1),J=r(!1),v=r([]);r(!1);const Y=r("default"),q=r(!1),z=r([]),K=r([{label:"项目ID",prop:"projectId",sortable:!0,checked:!0},{label:"项目名称",prop:"projectName",sortable:!0,checked:!0},{label:"客户简称/标识",prop:"customerName",sortable:!0,checked:!0},{label:"原价",prop:"projectAmount",sortable:!0,checked:!0},{label:"所属国家",prop:"countryId",sortable:!0,checked:!0},{label:"系统/审核完成数",prop:"systemDone",sortable:!0,checked:!0},{label:"结算PO号",prop:"settlementPo",sortable:!0,checked:!0},{label:"结算状态",prop:"status",sortable:!0,checked:!0},{label:"节点时间",prop:"nodeTime",sortable:!0,checked:!0},{label:"备注",prop:"remark",sortable:!0,checked:!0}]),ue=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],N=r([]),d=Xe({page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:[],timeType:"",startTime:"",endTime:""}),re=r([]);function ke(a){z.value=a}const V=r();function he(a){a?V.value=a.projectId:V.value=""}function Ce(a){if(z.value.length)F.value.showEdit(a,z.value);else return me({message:"请选择至少一条数据",type:"warning"})}function Ie(){oe.value.showEdit()}function Se(a){if(z.value.length)F.value.showEdit(a,z.value);else return me({message:"请选择至少一条数据",type:"warning"})}async function ce(a){se.value.showEdit(JSON.stringify(a))}function je(a){H.value.showEdit(JSON.stringify(a),"")}function Q(a,l){H.value.showEdit(JSON.stringify(a),l)}function De(a){ie.value.showEdit(JSON.stringify(a))}function we(a){ye(a).then(()=>{d.limit=a,I()})}function k(a=1){ge(a).then(()=>{d.page=a,I()})}function $e(){Object.assign(d,{page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:[],timeType:"",startTime:"",endTime:""}),N.value=[],A.value=[],I()}const ze=a=>{d.countryId=a.join(","),k()},Ne=()=>{d.startTime=N.value[0],d.endTime=N.value[1],k()},Ve=a=>{if(!a||a.length===0)return"";const l=f=>{const g=f.getFullYear(),E=f.getMonth()+1,W=f.getDate();return`${g}-${E}-${W}`};if(a.length===1){const f=new Date(parseInt(a[0]));return l(f)}else if(a.length===2){const[f,g]=a.map(E=>new Date(parseInt(E)));return`${l(f)} - ${l(g)}`}return""},U=Ze(()=>a=>O.value.filter(f=>a.includes(f.id)).map(f=>f.chineseName));async function I(){try{$.value=!0;const{data:a}=await ht.list(d);re.value=a.projectSettlementList,D.value.total=+a.total,$.value=!1}catch{}finally{$.value=!1}}et(async()=>{O.value=await ne.getCountry(),ae.value=await fe.getCustomerList(),ve.value=await _e.getStaff(),K.value.forEach(a=>{a.checked&&v.value.push(a.prop)}),I()});function G(a,l){switch(a){case"auditing":ce(l);break;case"edit":je(l);break;case"refundDetails":De(l);break}}return(a,l)=>{const f=c("el-input"),g=c("el-form-item"),E=c("ElOption"),W=c("ElSelect"),X=c("el-option"),Z=c("el-select"),Ee=c("el-date-picker"),T=nt,ee=c("ElButton"),Te=c("ElFormItem"),Le=c("el-form"),xe=mt,Re=c("ElDivider"),y=c("el-button"),Ue=pt,Be=at,Pe=ot,Oe=c("el-row"),b=c("el-table-column"),de=dt,Ae=st,te=c("el-tag"),Fe=c("el-link"),He=c("el-tooltip"),B=c("el-text"),Me=c("ElSpace"),Je=c("el-empty"),Ye=c("el-table"),qe=c("ElPagination"),Ke=it,pe=tt("loading");return j((s(),S("div",{class:P({"absolute-container":M.value})},[n(Ke,null,{default:t(()=>[n(xe,{"show-toggle":!1},{default:t(({fold:e,toggle:h})=>[n(Le,{model:d,size:"default","label-width":"6.25rem","inline-message":"",inline:"",class:"search-form"},{default:t(()=>[n(g,{label:""},{default:t(()=>[n(f,{modelValue:d.projectId,"onUpdate:modelValue":l[0]||(l[0]=o=>d.projectId=o),clearable:"",placeholder:"项目ID",onKeydown:l[1]||(l[1]=le(o=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),n(g,{label:""},{default:t(()=>[n(f,{modelValue:d.projectName,"onUpdate:modelValue":l[2]||(l[2]=o=>d.projectName=o),clearable:"",placeholder:"项目名称",onKeydown:l[3]||(l[3]=le(o=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),n(g,{label:""},{default:t(()=>[n(f,{modelValue:d.projectIdentification,"onUpdate:modelValue":l[4]||(l[4]=o=>d.projectIdentification=o),clearable:"",placeholder:"项目标识",onKeydown:l[5]||(l[5]=le(o=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),j(n(g,{label:""},{default:t(()=>[n(W,{modelValue:A.value,"onUpdate:modelValue":l[6]||(l[6]=o=>A.value=o),placeholder:"国家",clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:ze},{default:t(()=>[(s(!0),S(w,null,L(O.value,o=>(s(),i(E,{label:o.chineseName,value:o.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,{label:""},{default:t(()=>[n(Z,{placeholder:"客户简称",modelValue:d.customerId,"onUpdate:modelValue":l[7]||(l[7]=o=>d.customerId=o),clearable:"",onChange:l[8]||(l[8]=o=>k())},{default:t(()=>[(s(!0),S(w,null,L(ae.value,o=>(s(),i(X,{key:o.tenantCustomerId,value:o.tenantCustomerId,label:o.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,{label:""},{default:t(()=>[n(Z,{placeholder:"结算状态",modelValue:d.settlementStatus,"onUpdate:modelValue":l[9]||(l[9]=o=>d.settlementStatus=o),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:l[10]||(l[10]=o=>k())},{default:t(()=>[(s(),S(w,null,L(ue,o=>n(X,{key:o.value,value:o.value,label:o.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,{label:""},{default:t(()=>[n(Z,{placeholder:"时间类型",modelValue:d.timeType,"onUpdate:modelValue":l[11]||(l[11]=o=>d.timeType=o),clearable:"",onChange:l[12]||(l[12]=o=>k())},{default:t(()=>[(s(),S(w,null,L(ue,o=>n(X,{key:o.value,value:o.value,label:o.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,null,{default:t(()=>[n(Ee,{modelValue:N.value,"onUpdate:modelValue":l[13]||(l[13]=o=>N.value=o),"value-format":"YYYY-MM-DD hh:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:"",size:"",onChange:Ne},null,8,["modelValue"])]),_:2},1536),[[x,!e]]),n(Te,null,{default:t(()=>[n(ee,{type:"primary",onClick:l[14]||(l[14]=o=>k())},{icon:t(()=>[n(T,{name:"i-ep:search"})]),default:t(()=>[u(" 筛选 ")]),_:1}),n(ee,{onClick:$e},{icon:t(()=>[It]),default:t(()=>[u(" 重置 ")]),_:1}),n(ee,{link:"",onClick:h},{icon:t(()=>[n(T,{name:e?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:t(()=>[u(" "+_(e?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),n(Re,{"border-style":"dashed"}),n(Oe,{gutter:24},{default:t(()=>[n(Ue,null,{default:t(()=>[n(y,{type:"primary",size:"default",onClick:Ie},{default:t(()=>[u(" 新增结算 ")]),_:1}),n(y,{type:"primary",size:"default",onClick:l[15]||(l[15]=e=>Ce(1))},{default:t(()=>[u(" 开票 ")]),_:1}),n(y,{type:"primary",size:"default",onClick:l[16]||(l[16]=e=>Se(2))},{default:t(()=>[u(" 结算 ")]),_:1})]),_:1}),n(Pe,null,{default:t(()=>[n(y,{size:"default",onClick:l[17]||(l[17]=()=>{})},{default:t(()=>[u(" 导出 ")]),_:1}),n(Be,{border:J.value,"onUpdate:border":l[18]||(l[18]=e=>J.value=e),tableAutoHeight:M.value,"onUpdate:tableAutoHeight":l[19]||(l[19]=e=>M.value=e),checkList:v.value,"onUpdate:checkList":l[20]||(l[20]=e=>v.value=e),columns:K.value,"onUpdate:columns":l[21]||(l[21]=e=>K.value=e),"line-height":Y.value,"onUpdate:lineHeight":l[22]||(l[22]=e=>Y.value=e),stripe:q.value,"onUpdate:stripe":l[23]||(l[23]=e=>q.value=e),style:{"margin-left":"0.75rem"},onQueryData:k},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),j((s(),i(Ye,{ref_key:"tableSortRef",ref:be,style:{"margin-top":"10px"},"row-key":"id",data:re.value,border:J.value,size:Y.value,stripe:q.value,"highlight-current-row":"",onSelectionChange:ke,onCurrentChange:he},{empty:t(()=>[n(Je,{image:C(lt),"image-size":300},null,8,["image"])]),default:t(()=>[n(b,{align:"center",type:"selection"}),v.value.includes("projectId")?(s(),i(b,{key:0,"show-overflow-tooltip":"",prop:"projectId",align:"center",width:"150",label:"项目"},{default:t(({row:e})=>[m("div",St,[m("div",jt,"ID: "+_(e.projectId),1),n(de,{class:"copy",content:e.projectId},null,8,["content"])])]),_:1})):p("",!0),v.value.includes("projectName")?(s(),i(b,{key:1,"show-overflow-tooltip":"",prop:"projectName",align:"left",width:"150",label:"名称/标识"},{default:t(({row:e})=>[m("b",Dt,"名: "+_(e.projectName?e.projectName:"-"),1),m("div",wt,"标: "+_(e.customerName.split("/")[1]!=="null"?e.customerName.split("/")[1]:"-"),1)]),_:1})):p("",!0),v.value.includes("customerName")?(s(),i(b,{key:2,"show-overflow-tooltip":"",prop:"customerName",width:"130",align:"center",label:"客户"},{default:t(({row:e})=>[m("div",$t,[m("b",zt,_(e.customerName.split("/")[0]),1),e.projectType!==2?(s(),S("div",Nt,[m("img",{src:e.avatar,alt:"",class:"avatar"},null,8,Vt),m("span",null,_(e.chargeName),1)])):p("",!0)])]),_:1})):p("",!0),v.value.includes("projectAmount")?(s(),i(b,{key:3,"show-overflow-tooltip":"",align:"center",label:"原价",width:"80"},{default:t(({row:e})=>[m("div",Et,[n(Ae),u(_(e.projectAmount||0),1)])]),_:1})):p("",!0),v.value.includes("countryId")?(s(),i(b,{key:4,"show-overflow-tooltip":"",align:"center",label:"国家",width:"80"},{default:t(({row:e})=>[e.countryId?(s(),S(w,{key:0},[e.countryId.length>=C(ne).country.length?(s(),i(te,{key:0,type:"primary"},{default:t(()=>[u("全球")]),_:1})):C(U)(e.countryId).length>1?(s(),i(He,{key:1,class:"box-item",effect:"dark",content:C(U)(e.countryId).join(","),placement:"top"},{default:t(()=>[n(Fe,{type:"primary"},{default:t(()=>[n(te,{type:"primary"},{default:t(()=>[u("×"+_(C(U)(e.countryId).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])):(s(!0),S(w,{key:2},L(C(U)(e.countryId),h=>(s(),i(te,{key:h,type:"primary"},{default:t(()=>[u(_(h),1)]),_:2},1024))),128))],64)):p("",!0)]),_:1})):p("",!0),v.value.includes("systemDone")?(s(),i(b,{key:5,"show-overflow-tooltip":"",prop:"systemDone",align:"center",width:"130",label:"系统/审核完成数"},{default:t(({row:e})=>[m("div",Tt,[m("div",Lt,[n(B,null,{default:t(()=>[u(_(e.systemDone?e.systemDone:0),1)]),_:2},1024),u(" /"),n(B,{class:"mx-1",type:"success"},{default:t(()=>[u(_(e.settlementDone?e.settlementDone:0),1)]),_:2},1024)]),n(T,{onClick:h=>Q(e,"systemDone"),class:P({edit:"edit",current:e.projectId===V.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):p("",!0),v.value.includes("settlementDone")?(s(),i(b,{key:6,"show-overflow-tooltip":"",prop:"settlementDone",align:"center",label:"结算完成数"})):p("",!0),v.value.includes("settlementPo")?(s(),i(b,{key:7,"show-overflow-tooltip":"",prop:"settlementPo",align:"center",label:"结算PO号"},{default:t(({row:e})=>[m("div",xt,[m("div",Rt,_(e.settlementPo?e.settlementPo:"-"),1),e.settlementPo?(s(),i(de,{key:0,class:"copy",content:e.settlementPo},null,8,["content"])):p("",!0),n(T,{onClick:h=>Q(e,"settlementPo"),class:P({edit:"edit",current:e.projectId===V.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):p("",!0),v.value.includes("nodeTime")?(s(),i(b,{key:8,"show-overflow-tooltip":"",prop:"nodeTime",align:"left",label:"节点"},{default:t(({row:e})=>[e.status===1?(s(),i(y,{key:0,size:"small",class:"p-1",type:"warning"},{default:t(()=>[u("待审核")]),_:1})):p("",!0),e.status===3?(s(),i(y,{key:1,size:"small",class:"p-1",type:"success"},{default:t(()=>[u("已开票")]),_:1})):p("",!0),e.status===4?(s(),i(y,{key:2,size:"small",class:"p-1",type:"info"},{default:t(()=>[u("已结算")]),_:1})):p("",!0),e.status===2?(s(),i(y,{key:3,size:"small",class:"p-1",type:"primary"},{default:t(()=>[u("已审核")]),_:1})):p("",!0),e.status===5?(s(),i(y,{key:4,size:"small",class:"p-1",type:"danger"},{default:t(()=>[u("已冻结")]),_:1})):p("",!0),e.nodeTime.length?(s(),i(B,{key:5,class:"mx-1 tableBig"},{default:t(()=>[u(_(Ve(e.nodeTime)),1)]),_:2},1024)):(s(),i(B,{key:6,class:"mx-1 tableBig"},{default:t(()=>[u("-")]),_:1}))]),_:1})):p("",!0),v.value.includes("remark")?(s(),i(b,{key:9,"show-overflow-tooltip":"",prop:"remark",align:"center",label:"备注"},{default:t(({row:e})=>[m("div",Ut,[m("div",Bt,_(e.remark?e.remark:"-"),1),n(T,{onClick:h=>Q(e,"remark"),class:P({edit:"edit",current:e.projectId===V.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):p("",!0),n(b,{align:"center",fixed:"right",label:"操作",width:"250"},{default:t(({row:e})=>[n(Me,null,{default:t(()=>[e.status===1?(s(),i(y,{key:0,type:"primary",size:"small",plain:"",onClick:h=>ce(e)},{default:t(()=>[u(" 审核 ")]),_:2},1032,["onClick"])):p("",!0),e.status===5?(s(),i(y,{key:1,type:"primary",size:"small",plain:"",onClick:h=>G("auditing",e)},{default:t(()=>[u(" 重审 ")]),_:2},1032,["onClick"])):p("",!0),n(y,{type:"warning",size:"small",plain:"",onClick:h=>G("edit",e)},{default:t(()=>[u(" 结算编辑 ")]),_:2},1032,["onClick"]),n(y,{type:"danger",size:"small",plain:"",onClick:h=>G("refundDetails",e)},{default:t(()=>[u(" 退款详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","border","size","stripe"])),[[pe,$.value]]),n(qe,{"current-page":C(D).page,total:C(D).total,"page-size":C(D).size,"page-sizes":C(D).sizes,layout:C(D).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:we,onCurrentChange:k},null,8,["current-page","total","page-size","page-sizes","layout"]),n(ft,{onSuccess:I,ref_key:"invoicingRef",ref:F},null,512),n(_t,{onSuccess:I,ref_key:"auditingRef",ref:se},null,512),n(vt,{onSuccess:I,ref_key:"editRef",ref:H},null,512),n(yt,{ref_key:"refundRef",ref:ie},null,512),n(gt,{onSuccess:I,ref_key:"addSettlementRef",ref:oe},null,512)]),_:1})],2)),[[pe,$.value]])}}}),el=ct(Pt,[["__scopeId","data-v-21280c87"]]);export{el as default};
