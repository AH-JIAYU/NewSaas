
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as W,m as G,u as me,r as f,a as d,o as p,b as E,f as l,w as r,e as _,C as h,aH as S,az as K,am as X,aE as ce,i as a,j as I,E as C,L as fe,P as ee,k as Q,M as ge,l as ve,al as ye,F as q,n as L,g as z,G as he,aK as be,aL as _e,aj as Y}from"./index-DEFxt4uT.js";import{u as we}from"./otherFunctions_basicDictionary-BMiAqIq0.js";const Ve={class:"upload-container"},Ee={key:1,class:"image"},Pe={class:"mask"},ke={class:"actions"},Ue={key:0,class:"el-upload__tip"},$e={style:{display:"inline-block"}},Se=W({name:"ImageUpload",__name:"index",props:G({action:{},headers:{},data:{},name:{default:"file"},size:{default:2},width:{default:150},height:{default:150},placeholder:{default:""},notip:{type:Boolean,default:!1},ext:{default:()=>["jpg","png","gif","bmp"]}},{modelValue:{default:""},modelModifiers:{}}),emits:G(["onSuccess"],["update:modelValue"]),setup(v,{emit:T}){const P=v,N=T,g=me(v,"modelValue"),m=f({imageViewerVisible:!1,progress:{preview:"",percent:0}});function w(){m.value.imageViewerVisible=!0}function x(){m.value.imageViewerVisible=!1}function V(){g.value=""}const j=s=>{const n=s.name.split(".").at(-1)??"",b=P.ext.includes(n),U=s.size/1024/1024<P.size;return b||C.error(`上传图片只支持 ${P.ext.join(" / ")} 格式！`),U||C.error(`上传图片大小不能超过 ${P.size}MB！`),b&&U&&(m.value.progress.preview=URL.createObjectURL(s)),b&&U},M=s=>{m.value.progress.percent=~~s.percent},k=s=>{m.value.progress.preview="",m.value.progress.percent=0,N("onSuccess",s)};return(s,e)=>{const n=fe,b=d("ElImage"),U=d("ElProgress"),B=d("ElUpload"),O=d("ElAlert"),F=d("ElImageViewer");return p(),E("div",Ve,[l(B,{"show-file-list":!1,headers:s.headers,action:s.action,data:s.data,name:s.name,"before-upload":j,"on-progress":M,"on-success":k,drag:"",class:"image-upload"},{default:r(()=>[g.value===""?(p(),_(b,{key:0,src:g.value===""?s.placeholder:g.value,style:S(`width:${s.width}px;height:${s.height}px;`),fit:"fill"},{error:r(()=>[h("div",{class:"image-slot",style:S(`width:${s.width}px;height:${s.height}px;`)},[l(n,{name:"i-ep:plus",class:"icon"})],4)]),_:1},8,["src","style"])):(p(),E("div",Ee,[l(b,{src:g.value,style:S(`width:${s.width}px;height:${s.height}px;`),fit:"fill"},null,8,["src","style"]),h("div",Pe,[h("div",ke,[h("span",{title:"预览",onClick:K(w,["stop"])},[l(n,{name:"i-ep:zoom-in",class:"icon"})]),h("span",{title:"移除",onClick:K(V,["stop"])},[l(n,{name:"i-ep:delete",class:"icon"})])])])])),X(h("div",{class:"progress",style:S(`width:${s.width}px;height:${s.height}px;`)},[l(b,{src:a(m).progress.preview,style:S(`width:${s.width}px;height:${s.height}px;`),fit:"fill"},null,8,["src","style"]),l(U,{type:"circle",width:Math.min(s.width,s.height)*.8,percentage:a(m).progress.percent},null,8,["width","percentage"])],4),[[ce,g.value===""&&a(m).progress.percent]])]),_:1},8,["headers","action","data","name"]),s.notip?I("",!0):(p(),E("div",Ue,[h("div",$e,[l(O,{title:`上传图片支持 ${s.ext.join(" / ")} 格式，且图片大小不超过 ${s.size}MB，建议图片尺寸为 ${s.width}*${s.height}`,type:"info","show-icon":"",closable:!1},null,8,["title"])])])),a(m).imageViewerVisible?(p(),_(F,{key:1,"url-list":[g.value],teleported:"",onClose:x},null,8,["url-list"])):I("",!0)])}}}),Ie=ee(Se,[["__scopeId","data-v-efadaafa"]]),J={list:()=>Q.post("user/getUserInfo"),edit:v=>Q.post("user/update",v)},le=v=>(be("data-v-fb807739"),v=v(),_e(),v),Ce=le(()=>h("h2",null,"个人信息",-1)),Ne=le(()=>h("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),ae=W({name:"personalSetting",__name:"setting",emits:["success"],setup(v,{expose:T,emit:P}){const N=P,g=we(),m=f([]),w=f(!1);ge();const x=f(!1),V=f(!1),j=[{label:"公司",value:"company"},{label:"个人",value:"personal"}],M=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}];f([]);const k=f(),s=f(),e=f({type:"personal",name:"",phone:"15288888888",email:"88888@qq.com",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),n=f({oldPassword:"",password:"",confirmPassword:""}),B=f({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(u,o,c)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?c():c(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(u,o,c)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?c():c(new Error("请输入合法手机号"))},trigger:"blur"}]}),O=f({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(u,o,c)=>{o===n.value.oldPassword?c(new Error("新密码不能与旧密码一致")):c()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(u,o,c)=>{o!==n.value.password?c(new Error("两次输入的密码不一致")):c()},trigger:"blur"}]}),F=u=>{(u!==e.value.phone||u!==e.value.email)&&(x.value=!0)};function te(){k.value&&k.value.validate(async u=>{if(u){if(w.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,x.value||(delete e.value.phone,delete e.value.email),(await J.edit(e.value)).status===-1)return;N("success"),w.value=!1,C.success({message:"修改成功",center:!0}),$()}})}const oe=()=>{s.value&&s.value.validate(async u=>{if(u){if(w.value=!0,delete n.value.confirmPassword,console.log("accountForm.value",n.value),(await J.edit(n.value)).status===-1)return;N("success"),w.value=!1,C.success({message:"修改成功",center:!0}),$()}})};async function se(u){e.value=u,V.value=!0}function $(){k.value.resetFields(),s.value.resetFields(),Object.assign(e,{}),Object.assign(n,{}),V.value=!1}function re(u){u.error===""?e.value.headimg=u.data.path:C.warning(u.error)}return ve(async()=>{m.value=await g.country||await g.getCountry()}),T({showEdit:se}),(u,o)=>{const c=Ie,i=d("ElFormItem"),D=d("el-option"),A=d("el-select"),y=d("ElInput"),ne=d("ElOption"),ue=d("ElSelect"),R=d("ElButton"),H=d("ElForm"),Z=d("ElTabPane"),ie=d("ElTabs"),de=d("el-drawer"),pe=ye("loading");return X((p(),E("div",null,[l(de,{modelValue:a(V),"onUpdate:modelValue":o[13]||(o[13]=t=>he(V)?V.value=t:null),title:"修改用户信息",direction:"rtl","before-close":$,style:{height:"100%"},size:"40%"},{default:r(()=>[l(ie,{"tab-position":"left"},{default:r(()=>[l(Z,{label:"个人信息",class:"basic"},{default:r(()=>[Ce,l(H,{ref_key:"userFormRef",ref:k,model:a(e),rules:a(B),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:r(()=>[l(i,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:r(()=>[l(c,{url:a(e).imgUrl,"onUpdate:url":o[0]||(o[0]=t=>a(e).imgUrl=t),action:"http://saas-api.surveysaas.com/project/uploadQiniu",name:"image",notip:"",class:"headimg-upload",onOnSuccess:re},null,8,["url"])]),_:1}),l(i,{label:"账户类型"},{default:r(()=>[l(A,{modelValue:a(e).type,"onUpdate:modelValue":o[1]||(o[1]=t=>a(e).type=t),"value-key":"",placeholder:"账户类型",clearable:"",filterable:""},{default:r(()=>[(p(),E(q,null,L(j,t=>l(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"用户名"},{default:r(()=>[l(y,{disabled:"",modelValue:a(e).name,"onUpdate:modelValue":o[2]||(o[2]=t=>a(e).name=t),laceholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),l(i,{label:"国家"},{default:r(()=>[l(ue,{modelValue:a(e).country,"onUpdate:modelValue":o[3]||(o[3]=t=>a(e).country=t),disabled:""},{default:r(()=>[(p(!0),E(q,null,L(a(m),t=>(p(),_(ne,{label:t.chineseName,value:t.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),l(i,{prop:"",label:"货币类型"},{default:r(()=>[l(A,{modelValue:a(e).currencyType,"onUpdate:modelValue":o[4]||(o[4]=t=>a(e).currencyType=t),"value-key":"",placeholder:"请选择货币类型",clearable:"",filterable:""},{default:r(()=>[(p(),E(q,null,L(M,t=>l(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(e).type==="company"?(p(),_(i,{key:0,label:"公司名称"},{default:r(()=>[l(y,{modelValue:a(e).companyName,"onUpdate:modelValue":o[5]||(o[5]=t=>a(e).companyName=t),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):I("",!0),a(e).type==="company"?(p(),_(i,{key:1,label:"公司税号"},{default:r(()=>[l(y,{modelValue:a(e).taxId,"onUpdate:modelValue":o[6]||(o[6]=t=>a(e).taxId=t),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):I("",!0),a(e).type==="company"?(p(),_(i,{key:2,label:"法人姓名"},{default:r(()=>[l(y,{modelValue:a(e).legalPersonName,"onUpdate:modelValue":o[7]||(o[7]=t=>a(e).legalPersonName=t),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):I("",!0),a(e).country==="CN"?(p(),_(i,{key:3,prop:"phone",label:"手机号码"},{default:r(()=>[l(y,{modelValue:a(e).phone,"onUpdate:modelValue":o[8]||(o[8]=t=>a(e).phone=t),placeholder:"请输入你的手机号码",onChange:F},null,8,["modelValue"])]),_:1})):(p(),_(i,{key:4,prop:"email",label:"电子邮箱"},{default:r(()=>[l(y,{modelValue:a(e).email,"onUpdate:modelValue":o[9]||(o[9]=t=>a(e).email=t),placeholder:"请输入你的电子邮箱",onChange:F},null,8,["modelValue"])]),_:1})),l(i,null,{default:r(()=>[l(R,{onClick:te,type:"primary"},{default:r(()=>[z(" 保存 ")]),_:1}),l(R,{onClick:$,type:"primary"},{default:r(()=>[z(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),l(Z,{label:"账户管理",class:"security"},{default:r(()=>[Ne,l(H,{ref_key:"accountFormRef",ref:s,model:a(n),rules:a(O),"label-width":"120px","label-suffix":"："},{default:r(()=>[l(i,{prop:"oldPassword",label:"旧密码"},{default:r(()=>[l(y,{modelValue:a(n).oldPassword,"onUpdate:modelValue":o[10]||(o[10]=t=>a(n).oldPassword=t),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),l(i,{prop:"password",label:"新密码"},{default:r(()=>[l(y,{modelValue:a(n).password,"onUpdate:modelValue":o[11]||(o[11]=t=>a(n).password=t),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(i,{prop:"confirmPassword",label:"确认新密码"},{default:r(()=>[l(y,{modelValue:a(n).confirmPassword,"onUpdate:modelValue":o[12]||(o[12]=t=>a(n).confirmPassword=t),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(i,null,{default:r(()=>[l(R,{onClick:oe,type:"primary"},{default:r(()=>[z(" 保存 ")]),_:1}),l(R,{onClick:$,type:"primary"},{default:r(()=>[z(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[pe,a(w)]])}}});typeof Y=="function"&&Y(ae);const xe=ee(ae,[["__scopeId","data-v-fb807739"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{J as a,ze as b,xe as s};
