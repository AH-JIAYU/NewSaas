
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ve,am as be,O as he,aK as Ce,y as we,r as N,k as Ie,G as j,J as Pe,c as Se,a as u,p as Le,o as c,b as h,f as a,w as n,i as l,F as L,t as ke,e as g,g as m,H as B,q as Ve,j as U,S as Ee,E as C,aL as F,N as Me,ap as $e,aG as xe,aH as De,s as ze,R as Ne}from"./index-6EN4pAdE.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-rChBMnls.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-CSUaXoVd.js";import{s as w}from"./apiLoading-D0GWlqhi.js";import{a as y}from"./otherFunctions_screenLibrary-DtHrEMAg.js";import{_ as Ue}from"./index.vue_vue_type_script_setup_true_lang-BSM172H8.js";import{u as Fe}from"./index-CMGz3XEW.js";import{u as Te}from"./stagedData-CJ_litgX.js";import{u as Oe}from"./useTabbar-Bt_wpJxS.js";/* empty css                      */const Re=I=>(xe("data-v-ebc84ad5"),I=I(),De(),I),He=Re(()=>ze("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),Ae=ve({name:"screen_library",__name:"list",setup(I){const T=be(),O=Fe(),P=Te(),R=he(),{pagination:p,getParams:H,onSizeChange:A,onCurrentChange:q,onSortChange:G}=Ce(),J=Oe(),$=we(),e=N({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),x=N();Ie(async()=>{d(),e.value.countryList=await T.getCountry(),e.value.formMode==="router"&&j.on("get-data-list",()=>{d()})}),Pe(()=>{e.value.formMode==="router"&&j.off("get-data-list")});function d(){try{e.value.loading=!0;const t={...H(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};y.list(t).then(o=>{e.value.loading=!1,e.value.dataList=o.data.getCountryListInfoList,p.value.total=o.data.getCountryListInfoList.length})}catch{}finally{e.value.loading=!1}}const D=Se(()=>e.value.dataList.slice((p.value.page-1)*p.value.size,p.value.page*p.value.size));function K(t){A(t).then(()=>d())}function k(t=1){q(t).then(()=>d())}function z({prop:t,order:o}){G(t,o).then(()=>d())}function Q(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function W(t){t.getProjectProblemCategoryInfoList.unshift({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add"})}function X(t,o,_){x.value.validateField(`[${o}].getProjectProblemCategoryInfoList[${_}].categoryName`,async v=>{if(v){const{data:V,status:S}=await w(y.create(t));S===1&&C.success({message:"新增成功",center:!0}),await d()}})}function Y(t,o){const _=e.value.dataList.findIndex(v=>v.countryId===t.countryId);e.value.dataList[_].getProjectProblemCategoryInfoList.splice(o,1)}async function Z(t){const{status:o}=await w(y.update(t));o===1&&C.success({message:"修改「默认国家」成功",center:!0}),d(),P.projectManagementList=null}async function ee(t){const{status:o}=await w(y.edit(t));o===1&&C.success({message:"修改「状态」成功",center:!0}),d(),P.projectManagementList=null}function te(t){O.countryId=t.countryId,e.value.formMode==="router"?$.settings.tabbar.enable&&$.settings.tabbar.mergeTabsBy!=="activeMenu"?J.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):R.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function ae(t){F.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:o}=await w(y.delete({countryId:t.countryId}));o===1&&C.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),P.projectManagementList=null}function oe(t){F.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:o}=await w(y.delete({projectProblemCategoryId:t.projectProblemCategoryId}));o===1&&C.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),P.projectManagementList=null}function ne(){Object.assign(e.value.search,{countryId:""}),d()}return(t,o)=>{const _=u("ElOption"),v=u("el-select"),V=u("ElFormItem"),S=Me,f=u("ElButton"),le=u("ElForm"),re=je,se=u("ElDivider"),ie=u("ElSpace"),E=u("el-table-column"),ue=u("el-input"),de=u("el-form-item"),M=u("ElSwitch"),b=u("ElTableColumn"),ce=u("el-table"),me=u("el-empty"),pe=u("ElTable"),fe=u("el-form"),ge=u("ElPagination"),ye=$e,_e=Le("loading");return c(),h("div",{class:Ee({"absolute-container":l(e).tableAutoHeight})},[a(ye,null,{default:n(()=>[a(re,{"show-toggle":!1},{default:n(({fold:s,toggle:r})=>[a(le,{model:l(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:n(()=>[a(V,{label:""},{default:n(()=>[a(v,{onChange:o[0]||(o[0]=i=>k()),clearable:"",filterable:"",modelValue:l(e).search.countryId,"onUpdate:modelValue":o[1]||(o[1]=i=>l(e).search.countryId=i),placeholder:"国家"},{default:n(()=>[(c(!0),h(L,null,ke(l(e).countryList,i=>(c(),g(_,{label:i.chineseName,value:i.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(V,null,{default:n(()=>[a(f,{type:"primary",onClick:o[2]||(o[2]=i=>k())},{icon:n(()=>[a(S,{name:"i-ep:search"})]),default:n(()=>[m(" 筛选 ")]),_:1}),a(f,{onClick:ne},{icon:n(()=>[He]),default:n(()=>[m(" 重置 ")]),_:1}),a(f,{link:"",disabled:"",onClick:r},{icon:n(()=>[a(S,{name:s?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:n(()=>[m(" "+B(s?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(se,{"border-style":"dashed"}),a(ie,{wrap:""},{default:n(()=>[a(f,{type:"primary",size:"default",onClick:Q},{default:n(()=>[m(" 新增前置问卷库 ")]),_:1})]),_:1}),a(fe,{ref_key:"formRef",ref:x,rules:l(e).rules,model:l(D)},{default:n(()=>[Ve((c(),g(pe,{class:"my-4",border:"",data:l(D),"highlight-current-row":"",height:"100%",onSortChange:z,onSelectionChange:o[4]||(o[4]=s=>l(e).batch.selectionDataList=s),"default-expand-all":!0},{empty:n(()=>[a(me,{class:"vab-data-empty",description:"暂无数据"})]),default:n(()=>[a(E,{type:"expand",width:"55"},{default:n(s=>[a(ce,{data:s.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",border:"",height:"100%",onSortChange:z,onSelectionChange:o[3]||(o[3]=r=>l(e).batch.selectionDataList=r)},{default:n(()=>[a(E,{width:"55"}),a(E,{width:"500",prop:"categoryName",label:"问卷名称",align:"center"},{default:n(r=>[r.row.type==="add"?(c(),g(de,{key:0,prop:`[${s.$index}].getProjectProblemCategoryInfoList[${r.$index}].categoryName`,rules:l(e).rules.categoryName},{default:n(()=>[a(ue,{modelValue:r.row.categoryName,"onUpdate:modelValue":i=>r.row.categoryName=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(c(),h(L,{key:1},[m(B(r.row.categoryName),1)],64))]),_:2},1024),a(b,{prop:"status",label:"状态"},{default:n(r=>[r.row.type==="add"?(c(),g(M,{key:0,modelValue:r.row.status,"onUpdate:modelValue":i=>r.row.status=i,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])):(c(),g(M,{key:1,onChange:i=>ee(r.row),modelValue:r.row.status,"onUpdate:modelValue":i=>r.row.status=i,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),a(b,{width:"250",align:"center",fixed:"right",label:"操作"},{default:n(r=>[r.row.type==="add"?(c(),h(L,{key:0},[a(f,{type:"primary",size:"small",plain:"",onClick:i=>X(r.row,s.$index,r.$index)},{default:n(()=>[m(" 提交 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:i=>Y(r.row,r.$index)},{default:n(()=>[m(" 取消 ")]),_:2},1032,["onClick"])],64)):(c(),h(L,{key:1},[a(f,{type:"success",size:"small",plain:"",onClick:i=>te(r.row)},{default:n(()=>[m(" 设计问卷 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:i=>oe(r.row)},{default:n(()=>[m(" 删除 ")]),_:2},1032,["onClick"])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),a(b,{prop:"countryName",label:"国家/标题",width:"500"}),a(b,{prop:"isDefault",label:"默认/状态"},{default:n(s=>[a(M,{onChange:r=>Z(s.row),modelValue:s.row.isDefault,"onUpdate:modelValue":r=>s.row.isDefault=r,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),a(b,{label:"操作",width:"250",align:"center",fixed:"right"},{default:n(s=>[a(f,{type:"primary",size:"small",plain:"",onClick:r=>W(s.row)},{default:n(()=>[m(" 新增问卷 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:r=>ae(s.row)},{default:n(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,l(e).loading]])]),_:1},8,["rules","model"]),a(ge,{"current-page":l(p).page,total:l(p).total,"page-size":l(p).size,"page-sizes":l(p).sizes,layout:l(p).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:K,onCurrentChange:k},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),l(e).editProps.visible?(c(),g(Ue,{key:0,id:l(e).editProps.id,countryId:l(e).editProps.countryId,modelValue:l(e).editProps.visible,"onUpdate:modelValue":o[5]||(o[5]=s=>l(e).editProps.visible=s),row:l(e).editProps.row,onSuccess:d},null,8,["id","countryId","modelValue","row"])):U("",!0),l(e).formMode==="dialog"||l(e).formMode==="drawer"?(c(),g(Be,{key:1,id:l(e).formModeProps.id,modelValue:l(e).formModeProps.visible,"onUpdate:modelValue":o[6]||(o[6]=s=>l(e).formModeProps.visible=s),mode:l(e).formMode,details:l(e).formModeProps.details,title:l(e).formModeProps.title,onSuccess:d},null,8,["id","modelValue","mode","details","title"])):U("",!0)],2)}}}),tt=Ne(Ae,[["__scopeId","data-v-ebc84ad5"]]);export{tt as default};
