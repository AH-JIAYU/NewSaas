
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as H,aD as M,r as c,a as i,o as b,b as Y,f as o,w as a,g as d,i as l,y as n,e as G,j as Q,A as W,E as j,_ as X,aH as Z,aI as ee,L as re}from"./index-kosEbCWA.js";import{a as R}from"./user_cooperation-nzF4edOc.js";import{u as te}from"./index-BVV58a22.js";import{a as ae}from"./department-CRBo-Vyx.js";import"./index-BKeh074C.js";import"./index-Cn_KdKY1.js";const f=g=>(Z("data-v-649c1218"),g=g(),ee(),g),oe=f(()=>n("div",{style:{display:"flex","align-items":"center"}},[n("span",{style:{display:"inline-block",width:"8px",height:"8px",background:"#FF8181","border-radius":"50%","margin-right":"4px"}}),n("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式")],-1)),le=f(()=>n("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),ne=f(()=>n("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),se={style:{display:"flex"}},ce=f(()=>n("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),ie=f(()=>n("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),de=H({__name:"index",emits:["fetch-data"],setup(g,{expose:C,emit:N}){const V=M().currencyType,h=c(),S=N,p=c(!1),y=c();c(1);const e=c({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(r,t,m)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return m(new Error("请输入 0 到 100 之间的数字"));m()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),E={children:"children",label:"name"},T=c([]);c();const _=c();async function A(r){e.value.form.chargeUserId="",e.value.form.id=r.id,e.value.form.exchangeRate=r.exchangeRate,r.currencyType==="USD"?h.value=1:r.currencyType==="CNY"&&(h.value=2),e.value.form.priceRatio=r.priceRatio,e.value.form.sendProjectType=r.sendProjectType?[r.sendProjectType]:null,e.value.form.receiveProjectType=r.receiveProjectType?[r.receiveProjectType]:null,e.value.form.chargeUserName=r.userName,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserId=r.userId;const t=await ae.list({name:""});t.data&&(T.value=t.data),p.value=!0}const B=(r,t)=>{t?(_.value.getCheckedKeys().forEach(u=>{u!==r.id&&_.value.setChecked(u,!1)}),e.value.form.chargeUserId=r.id,e.value.form.chargeUserName=r.name):(e.value.form.chargeUserId=[e.value.form.chargeUserId].filter(m=>m!==r.id),e.value.form.chargeUserId.length==0&&(e.value.form.chargeUserId="")),e.value.form.chargeUserId||(e.value.form.chargeUserName="")};function U(){p.value=!1,e.value.form={},y.value.resetFields()}const q=c();async function F(r){await R.updateInvitationBindUser({id:e.value.form.id,chargeUserId:r.chargeUserId,invitationType:r.invitationType,chargeUserName:r.chargeUserName,sendProjectType:r.sendProjectType,receiveProjectType:r.receiveProjectType})}async function D(){await R.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio,exchangeRate:e.value.form.exchangeRate}),j.success({message:"修改成功",center:!0})}async function $(){y.value.validate(r=>{if(r){let t=JSON.parse(JSON.stringify(e.value.form));if(V===h.value&&(t.exchangeRate=1),Array.isArray(t.chargeUserId)&&(t.chargeUserId=t.chargeUserId[0]),t.receiveProjectType==1&&!t.chargeUserId){j.warning({message:"请选择部门",center:!0});return}t.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,t.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,t.invitationType=2,t.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",t.chargeUserId=null,t.chargeUserName="",t.invitationType=""),F(t),D(),setTimeout(()=>{S("fetch-data")},1e3),U()}})}const K=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.sendProjectType=[r[r.length-1]])},w=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.receiveProjectType=[r[r.length-1]])};function z(r){e.value.form.chargeUserId=r.chargeUserId,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserName=r.chargeUserName}return C({showEdit:A}),(r,t)=>{const m=i("el-input"),u=i("el-form-item"),P=X,I=i("el-tooltip"),v=i("el-checkbox"),k=i("el-checkbox-group"),J=i("el-tree-select"),L=i("ElForm"),x=i("el-button"),O=i("el-dialog");return b(),Y("div",null,[o(O,{modelValue:l(p),"onUpdate:modelValue":t[4]||(t[4]=s=>W(p)?p.value=s:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置",class:"hezuoDrawer"},{footer:a(()=>[o(x,{onClick:U},{default:a(()=>[d(" 关闭 ")]),_:1}),o(x,{type:"primary",onClick:$},{default:a(()=>[d(" 确认 ")]),_:1})]),default:a(()=>[o(L,{ref_key:"formRef",ref:y,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"right"},{default:a(()=>[o(u,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[o(m,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":t[0]||(t[0]=s=>l(e).form.priceRatio=s),clearable:""},{append:a(()=>[d("%")]),_:1},8,["modelValue"])]),_:1}),o(u,{"label-width":"7.5rem"},{label:a(()=>[oe]),_:1}),o(u,{prop:"sendProjectType","label-width":"7rem"},{label:a(()=>[n("span",null,[o(I,{effect:"dark",placement:"top-start"},{content:a(()=>[le,ne]),default:a(()=>[o(P,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),d(" 发送项目 ")])]),default:a(()=>[o(k,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":t[1]||(t[1]=s=>l(e).form.sendProjectType=s),onChange:K},{default:a(()=>[o(v,{value:1},{default:a(()=>[d(" 自动 ")]),_:1}),o(v,{value:2},{default:a(()=>[d(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n("div",se,[o(u,{prop:"receiveProjectType",style:{"margin-right":"1.5625rem"}},{label:a(()=>[n("span",null,[o(I,{effect:"dark",placement:"top-start"},{content:a(()=>[ce,ie]),default:a(()=>[o(P,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),d(" 接收项目 ")])]),default:a(()=>[o(k,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":t[2]||(t[2]=s=>l(e).form.receiveProjectType=s),onChange:w},{default:a(()=>[o(v,{value:1},{default:a(()=>[d(" 自动 ")]),_:1}),o(v,{value:2},{default:a(()=>[d(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).form.receiveProjectType==1?(b(),G(J,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:_,modelValue:l(e).form.chargeUserId,"onUpdate:modelValue":t[3]||(t[3]=s=>l(e).form.chargeUserId=s),data:l(T),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:E,onCheckChange:B,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):Q("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(te,{ref_key:"userRef",ref:q,onUserData:z},null,512)])}}}),_e=re(de,[["__scopeId","data-v-649c1218"]]);export{_e as default};
