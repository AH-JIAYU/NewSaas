
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as J,r as x,a5 as w,a as i,o as p,b as g,f as r,w as a,s as _,g as c,i as t,e as n,F as j,t as N,H as C,j as I,q,ap as D,I as K,am as Q,E as L,N as W}from"./index-BSVPXFpA.js";import{a as y}from"./projectManagement_scheduling-BPzvKpa_.js";import{o as P,s as U}from"./apiLoading-BpSodWAO.js";const X={style:{float:"left"}},Y={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Z={style:{flex:"auto"}},ae=J({name:"Edit",__name:"index",emits:["fetch-data"],setup(ee,{expose:M,emit:z}){const A=z,f=x(),E=w({projectId:[{required:!0,message:"请选择项目",trigger:"change"}],dispatchType:[{required:!0,message:"请选择调度类型",trigger:"change"}],dataType:[{required:!0,message:"请选择调度目标",trigger:"change"}],groupSupplierId:[{required:!0,message:"请选择至少一个",trigger:"change"}]}),u=x(!1),e=w({title:"",projectList:[],memberGroupNameInfoList:[],supplierNameInfoList:[],form:{projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""}});async function B(s,o){const d=await P(y.getProjectList({}));e.projectList=d.data.getNotDispatchProjectInfoList,o?s.isDispatch===1?L.warning({message:"该项目已经调度，请前往「项目调度」进行编辑",center:!0}):(e.title="新增",e.form.projectId=s.projectId,await b(s.projectId),u.value=!0):(s?(e.title="编辑",e.form=Q(s),await b(s.projectId)):e.title="新增",u.value=!0)}const b=async s=>{if(s){const o=await P(y.getAllocationGroupOrSupplier({projectId:s}));e.memberGroupNameInfoList=o.data.getAllocationMemberGroupNameInfoList,e.supplierNameInfoList=o.data.getAllocationSupplierNameInfoList,e.supplierNameInfoList.length&&!e.memberGroupNameInfoList.length&&(e.form.dataType=1),!e.supplierNameInfoList.length&&e.memberGroupNameInfoList.length&&(e.form.dataType=2)}},F=()=>{e.form.groupSupplierId=[],f.value.clearValidate(["groupSupplierId"])};function v(){f.value.resetFields(),e.form={projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},u.value=!1}function R(){f.value&&f.value.validate(async s=>{if(s){if(e.title==="新增"){const{status:o}=await U(y.create(e.form));o===1&&L.success({message:"新增成功"})}else{const{status:o}=await U(y.edit(e.form));o===1&&L.success({message:"修改成功"})}v(),A("fetch-data")}})}return M({showEdit:B}),(s,o)=>{const d=i("el-radio"),T=i("el-radio-group"),m=i("el-form-item"),S=W,k=i("el-tooltip"),h=i("el-option"),V=i("el-select"),H=i("el-input"),O=i("el-form"),G=i("el-button"),$=i("el-dialog");return p(),g("div",null,[r($,{modelValue:t(u),"onUpdate:modelValue":o[6]||(o[6]=l=>K(u)?u.value=l:null),title:t(e).title,width:"600","before-close":v},{footer:a(()=>[_("div",Z,[r(G,{onClick:v},{default:a(()=>[c(" 取消 ")]),_:1}),r(G,{type:"primary",onClick:R},{default:a(()=>[c(" 确定 ")]),_:1})])]),default:a(()=>[r(O,{ref_key:"formRef",ref:f,"label-width":"130px",style:{position:"relative"},model:t(e).form,rules:t(E),inline:!1},{default:a(()=>[r(m,{label:"调度类型",prop:"dispatchType",style:{"align-items":"center"}},{default:a(()=>[r(T,{modelValue:t(e).form.dispatchType,"onUpdate:modelValue":o[0]||(o[0]=l=>t(e).form.dispatchType=l),class:"ml-4"},{default:a(()=>[r(d,{value:1,size:"large"},{default:a(()=>[c(" 指定关闭 ")]),_:1}),r(d,{value:2,size:"large"},{default:a(()=>[c(" 指定价格 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(k,{class:"tooltips",content:"选中供应商或会员组，该供应商或会员组无法参与该项目",placement:"top"},{default:a(()=>[r(S,{style:{position:"absolute",left:"14.375rem",top:".8125rem"},class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),r(k,{class:"tooltips",content:"举例:(选中供应商为：A供应商；指定价格为：100美元)则，A供应商下参与该项目的会员价格为100美元，无需通过会员等级进行计算",placement:"top"},{default:a(()=>[r(S,{style:{position:"absolute",left:"21.375rem",top:".8125rem"},class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),t(e).title==="新增"?(p(),n(m,{key:0,label:"项目ID/名称",prop:"projectId"},{default:a(()=>[r(V,{placeholder:"",modelValue:t(e).form.projectId,"onUpdate:modelValue":o[1]||(o[1]=l=>t(e).form.projectId=l),clearable:"",disabled:"",filterable:"",onChange:b},{default:a(()=>[(p(!0),g(j,null,N(t(e).projectList,l=>(p(),n(h,{key:l.projectId,label:l.projectName,value:l.projectId},{default:a(()=>[_("span",X,C(l.projectName),1),_("span",Y,C(l.projectId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):I("",!0),q(_("div",null,[q(r(m,{prop:"dataType",label:"调度目标",style:{"align-items":"center"}},{default:a(()=>[r(T,{modelValue:t(e).form.dataType,"onUpdate:modelValue":o[2]||(o[2]=l=>t(e).form.dataType=l),class:"ml-4",onChange:F},{default:a(()=>[r(d,{value:1,size:"large"},{default:a(()=>[c(" 供应商 ")]),_:1}),r(d,{value:2,size:"large"},{default:a(()=>[c(" 会员组 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[D,t(e).supplierNameInfoList.length&&t(e).memberGroupNameInfoList.length]]),t(e).supplierNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===1?(p(),n(m,{key:0,label:"供应商",prop:"groupSupplierId"},{default:a(()=>[r(V,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":o[3]||(o[3]=l=>t(e).form.groupSupplierId=l),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:a(()=>[(p(!0),g(j,null,N(t(e).supplierNameInfoList,l=>(p(),n(h,{key:l.projectId,label:l.supplierName,value:l.supplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):I("",!0),t(e).memberGroupNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===2?(p(),n(m,{key:1,label:"会员组",prop:"groupSupplierId"},{default:a(()=>[r(V,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":o[4]||(o[4]=l=>t(e).form.groupSupplierId=l),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:a(()=>[(p(!0),g(j,null,N(t(e).memberGroupNameInfoList,l=>(p(),n(h,{key:l.projectId,label:l.memberGroupName,value:l.memberGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):I("",!0)],512),[[D,t(e).form.projectId]]),t(e).form.dispatchType===2?(p(),n(m,{key:1,label:"指定价格"},{default:a(()=>[r(H,{placeholder:"",modelValue:t(e).form.doMoneyPrice,"onUpdate:modelValue":o[5]||(o[5]=l=>t(e).form.doMoneyPrice=l),clearable:""},null,8,["modelValue"])]),_:1})):I("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{ae as _};
