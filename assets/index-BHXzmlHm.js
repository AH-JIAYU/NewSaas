
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ge,aN as ke,r,Z as Te,c as Ie,n as Ce,a as y,q as Pe,o as s,b as Se,f as l,w as n,g as c,i as o,A as T,s as je,e as p,aM as Be,y as f,j as d,z as b,N as $,aO as Ne,E as R,bb as Ue,bc as ze,_ as Ee,be as Re,an as Le,aH as xe,aI as De,L as $e}from"./index-Cj0XdJq_.js";import{_ as Ae}from"./index-ClAOCFzy.js";import{_ as we}from"./index.vue_vue_type_style_index_0_lang-CqIrmR9i.js";import Me from"./index-1gr5BPmF.js";import Fe from"./index-CgH_efrC.js";import He from"./index-DFh_2xi-.js";import qe from"./index-DMcB3WfP.js";import{a as C}from"./user_cooperation-By8boUJx.js";import Oe from"./index-r2eJ8VRN.js";import"./index-C5peaYKV.js";import"./index-iszz7Xt8.js";import"./department-jc7We_HP.js";const J=P=>(xe("data-v-0f049a2c"),P=P(),De(),P),Qe={class:"fontC-System"},Ve={class:"copyId tableSmall"},Je={class:"id oneLine beInvitationTenantId"},Ze={class:"tableBig"},Ge={class:"flex-s"},Ke={class:"fontC-System"},We={class:"fontC-System"},Xe={style:{display:"flex"},class:"table-header"},Ye=J(()=>f("span",null,"待审金额",-1)),et={class:"fontC-System"},tt={class:"fontC-System"},at={class:"table-header"},nt=J(()=>f("span",null,"个人待审金额",-1)),lt={class:"fontC-System"},ot={class:"fontC-System"},it=ge({name:"cooperation",__name:"index",setup(P){const{pagination:g,getParams:Z,onSizeChange:G,onCurrentChange:K}=ke(),m=r(!1),L=r([]),A=r(),w=r(),W=r(),S=r(!1),j=r(!1),B=r(!1),N=r("default"),u=r([]),M=r(),U=r([{label:"合作商ID",checked:!0,sortable:!0,prop:"beInvitationTenantId"},{label:"合作商名称",checked:!0,sortable:!0,prop:"beInvitationTenantName"},{label:"PM",checked:!0,sortable:!0,prop:"userName"},{label:"状态",checked:!0,sortable:!0,prop:"bindStatus"},{label:"价格比例",checked:!0,sortable:!0,prop:"priceRatio"},{label:"待审金额",checked:!0,sortable:!0,prop:"pendBalance"},{label:"可用金额",checked:!0,sortable:!0,prop:"availableBalance"},{label:"个人待审金额",checked:!0,sortable:!0,prop:"personalPendBalance"},{label:"个人可用金额",checked:!0,sortable:!0,prop:"personalAvailableBalance"},{label:"发送项目",checked:!0,sortable:!0,prop:"sendProjectType"},{label:"接收项目",checked:!0,sortable:!0,prop:"receiveProjectType"},{label:"负责部门/PM",checked:!0,sortable:!0,prop:"userName"}]),z=r();function X(a){a?z.value=a.id:z.value=""}function Y(){A.value.showEdit()}function ee(a){Ne.prompt("是否确认进行解约?","终止合作",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"说明",inputPattern:/^.{0,500}$/,inputErrorMessage:"不能超过500个字符",type:"warning"}).then(async e=>{const{data:{flag:i}}=await C.updateRescindTenant({beInvitationTenantId:a.beInvitationTenantId,remark:e.value});i&&R({type:"success",message:"已终止合作"}),I()}).catch(()=>{})}const F=r();function te(a){F.value.showEdit(a)}function ae(a){w.value.showEdit(a)}const ne=Te({});function le(a){G(a).then(()=>I())}function oe(a=1){K(a).then(()=>I())}function h(){g.value.page=1,I()}async function I(){try{m.value=!0;const a={...Z(),...ne},{data:e}=await C.list(a);L.value=e.tenantBindInfoList,g.value.total=Number(e.total),m.value=!1}catch{}finally{m.value=!1}}function ie(a){W.value=a}const se=Ie(()=>{const a=L.value.filter(_=>_.bindStatus===2);let e=L.value.filter(_=>_.bindStatus===4);e=Array.from(new Map(e.map(_=>[_.beInvitationTenantId,_])).values());const i=a.map(_=>_.beInvitationTenantId);return e.forEach(_=>{i.includes(_.beInvitationTenantId)||a.push(_)}),a});function re(a,e){M.value.showEdit(a,e)}Ce(()=>{U.value.forEach(a=>{a.checked&&u.value.push(a.prop)}),h()});const H=(a,e)=>{if(e.sendProjectType==1&&a=="手动"||e.sendProjectType==2&&a=="自动")try{m.value=!0;let i={id:e.id,chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,sendProjectType:e.sendProjectType==1?2:1,receiveProjectType:e.receiveProjectType};C.updateInvitationBindUser(i).then(()=>{m.value=!1,h(),R.success({message:"修改成功",center:!0})})}catch{}finally{m.value=!1}},q=r(),O=r(null),Q=(a,e)=>{if(O.value=e.id,JSON.parse(JSON.stringify(e)),e.receiveProjectType==1&&a=="手动")try{m.value=!0;let i={id:e.id,chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,sendProjectType:e.sendProjectType,receiveProjectType:e.receiveProjectType==1?2:1};C.updateInvitationBindUser(i).then(()=>{m.value=!1,h(),R.success({message:"修改成功",center:!0})})}catch{}finally{m.value=!1}else if(e.receiveProjectType==2&&a=="自动"){let i={chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,id:e.id};q.value.showEdit(i,"请选择负责部门/人")}};function ce(a){try{m.value=!0;let e={id:O.value,chargeUserId:a.chargeUserId,invitationType:a.invitationType,chargeUserName:a.chargeUserName,sendProjectType:a.sendProjectType,receiveProjectType:a.receiveProjectType==1?2:1};Array.isArray(e.chargeUserId)&&(e.chargeUserId=e.chargeUserId[0]),C.updateInvitationBindUser(e).then(()=>{m.value=!1,h(),R.success({message:"修改成功",center:!0})})}catch{}finally{m.value=!1}}return(a,e)=>{const i=y("el-button"),_=we,pe=Ue,ue=ze,de=y("el-row"),v=y("el-table-column"),V=y("el-text"),x=y("el-tooltip"),fe=Ae,D=Ee,E=Re,me=y("ElSpace"),_e=y("el-empty"),ve=y("el-table"),ye=y("ElPagination"),he=Le,be=Pe("loading");return s(),Se("div",{class:$({"absolute-container":o(B)})},[l(he,null,{default:n(()=>[l(de,null,{default:n(()=>[l(_,null,{default:n(()=>[l(i,{type:"primary",size:"default",onClick:Y},{default:n(()=>[c(" 邀约公司 ")]),_:1})]),_:1}),l(ue,null,{default:n(()=>[l(i,{size:"default"},{default:n(()=>[c(" 导出 ")]),_:1}),l(pe,{border:o(S),"onUpdate:border":e[0]||(e[0]=t=>T(S)?S.value=t:null),tableAutoHeight:o(B),"onUpdate:tableAutoHeight":e[1]||(e[1]=t=>T(B)?B.value=t:null),checkList:o(u),"onUpdate:checkList":e[2]||(e[2]=t=>T(u)?u.value=t:null),columns:o(U),"onUpdate:columns":e[3]||(e[3]=t=>T(U)?U.value=t:null),"line-height":o(N),"onUpdate:lineHeight":e[4]||(e[4]=t=>T(N)?N.value=t:null),stripe:o(j),"onUpdate:stripe":e[5]||(e[5]=t=>T(j)?j.value=t:null),style:{"margin-left":"12px"},onQueryData:h},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),je((s(),p(ve,{border:o(S),data:o(se),size:o(N),stripe:o(j),onSelectionChange:ie,"highlight-current-row":"",onCurrentChange:X},{empty:n(()=>[l(_e,{image:o(Be),"image-size":300},null,8,["image"])]),default:n(()=>[l(v,{align:"left",type:"selection"}),o(u).includes("bindStatus")?(s(),p(v,{key:0,align:"left",prop:"bindStatus","show-overflow-tooltip":"",label:"状态",width:"60"},{default:n(({row:t})=>[f("div",Qe,[t.bindStatus===2?(s(),p(V,{key:0,type:"success"},{default:n(()=>[c("合作")]),_:1})):d("",!0),t.bindStatus===4?(s(),p(V,{key:1,type:"danger"},{default:n(()=>[c("解约")]),_:1})):d("",!0)])]),_:1})):d("",!0),o(u).includes("bindStatus")?(s(),p(v,{key:1,align:"left",prop:"sendProjectType",label:"发送项目",width:"160"},{default:n(({row:t})=>[l(i,{type:t.sendProjectType===1?"primary":"",size:"small",onClick:k=>H("自动",t)},{default:n(()=>[c("自动 ")]),_:2},1032,["type","onClick"]),l(i,{type:t.sendProjectType===2?"primary":"",size:"small",onClick:k=>H("手动",t)},{default:n(()=>[c("手动")]),_:2},1032,["type","onClick"])]),_:1})):d("",!0),o(u).includes("receiveProjectType")?(s(),p(v,{key:2,align:"left",prop:"receiveProjectType",label:"接收项目",width:"160"},{default:n(({row:t})=>[l(i,{type:t.receiveProjectType===1?"primary":"",size:"small",onClick:k=>Q("自动",t)},{default:n(()=>[c("自动 ")]),_:2},1032,["type","onClick"]),l(i,{type:t.receiveProjectType===2?"primary":"",size:"small",onClick:k=>Q("手动",t)},{default:n(()=>[c("手动")]),_:2},1032,["type","onClick"])]),_:1})):d("",!0),o(u).includes("beInvitationTenantId")?(s(),p(v,{key:3,align:"left",prop:"beInvitationTenantId",width:"200",label:"合作商ID"},{default:n(({row:t})=>[f("div",Ve,[f("div",Je,[l(x,{effect:"dark",content:t.beInvitationTenantId,placement:"top-start"},{default:n(()=>[c(b(t.beInvitationTenantId),1)]),_:2},1032,["content"])]),l(fe,{content:t.beInvitationTenantId,class:$({rowCopy:"rowCopy",current:t.id===o(z)})},null,8,["content","class"])])]),_:1})):d("",!0),o(u).includes("beInvitationTenantName")?(s(),p(v,{key:4,align:"left",prop:"beInvitationTenantName","show-overflow-tooltip":"",width:"130",label:"合作商公司名称"},{default:n(({row:t})=>[f("div",Ze,b(t.beInvitationTenantName),1)]),_:1})):d("",!0),o(u).includes("userName")?(s(),p(v,{key:5,align:"left",prop:"userName",width:"100","show-overflow-tooltip":"",label:"负责部门"},{default:n(({row:t})=>[f("div",Ge,[f("div",Ke,b(t.userName?t.userName:"-"),1),t.projectType!==2?(s(),p(D,{key:0,onClick:k=>re(t,"chargeUserId"),class:$({edit:"edit",current:t.id===o(z)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):d("",!0)])]),_:1})):d("",!0),o(u).includes("priceRatio")?(s(),p(v,{key:6,align:"left",prop:"priceRatio","show-overflow-tooltip":"",label:"价格比例"},{default:n(({row:t})=>[f("div",We,b(t.priceRatio)+"%",1)]),_:1})):d("",!0),o(u).includes("pendBalance")?(s(),p(v,{key:7,align:"left",prop:"pendBalance",width:"95","show-overflow-tooltip":"",label:"待审金额"},{header:n(()=>[f("div",Xe,[Ye,l(x,{class:"tooltips",content:"待审金额或可用金额,是您需要给该公司支付的佣金",placement:"top"},{default:n(()=>[l(D,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1})])]),default:n(({row:t})=>[f("div",et,[l(E),c(b(t.pendBalance||0),1)])]),_:1})):d("",!0),o(u).includes("availableBalance")?(s(),p(v,{key:8,align:"left",prop:"availableBalance","show-overflow-tooltip":"",label:"可用金额"},{default:n(({row:t})=>[f("div",tt,[l(E),c(b(t.availableBalance||0),1)])]),_:1})):d("",!0),o(u).includes("personalPendBalance")?(s(),p(v,{key:9,align:"left",prop:"personalPendBalance","show-overflow-tooltip":"",width:"125",label:"个人待审金额"},{header:n(()=>[f("div",at,[nt,l(x,{class:"tooltips",content:"个人待审金额或个人可用金额,是您在该公司赚取的佣金，他需要支付给您的佣金",placement:"top"},{default:n(()=>[l(D,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1})])]),default:n(({row:t})=>[f("div",lt,[l(E),c(b(t.personalPendBalance||0),1)])]),_:1})):d("",!0),o(u).includes("personalAvailableBalance")?(s(),p(v,{key:10,align:"left",width:"120",prop:"personalAvailableBalance","show-overflow-tooltip":"",label:"个人可用金额"},{default:n(({row:t})=>[f("div",ot,[l(E),c(b(t.personalAvailableBalance||0),1)])]),_:1})):d("",!0),l(v,{align:"left",fixed:"right",prop:"i",label:"操作",width:"280"},{default:n(({row:t})=>[l(me,null,{default:n(()=>[l(i,{size:"small",type:"primary",plain:"",onClick:k=>ae(t)},{default:n(()=>[c(" 合作配置 ")]),_:2},1032,["onClick"]),t.bindStatus===2?(s(),p(i,{key:0,type:"danger",plain:"",size:"small",onClick:k=>ee(t)},{default:n(()=>[c(" 终止合作 ")]),_:2},1032,["onClick"])):d("",!0),l(i,{type:"warning",plain:"",size:"small",onClick:k=>te(t)},{default:n(()=>[c(" 财务日志 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["border","data","size","stripe"])),[[be,o(m)]]),l(ye,{"current-page":o(g).page,total:o(g).total,"page-size":o(g).size,"page-sizes":o(g).sizes,layout:o(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:le,onCurrentChange:oe},null,8,["current-page","total","page-size","page-sizes","layout"]),l(Me,{ref_key:"editRef",ref:A,onFetchData:h},null,512),l(Fe,{ref_key:"proportionRef",ref:w,onFetchData:h},null,512),l(He,{ref_key:"financialLogRef",ref:F,onFetchData:h},null,512)]),_:1}),l(Oe,{ref_key:"QuickEditRef",ref:M,onFetchData:I},null,512),l(qe,{ref_key:"userRef",ref:q,onUserData:ce},null,512)],2)}}}),bt=$e(it,[["__scopeId","data-v-0f049a2c"]]);export{bt as default};
