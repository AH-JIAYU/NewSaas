
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ne,m as j,r as u,l as ue,u as de,c as ie,n as ce,a as d,o as i,e as m,w as e,f as t,g as _,i as r,b as C,t as A,F as D,y,z as me,j as J,p as O,E as G,aH as pe,aI as fe,L as ve}from"./index-Cy3Ir7tY.js";import{a as _e}from"./department-JqcOJRQL.js";import{a as ge}from"./position_manage-ByyvKAdq.js";import{u as he}from"./tenant_role-Cqz-Dbos.js";import{u as be}from"./configuration_manager-dFS6WmdD.js";import"./configuration_role-ouZo51c8.js";const Q=g=>(pe("data-v-82bbcc3f"),g=g(),fe(),g),ye=Q(()=>y("div",{class:"card-header"},[y("div",{class:"leftTitle"},"基本信息")],-1)),Ve={class:"card-header"},ke={class:"leftTitle"},Ne={key:0,style:{"margin-left":"20px","font-size":"14px"}},we=Q(()=>y("div",{class:"card-header"},[y("div",{class:"leftTitle"},"角色信息")],-1)),xe=ne({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success","getList"],["update:modelValue"]),setup(g,{emit:W}){const X=be(),F=u([]),H=u(),Y=ue(),ee=u(),ae=he(),E=u(),z=u(),le=u(!1),Z=u(),$=u(),V=g,B=W,h=u(),L=de(g,"modelValue"),te=ie(()=>V.id===""?"新增用户":"编辑用户"),oe={children:"children",label:"name"},p=u();u([]);const l=u({id:V.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",organizationalStructureId:""}),f=u([]),x=u({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(c,o,s)=>{const n=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;l.value.phoneNumber?n.test(l.value.phoneNumber)?s():s(new Error("请输入合法手机号")):s()},trigger:"blur"}],email:[{validator:(c,o,s)=>{const n=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;l.value.email?n.test(l.value.email)?s():s(new Error("请输入合法邮箱")):s()},trigger:"blur"}]});function re(){l.value.email||(x.value.email=[],p.value.clearValidate("email")),l.value.phoneNumber||(x.value.phoneNumber=[],p.value.clearValidate("phoneNumber")),f.value=h.value.getCheckedKeys(!1);const c=h.value.getCheckedKeys(),o=h.value.getHalfCheckedKeys(),s=c.concat(o);l.value.organizationalStructureId=s[0],l.value.id?p.value&&p.value.validate(n=>{if(n){const{id:v,phoneNumber:U,email:P,password:k,name:N,country:b,active:R,type:K,role:M,positionId:T,organizationalStructureId:S,userName:q}=l.value,a={id:v,phoneNumber:U,email:P,password:k,name:N,country:b,active:R,type:K,role:M,positionId:T,organizationalStructureId:S,userName:q};$.value===a.phoneNumber&&delete a.phoneNumber,Z.value===a.email&&delete a.email,a.password||delete a.password,O.edit(a).then(()=>{G.success({message:"编辑成功",center:!0}),B("success"),I()})}}):p.value&&p.value.validate(n=>{n&&O.create(l.value).then(()=>{G.success({message:"新增成功",center:!0}),B("success"),B("getList"),I()})})}function I(){L.value=!1}const se=(c,o)=>{o?(h.value.getCheckedKeys().forEach(n=>{n!==c.id&&h.value.setChecked(n,!1)}),f.value=[c.id]):f.value=f.value.filter(s=>s!==c.id)};return ce(async()=>{f.value=[];const{data:c}=await ge.list({page:1,limit:10,id:null,name:"",active:null});H.value=c.data,F.value=await X.getStaff(),E.value=await ae.getRole();const o=await _e.list({name:""});if(z.value=o.data,ee.value=await Y.getCountry(),V.id!==""&&V.row){x.value.password=[],l.value=JSON.parse(V.row);const s=l.value.organizationalStructureId;s&&(f.value=Array.isArray(s)?s:[s]),Z.value=l.value.email,$.value=l.value.phoneNumber,le.value=!0}}),(c,o)=>{const s=d("el-input"),n=d("el-form-item"),v=d("el-col"),U=d("el-option"),P=d("el-select"),k=d("el-row"),N=d("el-card"),b=d("el-text"),R=d("el-tree"),K=d("el-radio"),M=d("el-radio-group"),T=d("ElForm"),S=d("ElButton"),q=d("ElDrawer");return i(),m(q,{modelValue:L.value,"onUpdate:modelValue":o[7]||(o[7]=a=>L.value=a),title:r(te),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:I},{footer:e(()=>[t(S,{size:"large",onClick:I},{default:e(()=>[_(" 取消 ")]),_:1}),t(S,{type:"primary",size:"large",onClick:re},{default:e(()=>[_(" 确定 ")]),_:1})]),default:e(()=>[t(T,{ref_key:"formRef",ref:p,model:r(l),rules:r(x),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[t(N,{class:"box-card"},{header:e(()=>[ye]),default:e(()=>[t(k,{gutter:24},{default:e(()=>[t(v,{span:8},{default:e(()=>[t(n,{label:"用户名",prop:"userName"},{default:e(()=>[t(s,{modelValue:r(l).userName,"onUpdate:modelValue":o[0]||(o[0]=a=>r(l).userName=a),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:e(()=>[t(n,{label:"姓名",prop:""},{default:e(()=>[t(s,{modelValue:r(l).name,"onUpdate:modelValue":o[1]||(o[1]=a=>r(l).name=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:e(()=>[t(n,{label:"手机号",prop:"phoneNumber"},{default:e(()=>[t(s,{modelValue:r(l).phoneNumber,"onUpdate:modelValue":o[2]||(o[2]=a=>r(l).phoneNumber=a),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:e(()=>[t(n,{label:"邮箱",prop:"email"},{default:e(()=>[t(s,{modelValue:r(l).email,"onUpdate:modelValue":o[3]||(o[3]=a=>r(l).email=a),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:8},{default:e(()=>[t(n,{label:"职位",prop:""},{default:e(()=>[t(P,{modelValue:r(l).positionId,"onUpdate:modelValue":o[4]||(o[4]=a=>r(l).positionId=a),placeholder:"请选择职位",clearable:"",filterable:"",onChange:o[5]||(o[5]=()=>{})},{default:e(()=>[(i(!0),C(D,null,A(r(H),a=>(i(),m(U,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"box-card"},{header:e(()=>[y("div",Ve,[y("div",ke,[_(" 部门信息"),r(l).enableChargePerson?(i(),C("span",Ne,[_("负责人:"),(i(!0),C(D,null,A(r(F),a=>(i(),m(b,{key:a.id},{default:e(()=>[a.id===r(l).id?(i(),m(b,{key:0},{default:e(()=>[_(me(a.name),1)]),_:2},1024)):J("",!0)]),_:2},1024))),128))])):J("",!0)])])]),default:e(()=>[t(k,{gutter:24},{default:e(()=>[t(n,{label:"分配部门:"},{default:e(()=>[r(z)?(i(),m(R,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:h,data:r(z),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":r(f),"default-expand-all":"",props:oe,onCheckChange:se},null,8,["data","default-checked-keys"])):(i(),m(b,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1}),t(N,{class:"box-card"},{header:e(()=>[we]),default:e(()=>[t(k,{gutter:24},{default:e(()=>[t(n,{label:"分配角色:"},{default:e(()=>{var a;return[(a=r(E))!=null&&a.length?(i(),m(M,{key:0,modelValue:r(l).role,"onUpdate:modelValue":o[6]||(o[6]=w=>r(l).role=w)},{default:e(()=>[(i(!0),C(D,null,A(r(E),w=>(i(),m(K,{key:w.id,value:w.roleName,label:w.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(i(),m(b,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Pe=ve(xe,[["__scopeId","data-v-82bbcc3f"]]);export{Pe as default};
