
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as T,r as d,ad as Z,o as $,aj as F,ai as P,a3 as p,al as J,a4 as L,i as a,b as m,j as x,g as r,w as s,O as R,P as I,c as g}from"./index-CZbucr5m.js";import{u as G}from"./tenant_role-DvoPA_6W.js";const Q=T({__name:"index",props:["id","row"],setup(O,{expose:A}){const C=d(!1),D=Z(),j=G(),U=d(),N=d(),S=O,u=d(!1),q=d(!1),c=d(),e=d({id:"",email:"",phone:"",name:"",country:"",password:"",role:null,active:!0,type:"phone"}),z=(i,o,t)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[\d]))\d{8}$/.test(e.value.phone)?t():t(new Error("请输入合法手机号"))},M=(i,o,t)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?t():t(new Error("请输入合法邮箱"))},B=()=>{e.value.phone.includes("@")?v.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:M,trigger:"blur"}]:v.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:z,trigger:"blur"}]},v=d({password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]});$(async()=>{try{u.value=!0,N.value=await D.getCountry(),U.value=await j.getRole(),u.value=!1,S.id&&(e.value=JSON.parse(S.row),v.value.password=[],C.value=!0)}catch{}finally{u.value=!1}});const k=i=>{(i!==e.value.phone||i!==e.value.email)&&(q.value=!0)};A({submit(){return new Promise(i=>{e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?c.value&&c.value.validate(o=>{if(o)try{u.value=!0,delete e.value.id,e.value.type==="phone"?delete e.value.email:delete e.value.phone,F.create(e.value).then(()=>{u.value=!1,P.success({message:"新增成功",center:!0}),h(),i()})}catch{}finally{u.value=!1}}):c.value&&c.value.validate(o=>{if(o)try{u.value=!0;const{id:t,phone:n,email:y,password:b,name:_,country:w,active:V,type:f,role:E}=e.value,l={id:t,phone:n,email:y,password:b,name:_,country:w,active:V,type:f,role:E};f==="phone"?(l.email="",delete l.email):(l.phone="",delete l.phone),l.password||delete l.password,q.value||(delete l.phone,delete l.email),F.edit(l).then(()=>{u.value=!1,P.success({message:"编辑成功",center:!0}),h(),i()})}catch{}finally{u.value=!1}})})},onCancel:h});function h(){e.value={}}return(i,o)=>{const t=p("ElInput"),n=p("ElFormItem"),y=p("ElOption"),b=p("ElSelect"),_=p("el-option"),w=p("el-select"),V=p("el-switch"),f=p("ElForm"),E=J("loading");return L((m(),x("div",null,[r(f,{ref_key:"formRef",ref:c,model:a(e),rules:a(v),"label-width":"130px"},{default:s(()=>[r(n,{label:"用户名",prop:"name"},{default:s(()=>[r(t,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(n,{label:"区域",prop:"country"},{default:s(()=>[r(b,{modelValue:a(e).country,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).country=l),placeholder:"请选择区域",clearable:"",filterable:"",tabindex:"2"},{default:s(()=>[(m(!0),x(R,null,I(a(N),l=>(m(),g(y,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(e).country==="CN"?(m(),g(n,{key:0,label:"手机号",prop:"phone"},{default:s(()=>[r(t,{modelValue:a(e).phone,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).phone=l),placeholder:"请输入手机号",onChange:k,onBlur:B},null,8,["modelValue"])]),_:1})):(m(),g(n,{key:1,label:"邮箱",prop:"email"},{default:s(()=>[r(t,{modelValue:a(e).email,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).email=l),placeholder:"请输入邮箱",onChange:k,onBlur:B},null,8,["modelValue"])]),_:1})),r(n,{label:"密码",prop:"password"},{default:s(()=>[r(t,{disabled:a(C),modelValue:a(e).password,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).password=l),placeholder:"需要修改密码时请前往当前账号个人中心"},null,8,["disabled","modelValue"])]),_:1}),r(n,{label:"角色",prop:"role"},{default:s(()=>[r(w,{modelValue:a(e).role,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).role=l),placeholder:"请选择角色"},{default:s(()=>[(m(!0),x(R,null,I(a(U),l=>(m(),g(_,{key:l.id,label:l.roleName,value:l.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"是否启用",prop:"active"},{default:s(()=>[r(V,{modelValue:a(e).active,"onUpdate:modelValue":o[6]||(o[6]=l=>a(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[E,a(u)]])}}});export{Q as _};
