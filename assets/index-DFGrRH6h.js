
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k,d as z,b6 as H,r as f,B as K,$ as P,c as J,aq as y,a as i,ai as O,aj as Q,i as n,o as b,b as A,f as u,w as d,l as W,E as X,e as x,g as I,j as Y,F as Z,n as ee,D as ae,K as le,_ as te}from"./index-Cfx4AYRq.js";import{a as C}from"./role-tdHMtgFM.js";const oe={list:()=>k.get("menu/list",{baseURL:"/mock/"}),detail:r=>k.get("menu/detail",{params:{id:r},baseURL:"/mock/"}),create:r=>k.post("menu/create",r,{baseURL:"/mock/"}),edit:r=>k.post("menu/edit",r,{baseURL:"/mock/"}),delete:r=>k.post("menu/delete",{id:r},{baseURL:"/mock/"})},ne={class:"mb-2"},se=z({__name:"index",props:{id:{default:""}},setup(r,{expose:L}){const S=r,B=H(),E=f(!1),p=f(),l=f({id:S.id,name:"",remark:"",auths:[]}),D=f({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),h=f("frontend"),v=f([]),_=f([]);K(()=>{R(),l.value.id!==""&&T()}),P(h,()=>{R()});function R(){if(h.value==="frontend"){v.value=B.routesRaw;let o=1;const e=t=>{t.forEach((a,m)=>{var g;t[m].id=o,o++,_.value.push({id:a.id,auths:a.meta.auths||[]}),((g=a==null?void 0:a.children)==null?void 0:g.length)>0&&e(a.children)})};e(v.value)}else oe.list().then(o=>{v.value=o.data;const e=t=>{t.forEach(a=>{var m;_.value.push({id:a.id,auths:a.meta.auths}),((m=a==null?void 0:a.children)==null?void 0:m.length)>0&&e(a.children)})};e(v.value)})}function T(){E.value=!0,C.detail(l.value.id).then(o=>{E.value=!1,l.value.name=o.data.name,l.value.remark=o.data.remark,l.value.auths=o.data.auths})}const V=J(()=>{const o={};return _.value.forEach(e=>{let t=0;e.auths.forEach(a=>{l.value.auths.includes(a.value)&&t++}),o[e.id]={checkAll:t===e.auths.length,indeterminate:t>0&&t<e.auths.length}}),o});function N(o,e){o?_.value.forEach(t=>{t.id===e&&t.auths.forEach(a=>{l.value.auths.includes(a.value)||l.value.auths.push(a.value)})}):_.value.forEach(t=>{t.id===e&&t.auths.forEach(a=>{l.value.auths=l.value.auths.filter(m=>m!==a.value)})})}return L({submit(){return new Promise(o=>{l.value.id===""?p.value&&p.value.validate(e=>{e&&C.create(l.value).then(()=>{y.success({message:"模拟新增成功",center:!0}),o()})}):p.value&&p.value.validate(e=>{e&&C.edit(l.value).then(()=>{y.success({message:"模拟编辑成功",center:!0}),o()})})})}}),(o,e)=>{const t=i("ElInput"),a=i("ElFormItem"),m=i("ElSwitch"),g=le,q=i("el-tooltip"),U=i("ElTableColumn"),w=i("ElCheckbox"),M=i("ElCheckboxGroup"),j=i("ElTable"),G=i("ElForm"),$=O("loading");return Q((b(),A("div",null,[u(G,{ref_key:"formRef",ref:p,model:n(l),rules:n(D),"label-width":"120px","label-suffix":"："},{default:d(()=>[u(a,{label:"名称",prop:"name"},{default:d(()=>[u(t,{modelValue:n(l).name,"onUpdate:modelValue":e[0]||(e[0]=s=>n(l).name=s),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),u(a,{label:"备注",prop:"remark"},{default:d(()=>[u(t,{modelValue:n(l).remark,"onUpdate:modelValue":e[1]||(e[1]=s=>n(l).remark=s),type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),u(a,{label:"权限"},{default:d(()=>[W("div",ne,[u(m,{modelValue:n(h),"onUpdate:modelValue":e[2]||(e[2]=s=>X(h)?h.value=s:null),"inactive-text":"前端路由数据","inactive-value":"frontend","active-text":"后端路由数据","active-value":"backend"},null,8,["modelValue"]),u(q,{content:"为方便演示，提供了路由数据分别从前端获取和后端获取的切换",placement:"top"},{default:d(()=>[u(g,{name:"i-ri:question-line",class:"ms-4"})]),_:1})]),(b(),x(j,{key:n(h),data:n(v),"row-key":"id",stripe:"","highlight-current-row":"","default-expand-all":"",border:"",style:{lineHeight:"normal"}},{default:d(()=>[u(U,{prop:"meta.title",width:"300",label:"模块"}),u(U,{label:"权限"},{default:d(({row:s})=>{var F;return[(F=s.meta.auths)!=null&&F.length?(b(),x(w,{key:0,modelValue:n(V)[s.id].checkAll,"onUpdate:modelValue":c=>n(V)[s.id].checkAll=c,indeterminate:n(V)[s.id].indeterminate,onChange:c=>N(c,s.id)},{default:d(()=>[I(" 全选 ")]),_:2},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"])):Y("",!0),u(M,{modelValue:n(l).auths,"onUpdate:modelValue":e[3]||(e[3]=c=>n(l).auths=c)},{default:d(()=>[(b(!0),A(Z,null,ee(s.meta.auths,c=>(b(),x(w,{key:c.value,label:c.value},{default:d(()=>[I(ae(c.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]}),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["model","rules"])])),[[$,n(E)]])}}}),re=te(se,[["__scopeId","data-v-e714cf7e"]]);export{re as default};
