
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as ze}from"./index-BWf1sGhp.js";import{_ as He}from"./index-DzgH5X_X.js";import{d as xe,aN as Be,r as d,l as $e,n as J,W as M,a as f,q as K,o,b as D,y as p,f as r,w as l,s as g,e as s,g as _,ay as Me,z as k,F as j,t as Te,j as m,ax as T,aG as q,i as Pe,aM as Ue,N as Fe,aO as P,E as U,p as W,_ as Ge,aH as Re,aI as Oe,L as Ze,am as Q}from"./index-imHNa2Ye.js";import{a as F}from"./department-BvK_brAI.js";import{u as Ae,D as Je}from"./index-fAGlnW6-.js";import{u as Ke}from"./position_manage-C5uUGpiJ.js";import je from"./index-k4zaTIqg.js";import qe from"./index-D2cWnKJv.js";import We from"./index-DBCYOziE.js";import Qe from"./index-TUqu0ksZ.js";import{columns as Xe}from"./index-CSZAlWE8.js";import"./index-BrANls0l.js";import"./clipboard-CGsAy0yZ.js";import"./tenant_role-EV2lg5vo.js";import"./configuration_role-BkZZHsYx.js";import"./configuration_manager-XRqLfEzd.js";import"./position_manage-8pdqNpAY.js";import"./tenantDictionary-CBQ0Cakb.js";const X=N=>(Re("data-v-a00274e4"),N=N(),Oe(),N),Ye={class:"absolute-container"},et={class:"page-main"},tt={class:"custom-tree-node"},at=["title"],lt={class:"code"},it={key:0,style:{"margin-right":"0.3rem"}},nt={class:"actions"},ot={class:"dictionary-container"},rt={class:"copyId tableSmall"},st={class:"id oneLine idFont"},ut={style:{display:"flex","align-items":"center"}},dt={key:0,xmlns:"http://www.w3.org/2000/svg",style:{"margin-top":"2px","margin-right":"7px"},width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},ct=X(()=>p("g",{id:"Group 18384"},[p("circle",{id:"Ellipse 105",cx:"10",cy:"10",r:"10",fill:"#F8BB4F"}),p("path",{id:"ç®¡",d:"M13.9946 9.3605V12.1892H7.43481V12.9031H14.6277V16.4995H13.3481V16.0146H7.43481V16.486H6.15517V9.3605H13.9946ZM7.43481 14.8831H13.3481V13.9133H7.43481V14.8831ZM7.43481 11.1655H12.7419V10.3842H7.43481V11.1655ZM15.8534 7.67677V10.2495H14.6008V8.75436H5.52209V10.2495H4.2694V7.67677H9.48222C9.37446 7.40738 9.25323 7.16492 9.13201 6.9494L10.2635 6.76083L10.0345 6.61266C10.6541 5.80447 11.1121 4.9424 11.3815 4.01298L12.6072 4.28238C12.5264 4.51136 12.4591 4.72688 12.3782 4.9424H16.1228V6.06039H13.9273C14.1428 6.35673 14.3179 6.65307 14.4661 6.92246L13.3346 7.34003C13.1191 6.90899 12.8631 6.47796 12.5668 6.06039H11.8799C11.6509 6.5049 11.3949 6.92246 11.1121 7.29962L10.4655 6.88206C10.5733 7.12451 10.6676 7.39391 10.7753 7.67677H15.8534ZM6.08782 6.06039C5.79149 6.54531 5.46821 7.00328 5.118 7.42085L4 6.72042C4.78125 5.88529 5.33351 4.96934 5.67026 3.99951L6.89601 4.26891C6.81519 4.4979 6.72091 4.72688 6.64009 4.9424H10.0345V6.06039H8.01401C8.25647 6.39714 8.47198 6.72042 8.63362 7.03022L7.46175 7.47473C7.23276 6.98981 6.97683 6.51837 6.6805 6.06039H6.08782Z",fill:"white"})],-1)),pt=[ct],vt={class:"dictionary-container"},mt=X(()=>p("div",{class:"empty"},"请在左侧新增或选择一个部门",-1)),ft=[mt],Y=xe({name:"department",__name:"list",setup(N){const{pagination:G,getParams:gt,onSizeChange:ht,onCurrentChange:_t,onSortChange:ee}=Be(),x=Ke(),te=d(),ae=$e(),le=d([]),B=Ae(),ie=d(),E=d(!1),ne=d(),R=d(),y=d({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),z=d(),oe=d(),i=d({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),O=d(),n=d({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",isClick:!1},row:"",loading:!1}),v=d({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",name:""},row:"",loading:!1}),u=d({loading:!1,search:{organizationalStructureId:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});async function S(){try{n.value.loading=!0;const e={...n.value.search},t=await F.list(e);t.data&&(n.value.tree=Z(t.data),n.value.loading=!1)}catch{}finally{n.value.loading=!1}}const Z=e=>(e.sort((t,c)=>{const H=new Date(t.createTime);return new Date(c.createTime)-H}),e.forEach(t=>{t.children&&t.children.length>0&&Z(t.children)}),e);J(()=>{S()}),M(()=>n.value.search,e=>{O.value.filter(e)});function re(e,t){return e?t.label.includes(e):!0}function se(e){n.value.currentData=e,n.value.dialog.parentId="",n.value.dialog.id="",n.value.dialog.visible=!0}function ue(e){v.value.currentData=e,v.value.dialog.parentId=(e==null?void 0:e.id)??"",v.value.dialog.name=(e==null?void 0:e.name)??"",v.value.dialog.id="",v.value.dialog.visible=!0}function de(e,t){n.value.currentNode=e,n.value.currentData=t,n.value.row=JSON.stringify(t),n.value.dialog.parentId=e.parent.data.id??"",n.value.dialog.id=t.id,n.value.dialog.visible=!0,u.value.search.organizationalStructureId&&(n.value.dialog.isClick=!0)}function ce(e,t){P.confirm(`确认删除「${t.name}」吗？`,"确认信息").then(()=>{F.delete({id:t.id}).then(()=>{U.success({message:"删除成功",center:!0}),S()})})}function pe(e){G.value.page=1,e.id&&(i.value.dialog.parentId=e.id),u.value.search.organizationalStructureId=e.id}M(()=>u.value.search.organizationalStructureId,()=>{I()});async function I(){z.value=null;try{E.value=!0;const e={...u.value.search},t=await F.itemlist(e);t.data&&(E.value=!1,i.value.dataList=t.data,u.value.dataList.forEach(c=>{c.enableLoading=!1}),G.value.total=t.data.length?t.data.length:0)}catch{}finally{E.value=!1}}J(async()=>{try{y.value.loading=!0,le.value=await ae.getCountry(),ie.value=await(B==null?void 0:B.getDepartment())||[],te.value=await(x==null?void 0:x.getPositionManage())||[],Xe.forEach(e=>{e.checked&&i.value.checkList.push(e.prop)}),y.value.loading=!1}catch{}finally{y.value.loading=!1}}),M(()=>y.value.search,e=>{ne.value.filter(e)});function ve(e){return new Promise(t=>{P.confirm(`确认${e.active?"禁用":"启用"}「${e.userName}」吗？`,"确认信息").then(()=>{try{y.value.loading=!0,W.edit({id:e.id,email:e.email,phoneNumber:e.phoneNumber,userName:e.userName,country:e.country,role:e.role,positionId:e.positionId,organizationalStructureId:e.organizationalStructureId,active:!e.active}).then(()=>(U.success({message:`${e.active?"禁用":"启用"}成功`,center:!0}),I(),y.value.loading=!1,t(!0))).catch(()=>(y.value.loading=!1,t(!1)))}catch{}finally{y.value.loading=!1}}).catch(()=>t(!1))})}function me({prop:e,order:t}){ee(e,t).then(()=>I())}function fe(e){i.value.dialog.id="",i.value.dialog.visible=!0,i.value.dialog.level=1}const ge=e=>{z.value=e[0]};function he(){if(z.value){const{userName:e,id:t}=z.value;P.confirm(`确认将「${e}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{W.reset({id:t}).then(()=>{U.success({message:"重置成功",center:!0}),I()})}).catch(()=>{})}}function _e(e){i.value.row=JSON.stringify(e),i.value.dialog.id=e.id,i.value.dialog.visible=!0}function ye(e){R.value.showEdit(e)}const $=d();function Ce(e){e?$.value=e.id:$.value=""}return(e,t)=>{const c=f("ElButton"),H=f("ElButtonGroup"),w=Ge,be=f("ElInput"),ke=f("ElTree"),Se=f("ElScrollbar"),Ie=f("ElSpace"),C=f("ElTableColumn"),Le=f("ElSwitch"),we=f("el-tooltip"),Ve=He,V=f("el-text"),De=f("el-empty"),Ne=f("ElTable"),Ee=ze,b=K("auth"),A=K("loading");return o(),D("div",Ye,[p("div",et,[r(Ee,{"hide-left-side-toggle":""},{leftSide:l(()=>[r(H,{class:"btns"},{default:l(()=>[g((o(),s(c,{type:"primary",class:"add",onClick:t[0]||(t[0]=a=>se())},{default:l(()=>[_(" 新增部门 ")]),_:1})),[[b,"department-insert-insertOrganizationalStructure"]])]),_:1}),r(be,{modelValue:n.value.search.name,"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.search.name=a),placeholder:"请输入关键词筛选",clearable:"",class:"search",onKeydown:Me(S,["enter"])},{append:l(()=>[r(c,{onClick:S},{default:l(()=>[r(w,{name:"i-ep:search"})]),_:1})]),_:1},8,["modelValue"]),r(Se,{class:"tree"},{default:l(()=>[g((o(),s(ke,{ref_key:"dictionaryRef",ref:O,data:n.value.tree,"filter-node-method":re,"default-expand-all":"",onNodeClick:pe},{default:l(({node:a,data:h})=>[p("div",tt,[p("div",{class:"label",title:a.label},k(h.name),9,at),p("div",lt,[(o(!0),D(j,null,Te(h==null?void 0:h.organizationalStructurePersonList,L=>(o(),D(j,{key:L.userId},[L.enableChargePerson==1?(o(),D("span",it,k(L.userName),1)):m("",!0)],64))),128))]),p("div",nt,[r(H,null,{default:l(()=>[g((o(),s(c,{type:"primary",plain:"",size:"default",onClick:T(L=>ue(h),["stop"])},{icon:l(()=>[r(w,{name:"i-ep:plus"})]),_:2},1032,["onClick"])),[[b,"department-insert-insertOrganizationalStructure"]]),g((o(),s(c,{type:"info",plain:"",size:"default",onClick:T(L=>de(a,h),["stop"])},{icon:l(()=>[r(w,{name:"i-ep:edit"})]),_:2},1032,["onClick"])),[[b,"department-update-updateOrganizationalStructure"]]),g((o(),s(c,{type:"danger",plain:"",size:"default",onClick:T(L=>ce(a,h),["stop"])},{icon:l(()=>[r(w,{name:"i-ep:delete"})]),_:2},1032,["onClick"])),[[b,"department-delete-deleteOrganizationalStructure"]])]),_:2},1024)])])]),_:1},8,["data","filter-node-method"])),[[A,n.value.loading]])]),_:1})]),default:l(()=>[g(p("div",ot,[r(Ie,{wrap:""},{default:l(()=>[g((o(),s(c,{type:"primary",onClick:t[2]||(t[2]=a=>fe())},{default:l(()=>[_(" 新增员工 ")]),_:1})),[[b,"department-insert-insertStaff"]]),g((o(),s(c,{onClick:he},{default:l(()=>[_(" 重置密码 ")]),_:1})),[[b,"department-update-resetPasswordStaff"]])]),_:1}),g((o(),s(Ne,{ref_key:"userItemRef",ref:oe,data:i.value.dataList,border:i.value.border,size:i.value.lineHeight,stripe:i.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:me,onSelectionChange:t[3]||(t[3]=a=>i.value.selectionDataList=a),"row-key":"id","default-expand-all":"",onSelect:ge,onCurrentChange:Ce},{empty:l(()=>[r(De,{image:Pe(Ue),"image-size":300},null,8,["image"])]),default:l(()=>[r(C,{type:"selection",align:"left",fixed:""}),i.value.checkList.includes("active")?(o(),s(C,{key:0,align:"left",prop:"active",label:"状态"},{default:l(a=>[r(Le,{modelValue:a.row.active,"onUpdate:modelValue":h=>a.row.active=h,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>ve(a.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):m("",!0),i.value.checkList.includes("id")?(o(),s(C,{key:1,align:"left",width:"180",prop:"id",label:"员工ID"},{default:l(({row:a})=>[p("div",rt,[p("div",st,[r(we,{effect:"dark",content:a.id,placement:"top-start"},{default:l(()=>[_(k(a.id),1)]),_:2},1032,["content"])]),r(Ve,{content:a.id,class:Fe({rowCopy:"rowCopy",current:a.id===$.value})},null,8,["content","class"])])]),_:1})):m("",!0),i.value.checkList.includes("userName")?(o(),s(C,{key:2,align:"left",width:"160",prop:"userName",label:"用户名"},{default:l(({row:a})=>[p("div",ut,[a.enableChargePerson===1?(o(),D("svg",dt,pt)):m("",!0),r(V,{class:"tableBig"},{default:l(()=>[_(k(a.userName?a.userName:"-"),1)]),_:2},1024)])]),_:1})):m("",!0),i.value.checkList.includes("phoneNumber")?(o(),s(C,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:l(({row:a})=>[r(V,{class:"fontC-System"},{default:l(()=>[_(k(a.phoneNumber?a.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):m("",!0),i.value.checkList.includes("email")?(o(),s(C,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:l(({row:a})=>[r(V,{class:"fontC-System"},{default:l(()=>[_(k(a.email?a.email:"-"),1)]),_:2},1024)]),_:1})):m("",!0),i.value.checkList.includes("departmentId")?(o(),s(C,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:l(({row:a})=>[r(V,{class:"fontC-System"},{default:l(()=>[_(k(a.organizationalStructureName?a.organizationalStructureName:"-"),1)]),_:2},1024)]),_:1})):m("",!0),i.value.checkList.includes("positionId")?(o(),s(C,{key:6,align:"left",prop:"positionId",label:"职位"},{default:l(({row:a})=>[r(V,{class:"fontC-System"},{default:l(()=>[_(k(a.positionName?a.positionName:"-"),1)]),_:2},1024)]),_:1})):m("",!0),r(C,{label:"操作",fixed:"right",width:"200",align:"left"},{default:l(a=>[g((o(),s(c,{type:"primary",size:"small",plain:"",onClick:h=>_e(a.row)},{default:l(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),[[b,"department-update-updateStaff"]]),g((o(),s(c,{type:"warning",size:"small",plain:"",onClick:h=>ye(a.row)},{default:l(()=>[_(" 详情 ")]),_:2},1032,["onClick"])),[[b,"department-get-getStaffList"]])]),_:1})]),_:1},8,["data","border","size","stripe"])),[[A,E.value]])],512),[[q,u.value.search.organizationalStructureId]]),g(p("div",vt,ft,512),[[q,!u.value.search.organizationalStructureId]])]),_:1}),n.value.dialog.visible?(o(),s(je,{key:0,id:n.value.dialog.id,modelValue:n.value.dialog.visible,"onUpdate:modelValue":t[4]||(t[4]=a=>n.value.dialog.visible=a),row:n.value.row,"parent-id":n.value.dialog.parentId,tree:n.value.tree,isClick:n.value.dialog.isClick,onGetList:S,onGetItmelist:I},null,8,["id","modelValue","row","parent-id","tree","isClick"])):m("",!0),v.value.dialog.visible?(o(),s(qe,{key:1,id:v.value.dialog.id,modelValue:v.value.dialog.visible,"onUpdate:modelValue":t[5]||(t[5]=a=>v.value.dialog.visible=a),row:v.value.row,"parent-id":v.value.dialog.parentId,name:v.value.dialog.name,tree:v.value.tree,onGetList:S},null,8,["id","modelValue","row","parent-id","name","tree"])):m("",!0),u.value.dialog.visible?(o(),s(We,{key:2,id:u.value.dialog.id,modelValue:u.value.dialog.visible,"onUpdate:modelValue":t[6]||(t[6]=a=>u.value.dialog.visible=a),"catalogue-id":u.value.search.organizationalStructureId,"parent-id":u.value.dialog.parentId,level:u.value.dialog.level,tree:n.value.tree,dataList:u.value.dataList,row:u.value.row,onSuccess:I},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):m("",!0),i.value.dialog.visible?(o(),s(Qe,{key:3,id:i.value.dialog.id,modelValue:i.value.dialog.visible,"onUpdate:modelValue":t[7]||(t[7]=a=>i.value.dialog.visible=a),"catalogue-id":i.value.search.catalogueId,"parent-id":i.value.dialog.parentId,level:i.value.dialog.level,tree:y.value.tree,dataList:i.value.dataList,row:i.value.row,onSuccess:I,onGetList:S},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):m("",!0),r(Je,{ref_key:"detailRef",ref:R},null,512)])])}}});typeof Q=="function"&&Q(Y);const Tt=Ze(Y,[["__scopeId","data-v-a00274e4"]]);export{Tt as default};
