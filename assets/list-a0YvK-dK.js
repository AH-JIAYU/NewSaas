
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as T,d as de,aN as ge,r as o,n as fe,a as i,q as _e,o as s,b as D,f as l,w as t,g as r,s as ve,e as u,i as _,aM as be,y as H,z as m,N as $,j as p,F as A,E as F,bb as he,bc as ye,be as Se,an as Ce,L as ze}from"./index-CFkZrq6v.js";import{_ as ke}from"./index-CdUZSmAh.js";import{_ as Le}from"./index.vue_vue_type_style_index_0_lang-e9I74YqO.js";import{_ as we}from"./index-HAuboqMR.js";import"./index-Dcx1LF-Q.js";import"./index.vue_vue_type_script_setup_true_lang-OzwWYGFc.js";import"./sortable.esm-C0-Qcoum.js";const N={queryOrganizationalStructureSettlementRecordList:d=>T.post("financial-record/queryOrganizationalStructureSettlementRecordList",d),organizationalStructureSettlement:d=>T.post("organizationalStructure/organizationalStructureSettlement",d),organizationalStructureSettlementUpdate:d=>T.post("organizationalStructure/organizationalStructureSettlementUpdate",d)},Ee={class:"copyId tableSmall"},Ie={class:"id oneLine projectId fontColor"},Te=de({name:"PMSettlement",__name:"list",setup(d){const{getParams:M,pagination:g,onSizeChange:O,onCurrentChange:q}=ge(),V=o(""),h=o(!0);o();const S=o(!1),c=o([]),C=o(!1);o(!1);const z=o("default"),k=o(!1),B=o([]),j=[{label:"待支付",value:"PENDING"},{label:"已支付",value:"PAID"},{label:"已拒绝",value:"REJECTED"}],P=o(),J=o("formSearch-PMSettlement"),L=o([{label:"部门ID",prop:"organizationalStructureId",sortable:!0,checked:!0},{label:"部门名称",prop:"name",sortable:!0,checked:!0},{label:"账单日期",prop:"createTime",sortable:!0,checked:!0},{label:"账单金额",prop:"price",sortable:!0,checked:!0},{label:"状态",prop:"status",sortable:!0,checked:!0}]),w=o({organizationalStructureId:"",status:null,time:[],startTime:null,endTime:null}),x=o([]);function G(a){B.value=a}function Q(){Object.assign(w.value,{organizationalStructureId:"",status:null,time:[],startTime:null,endTime:null})}function K(a){O(a).then(()=>v())}function E(a=1){q(a).then(()=>v())}async function v(){try{h.value=!0;const a={...M(),...w.value},n=await N.queryOrganizationalStructureSettlementRecordList(a);x.value=n.result,g.value.total=n.total,h.value=!1}catch{}finally{h.value=!1}}const W=async()=>{const{status:a}=await N.organizationalStructureSettlement({});a==1&&(F.success({message:"手动结算成功",center:!0}),v())};async function R(a,n){(await N.organizationalStructureSettlementUpdate({id:a,type:n})).status===1&&F.success({message:"操作成功"}),v()}fe(()=>{L.value.forEach(a=>{a.checked&&c.value.push(a.prop)}),v(),P.value=[{index:1,show:!0,type:"input",modelName:"organizationalStructureId",placeholder:"部门ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"status",placeholder:"状态",option:"status",optionLabel:"label",optionValue:"value"}]});const X={status:()=>j},I=o();function Y(a){a?I.value=a.id:I.value=""}return(a,n)=>{const U=we,Z=i("ElDivider"),y=i("el-button"),ee=Le,te=he,ae=ye,ne=i("el-row"),le=ke,b=i("el-table-column"),f=i("el-text"),oe=Se,se=i("ElTableColumn"),re=i("el-empty"),ie=i("el-table"),ue=i("ElPagination"),ce=Ce,pe=_e("loading");return s(),D("div",{class:$({"absolute-container":S.value})},[l(ce,null,{default:t(()=>[l(U,{formSearchList:P.value,formSearchName:J.value,onCurrentChange:E,onOnReset:Q,model:w.value,formOption:X},null,8,["formSearchList","formSearchName","model"]),l(Z,{"border-style":"dashed"}),l(ne,{gutter:24},{default:t(()=>[l(ee,null,{default:t(()=>[l(y,{size:"default",type:"primary",onClick:W},{default:t(()=>[r(" 手动结算 ")]),_:1})]),_:1}),l(ae,null,{default:t(()=>[l(y,{size:"default",onClick:n[0]||(n[0]=()=>{})},{default:t(()=>[r(" 导出 ")]),_:1}),l(te,{border:C.value,"onUpdate:border":n[1]||(n[1]=e=>C.value=e),tableAutoHeight:S.value,"onUpdate:tableAutoHeight":n[2]||(n[2]=e=>S.value=e),checkList:c.value,"onUpdate:checkList":n[3]||(n[3]=e=>c.value=e),columns:L.value,"onUpdate:columns":n[4]||(n[4]=e=>L.value=e),"line-height":z.value,"onUpdate:lineHeight":n[5]||(n[5]=e=>z.value=e),stripe:k.value,"onUpdate:stripe":n[6]||(n[6]=e=>k.value=e),style:{"margin-left":"12px"},onQueryData:E},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),ve((s(),u(ie,{ref_key:"tableSortRef",ref:V,style:{"margin-top":"10px"},"row-key":"id",data:x.value,border:C.value,size:z.value,stripe:k.value,onSelectionChange:G,"highlight-current-row":"",onCurrentChange:Y},{empty:t(()=>[l(re,{image:_(be),"image-size":300},null,8,["image"])]),default:t(()=>[c.value.includes("organizationalStructureId")?(s(),u(b,{key:0,"show-overflow-tooltip":"",align:"left",label:"部门ID"},{default:t(({row:e})=>[H("div",Ee,[H("div",Ie,m(e.organizationalStructureId?e.organizationalStructureId:"-"),1),l(le,{content:e.organizationalStructureId,class:$({rowCopy:"rowCopy",current:e.id===I.value})},null,8,["content","class"])])]),_:1})):p("",!0),c.value.includes("name")?(s(),u(b,{key:1,prop:"name","show-overflow-tooltip":"",align:"left",label:"部门名称"},{default:t(({row:e})=>[l(f,{class:"fontColor"},{default:t(()=>[r(m(e.name?e.name:"-"),1)]),_:2},1024)]),_:1})):p("",!0),c.value.includes("createTime")?(s(),u(b,{key:2,prop:"createTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:t(({row:e})=>[l(f,{class:"fontColor"},{default:t(()=>[r(m(e.createTime?e.createTime:"-"),1)]),_:2},1024)]),_:1})):p("",!0),c.value.includes("price")?(s(),u(b,{key:3,prop:"price","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:t(({row:e})=>[l(f,{class:"fontColor"},{default:t(()=>[l(oe),r(m(e.price||0),1)]),_:2},1024)]),_:1})):p("",!0),c.value.includes("status")?(s(),u(se,{key:4,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:t(({row:e})=>[e.status=="待支付"?(s(),u(f,{key:0,style:{color:"rgb(255, 172, 84)"},class:"oneLine",type:"warning"},{default:t(()=>[r(m(e.status),1)]),_:2},1024)):p("",!0),e.status=="已支付"?(s(),u(f,{key:1,style:{color:"rgb(3, 194, 57)"},class:"oneLine",type:"success"},{default:t(()=>[r(m(e.status),1)]),_:2},1024)):p("",!0),e.status=="已拒绝"?(s(),u(f,{key:2,style:{color:"rgb(251, 104, 104)"},class:"oneLine",type:"danger"},{default:t(()=>[r(m(e.status),1)]),_:2},1024)):p("",!0)]),_:1})):p("",!0),l(b,{align:"left",fixed:"right",label:"操作",width:"170"},{default:t(({row:e})=>[e.status=="待支付"?(s(),D(A,{key:0},[l(y,{size:"small",type:"primary",plain:"",onClick:me=>R(e.id,"PAID")},{default:t(()=>[r(" 支付 ")]),_:2},1032,["onClick"]),l(y,{size:"small",plain:"",type:"danger",onClick:me=>R(e.id,"REJECTED")},{default:t(()=>[r(" 拒绝 ")]),_:2},1032,["onClick"])],64)):(s(),D(A,{key:1},[r("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[pe,h.value]]),l(ue,{"current-page":_(g).page,total:_(g).total,"page-size":_(g).size,"page-sizes":_(g).sizes,layout:_(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:K,onCurrentChange:E},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),$e=ze(Te,[["__scopeId","data-v-0ed21145"]]);export{$e as default};
