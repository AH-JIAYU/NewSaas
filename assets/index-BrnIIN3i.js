
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as te,aD as ae,r as s,c as re,a as c,o as u,b as g,f as l,w as r,g as m,i as o,F as ne,t as le,e as x,y as i,z as v,j as C,A as oe,E as j,_ as se,aH as ie,aI as ce,aE as de,L as ue}from"./index-kosEbCWA.js";import{a as q}from"./user_cooperation-nzF4edOc.js";import{u as me}from"./index-BVV58a22.js";import{a as pe}from"./department-CRBo-Vyx.js";import"./index-BKeh074C.js";import"./index-Cn_KdKY1.js";const N=_=>(ie("data-v-9622dbc9"),_=_(),ce(),_),fe={style:{float:"left",width:"11.25rem"}},ye={style:{float:"center","margin-left":"55px"}},ge={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"0.8125rem"}},ve={key:0},_e={key:1},he={key:2},be={style:{display:"flex","align-items":"center"}},Ie=N(()=>i("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),Ue=N(()=>i("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),Te={style:{"margin-top":"6px","margin-bottom":"0px"}},ke={style:{display:"flex","flex-direction":"column"}},xe={style:{display:"flex","align-items":"center"}},Ce=N(()=>i("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),Ne=N(()=>i("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),we=te({__name:"index",emits:["fetch-data"],setup(_,{expose:z,emit:B}){const V=ae(),w=V.currencyType,h=s();s();const F=B,f=s(!1);s(""),s(1);const P=s(),R=s(),A={children:"children",label:"name"},t=s({form:{},tenantUserList:[],tenantStaffList:[],chargeUserId:null,departmentId:null,chargeUserName:"",rules:{beInvitationTenantId:[{required:!0,message:"请选择合作商",trigger:"change"}],priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(a,e,d)=>{if(/^(100|[1-9]?\d)$/.test(e)==!1)return d(new Error("请输入 0 到 100 之间的数字"));d()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),S=s([]);s();async function K(){t.value.form.exchangeRate=V.originalExchangeRate,t.value.form.chargeUserId="",await J(),f.value=!0;const a=await pe.list({name:""});a.data&&(S.value=a.data)}const O=(a,e)=>{e?(P.value.getCheckedKeys().forEach(y=>{y!==a.id&&P.value.setChecked(y,!1)}),t.value.form.chargeUserId=a.id,t.value.form.chargeUserName=a.name):(t.value.form.chargeUserId=[t.value.form.chargeUserId].filter(d=>d!==a.id),t.value.form.chargeUserId.length==0&&(t.value.form.chargeUserId="")),t.value.form.chargeUserId||(t.value.form.chargeUserName="")};async function J(){const a=await q.getTenantUserList({});t.value.tenantUserList=a.data.tenantUserInfoList}const E=re(()=>{const a=t.value.tenantUserList.find(e=>e.tenantId===t.value.form.beInvitationTenantId);return a?(h.value=a.currencyType,t.value.form.tenantName=a.name,t.value.form.phoneOrEmail=de.local.get("account"),[a]):[]});function L(){f.value=!1,t.value.form={},R.value.resetFields()}async function Y(){R.value.validate(a=>{if(a){let e=JSON.parse(JSON.stringify(t.value.form));if(w===h.value&&(e.exchangeRate=1),w===1?e.currencyType="USD":w===2&&(e.currencyType="CNY"),h.value===1?e.beCurrencyType="USD":h.value===2&&(e.beCurrencyType="CNY"),Array.isArray(e.chargeUserId)&&(e.chargeUserId=e.chargeUserId[0]),e.receiveProjectType==1&&!e.chargeUserId){j.warning({message:"请选择部门",center:!0});return}e.invitationType=2,e.receiveProjectType==2&&(t.value.form.chargeUserId=null,t.value.form.chargeUserName="",e.chargeUserId=null,e.chargeUserName="",e.invitationType=""),e.invitationType=2,q.addInvitationBind(e).then(d=>{d.status==-1?j.success({message:d.error,center:!0}):(j.success({message:"发送成功",center:!0}),F("fetch-data"),L())})}})}z({showEdit:K});const H=s();function M(a){t.value.form.chargeUserId=a.chargeUserId,t.value.form.invitationType=a.invitationType,t.value.form.chargeUserName=a.chargeUserName}const b=s(null),I=s(null),U=(a,e)=>{e&&(a==="发送"?(b.value=e,t.value.form.sendProjectType=e):(I.value=e,t.value.form.receiveProjectType=e))},G=()=>{b.value=null,I.value=null,t.value.form.sendProjectType=null,t.value.form.receiveProjectType=null};return(a,e)=>{const d=c("el-option"),y=c("el-select"),T=c("el-form-item"),Q=c("el-input"),k=c("el-table-column"),W=c("el-table"),D=se,$=c("el-tooltip"),p=c("el-button"),X=c("el-tree-select"),Z=c("ElForm"),ee=c("el-dialog");return u(),g("div",null,[l(ee,{modelValue:o(f),"onUpdate:modelValue":e[7]||(e[7]=n=>oe(f)?f.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"邀约公司",class:"yaoyueDrawer",onClose:G},{footer:r(()=>[l(p,{onClick:L},{default:r(()=>[m(" 关闭 ")]),_:1}),l(p,{type:"primary",onClick:Y},{default:r(()=>[m(" 发送邀约 ")]),_:1})]),default:r(()=>[l(Z,{ref_key:"formRef",ref:R,rules:o(t).rules,model:o(t).form,"label-width":"7rem",labelPosition:"left",class:"hezuoDrawer"},{default:r(()=>[l(T,{label:"公司名称",prop:"beInvitationTenantId"},{default:r(()=>[l(y,{modelValue:o(t).form.beInvitationTenantId,"onUpdate:modelValue":e[0]||(e[0]=n=>o(t).form.beInvitationTenantId=n),clearable:""},{default:r(()=>[(u(!0),g(ne,null,le(o(t).tenantUserList,n=>(u(),x(d,{key:n.tenantId,value:n.tenantId,label:n.tenantName},{default:r(()=>[i("span",fe,v(n.tenantName),1),i("span",ye,v(n.currencyType===1?"美元":"人民币"),1),i("span",ge,v(n.tenantId),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(t).form.beInvitationTenantId?(u(),x(T,{key:0,label:"价格比例",prop:"priceRatio"},{default:r(()=>[l(Q,{modelValue:o(t).form.priceRatio,"onUpdate:modelValue":e[1]||(e[1]=n=>o(t).form.priceRatio=n),clearable:"",placeholder:"请输入0-100之间的数字"},{append:r(()=>[m("%")]),_:1},8,["modelValue"])]),_:1})):C("",!0),o(E).length?(u(),x(W,{key:1,data:o(E),stripe:"",style:{"margin-bottom":"18px"}},{default:r(()=>[l(k,{prop:"name",label:"用户名"}),l(k,{prop:"tenantName",label:"公司名称"}),l(k,{prop:"country",label:"区域"}),l(k,{width:"200",label:"电子邮箱/手机号"},{default:r(({row:n})=>[n.phone?(u(),g("span",ve,v(n.phone),1)):(u(),g("span",_e,v(n.email),1))]),_:1})]),_:1},8,["data"])):C("",!0),o(t).form.beInvitationTenantId?(u(),g("div",he,[l(T,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:r(()=>[i("span",be,[l($,{effect:"dark",placement:"top-start"},{content:r(()=>[Ie,Ue]),default:r(()=>[l(D,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),m(" 发送项目 ")])]),default:r(()=>[i("div",Te,[l(p,{type:o(b)===1?"primary":"",size:"small",onClick:e[2]||(e[2]=n=>U("发送",1))},{default:r(()=>[m("自动 ")]),_:1},8,["type"]),l(p,{type:o(b)===2?"primary":"",size:"small",onClick:e[3]||(e[3]=n=>U("发送",2))},{default:r(()=>[m("手动")]),_:1},8,["type"])])]),_:1}),i("div",ke,[l(T,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:r(()=>[i("span",xe,[l($,{effect:"dark",placement:"top-start"},{content:r(()=>[Ce,Ne]),default:r(()=>[l(D,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),m(" 接收项目 ")])]),default:r(()=>[i("div",null,[l(p,{type:o(I)===1?"primary":"",size:"small",onClick:e[4]||(e[4]=n=>U("接收",1))},{default:r(()=>[m("自动 ")]),_:1},8,["type"]),l(p,{type:o(I)===2?"primary":"",size:"small",onClick:e[5]||(e[5]=n=>U("接收",2))},{default:r(()=>[m("手动")]),_:1},8,["type"])])]),_:1}),o(t).form.receiveProjectType==1?(u(),x(X,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:P,modelValue:o(t).form.chargeUserId,"onUpdate:modelValue":e[6]||(e[6]=n=>o(t).form.chargeUserId=n),data:o(S),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",style:{width:"15.625rem"},props:A,onCheckChange:O,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["modelValue","data"])):C("",!0)])])):C("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),l(me,{ref_key:"userRef",ref:H,onUserData:M},null,512)])}}}),De=ue(we,[["__scopeId","data-v-9622dbc9"]]);export{De as default};
