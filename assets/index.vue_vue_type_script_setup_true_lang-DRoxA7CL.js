
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{A as z,r as d,c as M,d as Z,l as J,au as P,E as A,a as i,al as L,am as j,i as a,o as p,b as U,f as t,w as u,F as I,n as D,e as f}from"./index-BYedTeXc.js";import{u as G}from"./otherFunctions_basicDictionary-D-35mfGW.js";import{a as H}from"./configuration_role-DMjEeAPR.js";const K=z("buttonPermission",()=>{const m=d([]),g=M(async()=>{if(m.value.length)return m.value;const{data:h}=await H.list();return h});return{role:m,getRole:g}}),Q=K,ee=Z({__name:"index",props:["id","row"],setup(m,{expose:g}){const h=G(),O=Q(),N=d(),R=d(),B=m,_=d(!1),F=d(!1),c=d(),e=d({id:"",email:"",phone:"",name:"",country:"",password:"",role:null,active:!0,type:"phone"}),T=(s,o,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?n():n(new Error("请输入合法手机号"))},$=(s,o,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?n():n(new Error("请输入合法邮箱"))},k=()=>{e.value.phone.includes("@")?b.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:$,trigger:"blur"}]:b.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:T,trigger:"blur"}]},b=d({name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]});J(async()=>{_.value=!0,R.value=await h.getCountry(),N.value=await O.getRole,_.value=!1,B.id&&(e.value=JSON.parse(B.row))});const q=s=>{(s!==e.value.phone||s!==e.value.email)&&(F.value=!0)};g({submit(){return new Promise(s=>{e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?c.value&&c.value.validate(o=>{o&&(delete e.value.id,e.value.type==="phone"?delete e.value.email:delete e.value.phone,P.create(e.value).then(()=>{A.success({message:"新增成功",center:!0}),y(),s()}))}):c.value&&c.value.validate(o=>{if(o){const{id:n,phone:r,email:E,password:V,name:w,country:x,active:C,type:v,role:S}=e.value,l={id:n,phone:r,email:E,password:V,name:w,country:x,active:C,type:v,role:S};v==="phone"?(l.email="",delete l.email):(l.phone="",delete l.phone),l.password||delete l.password,F.value||(delete l.phone,delete l.email),P.edit(l).then(()=>{A.success({message:"编辑成功",center:!0}),y(),s()})}})})},onCancel:y});function y(){e.value={}}return(s,o)=>{const n=i("ElInput"),r=i("ElFormItem"),E=i("ElOption"),V=i("ElSelect"),w=i("el-option"),x=i("el-select"),C=i("el-switch"),v=i("ElForm"),S=L("loading");return j((p(),U("div",null,[t(v,{ref_key:"formRef",ref:c,model:a(e),rules:a(b),"label-width":"130px","label-suffix":"："},{default:u(()=>[t(r,{label:"用户名",prop:"name"},{default:u(()=>[t(n,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(r,{label:"国家",prop:"country"},{default:u(()=>[t(V,{modelValue:a(e).country,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).country=l),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:u(()=>[(p(!0),U(I,null,D(a(R),l=>(p(),f(E,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(e).country==="CN"?(p(),f(r,{key:0,label:"手机号",prop:"phone"},{default:u(()=>[t(n,{modelValue:a(e).phone,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).phone=l),placeholder:"请输入手机号",onChange:q,onBlur:k},null,8,["modelValue"])]),_:1})):(p(),f(r,{key:1,label:"邮箱",prop:"email"},{default:u(()=>[t(n,{modelValue:a(e).email,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).email=l),placeholder:"请输入邮箱",onChange:q,onBlur:k},null,8,["modelValue"])]),_:1})),t(r,{label:"密码",prop:"password"},{default:u(()=>[t(n,{modelValue:a(e).password,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).password=l),placeholder:"需要修改密码时直接修改即可"},null,8,["modelValue"])]),_:1}),t(r,{label:"角色",prop:"role"},{default:u(()=>[t(x,{modelValue:a(e).role,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).role=l),placeholder:"请选择角色"},{default:u(()=>[(p(!0),U(I,null,D(a(N),l=>(p(),f(w,{key:l.id,label:l.roleName,value:l.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"是否启用",prop:"active"},{default:u(()=>[t(C,{modelValue:a(e).active,"onUpdate:modelValue":o[6]||(o[6]=l=>a(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[S,a(_)]])}}});export{ee as _,Q as u};
