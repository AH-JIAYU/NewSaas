
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ue,m as j,r as u,l as de,u as ie,c as ce,n as me,a as d,q as pe,o as i,e as p,w as e,f as t,g as h,s as fe,i as o,b as E,t as q,F as A,y as k,z as ve,j as G,p as J,E as O,aG as _e,aH as ge,L as he}from"./index-DaxZqrrB.js";import{a as ye}from"./department-Drc9pKsg.js";import{a as be}from"./position_manage-CH6g5JjZ.js";import{a as ke}from"./configuration_role-DgLYl1dR.js";import{u as Ve}from"./tenant_role-tbocg4DA.js";import{u as Ne}from"./configuration_manager-ByFsqNL9.js";const Q=y=>(_e("data-v-196c5b2c"),y=y(),ge(),y),we=Q(()=>k("div",{class:"card-header"},[k("div",{class:"leftTitle"},"基本信息")],-1)),xe={class:"card-header"},Ce={class:"leftTitle"},Ie={key:0,style:{"margin-left":"20px","font-size":"14px"}},Se=Q(()=>k("div",{class:"card-header"},[k("div",{class:"leftTitle"},"角色信息")],-1)),Ee=ue({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success","getList"],["update:modelValue"]),setup(y,{emit:W}){const X=Ne(),F=u([]),$=u(),Y=de(),ee=u();Ve();const z=u(),B=u([]),ae=u(!1),H=u(),Z=u(),V=y,L=W,f=u(null),U=ie(y,"modelValue"),le=ce(()=>V.id===""?"新增用户":"编辑用户"),te={children:"children",label:"name"},C=u(!1),v=u();u([]);const a=u({id:V.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",organizationalStructureId:""}),_=u([]),I=u({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(c,l,r)=>{const s=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;a.value.phoneNumber?s.test(a.value.phoneNumber)?r():r(new Error("请输入合法手机号")):r()},trigger:"blur"}],email:[{validator:(c,l,r)=>{const s=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a.value.email?s.test(a.value.email)?r():r(new Error("请输入合法邮箱")):r()},trigger:"blur"}]});function oe(){var c;if(a.value.email||(I.value.email=[],v.value.clearValidate("email")),a.value.phoneNumber||(I.value.phoneNumber=[],v.value.clearValidate("phoneNumber")),(c=f.value)!=null&&c.getCheckedKeys()){_.value=f.value.getCheckedKeys(!1);const l=f.value.getCheckedKeys(),r=f.value.getHalfCheckedKeys(),s=l.concat(r);a.value.organizationalStructureId=s[0]}a.value.id?v.value&&v.value.validate(l=>{if(l){const{id:r,phoneNumber:s,email:g,password:K,name:P,country:N,active:w,type:b,role:D,positionId:M,organizationalStructureId:R,userName:T}=a.value,m={id:r,phoneNumber:s,email:g,password:K,name:P,country:N,active:w,type:b,role:D,positionId:M,organizationalStructureId:R,userName:T};Z.value===m.phoneNumber&&delete m.phoneNumber,H.value===m.email&&delete m.email,m.password||delete m.password,J.edit(m).then(()=>{O.success({message:"编辑成功",center:!0}),L("success"),S()})}}):v.value&&v.value.validate(l=>{l&&J.create(a.value).then(()=>{O.success({message:"新增成功",center:!0}),L("success"),L("getList"),S()})})}function S(){U.value=!1}const se=(c,l)=>{l?(f.value.getCheckedKeys().forEach(s=>{s!==c.id&&f.value.setChecked(s,!1)}),_.value=[c.id]):_.value=_.value.filter(r=>r!==c.id)};return me(async()=>{try{C.value=!0,_.value=[];const{data:c}=await be.list({page:1,limit:10,id:null,name:"",active:null});c&&($.value=c.data),F.value=await X.getStaff();const l=await ke.list({id:null,name:""});l.data&&(z.value=l.data);const r=await ye.list({name:""});if(r.data&&(B.value=r.data),ee.value=await Y.getCountry(),V.id!==""&&V.row){I.value.password=[],a.value=JSON.parse(V.row);const s=a.value.organizationalStructureId;s&&(_.value=Array.isArray(s)?s:[s]),H.value=a.value.email,Z.value=a.value.phoneNumber,ae.value=!0}C.value=!1}catch{}finally{C.value=!1}}),(c,l)=>{const r=d("el-input"),s=d("el-form-item"),g=d("el-col"),K=d("el-option"),P=d("el-select"),N=d("el-row"),w=d("el-card"),b=d("el-text"),D=d("el-tree"),M=d("el-radio"),R=d("el-radio-group"),T=d("ElForm"),m=d("ElButton"),re=d("ElDrawer"),ne=pe("loading");return i(),p(re,{modelValue:U.value,"onUpdate:modelValue":l[7]||(l[7]=n=>U.value=n),title:o(le),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:e(()=>[t(m,{size:"large",onClick:S},{default:e(()=>[h(" 取消 ")]),_:1}),t(m,{type:"primary",size:"large",onClick:oe},{default:e(()=>[h(" 确定 ")]),_:1})]),default:e(()=>[fe((i(),p(T,{ref_key:"formRef",ref:v,model:o(a),rules:o(I),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[t(w,{class:"box-card"},{header:e(()=>[we]),default:e(()=>[t(N,{gutter:24},{default:e(()=>[t(g,{span:8},{default:e(()=>[t(s,{label:"用户名",prop:"userName"},{default:e(()=>[t(r,{modelValue:o(a).userName,"onUpdate:modelValue":l[0]||(l[0]=n=>o(a).userName=n),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(s,{label:"姓名",prop:""},{default:e(()=>[t(r,{modelValue:o(a).name,"onUpdate:modelValue":l[1]||(l[1]=n=>o(a).name=n),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(s,{label:"手机号",prop:"phoneNumber"},{default:e(()=>[t(r,{modelValue:o(a).phoneNumber,"onUpdate:modelValue":l[2]||(l[2]=n=>o(a).phoneNumber=n),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(s,{label:"邮箱",prop:"email"},{default:e(()=>[t(r,{modelValue:o(a).email,"onUpdate:modelValue":l[3]||(l[3]=n=>o(a).email=n),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(s,{label:"职位",prop:""},{default:e(()=>[t(P,{modelValue:o(a).positionId,"onUpdate:modelValue":l[4]||(l[4]=n=>o(a).positionId=n),placeholder:"请选择职位",clearable:"",filterable:"",onChange:l[5]||(l[5]=()=>{})},{default:e(()=>[(i(!0),E(A,null,q(o($),n=>(i(),p(K,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:e(()=>[k("div",xe,[k("div",Ce,[h(" 部门信息"),o(a).enableChargePerson?(i(),E("span",Ie,[h("负责人:"),(i(!0),E(A,null,q(o(F),n=>(i(),p(b,{key:n.id},{default:e(()=>[n.id===o(a).id?(i(),p(b,{key:0},{default:e(()=>[h(ve(n.name),1)]),_:2},1024)):G("",!0)]),_:2},1024))),128))])):G("",!0)])])]),default:e(()=>[t(N,{gutter:24},{default:e(()=>[t(s,{label:"分配部门:"},{default:e(()=>[o(B).length>0?(i(),p(D,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:f,data:o(B),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":o(_),"default-expand-all":"",props:te,onCheckChange:se},null,8,["data","default-checked-keys"])):(i(),p(b,{key:1},{default:e(()=>[h("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:e(()=>[Se]),default:e(()=>[t(N,{gutter:24},{default:e(()=>[t(s,{label:"分配角色:"},{default:e(()=>{var n;return[(n=o(z))!=null&&n.length?(i(),p(R,{key:0,modelValue:o(a).role,"onUpdate:modelValue":l[6]||(l[6]=x=>o(a).role=x)},{default:e(()=>[(i(!0),E(A,null,q(o(z),x=>(i(),p(M,{key:x.id,value:x.roleName,label:x.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(i(),p(b,{key:1},{default:e(()=>[h("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[ne,o(C)]])]),_:1},8,["modelValue","title"])}}}),Re=he(Ee,[["__scopeId","data-v-196c5b2c"]]);export{Re as default};
