
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as K,ae as Q,r as h,M as w,E as M,a2 as p,a as n,i as v,f as r,w as o,b as _,g as f,t as d,h as t,c as u,N as k,O as x,j,a3 as C,aG as q,k as W,ak as Y,ai as N,_ as Z,y as ee}from"./index-7OqlQ5Tf.js";import{a as V}from"./projectManagement_scheduling-pvop8hin.js";import{o as D,s as U}from"./apiLoading-Cx6WB2ya.js";const te={style:{"flex-shrink":"0"}},le={style:{position:"absolute",left:"50%",transform:"translateX(-50%)"}},ae={style:{"flex-shrink":"0",color:"var(--el-text-color-secondary)","font-size":"13px"}},oe={style:{flex:"auto"}},re=K({name:"Edit",__name:"index",emits:["fetch-data"],setup(se,{expose:A,emit:z}){const{t:s}=Q(),B=z,g=h(),O=w({projectId:[{required:!0,message:M(()=>s("schedulingEdit.projectSelect")),trigger:"change"}],dispatchType:[{required:!0,message:"请选择调度类型",trigger:"change"}],dataType:[{required:!0,message:"请选择调度目标",trigger:"change"}],groupSupplierId:[{required:!0,message:"请选择至少一个",trigger:"change"}],doMoneyPrice:[{required:!0,message:M(()=>s("schedulingEdit.enterPrice")),trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}),c=h(!1),e=w({title:"",projectList:[],memberGroupNameInfoList:[],supplierNameInfoList:[],form:{projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},selectAll:{supplier:!1,member:!1}});async function R(i,a){const I=await D(V.getProjectList({}));e.projectList=I.data.getNotDispatchProjectInfoList,a?i.isDispatch===1?N.warning({message:"该项目已经调度，请前往「项目调度」进行编辑",center:!0}):(e.title="新增",e.form.projectId=i.projectId,await L(i.projectId),c.value=!0):(i?(e.title="编辑",e.form=Y(i),e.form.groupSupplierId=i.getGroupSupplierIdNameInfoList.map(y=>y.groupSupplierId),await L(i.projectId)):e.title="新增",c.value=!0)}const L=async i=>{if(i){const a=await D(V.getAllocationGroupOrSupplier({projectId:i}));e.memberGroupNameInfoList=a.data.getAllocationMemberGroupNameInfoList,e.supplierNameInfoList=a.data.getAllocationSupplierNameInfoList,e.supplierNameInfoList.length&&!e.memberGroupNameInfoList.length&&(e.form.dataType=1),!e.supplierNameInfoList.length&&e.memberGroupNameInfoList.length&&(e.form.dataType=2)}},$=()=>{e.form.groupSupplierId=[],g.value.clearValidate(["groupSupplierId"])};function T(){g.value.resetFields(),e.form={projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},c.value=!1}function F(){g.value&&g.value.validate(async i=>{if(!e.form.dataType){N.warning({message:s("schedulingEdit.warning"),center:!0});return}if(i){if(e.title==="新增"){const{status:a}=await U(V.create(e.form));a===1&&N.success({message:"新增成功"})}else{const{status:a}=await U(V.edit(e.form));a===1&&N.success({message:"修改成功"})}T(),B("fetch-data")}})}return h(1),h([]),A({showEdit:R}),(i,a)=>{const I=Z,y=p("el-tooltip"),b=p("el-radio"),G=p("el-radio-group"),m=p("el-form-item"),S=p("el-option"),E=p("el-select"),H=p("el-input"),X=p("el-form"),P=p("el-button"),J=p("el-dialog");return n(),v("div",null,[r(J,{modelValue:t(c),"onUpdate:modelValue":a[6]||(a[6]=l=>W(c)?c.value=l:null),title:t(e).title,width:"600","before-close":T},{footer:o(()=>[_("div",oe,[r(P,{onClick:T},{default:o(()=>[f(d(t(s)("schedulingEdit.cancel")),1)]),_:1}),r(P,{type:"primary",onClick:F},{default:o(()=>[f(d(t(s)("schedulingEdit.confirm")),1)]),_:1})])]),default:o(()=>[r(X,{ref_key:"formRef",ref:g,"label-width":"104px",style:{position:"relative"},model:t(e).form,rules:t(O),inline:!1},{default:o(()=>[r(m,{label:t(s)("schedulingEdit.types"),prop:"dispatchType",style:{"align-items":"center"}},{default:o(()=>[r(G,{modelValue:t(e).form.dispatchType,"onUpdate:modelValue":a[0]||(a[0]=l=>t(e).form.dispatchType=l),class:"ml-4"},{default:o(()=>[r(b,{value:1,size:"large"},{default:o(()=>[f(d(t(s)("schedulingEdit.assignmentOff"))+" ",1),r(y,{class:"tooltips",content:t(s)("schedulingEdit.tip1"),placement:"top"},{default:o(()=>[r(I,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1},8,["content"])]),_:1}),r(b,{value:2,size:"large"},{default:o(()=>[f(d(t(s)("schedulingEdit.specifiedPrice"))+" ",1),r(y,{class:"tooltips",content:t(s)("schedulingEdit.tip2"),placement:"top"},{default:o(()=>[r(I,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1},8,["content"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(e).title==="新增"?(n(),u(m,{key:0,label:t(s)("schedulingEdit.projectIDName"),prop:"projectId"},{default:o(()=>[r(E,{placeholder:"",modelValue:t(e).form.projectId,"onUpdate:modelValue":a[1]||(a[1]=l=>t(e).form.projectId=l),clearable:"",filterable:"",onChange:L},{default:o(()=>[(n(!0),v(k,null,x(t(e).projectList,l=>(n(),u(S,{key:l.projectId,label:l.projectName,value:l.projectId,style:{display:"flex","justify-content":"space-between","align-items":"center",position:"relative"}},{default:o(()=>[_("span",te,d(l.projectName),1),_("span",le,d(l.projectType===1?t(s)("schedulingEdit.internalAddition"):t(s)("schedulingEdit.tenantAllocation")),1),_("span",ae,d(l.projectId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):j("",!0),C(_("div",null,[C(r(m,{prop:"dataType",label:"调度目标",style:{"align-items":"center"}},{default:o(()=>[r(G,{modelValue:t(e).form.dataType,"onUpdate:modelValue":a[2]||(a[2]=l=>t(e).form.dataType=l),class:"ml-4",onChange:$},{default:o(()=>[r(b,{value:1,size:"large"},{default:o(()=>[f(" 供应商 ")]),_:1}),r(b,{value:2,size:"large"},{default:o(()=>[f(" 内部站 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[q,t(e).supplierNameInfoList.length&&t(e).memberGroupNameInfoList.length]]),t(e).supplierNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===1?(n(),u(m,{key:0,label:"供应商",prop:"groupSupplierId"},{default:o(()=>[r(E,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":a[3]||(a[3]=l=>t(e).form.groupSupplierId=l),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:o(()=>[(n(!0),v(k,null,x(t(e).supplierNameInfoList,l=>(n(),u(S,{key:l.projectId,label:l.supplierName,value:l.supplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):j("",!0),t(e).memberGroupNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===2?(n(),u(m,{key:1,label:"部门",prop:"groupSupplierId"},{default:o(()=>[r(E,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":a[4]||(a[4]=l=>t(e).form.groupSupplierId=l),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:o(()=>[(n(!0),v(k,null,x(t(e).memberGroupNameInfoList,l=>(n(),u(S,{key:l.projectId,label:l.memberGroupName,value:l.memberGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):j("",!0)],512),[[q,t(e).form.projectId]]),t(e).form.dispatchType===2?(n(),u(m,{key:1,label:t(s)("schedulingEdit.specifiedPrice"),prop:"doMoneyPrice"},{default:o(()=>[r(H,{placeholder:"",modelValue:t(e).form.doMoneyPrice,"onUpdate:modelValue":a[5]||(a[5]=l=>t(e).form.doMoneyPrice=l),clearable:""},null,8,["modelValue"])]),_:1},8,["label"])):j("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),de=ee(re,[["__scopeId","data-v-1a7866b4"]]);export{de as default};
