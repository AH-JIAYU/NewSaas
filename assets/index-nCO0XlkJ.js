
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import E from"./index-WxKbLxyf.js";import{k as u,d as V,r as s,a0 as D,a1 as f,a as g,o as S,b as z,f as n,w as i,g as p,i as I,ai as h,_ as O}from"./index-BTcEBOVJ.js";const R={list:a=>u.post("project/getProjectList",a),create:a=>u.post("project/addProject",a),edit:a=>u.post("project/updateProject",a),detail:a=>u.post("project/getProject",a)},B=V({name:"ProjeckEdit",__name:"index",emits:["fetch-data"],setup(a,{expose:j,emit:T}){const y=T,c=s(!1),v=s(""),r=s([]);function P(e){r.value.push(e)}D("validateTopTabs",P);const d=s([]);let o=f([]);const m=s();async function k(e){e?(v.value="编辑",w(e)):(v.value="添加",o=f([{name:"项目名称",addProjectQuotaInfoList:[]}])),c.value=!0}function w(e){o.length=0,o.push({...e}),e.children&&e.children.length&&e.children.forEach(t=>{o.push({...t})})}async function _(){const e=[];r.value.forEach(l=>{e.push(l.validate())});const t=await Promise.allSettled(e);d.value=t.map(l=>l.status)}async function x(){if(await _(),d.value.every(e=>e==="fulfilled")){const e=o[0];e.addProjectInfoList=o.slice(1),console.log("masterData",e);const{status:t}=await R.create(e);t===1&&h.success({message:"新增成功",center:!0})}else m.value.activeLeftTab=d.value.indexOf("rejected"),h.warning({message:"请完善表单",center:!0})}function b(){o=f([]),y("fetch-data"),c.value=!1,r.value=[]}return j({showEdit:k}),(e,t)=>{const l=g("el-button"),L=g("el-drawer");return S(),z("div",null,[n(L,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=C=>c.value=C),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:"",onClose:b},{footer:i(()=>[n(l,{onClick:b},{default:i(()=>[p(" 取消 ")]),_:1}),n(l,{type:"warning",onClick:t[0]||(t[0]=()=>{})},{default:i(()=>[p(" 暂存 ")]),_:1}),n(l,{type:"primary",onClick:x},{default:i(()=>[p(" 确定 ")]),_:1})]),default:i(()=>[n(E,{onValidate:_,ref_key:"LeftTabsRef",ref:m,"left-tabs-data":I(o),"validate-top-tabs":r.value,"validate-all":d.value},null,8,["left-tabs-data","validate-top-tabs","validate-all"])]),_:1},8,["modelValue"])])}}}),M=O(B,[["__scopeId","data-v-cc80017c"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));export{M as P,R as a,H as i};
