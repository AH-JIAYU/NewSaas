
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as P}from"./configuration_role-BLtAuSGa.js";import{x as G,ag as H,r as c,d as M,bo as T,k as j,an as J,E as K,a as v,p as O,q as z,i as s,o as _,b as C,f as k,w as f,e as I,s as E,H as R,F as D,t as Q,g as W,j as V,R as X}from"./index-DntS7RPX.js";const Y={list:()=>G.get("role/getRoleButton")},Z=H("buttonPermission",()=>{const p=c([]);return{permissions:p,getPermissions:async()=>{if(p.value.length)return p.value;const{data:h}=await Y.list();return p.value=h,h}}}),ee=Z,te={class:"custom-tree-node"},oe={class:"menu"},se={class:"permission"},le={key:0,class:"permissions"},ae=M({__name:"index",props:["id","row"],setup(p,{expose:N}){const h=p,B=T(),U=ee(),m=c(!1),g=c(),y=c(),F=c([]),r=c([]),t=c({id:h.id??null,menuId:[],permission:[],roleName:"",remark:""}),$=c({roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]});j(async()=>{try{m.value=!0,t.value.id!==""&&await q(),r.value=await U.getPermissions(),F.value=B.routesRaw,m.value=!1}catch{}finally{m.value=!1}});async function q(){m.value=!0;const{menuId:o,...e}=JSON.parse(h.row);t.value=e;const i=await B.obtainLevel1AndLevel2Routing();t.value.menuId=o.filter(a=>!i.some(l=>l.id===a)),m.value=!1}function L(o){var e;return(e=r==null?void 0:r.value)==null?void 0:e.filter(i=>o===i.menuId)}const A=o=>{const e=[];e.push(o),y.value.getNode(o.id).checked?e.map(a=>{var n;const l=(n=r==null?void 0:r.value)==null?void 0:n.filter(u=>a.id===u.menuId);l&&l.length&&l.forEach(u=>{t.value.permission.push(u.id)})}):e.map(a=>{var n;const l=(n=r==null?void 0:r.value)==null?void 0:n.filter(u=>a.id===u.menuId);if(l&&l.length){let u=l.map(b=>b.id);t.value.permission=t.value.permission.filter(b=>!u.some(x=>x===b))}})};return N({submit(){const o=J(t.value);return o.menuId=y.value.getCheckedKeys(!1),new Promise(e=>{const i=y.value.getCheckedKeys(),a=y.value.getHalfCheckedKeys(),l=i.concat(a);o.menuId=l,o.id===""?g.value&&g.value.validate(n=>{n&&P.create(o).then(()=>{K.success({message:"新增成功",center:!0}),e()})}):g.value&&g.value.validate(n=>{n&&P.edit(o).then(()=>{K.success({message:"编辑成功",center:!0}),e()})})})}}),(o,e)=>{const i=v("ElInput"),a=v("ElFormItem"),l=v("ElCheckbox"),n=v("ElCheckboxGroup"),u=v("el-tree"),b=v("ElForm"),x=O("loading");return z((_(),C("div",null,[k(b,{ref_key:"formRef",ref:g,model:s(t),rules:s($),"label-width":"120px"},{default:f(()=>[k(a,{label:"角色名称",prop:"roleName"},{default:f(()=>[k(i,{modelValue:s(t).roleName,"onUpdate:modelValue":e[0]||(e[0]=d=>s(t).roleName=d),disabled:!!s(t).id,placeholder:"请输入角色名称"},null,8,["modelValue","disabled"])]),_:1}),k(a,{label:"备注",prop:"remark"},{default:f(()=>[k(i,{modelValue:s(t).remark,"onUpdate:modelValue":e[1]||(e[1]=d=>s(t).remark=d),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),s(m)?V("",!0):(_(),I(a,{key:0,label:"权限"},{default:f(()=>[s(t).menuId?(_(),I(u,{key:0,ref_key:"treeRef",ref:y,data:s(F),style:{width:"100%"},"default-checked-keys":s(t).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"",onCheckChange:A,"default-expand-all":"",border:""},{default:f(({data:d})=>{var S;return[E("div",te,[E("div",oe,R(d.meta.title)+" "+R(d.id),1),E("div",se,[(S=L(d.id))!=null&&S.length?(_(),C("div",le,[k(n,{modelValue:s(t).permission,"onUpdate:modelValue":e[2]||(e[2]=w=>s(t).permission=w)},{default:f(()=>[(_(!0),C(D,null,Q(L(d.id),w=>(_(),I(l,{key:w.id,value:w.id},{default:f(()=>[W(R(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):V("",!0)])])]}),_:1},8,["data","default-checked-keys"])):V("",!0)]),_:1}))]),_:1},8,["model","rules"])])),[[x,s(m)]])}}}),ie=X(ae,[["__scopeId","data-v-837a31fa"]]);export{ie as default};
