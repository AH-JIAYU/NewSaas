
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Y,l as ee,$ as le,r as p,a3 as T,a4 as ae,n as te,a as s,o as f,b as C,f as e,w as l,i as t,ar as oe,F as U,t as P,e as h,y as v,g as I,A as ne,_ as re}from"./index-KzkPapPJ.js";import{u as de,v as se}from"./index-giPJRfwf.js";import{u as ue}from"./survey_vipGroup-BFaS2iUm.js";import{a as ie}from"./survey_vip_department-Wec0vftb.js";const me=v("div",{class:"card-header"},[v("span",null,"基本信息")],-1),ce=v("div",{class:"card-header"},[v("span",null,"权限信息")],-1),pe={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"0 1rem"}},fe=v("div",{class:"card-header"},[v("div",{class:"leftTitle"}," 部门信息 ")],-1),ye=Y({__name:"index",props:{leftTab:Object,tabIndex:Number},setup(B){const R=ee(),z=de();ue();const K=le("validateTopTabs"),q=B,b=p(),m=p([]),x=p([]),L=p("basicSettings"),w=p(),V=T({vipLevelList:[],vipGroupList:[],countryList:[]}),$={children:"children",label:"name"},c=T({memberNickname:[{required:!0,message:"请输入会员昵称",trigger:"blur"},{min:2,max:50,message:"内容在2-50个字之间",trigger:"blur"}],memberLevelId:[{required:!0,message:"请选择会员等级",trigger:"change"}],subordinateCountryId:[{required:!0,message:"请选择区域",trigger:"change"}]}),j=(i,n,u)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(o.value.memberPhone)?u():u(new Error("请输入合法手机号"))},F=(i,n,u)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(o.value.emailAddress)?u():u(new Error("请输入合法邮箱"))},N=i=>{i&&(o.value.countryType=i==="343"?1:2,i==="343"?(c.emailAddress&&delete c.emailAddress,c.memberPhone=[{required:!0,message:"请输入手机号码",trigger:"blur"},{validator:j,trigger:"blur"}]):(c.memberPhone&&delete c.memberPhone,c.emailAddress=[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:F,trigger:"blur"}]))},G=(i,n)=>{n?(b.value.getCheckedKeys().forEach(g=>{g!==i.id&&b.value.setChecked(g,!1)}),m.value=[i.id]):m.value=m.value.filter(_=>_!==i.id),m.value=b.value.getCheckedKeys(!1);const u=b.value.getCheckedKeys(),r=b.value.getHalfCheckedKeys(),d=u.concat(r);o.value.organizationalStructureId=d[0]},E=async()=>{V.vipLevelList=await z.getLevelNameList()},O=async()=>{await E();const i=await ie.list({name:""});x.value=i.data,V.countryList=await R.getCountry()},A=p(null),o=p(q.leftTab);m.value=[],o.value.organizationalStructureId&&m.value.push(o.value.organizationalStructureId),ae(()=>{K(A.value)});const Z=()=>{w.value.showEdit()};return te(async()=>{await O(),N(o.value.subordinateCountryId)}),(i,n)=>{const u=s("el-input"),r=s("el-form-item"),d=s("el-col"),_=s("el-option"),g=s("el-select"),k=s("el-row"),S=s("el-card"),y=s("el-switch"),D=s("el-divider"),H=re,M=s("el-button"),Q=s("el-tree"),J=s("el-text"),W=s("el-tab-pane"),X=s("el-tabs");return f(),C("div",null,[e(X,{modelValue:t(L),"onUpdate:modelValue":n[11]||(n[11]=a=>ne(L)?L.value=a:null)},{default:l(()=>[e(W,{label:"会员信息",name:"basicSettings"},{default:l(()=>[e(t(oe),{ref_key:"formRef",ref:A,model:t(o),rules:t(c),"label-width":"100px","validate-on-rule-change":!1},{default:l(()=>[e(S,{class:"box-card"},{header:l(()=>[me]),default:l(()=>[e(k,{gutter:24},{default:l(()=>[e(d,{span:8},{default:l(()=>[e(r,{label:"会员名称",prop:"memberNickname"},{default:l(()=>[e(u,{modelValue:t(o).memberNickname,"onUpdate:modelValue":n[0]||(n[0]=a=>t(o).memberNickname=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(r,{label:"所属区域",prop:"subordinateCountryId"},{default:l(()=>[e(g,{clearable:"",filterable:"",modelValue:t(o).subordinateCountryId,"onUpdate:modelValue":n[1]||(n[1]=a=>t(o).subordinateCountryId=a),onChange:N},{default:l(()=>[(f(!0),C(U,null,P(t(V).countryList,a=>(f(),h(_,{key:a.id,value:a.id,label:a.chineseName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(r,{label:"会员姓名"},{default:l(()=>[e(u,{clearable:"",modelValue:t(o).memberName,"onUpdate:modelValue":n[2]||(n[2]=a=>t(o).memberName=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(r,{label:"手机号码",prop:"memberPhone"},{default:l(()=>[e(u,{clearable:"",modelValue:t(o).memberPhone,"onUpdate:modelValue":n[3]||(n[3]=a=>t(o).memberPhone=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(r,{label:"电子邮箱",prop:"emailAddress"},{default:l(()=>[e(u,{clearable:"",modelValue:t(o).emailAddress,"onUpdate:modelValue":n[4]||(n[4]=a=>t(o).emailAddress=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(r,{label:"初始密码"},{default:l(()=>[e(u,{clearable:"",value:"123456",disabled:""})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{class:"box-card"},{header:l(()=>[ce]),default:l(()=>[e(k,{gutter:20},{default:l(()=>[e(d,{span:4},{default:l(()=>[e(r,{label:"会员状态"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:t(o).memberStatus,"onUpdate:modelValue":n[5]||(n[5]=a=>t(o).memberStatus=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:4},{default:l(()=>[e(r,{label:"B2B"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:t(o).b2bStatus,"onUpdate:modelValue":n[6]||(n[6]=a=>t(o).b2bStatus=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:4},{default:l(()=>[e(r,{label:"B2C"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:t(o).b2cStatus,"onUpdate:modelValue":n[7]||(n[7]=a=>t(o).b2cStatus=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:5},{default:l(()=>[e(r,{label:"免审"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:t(o).exemptionTrial,"onUpdate:modelValue":n[8]||(n[8]=a=>t(o).exemptionTrial=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:4},{default:l(()=>[e(r,{label:"随机身份"},{default:l(()=>[e(y,{"active-value":2,"inactive-value":1,modelValue:t(o).randomStatus,"onUpdate:modelValue":n[9]||(n[9]=a=>t(o).randomStatus=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(D,{"content-position":"center"}),e(k,{gutter:20},{default:l(()=>[e(d,{span:8},{default:l(()=>[e(r,{label:"会员等级",prop:"memberLevelId"},{default:l(()=>[e(g,{clearable:"",filterable:"",modelValue:t(o).memberLevelId,"onUpdate:modelValue":n[10]||(n[10]=a=>t(o).memberLevelId=a)},{empty:l(()=>[v("div",pe,[I(" 暂无数据 "),e(M,{type:"primary",link:"",onClick:Z,size:"small"},{default:l(()=>[I(" 快捷新增 "),e(H,{name:"ant-design:plus-outlined",color:"#fff",style:{"background-color":"var(--el-color-primary)","border-radius":"50%",padding:"2px",margin:"0 2px"}})]),_:1})])]),default:l(()=>[(f(!0),C(U,null,P(t(V).vipLevelList,a=>(f(),h(_,{key:a.memberLevelId,value:a.memberLevelId,label:a.levelNameOrAdditionRatio},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{class:"box-card"},{header:l(()=>[fe]),default:l(()=>[e(k,{gutter:24},{default:l(()=>[e(r,{label:"分配部门:"},{default:l(()=>[t(x).length>0?(f(),h(Q,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:b,data:t(x),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":t(m),"default-expand-all":"",props:$,onCheckChange:G},null,8,["data","default-checked-keys"])):(f(),h(J,{key:1},{default:l(()=>[I("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"]),e(se,{ref_key:"EditRef",ref:w,onQueryData:E},null,512)])}}});export{ye as _};
