
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{af as pe,r as m,d as me,m as Q,ao as ce,u as fe,c as ge,k as ve,a as r,o as d,e as g,w as a,f as t,g as N,i as n,b as E,t as I,F as x,l as W,E as X,aJ as _e,aK as be,s as v,R as Ve}from"./index-Bb0m2dFC.js";import{a as ye}from"./department-X2eokLS7.js";import{u as he}from"./department-nn4nOTAF.js";import{u as we}from"./tenant_role-l46kc0gn.js";import{a as Ee}from"./position_manage-ZHFGIM1v.js";const Ie=pe("PositionManage",()=>{const c=m([]);return{PositionManage:c,getPositionManage:async()=>{if(c.value.length)return c.value;const{data:_}=await Ee.list({page:1,limit:10,id:null,name:"",active:null});return c.value=_.data,_.data}}}),xe=Ie,z=c=>(_e("data-v-dd8a3639"),c=c(),be(),c),Se=z(()=>v("div",{class:"card-header"},[v("div",{class:"leftTitle"},"基本信息")],-1)),Ce=z(()=>v("div",{class:"card-header"},[v("div",{class:"leftTitle"},"角色信息")],-1)),Me=z(()=>v("div",{class:"card-header"},[v("div",{class:"leftTitle"},[N(" 小组信息"),v("span",{style:{"margin-left":"20px","font-size":"14px"}},"负责人:迪迦")])],-1)),ke=me({__name:"index",props:Q({catalogueId:{default:""},parentId:{default:""},id:{default:""},tree:{},dataList:{},row:{},level:{default:1}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:Q(["success"],["update:modelValue"]),setup(c,{emit:T}){const _=m([]),Y=xe(),A=m(),ee=ce(),L=m(),le=we(),R=m(),ae=he(),O=m(),F=m(!1),$=m(!1),b=c,j=T,P=fe(c,"modelValue"),te=ge(()=>b.id===""?"新增用户":"编辑用户"),V=m(),oe=m([]),e=m({id:b.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),ne=(i,o,s)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?s():s(new Error("请输入合法手机号"))},re=(i,o,s)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?s():s(new Error("请输入合法邮箱"))},J=()=>{e.value.phone.includes("@")?S.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:re,trigger:"blur"}]:S.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:ne,trigger:"blur"}]},S=m({userName:[{required:!0,message:"请输入用户名"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]}),Z=i=>{(i!==e.value.phone||i!==e.value.email)&&($.value=!0)},G=async i=>{const{data:o}=await ye.departmentGroup({id:i});_.value=o};function se(){e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?V.value&&V.value.validate(i=>{i&&(delete e.value.id,e.value.type==="phone"?delete e.value.email:delete e.value.phone,W.create(e.value).then(()=>{X.success({message:"新增成功",center:!0}),j("success"),C()}))}):V.value&&V.value.validate(i=>{if(i){const{id:o,phone:s,email:u,password:f,name:U,country:B,active:M,type:y,role:q,groupId:D,positionId:h,departmentId:w,userName:k}=e.value,p={id:o,phone:s,email:u,password:f,name:U,country:B,active:M,type:y,role:q,groupId:D,positionId:h,departmentId:w,userName:k};y==="phone"?(p.email="",delete p.email):(p.phone="",delete p.phone),p.password||delete p.password,$.value||(delete p.phone,delete p.email),W.edit(p).then(()=>{X.success({message:"编辑成功",center:!0}),j("success"),C()})}})}function C(){P.value=!1}const K=i=>i.reduce((o,s)=>Array.isArray(s)?o.concat(K(s)):o.concat(s),[]);return ve(async()=>{A.value=await Y.PositionManage,R.value=await le.getRole(),O.value=await ae.department,L.value=await ee.getCountry(),b.id!==""&&b.row&&(S.value.password=[],e.value=JSON.parse(b.row),G(e.value.departmentId),F.value=!0),oe.value=K(b.dataList)}),(i,o)=>{const s=r("el-input"),u=r("el-form-item"),f=r("el-col"),U=r("ElOption"),B=r("ElSelect"),M=r("el-option"),y=r("el-select"),q=r("ElInput"),D=r("el-switch"),h=r("el-row"),w=r("el-card"),k=r("el-radio"),p=r("el-radio-group"),ue=r("el-text"),de=r("ElForm"),H=r("ElButton"),ie=r("ElDrawer");return d(),g(ie,{modelValue:P.value,"onUpdate:modelValue":o[12]||(o[12]=l=>P.value=l),title:n(te),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:C},{footer:a(()=>[t(H,{size:"large",onClick:C},{default:a(()=>[N(" 取消 ")]),_:1}),t(H,{type:"primary",size:"large",onClick:se},{default:a(()=>[N(" 确定 ")]),_:1})]),default:a(()=>[t(de,{ref_key:"formRef",ref:V,model:n(e),rules:n(S),"label-width":"100px"},{default:a(()=>[t(w,{class:"box-card"},{header:a(()=>[Se]),default:a(()=>[t(h,{gutter:24},{default:a(()=>[t(f,{span:8},{default:a(()=>[t(u,{label:"用户名",prop:"userName"},{default:a(()=>[t(s,{modelValue:n(e).userName,"onUpdate:modelValue":o[0]||(o[0]=l=>n(e).userName=l),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"姓名",prop:"name"},{default:a(()=>[t(s,{modelValue:n(e).name,"onUpdate:modelValue":o[1]||(o[1]=l=>n(e).name=l),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"国家",prop:"country"},{default:a(()=>[t(B,{modelValue:n(e).country,"onUpdate:modelValue":o[2]||(o[2]=l=>n(e).country=l),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:a(()=>[(d(!0),E(x,null,I(n(L),l=>(d(),g(U,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(e).country==="CN"?(d(),g(f,{key:0,span:8},{default:a(()=>[t(u,{label:"手机号",prop:"phone"},{default:a(()=>[t(s,{modelValue:n(e).phone,"onUpdate:modelValue":o[3]||(o[3]=l=>n(e).phone=l),placeholder:"请输入手机号",clearable:"",onChange:Z,onBlur:J},null,8,["modelValue"])]),_:1})]),_:1})):(d(),g(f,{key:1,span:8},{default:a(()=>[t(u,{label:"邮箱",prop:"email"},{default:a(()=>[t(s,{modelValue:n(e).email,"onUpdate:modelValue":o[4]||(o[4]=l=>n(e).email=l),placeholder:"请输入邮箱",clearable:"",onChange:Z,onBlur:J},null,8,["modelValue"])]),_:1})]),_:1})),t(f,{span:8},{default:a(()=>[t(u,{label:"部门"},{default:a(()=>[t(y,{modelValue:n(e).departmentId,"onUpdate:modelValue":o[5]||(o[5]=l=>n(e).departmentId=l),placeholder:"请选择部门",disabled:n(e).id!=="",clearable:"",filterable:"",onChange:G},{default:a(()=>[(d(!0),E(x,null,I(n(O),l=>(d(),g(M,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"职位",prop:"positionId"},{default:a(()=>[t(y,{modelValue:n(e).positionId,"onUpdate:modelValue":o[6]||(o[6]=l=>n(e).positionId=l),placeholder:"请选择职位",clearable:"",filterable:"",onChange:o[7]||(o[7]=()=>{})},{default:a(()=>[(d(!0),E(x,null,I(n(A),l=>(d(),g(M,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"密码",prop:"password"},{default:a(()=>[t(q,{disabled:n(F),modelValue:n(e).password,"onUpdate:modelValue":o[8]||(o[8]=l=>n(e).password=l),placeholder:"如要修改密码请前往个人中心"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"是否启用",prop:"active"},{default:a(()=>[t(D,{modelValue:n(e).active,"onUpdate:modelValue":o[9]||(o[9]=l=>n(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:a(()=>[Ce]),default:a(()=>[t(h,{gutter:24},{default:a(()=>[t(u,{label:"分配角色:"},{default:a(()=>[t(p,{modelValue:n(e).role,"onUpdate:modelValue":o[10]||(o[10]=l=>n(e).role=l)},{default:a(()=>[(d(!0),E(x,null,I(n(R),l=>(d(),g(k,{key:l.id,value:l.id,label:l.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:a(()=>[Me]),default:a(()=>[t(h,{gutter:24},{default:a(()=>[t(u,{label:"分配小组:"},{default:a(()=>[n(_).length?(d(),g(p,{key:0,modelValue:n(e).groupId,"onUpdate:modelValue":o[11]||(o[11]=l=>n(e).groupId=l),disabled:n(e).id!==""},{default:a(()=>[(d(!0),E(x,null,I(n(_),l=>(d(),g(k,{key:l.id,value:l.id,label:l.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])):(d(),g(ue,{key:1},{default:a(()=>[N("-")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ne=Ve(ke,[["__scopeId","data-v-dd8a3639"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{Ne as D,ze as i,xe as u};
