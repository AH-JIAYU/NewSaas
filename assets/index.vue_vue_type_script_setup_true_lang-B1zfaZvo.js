
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Z,r as i,ao as $,k as J,l as F,E as R,a as d,p as L,q as j,i as a,o as p,b as x,f as t,w as u,F as A,t as I,e as f}from"./index-Ke106btl.js";import{u as G}from"./tenant_role-B_w-4Tbt.js";const Q=Z({__name:"index",props:["id","row"],setup(P,{expose:D}){const C=i(!1),O=$(),z=G(),q=i(),N=i(),S=P,g=i(!1),U=i(!1),m=i(),e=i({id:"",email:"",phone:"",name:"",country:"",password:"",role:null,active:!0,type:"phone"}),M=(s,o,r)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?r():r(new Error("请输入合法手机号"))},T=(s,o,r)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?r():r(new Error("请输入合法邮箱"))},k=()=>{e.value.phone.includes("@")?c.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:T,trigger:"blur"}]:c.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:M,trigger:"blur"}]},c=i({password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]});J(async()=>{g.value=!0,N.value=await O.getCountry(),q.value=await z.getRole(),g.value=!1,S.id&&(e.value=JSON.parse(S.row),c.value.password=[],C.value=!0)});const B=s=>{(s!==e.value.phone||s!==e.value.email)&&(U.value=!0)};D({submit(){return new Promise(s=>{e.value.type=e.value.country==="CN"?"phone":"email",e.value.id===""?m.value&&m.value.validate(o=>{o&&(delete e.value.id,e.value.type==="phone"?delete e.value.email:delete e.value.phone,F.create(e.value).then(()=>{R.success({message:"新增成功",center:!0}),b(),s()}))}):m.value&&m.value.validate(o=>{if(o){const{id:r,phone:n,email:h,password:_,name:w,country:y,active:E,type:v,role:V}=e.value,l={id:r,phone:n,email:h,password:_,name:w,country:y,active:E,type:v,role:V};v==="phone"?(l.email="",delete l.email):(l.phone="",delete l.phone),l.password||delete l.password,U.value||(delete l.phone,delete l.email),F.edit(l).then(()=>{R.success({message:"编辑成功",center:!0}),b(),s()})}})})},onCancel:b});function b(){e.value={}}return(s,o)=>{const r=d("ElInput"),n=d("ElFormItem"),h=d("ElOption"),_=d("ElSelect"),w=d("el-option"),y=d("el-select"),E=d("el-switch"),v=d("ElForm"),V=L("loading");return j((p(),x("div",null,[t(v,{ref_key:"formRef",ref:m,model:a(e),rules:a(c),"label-width":"130px","label-suffix":"："},{default:u(()=>[t(n,{label:"用户名",prop:"name"},{default:u(()=>[t(r,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(n,{label:"国家",prop:"country"},{default:u(()=>[t(_,{modelValue:a(e).country,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).country=l),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:u(()=>[(p(!0),x(A,null,I(a(N),l=>(p(),f(h,{label:l.chineseName,value:l.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(e).country==="CN"?(p(),f(n,{key:0,label:"手机号",prop:"phone"},{default:u(()=>[t(r,{modelValue:a(e).phone,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).phone=l),placeholder:"请输入手机号",onChange:B,onBlur:k},null,8,["modelValue"])]),_:1})):(p(),f(n,{key:1,label:"邮箱",prop:"email"},{default:u(()=>[t(r,{modelValue:a(e).email,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).email=l),placeholder:"请输入邮箱",onChange:B,onBlur:k},null,8,["modelValue"])]),_:1})),t(n,{label:"密码",prop:"password"},{default:u(()=>[t(r,{disabled:a(C),modelValue:a(e).password,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).password=l),placeholder:"需要修改密码时请前往当前账号个人中心"},null,8,["disabled","modelValue"])]),_:1}),t(n,{label:"角色",prop:"role"},{default:u(()=>[t(y,{modelValue:a(e).role,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).role=l),placeholder:"请选择角色"},{default:u(()=>[(p(!0),x(A,null,I(a(q),l=>(p(),f(w,{key:l.id,label:l.roleName,value:l.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"是否启用",prop:"active"},{default:u(()=>[t(E,{modelValue:a(e).active,"onUpdate:modelValue":o[6]||(o[6]=l=>a(e).active=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[V,a(g)]])}}});export{Q as _};
