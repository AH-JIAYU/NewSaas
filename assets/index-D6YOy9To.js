
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as g,s as H}from"./apiLoading-CnXy6h7u.js";import{a as j}from"./projectManagement-3IwEGz8l.js";import{c as O}from"./user_cooperation-DUscmM6M.js";import{U as J}from"./user_supplier-DxlrtRfA.js";import{u as K}from"./survey_vipGroup-CbnLqNaY.js";import{d as Q,r as _,k as W,a as u,l as X,o as p,b as v,f as r,w as o,p as Y,g as n,n as Z,e as s,i as l,j as b,F as T,q as k,G as $,E as ee,P as le}from"./index-BgFpqt2S.js";import"./user_supplier-3rw-p3PG.js";import"./survey_vipGroup-Bo9u_hNI.js";const te={style:{flex:"auto"}},oe=Q({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(ae,{expose:x,emit:G}){const U=J(),C=K(),N=G,m=_(!1),I=_(),e=_({title:"分配",list:[],tenantSupplierList:[],vipGroupList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]},selectAll:{supplier:!1,member:!1}}),B=_({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]});async function E(i,a){if(e.value.list=[{...i}],a==="reassign"){e.value.title="重新分配";const S=await g(j.getProjectAllocation({projectId:i.projectId})),{groupSupplierIdSet:d,...y}=S.data;e.value.form=y,e.value.form.groupSupplierIdList=d}else e.value.title="分配",e.value.form.projectId=i.projectId;e.value.tenantSupplierList=await g(U.getTenantSupplierList(i.projectId)),e.value.vipGroupList=await g(C.getGroupNameList());const c=await g(O.getAllocationBindList({projectId:i.projectId}));e.value.tenantList=c.data.allocationBindInfoList,m.value=!0}function z(){e.value.form.groupSupplierIdList=[]}function R(){e.value.form.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(i=>{e.value.form.groupSupplierIdList.push(i.tenantSupplierId)})}function F(){e.value.form.groupSupplierIdList=[],e.value.selectAll.member&&e.value.vipGroupList.map(i=>{e.value.form.groupSupplierIdList.push(i.memberGroupId)})}function L(){I.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),m.value=!1}function M(){I.value.validate(async i=>{if(i){const{status:a}=await H(j.allocation(e.value.form));a===1&&ee.success({message:"分配成功",center:!0}),L(),N("fetch-data")}})}return W(async()=>{}),x({showEdit:E}),(i,a)=>{const c=u("el-table-column"),S=u("el-table"),d=u("el-radio"),y=u("el-radio-group"),f=u("el-form-item"),w=u("el-checkbox"),V=u("el-option"),h=u("el-select"),q=u("el-form"),A=u("el-button"),D=u("el-dialog"),P=X("loading");return p(),v("div",null,[r(D,{modelValue:l(m),"onUpdate:modelValue":a[6]||(a[6]=t=>$(m)?m.value=t:null),title:"分配",width:"700","before-close":L},{footer:o(()=>[Y("div",te,[r(A,{onClick:L},{default:o(()=>[n(" 取消 ")]),_:1}),r(A,{type:"primary",onClick:M},{default:o(()=>[n(" 确定 ")]),_:1})])]),default:o(()=>[Z((p(),s(S,{data:l(e).list,"row-key":"id"},{default:o(()=>[r(c,{align:"center","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),r(c,{align:"center","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),r(c,{align:"center","show-overflow-tooltip":"",label:"客户简称",prop:"clientName"})]),_:1},8,["data"])),[[P,!1]]),r(q,{ref_key:"formRef",ref:I,"label-width":"80px",rules:l(B),model:l(e).form,inline:!1},{default:o(()=>[r(f,{label:"分配目标"},{default:o(()=>[r(y,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=t=>l(e).form.allocationType=t),class:"ml-4",onChange:z},{default:o(()=>[r(d,{value:2,size:"large"},{default:o(()=>[n(" 供应商 ")]),_:1}),r(d,{value:3,size:"large"},{default:o(()=>[n(" 会员组 ")]),_:1}),r(d,{value:4,size:"large"},{default:o(()=>[n("租户 ")]),_:1}),l(e).title==="重新分配"?(p(),s(d,{key:0,value:5,size:"large"},{default:o(()=>[n(" 取消分配 ")]),_:1})):b("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===2&&l(e).form.allocationType!==5?(p(),s(f,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:o(()=>[r(h,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[2]||(a[2]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:o(()=>[r(w,{modelValue:l(e).selectAll.supplier,"onUpdate:modelValue":a[1]||(a[1]=t=>l(e).selectAll.supplier=t),onChange:R,style:{display:"flex",height:"unset"}},{default:o(()=>[n("全选")]),_:1},8,["modelValue"])]),default:o(()=>[(p(!0),v(T,null,k(l(e).tenantSupplierList,t=>(p(),s(V,{label:t.supplierAccord,value:t.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):b("",!0),l(e).form.allocationType===3&&l(e).form.allocationType!==5?(p(),s(f,{key:1,label:"会员组",prop:"groupSupplierIdList"},{default:o(()=>[r(h,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[4]||(a[4]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择会员组",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:o(()=>[r(w,{modelValue:l(e).selectAll.member,"onUpdate:modelValue":a[3]||(a[3]=t=>l(e).selectAll.member=t),onChange:F,style:{display:"flex",height:"unset"}},{default:o(()=>[n("全选")]),_:1},8,["modelValue"])]),default:o(()=>[(p(!0),v(T,null,k(l(e).vipGroupList,t=>(p(),s(V,{label:t.memberGroupName,value:t.memberGroupId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):b("",!0),l(e).form.allocationType===4&&l(e).form.allocationType!==5?(p(),s(f,{key:2,label:"租户",prop:"groupSupplierIdList"},{default:o(()=>[r(h,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[5]||(a[5]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择租户",clearable:"",filterable:"",multiple:"","collapse-tags":"","multiple-limit":1},{default:o(()=>[(p(!0),v(T,null,k(l(e).tenantList,t=>(p(),s(V,{label:t.beInvitationTenantName,value:t.beInvitationTenantId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),ce=le(oe,[["__scopeId","data-v-ea2ed7a8"]]);export{ce as default};
