
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as k,s as X}from"./apiLoading-BHJuJsjd.js";import{a as A}from"./projectManagement-Cmena-P5.js";import{c as Y}from"./user_cooperation-BvTv6CgG.js";import{a as Z}from"./survey_vip_department-D8PZWsfs.js";import{U as $}from"./user_supplier-RuOctlsE.js";import{u as ee}from"./survey_vipGroup-Df5RrKa3.js";import{d as le,r as v,n as te,a as i,q as ae,o as s,b as V,f as n,w as t,y as oe,g as p,s as re,i as l,e as d,j as b,F as j,t as U,A as ne,E as ie,L as se}from"./index-rMCvG2s3.js";import"./user_supplier-CmzLsLhH.js";import"./survey_vipGroup-Btp1TjTc.js";const ue={style:{flex:"auto"}},pe=le({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(de,{expose:E,emit:N}){const B=$();ee();const K=N,h=v(!1),y=v(!1),L=v(),_=v(),f=v([]),R={children:"children",label:"name"},e=v({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),z=v({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]});async function F(r,a){if(e.value.list=[{...r}],a==="reassign"){e.value.title="重新分配";const c=await k(A.getProjectAllocation({projectId:r.projectId})),{groupSupplierIdSet:g,...u}=c.data;e.value.form=u,e.value.form.groupSupplierIdList=g}else e.value.title="分配",e.value.form.projectId=r.projectId;e.value.tenantSupplierList=await k(B.getTenantSupplierList(r.projectId));const m=await Z.list({name:""});e.value.departmentList=m.data;const I=await k(Y.getAllocationBindList({projectId:r.projectId}));f.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(f.value=e.value.form.groupSupplierIdList),e.value.tenantList=I.data.allocationBindInfoList,y.value=!0}function q(){e.value.form.groupSupplierIdList=[]}function D(){e.value.form.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(r=>{e.value.form.groupSupplierIdList.push(r.beInvitationTenantId)})}function H(){e.value.form.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(r=>{e.value.form.groupSupplierIdList.push(r.tenantSupplierId)})}const M=(r,a)=>{a?(_.value.getCheckedKeys().forEach(u=>{u!==r.id&&_.value.setChecked(u,!1)}),f.value=[r.id]):f.value=f.value.filter(g=>g!==r.id),f.value=_.value.getCheckedKeys(!1);const m=_.value.getCheckedKeys(),I=_.value.getHalfCheckedKeys(),c=m.concat(I);e.value.form.groupSupplierIdList=c};function S(){L.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),y.value=!1}function P(){L.value.validate(async r=>{if(r)try{h.value=!0;const{status:a}=await X(A.allocation(e.value.form));h.value=!1,a===1&&ie.success({message:"分配成功",center:!0}),S(),K("fetch-data")}catch{}finally{h.value=!1}})}return te(async()=>{}),E({showEdit:F}),(r,a)=>{const m=i("el-table-column"),I=i("el-table"),c=i("el-radio"),g=i("el-radio-group"),u=i("el-form-item"),x=i("el-checkbox"),T=i("el-option"),w=i("el-select"),G=i("el-tree"),O=i("el-text"),J=i("el-form"),C=i("el-button"),Q=i("el-dialog"),W=ae("loading");return s(),V("div",null,[n(Q,{modelValue:l(y),"onUpdate:modelValue":a[5]||(a[5]=o=>ne(y)?y.value=o:null),title:"分配",width:"700","before-close":S},{footer:t(()=>[oe("div",ue,[n(C,{onClick:S},{default:t(()=>[p(" 取消 ")]),_:1}),n(C,{type:"primary",onClick:P},{default:t(()=>[p(" 确定 ")]),_:1})])]),default:t(()=>[re((s(),d(I,{data:l(e).list,"row-key":"id"},{default:t(()=>[n(m,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),n(m,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),n(m,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[W,l(h)]]),n(J,{ref_key:"formRef",ref:L,"label-width":"80px",rules:l(z),model:l(e).form,inline:!1},{default:t(()=>[n(u,{label:"分配目标"},{default:t(()=>[n(g,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=o=>l(e).form.allocationType=o),class:"ml-4",onChange:q},{default:t(()=>[n(c,{value:2,size:"large"},{default:t(()=>[p(" 供应商 ")]),_:1}),n(c,{value:3,size:"large"},{default:t(()=>[p(" 内部站 ")]),_:1}),n(c,{value:4,size:"large"},{default:t(()=>[p("合作商 ")]),_:1}),l(e).title==="重新分配"?(s(),d(c,{key:0,value:5,size:"large"},{default:t(()=>[p(" 取消分配 ")]),_:1})):b("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===2&&l(e).form.allocationType!==5?(s(),d(u,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:t(()=>[n(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[2]||(a[2]=o=>l(e).form.groupSupplierIdList=o),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:t(()=>[n(x,{modelValue:l(e).selectAll.supplier,"onUpdate:modelValue":a[1]||(a[1]=o=>l(e).selectAll.supplier=o),onChange:H,style:{display:"flex",height:"unset"}},{default:t(()=>[p("全选")]),_:1},8,["modelValue"])]),default:t(()=>[(s(!0),V(j,null,U(l(e).tenantSupplierList,o=>(s(),d(T,{label:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):b("",!0),l(e).form.allocationType===3&&l(e).form.allocationType!==5?(s(),d(u,{key:1,label:"部门",prop:"groupSupplierIdList"},{default:t(()=>[l(e).departmentList.length>0?(s(),d(G,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:_,data:l(e).departmentList,"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":l(f),"default-expand-all":"",props:R,onCheckChange:M},null,8,["data","default-checked-keys"])):(s(),d(O,{key:1},{default:t(()=>[p("暂无数据")]),_:1}))]),_:1})):b("",!0),l(e).form.allocationType===4&&l(e).form.allocationType!==5?(s(),d(u,{key:2,label:"合作商",prop:"groupSupplierIdList"},{default:t(()=>[n(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[4]||(a[4]=o=>l(e).form.groupSupplierIdList=o),placeholder:"请选择合作商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:t(()=>[n(x,{modelValue:l(e).selectAll.tenant,"onUpdate:modelValue":a[3]||(a[3]=o=>l(e).selectAll.tenant=o),onChange:D,style:{display:"flex",height:"unset"}},{default:t(()=>[p("全选")]),_:1},8,["modelValue"])]),default:t(()=>[(s(!0),V(j,null,U(l(e).tenantList,o=>(s(),d(T,{label:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),be=se(pe,[["__scopeId","data-v-4709b256"]]);export{be as default};
