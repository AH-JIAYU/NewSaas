
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as P}from"./user_cooperation-B-z6fLfj.js";import{a as E}from"./department-Dcsm7tgZ.js";import{d as j,r as s,a as i,o as u,b as M,i as l,e as v,w as o,f as c,g as _,j as b,E as A,M as B}from"./index-BEosAuiF.js";const R=j({name:"componentsQuickEdit",__name:"index",emits:["fetch-data"],setup(w,{expose:y,emit:U}){const I=U,m=s(),e=s({dialogTableVisible:!1,title:"",type:"",loading:"",formData:{},staffList:[],rules:{chargeUserId:[{required:!0,message:"请选择PM",trigger:"change"}]}}),g=s([]);s([]);const k={children:"children",label:"name"},n=s(),D={chargeUserId:"PM"};async function V(a,t){const r=await E.list({name:""});r.data&&(g.value=r.data),e.value.title=D[t],e.value.type=t,e.value.loading=!0,e.value.formData.chargeUserName=a.chargeName,e.value.formData.chargeUserId=a.chargeId,e.value.formData.id=a.id,e.value.formData.invitationType=a.invitationType,e.value.formData.sendProjectType=a.sendProjectType,e.value.formData.sendProjectType=a.sendProjectType,e.value.dialogTableVisible=!0,e.value.loading=!1}const T=(a,t)=>{t?(n.value.getCheckedKeys().forEach(d=>{d!==a.id&&n.value.setChecked(d,!1)}),e.value.formData.chargeUserId=a.id,e.value.formData.chargeUserName=a.name):(e.value.formData.chargeUserId=[e.value.formData.chargeUserId].filter(r=>r!==a.id),e.value.formData.chargeUserId.length==0&&(e.value.formData.chargeUserId="")),Array.isArray(e.value.formData.chargeUserId)&&(e.value.formData.chargeUserId=e.value.formData.chargeUserId[0]?e.value.formData.chargeUserId[0]:null),e.value.formData.chargeUserId||(e.value.formData.chargeUserName="")};async function C(){e.value.loading=!0,m.value.validate(async a=>{if(a){let t=JSON.parse(JSON.stringify(e.value.formData));Array.isArray(t.chargeUserId)&&(t.chargeUserId=t.chargeUserId[0]);const{status:r}=await P.updateInvitationBindUser(t);r===1&&A.success({message:"编辑成功",center:!0}),I("fetch-data"),p()}e.value.loading=!1})}function p(){e.value.dialogTableVisible=!1,e.value.formData={}}return y({showEdit:V}),(a,t)=>{const r=i("el-tree-select"),d=i("el-form-item"),x=i("el-form"),h=i("el-button"),N=i("el-dialog");return u(),M("div",null,[l(e).dialogTableVisible?(u(),v(N,{key:0,modelValue:l(e).dialogTableVisible,"onUpdate:modelValue":t[1]||(t[1]=f=>l(e).dialogTableVisible=f),title:l(e).title+"编辑",draggable:""},{footer:o(()=>[c(h,{onClick:p,disabled:l(e).loading},{default:o(()=>[_(" 取消 ")]),_:1},8,["disabled"]),c(h,{type:"primary",onClick:C,disabled:l(e).loading},{default:o(()=>[_(" 确定 ")]),_:1},8,["disabled"])]),default:o(()=>[c(x,{ref_key:"formRef",ref:m,model:l(e).formData,rules:l(e).rules,"label-width":"100","label-position":"right"},{default:o(()=>[l(e).type==="chargeUserId"?(u(),v(d,{key:0,label:"PM",prop:"chargeUserId"},{default:o(()=>[c(r,{placeholder:"请选择部门",ref_key:"treeRef",ref:n,modelValue:l(e).formData.chargeUserId,"onUpdate:modelValue":t[0]||(t[0]=f=>l(e).formData.chargeUserId=f),data:l(g),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:k,onCheckChange:T,"check-on-click-node":!0,style:{width:"37.625rem"},"expand-on-click-node":!1,clearable:""},null,8,["modelValue","data"])]),_:1})):b("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])):b("",!0)])}}}),J=B(R,[["__scopeId","data-v-a937e008"]]);export{J as default};
