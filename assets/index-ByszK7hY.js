
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as g,d as N,r as b,n as U,E as A,a as d,q as $,s as z,i as n,o as c,b as f,f as l,w as m,g as B,F as v,t as M,e as C,y as P,z as y,L as R}from"./index-CROH153d.js";const V={list:r=>g.post("bill/getMemberBillList",r),create:r=>g.post("bill/addMemberSettlement",r),getMemberBillAvailableBalance:r=>g.post("bill/getMemberBillAvailableBalance",r),changestatus:r=>g.post("bill/updateMemberBill",r)},j=N({__name:"index",props:{id:{default:""}},setup(r,{expose:L}){const s=b(!1),S=b(),e=b({minimumAmount:"",settlementType:2,settlementAmount:"",addMemberSettlementInfoList:[]}),p=b({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),h=b({settlementAmount:[{required:!0,message:"请输入正数，且最多两位小数",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入有效的正数，且最多两位小数",trigger:"blur"}]}),w=async()=>{try{s.value=!0;const u=await V.getMemberBillAvailableBalance({});u.data&&(p.value.memberSettlementInfoList=u.data.memberBillAvailableBalanceInfoList,e.value.minimumAmount=u.data.minimumAmount),s.value=!1}catch{}finally{s.value=!1}},x=u=>{e.value.addMemberSettlementInfoList=[];const o=p.value.memberSettlementInfoList.filter(a=>u.includes(a.id));for(let a=0;a<o.length;a++)e.value.addMemberSettlementInfoList.push(o[a])};return U(async()=>{await w()}),L({submit(){return new Promise(u=>{S.value&&S.value.validate(o=>{if(e.value.settlementType===2){for(let a of e.value.addMemberSettlementInfoList){if(a.settlementAmount||(a.settlementAmount=null),!/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/.test(a.settlementAmount)){A.warning({message:"请输入有效的正数，且最多两位小数",center:!0});return}if(a.settlementAmount<e.value.minimumAmount){A.warning({message:"结算金额 小于 最低结算金额",center:!0});return}}e.value.settlementAmount=""}else if(e.value.addMemberSettlementInfoList=[],e.value.settlementAmount||(e.value.settlementAmount=e.value.minimumAmount),e.value.settlementAmount<e.value.minimumAmount){A.warning({message:"结算金额 小于 最低结算金额",center:!0});return}if(o)try{s.value=!0,V.create(e.value).then(()=>{s.value=!1,A.success({message:"新增成功",center:!0}),u()})}catch{}finally{s.value=!1}})})}}),(u,o)=>{const a=d("el-radio"),I=d("el-radio-group"),i=d("ElFormItem"),_=d("ElInput"),E=d("el-option"),k=d("el-select"),F=d("ElForm"),T=$("loading");return z((c(),f("div",null,[l(F,{ref_key:"formRef",ref:S,model:n(e),rules:n(h),"label-width":"9rem"},{default:m(()=>[l(i,{label:"结算方式"},{default:m(()=>[l(I,{modelValue:n(e).settlementType,"onUpdate:modelValue":o[0]||(o[0]=t=>n(e).settlementType=t)},{default:m(()=>[l(a,{value:2,size:"large"},{default:m(()=>[B(" 指定结算 ")]),_:1}),l(a,{value:1,size:"large"},{default:m(()=>[B(" 全部结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(e).settlementType===1?(c(),f(v,{key:0},[l(i,{label:"最低结算额度"},{default:m(()=>[l(_,{disabled:"",placeholder:"",value:n(e).minimumAmount},null,8,["value"])]),_:1}),l(i,{label:"结算金额",prop:"settlementAmount"},{default:m(()=>[l(_,{modelValue:n(e).settlementAmount,"onUpdate:modelValue":o[1]||(o[1]=t=>n(e).settlementAmount=t),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(c(),f(v,{key:1},[l(i,{label:"指定会员"},{default:m(()=>[l(k,{placeholder:"Select",modelValue:n(p).memberSettlementInfoSelect,"onUpdate:modelValue":o[2]||(o[2]=t=>n(p).memberSettlementInfoSelect=t),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:x},{default:m(()=>[(c(!0),f(v,null,M(n(p).memberSettlementInfoList,t=>(c(),C(E,{key:t.id,value:t.id,label:t.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"最低结算额度"},{default:m(()=>[l(_,{disabled:"",placeholder:"",value:n(e).minimumAmount},null,8,["value"])]),_:1}),(c(!0),f(v,null,M(n(e).addMemberSettlementInfoList,t=>(c(),f(v,null,[l(i,{label:""},{default:m(()=>[P("p",null,y(t.memberId)+" - "+y(t.memberName)+" - 可用余额："+y(t.availableBalance),1)]),_:2},1024),l(i,{label:"结算金额"},{default:m(()=>[l(_,{modelValue:t.settlementAmount,"onUpdate:modelValue":D=>t.settlementAmount=D,max:t.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[T,n(s)]])}}}),q=R(j,[["__scopeId","data-v-4c3dae74"]]),G=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));export{q as D,V as a,G as i};
