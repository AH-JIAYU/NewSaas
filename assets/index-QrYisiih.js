
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as C}from"./configuration_role-DMjEeAPR.js";import{k as $,A as G,r as l,c as M,d as j,bk as q,l as H,E as R,a as d,al as J,am as O,i as o,o as _,b as y,f as r,w as u,e as N,C as x,D as B,F as T,n as z,g as Q,j as F,P as W}from"./index-BYedTeXc.js";const X={list:()=>$.get("role/get/getRoleButton")},Y=G("buttonPermission",()=>{const i=l([]),h=M(async()=>{if(i.value.length)return i.value;const{data:k}=await X.list();return k});return{permissions:i,getPermissions:h}}),Z=Y,ee={class:"custom-tree-node"},te={class:"menu"},oe={class:"permission"},ae={key:0,class:"permissions"},le=j({__name:"index",props:["id","row"],setup(i,{expose:h}){const k=i,w=q(),S=Z(),c=l(!1),m=l(),g=l(),E=l([]),b=l([]),e=l({id:k.id??null,menuId:[],permission:[],roleName:"",remark:""}),L=l({roleName:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});H(async()=>{c.value=!0,e.value.id!==""&&await P(),E.value=w.routesRaw;const s=await w.obtainLevel1AndLevel2Routing();e.value.menuId=e.value.menuId.filter(t=>!s.some(a=>a.id===t)),b.value=await S.getPermissions,c.value=!1});async function P(){c.value=!0,e.value=JSON.parse(k.row)}function I(s){var t;return(t=b==null?void 0:b.value)==null?void 0:t.filter(a=>s===a.menuId)}return h({submit(){return e.value.menuId=g.value.getCheckedKeys(!1),new Promise(s=>{const t=g.value.getCheckedKeys(),a=g.value.getHalfCheckedKeys(),f=t.concat(a);e.value.menuId=f,e.value.id===""?m.value&&m.value.validate(p=>{p&&C.create(e.value).then(()=>{R.success({message:"新增成功",center:!0}),s()})}):m.value&&m.value.validate(p=>{p&&C.edit(e.value).then(()=>{R.success({message:"编辑成功",center:!0}),s()})})})}}),(s,t)=>{const a=d("ElInput"),f=d("ElFormItem"),p=d("ElCheckbox"),D=d("ElCheckboxGroup"),A=d("el-tree"),K=d("ElForm"),U=J("loading");return O((_(),y("div",null,[r(K,{ref_key:"formRef",ref:m,model:o(e),rules:o(L),"label-width":"120px","label-suffix":"："},{default:u(()=>[r(f,{label:"角色码",prop:"roleName"},{default:u(()=>[r(a,{modelValue:o(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=n=>o(e).roleName=n),disabled:!!o(e).id,placeholder:"请输入角色码"},null,8,["modelValue","disabled"])]),_:1}),r(f,{label:"备注",prop:"remark"},{default:u(()=>[r(a,{modelValue:o(e).remark,"onUpdate:modelValue":t[1]||(t[1]=n=>o(e).remark=n),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),r(f,{label:"权限"},{default:u(()=>[o(c)?F("",!0):(_(),N(A,{key:0,ref_key:"treeRef",ref:g,data:o(E),style:{width:"100%"},"default-checked-keys":o(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"",border:""},{default:u(({data:n})=>{var V;return[x("div",ee,[x("div",te,B(n.meta.title),1),x("div",oe,[(V=I(n.id))!=null&&V.length?(_(),y("div",ae,[r(D,{modelValue:o(e).permission,"onUpdate:modelValue":t[2]||(t[2]=v=>o(e).permission=v)},{default:u(()=>[(_(!0),y(T,null,z(I(n.id),v=>(_(),N(p,{key:v.id,value:v.id},{default:u(()=>[Q(B(v.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):F("",!0)])])]}),_:1},8,["data","default-checked-keys"]))]),_:1})]),_:1},8,["model","rules"])])),[[U,o(c)]])}}}),re=W(le,[["__scopeId","data-v-61eb1e5b"]]);export{re as default};
