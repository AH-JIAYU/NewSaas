
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as w,s as W}from"./apiLoading-xSLvfzM4.js";import{a as B}from"./projectManagement-B5W58rgS.js";import{a as $}from"./user_cooperation-CFwbEuzQ.js";import{a as ee}from"./survey_vip_department-DdEeno98.js";import{U as te}from"./user_supplier-B-UyFgW_.js";import{u as le}from"./survey_vipGroup-DR8fA5fq.js";import{d as ae,r as m,n as oe,a as p,q as se,o as r,b as d,f as i,w as o,y as u,g as n,s as ie,i as t,e as U,j as I,F as K,t as D,A as re,E as ne,aH as pe,aI as ue,L as ce}from"./index-Cy1wtqF8.js";import"./user_supplier-ByYoUCZg.js";import"./survey_vipGroup-BNIHdunf.js";const de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAmtJREFUOE+dlTtIXEEUhr9ZFxWfaOEDg6/CxiZWBkEEsbARIqwoJLLXLoEISZdyy3QJRIidd8FANAG1sFJEsDCIQrRRRMyVbCEq4qsQXXficXa9d/eqwUyz7Jkz3/xz5sx/FXcMHYkEqa3tBZ4Dz4CKZFrsOvYLpSZJJMbUwMB55nKVGdC2/QL4ADy5azNPbBel3qpweMybdwtMqvoIvPkHKHN6GMcZVJFIXCZcoG1/AV49EpZKH1KWNXgL1NFoL1p/S4OVlUFLCxQXw8EBrK5CTEp473ipLOur0iMjuSj121N4s6K7G4qK3NUXFzA+DldX9xFjOE6d0tFoGK3ttKycHOjr8y+cnjZqH1KpbXsi2R5uWnk5dHb6ly0twfr6Q8AfStu2HLc2LSs7G7q6oKDADctRp6bg9PQhYEyAl0DQl1VZCR0dEAjA4SGsrEBFhdnk5AQ2NuDc19fx+4HBIPT0mEtYXITWVojHIZEwm8jv7CwcHXm13AD/pL2KwkJoaIDqanPLoqymBkpLYX7eHFkurbERsrJgZsYLdAT4HQjdRkMhyM93k+bmoL0dtrZgbw8uL0FaqK3NAEdHvcBJAcrbdaP9/eZIqbGwAM3NsL8P29umbURtU5PJmJAmSQ6lLJV8w3LTxgykZUpKIC8PcnMNQJTIsc/OoKoKdnagvh6Wl2FzM4XbReu6m7fsU3lXY0hdpW5S1+NjWFszil11feI8XnP4/B9Ok8INK8t6LX8y7Uugj3WcIRznnc++UlslneeTzyz8ZRDreS8O453yOfZNTcWBAgGxNPkEPPX06S7w8zo2ieOMpVR5gX8BZ0fYI9liOMMAAAAASUVORK5CYII=",N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAS1JREFUKFN1kr8vQ1EUxz+HRl5EYhEaSRMSTBIDo/DKYDCwWVjKZrAYREgaJTF0MJD4kdbSjT/AxAsREgYSo0gs/gDLE1575Op77VV1l3ty7vfzzflxhfC4aY2RYAZhGugBPlAeBPYv5uUx0okJxo+0o9jAKcJw9FBzb3opWTc5cY/VocQVwtA/4ii95qVkywBLKDu2OJ2E8xe4fLWySsAnveLm9K7WPd4C2Qk4vP8DLRvgCyHW1gyDnVVHA80NwIb3CyqIm1cfcPrbYbKvCjQ1wmgXnD1D9rqSL9QtyYgzY+AHkPGgqCEgrBhgEWHXbnp1BH4gW2z24tMt4cJu7MYTrfD2bjmX3cpjNZG7p3EcTuouzoxT2K4szi4lmdcphdnwawTALSUOvAV5inTfDOJhkx1Lf7QAAAAASUVORK5CYII=",Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAklJREFUOE+VlF9Ik2EUxp/HjbZSgoqJZFiLIBeEgoOEiBZ02UAoWFCwdbUNEvKui0CFLrorUHBdaVHQqGiw0V1oRNGFhiGUdtGWDlquMMJs4fpOfPv7fdvrau/d953n/b3nHM55CMWREY8Vfd0+oQwA6AfYUZKlITJPtsRS2V9R56WpXO111v6QeOiCUG4A3Kd6zPAvQ5Er9N6OGnUVoJ6V5u6+SeDyP0CmsIhEWuaWBjkyk9cDFeCfeHiClFAzsLJWgHHLmchgBShPgz7R+EAJ6zoBOI4UQ6sLwMorpYyCi/RG7lMmA3Zx2JMAyo0HDp4G9nuA94+BHj9otRUh+Rzk7V3AdRZIPgNS0wa4pDm75KQkwn6BTJme9YyCre2Q+TuGppQUArDXD/xchcwMm64VstTiwScg9fGonlPXwR17Grdz4xtk+lqNRh5RS4T0cg+ogLL2Efj9w3xpWxu4+xCgBqZ14CYAqxK4/BLIrZmB9l1g1/EtgMg3Bn5ZADbX6zNsP9oIGFyp24pSD+XzGyD33Qy07QT3urcqOUUtEXwI8Nx/l9zqADuPqYEiMRZ3F/eUwK8fgPyGOUOLDXS4lECCAeo7LO7DSVPZJ4fBtuqcK+dnPQN5PmoMZT5lc87CLtdl2dEDdPY3nsPlF0D2XUVDkfO681TNIREaa9ZpyjQRRizeibD+bbavPtdYs45DYByzi0N19lV5reg8t0xmoSxe0hRe1R3GGK5z7EJPJwN2OLb7RLQBkL0ASu4tGQCvKYxhbjFazsoI/AvM0v9Xs8g/iwAAAABJRU5ErkJggg==",me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAoBJREFUOE+dlU1IVFEYhp/TDJYiCEYU0VRGiYugSIKgqJsQgVEMEU0xA4UWGCUUREQgTbioRVCkkBtNS4f8CSdq1cImKHCX/aCrspxZTAitJCPHTp577u+MU9i3uZzvO+c97/dz3itYxIy4DBIigiCMZBewxtwmyCAZQ5Bkiv5UXPzMPy7yHUanjAK3EKxb7DKPLwtcTDWIfu8+B9BktZ47wIV/APnDkg7SNKfiIqeTsMzolPcRNC0JzN3cnmoQzQ6g0SUjwGPlKAnA2VqoLIWhcZiY9l9RvRIiW2H6B/S8hVmTFyCJpRpFnzAeyBVIJu3CN+3UB5TN/IJwAualXgcEDByHyjK9Hp6Ae6MOYIY0VcLokqeAbptHyz6o2+Syqn/ksigNwrMoBJbp+MhnaH3lyUASE0anHDbHwzKV0s0DULEcuseg950/5dg2aNyh2V95UVCSIcVQpbvRe0ylpmrp1CevUyo2/9sthROWZBTDOQRB27m6HG7sh1VlkPgAT8b9aPVbNEPVlOsv4duML+VcAeDl3XCoWm9SLA73uUwVM1VD9S1Sw5xKOQ3uq2itgz0b3FvPPIVP3/U6VAEPj7qx11+hZcSXwRcFOAgcs935gLNzkHivO3ukRs+nbQWAkqRKOYqgtxjg+edwcLMGHPgIPX9neFpYyjJpi0E+w5ODkLUKX16ia1iEYZYpqsy37GUZroHatVZTJNx+o2dOmWrGtb36xSgby/qm4IRSHlccumTbkpXGpirpSDWKc2rpl68Qbf+hOO1McalAvuzLLOW566i0byo8C0kGuKoUxrulQLHNmmoFiizIfXhB7rcjrTkVKJUeRZIkbf4CbPFyMP8AN7LhTtHVZc8AAAAASUVORK5CYII=",b=h=>(pe("data-v-7ea4b20c"),h=h(),ue(),h),ge=b(()=>u("span",{class:"icon-class"},[u("img",{src:de,alt:"",style:{"margin-right":"0.25rem"}}),n(" 供应商")],-1)),fe=b(()=>u("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ie={key:1},ve=b(()=>u("span",{class:"icon-class"},[u("img",{src:Ae,alt:"",style:{"margin-right":"0.25rem"}}),n(" 调查站")],-1)),Se=b(()=>u("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),ye={key:1},be=b(()=>u("span",{class:"icon-class"},[u("img",{src:me,alt:"",style:{"margin-right":"0.25rem"}}),n(" 合作商")],-1)),Le=b(()=>u("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),he={key:1},Ve={style:{flex:"auto"}},ke=ae({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(h,{expose:P,emit:O}){const T=te();le();const J=O,V=m(!1),L=m(!1),R=m(),v=m(),S=m([]),Q={children:"children",label:"name"},x=m([]),e=m({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),H=m({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]});async function Y(s,l){if(e.value.list=[{...s}],l==="reassign"){e.value.title="重新分配";const y=await w(B.getProjectAllocation({projectId:s.projectId})),{groupSupplierIdSet:A,...f}=y.data;e.value.form=f,e.value.form.groupSupplierIdList=A,x.value=JSON.parse(JSON.stringify(A))}else e.value.title="分配",e.value.form.projectId=s.projectId;e.value.tenantSupplierList=await w(T.getTenantSupplierList(s.projectId));const c=await ee.list({name:""});e.value.departmentList=c.data;const g=await w($.getAllocationBindList({projectId:s.projectId}));S.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(S.value=e.value.form.groupSupplierIdList),e.value.tenantList=g.data.allocationBindInfoList,L.value=!0}function z(){e.value.form.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(s=>{e.value.form.groupSupplierIdList.push(s.beInvitationTenantId)})}function M(){e.value.form.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(s=>{e.value.form.groupSupplierIdList.push(s.tenantSupplierId)})}const Z=(s,l)=>{l?(v.value.getCheckedKeys().forEach(f=>{f!==s.id&&v.value.setChecked(f,!1)}),S.value=[s.id]):S.value=S.value.filter(A=>A!==s.id),S.value=v.value.getCheckedKeys(!1);const c=v.value.getCheckedKeys(),g=v.value.getHalfCheckedKeys(),y=c.concat(g);e.value.form.groupSupplierIdList=y};function C(){R.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]}),L.value=!1}function X(){R.value.validate(async s=>{if(s)try{V.value=!0;const l=x.value.filter(g=>!e.value.form.groupSupplierIdList.includes(g));e.value.form.deleteSet=l;const{status:c}=await W(B.allocation(e.value.form));V.value=!1,c===1&&ne.success({message:"分配成功",center:!0}),C(),J("fetch-data")}catch{}finally{V.value=!1}})}const E=s=>{};return oe(async()=>{}),P({showEdit:Y}),(s,l)=>{const c=p("el-table-column"),g=p("el-table"),y=p("el-checkbox"),A=p("el-option"),f=p("el-select"),k=p("el-form-item"),F=p("el-tree-select"),_=p("el-button"),G=p("el-form"),j=p("el-dialog"),q=se("loading");return r(),d("div",null,[i(j,{modelValue:t(L),"onUpdate:modelValue":l[8]||(l[8]=a=>re(L)?L.value=a:null),title:t(e).title,width:"700","before-close":C},{footer:o(()=>[u("div",Ve,[i(_,{onClick:C},{default:o(()=>[n(" 取消 ")]),_:1}),i(_,{type:"primary",onClick:X},{default:o(()=>[n(" 确定 ")]),_:1})])]),default:o(()=>[ie((r(),U(g,{data:t(e).list,"row-key":"id"},{default:o(()=>[i(c,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),i(c,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),i(c,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[q,t(V)]]),i(G,{ref_key:"formRef",ref:R,"label-width":"90px",rules:t(H),model:t(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:o(()=>[i(k,{style:{"margin-top":"1rem"}},{label:o(()=>[ge]),default:o(()=>[i(f,{modelValue:t(e).form.groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=a=>t(e).form.groupSupplierIdList=a),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":8,placeholder:""},{header:o(()=>[i(y,{modelValue:t(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=a=>t(e).selectAll.supplier=a),onChange:M,style:{display:"flex",height:"unset"}},{default:o(()=>[n("全选")]),_:1},8,["modelValue"])]),prefix:o(()=>[t(e).tenantSupplierList.length==0?(r(),d("span",{key:0,class:"prefix-class",onClick:l[1]||(l[1]=a=>E("供应商"))},[n(" 请先维护供应商数据 "),fe])):I("",!0),t(e).form.groupSupplierIdList.length==0?(r(),d("span",Ie,"请先选择供应商数据")):I("",!0)]),default:o(()=>[(r(!0),d(K,null,D(t(e).tenantSupplierList,a=>(r(),U(A,{label:a.supplierAccord,key:a.supplierAccord,value:a.tenantSupplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(k,null,{label:o(()=>[ve]),default:o(()=>[i(F,{ref_key:"treeRef",ref:v,modelValue:t(e).form.chargeUserId,"onUpdate:modelValue":l[4]||(l[4]=a=>t(e).form.chargeUserId=a),data:t(e).departmentList,"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:Q,onCheckChange:Z,"check-on-click-node":!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},{prefix:o(()=>[t(e).departmentList.length==0?(r(),d("span",{key:0,class:"prefix-class",onClick:l[3]||(l[3]=a=>E("调查站"))},[n(" 请先维护调查站数据 "),Se])):I("",!0),t(e).form.chargeUserId?I("",!0):(r(),d("span",ye,"请先选择调查站数据"))]),_:1},8,["modelValue","data"])]),_:1}),i(k,null,{label:o(()=>[be]),default:o(()=>[i(f,{modelValue:t(e).form.groupSupplierIdList,"onUpdate:modelValue":l[7]||(l[7]=a=>t(e).form.groupSupplierIdList=a),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":8,placeholder:""},{header:o(()=>[i(y,{modelValue:t(e).selectAll.tenant,"onUpdate:modelValue":l[5]||(l[5]=a=>t(e).selectAll.tenant=a),onChange:z,style:{display:"flex",height:"unset"}},{default:o(()=>[n("全选")]),_:1},8,["modelValue"])]),prefix:o(()=>[t(e).tenantList.length==0?(r(),d("span",{key:0,class:"prefix-class",onClick:l[6]||(l[6]=a=>E("合作商"))},[n(" 请先维护合作商数据 "),Le])):I("",!0),t(e).form.groupSupplierIdList.length==0?(r(),d("span",he,"请先选择合作商数据")):I("",!0)]),default:o(()=>[(r(!0),d(K,null,D(t(e).tenantList,a=>(r(),U(A,{label:a.beInvitationTenantName,key:a.beInvitationTenantName,value:a.beInvitationTenantId,disabled:a.reveal===1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),(t(e).title="重新分配")?(r(),U(k,{key:0},{label:o(()=>[i(_,null,{default:o(()=>[n(" 取消分配 ")]),_:1})]),_:1})):I("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),Ke=ce(ke,[["__scopeId","data-v-7ea4b20c"]]);export{Ke as default};
