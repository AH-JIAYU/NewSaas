
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as X,m as Y,u as pe,r as f,a as i,o as p,b as V,f as a,w as r,e as b,F as h,aD as I,ay as J,am as ee,aB as me,i as t,j as S,ak as C,L as ce,_ as le,k as K,M as fe,D as ge,al as ve,a3 as q,a4 as O,g as R,l as ye,aG as he,aH as be,n as W}from"./index-Bil3zl1I.js";import{u as we}from"./otherFunctions_basicDictionary--dBdOOh6.js";import"./basicDictionary-4gODy16b.js";const _e={class:"upload-container"},Ve={key:1,class:"image"},Ee={class:"mask"},ke={class:"actions"},Pe={key:0,class:"el-upload__tip"},Ue={style:{display:"inline-block"}},$e=X({name:"ImageUpload",__name:"index",props:Y({action:{},headers:{},data:{},name:{default:"file"},size:{default:2},width:{default:150},height:{default:150},placeholder:{default:""},notip:{type:Boolean,default:!1},ext:{default:()=>["jpg","png","gif","bmp"]}},{modelValue:{default:""},modelModifiers:{}}),emits:Y(["onSuccess"],["update:modelValue"]),setup(g,{emit:T}){const E=g,N=T,d=pe(g,"modelValue"),m=f({imageViewerVisible:!1,progress:{preview:"",percent:0}});function w(){m.value.imageViewerVisible=!0}function z(){m.value.imageViewerVisible=!1}function B(){d.value=""}const k=l=>{const U=l.name.split(".").at(-1)??"",v=E.ext.includes(U),_=l.size/1024/1024<E.size;return v||C.error(`上传图片只支持 ${E.ext.join(" / ")} 格式！`),_||C.error(`上传图片大小不能超过 ${E.size}MB！`),v&&_&&(m.value.progress.preview=URL.createObjectURL(l)),v&&_},P=l=>{m.value.progress.percent=~~l.percent},e=l=>{m.value.progress.preview="",m.value.progress.percent=0,N("onSuccess",l)};return(l,A)=>{const U=ce,v=i("ElImage"),_=i("ElProgress"),x=i("ElUpload"),M=i("ElAlert"),j=i("ElImageViewer");return p(),V("div",_e,[a(x,{"show-file-list":!1,headers:l.headers,action:l.action,data:l.data,name:l.name,"before-upload":k,"on-progress":P,"on-success":e,drag:"",class:"image-upload"},{default:r(()=>[d.value===""?(p(),b(v,{key:0,src:d.value===""?l.placeholder:d.value,style:I(`width:${l.width}px;height:${l.height}px;`),fit:"fill"},{error:r(()=>[h("div",{class:"image-slot",style:I(`width:${l.width}px;height:${l.height}px;`)},[a(U,{name:"i-ep:plus",class:"icon"})],4)]),_:1},8,["src","style"])):(p(),V("div",Ve,[a(v,{src:d.value,style:I(`width:${l.width}px;height:${l.height}px;`),fit:"fill"},null,8,["src","style"]),h("div",Ee,[h("div",ke,[h("span",{title:"预览",onClick:J(w,["stop"])},[a(U,{name:"i-ep:zoom-in",class:"icon"})]),h("span",{title:"移除",onClick:J(B,["stop"])},[a(U,{name:"i-ep:delete",class:"icon"})])])])])),ee(h("div",{class:"progress",style:I(`width:${l.width}px;height:${l.height}px;`)},[a(v,{src:t(m).progress.preview,style:I(`width:${l.width}px;height:${l.height}px;`),fit:"fill"},null,8,["src","style"]),a(_,{type:"circle",width:Math.min(l.width,l.height)*.8,percentage:t(m).progress.percent},null,8,["width","percentage"])],4),[[me,d.value===""&&t(m).progress.percent]])]),_:1},8,["headers","action","data","name"]),l.notip?S("",!0):(p(),V("div",Pe,[h("div",Ue,[a(M,{title:`上传图片支持 ${l.ext.join(" / ")} 格式，且图片大小不超过 ${l.size}MB，建议图片尺寸为 ${l.width}*${l.height}`,type:"info","show-icon":"",closable:!1},null,8,["title"])])])),t(m).imageViewerVisible?(p(),b(j,{key:1,"url-list":[d.value],teleported:"",onClose:z},null,8,["url-list"])):S("",!0)])}}}),Ie=le($e,[["__scopeId","data-v-efadaafa"]]),L={list:()=>K.post("user/getUserInfo"),edit:g=>K.post("user/update",g)},ae=g=>(he("data-v-f4ee9626"),g=g(),be(),g),Se=ae(()=>h("h2",null,"个人信息",-1)),Ce=ae(()=>h("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),te=X({name:"personalSetting",__name:"setting",setup(g,{expose:T}){const E=we(),N=f([]),d=f(!1);fe();const m=f(!1),w=f(!1),z=[{label:"公司",value:"company"},{label:"个人",value:"personal"}],B=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}];f([]);const k=f(),P=f(),e=f({type:"personal",name:"",phone:"15288888888",email:"88888@qq.com",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),l=f({oldPassword:"",password:"",confirmPassword:""}),v=f({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(n,s,c)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?c():c(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(n,s,c)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?c():c(new Error("请输入合法手机号"))},trigger:"blur"}]}),_=f({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(n,s,c)=>{s===l.value.oldPassword?c(new Error("新密码不能与旧密码一致")):c()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(n,s,c)=>{s!==l.value.password?c(new Error("两次输入的密码不一致")):c()},trigger:"blur"}]}),x=n=>{(n!==e.value.phone||n!==e.value.email)&&(m.value=!0)};function M(){k.value&&k.value.validate(async n=>{if(n){if(d.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,m.value||(delete e.value.phone,delete e.value.email),(await L.edit(e.value)).status===-1)return;D(),d.value=!1,C.success({message:"修改成功",center:!0}),$()}})}const j=()=>{P.value&&P.value.validate(async n=>{if(n){if(d.value=!0,delete l.value.confirmPassword,console.log("accountForm.value",l.value),(await L.edit(l.value)).status===-1)return;D(),d.value=!1,C.success({message:"修改成功",center:!0}),$()}})};async function oe(n){w.value=!0}function $(){k.value.resetFields(),P.value.resetFields(),Object.assign(e,{}),Object.assign(l,{}),w.value=!1}function se(n){n.error===""?e.value.headimg=n.data.path:C.warning(n.error)}const D=async()=>{d.value=!0;const n=await L.list();e.value=n.data,d.value=!1};return ge(async()=>{D(),N.value=await E.getCountry()}),T({showEdit:oe}),(n,s)=>{const c=Ie,u=i("ElFormItem"),H=i("el-option"),Z=i("el-select"),y=i("ElInput"),re=i("ElOption"),ne=i("ElSelect"),F=i("ElButton"),G=i("ElForm"),Q=i("ElTabPane"),ue=i("ElTabs"),ie=i("el-drawer"),de=ve("loading");return ee((p(),V("div",null,[a(ie,{modelValue:t(w),"onUpdate:modelValue":s[13]||(s[13]=o=>ye(w)?w.value=o:null),title:"修改用户信息",direction:"rtl","before-close":$,style:{height:"100%"},size:"40%"},{default:r(()=>[a(ue,{"tab-position":"left"},{default:r(()=>[a(Q,{label:"个人信息",class:"basic"},{default:r(()=>[Se,a(G,{ref_key:"userFormRef",ref:k,model:t(e),rules:t(v),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:r(()=>[a(u,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:r(()=>[a(c,{url:t(e).imgUrl,"onUpdate:url":s[0]||(s[0]=o=>t(e).imgUrl=o),action:"http://saas-api.surveysaas.com/project/uploadQiniu",name:"image",notip:"",class:"headimg-upload",onOnSuccess:se},null,8,["url"])]),_:1}),a(u,{label:"账户类型"},{default:r(()=>[a(Z,{modelValue:t(e).type,"onUpdate:modelValue":s[1]||(s[1]=o=>t(e).type=o),"value-key":"",placeholder:"账户类型",clearable:"",filterable:""},{default:r(()=>[(p(),V(q,null,O(z,o=>a(H,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"用户名"},{default:r(()=>[a(y,{disabled:"",modelValue:t(e).name,"onUpdate:modelValue":s[2]||(s[2]=o=>t(e).name=o),laceholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),a(u,{label:"国家"},{default:r(()=>[a(ne,{modelValue:t(e).country,"onUpdate:modelValue":s[3]||(s[3]=o=>t(e).country=o),disabled:""},{default:r(()=>[(p(!0),V(q,null,O(t(N),o=>(p(),b(re,{label:o.chineseName,value:o.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(u,{prop:"",label:"货币类型"},{default:r(()=>[a(Z,{modelValue:t(e).currencyType,"onUpdate:modelValue":s[4]||(s[4]=o=>t(e).currencyType=o),"value-key":"",placeholder:"请选择货币类型",clearable:"",filterable:""},{default:r(()=>[(p(),V(q,null,O(B,o=>a(H,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(e).type==="company"?(p(),b(u,{key:0,label:"公司名称"},{default:r(()=>[a(y,{modelValue:t(e).companyName,"onUpdate:modelValue":s[5]||(s[5]=o=>t(e).companyName=o),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):S("",!0),t(e).type==="company"?(p(),b(u,{key:1,label:"公司税号"},{default:r(()=>[a(y,{modelValue:t(e).taxId,"onUpdate:modelValue":s[6]||(s[6]=o=>t(e).taxId=o),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):S("",!0),t(e).type==="company"?(p(),b(u,{key:2,label:"法人姓名"},{default:r(()=>[a(y,{modelValue:t(e).legalPersonName,"onUpdate:modelValue":s[7]||(s[7]=o=>t(e).legalPersonName=o),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):S("",!0),t(e).country==="CN"?(p(),b(u,{key:3,prop:"phone",label:"手机号码"},{default:r(()=>[a(y,{modelValue:t(e).phone,"onUpdate:modelValue":s[8]||(s[8]=o=>t(e).phone=o),placeholder:"请输入你的手机号码",onChange:x},null,8,["modelValue"])]),_:1})):(p(),b(u,{key:4,prop:"email",label:"电子邮箱"},{default:r(()=>[a(y,{modelValue:t(e).email,"onUpdate:modelValue":s[9]||(s[9]=o=>t(e).email=o),placeholder:"请输入你的电子邮箱",onChange:x},null,8,["modelValue"])]),_:1})),a(u,null,{default:r(()=>[a(F,{onClick:M,type:"primary"},{default:r(()=>[R(" 保存 ")]),_:1}),a(F,{onClick:$,type:"primary"},{default:r(()=>[R(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(Q,{label:"账户管理",class:"security"},{default:r(()=>[Ce,a(G,{ref_key:"accountFormRef",ref:P,model:t(l),rules:t(_),"label-width":"120px","label-suffix":"："},{default:r(()=>[a(u,{prop:"oldPassword",label:"旧密码"},{default:r(()=>[a(y,{modelValue:t(l).oldPassword,"onUpdate:modelValue":s[10]||(s[10]=o=>t(l).oldPassword=o),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),a(u,{prop:"password",label:"新密码"},{default:r(()=>[a(y,{modelValue:t(l).password,"onUpdate:modelValue":s[11]||(s[11]=o=>t(l).password=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,{prop:"confirmPassword",label:"确认新密码"},{default:r(()=>[a(y,{modelValue:t(l).confirmPassword,"onUpdate:modelValue":s[12]||(s[12]=o=>t(l).confirmPassword=o),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,null,{default:r(()=>[a(F,{onClick:j,type:"primary"},{default:r(()=>[R(" 保存 ")]),_:1}),a(F,{onClick:$,type:"primary"},{default:r(()=>[R(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[de,t(d)]])}}});typeof W=="function"&&W(te);const Re=le(te,[["__scopeId","data-v-f4ee9626"]]);export{Re as default};
