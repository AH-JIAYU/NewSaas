
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as re,r as M,aI as ue,D as ce,E as B,H as de,au as P,a as i,al as me,o as d,b as D,f as a,w as t,am as N,az as pe,a3 as fe,a4 as ge,e as v,g as r,G as _,j as I,i as C,P as ve,aJ as U,ak as T,L as _e,p as he,aG as be,aH as Ce,F as ye,aB as Ee,_ as we,n as F}from"./index-DbPEKLOm.js";import{_ as Me}from"./index.vue_vue_type_script_setup_true_lang-D0bWmFkk.js";import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang-BZj2yyj5.js";import{u as ke}from"./otherFunctions_basicDictionary-CQdW5uZo.js";import{u as xe}from"./index.vue_vue_type_script_setup_true_lang-1IPbrMUV.js";import{u as Pe}from"./useTabbar-CB-TKtuN.js";import"./basicDictionary-ByunYrGj.js";import"./configuration_role-xXDdczmb.js";const Ve=y=>(be("data-v-7279624f"),y=y(),Ce(),y),ze=Ve(()=>ye("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),G=re({name:"SettingUserList",__name:"list",setup(y){const H=ke(),V=M([]),R=xe(),z=M(),{pagination:p,onSizeChange:j,onCurrentChange:A,onSortChange:J}=ue(),L=Pe(),e=M({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",row:""},editProps:{visible:!1,id:""},search:{name:"",role:""},batch:{enable:!0,selectionDataList:[]},dataList:[]}),S=M();ce(async()=>{u(),V.value=await H.getCountry(),z.value=await R.getRole,S.value=await K(V.value,e.value.dataList),e.value.formMode==="router"&&B.on("get-data-list",()=>{u()})});function K(n,o){let f={};return o.forEach(h=>{const w=n.find(k=>k.code===h.country);w&&(f=w)}),f}de(()=>{e.value.formMode==="router"&&B.off("get-data-list")});function u(){e.value.loading=!0,P.list(e.value.search).then(n=>{var o;e.value.loading=!1,e.value.dataList=n.data,p.value.total=(o=n.data)==null?void 0:o.length,e.value.dataList.forEach(f=>{f.statusLoading=!1})})}function O(){Object.assign(e.value.search,{name:"",role:""}),u()}function q(n){j(n).then(()=>u())}function E(n=1){A(n).then(()=>u())}function Q({prop:n,order:o}){J(n,o).then(()=>u())}function W(){e.value.formMode==="router"?L.open({name:"pagesExampleGeneralManagerCreate"}):(e.value.formModeProps.id="",e.value.formModeProps.row="",e.value.formModeProps.visible=!0)}function X(n){e.value.formMode==="router"?L.open({name:"pagesExampleGeneralManagerEdit",params:{id:n.id}}):(e.value.formModeProps.id=n.id,e.value.formModeProps.row=JSON.stringify(n),e.value.formModeProps.visible=!0)}function Y(n){return new Promise(o=>{U.confirm(`确认${n.active?"禁用":"启用"}「${n.name}」吗？`,"确认信息").then(()=>{e.value.loading=!0,P.edit({id:n.id,account:null,name:null,sex:null,phoneNumber:null,active:!n.active}).then(()=>(T.success({message:`${n.active?"禁用":"启用"}成功`,center:!0}),u(),e.value.loading=!1,o(!0))).catch(()=>(e.value.loading=!1,o(!1)))}).catch(()=>o(!1))})}function Z(n){U.confirm(`确认删除「${n.name}」用户吗？`,"确认信息").then(()=>{P.delete({id:n.id}).then(()=>{u(),T.success({message:"删除成功",center:!0})})}).catch(()=>{})}return(n,o)=>{const f=i("ElInput"),h=i("ElFormItem"),w=i("el-option"),k=i("el-select"),x=_e,g=i("ElButton"),ee=i("ElForm"),ae=Me,te=i("ElDivider"),$=i("ElSpace"),m=i("ElTableColumn"),b=i("el-text"),oe=i("ElSwitch"),le=i("ElTable"),ne=i("ElPagination"),se=he,ie=me("loading");return d(),D("div",{class:ve({"absolute-container":e.value.tableAutoHeight})},[a(se,null,{default:t(()=>[a(ae,{"show-toggle":!1},{default:t(({fold:l,toggle:c})=>[a(ee,{model:e.value.search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:t(()=>[N(a(h,null,{default:t(()=>[a(f,{modelValue:e.value.search.name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.value.search.name=s),placeholder:"请输入姓名",clearable:"",onKeydown:o[1]||(o[1]=pe(s=>E(),["enter"])),onClear:o[2]||(o[2]=s=>E())},null,8,["modelValue"])]),_:2},1536),[[Ee,!l]]),a(h,{prop:"role"},{default:t(()=>[a(k,{modelValue:e.value.search.role,"onUpdate:modelValue":o[3]||(o[3]=s=>e.value.search.role=s),placeholder:"请选择角色"},{default:t(()=>[(d(!0),D(fe,null,ge(z.value,s=>(d(),v(w,{key:s.id,label:s.roleName,value:s.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,null,{default:t(()=>[a(g,{type:"primary",onClick:o[4]||(o[4]=s=>E())},{icon:t(()=>[a(x,{name:"i-ep:search"})]),default:t(()=>[r(" 筛选 ")]),_:1}),a(g,{onClick:O},{icon:t(()=>[ze]),default:t(()=>[r(" 重置 ")]),_:1}),a(g,{link:"",onClick:c},{icon:t(()=>[a(x,{name:l?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:t(()=>[r(" "+_(l?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(te,{"border-style":"dashed"}),a($,{wrap:""},{default:t(()=>[a(g,{type:"primary",size:"default",onClick:W},{icon:t(()=>[a(x,{name:"i-ep:plus"})]),default:t(()=>[r(" 新增用户 ")]),_:1})]),_:1}),N((d(),v(le,{class:"my-4",data:e.value.dataList,stripe:"","highlight-current-row":"",border:"",height:"100%",onSortChange:Q,onSelectionChange:o[5]||(o[5]=l=>e.value.batch.selectionDataList=l)},{default:t(()=>[e.value.batch.enable?(d(),v(m,{key:0,type:"selection",align:"center",fixed:""})):I("",!0),a(m,{prop:"account",sortable:"",label:"帐号"},{default:t(({row:l})=>[l.country==="CN"?(d(),v(b,{key:0,class:"mx-1"},{default:t(()=>[r(_(l.phone),1)]),_:2},1024)):(d(),v(b,{key:1,class:"mx-1"},{default:t(()=>[r(_(l.email),1)]),_:2},1024))]),_:1}),a(m,{prop:"name",label:"姓名",width:"100",align:"center"},{default:t(({row:l})=>[a(b,{class:"mx-1"},{default:t(()=>[r(_(l.name?l.name:"暂无数据"),1)]),_:2},1024)]),_:1}),a(m,{prop:"role",align:"center",width:"150",label:"角色"},{default:t(({row:l})=>[a(b,{class:"mx-1"},{default:t(()=>[r(_(l.role?l.role:"暂无数据"),1)]),_:2},1024)]),_:1}),a(m,{prop:"mobile",label:"国家",width:"150",align:"center"},{default:t(({row:l})=>[a(b,{class:"mx-1"},{default:t(()=>{var c,s;return[r(_((c=S.value)!=null&&c.chineseName?(s=S.value)==null?void 0:s.chineseName:"暂无数据"),1)]}),_:1})]),_:1}),a(m,{label:"状态",width:"100",align:"center"},{default:t(l=>[a(oe,{modelValue:l.row.active,"onUpdate:modelValue":c=>l.row.active=c,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>Y(l.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1}),a(m,{label:"操作",width:"200",align:"center",fixed:"right"},{default:t(l=>[a($,null,{default:t(()=>[a(g,{type:"primary",size:"small",plain:"",onClick:c=>X(l.row)},{default:t(()=>[r(" 编辑 ")]),_:2},1032,["onClick"]),a(g,{type:"danger",size:"small",plain:"",onClick:c=>Z(l.row)},{default:t(()=>[r(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ie,e.value.loading]]),a(ne,{"current-page":C(p).page,total:C(p).total,"page-size":C(p).size,"page-sizes":C(p).sizes,layout:C(p).layout,"hide-on-single-page":!1,class:"pagination",background:"",onCurrentChange:E,onSizeChange:q},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),e.value.formMode==="dialog"||e.value.formMode==="drawer"?(d(),v(Se,{key:0,id:e.value.formModeProps.id,modelValue:e.value.formModeProps.visible,"onUpdate:modelValue":o[6]||(o[6]=l=>e.value.formModeProps.visible=l),row:e.value.formModeProps.row,mode:e.value.formMode,onSuccess:u},null,8,["id","modelValue","row","mode"])):I("",!0)],2)}}});typeof F=="function"&&F(G);const Fe=we(G,[["__scopeId","data-v-7279624f"]]);export{Fe as default};
