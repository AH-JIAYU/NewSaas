
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Ue,aj as Be,aM as je,r as u,c as m,$ as Fe,n as we,a as g,q as ce,o as s,e as i,w as r,v as k,f as c,i as t,s as I,g as h,A as p,B as R,aN as He,j as d,b as E,O as D,ai as W,E as X,aO as ie,aP as Oe,aQ as qe,_ as Ge,be as Je,ao as Ke,M as We}from"./index-C_u2Pe4I.js";import{_ as Xe}from"./index-Cw6HZchh.js";import{_ as Ye}from"./index.vue_vue_type_style_index_0_lang-UK1wbTcv.js";import{_ as Ze}from"./index-byPpTUEi.js";import et from"./index-DmpnnKuz.js";import tt from"./index-DdQsCWRZ.js";import ot from"./index-ppALQU-4.js";import nt from"./index-BI82H1Tb.js";import at from"./index-CSLqw2v0.js";import st from"./customerDetail-CxLO6ljc.js";import lt from"./index-CYQhzeiS.js";import rt from"./index-BWy0y1Qg.js";import{s as ue}from"./apiLoading-CzcmsR6u.js";import{u as ct}from"./user_customer-jfKBxt4k.js";import{a as it}from"./user_cooperation-DxLOmfpL.js";import"./index-CrqPYku7.js";import"./clipboard-BhHkzST6.js";import"./index.vue_vue_type_script_setup_true_lang-CURNgh5G.js";import"./sortable.esm-C0-Qcoum.js";import"./index.vue_vue_type_script_setup_true_lang-DW-Eh2gm.js";import"./index-Pw5SEDf4.js";import"./index-CEsQ0_XN.js";import"./department-bZiaV7wU.js";import"./position_manage-0LKPwPuN.js";import"./configuration_role-C1o0x33O.js";import"./tenant_role-DA9xrVL4.js";import"./configuration_manager-DwuyxZIu.js";import"./configuration_siteSetting-CXhp7U94.js";import"./configuration_site_setting-JBZwo5l4.js";import"./stagedData-DnY4WWWU.js";import"./index.vue_vue_type_script_setup_true_lang-DR67GMTR.js";import"./index-DtVKBU4b.js";import"./member-CB3zcQYN.js";import"./index-CD21kZ2Q.js";import"./index-B-37Z12f.js";const ut=["onClick"],mt={key:0,class:"fontC-System"},dt={class:"tableBig flex-c"},pt={class:"oneLine",style:{width:"calc(100% - 55px)"}},ft={class:"copyId tableSmall"},ht={class:"id oneLine beInvitationTenantId"},_t={class:"flex-c tableBig"},vt={class:"oneLine",style:{width:"calc(100% - 20px)"}},yt={class:"flex-c"},gt={class:"oneLine"},kt={key:0,style:{display:"inline-block"},class:"fontC-System"},bt={key:1},Ct=["onClick"],St={key:1},It=["onClick"],Et={key:1},xt={key:0,class:"fontC-System"},Nt={class:"fontC-System"},At=Ue({name:"customer",__name:"index",setup(Qt){const me=ct(),{t:o}=Be(),{pagination:b,getParams:Rt,onSizeChange:de,onCurrentChange:pe}=je();u([]);const L=u(!1),x=u([]),j=u(),Y=u(),F=u(),fe=u(),N=u(),he=u(),$=u(!0),V=u(!0),P=u(!1),M=u("default"),_=u([]),Z=u(),_e=u("formSearch-customer"),U=u([{label:m(()=>o("customer.customerCode")),checked:!0,sortable:!0,prop:"tenantCustomerId"},{label:m(()=>o("customer.customerName")),checked:!0,sortable:!0,prop:"customerAccord"},{label:m(()=>o("customer.customerShortName")),checked:!0,sortable:!0,prop:"customerShortName"},{label:"PM",checked:!0,sortable:!0,prop:"chargeId"},{label:m(()=>o("customer.noAssociatedProject")),checked:!0,sortable:!0,prop:"projectNumber"},{label:m(()=>o("customer.customerStatus")),checked:!0,sortable:!0,prop:"customerStatus"},{label:m(()=>o("customer.antecedentQuestionnaire")),checked:!0,sortable:!0,prop:"antecedentQuestionnaire"},{label:m(()=>o("customer.riskControl")),checked:!0,sortable:!0,prop:"riskControl"},{label:m(()=>o("customer.limit")),checked:!0,sortable:!0,prop:"turnover"},{label:m(()=>o("customer.rateMin")),checked:!0,sortable:!0,prop:"rateAudit"}]);function ve(){j.value.showEdit()}const ee=u();function ye(n){j.value.showEdit(n)}async function w(n,a,C){console.log(n,"state");const l={status:n,operationalType:a,tenantCustomerId:C},{status:v}=await ue(W.changestatus(l));v===1&&X.success({message:o("customer.editSucess")}),me.customer=null,y()}function ge(n){n.type==1?Y.value.showEdit(n):ee.value.showEdit(n)}function ke(n){n?N.value=n.id:N.value=""}const te=u();function oe(n,a){F.value.showEdit(n,a)}function be(n,a){n.type==1?F.value.showEdit(n,a):te.value.showEdit(n,"chargeUserId")}function Ce(n){ie.confirm(o("customer.delConfirm"),o("customer.delMessage")).then(async()=>{const{status:a}=await ue(W.delete({tenantCustomerId:n.tenantCustomerId}));a===1&&X.success({message:o("customer.delSuccess")}),y()}).catch(()=>{})}const S=Fe({customerShortName:"",customerStatus:null,antecedentQuestionnaire:null});function Se(n){de(n).then(()=>z())}function ne(n=1){pe(n).then(()=>z())}function Ie(){Object.assign(S,{customerShortName:"",customerStatus:null,antecedentQuestionnaire:null}),y()}function y(){b.value.page=1,z()}async function z(){try{L.value=!0;const n={...S},{data:a}=await W.getBindCustomer(n);x.value=(a==null?void 0:a.getBindCustomerInfoList)||[],Ee(),L.value=!1}catch{}finally{L.value=!1}}const Ee=()=>{x.value.forEach(l=>{l.type==2&&(l.tenantCustomerId=l.beInvitationTenantId)});const n=x.value.filter(l=>l.type==2&&l.customerStatus==2);let a=x.value.filter(l=>l.type==2&&l.customerStatus==4);a=Array.from(new Map(a.map(l=>[l.beInvitationTenantId,l])).values());const C=n.map(l=>l.type==2&&l.beInvitationTenantId);a.forEach(l=>{C.includes(l.beInvitationTenantId)||n.push(l)}),x.value.forEach(l=>{l.type==1&&n.push(l)}),x.value=n},xe=m(()=>{const n=x.value.filter(l=>{const[v,B]=S.customerStatus!=null?S.customerStatus.split(",").map(Number):["",""],H=S.customerShortName?l.customerShortName==S.customerShortName:!0,O=S.antecedentQuestionnaire?l.antecedentQuestionnaire==S.antecedentQuestionnaire:!0,q=v?l.type==v:!0,T=B?l.customerStatus===B:!0;return H&&O&&q&&T}),a=(b.value.page-1)*b.value.size,C=a+b.value.size;return b.value.total=n.slice(a,C).length,n.slice(a,C)});function Ne(n){he.value=n}we(async()=>{U.value.forEach(n=>{n.checked&&_.value.push(n.prop)}),y(),Z.value=[{index:1,show:!0,type:"input",modelName:"customerShortName",placeholder:m(()=>o("customer.customerShortName"))},{index:2,show:!0,type:"select",modelName:"customerStatus",placeholder:m(()=>o("customer.customerStatus")),option:"customerStatus",optionLabel:"label",optionValue:"value"},{index:3,show:!0,type:"select",modelName:"antecedentQuestionnaire",placeholder:m(()=>o("customer.antecedentQuestionnaire")),option:"antecedentQuestionnaire",optionLabel:"label",optionValue:"value"}]});const Ae={customerStatus:()=>[{label:m(()=>o("customer.forbidden")),value:"1,1"},{label:m(()=>o("customer.enable")),value:"1,2"},{label:m(()=>o("customer.Agree")),value:"2,2"},{label:m(()=>o("customer.Terminate")),value:"2,4"}],antecedentQuestionnaire:()=>[{label:m(()=>o("customer.forbidden")),value:1},{label:m(()=>o("customer.enable")),value:2}]},ae=u(),se=u();function Qe(){se.value.showEdit()}function Re(n){ae.value.showEdit(n)}function De(n){ie.prompt(o("customer.configuration"),o("customer.stop"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),inputPlaceholder:o("customer.instructions"),inputPattern:/^.{0,500}$/,inputErrorMessage:o("customer.lt500"),type:"warning"}).then(async a=>{const{data:{flag:C}}=await it.updateRescindTenant({beInvitationTenantId:n.beInvitationTenantId,remark:a.value});C&&X({type:"success",message:o("customer.terminatedCooperation")}),z()}).catch(()=>{})}return(n,a)=>{const C=Ze,l=g("ElDivider"),v=g("el-button"),B=Ye,H=Oe,O=qe,q=g("el-row"),T=g("ElSwitch"),G=g("el-text"),J=g("ElTableColumn"),le=Xe,K=Ge,re=g("el-tooltip"),A=g("el-table-column"),ze=Je,Te=g("ElSpace"),Le=g("el-empty"),$e=g("el-table"),Ve=g("ElPagination"),Pe=Ke,Q=ce("auth"),Me=ce("loading");return s(),i(Pe,null,{default:r(()=>[k("div",{class:D({"absolute-container":t(P)})},[c(C,{formSearchList:t(Z),formSearchName:t(_e),onCurrentChange:ne,onOnReset:Ie,model:t(S),formOption:Ae},null,8,["formSearchList","formSearchName","model"]),c(l,{"border-style":"dashed"}),c(q,null,{default:r(()=>[c(B,null,{default:r(()=>[I((s(),i(v,{type:"primary",size:"default",onClick:ve},{default:r(()=>[h(p(t(o)("common.new")),1)]),_:1})),[[Q,"customer-get-addTenantCustomer"]]),I((s(),i(v,{type:"primary",size:"default",onClick:Qe},{default:r(()=>[h(p(t(o)("customer.invite")),1)]),_:1})),[[Q,"cooperation-get-addInvitationBind"]])]),_:1}),c(O,null,{default:r(()=>[c(v,{size:"default"},{default:r(()=>[h(p(t(o)("common.export")),1)]),_:1}),c(H,{border:t($),"onUpdate:border":a[0]||(a[0]=e=>R($)?$.value=e:null),tableAutoHeight:t(P),"onUpdate:tableAutoHeight":a[1]||(a[1]=e=>R(P)?P.value=e:null),checkList:t(_),"onUpdate:checkList":a[2]||(a[2]=e=>R(_)?_.value=e:null),columns:t(U),"onUpdate:columns":a[3]||(a[3]=e=>R(U)?U.value=e:null),"line-height":t(M),"onUpdate:lineHeight":a[4]||(a[4]=e=>R(M)?M.value=e:null),stripe:t(V),"onUpdate:stripe":a[5]||(a[5]=e=>R(V)?V.value=e:null),style:{"margin-left":"12px"},onQueryData:y},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),I((s(),i($e,{border:t($),data:t(xe),size:t(M),stripe:t(V),onSelectionChange:Ne,"highlight-current-row":"",onCurrentChange:ke},{empty:r(()=>[c(Le,{image:t(He),"image-size":300},null,8,["image"])]),default:r(()=>[t(_).includes("customerStatus")?(s(),i(J,{key:0,align:"left","show-overflow-tooltip":"",prop:"customerStatus",label:t(o)("customer.customerStatus"),width:"84"},{default:r(({row:e})=>[k("div",{onClick:f=>w(e.customerStatus,1,e.tenantCustomerId)},[e.type==1?(s(),i(T,{key:0,modelValue:e.customerStatus,"onUpdate:modelValue":f=>e.customerStatus=f,"inline-prompt":"","inactive-value":1,"active-value":2,"active-text":t(o)("customer.enable"),"inactive-text":t(o)("customer.forbidden")},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"])):d("",!0)],8,ut),e.type==2?(s(),E("div",mt,[e.customerStatus===2?(s(),i(G,{key:0,type:"success"},{default:r(()=>[h(p(t(o)("customer.cooperation")),1)]),_:1})):d("",!0),e.customerStatus===4?(s(),i(G,{key:1,type:"danger"},{default:r(()=>[h(p(t(o)("customer.rescindContract")),1)]),_:1})):d("",!0)])):d("",!0)]),_:1},8,["label"])):d("",!0),t(_).includes("customerAccord")?(s(),i(A,{key:1,align:"left",prop:"customerAccord",label:t(o)("customer.customerName"),width:"230"},{default:r(({row:e})=>[k("div",dt,[k("div",pt,p(e.customerAccord),1),c(le,{content:e.customerAccord,class:D({rowCopy:"rowCopy",current:e.id===t(N)})},null,8,["content","class"]),e.type==1?(s(),i(K,{key:0,onClick:f=>oe(e,"customerAccord"),class:D({edit:"edit",current:e.id===t(N)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):d("",!0)]),k("div",ft,[k("div",ht,[c(re,{effect:"dark",content:e.tenantCustomerId,placement:"top-start"},{default:r(()=>[h(p(e.tenantCustomerId),1)]),_:2},1032,["content"])]),c(le,{content:e.tenantCustomerId,class:D({rowCopy:"rowCopy",current:e.id===t(N)})},null,8,["content","class"])])]),_:1},8,["label"])):d("",!0),t(_).includes("customerShortName")?(s(),i(A,{key:2,align:"left",prop:"customerShortName",label:t(o)("customer.customerShortName"),width:"150"},{default:r(({row:e})=>[k("div",_t,[k("div",vt,[c(re,{effect:"dark",content:e.customerShortName,placement:"top-start"},{default:r(()=>[h(p(e.customerShortName),1)]),_:2},1032,["content"])]),e.customerShortName?(s(),i(K,{key:0,onClick:f=>oe(e,"customerShortName"),class:D({edit:"edit",current:e.id===t(N)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):d("",!0)])]),_:1},8,["label"])):d("",!0),t(_).includes("chargeId")?(s(),i(A,{key:3,align:"left",prop:"chargeId","show-overflow-tooltip":"",label:"PM"},{default:r(({row:e})=>[k("div",yt,[k("div",gt,p(e.chargeName),1),c(K,{onClick:f=>be(e,"chargeId"),class:D({edit:"edit",current:e.id===t(N)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):d("",!0),t(_).includes("projectNumber")?(s(),i(A,{key:4,align:"left",prop:"turnover","show-overflow-tooltip":"",label:t(o)("customer.noAssociatedProject")},{default:r(({row:e})=>[e.type==1?(s(),E("span",kt,p(e.projectNumber||0),1)):(s(),E("span",bt,"-"))]),_:1},8,["label"])):d("",!0),t(_).includes("antecedentQuestionnaire")?(s(),i(J,{key:5,align:"left","show-overflow-tooltip":"",prop:"antecedentQuestionnaire",label:t(o)("customer.antecedentQuestionnaire")},{default:r(({row:e})=>[e.type==1?(s(),E("div",{key:0,onClick:f=>w(e.antecedentQuestionnaire,2,e.tenantCustomerId)},[c(T,{modelValue:e.antecedentQuestionnaire,"onUpdate:modelValue":f=>e.antecedentQuestionnaire=f,"inline-prompt":"","inactive-value":1,"active-value":2,"active-text":t(o)("customer.enable"),"inactive-text":t(o)("customer.forbidden")},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"])],8,Ct)):(s(),E("div",St," - "))]),_:1},8,["label"])):d("",!0),t(_).includes("riskControl")?(s(),i(J,{key:6,align:"left","show-overflow-tooltip":"",prop:"riskControl",label:t(o)("customer.riskControl")},{default:r(({row:e})=>[e.type==1?(s(),E("div",{key:0,onClick:f=>w(e.riskControl,3,e.tenantCustomerId)},[c(T,{modelValue:e.riskControl,"onUpdate:modelValue":f=>e.riskControl=f,"inline-prompt":"","inactive-value":1,"active-value":2,"active-text":t(o)("customer.enable"),"inactive-text":t(o)("customer.forbidden")},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"])],8,It)):(s(),E("div",Et," - "))]),_:1},8,["label"])):d("",!0),t(_).includes("turnover")?(s(),i(A,{key:7,align:"left",prop:"turnover","show-overflow-tooltip":"",label:t(o)("customer.limit")},{default:r(({row:e})=>[e.turnover>0?(s(),E("div",xt,[c(ze),h(p(e.turnover),1)])):(s(),i(G,{key:1,class:"fontC-System"},{default:r(()=>[h("-")]),_:1}))]),_:1},8,["label"])):d("",!0),t(_).includes("rateAudit")?(s(),i(A,{key:8,align:"left",prop:"rateAudit","show-overflow-tooltip":"",label:t(o)("customer.rateMin")},{default:r(({row:e})=>[k("div",Nt,p(e.rateAudit?e.rateAudit:"-"),1)]),_:1},8,["label"])):d("",!0),c(A,{align:"left",fixed:"right",prop:"i",label:t(o)("customer.control"),width:"240"},{default:r(({row:e})=>[c(Te,null,{default:r(()=>[e.type==1?I((s(),i(v,{key:0,size:"small",plain:"",type:"primary",onClick:f=>ye(e)},{default:r(()=>[h(p(t(o)("common.edit")),1)]),_:2},1032,["onClick"])),[[Q,"customer-update-updateTenantCustomer"]]):d("",!0),I((s(),i(v,{type:"warning",plain:"",size:"small",onClick:f=>ge(e)},{default:r(()=>[h(p(t(o)("common.detail")),1)]),_:2},1032,["onClick"])),[[Q,"customer-get-getTenantCustomerInfo"]]),e.type==1?I((s(),i(v,{key:1,type:"danger",plain:"",size:"small",onClick:f=>Ce(e)},{default:r(()=>[h(p(t(o)("common.delete")),1)]),_:2},1032,["onClick"])),[[Q,"customer-delete-deleteTenantCustomer"]]):d("",!0),e.type==2?I((s(),i(v,{key:2,size:"small",type:"primary",plain:"",onClick:f=>Re(e)},{default:r(()=>[h(p(t(o)("customer.cooperativeAllocation")),1)]),_:2},1032,["onClick"])),[[Q,"cooperation-update-updateInvitationBindUser"]]):d("",!0),e.customerStatus===2&&e.type==2?I((s(),i(v,{key:3,type:"danger",plain:"",size:"small",onClick:f=>De(e)},{default:r(()=>[h(p(t(o)("customer.stop")),1)]),_:2},1032,["onClick"])),[[Q,"cooperation-update-updateRescindTenant"]]):d("",!0)]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["border","data","size","stripe"])),[[Me,t(L)]]),c(Ve,{"current-page":t(b).page,total:t(b).total,"page-size":t(b).size,"page-sizes":t(b).sizes,layout:t(b).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Se,onCurrentChange:ne},null,8,["current-page","total","page-size","page-sizes","layout"]),c(et,{ref_key:"editRef",ref:j,onFetchData:y},null,512),c(tt,{ref_key:"QuickEditRef",ref:F,onFetchData:y},null,512),c(ot,{ref_key:"AssociatedProjectsRef",ref:fe,onFetchData:y},null,512),c(nt,{ref_key:"checkRef",ref:Y,onFetchData:y},null,512),c(at,{ref_key:"cooperationDetaiRef",ref:ee,onFetchData:y},null,512),c(st,{ref_key:"addCooperationRef",ref:se,onQueryData:y},null,512),c(lt,{ref_key:"proportionRef",ref:ae,onFetchData:y},null,512),c(rt,{ref_key:"QuickEditCooperationRef",ref:te,onFetchData:z},null,512)],2)]),_:1})}}}),po=We(At,[["__scopeId","data-v-d9929d97"]]);export{po as default};
