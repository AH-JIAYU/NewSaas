
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as _,s as P}from"./apiLoading-9tau8HoF.js";import{a as x}from"./projectManagement-exzbzQTU.js";import{c as J}from"./user_cooperation-DzD2ZlFK.js";import{U as K}from"./user_supplier-DRPfBlWH.js";import{u as Q}from"./survey_vipGroup-mGxhF7N0.js";import{d as W,r as f,l as X,b as p,q as Y,o as u,e as b,g as r,w as o,t as Z,h as s,s as $,j as l,f as n,k as I,F as T,v as k,I as ee,E as le,R as te}from"./index-CF9jBOb7.js";import"./user_supplier-BjB0mmEZ.js";import"./survey_vipGroup-_sN6TmiW.js";const oe={style:{flex:"auto"}},ae=W({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(re,{expose:G,emit:U}){const C=K(),N=Q(),B=U,g=f(!1),m=f(!1),L=f(),e=f({title:"分配",list:[],tenantSupplierList:[],vipGroupList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]},selectAll:{supplier:!1,member:!1}}),E=f({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]});async function R(i,a){if(e.value.list=[{...i}],a==="reassign"){e.value.title="重新分配";const y=await _(x.getProjectAllocation({projectId:i.projectId})),{groupSupplierIdSet:d,...V}=y.data;e.value.form=V,e.value.form.groupSupplierIdList=d}else e.value.title="分配",e.value.form.projectId=i.projectId;e.value.tenantSupplierList=await _(C.getTenantSupplierList(i.projectId)),e.value.vipGroupList=await _(N.getGroupNameList());const c=await _(J.getAllocationBindList({projectId:i.projectId}));e.value.tenantList=c.data.allocationBindInfoList,m.value=!0}function z(){e.value.form.groupSupplierIdList=[]}function F(){e.value.form.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(i=>{e.value.form.groupSupplierIdList.push(i.tenantSupplierId)})}function M(){e.value.form.groupSupplierIdList=[],e.value.selectAll.member&&e.value.vipGroupList.map(i=>{e.value.form.groupSupplierIdList.push(i.memberGroupId)})}function S(){L.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),m.value=!1}function q(){L.value.validate(async i=>{if(i)try{g.value=!0;const{status:a}=await P(x.allocation(e.value.form));g.value=!1,a===1&&le.success({message:"分配成功",center:!0}),S(),B("fetch-data")}catch{}finally{g.value=!1}})}return X(async()=>{}),G({showEdit:R}),(i,a)=>{const c=p("el-table-column"),y=p("el-table"),d=p("el-radio"),V=p("el-radio-group"),v=p("el-form-item"),A=p("el-checkbox"),h=p("el-option"),w=p("el-select"),D=p("el-form"),j=p("el-button"),H=p("el-dialog"),O=Y("loading");return u(),b("div",null,[r(H,{modelValue:l(m),"onUpdate:modelValue":a[6]||(a[6]=t=>ee(m)?m.value=t:null),title:"分配",width:"700","before-close":S},{footer:o(()=>[Z("div",oe,[r(j,{onClick:S},{default:o(()=>[s(" 取消 ")]),_:1}),r(j,{type:"primary",onClick:q},{default:o(()=>[s(" 确定 ")]),_:1})])]),default:o(()=>[$((u(),n(y,{data:l(e).list,"row-key":"id"},{default:o(()=>[r(c,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),r(c,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),r(c,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[O,l(g)]]),r(D,{ref_key:"formRef",ref:L,"label-width":"80px",rules:l(E),model:l(e).form,inline:!1},{default:o(()=>[r(v,{label:"分配目标"},{default:o(()=>[r(V,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=t=>l(e).form.allocationType=t),class:"ml-4",onChange:z},{default:o(()=>[r(d,{value:2,size:"large"},{default:o(()=>[s(" 供应商 ")]),_:1}),r(d,{value:3,size:"large"},{default:o(()=>[s(" 会员组 ")]),_:1}),r(d,{value:4,size:"large"},{default:o(()=>[s("租户 ")]),_:1}),l(e).title==="重新分配"?(u(),n(d,{key:0,value:5,size:"large"},{default:o(()=>[s(" 取消分配 ")]),_:1})):I("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===2&&l(e).form.allocationType!==5?(u(),n(v,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:o(()=>[r(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[2]||(a[2]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:o(()=>[r(A,{modelValue:l(e).selectAll.supplier,"onUpdate:modelValue":a[1]||(a[1]=t=>l(e).selectAll.supplier=t),onChange:F,style:{display:"flex",height:"unset"}},{default:o(()=>[s("全选")]),_:1},8,["modelValue"])]),default:o(()=>[(u(!0),b(T,null,k(l(e).tenantSupplierList,t=>(u(),n(h,{label:t.supplierAccord,value:t.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):I("",!0),l(e).form.allocationType===3&&l(e).form.allocationType!==5?(u(),n(v,{key:1,label:"会员组",prop:"groupSupplierIdList"},{default:o(()=>[r(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[4]||(a[4]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择会员组",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:o(()=>[r(A,{modelValue:l(e).selectAll.member,"onUpdate:modelValue":a[3]||(a[3]=t=>l(e).selectAll.member=t),onChange:M,style:{display:"flex",height:"unset"}},{default:o(()=>[s("全选")]),_:1},8,["modelValue"])]),default:o(()=>[(u(!0),b(T,null,k(l(e).vipGroupList,t=>(u(),n(h,{label:t.memberGroupName,value:t.memberGroupId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):I("",!0),l(e).form.allocationType===4&&l(e).form.allocationType!==5?(u(),n(v,{key:2,label:"租户",prop:"groupSupplierIdList"},{default:o(()=>[r(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[5]||(a[5]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择租户",clearable:"",filterable:"",multiple:"","collapse-tags":"","multiple-limit":1},{default:o(()=>[(u(!0),b(T,null,k(l(e).tenantList,t=>(u(),n(h,{label:t.beInvitationTenantName,value:t.beInvitationTenantId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):I("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),fe=te(ae,[["__scopeId","data-v-99b6204a"]]);export{fe as default};
