
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as k,s as W}from"./apiLoading-CdcWq19R.js";import{a as C}from"./projectManagement-DoDmCjn1.js";import{c as X}from"./user_cooperation-p9YoTtyy.js";import{a as Y}from"./survey_vip_department-CFN04oW3.js";import{U as Z}from"./user_supplier-LIoHsG7H.js";import{u as $}from"./survey_vipGroup-DoSQF_rQ.js";import{d as ee,r as m,n as le,a as n,q as te,o as s,b as V,f as r,w as t,y as ae,g as d,s as oe,i as l,e as p,j as L,F as j,t as A,A as re,E as ie,L as ne}from"./index-CkoP-l3x.js";import"./user_supplier-DSBK5IAK.js";import"./survey_vipGroup-CZslL8vE.js";const se={style:{flex:"auto"}},pe=ee({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(ue,{expose:U,emit:N}){const B=Z();$();const E=N,b=m(!1),g=m(!1),S=m(),I=m(),c=m([]),R={children:"children",label:"name"},e=m({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]},selectAll:{supplier:!1,member:!1}}),z=m({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]});async function D(i,a){if(e.value.list=[{...i}],a==="reassign"){e.value.title="重新分配";const u=await k(C.getProjectAllocation({projectId:i.projectId})),{groupSupplierIdSet:y,..._}=u.data;e.value.form=_,e.value.form.groupSupplierIdList=y}else e.value.title="分配",e.value.form.projectId=i.projectId;e.value.tenantSupplierList=await k(B.getTenantSupplierList(i.projectId));const f=await Y.list({name:""});e.value.departmentList=f.data;const v=await k(X.getAllocationBindList({projectId:i.projectId}));c.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(c.value=e.value.form.groupSupplierIdList),e.value.tenantList=v.data.allocationBindInfoList,g.value=!0}function F(){e.value.form.groupSupplierIdList=[]}function K(){e.value.form.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(i=>{e.value.form.groupSupplierIdList.push(i.tenantSupplierId)})}const q=(i,a)=>{a?c.value=[i.id]:c.value=c.value.filter(y=>y!==i.id),c.value=I.value.getCheckedKeys(!1);const f=I.value.getCheckedKeys(),v=I.value.getHalfCheckedKeys(),u=f.concat(v);e.value.form.groupSupplierIdList=u};function h(){S.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),g.value=!1}function H(){S.value.validate(async i=>{if(i)try{b.value=!0;const{status:a}=await W(C.allocation(e.value.form));b.value=!1,a===1&&ie.success({message:"分配成功",center:!0}),h(),E("fetch-data")}catch{}finally{b.value=!1}})}return le(async()=>{}),U({showEdit:D}),(i,a)=>{const f=n("el-table-column"),v=n("el-table"),u=n("el-radio"),y=n("el-radio-group"),_=n("el-form-item"),M=n("el-checkbox"),x=n("el-option"),w=n("el-select"),P=n("el-tree"),G=n("el-text"),O=n("el-form"),T=n("el-button"),J=n("el-dialog"),Q=te("loading");return s(),V("div",null,[r(J,{modelValue:l(g),"onUpdate:modelValue":a[4]||(a[4]=o=>re(g)?g.value=o:null),title:"分配",width:"700","before-close":h},{footer:t(()=>[ae("div",se,[r(T,{onClick:h},{default:t(()=>[d(" 取消 ")]),_:1}),r(T,{type:"primary",onClick:H},{default:t(()=>[d(" 确定 ")]),_:1})])]),default:t(()=>[oe((s(),p(v,{data:l(e).list,"row-key":"id"},{default:t(()=>[r(f,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),r(f,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),r(f,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[Q,l(b)]]),r(O,{ref_key:"formRef",ref:S,"label-width":"80px",rules:l(z),model:l(e).form,inline:!1},{default:t(()=>[r(_,{label:"分配目标"},{default:t(()=>[r(y,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=o=>l(e).form.allocationType=o),class:"ml-4",onChange:F},{default:t(()=>[r(u,{value:2,size:"large"},{default:t(()=>[d(" 供应商 ")]),_:1}),r(u,{value:3,size:"large"},{default:t(()=>[d(" 部门 ")]),_:1}),r(u,{value:4,size:"large"},{default:t(()=>[d("租户 ")]),_:1}),l(e).title==="重新分配"?(s(),p(u,{key:0,value:5,size:"large"},{default:t(()=>[d(" 取消分配 ")]),_:1})):L("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===2&&l(e).form.allocationType!==5?(s(),p(_,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:t(()=>[r(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[2]||(a[2]=o=>l(e).form.groupSupplierIdList=o),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:t(()=>[r(M,{modelValue:l(e).selectAll.supplier,"onUpdate:modelValue":a[1]||(a[1]=o=>l(e).selectAll.supplier=o),onChange:K,style:{display:"flex",height:"unset"}},{default:t(()=>[d("全选")]),_:1},8,["modelValue"])]),default:t(()=>[(s(!0),V(j,null,A(l(e).tenantSupplierList,o=>(s(),p(x,{label:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):L("",!0),l(e).form.allocationType===3&&l(e).form.allocationType!==5?(s(),p(_,{key:1,label:"部门",prop:"groupSupplierIdList"},{default:t(()=>[l(e).departmentList.length>0?(s(),p(P,{key:0,style:{"max-width":"600px"},ref_key:"treeRef",ref:I,data:l(e).departmentList,"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":l(c),"default-expand-all":"",props:R,onCheckChange:q},null,8,["data","default-checked-keys"])):(s(),p(G,{key:1},{default:t(()=>[d("暂无数据")]),_:1}))]),_:1})):L("",!0),l(e).form.allocationType===4&&l(e).form.allocationType!==5?(s(),p(_,{key:2,label:"租户",prop:"groupSupplierIdList"},{default:t(()=>[r(w,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[3]||(a[3]=o=>l(e).form.groupSupplierIdList=o),placeholder:"请选择租户",clearable:"",filterable:"",multiple:"","collapse-tags":"","multiple-limit":1},{default:t(()=>[(s(!0),V(j,null,A(l(e).tenantList,o=>(s(),p(x,{label:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):L("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),Ie=ne(pe,[["__scopeId","data-v-23c9341f"]]);export{Ie as default};
