
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as M}from"./index.vue_vue_type_script_setup_true_lang-BrriabVI.js";import{o as z,s as L}from"./apiLoading-QnSqjYrt.js";import{a as i}from"./user_supplier-DHM5gYP9.js";import{u as R}from"./stagedData-vOJ5fNZG.js";import{U as j}from"./user_supplier-1sbFhifP.js";import{u as O}from"./user_customer-DOTs2LNv.js";import{d as P,r as u,L as $,M as v,o as q,a2 as h,a as y,i as F,f as d,w as c,b as G,g,c as H,j as J,h as K,A as Q,ak as C,ai as p,y as W}from"./index-Dfh_jK84.js";import"./index-C-HwqIUF.js";import"./index-DlZ-wTjx.js";import"./configuration_supplierLevel-CoIH1JL3.js";import"./user_customer-BHXRPBIa.js";const X={class:"flex-c"},Y=P({__name:"index",emits:["fetch-data"],setup(Z,{expose:S,emit:I}){const f=R(),_=j(),k=O(),x=I,l=u(!1),o=u(""),b=u(),n=u([]),r=u([]);function D(e){r.value.push(e)}$("validateTopTabs",D);let a=v([]);async function V(e){if(!e)o.value="新增",a=f.usersupplier||[C(_.initialTopTabsData)];else{o.value="编辑";const{data:t}=await z(i.detail({tenantSupplierId:e.tenantSupplierId}));t.countryType=t.subordinateCountryId==="343"?1:2,E(t)}n.value=[],l.value=!0,_.TenantSupplierList=null}function E(e){a.length=0,a.push({...e})}function N(e){const t=new Set;for(const s of e){if(t.has(s.supplierAccord))return!0;t.add(s.supplierAccord)}return!1}function A(){f.usersupplier=C(a),a=v([]),l.value=!1,r.value=[]}function w(){a=v([]),l.value=!1,r.value=[],o.value==="新增"&&(f.usersupplier=null)}async function T(){const e=[];r.value.forEach(s=>{e.push(s.validate())});const t=await Promise.allSettled(e);n.value=t.map(s=>s.status)}async function U(){if(a.forEach(e=>{delete e.payMethod,delete e.accountName,delete e.collectionAccount,delete e.bankName}),await T(),n.value.every(e=>e==="fulfilled"))if(N(a))p.warning({message:"供应商名称重复",center:!0});else{if(o.value==="新增"){const e={addTenantSupplierInfoList:a},{status:t}=await L(i.create(e));t===1&&console.log("传入的客户",e),p.success({message:"新增成功",center:!0})}else{delete a[0].getTenantCustomerOperationInfosList;const{status:e}=await L(i.edit(a[0])),s={addTenantSupplierInfoList:a}.addTenantSupplierInfoList[0].relevanceCustomerIdList;console.log("customerId",s);const m=await i.getTenantSupplierInfo({tenantSupplierId:s});console.log("res2",m),console.log("传入的客户",a[0].relevanceCustomerIdList),e===1&&p.success({message:"修改成功",center:!0})}x("fetch-data"),w()}else b.value.activeLeftTab=n.value.indexOf("rejected"),p.warning({message:"请完善表单",center:!0})}return q(async()=>{await k.getCustomerList();let e=[];const t=await i.getCustomerCooperation({customerId:e});console.log("res",t)}),S({showEdit:V}),(e,t)=>{const s=h("el-button"),m=h("el-drawer");return y(),F("div",null,[d(m,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=B=>l.value=B),class:Q(o.value==="新增"?"hide-drawer-header":"edit-drawer"),"append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:""},{footer:c(()=>[G("div",X,[d(s,{onClick:w},{default:c(()=>[g(" 取消 ")]),_:1}),o.value==="新增"?(y(),H(s,{key:0,type:"warning",onClick:A},{default:c(()=>[g(" 暂存 ")]),_:1})):J("",!0),d(s,{type:"primary",onClick:U},{default:c(()=>[g(" 确定 ")]),_:1})])]),default:c(()=>[d(M,{onValidate:T,ref_key:"LeftTabsRef",ref:b,title:o.value,"left-tabs-data":K(a),"validate-top-tabs":r.value,"validate-all":n.value},null,8,["title","left-tabs-data","validate-top-tabs","validate-all"])]),_:1},8,["modelValue","class"])])}}}),de=W(Y,[["__scopeId","data-v-f7049e96"]]);export{de as default};
