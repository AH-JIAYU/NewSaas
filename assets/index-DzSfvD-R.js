
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as ne,a as ue}from"./he-Cx_rshqu.js";import{o as D,s as de}from"./apiLoading-CE6UrJ0t.js";import{a as O}from"./projectManagement-66_rjngE.js";import{a as ce}from"./user_cooperation-7YU9rz3g.js";import{a as fe}from"./survey_vip_department-DqemGsOg.js";import{U as ge}from"./user_supplier-DPaXEvD9.js";import{u as me}from"./survey_vipGroup-CPUzVNP_.js";import{d as ve,r as n,n as Ie,a as v,q as Ae,o as u,b as S,f as i,w as s,y as I,g as c,s as Se,i as t,e as w,j as h,F as Y,t as z,A as Le,E as G,aH as he,aI as ye,L as _e}from"./index-C6CLk4Z_.js";import"./user_supplier-CZxCOKzz.js";import"./survey_vipGroup-VFtvLYdL.js";const N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAS1JREFUKFN1kr8vQ1EUxz+HRl5EYhEaSRMSTBIDo/DKYDCwWVjKZrAYREgaJTF0MJD4kdbSjT/AxAsREgYSo0gs/gDLE1575Op77VV1l3ty7vfzzflxhfC4aY2RYAZhGugBPlAeBPYv5uUx0okJxo+0o9jAKcJw9FBzb3opWTc5cY/VocQVwtA/4ii95qVkywBLKDu2OJ2E8xe4fLWySsAnveLm9K7WPd4C2Qk4vP8DLRvgCyHW1gyDnVVHA80NwIb3CyqIm1cfcPrbYbKvCjQ1wmgXnD1D9rqSL9QtyYgzY+AHkPGgqCEgrBhgEWHXbnp1BH4gW2z24tMt4cJu7MYTrfD2bjmX3cpjNZG7p3EcTuouzoxT2K4szi4lmdcphdnwawTALSUOvAV5inTfDOJhkx1Lf7QAAAAASUVORK5CYII=",be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAklJREFUOE+VlF9Ik2EUxp/HjbZSgoqJZFiLIBeEgoOEiBZ02UAoWFCwdbUNEvKui0CFLrorUHBdaVHQqGiw0V1oRNGFhiGUdtGWDlquMMJs4fpOfPv7fdvrau/d953n/b3nHM55CMWREY8Vfd0+oQwA6AfYUZKlITJPtsRS2V9R56WpXO111v6QeOiCUG4A3Kd6zPAvQ5Er9N6OGnUVoJ6V5u6+SeDyP0CmsIhEWuaWBjkyk9cDFeCfeHiClFAzsLJWgHHLmchgBShPgz7R+EAJ6zoBOI4UQ6sLwMorpYyCi/RG7lMmA3Zx2JMAyo0HDp4G9nuA94+BHj9otRUh+Rzk7V3AdRZIPgNS0wa4pDm75KQkwn6BTJme9YyCre2Q+TuGppQUArDXD/xchcwMm64VstTiwScg9fGonlPXwR17Grdz4xtk+lqNRh5RS4T0cg+ogLL2Efj9w3xpWxu4+xCgBqZ14CYAqxK4/BLIrZmB9l1g1/EtgMg3Bn5ZADbX6zNsP9oIGFyp24pSD+XzGyD33Qy07QT3urcqOUUtEXwI8Nx/l9zqADuPqYEiMRZ3F/eUwK8fgPyGOUOLDXS4lECCAeo7LO7DSVPZJ4fBtuqcK+dnPQN5PmoMZT5lc87CLtdl2dEDdPY3nsPlF0D2XUVDkfO681TNIREaa9ZpyjQRRizeibD+bbavPtdYs45DYByzi0N19lV5reg8t0xmoSxe0hRe1R3GGK5z7EJPJwN2OLb7RLQBkL0ASu4tGQCvKYxhbjFazsoI/AvM0v9Xs8g/iwAAAABJRU5ErkJggg==",b=C=>(he("data-v-1d3aac5f"),C=C(),ye(),C),je=b(()=>I("span",{class:"icon-class"},[I("img",{src:ne,alt:"",style:{"margin-right":"0.25rem"}}),c(" 供应商")],-1)),ke=b(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ve={key:1},Ce=b(()=>I("span",{class:"icon-class"},[I("img",{src:be,alt:"",style:{"margin-right":"0.25rem"}}),c(" 调查站")],-1)),xe=b(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Te={key:1},Ee=b(()=>I("span",{class:"icon-class"},[I("img",{src:ue,alt:"",style:{"margin-right":"0.25rem"}}),c(" 合作商")],-1)),we=b(()=>I("img",{src:N,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Re={key:1},Ue={style:{flex:"auto"}},Pe=ve({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(C,{expose:Q,emit:J}){const M=ge();me();const F=J,x=n(!1),j=n(!1),R=n(),y=n(),_=n([]),H={children:"children",label:"name"};n([]);const e=n({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),f=n({projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),g=n({projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),r=n({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),q=n({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]}),T=n();async function W(a,l){if(e.value.list=[{...a}],l==="reassign"){e.value.title="重新分配";const m=await D(O.getProjectAllocation({projectId:a.projectId}));e.value.form.projectId=a.projectId;const{getProjectAllocationInfoList:L}=m.data;L.forEach(p=>{p.allocationType===2?g.value={allocationType:p.allocationType,projectId:p.projectId,groupSupplierIdList:p.groupSupplierIdSet}:p.allocationType===3?r.value={allocationType:p.allocationType,projectId:p.projectId,groupSupplierIdList:p.groupSupplierIdSet}:p.allocationType===4&&(f.value={allocationType:p.allocationType,projectId:p.projectId,groupSupplierIdList:p.groupSupplierIdSet},T.value=p.groupSupplierIdSet)})}else e.value.title="分配",e.value.form.projectId=a.projectId,f.value.projectId=a.projectId,g.value.projectId=a.projectId,r.value.projectId=a.projectId;e.value.tenantSupplierList=await D(M.getTenantSupplierList(a.projectId));const A=await fe.list({name:""});e.value.departmentList=A.data;const d=await D(ce.getAllocationBindList({projectId:a.projectId}));_.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(_.value=e.value.form.groupSupplierIdList),e.value.tenantList=d.data.allocationBindInfoList,j.value=!0}function Z(){f.value.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(a=>{f.value.groupSupplierIdList.push(a.beInvitationTenantId)})}function X(){g.value.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(a=>{g.value.groupSupplierIdList.push(a.tenantSupplierId)})}const $=()=>{r.value.groupSupplierIdList=[],e.value.departmentList.forEach(a=>{K(a)}),y.value.setCheckedKeys(r.value.groupSupplierIdList)};function K(a){r.value.groupSupplierIdList.push(a.id),a.children&&a.children.length&&a.children.forEach(l=>{K(l)})}function ee(){r.value.groupSupplierIdList=[],e.value.selectAll.member?($(),y.value.setCheckedKeys(r.value.groupSupplierIdList)):(e.value.selectAll.member=!1,r.value.groupSupplierIdList=[],y.value.setCheckedKeys([]))}const le=(a,l)=>{l?_.value.includes(a.id)||_.value.push(a.id):_.value=_.value.filter(L=>L!==a.id);const A=y.value.getCheckedKeys(),d=y.value.getHalfCheckedKeys(),m=[...A,...d];r.value.groupSupplierIdList=m},k=n(!1),V=n(!1),te=()=>{V.value=!V.value,V.value?k.value=!0:k.value=!1},ae=()=>{Object.assign(f.value,{projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),Object.assign(g.value,{projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),Object.assign(r.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.tenant=!1,e.value.selectAll.supplier=!1,e.value.selectAll.member=!1};function U(){R.value.resetFields(),ae(),j.value=!1,k.value=!1,V.value=null}function oe(){R.value.validate(async a=>{if(a)try{x.value=!0;let l={addProjectAllocationInfoList:[]};if(f.value.groupSupplierIdList.length&&(f.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(f.value)),g.value.groupSupplierIdList.length&&(g.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(g.value)),r.value.groupSupplierIdList.length&&(r.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(r.value)),e.value.title!=="分配")l.addProjectAllocationInfoList.length||(k.value=!0),l.addProjectAllocationInfoList.map(d=>{d.projectId||(d.projectId=e.value.form.projectId),d.allocationType===4&&(d.deleteSet=[],T.value&&T.value.length&&T.value.filter(m=>{d.groupSupplierIdList.map(L=>{m!==L&&d.deleteSet.push(m)})}))});else if(!l.addProjectAllocationInfoList.length){G.warning({message:"至少选择一个分配目标",center:!0});return}k.value&&(l={addProjectAllocationInfoList:[{projectId:e.value.form.projectId,allocationType:5,groupSupplierIdList:[],deleteSet:[]}]});const{status:A}=await de(O.allocation(l));x.value=!1,A===1&&G.success({message:"分配成功",center:!0}),U(),F("fetch-data")}catch{}finally{x.value=!1}})}const P=a=>{};return Ie(async()=>{}),Q({showEdit:W}),(a,l)=>{const A=v("el-table-column"),d=v("el-table"),m=v("el-checkbox"),L=v("el-option"),p=v("el-select"),E=v("el-form-item"),se=v("el-tree-select"),B=v("el-button"),ie=v("el-form"),re=v("el-dialog"),pe=Ae("loading");return u(),S("div",null,[i(re,{modelValue:t(j),"onUpdate:modelValue":l[10]||(l[10]=o=>Le(j)?j.value=o:null),title:t(e).title,width:"700","before-close":U},{footer:s(()=>[I("div",Ue,[i(B,{onClick:U},{default:s(()=>[c(" 取消 ")]),_:1}),i(B,{type:"primary",onClick:oe},{default:s(()=>[c(" 确定 ")]),_:1})])]),default:s(()=>[Se((u(),w(d,{data:t(e).list,"row-key":"id"},{default:s(()=>[i(A,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),i(A,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),i(A,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[pe,t(x)]]),i(ie,{ref_key:"formRef",ref:R,"label-width":"90px",rules:t(q),model:t(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:s(()=>[i(E,{style:{"margin-top":"1rem"}},{label:s(()=>[je]),default:s(()=>[i(p,{modelValue:t(g).groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=o=>t(g).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[i(m,{modelValue:t(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=o=>t(e).selectAll.supplier=o),onChange:X,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantSupplierList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[1]||(l[1]=o=>P("供应商"))},[c(" 请先维护供应商数据 "),ke])):h("",!0),t(g).groupSupplierIdList.length==0&&t(e).tenantSupplierList.length!=0?(u(),S("span",Ve,"请先选择供应商数据")):h("",!0)]),default:s(()=>[(u(!0),S(Y,null,z(t(e).tenantSupplierList,o=>(u(),w(L,{label:o.supplierAccord,key:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(E,null,{label:s(()=>[Ce]),default:s(()=>[i(se,{ref_key:"treeRef",ref:y,modelValue:t(r).groupSupplierIdList,"onUpdate:modelValue":l[5]||(l[5]=o=>t(r).groupSupplierIdList=o),data:t(e).departmentList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:H,onCheckChange:le,"check-strictly":!0,"check-on-click-node":!0,multiple:!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},{header:s(()=>[i(m,{modelValue:t(e).selectAll.member,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).selectAll.member=o),onChange:ee,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).departmentList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[4]||(l[4]=o=>P("调查站"))},[c(" 请先维护调查站数据 "),xe])):h("",!0),!t(r).groupSupplierIdList.length&&t(e).departmentList.length!=0?(u(),S("span",Te,"请先选择调查站数据")):h("",!0)]),_:1},8,["modelValue","data"])]),_:1}),i(E,null,{label:s(()=>[Ee]),default:s(()=>[i(p,{modelValue:t(f).groupSupplierIdList,"onUpdate:modelValue":l[8]||(l[8]=o=>t(f).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[i(m,{modelValue:t(e).selectAll.tenant,"onUpdate:modelValue":l[6]||(l[6]=o=>t(e).selectAll.tenant=o),onChange:Z,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[7]||(l[7]=o=>P("合作商"))},[c(" 请先维护合作商数据 "),we])):h("",!0),t(f).groupSupplierIdList.length==0&&t(e).tenantList.length!=0?(u(),S("span",Re,"请先选择合作商数据")):h("",!0)]),default:s(()=>[(u(!0),S(Y,null,z(t(e).tenantList,o=>(u(),w(L,{label:o.beInvitationTenantName,key:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e).title=="重新分配"?(u(),w(E,{key:0},{label:s(()=>[i(B,{type:t(V)?"primary":"",onClick:l[9]||(l[9]=o=>te()),style:{"border-radius":"1.875rem"}},{default:s(()=>[c(" 取消分配 ")]),_:1},8,["type"])]),_:1})):h("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),Me=_e(Pe,[["__scopeId","data-v-1d3aac5f"]]);export{Me as default};
