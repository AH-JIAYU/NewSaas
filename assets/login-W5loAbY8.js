
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Me}from"./index.vue_vue_type_script_setup_true_lang-Buwpth97.js";import{x as M,d as Se,y as Ae,a1 as ze,a2 as Le,r as u,aJ as x,k as Be,bf as ue,aP as Ke,a3 as Ze,b as de,f as t,w as l,s as p,q as L,aq as B,i as a,z as De,a as g,aG as Ge,aH as Oe,O as He,E as I,n as me,o as h,I as je,aR as Je,g as d,H as R,e as T,az as pe,j as Q,ay as W,F as Qe,t as We,bc as Xe,N as Ye,R as ea,ao as ce}from"./index-Cvjxswu7.js";import aa from"./agreement-CCyb_xlr.js";import ta from"./index-DYnAlfg4.js";import{o as K}from"./apiLoading-Bl9mYt8-.js";const V={sendCode:c=>M.post("user/sendCode",c),forgetCode:c=>M.post("user/updatePasswordSendCode",c),updatePassword:c=>M.post("user/updatePassword",c),register:c=>M.post("user/register",c),getTenantConfig:c=>M.post("tenant-config/getTenantConfig",c)},S=c=>(Ge("data-v-94939d7b"),c=c(),Oe(),c),la=S(()=>p("div",{class:"bg-banner"},null,-1)),oa={id:"login-box"},ra=S(()=>p("div",{class:"login-banner"},null,-1)),na={class:"title-container"},sa={class:"fx-c"},ia={class:"flex-bar",style:{width:"100%",margin:"0"}},ua={class:"flex-bar"},da={class:"sub-link"},ma=S(()=>p("span",{class:"text"},"还不是会员?",-1)),pa={class:"sub-link"},ca=S(()=>p("span",{class:"text"},"已经有帐号?",-1)),ga=S(()=>p("div",{class:"title-container"},[p("h3",{class:"title"},"忘记密码了? 🔒")],-1)),fa={class:"sub-link"},ge=Se({name:"Login",__name:"login",setup(c){var re;const fe=De(),ve=He(),be=Ae(),ye=ze(),{t:y}=Le();new URL(""+new URL("login-banner-ZfMZACb6.png",import.meta.url).href,import.meta.url).href,new URL(""+new URL("logo-CLz_KCqM.png",import.meta.url).href,import.meta.url).href;const X=u(),b=u("login"),C=u(!1),_e=u(((re=fe.query.redirect)==null?void 0:re.toString())??be.settings.home.fullPath),N=u(),_=u("code"),Z=u("获取验证码"),D=u(!1),i=u({account:x.local.get("login_account")||"",remember:x.local.has("login_account"),agreeToTheAgreement:!1}),we=(r,e,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(i.value.account)?n():n(new Error("请输入合法手机号"))},he=(r,e,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i.value.account)?n():n(new Error("请输入合法邮箱"))},k=u({account:[{required:!0,trigger:"blur",message:"请输入手机号/邮箱/用户名"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],agreeToTheAgreement:[{required:!0,validator:(r,e)=>e===!0,message:"请阅读并勾选协议",trigger:"change"}]});Be(async()=>{const{data:r}=await V.getTenantConfig();X.value=r.register});const Y=()=>{const r=i.value.account;r.includes("@")?k.value.account=[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:he,trigger:"blur"}]:/^\d{11}$/.test(r)?k.value.account=[{required:!0,trigger:"blur",message:"请输入手机号"},{validator:we,trigger:"blur"}]:r.trim()!==""?k.value.account=[{required:!0,trigger:"blur",message:"请输入用户名"}]:k.value.account=[]};async function xe(){N.value.validateField("account",async r=>{if(r){let e;i.value.account.includes("@")?e={email:i.value.account,type:"login_email"}:e={phone:i.value.account,type:"login_phone_number"};const{status:n}=await K(V.sendCode(e));n===1&&(I.success({message:"已发送"}),Ve())}})}const Ve=()=>{D.value=!0;let r=60;w.value=setInterval(()=>{r>0?(r--,Z.value=`请在${r}s后重新获取`):(clearInterval(w.value),Z.value="获取验证码",w.value=null,D.value=!1)},1e3)},G=ue(()=>{N.value&&N.value.validate(r=>{if(r){let e={...i.value};_.value==="password"?e.type=1:i.value.account.includes("@")?e.type=3:e.type=2,C.value=!0,ye.login(e).then(()=>{C.value=!1,i.value.remember?x.local.set("login_account",i.value.account):x.local.remove("login_account"),ve.push(_e.value)}).catch(()=>{C.value=!1})}})},3e3),w=u(null),O=u("获取验证码"),H=u(!1),q=u(),ee=u([]),s=u({name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",agreeToTheAgreement:!1,companyType:"company",companyName:"",legalPersonName:"",taxID:"",isInvitation:2}),Ce=u({account:[{required:!0,trigger:"blur",message:"请输入用户名"}],companyName:[{required:!0,trigger:"blur",message:"请输入公司名称"}],companyType:[{required:!0,trigger:"change",message:"请选择账户类型"}],legalPersonName:[{required:!0,trigger:"blur",message:"请输入法人姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,e,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(s.value.email)?n():n(new Error("请输入合法邮箱"))},trigger:"blur"}],phoneNumber:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,e,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(s.value.phoneNumber)?n():n(new Error("请输入合法手机号"))},trigger:"blur"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],country:[{required:!0,trigger:"change",message:"请选择国家"}],name:[{required:!0,trigger:"blur",message:"请输入用户名"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],isInvitation:[{required:!0,trigger:"blur",message:"请选择合作邀约"}],agreeToTheAgreement:[{required:!0,validator:(r,e)=>e===!0,message:"请阅读并勾选协议",trigger:"change"}]}),ke=async()=>{q.value.validateField(s.value.country==="CN"?"phoneNumber":"email",async r=>{if(r){const e={type:"register_phone_number",email:s.value.email,phone:s.value.phoneNumber};if(s.value.country==="CN"){const{status:n}=await K(V.sendCode(e));n===1&&(I.success({message:"已发送"}),ae())}else{e.type="register_email";const{status:n}=await K(V.sendCode(e));n===1&&(I.success({message:"已发送"}),ae())}}})},ae=()=>{H.value=!0;let r=60;w.value=setInterval(()=>{r>0?(r--,O.value=`请在${r}s后重新获取`):(clearInterval(w.value),O.value="获取验证码",w.value=null,H.value=!1)},1e3)},Ee=ue(async()=>{q.value&&q.value.validate(async r=>{if(r){s.value.type=s.value.country==="CN"?"phone":"email",s.value.type==="phone"?delete s.value.email:delete s.value.phoneNumber;const{status:e}=await V.register(s.value);e===1&&(I.success({message:"注册成功"}),b.value="login",_.value="password"),me(()=>{i.value.account=s.value.email||s.value.phoneNumber})}})},3e3),E=u(null),P=u(),j=u("获取验证码"),te=u(!1),f=u({info:x.local.get("login_account"),code:"",newPassword:""}),Ie=u({info:[{required:!0,trigger:"blur",message:"请输入用户名"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],newPassword:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(r,e,n)=>{/[\s\u4e00-\u9fa5]/.test(e)?n(new Error("密码中带有空格或汉字")):n()},trigger:"blur"}]}),Re=()=>{P.value.validateField(f.value.info?"":"info",async r=>{if(r){const{status:e}=await K(V.forgetCode({info:f.value.info}));e===1&&(I.success({message:"已发送"}),Ne())}})};function Te(){P.value&&P.value.validate(async r=>{if(r){const{status:e}=await V.updatePassword(f.value);e===1&&(I.success({message:"修改成功"}),b.value="login",me(()=>{i.value.account=f.value.info}))}})}const Ne=()=>{te.value=!0;let r=60;E.value=setInterval(()=>{r>0?(r--,j.value=`请在${r}s后重新获取`):(clearInterval(E.value),j.value="获取验证码",E.value=null,te.value=!1)},1e3)};Ke(()=>{clearInterval(w.value),w.value=null,clearInterval(E.value),E.value=null});const le=()=>{k.value.account=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱/用户名"}],N.value.resetFields()};Ze(()=>b.value,async r=>{switch(r){case"login":le(),i.value={account:x.local.get("login_account")||"",remember:x.local.has("login_account")};break;case"register":q.value.resetFields(),s.value={name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",isInvitation:2};break;case"reset":P.value.resetFields(),f.value={info:"",newPassword:"",code:""};break}if(r==="register"){const e=await Xe.itemlist({page:1,limit:-1,id:"32"});ee.value=e.data.records}});const oe=u(),A=r=>{oe.value.showEdit(r)};return(r,e)=>{const n=Ye,U=Me,ne=g("el-radio-button"),qe=g("el-radio-group"),F=g("el-button"),v=g("ElInput"),m=g("ElFormItem"),J=g("ElCheckbox"),z=g("ElLink"),$=g("ElButton"),Pe=g("el-form"),Ue=g("ElOption"),Fe=g("ElSelect"),se=g("el-option"),$e=g("el-select"),ie=g("ElForm");return h(),de("div",null,[la,t(U,{placement:"bottom-end",class:"i18n-selector"},{default:l(()=>[t(n,{name:"i-ri:translate"})]),_:1}),p("div",oa,[ra,L(t(Pe,{ref_key:"loginFormRef",ref:N,model:a(i),rules:a(k),class:"login-form","validate-on-rule-change":!1},{default:l(()=>[p("div",na,[p("div",sa,[t(qe,{modelValue:a(_),"onUpdate:modelValue":e[0]||(e[0]=o=>je(_)?_.value=o:null),size:"large",onChange:le},{default:l(()=>[t(ne,{label:"验证码登录",value:"code"}),t(ne,{label:"密码登录",value:"password"})]),_:1},8,["modelValue"])])]),p("div",null,[t(m,{prop:"account"},{default:l(()=>[t(v,{modelValue:a(i).account,"onUpdate:modelValue":e[1]||(e[1]=o=>a(i).account=o),modelModifiers:{trim:!0,trim:!0},placeholder:a(y)("app.account"),type:"text",tabindex:"1",onBlur:Y},Je({prefix:l(()=>[t(n,{name:"i-ri:user-3-fill"})]),_:2},[a(_)==="code"?{name:"append",fn:l(()=>[t(F,{type:"primary",disabled:a(D),onClick:xe},{default:l(()=>[d(R(a(Z)),1)]),_:1},8,["disabled"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),a(_)==="password"?(h(),T(m,{key:0,prop:"password"},{default:l(()=>[t(v,{modelValue:a(i).password,"onUpdate:modelValue":e[2]||(e[2]=o=>a(i).password=o),modelModifiers:{trim:!0},type:"password",placeholder:a(y)("app.password"),tabindex:"2",autocomplete:"new-password","show-password":"",onKeyup:pe(a(G),["enter"])},{prefix:l(()=>[t(n,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):Q("",!0),a(_)==="code"?(h(),T(m,{key:1,prop:"code"},{default:l(()=>[t(v,{modelValue:a(i).code,"onUpdate:modelValue":e[3]||(e[3]=o=>a(i).code=o),modelModifiers:{trim:!0},type:"text",placeholder:a(y)("app.captcha"),tabindex:"2",onKeyup:pe(a(G),["enter"])},{prefix:l(()=>[t(n,{name:"i-ep:message"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):Q("",!0),t(m,{prop:"agreeToTheAgreement",style:{"margin-bottom":"0.5rem"}},{default:l(()=>[p("div",ia,[t(J,{modelValue:a(i).agreeToTheAgreement,"onUpdate:modelValue":e[6]||(e[6]=o=>a(i).agreeToTheAgreement=o),tabindex:"3"},{default:l(()=>[d(" 我已阅读并同意 "),t(F,{type:"primary",size:"default",link:"",onClick:e[4]||(e[4]=o=>A(1))},{default:l(()=>[d("《会员协议》")]),_:1}),d("和"),t(F,{type:"primary",size:"default",link:"",onClick:e[5]||(e[5]=o=>A(2))},{default:l(()=>[d("《隐私协议》")]),_:1})]),_:1},8,["modelValue"])])]),_:1}),t(m,null,{default:l(()=>[p("div",ua,[t(J,{modelValue:a(i).remember,"onUpdate:modelValue":e[7]||(e[7]=o=>a(i).remember=o),tabindex:"4"},{default:l(()=>[d(" 保持登录 ")]),_:1},8,["modelValue"]),a(_)==="password"?(h(),T(z,{key:0,type:"primary",underline:!1,onClick:e[8]||(e[8]=o=>b.value="reset")},{default:l(()=>[d(" 忘记密码了? ")]),_:1})):Q("",!0)])]),_:1})]),t($,{loading:a(C),type:"primary",size:"large",style:{width:"100%"},onClick:W(a(G),["prevent"]),tabindex:"5"},{default:l(()=>[d(R(a(y)("app.login")),1)]),_:1},8,["loading","onClick"]),L(p("div",da,[ma,t(z,{type:"primary",underline:!1,onClick:e[9]||(e[9]=o=>b.value="register")},{default:l(()=>[d(" 立即注册 ")]),_:1})],512),[[B,a(X)]])]),_:1},8,["model","rules"]),[[B,a(b)==="login"]]),L(t(ie,{ref_key:"registerFormRef",ref:q,model:a(s),rules:a(Ce),class:"login-form","auto-complete":"on"},{default:l(()=>[p("div",null,[t(m,{prop:"companyName"},{default:l(()=>[t(v,{modelValue:a(s).companyName,"onUpdate:modelValue":e[10]||(e[10]=o=>a(s).companyName=o),modelModifiers:{trim:!0},placeholder:"请输入公司名称",tabindex:"1"},{prefix:l(()=>[t(n,{name:"i-mdi:greenhouse"})]),_:1},8,["modelValue"])]),_:1}),t(m,{prop:"name"},{default:l(()=>[t(v,{modelValue:a(s).name,"onUpdate:modelValue":e[11]||(e[11]=o=>a(s).name=o),modelModifiers:{trim:!0},placeholder:"用户名",tabindex:"2"},{prefix:l(()=>[t(n,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue"])]),_:1}),t(m,{prop:"country"},{default:l(()=>[t(Fe,{modelValue:a(s).country,"onUpdate:modelValue":e[12]||(e[12]=o=>a(s).country=o),placeholder:"国家",clearable:"",filterable:"",tabindex:"3"},{prefix:l(()=>[t(n,{name:"i-mdi:format-list-bulleted-type"})]),default:l(()=>[(h(!0),de(Qe,null,We(a(ee),o=>(h(),T(Ue,{label:o.chineseName,value:o.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(s).country==="CN"?(h(),T(m,{key:0,prop:"phoneNumber"},{default:l(()=>[t(v,{modelValue:a(s).phoneNumber,"onUpdate:modelValue":e[13]||(e[13]=o=>a(s).phoneNumber=o),modelModifiers:{trim:!0},placeholder:"手机号",tabindex:"4"},{prefix:l(()=>[t(n,{name:"i-ant-design:phone-outlined"})]),_:1},8,["modelValue"])]),_:1})):(h(),T(m,{key:1,prop:"email"},{default:l(()=>[t(v,{modelValue:a(s).email,"onUpdate:modelValue":e[14]||(e[14]=o=>a(s).email=o),modelModifiers:{trim:!0},placeholder:"邮箱",tabindex:"4"},{prefix:l(()=>[t(n,{name:"i-mdi:email"})]),_:1},8,["modelValue"])]),_:1})),t(m,{prop:"code"},{default:l(()=>[t(v,{modelValue:a(s).code,"onUpdate:modelValue":e[15]||(e[15]=o=>a(s).code=o),modelModifiers:{trim:!0},placeholder:"验证码",tabindex:"5"},{prefix:l(()=>[t(n,{name:"i-ic:baseline-verified-user"})]),append:l(()=>[t($,{disabled:a(H),onClick:ke},{default:l(()=>[d(R(a(O)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),t(m,{prop:"password"},{default:l(()=>[t(v,{modelValue:a(s).password,"onUpdate:modelValue":e[16]||(e[16]=o=>a(s).password=o),modelModifiers:{trim:!0},type:"password",placeholder:"密码",tabindex:"6","show-password":""},{prefix:l(()=>[t(n,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue"])]),_:1}),t(m,{prop:"isInvitation"},{default:l(()=>[t($e,{modelValue:a(s).isInvitation,"onUpdate:modelValue":e[17]||(e[17]=o=>a(s).isInvitation=o),tabindex:"7",placeholder:"是否开启合作邀约",filterable:""},{prefix:l(()=>[t(n,{name:"i-ant-design:container-outlined"})]),default:l(()=>[t(se,{label:"合作邀约开启",value:2}),t(se,{label:"合作邀约关闭",value:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{prop:"agreeToTheAgreement"},{default:l(()=>[t(J,{modelValue:a(s).agreeToTheAgreement,"onUpdate:modelValue":e[20]||(e[20]=o=>a(s).agreeToTheAgreement=o),tabindex:"8"},{default:l(()=>[d(" 我已阅读并同意 "),t(F,{type:"primary",size:"default",link:"",onClick:e[18]||(e[18]=o=>A(1))},{default:l(()=>[d("《会员协议》")]),_:1}),d("和"),t(F,{type:"primary",size:"default",link:"",onClick:e[19]||(e[19]=o=>A(2))},{default:l(()=>[d("《隐私协议》")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),t($,{tabindex:"9",loading:a(C),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:W(a(Ee),["prevent"])},{default:l(()=>[d(" 注册 ")]),_:1},8,["loading","onClick"]),p("div",pa,[ca,t(z,{type:"primary",underline:!1,onClick:e[21]||(e[21]=o=>b.value="login")},{default:l(()=>[d(" 去登录 ")]),_:1})])]),_:1},8,["model","rules"]),[[B,a(b)==="register"]]),L(t(ie,{ref_key:"resetFormRef",ref:P,model:a(f),rules:a(Ie),class:"login-form"},{default:l(()=>[ga,p("div",null,[t(m,{prop:"info"},{default:l(()=>[t(v,{modelValue:a(f).info,"onUpdate:modelValue":e[22]||(e[22]=o=>a(f).info=o),modelModifiers:{trim:!0},placeholder:a(y)("app.account"),type:"text",tabindex:"1",onBlur:Y},{prefix:l(()=>[t(n,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(m,{prop:"code"},{default:l(()=>[t(v,{modelValue:a(f).code,"onUpdate:modelValue":e[23]||(e[23]=o=>a(f).code=o),modelModifiers:{trim:!0},placeholder:a(y)("app.captcha"),type:"text",tabindex:"2"},{prefix:l(()=>[t(n,{name:"i-ic:baseline-verified-user"})]),append:l(()=>[t($,{disabled:a(E),onClick:Re},{default:l(()=>[d(R(a(j)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","placeholder"])]),_:1}),t(m,{prop:"newPassword"},{default:l(()=>[t(v,{modelValue:a(f).newPassword,"onUpdate:modelValue":e[24]||(e[24]=o=>a(f).newPassword=o),modelModifiers:{trim:!0},type:"password",placeholder:a(y)("app.newPassword"),tabindex:"3","show-password":""},{prefix:l(()=>[t(n,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1})]),t($,{loading:a(C),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:W(Te,["prevent"])},{default:l(()=>[d(R(a(y)("app.check")),1)]),_:1},8,["loading"]),p("div",fa,[t(z,{type:"primary",underline:!1,onClick:e[25]||(e[25]=o=>b.value="login")},{default:l(()=>[d(R(a(y)("app.goLogin")),1)]),_:1})])]),_:1},8,["model","rules"]),[[B,a(b)==="reset"]])]),t(ta),t(aa,{ref_key:"agreementRef",ref:oe},null,512)])}}});typeof ce=="function"&&ce(ge);const Ca=ea(ge,[["__scopeId","data-v-94939d7b"]]);export{Ca as default};
