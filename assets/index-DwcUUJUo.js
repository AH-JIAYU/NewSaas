
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Z,r as m,c as ee,a as s,o as c,b as v,f as r,w as o,g as u,i as l,F as te,t as ae,e as f,y as p,z as U,j as h,A as oe,E as x,_ as re,aH as le,aI as ne,aE as se,L as ce}from"./index-e-CmYWR6.js";import{c as w}from"./user_cooperation-DxbnhCW7.js";import{u as de}from"./index-Bp4OI1mC.js";import{a as ie}from"./department-CN-tkMFD.js";import"./index-DsWkRE8a.js";import"./index-BQYSaRiI.js";const ue=y=>(le("data-v-35d264d4"),y=y(),ne(),y),me={style:{float:"left"}},fe={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"0.8125rem"}},pe={key:0},ge={key:1},_e=ue(()=>p("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式",-1)),ve={key:3},he={style:{display:"flex"}},ye=Z({__name:"index",emits:["fetch-data"],setup(y,{expose:S,emit:q}){const A=q,g=m(!1);m("");const b=m(),T=m(),B={children:"children",label:"name"},e=m({form:{},tenantUserList:[],tenantStaffList:[],chargeUserId:null,departmentId:null,chargeUserName:"",rules:{beInvitationTenantId:[{required:!0,message:"请选择合作商",trigger:"change"}],priceRatio:[{required:!0,message:"请输入",trigger:"blur"},{type:"number",trigger:"blur",validator:(t,a,d)=>{if(/^(100|[1-9]?\d)$/.test(a)==!1)return d(new Error("请输入 0 到 100 之间的数字"));d()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),N=m([]),j=m();async function F(){e.value.form.chargeUserId="",await z(),g.value=!0;const t=await ie.list({name:""});t.data&&(N.value=t.data)}const D=(t,a)=>{if(a){b.value.getCheckedKeys().forEach(i=>{i!==t.id&&b.value.setChecked(i,!1)}),e.value.form.chargeUserId=t.id;const _=b.value.getCheckedNodes();e.value.form.chargeUserName=_.map(i=>i.name)[0],setTimeout(()=>{j.value.blur()},100)}else e.value.form.chargeUserId=[e.value.form.chargeUserId].filter(d=>d!==t.id),e.value.form.chargeUserId.length==0&&(e.value.form.chargeUserId="");e.value.form.chargeUserId||(e.value.form.chargeUserName=""),console.log(e.value.form.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.form.chargeUserId,"data.value.form.chargeUserId")};async function z(){const t=await w.getTenantUserList({});e.value.tenantUserList=t.data.tenantUserInfoList}const P=ee(()=>{const t=e.value.tenantUserList.find(a=>a.tenantId===e.value.form.beInvitationTenantId);return t?(e.value.form.tenantName=t.name,e.value.form.phoneOrEmail=se.local.get("account"),[t]):[]});function C(){g.value=!1,e.value.form={},T.value.resetFields()}async function K(){T.value.validate(t=>{if(t){let a=JSON.parse(JSON.stringify(e.value.form));if(a.receiveProjectType==1&&!a.chargeUserId){x.warning({message:"请选择接收项目负责人",center:!0});return}a.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,a.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,a.invitationType=2,a.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",a.chargeUserId=null,a.chargeUserName="",a.invitationType=""),a.invitationType=2,w.addInvitationBind(a).then(d=>{d.status==-1?x.success({message:d.error,center:!0}):(x.success({message:"发送成功",center:!0}),A("fetch-data"),C())})}})}S({showEdit:F});const O=m();function J(t){e.value.form.chargeUserId=t.chargeUserId,e.value.form.invitationType=t.invitationType,e.value.form.chargeUserName=t.chargeUserName}const $=t=>{Array.isArray(t)&&t.length>1&&(e.value.form.sendProjectType=[t[t.length-1]])},H=t=>{Array.isArray(t)&&t.length>1&&(e.value.form.receiveProjectType=[t[t.length-1]])};return(t,a)=>{const d=s("el-option"),_=s("el-select"),i=s("el-form-item"),M=s("el-input"),I=s("el-table-column"),G=s("el-table"),V=re,R=s("el-tooltip"),k=s("el-checkbox"),L=s("el-checkbox-group"),Q=s("el-tree"),W=s("el-text"),X=s("ElForm"),E=s("el-button"),Y=s("el-dialog");return c(),v("div",null,[r(Y,{modelValue:l(g),"onUpdate:modelValue":a[5]||(a[5]=n=>oe(g)?g.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"邀约公司"},{footer:o(()=>[r(E,{onClick:C},{default:o(()=>[u(" 关闭 ")]),_:1}),r(E,{type:"primary",onClick:K},{default:o(()=>[u(" 发送邀约 ")]),_:1})]),default:o(()=>[r(X,{ref_key:"formRef",ref:T,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left"},{default:o(()=>[r(i,{label:"公司名称",prop:"beInvitationTenantId"},{default:o(()=>[r(_,{modelValue:l(e).form.beInvitationTenantId,"onUpdate:modelValue":a[0]||(a[0]=n=>l(e).form.beInvitationTenantId=n),clearable:""},{default:o(()=>[(c(!0),v(te,null,ae(l(e).tenantUserList,n=>(c(),f(d,{key:n.tenantId,value:n.tenantId,label:n.tenantName},{default:o(()=>[p("span",me,U(n.tenantName),1),p("span",fe,U(n.tenantId),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(e).form.beInvitationTenantId?(c(),f(i,{key:0,label:"价格比例",prop:"priceRatio"},{default:o(()=>[r(M,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":a[1]||(a[1]=n=>l(e).form.priceRatio=n),clearable:"",placeholder:"请输入0-100之间的数字"},{append:o(()=>[u("%")]),_:1},8,["modelValue"])]),_:1})):h("",!0),l(P).length?(c(),f(G,{key:1,data:l(P),border:"",stripe:"",style:{"margin-bottom":"18px"}},{default:o(()=>[r(I,{prop:"name",label:"用户名"}),r(I,{prop:"tenantName",label:"公司名称"}),r(I,{prop:"country",label:"区域"}),r(I,{label:"电子邮箱/手机号"},{default:o(({row:n})=>[n.phone?(c(),v("span",pe,U(n.phone),1)):(c(),v("span",ge,U(n.email),1))]),_:1})]),_:1},8,["data"])):h("",!0),l(e).form.beInvitationTenantId?(c(),f(i,{key:2,"label-width":"7rem"},{label:o(()=>[_e]),_:1})):h("",!0),l(e).form.beInvitationTenantId?(c(),v("div",ve,[r(i,{prop:"sendProjectType","label-width":"7rem"},{label:o(()=>[p("span",null,[r(R,{effect:"dark",content:"",placement:"top-start"},{default:o(()=>[r(V,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),u(" 发送项目 ")])]),default:o(()=>[r(L,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":a[2]||(a[2]=n=>l(e).form.sendProjectType=n),onChange:$},{default:o(()=>[r(k,{value:1},{default:o(()=>[u(" 自动 ")]),_:1}),r(k,{value:2},{default:o(()=>[u(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),p("div",he,[r(i,{prop:"receiveProjectType","label-width":"7rem"},{label:o(()=>[p("span",null,[r(R,{effect:"dark",content:"",placement:"top-start"},{default:o(()=>[r(V,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),u(" 接收项目 ")])]),default:o(()=>[r(L,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":a[3]||(a[3]=n=>l(e).form.receiveProjectType=n),onChange:H},{default:o(()=>[r(k,{value:1},{default:o(()=>[u(" 自动 ")]),_:1}),r(k,{value:2},{default:o(()=>[u(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).form.receiveProjectType==1?(c(),f(_,{key:0,modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":a[4]||(a[4]=n=>l(e).form.chargeUserName=n),placeholder:"请选择部门",ref_key:"selectTreeRef",ref:j,style:{width:"15.625rem","margin-left":"1.5625rem"}},{default:o(()=>[r(d,{value:l(e).form.chargeUserId,style:{height:"auto"}},{default:o(()=>[l(N).length>0?(c(),f(Q,{key:0,ref_key:"treeRef",ref:b,disabled:!0,data:l(N),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":[l(e).form.chargeUserId],"default-expand-all":"",props:B,onCheckChange:D,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["data","default-checked-keys"])):(c(),f(W,{key:1},{default:o(()=>[u("暂无数据")]),_:1}))]),_:1},8,["value"])]),_:1},8,["modelValue"])):h("",!0)])])):h("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),r(de,{ref_key:"userRef",ref:O,onUserData:J},null,512)])}}}),je=ce(ye,[["__scopeId","data-v-35d264d4"]]);export{je as default};
