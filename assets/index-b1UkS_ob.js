
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as P}from"./project_settlement-BDml5d7x.js";import H from"./index-D3Sa_zzk.js";import{d as M,r as u,a as s,q as $,o as b,b as F,f as t,w as a,y as r,g as i,s as J,e as j,j as x,E as w,aH as A,aI as G,L as K}from"./index-DZCXLDVM.js";const N=v=>(A("data-v-5f43c9c9"),v=v(),G(),v),Q={class:"border"},W=N(()=>r("p",{class:"pp"},"项目ID",-1)),X={class:"neip"},Y={class:"border"},Z=N(()=>r("p",{class:"pp"},"项目名称",-1)),ee={class:"neip"},le={class:"shenhe"},te={class:"beizhu"},ae={class:"po"},oe={class:"flex-c"},se=M({name:"ProjectReview",__name:"index",emits:["success"],setup(v,{expose:D,emit:T}){const B=u(),C=T,f=u(!1),d=u(),l=u({projectId:"",projectName:"",settlementType:"",remark:"",projectSettlementBuilderList:[],po:"",arr:""}),S=u({settlementType:[{required:!0,message:"请选择审核方式",trigger:"change"}],arr:[{required:!0,message:"请输入至少一个ID",trigger:"blur"},{validator:(p,e,n)=>{/^[\d\n]*$/.test(e)?n():n(new Error("请输入数字，支持换行"))},trigger:"blur"}]}),_=u(),V=u(!1),c=u(!1);async function z(p){p&&(d.value=JSON.parse(p),l.value.projectId=d.value.projectId,l.value.projectName=d.value.projectName),c.value=!0}async function U(){_.value&&_.value.validate(async p=>{try{if(p){f.value=!0,delete l.value.projectName,l.value.settlementType===1||l.value.settlementType===2?l.value.projectSettlementBuilderList=l.value.arr.split(`
`)||[]:l.value.projectSettlementBuilderList=[],delete l.value.arr;const{status:e}=await P.review(l.value);e===1?(new BroadcastChannel("televiseChannel").postMessage("我在子页面提交了,需要刷新列表"),C("success"),f.value=!1,w.success({message:"操作成功",center:!0}),I()):w.error({message:"操作失败，请联系工作人员",center:!0})}else w({message:"请检查必填项,或数据格式不正确",type:"warning"})}catch{}finally{f.value=!1}})}function I(){_.value.resetFields(),Object.assign(l.value,{projectId:"",projectName:"",settlementType:"",remark:"",projectSettlementBuilderList:[],po:"",arr:""}),l.value.arr=[],c.value=!1}return D({showEdit:z}),(p,e)=>{const n=s("el-input"),g=s("el-row"),m=s("el-radio"),R=s("el-radio-group"),y=s("el-form-item"),h=s("el-col"),O=s("el-checkbox"),E=s("el-form"),k=s("el-button"),L=s("el-drawer"),q=$("loading");return b(),F("div",null,[t(L,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=o=>c.value=o),title:"项目审核",size:"50%","before-close":I},{footer:a(()=>[r("div",oe,[t(k,{onClick:e[8]||(e[8]=o=>c.value=!1)},{default:a(()=>[i(" 取消 ")]),_:1}),t(k,{type:"primary",onClick:U},{default:a(()=>[i(" 确定 ")]),_:1})])]),default:a(()=>[J((b(),j(E,{ref_key:"formRef",ref:_,model:l.value,rules:S.value,"label-width":"174px",inline:!1},{default:a(()=>[t(g,{style:{margin:"0"},gutter:20},{default:a(()=>[r("div",Q,[W,r("p",X,[t(n,{modelValue:d.value.projectId,"onUpdate:modelValue":e[0]||(e[0]=o=>d.value.projectId=o),placeholder:"请输入项目ID",disabled:"",clearable:""},null,8,["modelValue"])])]),r("div",Y,[Z,r("p",ee,[t(n,{modelValue:d.value.projectName,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value.projectName=o),disabled:"",placeholder:"请输入项目名称",clearable:""},null,8,["modelValue"])])])]),_:1}),r("div",le,[t(y,{prop:"settlementType",style:{display:"flex","align-items":"center"},label:"审核方式"},{default:a(()=>[t(R,{modelValue:l.value.settlementType,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.settlementType=o)},{default:a(()=>[t(m,{value:1,size:"large"},{default:a(()=>[i(" 按成功ID ")]),_:1}),t(m,{value:2,size:"large"},{default:a(()=>[i(" 按失败ID ")]),_:1}),t(m,{value:3,size:"large"},{default:a(()=>[i(" 全部通过 ")]),_:1}),t(m,{value:4,size:"large"},{default:a(()=>[i(" 全部失败 ")]),_:1}),t(m,{value:5,size:"large"},{default:a(()=>[i(" 数据冻结 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),r("div",te,[t(y,{label:"备注"},{default:a(()=>[t(n,{class:"custom-input",modelValue:l.value.remark,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.remark=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),r("div",ae,[V.value?(b(),j(y,{key:0,label:"结算PO号"},{default:a(()=>[t(n,{modelValue:l.value.po,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.po=o),class:"custom-input",placeholder:"",clearable:"",onChange:e[5]||(e[5]=()=>{})},null,8,["modelValue"])]),_:1})):x("",!0)]),t(g,{style:{margin:"0"},gutter:20},{default:a(()=>[t(h,{span:20}),t(h,{span:4},{default:a(()=>[t(O,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),label:"填写结算PO号",size:"large"},null,8,["modelValue"])]),_:1})]),_:1}),l.value.settlementType===1||l.value.settlementType===2?(b(),j(g,{key:0,style:{margin:"0",width:"100%"},gutter:20},{default:a(()=>[t(y,{style:{width:"100%"},prop:"arr"},{default:a(()=>[t(n,{modelValue:l.value.arr,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.arr=o),placeholder:"请粘贴ID，每行一个,多个请回车换行",type:"textarea",rows:15},null,8,["modelValue"])]),_:1})]),_:1})):x("",!0)]),_:1},8,["model","rules"])),[[q,f.value]]),t(H,{ref_key:"progressDetailsRef",ref:B},null,512)]),_:1},8,["modelValue"])])}}}),ie=K(se,[["__scopeId","data-v-5f43c9c9"]]);export{ie as default};
