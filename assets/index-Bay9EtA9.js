
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as X,r as u,c as Y,a as s,o as i,b as _,f as o,w as r,g as d,i as l,F as Z,t as ee,e as v,y as m,z as U,j as h,A as te,E as N,_ as ae,aH as re,aI as oe,aE as ne,L as le}from"./index-Ci7w1hVZ.js";import{c as L}from"./user_cooperation-D0eM1bTG.js";import{u as se}from"./index-CMGxLGfP.js";import{a as ce}from"./department-C2-Gi8lB.js";import"./index-ChTc4W5j.js";import"./index-D3avmfAO.js";const ie=y=>(re("data-v-0c7b3f1c"),y=y(),oe(),y),de={style:{float:"left"}},ue={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"0.8125rem"}},me={key:0},fe={key:1},pe=ie(()=>m("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式",-1)),ge={key:3},_e={style:{display:"flex"}},ve=X({__name:"index",emits:["fetch-data"],setup(y,{expose:E,emit:S}){const A=S,f=u(!1);u("");const k=u(),T=u(),q={children:"children",label:"name"},e=u({form:{},tenantUserList:[],tenantStaffList:[],chargeUserId:null,departmentId:null,chargeUserName:"",rules:{beInvitationTenantId:[{required:!0,message:"请选择合作商",trigger:"change"}],priceRatio:[{required:!0,message:"请输入",trigger:"blur"},{type:"number",trigger:"blur",validator:(a,t,c)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return c(new Error("请输入 0 到 100 之间的数字"));c()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),j=u([]);u();async function B(){e.value.form.chargeUserId="",await F(),f.value=!0;const a=await ce.list({name:""});a.data&&(j.value=a.data)}const D=(a,t)=>{t?(k.value.getCheckedKeys().forEach(p=>{p!==a.id&&k.value.setChecked(p,!1)}),e.value.form.chargeUserId=a.id,e.value.form.chargeUserName=a.name):(e.value.form.chargeUserId=[e.value.form.chargeUserId].filter(c=>c!==a.id),e.value.form.chargeUserId.length==0&&(e.value.form.chargeUserId="")),e.value.form.chargeUserId||(e.value.form.chargeUserName=""),console.log(e.value.form.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.form.chargeUserId,"data.value.form.chargeUserId")};async function F(){const a=await L.getTenantUserList({});e.value.tenantUserList=a.data.tenantUserInfoList}const x=Y(()=>{const a=e.value.tenantUserList.find(t=>t.tenantId===e.value.form.beInvitationTenantId);return a?(e.value.form.tenantName=a.name,e.value.form.phoneOrEmail=ne.local.get("account"),[a]):[]});function P(){f.value=!1,e.value.form={},T.value.resetFields()}async function z(){T.value.validate(a=>{if(a){let t=JSON.parse(JSON.stringify(e.value.form));if(Array.isArray(t.chargeUserId)&&(t.chargeUserId=t.chargeUserId[0]),t.receiveProjectType==1&&!t.chargeUserId){N.warning({message:"请选择部门",center:!0});return}t.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,t.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,t.invitationType=2,t.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",t.chargeUserId=null,t.chargeUserName="",t.invitationType=""),t.invitationType=2,L.addInvitationBind(t).then(c=>{c.status==-1?N.success({message:c.error,center:!0}):(N.success({message:"发送成功",center:!0}),A("fetch-data"),P())})}})}E({showEdit:B});const K=u();function O(a){e.value.form.chargeUserId=a.chargeUserId,e.value.form.invitationType=a.invitationType,e.value.form.chargeUserName=a.chargeUserName}const J=a=>{Array.isArray(a)&&a.length>1&&(e.value.form.sendProjectType=[a[a.length-1]])},$=a=>{Array.isArray(a)&&a.length>1&&(e.value.form.receiveProjectType=[a[a.length-1]])};return(a,t)=>{const c=s("el-option"),p=s("el-select"),g=s("el-form-item"),H=s("el-input"),b=s("el-table-column"),M=s("el-table"),C=ae,V=s("el-tooltip"),I=s("el-checkbox"),R=s("el-checkbox-group"),G=s("el-tree-select"),Q=s("ElForm"),w=s("el-button"),W=s("el-dialog");return i(),_("div",null,[o(W,{modelValue:l(f),"onUpdate:modelValue":t[5]||(t[5]=n=>te(f)?f.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"邀约公司",class:"yaoyueDrawer"},{footer:r(()=>[o(w,{onClick:P},{default:r(()=>[d(" 关闭 ")]),_:1}),o(w,{type:"primary",onClick:z},{default:r(()=>[d(" 发送邀约 ")]),_:1})]),default:r(()=>[o(Q,{ref_key:"formRef",ref:T,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left",class:"hezuoDrawer"},{default:r(()=>[o(g,{label:"公司名称",prop:"beInvitationTenantId"},{default:r(()=>[o(p,{modelValue:l(e).form.beInvitationTenantId,"onUpdate:modelValue":t[0]||(t[0]=n=>l(e).form.beInvitationTenantId=n),clearable:""},{default:r(()=>[(i(!0),_(Z,null,ee(l(e).tenantUserList,n=>(i(),v(c,{key:n.tenantId,value:n.tenantId,label:n.tenantName},{default:r(()=>[m("span",de,U(n.tenantName),1),m("span",ue,U(n.tenantId),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(e).form.beInvitationTenantId?(i(),v(g,{key:0,label:"价格比例",prop:"priceRatio"},{default:r(()=>[o(H,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":t[1]||(t[1]=n=>l(e).form.priceRatio=n),clearable:"",placeholder:"请输入0-100之间的数字"},{append:r(()=>[d("%")]),_:1},8,["modelValue"])]),_:1})):h("",!0),l(x).length?(i(),v(M,{key:1,data:l(x),border:"",stripe:"",style:{"margin-bottom":"18px"}},{default:r(()=>[o(b,{prop:"name",label:"用户名"}),o(b,{prop:"tenantName",label:"公司名称"}),o(b,{prop:"country",label:"区域"}),o(b,{label:"电子邮箱/手机号"},{default:r(({row:n})=>[n.phone?(i(),_("span",me,U(n.phone),1)):(i(),_("span",fe,U(n.email),1))]),_:1})]),_:1},8,["data"])):h("",!0),l(e).form.beInvitationTenantId?(i(),v(g,{key:2,"label-width":"7rem"},{label:r(()=>[pe]),_:1})):h("",!0),l(e).form.beInvitationTenantId?(i(),_("div",ge,[o(g,{prop:"sendProjectType","label-width":"7rem"},{label:r(()=>[m("span",null,[o(V,{effect:"dark",content:"",placement:"top-start"},{default:r(()=>[o(C,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),d(" 发送项目 ")])]),default:r(()=>[o(R,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":t[2]||(t[2]=n=>l(e).form.sendProjectType=n),onChange:J},{default:r(()=>[o(I,{value:1},{default:r(()=>[d(" 自动 ")]),_:1}),o(I,{value:2},{default:r(()=>[d(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),m("div",_e,[o(g,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem"}},{label:r(()=>[m("span",null,[o(V,{effect:"dark",content:"",placement:"top-start"},{default:r(()=>[o(C,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),d(" 接收项目 ")])]),default:r(()=>[o(R,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":t[3]||(t[3]=n=>l(e).form.receiveProjectType=n),onChange:$},{default:r(()=>[o(I,{value:1},{default:r(()=>[d(" 自动 ")]),_:1}),o(I,{value:2},{default:r(()=>[d(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).form.receiveProjectType==1?(i(),v(G,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:k,modelValue:l(e).form.chargeUserId,"onUpdate:modelValue":t[4]||(t[4]=n=>l(e).form.chargeUserId=n),data:l(j),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",style:{width:"15.625rem"},props:q,onCheckChange:D,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["modelValue","data"])):h("",!0)])])):h("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(se,{ref_key:"userRef",ref:K,onUserData:O},null,512)])}}}),Ne=le(ve,[["__scopeId","data-v-0c7b3f1c"]]);export{Ne as default};
