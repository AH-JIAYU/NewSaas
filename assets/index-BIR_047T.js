
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as v,d as D,r as b,l as U,E as C,b as u,q as R,s as j,j as t,o as c,e as p,g as l,w as a,h as y,F as _,v as B,f as z,t as O,H as S,R as P}from"./index-BE-pxncy.js";const V={list:s=>v.post("bill/getMemberBillList",s),create:s=>v.post("bill/addMemberSettlement",s),getMemberBillAvailableBalance:s=>v.post("bill/getMemberBillAvailableBalance",s),changestatus:s=>v.post("bill/updateMemberBill",s)},q=D({__name:"index",props:{id:{default:""}},setup(s,{expose:A}){const d=b(!1),g=b(),n=b({minimumAmount:"",settlementType:1,settlementAmount:"",addMemberSettlementInfoList:[]}),f=b({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),h=b({}),M=async()=>{try{d.value=!0;const r=await V.getMemberBillAvailableBalance({});f.value.memberSettlementInfoList=r.data.memberBillAvailableBalanceInfoList,n.value.minimumAmount=r.data.minimumAmount,d.value=!1}catch{}finally{d.value=!1}},E=r=>{const o=f.value.memberSettlementInfoList.filter(m=>r.includes(m.id));for(let m=0;m<o.length;m++)n.value.addMemberSettlementInfoList.push(o[m])};return U(async()=>{await M()}),A({submit(){return new Promise(r=>{g.value&&g.value.validate(o=>{if(o)try{d.value=!0,V.create(n.value).then(()=>{d.value=!1,C.success({message:"新增成功",center:!0}),r()})}catch{}finally{d.value=!1}})})}}),(r,o)=>{const m=u("el-radio"),L=u("el-radio-group"),i=u("ElFormItem"),I=u("ElInput"),x=u("el-option"),k=u("el-select"),w=u("ElInputNumber"),F=u("ElForm"),N=R("loading");return j((c(),p("div",null,[l(F,{ref_key:"formRef",ref:g,model:t(n),rules:t(h),"label-width":"9rem"},{default:a(()=>[l(i,{label:"结算方式"},{default:a(()=>[l(L,{modelValue:t(n).settlementType,"onUpdate:modelValue":o[0]||(o[0]=e=>t(n).settlementType=e)},{default:a(()=>[l(m,{value:1,size:"large"},{default:a(()=>[y(" 全部结算 ")]),_:1}),l(m,{value:2,size:"large"},{default:a(()=>[y(" 指定结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(n).settlementType===1?(c(),p(_,{key:0},[l(i,{label:"最低结算额度"},{default:a(()=>[l(I,{disabled:"",placeholder:"",value:t(n).minimumAmount},null,8,["value"])]),_:1}),l(i,{label:"结算金额"},{default:a(()=>[l(I,{modelValue:t(n).settlementAmount,"onUpdate:modelValue":o[1]||(o[1]=e=>t(n).settlementAmount=e),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(c(),p(_,{key:1},[l(i,{label:"指定会员"},{default:a(()=>[l(k,{placeholder:"Select",modelValue:t(f).memberSettlementInfoSelect,"onUpdate:modelValue":o[2]||(o[2]=e=>t(f).memberSettlementInfoSelect=e),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:E},{default:a(()=>[(c(!0),p(_,null,B(t(f).memberSettlementInfoList,e=>(c(),z(x,{key:e.id,value:e.id,label:e.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"最低结算额度"},{default:a(()=>[l(I,{disabled:"",placeholder:"",value:"111"})]),_:1}),(c(!0),p(_,null,B(t(n).addMemberSettlementInfoList,e=>(c(),p(_,null,[l(i,{label:""},{default:a(()=>[O("p",null,S(e.memberId)+" - "+S(e.memberName)+" - 可用余额："+S(e.availableBalance),1)]),_:2},1024),l(i,{label:"结算金额"},{default:a(()=>[l(w,{"controls-position":"right",modelValue:e.settlementAmount,"onUpdate:modelValue":T=>e.settlementAmount=T,max:e.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[N,t(d)]])}}}),H=P(q,[["__scopeId","data-v-fa8f99b0"]]),G=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));export{H as D,V as a,G as i};
