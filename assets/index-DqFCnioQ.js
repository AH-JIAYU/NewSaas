
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Le,r as f,am as we,aK as Ne,k as xe,a3 as Ee,a as s,p as Ve,o,b as h,s as A,f as i,j as d,w as n,q as De,az as T,F as b,t as k,g as c,e as r,H as y,i as C,l as V,aL as K,E as j,N as Se,aM as ze,ap as He,R as Ue,ao as F}from"./index-DX1UQaE6.js";import Re from"./index-D41UlepD.js";import Me from"./index-flDAx2Yv.js";import{a as Pe}from"./department-CUEblEEO.js";import{u as Be}from"./department-CJKN3cLv.js";import{u as $e}from"./position_manage-qtqgt1Za.js";import{u as Ae}from"./group_manage-o5o3OzUU.js";import"./position_manage-DgqqUzP4.js";import"./tenant_role-CxTuLRXj.js";import"./configuration_role-B5uSatkD.js";import"./configuration_manager-D11gnmWy.js";import"./group_manage-BQJRKGUE.js";const Te={class:"absolute-container"},Ke={class:"page-main"},je={class:"leftTree"},Fe={key:0,class:"leftData",span:3},Oe={class:"dictionary-container"},O=Le({name:"user",__name:"index",setup(qe){const L=Ae(),D=f(),w=$e(),S=f(),q=we(),z=f([]),N=Be(),H=f(),{pagination:_,getParams:Ge,onSizeChange:G,onCurrentChange:J,onSortChange:Q}=Ne(),x=f([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"姓名",prop:"name",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),W=[{label:"启用",value:!0},{label:"禁用",value:!1}],X={children:"children",label:"name"},Y=f(),U=f(),m=f({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),R=f(),Z=f(),e=f({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),ee=f();async function p(){const l={...e.value.search},a=await V.list(l);e.value.dataList=a.data.data,_.value.total=+a.data.total}xe(async()=>{try{m.value.loading=!0,z.value=await q.getCountry(),H.value=await(N==null?void 0:N.getDepartment())||[],S.value=await(w==null?void 0:w.getPositionManage())||[],D.value=await(L==null?void 0:L.getGroupManage())||[];const l=await Pe.createEvery();m.value.tree=l.data.result,p(),x.value.forEach(a=>{a.checked&&e.value.checkList.push(a.prop)}),m.value.loading=!1}catch{}finally{m.value.loading=!1}}),Ee(()=>m.value.search,l=>{Y.value.filter(l)});function te(l){return new Promise(a=>{K.confirm(`确认${l.active?"禁用":"启用"}「${l.name}」吗？`,"确认信息").then(()=>{try{m.value.loading=!0,V.edit({id:l.id,account:null,name:null,sex:null,phoneNumber:null,active:!l.active}).then(()=>(j.success({message:`${l.active?"禁用":"启用"}成功`,center:!0}),p(),m.value.loading=!1,a(!0))).catch(()=>(m.value.loading=!1,a(!1)))}catch{}finally{m.value.loading=!1}}).catch(()=>a(!1))})}function ae(l){var a;_.value.page=1,(a=l==null?void 0:l.children)!=null&&a.length?(e.value.search.id="",e.value.search.departmentId=l.id,p()):(e.value.search.id=l.id,e.value.search.departmentId="",p())}function le(l){G(l).then(()=>{e.value.search.limit=l,p()})}function ne(l=1){J(l).then(()=>{e.value.search.page=l,p()})}function oe({prop:l,order:a}){Q(l,a).then(()=>p())}function ie(l){e.value.dialog.id="",e.value.dialog.visible=!0,e.value.dialog.level=1,l&&(e.value.dialog.parentId=l.id,e.value.dialog.level=Number(l.level)+1)}const re=l=>{R.value=l[0]};function ue(){const{name:l,id:a}=R.value;K.confirm(`确认将「${l}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{V.reset({id:a}).then(()=>{j.success({message:"重置成功",center:!0}),p()})}).catch(()=>{})}function se(l){e.value.row=JSON.stringify(l),e.value.dialog.id=l.id,e.value.dialog.parentId=l.parentId,e.value.dialog.visible=!0}function de(l){U.value.showEdit(l)}function ce(){Object.assign(e.value.search,{id:"",userName:"",departmentId:null,active:null}),p()}return(l,a)=>{const M=s("el-tree"),P=s("ElInput"),pe=s("el-option"),me=s("el-select"),B=Se,I=s("ElButton"),ve=s("ElSpace"),E=s("el-button"),$=s("el-col"),ge=ze,fe=s("el-row"),g=s("ElTableColumn"),v=s("el-text"),he=s("el-tag"),_e=s("ElSwitch"),ye=s("el-empty"),be=s("ElTable"),ke=s("ElPagination"),Ce=He,Ie=Ve("loading");return o(),h("div",Te,[A("div",Ke,[A("div",je,[m.value.tree.length?(o(),h("div",Fe,[i(M,{style:{"max-width":"37.5rem","min-height":"45.4375rem",padding:"10px"},data:m.value.tree,ref_key:"treeRef",ref:ee,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,props:X,onNodeClick:ae},null,8,["data"])])):d("",!0),i(Ce,null,{default:n(()=>[De((o(),h("div",Oe,[i(ve,null,{default:n(()=>[i(P,{modelValue:e.value.search.id,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.search.id=t),placeholder:"员工ID",clearable:"",style:{width:"12.5rem"},onKeydown:T(p,["enter"])},null,8,["modelValue"]),i(P,{modelValue:e.value.search.userName,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.search.userName=t),placeholder:"用户名",clearable:"",style:{width:"12.5rem"},onKeydown:T(p,["enter"])},null,8,["modelValue"]),i(me,{modelValue:e.value.search.active,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.search.active=t),"value-key":"",placeholder:"状态",style:{width:"12.5rem"},clearable:"",filterable:"",onChange:a[3]||(a[3]=()=>{})},{default:n(()=>[(o(),h(b,null,k(W,t=>i(pe,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(I,{type:"primary",onClick:p},{icon:n(()=>[i(B,{name:"i-ep:search"})]),_:1}),i(I,{onClick:ce},{icon:n(()=>[i(B,{name:"i-ep:refresh"})]),_:1})]),_:1}),i(fe,{style:{"margin-bottom":".3125rem"},gutter:24},{default:n(()=>[i($,{style:{"margin-bottom":"1.5625rem"},span:10},{default:n(()=>[i(E,{type:"primary",size:"default",onClick:ie},{default:n(()=>[c(" 新增 ")]),_:1}),i(E,{size:"default",onClick:ue},{default:n(()=>[c(" 重置密码 ")]),_:1})]),_:1}),i($,{style:{display:"flex","justify-content":"flex-end"},span:14},{default:n(()=>[i(E,{size:"default",onClick:a[4]||(a[4]=()=>{})},{default:n(()=>[c(" 导出 ")]),_:1}),i(ge,{border:e.value.border,"onUpdate:border":a[5]||(a[5]=t=>e.value.border=t),tableAutoHeight:e.value.tableAutoHeight,"onUpdate:tableAutoHeight":a[6]||(a[6]=t=>e.value.tableAutoHeight=t),checkList:e.value.checkList,"onUpdate:checkList":a[7]||(a[7]=t=>e.value.checkList=t),columns:x.value,"onUpdate:columns":a[8]||(a[8]=t=>x.value=t),"line-height":e.value.lineHeight,"onUpdate:lineHeight":a[9]||(a[9]=t=>e.value.lineHeight=t),stripe:e.value.stripe,"onUpdate:stripe":a[10]||(a[10]=t=>e.value.stripe=t),style:{"margin-left":".75rem"},onQueryData:p},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),i(be,{ref_key:"dictionaryItemRef",ref:Z,data:e.value.dataList,border:e.value.border,size:e.value.lineHeight,stripe:e.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:oe,onSelectionChange:a[11]||(a[11]=t=>e.value.selectionDataList=t),"row-key":"id","default-expand-all":"",onSelect:re},{empty:n(()=>[i(ye,{description:"暂无数据"})]),default:n(()=>[i(g,{type:"selection",align:"center",fixed:""}),e.value.checkList.includes("id")?(o(),r(g,{key:0,align:"center",width:"180",prop:"id",label:"员工ID"})):d("",!0),e.value.checkList.includes("userName")?(o(),r(g,{key:1,align:"center",width:"130",prop:"userName",label:"用户名"},{default:n(({row:t})=>[i(v,null,{default:n(()=>[c(y(t.userName?t.userName:"-"),1)]),_:2},1024)]),_:1})):d("",!0),e.value.checkList.includes("name")?(o(),r(g,{key:2,align:"center",width:"130",prop:"name",label:"姓名"})):d("",!0),e.value.checkList.includes("country")?(o(),r(g,{key:3,prop:"country",label:"国家",width:"150",align:"center"},{default:n(({row:t})=>[(o(!0),h(b,null,k(z.value,u=>(o(),h("div",{key:u.id,class:"mx-1"},[u.code===t.country?(o(),r(he,{key:0,type:"primary",class:"mx-1"},{default:n(()=>[c(y(u.chineseName),1)]),_:2},1024)):d("",!0)]))),128))]),_:1})):d("",!0),e.value.checkList.includes("phoneNumber")?(o(),r(g,{key:4,align:"center",width:"170",prop:"phone",label:"电话号码"},{default:n(({row:t})=>[c(y(t.phoneNumber?t.phoneNumber:"-"),1)]),_:1})):d("",!0),e.value.checkList.includes("email")?(o(),r(g,{key:5,align:"center",width:"180",prop:"email",label:"邮箱"},{default:n(({row:t})=>[c(y(t.email?t.email:"-"),1)]),_:1})):d("",!0),e.value.checkList.includes("departmentId")?(o(),r(g,{key:6,align:"center",prop:"departmentId",label:"部门"},{default:n(({row:t})=>[t.departmentId?(o(),r(v,{key:0},{default:n(()=>[(o(!0),h(b,null,k(H.value,u=>(o(),r(v,null,{default:n(()=>[t.departmentId===u.id?(o(),r(v,{key:0},{default:n(()=>[c(y(u.name?u.name:"-"),1)]),_:2},1024)):d("",!0)]),_:2},1024))),256))]),_:2},1024)):(o(),r(v,{key:1},{default:n(()=>[c("-")]),_:1}))]),_:1})):d("",!0),e.value.checkList.includes("positionId")?(o(),r(g,{key:7,align:"center",prop:"positionId",label:"职位"},{default:n(({row:t})=>[t.positionId?(o(),r(v,{key:0},{default:n(()=>[(o(!0),h(b,null,k(S.value,u=>(o(),r(v,null,{default:n(()=>[t.positionId===u.id?(o(),r(v,{key:0},{default:n(()=>[c(y(u.name?u.name:"-"),1)]),_:2},1024)):d("",!0)]),_:2},1024))),256))]),_:2},1024)):(o(),r(v,{key:1},{default:n(()=>[c("-")]),_:1}))]),_:1})):d("",!0),e.value.checkList.includes("groupId")?(o(),r(g,{key:8,align:"center",prop:"groupId",label:"小组"},{default:n(({row:t})=>[t.groupId?(o(),r(v,{key:0},{default:n(()=>[(o(!0),h(b,null,k(D.value,u=>(o(),r(v,null,{default:n(()=>[t.groupId===u.id?(o(),r(v,{key:0},{default:n(()=>[c(y(u.name?u.name:"-"),1)]),_:2},1024)):d("",!0)]),_:2},1024))),256))]),_:2},1024)):(o(),r(v,{key:1},{default:n(()=>[c("-")]),_:1}))]),_:1})):d("",!0),e.value.checkList.includes("active")?(o(),r(g,{key:9,align:"center",prop:"active",label:"状态"},{default:n(t=>[i(_e,{modelValue:t.row.active,"onUpdate:modelValue":u=>t.row.active=u,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>te(t.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):d("",!0),i(g,{label:"操作",fixed:"right",width:"200",align:"center"},{default:n(t=>[i(I,{type:"primary",size:"small",plain:"",onClick:u=>se(t.row)},{default:n(()=>[c(" 编辑 ")]),_:2},1032,["onClick"]),i(I,{type:"primary",size:"small",plain:"",onClick:u=>de(t.row)},{default:n(()=>[c(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"]),i(ke,{"current-page":C(_).page,total:C(_).total,"page-size":C(_).size,"page-sizes":C(_).sizes,layout:C(_).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:le,onCurrentChange:ne},null,8,["current-page","total","page-size","page-sizes","layout"])])),[[Ie,m.value.loading]])]),_:1})]),e.value.dialog.visible?(o(),r(Re,{key:0,id:e.value.dialog.id,modelValue:e.value.dialog.visible,"onUpdate:modelValue":a[12]||(a[12]=t=>e.value.dialog.visible=t),"catalogue-id":e.value.search.catalogueId,"parent-id":e.value.dialog.parentId,level:e.value.dialog.level,tree:m.value.tree,dataList:e.value.dataList,row:e.value.row,onSuccess:p},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):d("",!0),i(Me,{ref_key:"detailRef",ref:U},null,512)])])}}});typeof F=="function"&&F(O);const it=Ue(O,[["__scopeId","data-v-a7f9f501"]]);export{it as default};
