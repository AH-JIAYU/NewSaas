
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as F,r as d,a as s,o as j,b as J,f as t,w as a,g as i,i as l,y as v,e as K,j as O,A as $,_ as L,E as M,L as w}from"./index-CDcFrPzE.js";import{c as U}from"./user_cooperation-oFpsLdNZ.js";import{u as z}from"./index-CaLduACg.js";import"./index-CJ95okTh.js";import"./index-B1BSnhPY.js";import"./department-C4UdYaqe.js";const G={style:{display:"flex"},class:"inviteDialog"},H=F({__name:"index",emits:["fetch-data"],setup(Q,{expose:b,emit:N}){const k=N,c=d(!1),f=d(),e=d({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(o,r,u)=>{if(/^(100|[1-9]?\d)$/.test(r)==!1)return u(new Error("请输入 0 到 100 之间的数字"));u()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}});d([]);async function x(o){e.value.form.id=o.id,e.value.form.priceRatio=o.priceRatio,e.value.form.sendProjectType=o.sendProjectType?[o.sendProjectType]:null,e.value.form.receiveProjectType=o.receiveProjectType?[o.receiveProjectType]:null,e.value.form.chargeUserName=o.userName,e.value.form.invitationType=o.invitationType,e.value.form.chargeUserId=o.userId,c.value=!0}function g(){c.value=!1,e.value.form={},f.value.resetFields()}const y=d();function I(){y.value.showEdit(e.value.form,"请选择负责部门/人")}async function R(o){await U.updateInvitationBindUser({id:e.value.form.id,chargeUserId:o.chargeUserId,invitationType:o.invitationType,chargeUserName:o.chargeUserName,sendProjectType:o.sendProjectType,receiveProjectType:o.receiveProjectType})}async function C(){await U.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio}),M.success({message:"修改成功",center:!0})}async function V(){f.value.validate(o=>{if(o){let r=JSON.parse(JSON.stringify(e.value.form));r.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,r.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,r.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",e.value.form.departmentId="",r.chargeUserId=null,r.chargeUserName="",r.invitationType=""),R(r),C(),k("fetch-data"),g()}})}const E=o=>{Array.isArray(o)&&o.length>1&&(e.value.form.sendProjectType=[o[o.length-1]])},B=o=>{Array.isArray(o)&&o.length>1&&(e.value.form.receiveProjectType=[o[o.length-1]])};function A(o){e.value.form.chargeUserId=o.chargeUserId,e.value.form.invitationType=o.invitationType,e.value.form.chargeUserName=o.chargeUserName}const D=o=>{o.preventDefault()};return b({showEdit:x}),(o,r)=>{const u=s("el-input"),m=s("el-form-item"),_=L,h=s("el-tooltip"),p=s("el-checkbox"),T=s("el-checkbox-group"),q=s("ElForm"),P=s("el-button"),S=s("el-dialog");return j(),J("div",null,[t(S,{modelValue:l(c),"onUpdate:modelValue":r[4]||(r[4]=n=>$(c)?c.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置"},{footer:a(()=>[t(P,{onClick:g},{default:a(()=>[i(" 关闭 ")]),_:1}),t(P,{type:"primary",onClick:V},{default:a(()=>[i(" 确认 ")]),_:1})]),default:a(()=>[t(q,{ref_key:"formRef",ref:f,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left"},{default:a(()=>[t(m,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[t(u,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":r[0]||(r[0]=n=>l(e).form.priceRatio=n),clearable:""},{append:a(()=>[i("%")]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"项目分配方式","label-width":"7rem"}),v("div",G,[t(m,{prop:"sendProjectType","label-width":"7rem"},{label:a(()=>[v("span",null,[t(h,{effect:"dark",content:"1111111",placement:"top-start"},{default:a(()=>[t(_,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),i(" 发送项目 ")])]),default:a(()=>[t(T,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":r[1]||(r[1]=n=>l(e).form.sendProjectType=n),onChange:E},{default:a(()=>[t(p,{value:1},{default:a(()=>[i(" 自动 ")]),_:1}),t(p,{value:2},{default:a(()=>[i(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{prop:"receiveProjectType",style:{"margin-left":"40px"}},{label:a(()=>[v("span",null,[t(h,{effect:"dark",content:"1111111",placement:"top-start"},{default:a(()=>[t(_,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),i(" 接收项目 ")])]),default:a(()=>[t(T,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":r[2]||(r[2]=n=>l(e).form.receiveProjectType=n),onChange:B},{default:a(()=>[t(p,{value:1},{default:a(()=>[i(" 自动 ")]),_:1}),t(p,{value:2},{default:a(()=>[i(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(e).form.receiveProjectType&&l(e).form.receiveProjectType[0]==1?(j(),K(u,{key:0,placeholder:"请选择接收项目负责人",onKeydown:D,onClick:I,modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":r[3]||(r[3]=n=>l(e).form.chargeUserName=n)},null,8,["modelValue"])):O("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),t(z,{ref_key:"userRef",ref:y,onUserData:A},null,512)])}}}),te=w(H,[["__scopeId","data-v-d350dcb5"]]);export{te as default};
