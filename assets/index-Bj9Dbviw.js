
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as w}from"./user_cooperation-DasAheRM.js";import{a as E}from"./department-DaOyUp8X.js";import{d as B,r as s,a2 as i,a as u,i as M,h as t,c as _,w as o,f as c,g as v,j as b,ak as P,ai as R,y as K}from"./index-Dfh_jK84.js";const L=B({name:"componentsQuickEdit",__name:"index",emits:["fetch-data"],setup(S,{expose:k,emit:y}){const U=y,m=s(),e=s({dialogTableVisible:!1,title:"",type:"",loading:"",formData:{},staffList:[],rules:{chargeId:[{required:!0,message:"请选择PM",trigger:"change"}]}}),g=s([]);s([]);const I={children:"children",label:"name"},n=s(),D={chargeUserId:"PM"};async function V(l,a){const r=await E.list({name:""});r.data&&(g.value=r.data),e.value.title=D[a],e.value.type=a,e.value.loading=!0,e.value.formData=P(l),e.value.formData.chargeUserName=l.userName,e.value.formData.chargeUserId=l.userId,e.value.dialogTableVisible=!0,e.value.loading=!1}const C=(l,a)=>{a?(n.value.getCheckedKeys().forEach(d=>{d!==l.id&&n.value.setChecked(d,!1)}),e.value.formData.chargeUserId=l.id,e.value.formData.chargeUserName=l.name):(e.value.formData.chargeUserId=[e.value.formData.chargeUserId].filter(r=>r!==l.id),e.value.formData.chargeUserId.length==0&&(e.value.formData.chargeUserId="")),e.value.formData.chargeUserId||(e.value.formData.chargeUserName="")};async function x(){e.value.loading=!0,m.value.validate(async l=>{if(l){let a=JSON.parse(JSON.stringify(e.value.formData));Array.isArray(a.chargeUserId)&&(a.chargeUserId=a.chargeUserId[0]);const{status:r}=await w.updateInvitationBindUser(a);r===1&&R.success({message:"编辑成功",center:!0}),U("fetch-data"),p()}e.value.loading=!1})}function p(){e.value.dialogTableVisible=!1,e.value.formData={}}return k({showEdit:V}),(l,a)=>{const r=i("el-tree-select"),d=i("el-form-item"),N=i("el-form"),h=i("el-button"),T=i("el-dialog");return u(),M("div",null,[t(e).dialogTableVisible?(u(),_(T,{key:0,modelValue:t(e).dialogTableVisible,"onUpdate:modelValue":a[1]||(a[1]=f=>t(e).dialogTableVisible=f),title:t(e).title+"编辑",draggable:""},{footer:o(()=>[c(h,{onClick:p,disabled:t(e).loading},{default:o(()=>[v(" 取消 ")]),_:1},8,["disabled"]),c(h,{type:"primary",onClick:x,disabled:t(e).loading},{default:o(()=>[v(" 确定 ")]),_:1},8,["disabled"])]),default:o(()=>[c(N,{ref_key:"formRef",ref:m,model:t(e).formData,rules:t(e).rules,"label-width":"100","label-position":"right"},{default:o(()=>[t(e).type==="chargeUserId"?(u(),_(d,{key:0,label:"PM",prop:"chargeUserId"},{default:o(()=>[c(r,{placeholder:"请选择部门",ref_key:"treeRef",ref:n,modelValue:t(e).formData.chargeUserId,"onUpdate:modelValue":a[0]||(a[0]=f=>t(e).formData.chargeUserId=f),data:t(g),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:I,onCheckChange:C,"check-on-click-node":!0,style:{width:"37.625rem"},"expand-on-click-node":!1,clearable:""},null,8,["modelValue","data"])]),_:1})):b("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])):b("",!0)])}}}),O=K(L,[["__scopeId","data-v-6b7422c9"]]);export{O as default};
