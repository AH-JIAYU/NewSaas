
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Qe,am as Ge,r as i,aN as We,a5 as Xe,c as Ze,l as et,b as c,q as tt,s as j,o as s,e as S,g as n,w as t,az as le,F as w,v as L,f as r,aq as x,h as u,H as _,t as f,k as p,j as C,S as O,E as me,N as lt,aP as nt,aQ as at,bb as ot,ap as st,aI as rt,aJ as ut,R as it}from"./index-Ch_t1wnJ.js";import{_ as ct}from"./index-ehTuwwyN.js";import{_ as dt}from"./index.vue_vue_type_style_index_0_lang-tj1dU9Fq.js";import{_ as pt}from"./index.vue_vue_type_script_setup_true_lang-WglbtpEF.js";import{_ as mt}from"./index.vue_vue_type_script_setup_true_lang-BXRFz_7B.js";import ft from"./index-DrOYqEol.js";import{_ as _t}from"./index.vue_vue_type_script_setup_true_lang-DJH-35BN.js";import vt from"./index-Q3FkvhYn.js";import yt from"./index-aXGso-n5.js";import{u as gt}from"./user_customer-BwhD2fIR.js";import{u as bt}from"./configuration_manager-DtPbiEQK.js";import{a as kt}from"./project_settlement-aZjF7nV_.js";import"./index-BHChwjQY.js";import"./user_customer-B4PigaPU.js";const ht=R=>(rt("data-v-6ec702a9"),R=R(),ut(),R),Ct=ht(()=>f("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),It={class:"copyId"},St={class:"id oneLine"},jt={class:"oneLine"},Dt={class:"oneLine"},wt={class:"oneLine",style:{width:"calc(100% - 20px)"}},$t={key:0,class:"oneLine"},Nt=["src"],Vt={class:"flex-c"},zt={class:"oneLine",style:{width:"calc(100% - 20px)"}},Et={class:"flex-c"},Tt={class:"oneLine",style:{width:"calc(100% - 40px)"}},Lt={class:"flex-c"},xt={class:"oneLine",style:{width:"calc(100% - 20px)"}},Rt=Qe({name:"settlement",__name:"list",setup(R){const ne=Ge(),A=i(),fe=gt(),ae=i(),_e=bt(),ve=i(),B=i([]),{pagination:D,onSizeChange:ye,onCurrentChange:ge}=We(),be=i(""),$=i(!0),F=i(),oe=i(),se=i(),H=i(),re=i(),M=i(!1),J=i(!1),v=i([]);i(!1);const Y=i("default"),q=i(!1),N=i([]),K=i([{label:"项目ID",prop:"projectId",sortable:!0,checked:!0},{label:"项目名称",prop:"projectName",sortable:!0,checked:!0},{label:"客户简称/标识",prop:"customerName",sortable:!0,checked:!0},{label:"原价",prop:"projectAmount",sortable:!0,checked:!0},{label:"所属国家",prop:"countryId",sortable:!0,checked:!0},{label:"系统/审核完成数",prop:"systemDone",sortable:!0,checked:!0},{label:"结算PO号",prop:"settlementPo",sortable:!0,checked:!0},{label:"结算状态",prop:"status",sortable:!0,checked:!0},{label:"节点时间",prop:"nodeTime",sortable:!0,checked:!0},{label:"备注",prop:"remark",sortable:!0,checked:!0}]),ue=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],V=i([]),d=Xe({page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:[],timeType:"",startTime:"",endTime:""}),ie=i([]);function ke(a){N.value=a}const z=i();function he(a){a?z.value=a.projectId:z.value=""}function Ce(a){if(N.value.length)F.value.showEdit(a,N.value);else return me({message:"请选择至少一条数据",type:"warning"})}function Ie(){oe.value.showEdit()}function Se(a){if(N.value.length)F.value.showEdit(a,N.value);else return me({message:"请选择至少一条数据",type:"warning"})}async function ce(a){se.value.showEdit(JSON.stringify(a))}function je(a){H.value.showEdit(JSON.stringify(a),"")}function Q(a,l){H.value.showEdit(JSON.stringify(a),l)}function De(a){re.value.showEdit(JSON.stringify(a))}function we(a){ye(a).then(()=>{d.limit=a,I()})}function k(a=1){ge(a).then(()=>{d.page=a,I()})}function $e(){Object.assign(d,{page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:[],timeType:"",startTime:"",endTime:""}),V.value=[],B.value=[],I()}const Ne=a=>{d.countryId=a.join(","),k()},Ve=()=>{d.startTime=V.value[0],d.endTime=V.value[1],k()},ze=a=>{if(!a||a.length===0)return"";const l=m=>{const g=m.getFullYear(),E=m.getMonth()+1,W=m.getDate();return`${g}-${E}-${W}`};if(a.length===1){const m=new Date(parseInt(a[0]));return l(m)}else if(a.length===2){const[m,g]=a.map(E=>new Date(parseInt(E)));return`${l(m)} - ${l(g)}`}return""},P=Ze(()=>a=>A.value.filter(m=>a.includes(m.id)).map(m=>m.chineseName));async function I(){try{$.value=!0;const{data:a}=await kt.list(d);ie.value=a.projectSettlementList,D.value.total=+a.total,$.value=!1}catch{}finally{$.value=!1}}et(async()=>{A.value=await ne.getCountry(),ae.value=await fe.getCustomerList(),ve.value=await _e.getStaff(),K.value.forEach(a=>{a.checked&&v.value.push(a.prop)}),I()});function G(a,l){switch(a){case"auditing":ce(l);break;case"edit":je(l);break;case"refundDetails":De(l);break}}return(a,l)=>{const m=c("el-input"),g=c("el-form-item"),E=c("ElOption"),W=c("ElSelect"),X=c("el-option"),Z=c("el-select"),Ee=c("el-date-picker"),T=lt,ee=c("ElButton"),Te=c("ElFormItem"),Le=c("el-form"),xe=pt,Re=c("ElDivider"),y=c("el-button"),Pe=dt,Ue=nt,Oe=at,Ae=c("el-row"),b=c("el-table-column"),de=ct,Be=ot,te=c("el-tag"),Fe=c("el-link"),He=c("el-tooltip"),U=c("el-text"),Me=c("ElSpace"),Je=c("el-empty"),Ye=c("el-table"),qe=c("ElPagination"),Ke=st,pe=tt("loading");return j((s(),S("div",{class:O({"absolute-container":M.value})},[n(Ke,null,{default:t(()=>[n(xe,{"show-toggle":!1},{default:t(({fold:e,toggle:h})=>[n(Le,{model:d,size:"default","label-width":"6.25rem","inline-message":"",inline:"",class:"search-form"},{default:t(()=>[n(g,{label:""},{default:t(()=>[n(m,{modelValue:d.projectId,"onUpdate:modelValue":l[0]||(l[0]=o=>d.projectId=o),clearable:"",placeholder:"项目ID",onKeydown:l[1]||(l[1]=le(o=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),n(g,{label:""},{default:t(()=>[n(m,{modelValue:d.projectName,"onUpdate:modelValue":l[2]||(l[2]=o=>d.projectName=o),clearable:"",placeholder:"项目名称",onKeydown:l[3]||(l[3]=le(o=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),n(g,{label:""},{default:t(()=>[n(m,{modelValue:d.projectIdentification,"onUpdate:modelValue":l[4]||(l[4]=o=>d.projectIdentification=o),clearable:"",placeholder:"项目标识",onKeydown:l[5]||(l[5]=le(o=>k(),["enter"]))},null,8,["modelValue"])]),_:1}),j(n(g,{label:""},{default:t(()=>[n(W,{modelValue:B.value,"onUpdate:modelValue":l[6]||(l[6]=o=>B.value=o),placeholder:"国家",clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:Ne},{default:t(()=>[(s(!0),S(w,null,L(A.value,o=>(s(),r(E,{label:o.chineseName,value:o.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,{label:""},{default:t(()=>[n(Z,{placeholder:"客户简称",modelValue:d.customerId,"onUpdate:modelValue":l[7]||(l[7]=o=>d.customerId=o),clearable:"",onChange:l[8]||(l[8]=o=>k())},{default:t(()=>[(s(!0),S(w,null,L(ae.value,o=>(s(),r(X,{key:o.tenantCustomerId,value:o.tenantCustomerId,label:o.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,{label:""},{default:t(()=>[n(Z,{placeholder:"结算状态",modelValue:d.settlementStatus,"onUpdate:modelValue":l[9]||(l[9]=o=>d.settlementStatus=o),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:l[10]||(l[10]=o=>k())},{default:t(()=>[(s(),S(w,null,L(ue,o=>n(X,{key:o.value,value:o.value,label:o.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,{label:""},{default:t(()=>[n(Z,{placeholder:"时间类型",modelValue:d.timeType,"onUpdate:modelValue":l[11]||(l[11]=o=>d.timeType=o),clearable:"",onChange:l[12]||(l[12]=o=>k())},{default:t(()=>[(s(),S(w,null,L(ue,o=>n(X,{key:o.value,value:o.value,label:o.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),j(n(g,null,{default:t(()=>[n(Ee,{modelValue:V.value,"onUpdate:modelValue":l[13]||(l[13]=o=>V.value=o),"value-format":"YYYY-MM-DD hh:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:"",size:"",onChange:Ve},null,8,["modelValue"])]),_:2},1536),[[x,!e]]),n(Te,null,{default:t(()=>[n(ee,{type:"primary",onClick:l[14]||(l[14]=o=>k())},{icon:t(()=>[n(T,{name:"i-ep:search"})]),default:t(()=>[u(" 筛选 ")]),_:1}),n(ee,{onClick:$e},{icon:t(()=>[Ct]),default:t(()=>[u(" 重置 ")]),_:1}),n(ee,{link:"",onClick:h},{icon:t(()=>[n(T,{name:e?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:t(()=>[u(" "+_(e?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),n(Re,{"border-style":"dashed"}),n(Ae,{gutter:24},{default:t(()=>[n(Pe,null,{default:t(()=>[n(y,{type:"primary",size:"default",onClick:Ie},{default:t(()=>[u(" 新增结算 ")]),_:1}),n(y,{type:"primary",size:"default",onClick:l[15]||(l[15]=e=>Ce(1))},{default:t(()=>[u(" 开票 ")]),_:1}),n(y,{type:"primary",size:"default",onClick:l[16]||(l[16]=e=>Se(2))},{default:t(()=>[u(" 结算 ")]),_:1})]),_:1}),n(Oe,null,{default:t(()=>[n(y,{size:"default",onClick:l[17]||(l[17]=()=>{})},{default:t(()=>[u(" 导出 ")]),_:1}),n(Ue,{border:J.value,"onUpdate:border":l[18]||(l[18]=e=>J.value=e),tableAutoHeight:M.value,"onUpdate:tableAutoHeight":l[19]||(l[19]=e=>M.value=e),checkList:v.value,"onUpdate:checkList":l[20]||(l[20]=e=>v.value=e),columns:K.value,"onUpdate:columns":l[21]||(l[21]=e=>K.value=e),"line-height":Y.value,"onUpdate:lineHeight":l[22]||(l[22]=e=>Y.value=e),stripe:q.value,"onUpdate:stripe":l[23]||(l[23]=e=>q.value=e),style:{"margin-left":"0.75rem"},onQueryData:k},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),j((s(),r(Ye,{ref_key:"tableSortRef",ref:be,style:{"margin-top":"10px"},"row-key":"id",data:ie.value,border:J.value,size:Y.value,stripe:q.value,"highlight-current-row":"",onSelectionChange:ke,onCurrentChange:he},{empty:t(()=>[n(Je,{description:"暂无数据"})]),default:t(()=>[n(b,{align:"center",type:"selection"}),v.value.includes("projectId")?(s(),r(b,{key:0,"show-overflow-tooltip":"",prop:"projectId",align:"center",width:"150",label:"项目"},{default:t(({row:e})=>[f("div",It,[f("div",St,"ID: "+_(e.projectId),1),n(de,{class:"copy",content:e.projectId},null,8,["content"])])]),_:1})):p("",!0),v.value.includes("projectName")?(s(),r(b,{key:1,"show-overflow-tooltip":"",prop:"projectName",align:"left",width:"150",label:"名称/标识"},{default:t(({row:e})=>[f("b",jt,"名: "+_(e.projectName?e.projectName:"-"),1),f("div",Dt,"标: "+_(e.customerName.split("/")[1]!=="null"?e.customerName.split("/")[1]:"-"),1)]),_:1})):p("",!0),v.value.includes("customerName")?(s(),r(b,{key:2,"show-overflow-tooltip":"",prop:"customerName",width:"130",align:"center",label:"客户"},{default:t(({row:e})=>[f("div",wt,[f("b",null,_(e.customerName.split("/")[0]),1),e.projectType!==2?(s(),S("div",$t,[f("img",{src:e.avatar,alt:"",class:"avatar"},null,8,Nt),f("span",null,_(e.chargeName),1)])):p("",!0)])]),_:1})):p("",!0),v.value.includes("projectAmount")?(s(),r(b,{key:3,"show-overflow-tooltip":"",align:"center",label:"原价",width:"80"},{default:t(({row:e})=>[n(Be),u(_(e.projectAmount||0),1)]),_:1})):p("",!0),v.value.includes("countryId")?(s(),r(b,{key:4,"show-overflow-tooltip":"",align:"center",label:"国家",width:"80"},{default:t(({row:e})=>[e.countryId?(s(),S(w,{key:0},[e.countryId.length>=C(ne).country.length?(s(),r(te,{key:0,type:"primary"},{default:t(()=>[u("全球")]),_:1})):C(P)(e.countryId).length>1?(s(),r(He,{key:1,class:"box-item",effect:"dark",content:C(P)(e.countryId).join(","),placement:"top"},{default:t(()=>[n(Fe,{type:"primary"},{default:t(()=>[n(te,{type:"primary"},{default:t(()=>[u("×"+_(C(P)(e.countryId).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])):(s(!0),S(w,{key:2},L(C(P)(e.countryId),h=>(s(),r(te,{key:h,type:"primary"},{default:t(()=>[u(_(h),1)]),_:2},1024))),128))],64)):p("",!0)]),_:1})):p("",!0),v.value.includes("systemDone")?(s(),r(b,{key:5,"show-overflow-tooltip":"",prop:"systemDone",align:"center",width:"130",label:"系统/审核完成数"},{default:t(({row:e})=>[f("div",Vt,[f("div",zt,[n(U,null,{default:t(()=>[u(_(e.systemDone?e.systemDone:0),1)]),_:2},1024),u(" /"),n(U,{class:"mx-1",type:"success"},{default:t(()=>[u(_(e.settlementDone?e.settlementDone:0),1)]),_:2},1024)]),n(T,{onClick:h=>Q(e,"systemDone"),class:O({edit:"edit",current:e.projectId===z.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):p("",!0),v.value.includes("settlementDone")?(s(),r(b,{key:6,"show-overflow-tooltip":"",prop:"settlementDone",align:"center",label:"结算完成数"})):p("",!0),v.value.includes("settlementPo")?(s(),r(b,{key:7,"show-overflow-tooltip":"",prop:"settlementPo",align:"center",label:"结算PO号"},{default:t(({row:e})=>[f("div",Et,[f("div",Tt,_(e.settlementPo?e.settlementPo:"-"),1),e.settlementPo?(s(),r(de,{key:0,class:"copy",content:e.settlementPo},null,8,["content"])):p("",!0),n(T,{onClick:h=>Q(e,"settlementPo"),class:O({edit:"edit",current:e.projectId===z.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):p("",!0),v.value.includes("nodeTime")?(s(),r(b,{key:8,"show-overflow-tooltip":"",prop:"nodeTime",align:"left",label:"节点"},{default:t(({row:e})=>[e.status===1?(s(),r(y,{key:0,size:"small",class:"p-1",type:"warning"},{default:t(()=>[u("待审核")]),_:1})):p("",!0),e.status===3?(s(),r(y,{key:1,size:"small",class:"p-1",type:"success"},{default:t(()=>[u("已开票")]),_:1})):p("",!0),e.status===4?(s(),r(y,{key:2,size:"small",class:"p-1",type:"info"},{default:t(()=>[u("已结算")]),_:1})):p("",!0),e.status===2?(s(),r(y,{key:3,size:"small",class:"p-1",type:"primary"},{default:t(()=>[u("已审核")]),_:1})):p("",!0),e.status===5?(s(),r(y,{key:4,size:"small",class:"p-1",type:"danger"},{default:t(()=>[u("已冻结")]),_:1})):p("",!0),e.nodeTime.length?(s(),r(U,{key:5,class:"mx-1"},{default:t(()=>[u(_(ze(e.nodeTime)),1)]),_:2},1024)):(s(),r(U,{key:6,class:"mx-1"},{default:t(()=>[u("-")]),_:1}))]),_:1})):p("",!0),v.value.includes("remark")?(s(),r(b,{key:9,"show-overflow-tooltip":"",prop:"remark",align:"center",label:"备注"},{default:t(({row:e})=>[f("div",Lt,[f("div",xt,_(e.remark?e.remark:"-"),1),n(T,{onClick:h=>Q(e,"remark"),class:O({edit:"edit",current:e.projectId===z.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):p("",!0),n(b,{align:"center",fixed:"right",label:"操作",width:"250"},{default:t(({row:e})=>[n(Me,null,{default:t(()=>[e.status===1?(s(),r(y,{key:0,type:"primary",size:"small",plain:"",onClick:h=>ce(e)},{default:t(()=>[u(" 审核 ")]),_:2},1032,["onClick"])):p("",!0),e.status===5?(s(),r(y,{key:1,type:"primary",size:"small",plain:"",onClick:h=>G("auditing",e)},{default:t(()=>[u(" 重审 ")]),_:2},1032,["onClick"])):p("",!0),n(y,{type:"primary",size:"small",plain:"",onClick:h=>G("edit",e)},{default:t(()=>[u(" 结算编辑 ")]),_:2},1032,["onClick"]),n(y,{type:"primary",size:"small",plain:"",onClick:h=>G("refundDetails",e)},{default:t(()=>[u(" 退款详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","border","size","stripe"])),[[pe,$.value]]),n(qe,{"current-page":C(D).page,total:C(D).total,"page-size":C(D).size,"page-sizes":C(D).sizes,layout:C(D).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:we,onCurrentChange:k},null,8,["current-page","total","page-size","page-sizes","layout"]),n(mt,{onSuccess:I,ref_key:"invoicingRef",ref:F},null,512),n(ft,{onSuccess:I,ref_key:"auditingRef",ref:se},null,512),n(_t,{onSuccess:I,ref_key:"editRef",ref:H},null,512),n(vt,{ref_key:"refundRef",ref:re},null,512),n(yt,{onSuccess:I,ref_key:"addSettlementRef",ref:oe},null,512)]),_:1})],2)),[[pe,$.value]])}}}),Wt=it(Rt,[["__scopeId","data-v-6ec702a9"]]);export{Wt as default};
