
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ye,M as _e,aM as ve,p as be,r as z,l as he,B as N,H as Ce,c as we,a as u,al as Pe,o as c,b as C,f as a,w as l,i as n,aA as Ie,F as S,n as Le,e as g,g as p,D as j,am as Se,j as B,Q as ke,E as w,aN as U,L as Me,ak as Ve,P as Ee}from"./index-BCmcck4o.js";import{_ as $e}from"./index.vue_vue_type_script_setup_true_lang-Dt8sLSTh.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-hv7PxNq_.js";import{s as P}from"./apiLoading-DH-rGpHD.js";import{a as y}from"./otherFunctions_screenLibrary-DDEUVZIg.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-ClPwq-jO.js";import{u as ze}from"./otherFunctions_basicDictionary-BNHwmyh7.js";import{u as Ne}from"./index-Sr5JXwWv.js";import{u as je}from"./stagedData-DKsaUA30.js";import{u as Be}from"./useTabbar-C38ff8EA.js";import"./basicDictionary-B2_wNbhc.js";/* empty css                      */const Ue=ye({name:"OtherFunctionsScreenLibraryList",__name:"list",setup(Fe){const F=ze(),T=Ne(),I=je(),O=_e(),{pagination:m,getParams:A,onSizeChange:H,onCurrentChange:R,onSortChange:K}=ve(),q=Be(),E=be(),e=z({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),$=z();he(async()=>{d(),e.value.countryList=await F.getCountry(),e.value.formMode==="router"&&N.on("get-data-list",()=>{d()})}),Ce(()=>{e.value.formMode==="router"&&N.off("get-data-list")});function d(){e.value.loading=!0;const t={...A(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};y.list(t).then(o=>{e.value.loading=!1,e.value.dataList=o.data.getCountryListInfoList,m.value.total=o.data.getCountryListInfoList.length})}const x=we(()=>e.value.dataList.slice((m.value.page-1)*m.value.size,m.value.page*m.value.size));function J(t){H(t).then(()=>d())}function L(t=1){R(t).then(()=>d())}function D({prop:t,order:o}){K(t,o).then(()=>d())}function Q(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function G(t){t.getProjectProblemCategoryInfoList.unshift({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add"})}function W(t,o,_){$.value.validateField(`[${o}].getProjectProblemCategoryInfoList[${_}].categoryName`,async v=>{if(v){const{data:k,status:b}=await P(y.create(t));b===1&&w.success({message:"新增成功",center:!0}),await d()}})}function X(t,o){const _=e.value.dataList.findIndex(v=>v.countryId===t.countryId);e.value.dataList[_].getProjectProblemCategoryInfoList.splice(o,1)}async function Y(t){const{status:o}=await P(y.update(t));o===1&&w.success({message:"修改「默认国家」成功",center:!0}),d(),I.projectManagementList=null}async function Z(t){const{status:o}=await P(y.edit(t));o===1&&w.success({message:"修改「状态」成功",center:!0}),d(),I.projectManagementList=null}function ee(t){T.countryId=t.countryId,e.value.formMode==="router"?E.settings.tabbar.enable&&E.settings.tabbar.mergeTabsBy!=="activeMenu"?q.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):O.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function te(t){U.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:o}=await P(y.delete({countryId:t.countryId}));o===1&&w.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),I.projectManagementList=null}function ae(t){U.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:o}=await P(y.delete({projectProblemCategoryId:t.projectProblemCategoryId}));o===1&&w.success({message:"删除成功",center:!0}),d()}).catch(()=>{}),I.projectManagementList=null}return(t,o)=>{const _=u("ElOption"),v=u("el-select"),k=u("ElFormItem"),b=Me,f=u("ElButton"),oe=u("ElForm"),ne=$e,le=u("ElDivider"),re=u("ElSpace"),M=u("el-table-column"),ie=u("el-input"),se=u("el-form-item"),V=u("ElSwitch"),h=u("ElTableColumn"),ue=u("el-table"),de=u("el-empty"),ce=u("ElTable"),me=u("el-form"),pe=u("ElPagination"),fe=Ve,ge=Pe("loading");return c(),C("div",{class:ke({"absolute-container":n(e).tableAutoHeight})},[a(fe,null,{default:l(()=>[a(ne,{"show-toggle":!1},{default:l(({fold:i,toggle:r})=>[a(oe,{model:n(e).search,size:"default","label-width":"100px","inline-message":"",inline:"",class:"search-form"},{default:l(()=>[a(k,{label:""},{default:l(()=>[a(v,{onKeydown:o[0]||(o[0]=Ie(s=>L(),["enter"])),onClear:o[1]||(o[1]=s=>L()),filterable:"",modelValue:n(e).search.countryId,"onUpdate:modelValue":o[2]||(o[2]=s=>n(e).search.countryId=s),placeholder:"国家"},{default:l(()=>[(c(!0),C(S,null,Le(n(e).countryList,s=>(c(),g(_,{label:s.chineseName,value:s.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(k,null,{default:l(()=>[a(f,{type:"primary",onClick:o[3]||(o[3]=s=>L())},{icon:l(()=>[a(b,{name:"i-ep:search"})]),default:l(()=>[p(" 筛选 ")]),_:1}),a(f,{link:"",disabled:"",onClick:r},{icon:l(()=>[a(b,{name:i?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:l(()=>[p(" "+j(i?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),a(le,{"border-style":"dashed"}),a(re,{wrap:""},{default:l(()=>[a(f,{type:"primary",size:"default",onClick:Q},{icon:l(()=>[a(b,{name:"i-ep:plus"})]),default:l(()=>[p(" 新增前置问卷库 ")]),_:1})]),_:1}),a(me,{ref_key:"formRef",ref:$,rules:n(e).rules,model:n(x)},{default:l(()=>[Se((c(),g(ce,{class:"my-4",border:"",data:n(x),"highlight-current-row":"",height:"100%",onSortChange:D,onSelectionChange:o[5]||(o[5]=i=>n(e).batch.selectionDataList=i),"default-expand-all":!0},{empty:l(()=>[a(de,{description:"暂无数据"})]),default:l(()=>[a(M,{type:"expand",width:"55"},{default:l(i=>[a(ue,{data:i.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",border:"",height:"100%",onSortChange:D,onSelectionChange:o[4]||(o[4]=r=>n(e).batch.selectionDataList=r)},{default:l(()=>[a(M,{width:"55"}),a(M,{width:"500",prop:"categoryName",label:"问卷名称",align:"center"},{default:l(r=>[r.row.type==="add"?(c(),g(se,{key:0,prop:`[${i.$index}].getProjectProblemCategoryInfoList[${r.$index}].categoryName`,rules:n(e).rules.categoryName},{default:l(()=>[a(ie,{modelValue:r.row.categoryName,"onUpdate:modelValue":s=>r.row.categoryName=s},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(c(),C(S,{key:1},[p(j(r.row.categoryName),1)],64))]),_:2},1024),a(h,{prop:"status",label:"状态"},{default:l(r=>[r.row.type==="add"?(c(),g(V,{key:0,modelValue:r.row.status,"onUpdate:modelValue":s=>r.row.status=s,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])):(c(),g(V,{key:1,onChange:s=>Z(r.row),modelValue:r.row.status,"onUpdate:modelValue":s=>r.row.status=s,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),a(h,{width:"250",align:"center",fixed:"right",label:"操作"},{default:l(r=>[r.row.type==="add"?(c(),C(S,{key:0},[a(f,{type:"primary",size:"small",plain:"",onClick:s=>W(r.row,i.$index,r.$index)},{default:l(()=>[p(" 提交 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:s=>X(r.row,r.$index)},{default:l(()=>[p(" 取消 ")]),_:2},1032,["onClick"])],64)):(c(),C(S,{key:1},[a(f,{type:"success",size:"small",plain:"",onClick:s=>ee(r.row)},{default:l(()=>[p(" 设计问卷 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:s=>ae(r.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),a(h,{prop:"countryName",label:"国家/标题",width:"500"}),a(h,{prop:"isDefault",label:"默认/状态"},{default:l(i=>[a(V,{onChange:r=>Y(i.row),modelValue:i.row.isDefault,"onUpdate:modelValue":r=>i.row.isDefault=r,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),a(h,{label:"操作",width:"250",align:"center",fixed:"right"},{default:l(i=>[a(f,{type:"primary",size:"small",plain:"",onClick:r=>G(i.row)},{default:l(()=>[p(" 新增问卷 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:r=>te(i.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,n(e).loading]])]),_:1},8,["rules","model"]),a(pe,{"current-page":n(m).page,total:n(m).total,"page-size":n(m).size,"page-sizes":n(m).sizes,layout:n(m).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:J,onCurrentChange:L},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),n(e).editProps.visible?(c(),g(De,{key:0,id:n(e).editProps.id,countryId:n(e).editProps.countryId,modelValue:n(e).editProps.visible,"onUpdate:modelValue":o[6]||(o[6]=i=>n(e).editProps.visible=i),row:n(e).editProps.row,onSuccess:d},null,8,["id","countryId","modelValue","row"])):B("",!0),n(e).formMode==="dialog"||n(e).formMode==="drawer"?(c(),g(xe,{key:1,id:n(e).formModeProps.id,modelValue:n(e).formModeProps.visible,"onUpdate:modelValue":o[7]||(o[7]=i=>n(e).formModeProps.visible=i),mode:n(e).formMode,details:n(e).formModeProps.details,title:n(e).formModeProps.title,onSuccess:d},null,8,["id","modelValue","mode","details","title"])):B("",!0)],2)}}}),Ye=Ee(Ue,[["__scopeId","data-v-2bd73ad1"]]);export{Ye as default};
