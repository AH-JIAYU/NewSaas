
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as q}from"./project_settlement-qMHVcxX6.js";import $ from"./index-CJUr7o6r.js";import{d as A,ae as H,r as c,a2 as n,al as J,a as C,i as G,f as a,w as r,b as u,g as p,a3 as K,c as j,t as m,h as s,j as I,ai as w,y as Q}from"./index-tHSAnviy.js";const W={class:"border"},X={class:"pp"},Y={class:"neip"},Z={class:"border"},ee={class:"pp"},le={class:"neip"},ae={class:"shenhe"},te={class:"beizhu"},re={class:"po"},oe={class:"flex-c"},se=A({name:"ProjectReview",__name:"index",emits:["success"],setup(ne,{expose:T,emit:D}){const{t}=H(),z=c(),B=D,g=c(!1),i=c(),l=c({projectId:"",projectName:"",settlementType:"",remark:"",projectSettlementBuilderList:[],po:"",arr:""}),E=(v,e,d)=>{/^[\d\n]*$/.test(e)?d():d(new Error(t("recordChange.numEnter")))},U=c({settlementType:[{required:!0,message:t("recordChange.chooseType"),trigger:"change"}],arr:[{required:!0,message:t("recordChange.idEnter"),trigger:"blur"},{validator:E,trigger:"blur"}]}),h=c(),V=c(!1),f=c(!1);async function O(v){v&&(i.value=JSON.parse(v),l.value.projectId=i.value.projectId,l.value.projectName=i.value.projectName),f.value=!0}async function R(){h.value&&h.value.validate(async v=>{try{if(v){g.value=!0,delete l.value.projectName,l.value.settlementType===1||l.value.settlementType===2?l.value.projectSettlementBuilderList=l.value.arr.split(`
`)||[]:l.value.projectSettlementBuilderList=[],delete l.value.arr;const{status:e}=await q.review(l.value);e===1?(new BroadcastChannel("televiseChannel").postMessage("我在子页面提交了,需要刷新列表"),B("success"),g.value=!1,w.success({message:t("recordChange.success"),center:!0}),k()):w.error({message:t("recordChange.failure"),center:!0})}else w({message:t("recordChange.check"),type:"warning"})}catch{}finally{g.value=!1}})}function k(){h.value.resetFields(),Object.assign(l.value,{projectId:"",projectName:"",settlementType:"",remark:"",projectSettlementBuilderList:[],po:"",arr:""}),l.value.arr=[],f.value=!1}return T({showEdit:O}),(v,e)=>{const d=n("el-input"),b=n("el-row"),_=n("el-radio"),S=n("el-radio-group"),y=n("el-form-item"),N=n("el-col"),L=n("el-checkbox"),P=n("el-form"),x=n("el-button"),F=n("el-drawer"),M=J("loading");return C(),G("div",null,[a(F,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=o=>f.value=o),title:s(t)("recordChange.projectAudit"),size:"50%","before-close":k},{footer:r(()=>[u("div",oe,[a(x,{onClick:e[8]||(e[8]=o=>f.value=!1)},{default:r(()=>[p(" 取消 ")]),_:1}),a(x,{type:"primary",onClick:R},{default:r(()=>[p(" 确定 ")]),_:1})])]),default:r(()=>[K((C(),j(P,{ref_key:"formRef",ref:h,model:l.value,rules:U.value,"label-width":"174px",inline:!1},{default:r(()=>[a(b,{style:{margin:"0"},gutter:20},{default:r(()=>[u("div",W,[u("p",X,m(s(t)("recordChange.projectID")),1),u("p",Y,[a(d,{modelValue:i.value.projectId,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.projectId=o),placeholder:s(t)("recordChange.projectIDEnter"),disabled:"",clearable:""},null,8,["modelValue","placeholder"])])]),u("div",Z,[u("p",ee,m(s(t)("recordChange.projectName")),1),u("p",le,[a(d,{modelValue:i.value.projectName,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.projectName=o),disabled:"",placeholder:s(t)("recordChange.projectNameEnter"),clearable:""},null,8,["modelValue","placeholder"])])])]),_:1}),u("div",ae,[a(y,{prop:"settlementType",style:{display:"flex","align-items":"center"},label:s(t)("recordChange.auditMethod")},{default:r(()=>[a(S,{modelValue:l.value.settlementType,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.settlementType=o)},{default:r(()=>[a(_,{value:1,size:"large"},{default:r(()=>[p(m(s(t)("recordChange.successID")),1)]),_:1}),a(_,{value:2,size:"large"},{default:r(()=>[p(m(s(t)("recordChange.failureID")),1)]),_:1}),a(_,{value:3,size:"large"},{default:r(()=>[p(m(s(t)("recordChange.allPass")),1)]),_:1}),a(_,{value:4,size:"large"},{default:r(()=>[p(m(s(t)("recordChange.allFailure")),1)]),_:1}),a(_,{value:5,size:"large"},{default:r(()=>[p(m(s(t)("recordChange.dataFreezing")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),u("div",te,[a(y,{label:s(t)("recordChange.remark")},{default:r(()=>[a(d,{class:"custom-input",modelValue:l.value.remark,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.remark=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),u("div",re,[V.value?(C(),j(y,{key:0,label:s(t)("recordChange.PONumber")},{default:r(()=>[a(d,{modelValue:l.value.po,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.po=o),class:"custom-input",placeholder:"",clearable:"",onChange:e[5]||(e[5]=()=>{})},null,8,["modelValue"])]),_:1},8,["label"])):I("",!0)]),a(b,{style:{margin:"0"},gutter:20},{default:r(()=>[a(N,{span:20}),a(N,{span:4},{default:r(()=>[a(L,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),label:s(t)("recordChange.PONumberEnter"),size:"large"},null,8,["modelValue","label"])]),_:1})]),_:1}),l.value.settlementType===1||l.value.settlementType===2?(C(),j(b,{key:0,style:{margin:"0",width:"100%"},gutter:20},{default:r(()=>[a(y,{style:{width:"100%"},prop:"arr"},{default:r(()=>[a(d,{modelValue:l.value.arr,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.arr=o),placeholder:s(t)("recordChange.onlyOne"),type:"textarea",rows:15},null,8,["modelValue","placeholder"])]),_:1})]),_:1})):I("",!0)]),_:1},8,["model","rules"])),[[M,g.value]]),a($,{ref_key:"progressDetailsRef",ref:z},null,512)]),_:1},8,["modelValue","title"])])}}}),ie=Q(se,[["__scopeId","data-v-8838be66"]]);export{ie as default};
