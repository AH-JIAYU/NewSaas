
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as J,r as g,M,a2 as n,a as p,i as y,f as r,w as o,b as m,g as c,h as t,c as i,N as L,O as T,t as S,j as b,a3 as P,aG as C,k as K,ak as Q,ai as k,_ as W,y as X}from"./index-Co_cyy70.js";import{a as v}from"./projectManagement_scheduling-C4aN23QO.js";import{o as q,s as D}from"./apiLoading-L7qezKGR.js";const Y={style:{float:"left"}},Z={style:{float:"center"}},ee={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},te={style:{flex:"auto"}},le=J({name:"Edit",__name:"index",emits:["fetch-data"],setup(ae,{expose:U,emit:A}){const z=A,f=g(),B=M({projectId:[{required:!0,message:"请选择项目",trigger:"change"}],dispatchType:[{required:!0,message:"请选择调度类型",trigger:"change"}],dataType:[{required:!0,message:"请选择调度目标",trigger:"change"}],groupSupplierId:[{required:!0,message:"请选择至少一个",trigger:"change"}],doMoneyPrice:[{required:!0,message:"请输入金额",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}),u=g(!1),e=M({title:"",projectList:[],memberGroupNameInfoList:[],supplierNameInfoList:[],form:{projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},selectAll:{supplier:!1,member:!1}});async function E(s,a){const _=await q(v.getProjectList({}));e.projectList=_.data.getNotDispatchProjectInfoList,a?s.isDispatch===1?k.warning({message:"该项目已经调度，请前往「项目调度」进行编辑",center:!0}):(e.title="调度",e.form.projectId=s.projectId,await h(s.projectId),u.value=!0):(s?(e.title="编辑",e.form=Q(s),await h(s.projectId)):e.title="新增",u.value=!0)}const h=async s=>{if(s){const a=await q(v.getAllocationGroupOrSupplier({projectId:s}));e.memberGroupNameInfoList=a.data.getAllocationMemberGroupNameInfoList,e.supplierNameInfoList=a.data.getAllocationSupplierNameInfoList,e.supplierNameInfoList.length&&!e.memberGroupNameInfoList.length&&(e.form.dataType=1),!e.supplierNameInfoList.length&&e.memberGroupNameInfoList.length&&(e.form.dataType=2)}},R=()=>{e.form.groupSupplierId=[],f.value.clearValidate(["groupSupplierId"])};function j(){f.value.resetFields(),e.form={projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},u.value=!1}function $(){f.value&&f.value.validate(async s=>{if(s){if(e.title==="新增"||e.title==="调度"){const{status:a}=await D(v.create(e.form));a===1&&k.success({message:"新增成功"})}else{const{status:a}=await D(v.edit(e.form));a===1&&k.success({message:"修改成功"})}j(),z("fetch-data")}})}return g(1),g(null),g([]),U({showEdit:E}),(s,a)=>{const _=W,G=n("el-tooltip"),I=n("el-radio"),x=n("el-radio-group"),d=n("el-form-item"),V=n("el-option"),N=n("el-select"),F=n("el-input"),O=n("el-form"),w=n("el-button"),H=n("el-dialog");return p(),y("div",null,[r(H,{modelValue:t(u),"onUpdate:modelValue":a[6]||(a[6]=l=>K(u)?u.value=l:null),title:t(e).title,width:"600","before-close":j},{footer:o(()=>[m("div",te,[r(w,{onClick:j},{default:o(()=>[c(" 取消 ")]),_:1}),r(w,{type:"primary",onClick:$},{default:o(()=>[c(" 确定 ")]),_:1})])]),default:o(()=>[r(O,{ref_key:"formRef",ref:f,"label-width":"130px",style:{position:"relative"},model:t(e).form,rules:t(B),inline:!1},{default:o(()=>[r(d,{label:"调度类型",prop:"dispatchType",style:{"align-items":"center"}},{default:o(()=>[r(x,{modelValue:t(e).form.dispatchType,"onUpdate:modelValue":a[0]||(a[0]=l=>t(e).form.dispatchType=l),class:"ml-4"},{default:o(()=>[r(I,{value:1,size:"large"},{default:o(()=>[m("div",null,[c(" 指定关闭 "),r(G,{class:"tooltips",content:"选中供应商或部门，该供应商或部门无法参与该项目",placement:"top"},{default:o(()=>[r(_,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1})])]),_:1}),r(I,{value:2,size:"large"},{default:o(()=>[c(" 指定价格 "),r(G,{class:"tooltips",content:"举例:(选中供应商为：A供应商；指定价格为：100美元)则，A供应商下参与该项目的会员价格为100美元，无需通过会员等级进行计算",placement:"top"},{default:o(()=>[r(_,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e).title==="新增"?(p(),i(d,{key:0,label:"项目ID/名称",prop:"projectId"},{default:o(()=>[r(N,{placeholder:"",modelValue:t(e).form.projectId,"onUpdate:modelValue":a[1]||(a[1]=l=>t(e).form.projectId=l),clearable:"",disabled:"",filterable:"",onChange:h},{default:o(()=>[(p(!0),y(L,null,T(t(e).projectList,l=>(p(),i(V,{key:l.projectId,label:l.projectName,value:l.projectId},{default:o(()=>[m("span",Y,S(l.projectName),1),m("span",Z,S(l.projectType===1?"内部新增":"租户分配"),1),m("span",ee,S(l.projectId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),P(m("div",null,[P(r(d,{prop:"dataType",label:"调度目标",style:{"align-items":"center"}},{default:o(()=>[r(x,{modelValue:t(e).form.dataType,"onUpdate:modelValue":a[2]||(a[2]=l=>t(e).form.dataType=l),class:"ml-4",onChange:R},{default:o(()=>[r(I,{value:1,size:"large"},{default:o(()=>[c(" 供应商 ")]),_:1}),r(I,{value:2,size:"large"},{default:o(()=>[c(" 部门 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[C,t(e).supplierNameInfoList.length&&t(e).memberGroupNameInfoList.length]]),t(e).supplierNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===1?(p(),i(d,{key:0,label:"供应商",prop:"groupSupplierId"},{default:o(()=>[r(N,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":a[3]||(a[3]=l=>t(e).form.groupSupplierId=l),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:o(()=>[(p(!0),y(L,null,T(t(e).supplierNameInfoList,l=>(p(),i(V,{key:l.projectId,label:l.supplierName,value:l.supplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),t(e).memberGroupNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===2?(p(),i(d,{key:1,label:"部门",prop:"groupSupplierId"},{default:o(()=>[r(N,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":a[4]||(a[4]=l=>t(e).form.groupSupplierId=l),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:o(()=>[(p(!0),y(L,null,T(t(e).memberGroupNameInfoList,l=>(p(),i(V,{key:l.projectId,label:l.memberGroupName,value:l.memberGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0)],512),[[C,t(e).form.projectId]]),t(e).form.dispatchType===2?(p(),i(d,{key:1,label:"指定价格",prop:"doMoneyPrice"},{default:o(()=>[r(F,{placeholder:"",modelValue:t(e).form.doMoneyPrice,"onUpdate:modelValue":a[5]||(a[5]=l=>t(e).form.doMoneyPrice=l),clearable:""},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),pe=X(le,[["__scopeId","data-v-a3efad7a"]]);export{pe as default};
