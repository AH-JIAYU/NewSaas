
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as te,aD as ae,r as s,c as re,a as c,o as m,b as _,f as l,w as a,g as u,i as o,F as ne,t as le,e as x,y as i,z as h,j as C,A as oe,E as N,_ as se,aH as ie,aI as ce,aE as de,L as ue}from"./index-B6wfMZ3d.js";import{a as D}from"./user_cooperation-BoQDm__8.js";import{u as me}from"./index-DCk7MKYR.js";import{a as pe}from"./department-D6Uo8wL5.js";import"./index-BOYrgfAS.js";import"./index-CzLl6cw5.js";const w=I=>(ie("data-v-a23948d7"),I=I(),ce(),I),fe={style:{float:"left",width:"11.25rem"}},ye={style:{float:"center","margin-left":"55px"}},ge={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"0.8125rem"}},ve={key:0},_e={key:1},he={key:2},Ie={style:{display:"flex","align-items":"center"}},be=w(()=>i("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),Ue=w(()=>i("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),Te={style:{"margin-top":"6px","margin-bottom":"0px"}},ke={style:{display:"flex","flex-direction":"column"}},xe={style:{display:"flex","align-items":"center"}},Ce=w(()=>i("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),Ne=w(()=>i("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),we=te({__name:"index",emits:["fetch-data"],setup(I,{expose:q,emit:B}){const V=ae(),R=V.currencyType,b=s();s();const F=B,f=s(!1);s(""),s(1);const P=s(),j=s(),A={children:"children",label:"name"},t=s({form:{},tenantUserList:[],tenantStaffList:[],chargeUserId:null,departmentId:null,chargeUserName:"",rules:{beInvitationTenantId:[{required:!0,message:"请选择合作商",trigger:"change"}],priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(r,e,d)=>{if(/^(100|[1-9]?\d)$/.test(e)==!1)return d(new Error("请输入 0 到 100 之间的数字"));d()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),S=s([]);s();async function K(){t.value.form.exchangeRate=V.originalExchangeRate,t.value.form.chargeUserId="",await J(),f.value=!0;const r=await pe.list({name:""});r.data&&(S.value=r.data)}const O=(r,e)=>{e?(P.value.getCheckedKeys().forEach(v=>{v!==r.id&&P.value.setChecked(v,!1)}),t.value.form.chargeUserId=r.id,t.value.form.chargeUserName=r.name):(t.value.form.chargeUserId=[t.value.form.chargeUserId].filter(d=>d!==r.id),t.value.form.chargeUserId.length==0&&(t.value.form.chargeUserId="")),t.value.form.chargeUserId||(t.value.form.chargeUserName="")};async function J(){const r=await D.getTenantUserList({});t.value.tenantUserList=r.data.tenantUserInfoList}const E=re(()=>{const r=t.value.tenantUserList.find(e=>e.tenantId===t.value.form.beInvitationTenantId);return r?(b.value=r.currencyType,t.value.form.tenantName=r.tenantName,t.value.form.phoneOrEmail=de.local.get("account"),[r]):[]});function L(){f.value=!1,t.value.form={},j.value.resetFields()}async function Y(){j.value.validate(r=>{if(r){let e=JSON.parse(JSON.stringify(t.value.form));if(R===b.value&&(e.exchangeRate=1),R===1?e.currencyType="USD":R===2&&(e.currencyType="CNY"),b.value===1?e.beCurrencyType="USD":b.value===2&&(e.beCurrencyType="CNY"),Array.isArray(e.chargeUserId)&&(e.chargeUserId=e.chargeUserId[0]),e.receiveProjectType==1&&!e.chargeUserId){N.warning({message:"请选择部门",center:!0});return}if(!e.exchangeRate){N.warning({message:"请先设置汇率",center:!0});return}e.invitationType=2,e.receiveProjectType==2&&(t.value.form.chargeUserId=null,t.value.form.chargeUserName="",e.chargeUserId=null,e.chargeUserName="",e.invitationType=""),e.invitationType=2,D.addInvitationBind(e).then(d=>{d.status==-1?N.success({message:d.error,center:!0}):(N.success({message:"发送成功",center:!0}),F("fetch-data"),L())})}})}q({showEdit:K});const H=s();function M(r){t.value.form.chargeUserId=r.chargeUserId,t.value.form.invitationType=r.invitationType,t.value.form.chargeUserName=r.chargeUserName}const U=s(null),y=s(null),g=(r,e)=>{e&&(r==="发送"?(U.value=e,t.value.form.sendProjectType=e):(y.value=e,t.value.form.receiveProjectType=e))},G=()=>{U.value=null,y.value=null,t.value.form.sendProjectType=null,t.value.form.receiveProjectType=null};return(r,e)=>{const d=c("el-option"),v=c("el-select"),T=c("el-form-item"),Q=c("el-input"),k=c("el-table-column"),W=c("el-table"),$=se,z=c("el-tooltip"),p=c("el-button"),X=c("el-tree-select"),Z=c("ElForm"),ee=c("el-dialog");return m(),_("div",null,[l(ee,{modelValue:o(f),"onUpdate:modelValue":e[8]||(e[8]=n=>oe(f)?f.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"邀约公司",class:"yaoyueDrawer",onClose:G},{footer:a(()=>[l(p,{onClick:L},{default:a(()=>[u(" 关闭 ")]),_:1}),l(p,{type:"primary",onClick:Y},{default:a(()=>[u(" 发送邀约 ")]),_:1})]),default:a(()=>[l(Z,{ref_key:"formRef",ref:j,rules:o(t).rules,model:o(t).form,"label-width":"7rem",labelPosition:"left",class:"hezuoDrawer"},{default:a(()=>[l(T,{label:"公司名称",prop:"beInvitationTenantId"},{default:a(()=>[l(v,{modelValue:o(t).form.beInvitationTenantId,"onUpdate:modelValue":e[0]||(e[0]=n=>o(t).form.beInvitationTenantId=n),clearable:""},{default:a(()=>[(m(!0),_(ne,null,le(o(t).tenantUserList,n=>(m(),x(d,{key:n.tenantId,value:n.tenantId,label:n.tenantName},{default:a(()=>[i("span",fe,h(n.tenantName),1),i("span",ye,h(n.currencyType===1?"美元":"人民币"),1),i("span",ge,h(n.tenantId),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(t).form.beInvitationTenantId?(m(),x(T,{key:0,label:"价格比例",prop:"priceRatio"},{default:a(()=>[l(Q,{modelValue:o(t).form.priceRatio,"onUpdate:modelValue":e[1]||(e[1]=n=>o(t).form.priceRatio=n),clearable:"",placeholder:"请输入0-100之间的数字"},{append:a(()=>[u("%")]),_:1},8,["modelValue"])]),_:1})):C("",!0),o(E).length?(m(),x(W,{key:1,data:o(E),stripe:"",style:{"margin-bottom":"18px"}},{default:a(()=>[l(k,{prop:"name",label:"用户名"}),l(k,{prop:"tenantName",label:"公司名称"}),l(k,{prop:"country",label:"区域"}),l(k,{width:"200",label:"电子邮箱/手机号"},{default:a(({row:n})=>[n.phone?(m(),_("span",ve,h(n.phone),1)):(m(),_("span",_e,h(n.email),1))]),_:1})]),_:1},8,["data"])):C("",!0),o(t).form.beInvitationTenantId?(m(),_("div",he,[l(T,{prop:"sendProjectType","label-width":"7rem",style:{display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[i("span",Ie,[l(z,{effect:"dark",placement:"top-start"},{content:a(()=>[be,Ue]),default:a(()=>[l($,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),u(" 发送项目 ")])]),default:a(()=>[i("div",Te,[l(p,{type:o(U)===1?"primary":"",size:"small",onClick:e[2]||(e[2]=n=>g("发送",1))},{default:a(()=>[u("自动 ")]),_:1},8,["type"]),l(p,{type:o(U)===2?"primary":"",size:"small",onClick:e[3]||(e[3]=n=>g("发送",2))},{default:a(()=>[u("手动")]),_:1},8,["type"])])]),_:1}),i("div",ke,[l(T,{prop:"receiveProjectType","label-width":"7rem",style:{"margin-right":"1.5625rem",display:"flex","flex-wrap":"nowrap","flex-direction":"column"}},{label:a(()=>[i("span",xe,[l(z,{effect:"dark",placement:"top-start"},{content:a(()=>[Ce,Ne]),default:a(()=>[l($,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),u(" 接收项目 ")])]),default:a(()=>[i("div",null,[l(p,{type:o(y)===1?"primary":"",size:"small",onClick:e[4]||(e[4]=n=>g("接收",1))},{default:a(()=>[u("自动 ")]),_:1},8,["type"]),l(p,{type:o(y)===2?"primary":"",size:"small",onClick:e[5]||(e[5]=n=>g("接收",2))},{default:a(()=>[u("手动")]),_:1},8,["type"]),l(p,{type:o(y)===3?"primary":"",size:"small",onClick:e[6]||(e[6]=n=>g("拒绝",3))},{default:a(()=>[u("拒绝")]),_:1},8,["type"])])]),_:1}),o(t).form.receiveProjectType==1?(m(),x(X,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:P,modelValue:o(t).form.chargeUserId,"onUpdate:modelValue":e[7]||(e[7]=n=>o(t).form.chargeUserId=n),data:o(S),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",style:{width:"15.625rem"},props:A,onCheckChange:O,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["modelValue","data"])):C("",!0)])])):C("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),l(me,{ref_key:"userRef",ref:H,onUserData:M},null,512)])}}}),$e=ue(we,[["__scopeId","data-v-a23948d7"]]);export{$e as default};
