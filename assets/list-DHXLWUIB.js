
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as w,d as me,aN as pe,r as o,n as de,a as u,q as ge,o as s,b as D,f as l,w as a,g as i,s as fe,e as c,i as v,aM as _e,y as $,z as d,N as A,j as p,F,E as N,bb as ve,bc as be,be as he,an as ye,L as Se}from"./index-C9n1rX8T.js";import{_ as ze}from"./index-DPrVJsSZ.js";import{_ as Ce}from"./index.vue_vue_type_style_index_0_lang-BzkF9ONo.js";import{_ as ke}from"./index-A1o33NnT.js";import"./index-BvIhVChz.js";import"./index.vue_vue_type_script_setup_true_lang-CjldkkOy.js";import"./sortable.esm-C0-Qcoum.js";const P={queryOrganizationalStructureSettlementRecordList:g=>w.post("financial-record/queryOrganizationalStructureSettlementRecordList",g),organizationalStructureSettlement:g=>w.post("organizationalStructure/organizationalStructureSettlement",g),organizationalStructureSettlementUpdate:g=>w.post("organizationalStructure/organizationalStructureSettlementUpdate",g)},Te={class:"copyId tableSmall"},Le={class:"id oneLine projectId fontColor"},Ee=me({name:"PMSettlement",__name:"list",setup(g){const{getParams:M,pagination:f,onSizeChange:O,onCurrentChange:q}=pe(),V=o(""),y=o(!0);o();const z=o(!1),m=o([]),C=o(!1);o(!1);const k=o("default"),T=o(!1);o([]);const B=[{label:"待支付",value:"PENDING"},{label:"已支付",value:"PAID"},{label:"已拒绝",value:"REJECTED"}],x=o(),j=o("formSearch-PMSettlement"),L=o([{label:"部门ID",prop:"organizationalStructureId",sortable:!0,checked:!0},{label:"部门名称",prop:"name",sortable:!0,checked:!0},{label:"账单日期",prop:"createTime",sortable:!0,checked:!0},{label:"账单金额",prop:"price",sortable:!0,checked:!0},{label:"状态",prop:"status",sortable:!0,checked:!0}]),r=o({organizationalStructureId:"",status:[],time:[],startTime:null,endTime:null}),R=o([]);function J(){Object.assign(r.value,{organizationalStructureId:"",status:[],time:[],startTime:null,endTime:null})}function G(n){O(n).then(()=>b())}function E(n=1){q(n).then(()=>b())}async function b(){try{y.value=!0,r.value.time.length?(r.value.startTime=r.value.time[0],r.value.endTime=r.value.time[1]):(r.value.time=[],r.value.startTime=null,r.value.endTime=null);const n={...M(),...r.value};delete n.time;const t=await P.queryOrganizationalStructureSettlementRecordList(n);R.value=t.result,f.value.total=t.total?Number(t.total):0,y.value=!1}catch{}finally{y.value=!1}}const Q=async()=>{const{status:n,error:t}=await P.organizationalStructureSettlement({});n==1?(N.success({message:"手动结算成功",center:!0}),b()):N.success({message:t,center:!0})};async function U(n,t){(await P.organizationalStructureSettlementUpdate({id:n,status:t})).status===1&&N.success({message:"操作成功"}),b()}de(()=>{L.value.forEach(n=>{n.checked&&m.value.push(n.prop)}),b(),x.value=[{index:1,show:!0,type:"input",modelName:"organizationalStructureId",placeholder:"部门ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"status",placeholder:"状态",option:"status",optionLabel:"label",optionValue:"value",multiple:!0}]});const K={status:()=>B},I=o();function W(n){n?I.value=n.id:I.value=""}return(n,t)=>{const H=ke,X=u("ElDivider"),S=u("el-button"),Y=Ce,Z=ve,ee=be,te=u("el-row"),ae=ze,h=u("el-table-column"),_=u("el-text"),le=he,ne=u("ElTableColumn"),oe=u("el-empty"),se=u("el-table"),re=u("ElPagination"),ie=ye,ue=ge("loading");return s(),D("div",{class:A({"absolute-container":z.value})},[l(ie,null,{default:a(()=>[l(H,{formSearchList:x.value,formSearchName:j.value,onCurrentChange:E,onOnReset:J,model:r.value,formOption:K},null,8,["formSearchList","formSearchName","model"]),l(X,{"border-style":"dashed"}),l(te,{gutter:24},{default:a(()=>[l(Y,null,{default:a(()=>[l(S,{size:"default",type:"primary",onClick:Q},{default:a(()=>[i(" 手动结算 ")]),_:1})]),_:1}),l(ee,null,{default:a(()=>[l(S,{size:"default",onClick:t[0]||(t[0]=()=>{})},{default:a(()=>[i(" 导出 ")]),_:1}),l(Z,{border:C.value,"onUpdate:border":t[1]||(t[1]=e=>C.value=e),tableAutoHeight:z.value,"onUpdate:tableAutoHeight":t[2]||(t[2]=e=>z.value=e),checkList:m.value,"onUpdate:checkList":t[3]||(t[3]=e=>m.value=e),columns:L.value,"onUpdate:columns":t[4]||(t[4]=e=>L.value=e),"line-height":k.value,"onUpdate:lineHeight":t[5]||(t[5]=e=>k.value=e),stripe:T.value,"onUpdate:stripe":t[6]||(t[6]=e=>T.value=e),style:{"margin-left":"12px"},onQueryData:E},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),fe((s(),c(se,{ref_key:"tableSortRef",ref:V,style:{"margin-top":"10px"},"row-key":"id",data:R.value,border:C.value,size:k.value,stripe:T.value,"highlight-current-row":"",onCurrentChange:W},{empty:a(()=>[l(oe,{image:v(_e),"image-size":300},null,8,["image"])]),default:a(()=>[m.value.includes("organizationalStructureId")?(s(),c(h,{key:0,"show-overflow-tooltip":"",align:"left",label:"部门ID"},{default:a(({row:e})=>[$("div",Te,[$("div",Le,d(e.organizationalStructureId?e.organizationalStructureId:"-"),1),l(ae,{content:e.organizationalStructureId,class:A({rowCopy:"rowCopy",current:e.id===I.value})},null,8,["content","class"])])]),_:1})):p("",!0),m.value.includes("name")?(s(),c(h,{key:1,prop:"name","show-overflow-tooltip":"",align:"left",label:"部门名称"},{default:a(({row:e})=>[l(_,{class:"fontColor"},{default:a(()=>[i(d(e.name?e.name:"-"),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("createTime")?(s(),c(h,{key:2,prop:"createTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:a(({row:e})=>[l(_,{class:"fontColor"},{default:a(()=>[i(d(e.createTime?e.createTime:"-"),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("price")?(s(),c(h,{key:3,prop:"price","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:a(({row:e})=>[l(_,{class:"fontColor"},{default:a(()=>[l(le),i(d(e.price||0),1)]),_:2},1024)]),_:1})):p("",!0),m.value.includes("status")?(s(),c(ne,{key:4,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:a(({row:e})=>[e.status=="待支付"?(s(),c(_,{key:0,style:{color:"rgb(255, 172, 84)"},class:"oneLine",type:"warning"},{default:a(()=>[i(d(e.status),1)]),_:2},1024)):p("",!0),e.status=="已支付"?(s(),c(_,{key:1,style:{color:"rgb(3, 194, 57)"},class:"oneLine",type:"success"},{default:a(()=>[i(d(e.status),1)]),_:2},1024)):p("",!0),e.status=="已拒绝"?(s(),c(_,{key:2,style:{color:"rgb(251, 104, 104)"},class:"oneLine",type:"danger"},{default:a(()=>[i(d(e.status),1)]),_:2},1024)):p("",!0)]),_:1})):p("",!0),l(h,{align:"left",fixed:"right",label:"操作",width:"170"},{default:a(({row:e})=>[e.status=="待支付"?(s(),D(F,{key:0},[l(S,{size:"small",type:"primary",plain:"",onClick:ce=>U(e.id,"PAID")},{default:a(()=>[i(" 支付 ")]),_:2},1032,["onClick"]),l(S,{size:"small",plain:"",type:"danger",onClick:ce=>U(e.id,"REJECTED")},{default:a(()=>[i(" 拒绝 ")]),_:2},1032,["onClick"])],64)):(s(),D(F,{key:1},[i("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[ue,y.value]]),l(re,{"current-page":v(f).page,total:v(f).total,"page-size":v(f).size,"page-sizes":v(f).sizes,layout:v(f).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:G,onCurrentChange:E},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),Ue=Se(Ee,[["__scopeId","data-v-4ae43c25"]]);export{Ue as default};
