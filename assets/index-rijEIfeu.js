
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{ae as P,r as m,an as F,d as $,k as A,a4 as J,E as U,a as i,l as O,n as y,i as t,o as _,b as w,f as o,w as n,F as T,q as h,e as j,ar as C,g as z,P as G}from"./index-BgFpqt2S.js";import{a as E}from"./department-DrvnwrhY.js";const H=P("undistributedDepartment",()=>{const d=m([]);return{undistributedDepartment:d,getUndistributedDepartment:async()=>{if(d.value.length)return d.value;const{data:p}=await F.undistributedDepartment();return d.value=p.data,p.data}}}),K=H,Q=$({__name:"index",props:["id","row"],setup(d,{expose:x}){const p=d,N=[{label:"完成计提",value:1},{label:"审核计提",value:2},{label:"收款计提",value:3}];K();const v=m([]),u=m(!1),f=m(),e=m({id:p.id,name:"",director:null,remark:"",commissionStatus:null,commission:null,commissionType:null}),g=m(!1);let b="";const V=m({name:[{required:!0,message:"请输入部门名称",trigger:"blur"}],director:[{required:!0,message:"请选择部门主管",trigger:"change"}],commission:[{required:!1,message:"请输入提成比例",trigger:"blur"},{validator:(s,l,r)=>{l?/^\d+(\.\d+)?$/.test(l)?r():r(new Error("请输入有效的数字")):r(new Error("请输入数字"))},trigger:"blur"}]});A(async()=>{J(async()=>{const s=await F.undistributedDepartment();v.value=s.data}),e.value.commissionStatus!==1&&(V.value.commission=[]),e.value.id!==""&&q()});function q(){u.value=!0,e.value=JSON.parse(p.row),b=e.value.userInfo.id,v.value.push(e.value.userInfo),v.value=v.value.reduce((s,l)=>(s.find(r=>r.id===l.id)||s.push(l),s),[]),u.value=!1}const I=s=>{s===b?(b=s,g.value=!0):g.value=!1};return x({submit(){return new Promise(s=>{try{e.value.id===""?f.value&&f.value.validate(l=>{l&&(delete e.value.id,delete e.value.memberCount,e.value.commissionStatus!==1&&(V.value.commission=[],e.value.commission=0,e.value.commissionType=0),u.value=!0,E.create(e.value).then(()=>{u.value=!1,U.success({message:"新增成功",center:!0}),s()}))}):f.value&&f.value.validate(l=>{l&&(u.value=!0,delete e.value.memberCount,e.value.commissionStatus!==1&&(e.value.commission=0,e.value.commissionType=0),e.value.director===b&&delete e.value.director,g.value&&delete e.value.director,E.edit(e.value).then(()=>{u.value=!1,U.success({message:"编辑成功",center:!0}),s()}))})}catch{}finally{setTimeout(()=>{u.value=!1},1e3)}})}}),(s,l)=>{const r=i("el-input"),c=i("el-form-item"),S=i("el-option"),D=i("el-select"),B=i("el-switch"),k=i("el-col"),L=i("el-row"),M=i("ElForm"),R=O("loading");return y((_(),w("div",null,[o(M,{ref_key:"formRef",ref:f,model:t(e),rules:t(V),"label-width":"130px","label-suffix":"："},{default:n(()=>[o(c,{label:"部门名称",prop:"name"},{default:n(()=>[o(r,{modelValue:t(e).name,"onUpdate:modelValue":l[0]||(l[0]=a=>t(e).name=a),placeholder:"请输入部门名称",clearable:"",onChange:l[1]||(l[1]=()=>{})},null,8,["modelValue"])]),_:1}),o(c,{label:"部门主管",prop:"director"},{default:n(()=>[o(D,{modelValue:t(e).director,"onUpdate:modelValue":l[2]||(l[2]=a=>t(e).director=a),"value-key":"",placeholder:"请选择部门主管",clearable:"",filterable:"",onChange:I},{default:n(()=>[(_(!0),w(T,null,h(t(v),a=>(_(),j(S,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(L,{style:{"margin-bottom":"0px"},gutter:20},{default:n(()=>[o(k,{span:8},{default:n(()=>[o(c,{label:"部门提成",prop:"commissionStatus"},{default:n(()=>[o(B,{modelValue:t(e).commissionStatus,"onUpdate:modelValue":l[3]||(l[3]=a=>t(e).commissionStatus=a),"active-text":"启用","inactive-text":"禁用","inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1})]),_:1}),o(k,{span:16},{default:n(()=>[y(o(c,{label:"提成发放规则",prop:"commissionType"},{default:n(()=>[o(D,{modelValue:t(e).commissionType,"onUpdate:modelValue":l[4]||(l[4]=a=>t(e).commissionType=a),"value-key":"",placeholder:"请选择发放提成方式",clearable:"",filterable:""},{default:n(()=>[(_(),w(T,null,h(N,a=>o(S,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},512),[[C,t(e).commissionStatus===1]])]),_:1})]),_:1}),y(o(c,{label:"提成比例",prop:"commission"},{default:n(()=>[o(r,{modelValue:t(e).commission,"onUpdate:modelValue":l[5]||(l[5]=a=>t(e).commission=a),modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:n(()=>[z("%")]),_:1},8,["modelValue"])]),_:1},512),[[C,t(e).commissionStatus===1]]),o(c,{label:"备注"},{default:n(()=>[o(r,{modelValue:t(e).remark,"onUpdate:modelValue":l[6]||(l[6]=a=>t(e).remark=a),type:"textarea",rows:10,placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[R,t(u)]])}}}),Z=G(Q,[["__scopeId","data-v-71d7541e"]]);export{Z as default};
