
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as $}from"./survey_vipGroup-BJnEl4Ab.js";import{a as j}from"./apiLoading-DuUE4E_v.js";import{u as A}from"./survey_vip-k8_FxtQS.js";import{d as H,r as c,a1 as J,c as K,a as s,o as d,e as f,w as t,l as C,f as e,g as L,i as r,b as V,n as M,F as N,E as O,p as P,ak as Q,_ as W}from"./index-CX2PmK0L.js";const X={class:"radius p-2 flex gap-2"},Y={class:"dialog-footer"},Z=H({__name:"index",emits:["fetch-data"],setup(ee,{expose:S,emit:E}){const G=A(),h=E,m=c(!1),g=c([]),b=c("新增会员组"),l=c({memberGroupName:"",groupStatus:1,groupMemberIdList:[],groupLeaderMemberId:""}),_=c({}),F=J({memberGroupName:[{required:!0,message:"请输入会员组名称",trigger:"blur"}],groupStatus:[{required:!0,message:"请选择组状态",trigger:"change"}],groupMemberIdList:[{type:"array",required:!0,message:"请选择至少一个组成员",trigger:"change"}]});async function U(u){u?b.value="编辑会员组":b.value="新增会员组",g.value=await j(G.getNickNameList()),m.value=!0}const B=u=>{const o=l.value.groupMemberIdList.findIndex(I=>I===u.memberId);l.value.groupMemberIdList.splice(o,1)},w=K(()=>{const u=l.value.groupMemberIdList.includes(l.value.groupLeaderMemberId);return l.value.groupLeaderMemberId=u?l.value.groupLeaderMemberId:"",g.value.filter(o=>l.value.groupMemberIdList.includes(o.memberId))});function v(){m.value=!1,_.value.resetFields()}const q=()=>{console.log("save"),_.value&&_.value.validate(async u=>{if(u){if(console.log("form.value",l.value),!l.value.id){const{status:o}=await $.create(l.value);o===1&&Q.success({message:"新增成功",center:!0})}await h("fetch-data"),v()}})};return S({showEdit:U}),(u,o)=>{const I=s("el-input"),p=s("el-form-item"),n=s("el-col"),i=s("el-row"),R=s("el-switch"),k=s("el-option"),x=s("el-select"),z=s("el-tag"),D=s("ElForm"),y=s("el-button"),T=s("el-drawer");return d(),f(T,{modelValue:r(m),"onUpdate:modelValue":o[4]||(o[4]=a=>P(m)?m.value=a:null),size:"50%",title:r(b),onClose:v},{footer:t(()=>[C("div",Y,[e(y,{onClick:v},{default:t(()=>[L(" 取消 ")]),_:1}),e(y,{type:"primary",onClick:q},{default:t(()=>[L(" 确定 ")]),_:1})])]),default:t(()=>[e(D,{ref_key:"formRef",ref:_,rules:r(F),model:r(l),"label-width":"100px"},{default:t(()=>[e(i,{gutter:10},{default:t(()=>[e(n,{span:8},{default:t(()=>[e(p,{label:"会员组名称",prop:"memberGroupName"},{default:t(()=>[e(I,{modelValue:r(l).memberGroupName,"onUpdate:modelValue":o[0]||(o[0]=a=>r(l).memberGroupName=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:8}),e(n,{span:8})]),_:1}),e(i,{gutter:10},{default:t(()=>[e(n,{span:8},{default:t(()=>[e(p,{label:"组状态",prop:"groupStatus"},{default:t(()=>[e(R,{"active-value":2,"inactive-value":1,"active-text":"开启","inactive-text":"关闭","inline-prompt":"",modelValue:r(l).groupStatus,"onUpdate:modelValue":o[1]||(o[1]=a=>r(l).groupStatus=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:8})]),_:1}),e(i,{gutter:10},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(p,{label:"组成员",prop:"groupMemberIdList"},{default:t(()=>[e(x,{multiple:"","collapse-tags":"","collapse-tags-tooltip":"",modelValue:r(l).groupMemberIdList,"onUpdate:modelValue":o[2]||(o[2]=a=>r(l).groupMemberIdList=a),placeholder:"模糊搜索",clearable:""},{default:t(()=>[(d(!0),V(N,null,M(r(g),a=>(d(),f(k,{value:a.memberId,label:a.memberNickname},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{gutter:10},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(p,null,{default:t(()=>[C("div",X,[(d(!0),V(N,null,M(r(w),a=>(d(),f(z,{key:a,closable:"","disable-transitions":!1,onClose:te=>B(a)},{default:t(()=>[L(O(a.memberNickname),1)]),_:2},1032,["onClose"]))),128))])]),_:1})]),_:1})]),_:1}),e(i,{gutter:10},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(p,{label:"组长",prop:"top"},{default:t(()=>[e(x,{modelValue:r(l).groupLeaderMemberId,"onUpdate:modelValue":o[3]||(o[3]=a=>r(l).groupLeaderMemberId=a),placeholder:"模糊搜索"},{default:t(()=>[(d(!0),V(N,null,M(r(w),a=>(d(),f(k,{value:a.memberId,label:a.memberNickname},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),se=W(Z,[["__scopeId","data-v-477fb4c3"]]);export{se as default};
