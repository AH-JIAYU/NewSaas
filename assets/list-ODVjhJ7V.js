
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ue,J as me,aM as ce,y as pe,r as g,n as de,z as P,C as fe,a as c,q as I,o as n,b as M,f as i,w as l,i as a,s as v,e as r,g as f,B as be,aN as he,v as p,A as b,O as D,j as u,F as ge,aO as _e,E as H,aP as ye,aQ as ke,be as ve,ao as Ce,M as Se}from"./index-puGejJ6c.js";import{_ as Le}from"./index-CUmVAZCa.js";import{_ as we}from"./index.vue_vue_type_style_index_0_lang-CZKVSSDz.js";import{_ as Me}from"./index-BTFXVoNN.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-XC0gtW-t.js";import{a as N}from"./index-KjKcOMSI.js";import{u as xe}from"./useTabbar-C-LI7fHV.js";import"./index-SAQW-vwF.js";import"./clipboard-H53ocpNK.js";import"./index.vue_vue_type_script_setup_true_lang-BqyJygVi.js";import"./sortable.esm-C0-Qcoum.js";const Te={key:0,class:"hoverSvg"},ze={class:"fineBom"},Ae={class:"c-fx"},Ee={class:"weightColor"},Be={class:"fontC-System"},Pe={class:"fontC-System"},Ie={class:"fontC-System"},De={class:"fontC-System"},He=ue({name:"billManagement",__name:"list",setup(Fe){const F=me(),{pagination:h,getParams:$,onSizeChange:U,onCurrentChange:V,onSortChange:O}=ce(),R=xe(),x=pe(),T=g(),j=g("formSearch-billManagement"),_=g([{label:"会员ID",prop:"memberId",sortable:!0,checked:!0},{label:"会员名称",prop:"memberName",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税",prop:"taxesFees",sortable:!0,checked:!0},{label:"实际金额",prop:"payAmount",sortable:!0,checked:!0},{label:"支付时间",prop:"payTime",sortable:!0,checked:!0},{label:"账单状态",prop:"billStatus",sortable:!0,checked:!0},{label:"说明",prop:"notes",sortable:!0,checked:!0}]),e=g({loading:!1,tableAutoHeight:!1,border:!0,stripe:!0,lineHeight:"default",checkList:[],formMode:"dialog",formModeProps:{visible:!1,id:""},search:{memberId:"",memberName:"",member:"",billStatus:[]},billStatusList:[{label:"待支付",value:1},{label:"已支付",value:2},{label:"已拒绝",value:3}],batch:{enable:!1,selectionDataList:[]},dataList:[]});function m(){try{e.value.loading=!0;const s={...$(),...e.value.search};e.value.search.member&&(/^\d+$/.test(s.member)?s.memberId=s.member:s.memberName=s.member),N.list(s).then(o=>{e.value.loading=!1,e.value.dataList=o.data.memberBillInfoList,h.value.total=o.data.total})}catch{}finally{e.value.loading=!1}}function Q(){Object.assign(e.value.search,{memberId:"",memberName:"",member:"",billStatus:[]}),m()}function q(s){U(s).then(()=>m())}function z(s=1){V(s).then(()=>m())}function J({prop:s,order:o}){O(s,o).then(()=>m())}function G(){e.value.formMode==="router"?x.settings.tabbar.enable&&x.settings.tabbar.mergeTabsBy!=="activeMenu"?R.open({name:"routerName"}):F.push({name:"routerName"}):(e.value.formModeProps.id="",e.value.formModeProps.visible=!0)}async function A(s,o){o===2?_e.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async y=>{(await N.changestatus({id:s,type:o,notes:y.value})).status===1&&H.success({message:"操作成功"}),m()}):((await N.changestatus({id:s,type:o})).status===1&&H.success({message:"操作成功"}),m())}de(()=>{_.value.forEach(s=>{s.checked&&e.value.checkList.push(s.prop)}),m(),e.value.formMode==="router"&&P.on("get-data-list",()=>{m()}),T.value=[{index:1,show:!0,type:"input",modelName:"memberId",placeholder:"会员ID"},{index:2,show:!0,type:"input",modelName:"memberName",placeholder:"会员姓名"},{index:3,show:!0,type:"select",modelName:"billStatus",placeholder:"账单状态",option:"billStatus",optionLabel:"label",optionValue:"value",multiple:!0}]});const K={billStatus:()=>e.value.billStatusList};fe(()=>{e.value.formMode==="router"&&P.off("get-data-list")});const C=g();function W(s){s?C.value=s.id:C.value=""}return(s,o)=>{const y=Me,E=c("ElDivider"),k=c("el-button"),X=we,Y=ye,Z=ke,ee=c("el-row"),te=Le,B=c("el-text"),d=c("ElTableColumn"),S=ve,L=c("el-tag"),ae=c("el-table-column"),oe=c("el-empty"),le=c("ElTable"),se=c("ElPagination"),ne=Ce,w=I("auth"),re=I("loading");return n(),M("div",{class:D({"absolute-container":a(e).tableAutoHeight})},[i(ne,null,{default:l(()=>[i(y,{formSearchList:a(T),formSearchName:a(j),onCurrentChange:z,onOnReset:Q,model:a(e).search,formOption:K},null,8,["formSearchList","formSearchName","model"]),i(E,{"border-style":"dashed"}),i(ee,null,{default:l(()=>[i(X,null,{default:l(()=>[v((n(),r(k,{size:"default",type:"primary",onClick:G},{default:l(()=>[f(" 新增结算 ")]),_:1})),[[w,"supplierSettlement-get-addMemberSettlement"]])]),_:1}),i(Z,null,{default:l(()=>[i(k,{size:"default"},{default:l(()=>[f(" 导出 ")]),_:1}),i(Y,{border:a(e).border,"onUpdate:border":o[0]||(o[0]=t=>a(e).border=t),tableAutoHeight:a(e).tableAutoHeight,"onUpdate:tableAutoHeight":o[1]||(o[1]=t=>a(e).tableAutoHeight=t),checkList:a(e).checkList,"onUpdate:checkList":o[2]||(o[2]=t=>a(e).checkList=t),columns:a(_),"onUpdate:columns":o[3]||(o[3]=t=>be(_)?_.value=t:null),"line-height":a(e).lineHeight,"onUpdate:lineHeight":o[4]||(o[4]=t=>a(e).lineHeight=t),stripe:a(e).stripe,"onUpdate:stripe":o[5]||(o[5]=t=>a(e).stripe=t),style:{"margin-left":"12px"},onQueryData:m},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),v((n(),r(le,{border:a(e).border,size:a(e).lineHeight,stripe:a(e).stripe,class:"my-4",data:a(e).dataList,"highlight-current-row":"",height:"100%",onSortChange:J,onSelectionChange:o[6]||(o[6]=t=>a(e).batch.selectionDataList=t),onCurrentChange:W},{empty:l(()=>[i(oe,{image:a(he),"image-size":300},null,8,["image"])]),default:l(()=>[a(e).checkList.includes("memberId")?(n(),r(d,{key:0,"show-overflow-tooltip":"",align:"left",prop:"",label:"会员ID",width:"200"},{default:l(({row:t})=>[t.memberId?(n(),M("div",Te,[p("p",ze,b(t.memberId),1),p("span",Ae,[i(te,{content:t.memberId,class:D({rowCopy:"rowCopy",current:t.id===a(C)})},null,8,["content","class"])])])):(n(),r(B,{key:1},{default:l(()=>[f("-")]),_:1}))]),_:1})):u("",!0),a(e).checkList.includes("memberName")?(n(),r(d,{key:1,"show-overflow-tooltip":"",align:"left",prop:"",label:"会员名称/会员姓名",width:"160"},{default:l(({row:t})=>[p("p",Ee,b(t.memberNickname?t.memberNickname:"")+b(t.memberName?"/"+t.memberName:""),1)]),_:1})):u("",!0),a(e).checkList.includes("billTime")?(n(),r(d,{key:2,align:"left",prop:"billTime","show-overflow-tooltip":"",label:"账单日期",width:"180"})):u("",!0),a(e).checkList.includes("billAmount")?(n(),r(d,{key:3,"show-overflow-tooltip":"",align:"left",prop:"billAmount",label:"账单金额"},{default:l(({row:t})=>[p("p",null,[i(S),p("span",Be,b(t.billAmount||0),1)])]),_:1})):u("",!0),a(e).checkList.includes("taxesFees")?(n(),r(d,{key:4,"show-overflow-tooltip":"",align:"left",prop:"taxesFees",label:"税"},{default:l(({row:t})=>[p("p",null,[i(S),p("span",Pe,b(t.taxesFees||0),1)])]),_:1})):u("",!0),a(e).checkList.includes("payAmount")?(n(),r(d,{key:5,"show-overflow-tooltip":"",align:"left",prop:"payAmount",label:"实际金额"},{default:l(({row:t})=>[p("p",null,[i(S),p("span",Ie,b(t.payAmount||0),1)])]),_:1})):u("",!0),a(e).checkList.includes("payTime")?(n(),r(d,{key:6,"show-overflow-tooltip":"",align:"left",prop:"payTime",label:"支付时间",width:"180"},{default:l(({row:t})=>[p("span",De,b(t.payTime?t.payTime:"-"),1)]),_:1})):u("",!0),a(e).checkList.includes("billStatus")?(n(),r(d,{key:7,align:"left","show-overflow-tooltip":"",prop:"",label:"账单状态"},{default:l(({row:t})=>[t.billStatus===1?(n(),r(L,{key:0,type:"warning",effect:"dark",style:{"background-color":"#ffac54"}},{default:l(()=>[f("待支付")]),_:1})):u("",!0),t.billStatus===2?(n(),r(L,{key:1,type:"success",effect:"dark"},{default:l(()=>[f("已支付")]),_:1})):u("",!0),t.billStatus===3?(n(),r(L,{key:2,type:"danger",effect:"dark"},{default:l(()=>[f("已拒绝")]),_:1})):u("",!0)]),_:1})):u("",!0),a(e).checkList.includes("notes")?(n(),r(d,{key:8,"show-overflow-tooltip":"",align:"left",prop:"notes",label:"说明"},{default:l(({row:t})=>[i(B,{class:"fontC-System"},{default:l(()=>[f(b(t.notes?t.notes:"-"),1)]),_:2},1024)]),_:1})):u("",!0),i(ae,{align:"left",prop:"i",label:"操作",fixed:"right","show-overflow-tooltip":"",width:"260"},{default:l(({row:t})=>[t.billStatus===1?(n(),M(ge,{key:0},[v((n(),r(k,{size:"small",plain:"",type:"primary",onClick:ie=>A(t.id,1)},{default:l(()=>[f(" 支付 ")]),_:2},1032,["onClick"])),[[w,"billManagement-insert-updateMemberBill"]]),v((n(),r(k,{size:"small",plain:"",type:"danger",onClick:ie=>A(t.id,2)},{default:l(()=>[f(" 拒绝支付 ")]),_:2},1032,["onClick"])),[[w,"billManagement-insert-updateMemberBill"]])],64)):u("",!0)]),_:1})]),_:1},8,["border","size","stripe","data"])),[[re,a(e).loading]]),i(se,{"current-page":a(h).page,total:a(h).total,"page-size":a(h).size,"page-sizes":a(h).sizes,layout:a(h).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:q,onCurrentChange:z},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),a(e).formMode==="dialog"||a(e).formMode==="drawer"?(n(),r(Ne,{key:0,id:a(e).formModeProps.id,modelValue:a(e).formModeProps.visible,"onUpdate:modelValue":o[7]||(o[7]=t=>a(e).formModeProps.visible=t),mode:a(e).formMode,onSuccess:m},null,8,["id","modelValue","mode"])):u("",!0)],2)}}}),We=Se(He,[["__scopeId","data-v-8a669088"]]);export{We as default};
