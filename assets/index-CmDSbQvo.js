
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as S,s as H}from"./apiLoading-BGqjDqsh.js";import{a as x}from"./projectManagement-C80-5JIh.js";import{U as O}from"./user_supplier-CXvI4nQd.js";import{u as J}from"./survey_vipGroup-DReuQN62.js";import{d as K,r as f,l as Q,a as p,ao as W,o as u,b as I,f as r,w as o,C as X,g as s,al as Y,e as n,i as l,j as L,F as k,n as A,G as Z,E as $,P as ee}from"./index-BKR3oNc4.js";import"./user_supplier-Cd7xk6Vf.js";import"./survey_vipGroup-BOk8I9H3.js";const le={style:{flex:"auto"}},oe=K({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(te,{expose:j,emit:G}){const T=O(),C=J(),U=G,d=f(!1),_=f(),e=f({title:"分配",list:[],tenantSupplierList:[],vipGroupList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[]},selectAll:{supplier:!1,member:!1}}),N=f({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择至少一项"}]});async function E(i,a){if(e.value.list=[{...i}],a==="reassign"){e.value.title="重新分配";const m=await S(x.getProjectAllocation({projectId:i.projectId})),{groupSupplierIdSet:v,...c}=m.data;e.value.form=c,e.value.form.groupSupplierIdList=v}else e.value.title="分配",e.value.form.projectId=i.projectId;e.value.tenantSupplierList=await S(T.getTenantSupplierList(i.projectId)),e.value.vipGroupList=await S(C.getGroupNameList()),d.value=!0}function B(){e.value.form.groupSupplierIdList=[]}function R(){e.value.form.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(i=>{e.value.form.groupSupplierIdList.push(i.tenantSupplierId)})}function z(){e.value.form.groupSupplierIdList=[],e.value.selectAll.member&&e.value.vipGroupList.map(i=>{e.value.form.groupSupplierIdList.push(i.memberGroupId)})}function g(){_.value.resetFields(),Object.assign(e.value.form,{projectId:"",allocationType:1,groupSupplierIdList:[]}),d.value=!1}function F(){_.value.validate(async i=>{if(i){const{status:a}=await H(x.allocation(e.value.form));a===1&&$.success({message:"分配成功",center:!0}),g(),U("fetch-data")}})}return Q(async()=>{}),j({showEdit:E}),(i,a)=>{const m=p("el-table-column"),v=p("el-table"),c=p("el-radio"),M=p("el-radio-group"),b=p("el-form-item"),y=p("el-checkbox"),V=p("el-option"),h=p("el-select"),D=p("el-form"),w=p("el-button"),P=p("el-dialog"),q=W("loading");return u(),I("div",null,[r(P,{modelValue:l(d),"onUpdate:modelValue":a[5]||(a[5]=t=>Z(d)?d.value=t:null),title:"分配",width:"700","before-close":g},{footer:o(()=>[X("div",le,[r(w,{type:"primary",onClick:F},{default:o(()=>[s(" 确定 ")]),_:1}),r(w,{onClick:g},{default:o(()=>[s(" 取消 ")]),_:1})])]),default:o(()=>[Y((u(),n(v,{data:l(e).list,"row-key":"id"},{default:o(()=>[r(m,{align:"center","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),r(m,{align:"center","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),r(m,{align:"center","show-overflow-tooltip":"",label:"客户简称",prop:"clientName"})]),_:1},8,["data"])),[[q,!1]]),r(D,{ref_key:"formRef",ref:_,"label-width":"80px",rules:l(N),model:l(e).form,inline:!1},{default:o(()=>[r(b,{label:"分配目标"},{default:o(()=>[r(M,{modelValue:l(e).form.allocationType,"onUpdate:modelValue":a[0]||(a[0]=t=>l(e).form.allocationType=t),class:"ml-4",onChange:B},{default:o(()=>[r(c,{value:2,size:"large"},{default:o(()=>[s(" 供应商 ")]),_:1}),r(c,{value:3,size:"large"},{default:o(()=>[s(" 会员组 ")]),_:1}),l(e).title==="重新分配"?(u(),n(c,{key:0,value:4,size:"large"},{default:o(()=>[s(" 取消分配 ")]),_:1})):L("",!0)]),_:1},8,["modelValue"])]),_:1}),l(e).form.allocationType===2&&l(e).form.allocationType!==4?(u(),n(b,{key:0,label:"供应商",prop:"groupSupplierIdList"},{default:o(()=>[r(h,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[2]||(a[2]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择供应商",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:o(()=>[r(y,{modelValue:l(e).selectAll.supplier,"onUpdate:modelValue":a[1]||(a[1]=t=>l(e).selectAll.supplier=t),onChange:R,style:{display:"flex",height:"unset"}},{default:o(()=>[s("全选")]),_:1},8,["modelValue"])]),default:o(()=>[(u(!0),I(k,null,A(l(e).tenantSupplierList,t=>(u(),n(V,{label:t.supplierAccord,value:t.tenantSupplierId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):L("",!0),l(e).form.allocationType===3&&l(e).form.allocationType!==4?(u(),n(b,{key:1,label:"会员组",prop:"groupSupplierIdList"},{default:o(()=>[r(h,{modelValue:l(e).form.groupSupplierIdList,"onUpdate:modelValue":a[4]||(a[4]=t=>l(e).form.groupSupplierIdList=t),placeholder:"请选择会员组",clearable:"",filterable:"",multiple:"","collapse-tags":""},{header:o(()=>[r(y,{modelValue:l(e).selectAll.member,"onUpdate:modelValue":a[3]||(a[3]=t=>l(e).selectAll.member=t),onChange:z,style:{display:"flex",height:"unset"}},{default:o(()=>[s("全选")]),_:1},8,["modelValue"])]),default:o(()=>[(u(!0),I(k,null,A(l(e).vipGroupList,t=>(u(),n(V,{label:t.memberGroupName,value:t.memberGroupId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):L("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),de=ee(oe,[["__scopeId","data-v-572807b5"]]);export{de as default};
