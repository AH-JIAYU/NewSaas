
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as N,d as ge,$ as ye,r as n,M as be,l as _e,a as d,al as Ve,am as we,i as o,o as m,b as x,f as t,w as s,G as C,be as Ee,C as U,F as S,n as I,e as v,j as R,g as h,E as F,aK as Pe,aL as xe,P as he,aj as G}from"./index-DQRW2_Vj.js";import{u as Fe}from"./otherFunctions_basicDictionary-Dd8BQ-0o.js";const J={list:()=>N.post("user/getUserInfo"),edit:f=>N.post("user/update",f),uploadAvatar:f=>N.post("user/uploadAvatar",f)},T=f=>(Pe("data-v-67a4147e"),f=f(),xe(),f),Ue=T(()=>U("h2",null,"个人信息",-1)),ke=T(()=>U("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Ne=["src"],Ce=T(()=>U("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),Se="http://47.96.98.102:9100/user/uploadAvatar",Z=ge({name:"personalSetting",__name:"setting",emits:["success"],setup(f,{expose:H,emit:K}){const Y=ye(),q=K,B=Fe(),j=n([]),g=n(!1);be();const L=n(!1),y=n(!1),Q=[{label:"公司",value:"company"},{label:"个人",value:"personal"}],W=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],V=n(),w=n(),e=n({type:"personal",name:"",phone:"15288888888",email:"88888@qq.com",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),p=n({oldPassword:"",password:"",confirmPassword:""}),X=n({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,l,i)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?i():i(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,l,i)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?i():i(new Error("请输入合法手机号"))},trigger:"blur"}]}),ee=n({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(r,l,i)=>{l===p.value.oldPassword?i(new Error("新密码不能与旧密码一致")):i()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(r,l,i)=>{l!==p.value.password?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]}),O=r=>{(r!==e.value.phone||r!==e.value.email)&&(L.value=!0)};function le(){V.value&&V.value.validate(async r=>{if(r){if(g.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,L.value||(delete e.value.phone,delete e.value.email),console.log("userForm.value",e.value),(await J.edit({type:e.value.type})).status===-1)return;q("success"),g.value=!1,F.success({message:"修改成功",center:!0}),_()}})}const ae=Y.token,oe=n({Token:ae}),z=n(""),E=n(!1),b=n([]),te=async(r,l)=>{F.success({message:"删除成功",center:!0})},se=(r,l)=>{console.log("uploadFile",r,"uploadFiles",l)},re=async(r,l)=>{F.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},ue=r=>{z.value=r.url,E.value=!0},ne=()=>{w.value&&w.value.validate(async r=>{if(r){if(g.value=!0,delete p.value.confirmPassword,(await J.edit(p.value)).status===-1)return;q("success"),g.value=!1,F.success({message:"修改成功",center:!0}),_()}})};async function de(r){e.value=r,b.value.push({name:"file",url:e.value.avatar}),y.value=!0}function _(){V.value.resetFields(),w.value.resetFields(),Object.assign(e,{}),b.value=[],Object.assign(p,{}),y.value=!1}return _e(async()=>{j.value=await B.country||await B.getCountry()}),H({showEdit:de}),(r,l)=>{const i=d("el-icon"),k=d("el-upload"),ie=d("el-dialog"),u=d("ElFormItem"),A=d("el-option"),D=d("el-select"),c=d("ElInput"),pe=d("ElOption"),me=d("ElSelect"),P=d("ElButton"),M=d("ElForm"),$=d("ElTabPane"),ce=d("ElTabs"),fe=d("el-drawer"),ve=Ve("loading");return we((m(),x("div",null,[t(fe,{modelValue:o(y),"onUpdate:modelValue":l[14]||(l[14]=a=>C(y)?y.value=a:null),title:"修改用户信息",direction:"rtl","before-close":_,style:{height:"100%"},size:"40%"},{default:s(()=>[t(ce,{"tab-position":"left"},{default:s(()=>[t($,{label:"个人信息",class:"basic"},{default:s(()=>[Ue,t(M,{ref_key:"userFormRef",ref:V,model:o(e),rules:o(X),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:s(()=>[t(u,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[t(k,{"file-list":o(b),"onUpdate:fileList":l[0]||(l[0]=a=>C(b)?b.value=a:null),headers:o(oe),action:Se,"list-type":"picture-card",limit:1,"on-preview":ue,"on-remove":te,"on-success":se,"on-exceed":re},{tip:s(()=>[ke]),default:s(()=>[t(i,{class:"el-icon--upload"},{default:s(()=>[t(o(Ee))]),_:1})]),_:1},8,["file-list","headers"]),t(ie,{modelValue:o(E),"onUpdate:modelValue":l[1]||(l[1]=a=>C(E)?E.value=a:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[U("img",{"w-full":"",src:o(z),alt:"Preview Image"},null,8,Ne)]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"账户类型"},{default:s(()=>[t(D,{modelValue:o(e).type,"onUpdate:modelValue":l[2]||(l[2]=a=>o(e).type=a),"value-key":"",placeholder:"账户类型",clearable:"",filterable:""},{default:s(()=>[(m(),x(S,null,I(Q,a=>t(A,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"用户名"},{default:s(()=>[t(c,{disabled:"",modelValue:o(e).name,"onUpdate:modelValue":l[3]||(l[3]=a=>o(e).name=a),laceholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),t(u,{label:"国家"},{default:s(()=>[t(me,{modelValue:o(e).country,"onUpdate:modelValue":l[4]||(l[4]=a=>o(e).country=a),disabled:""},{default:s(()=>[(m(!0),x(S,null,I(o(j),a=>(m(),v(pe,{label:a.chineseName,value:a.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),t(u,{prop:"",label:"货币类型"},{default:s(()=>[t(D,{modelValue:o(e).currencyType,"onUpdate:modelValue":l[5]||(l[5]=a=>o(e).currencyType=a),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(m(),x(S,null,I(W,a=>t(A,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(e).type==="company"?(m(),v(u,{key:0,label:"公司名称"},{default:s(()=>[t(c,{modelValue:o(e).companyName,"onUpdate:modelValue":l[6]||(l[6]=a=>o(e).companyName=a),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):R("",!0),o(e).type==="company"?(m(),v(u,{key:1,label:"公司税号"},{default:s(()=>[t(c,{modelValue:o(e).taxId,"onUpdate:modelValue":l[7]||(l[7]=a=>o(e).taxId=a),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):R("",!0),o(e).type==="company"?(m(),v(u,{key:2,label:"法人姓名"},{default:s(()=>[t(c,{modelValue:o(e).legalPersonName,"onUpdate:modelValue":l[8]||(l[8]=a=>o(e).legalPersonName=a),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):R("",!0),o(e).country==="CN"?(m(),v(u,{key:3,prop:"phone",label:"手机号码"},{default:s(()=>[t(c,{modelValue:o(e).phone,"onUpdate:modelValue":l[9]||(l[9]=a=>o(e).phone=a),placeholder:"请输入你的手机号码",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})):(m(),v(u,{key:4,prop:"email",label:"电子邮箱"},{default:s(()=>[t(c,{modelValue:o(e).email,"onUpdate:modelValue":l[10]||(l[10]=a=>o(e).email=a),placeholder:"请输入你的电子邮箱",disabled:"",onChange:O},null,8,["modelValue"])]),_:1})),t(u,null,{default:s(()=>[t(P,{onClick:le,type:"primary"},{default:s(()=>[h(" 保存 ")]),_:1}),t(P,{onClick:_,type:"primary"},{default:s(()=>[h(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),t($,{label:"账户管理",class:"security"},{default:s(()=>[Ce,t(M,{ref_key:"accountFormRef",ref:w,model:o(p),rules:o(ee),"label-width":"120px","label-suffix":"："},{default:s(()=>[t(u,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[t(c,{modelValue:o(p).oldPassword,"onUpdate:modelValue":l[11]||(l[11]=a=>o(p).oldPassword=a),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),t(u,{prop:"password",label:"新密码"},{default:s(()=>[t(c,{modelValue:o(p).password,"onUpdate:modelValue":l[12]||(l[12]=a=>o(p).password=a),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),t(u,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[t(c,{modelValue:o(p).confirmPassword,"onUpdate:modelValue":l[13]||(l[13]=a=>o(p).confirmPassword=a),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(P,{onClick:ne,type:"primary"},{default:s(()=>[h(" 保存 ")]),_:1}),t(P,{onClick:_,type:"primary"},{default:s(()=>[h(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[ve,o(g)]])}}});typeof G=="function"&&G(Z);const Ie=he(Z,[["__scopeId","data-v-67a4147e"]]),je=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{J as a,je as b,Ie as s};
