
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as P}from"./group_team-D0_0V3aw.js";import{a as re}from"./department-DRdbG0Lf.js";import{u as de}from"./department-DXmE4JFG.js";import{u as ue}from"./configuration_manager-BSObqRt3.js";import{d as ie,aN as ce,r as m,k as me,a as _,p as fe,q as pe,o as s,b as g,f as t,w as e,s as N,g as f,F as I,t as k,e as c,H as v,j as y,E as $,aJ as _e,aK as ve,R as he}from"./index-Ke106btl.js";const J=C=>(_e("data-v-5a83f7fa"),C=C(),ve(),C),be=J(()=>N("div",{class:"card-header"},[N("span",null,"组长")],-1)),ge=J(()=>N("div",{class:"card-header"},[N("span",null,"组员")],-1)),Ie={style:{flex:"auto"}},ke=ie({name:"Edit",__name:"index",emits:["success"],setup(C,{expose:O,emit:q}){ce();const R=m(),z=m(),G=de(),b=m(),K=ue(),w=m([]),Q=q,U=m(""),W=m(),X=m(!1);m([]);const D=m(),x=m(!1),h=m([]),E=m([]),L=m();m({loading:!1,tableAutoHeight:!1,border:!0,stripe:!1,lineHeight:"default",checkList:[],search:{chineseName:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),m({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1});const p=m({groupId:null,userInfo:[],menuId:[]}),Y={children:"children",label:"name"},T=m({commission:[{validator:(n,u,l)=>{/^[0-9]*[.]?[0-9]+$/.test(u)?l():l(new Error("请输入有效的数字或小数"))},trigger:"blur"}]});async function Z(n){U.value=n!=null&&n.id?"编辑":"新增";const u=JSON.parse(n);p.value.groupId=u.id;const l={page:1,limit:10,groupId:u.id},o=await P.list(l);L.value=o.data.departmentId;const d=await re.createEvery();b.value=d.data.result,b.value=b.value.filter(i=>i.id===L.value),o.data.data.forEach(i=>{var V,S;i.isLeader?E.value.push(i):((S=(V=p.value)==null?void 0:V.menuId)==null||S.push(i.memberId),h.value.push(i))}),x.value=!0}me(async()=>{b.value=await G.getDepartment(),w.value=await K.getStaff(),W.value=new Date});function j(n,u){const l=n.findIndex(o=>o.memberId===u);l!==-1&&n.splice(l,1)}function B(n,u){n.some(l=>l.id===u.id)||n.push(u)}function ee(n){h.value=h.value.filter(l=>l.id!==n.id),R.value.getNode(n.id).checked?n.children&&n.children.length?n.children.forEach(l=>B(h.value,l)):B(h.value,n):n.children&&n.children.length?n.children.forEach(l=>j(h.value,l.id)):j(h.value,n.id)}function ae(){return new Promise(n=>{D.value&&D.value.validate(u=>{if(u){p.value.userInfo=[],delete p.value.menuId;let l=0;E.value.forEach(d=>{d.commission&&(l+=d.commission);let i={userId:d.memberId,commission:d.commission};p.value.userInfo.push(i)}),h.value.forEach(d=>{d.commission&&(l+=d.commission);let i;d.memberId?i={userId:d.memberId,commission:d.commission}:i={userId:d.id,commission:d.commission},p.value.userInfo.push(i)});const o=new Set;if(p.value.userInfo=p.value.userInfo.filter(d=>{const{userId:i}=d;return o.has(i)?!1:(o.add(i),!0)}),l>100){$.warning({message:"提成比例不能超过100",center:!0});return}P.edit(p.value).then(()=>{$.success({message:"操作成功",center:!0}),Q("success"),x.value=!1,n()})}})})}const le=()=>{Object.assign(p.value,{groupId:null,userInfo:[],menuId:[]}),E.value=[],h.value=[]};return O({showEdit:Z}),(n,u)=>{const l=_("el-table-column"),o=_("el-text"),d=_("el-input"),i=_("el-form-item"),V=_("el-form"),S=_("el-empty"),F=_("el-table"),M=_("el-card"),te=_("el-tree"),A=_("el-col"),oe=_("el-row"),H=_("el-button"),ne=_("el-drawer"),se=fe("loading");return pe((s(),g("div",null,[t(ne,{modelValue:x.value,"onUpdate:modelValue":u[2]||(u[2]=a=>x.value=a),title:U.value,onClose:le,size:"60%"},{footer:e(()=>[N("div",Ie,[t(H,{type:"",onClick:u[1]||(u[1]=a=>x.value=!1)},{default:e(()=>[f(" 取消 ")]),_:1}),t(H,{type:"primary",onClick:ae},{default:e(()=>[f(" 确定 ")]),_:1})])]),default:e(()=>[t(M,{class:"box-card"},{header:e(()=>[be]),default:e(()=>[t(F,{data:E.value,border:""},{empty:e(()=>[t(S,{description:"暂无数据"})]),default:e(()=>[t(l,{align:"center",type:"index",label:"序号",width:"80"}),t(l,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"}),t(l,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"用户名"},{default:e(({row:a})=>[a.memberId?(s(!0),g(I,{key:0},k(w.value,r=>(s(),c(o,null,{default:e(()=>[a.memberId===r.id?(s(),c(o,{key:0},{default:e(()=>[f(v(r.name),1)]),_:2},1024)):y("",!0)]),_:2},1024))),256)):(s(),c(o,{key:1},{default:e(()=>[f(v(a.name),1)]),_:2},1024))]),_:1}),t(l,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"姓名"},{default:e(({row:a})=>[a.memberId?(s(!0),g(I,{key:0},k(w.value,r=>(s(),c(o,null,{default:e(()=>[a.memberId===r.id?(s(),c(o,{key:0},{default:e(()=>[f(v(r.name),1)]),_:2},1024)):y("",!0)]),_:2},1024))),256)):(s(),c(o,{key:1},{default:e(()=>[f(v(a.name),1)]),_:2},1024))]),_:1}),t(l,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:a})=>[(s(!0),g(I,null,k(b.value,r=>(s(),c(o,null,{default:e(()=>[L.value===r.id?(s(),c(o,{key:0},{default:e(()=>[f(v(r.name),1)]),_:2},1024)):y("",!0)]),_:2},1024))),256))]),_:1}),t(l,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:a})=>[t(V,{model:a,ref_key:"formRef",ref:D,rules:T.value},{default:e(()=>[t(i,{prop:"commission"},{default:e(()=>[t(d,{modelValue:a.commission,"onUpdate:modelValue":r=>a.commission=r,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[f("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1}),t(M,{class:"box-card"},{header:e(()=>[ge]),default:e(()=>[t(oe,{gutter:20},{default:e(()=>[t(A,{class:"leftData",span:8},{default:e(()=>[t(d,{modelValue:p.value.invoiceAmount,"onUpdate:modelValue":u[0]||(u[0]=a=>p.value.invoiceAmount=a),placeholder:"可输入关键字查找",clearable:""},null,8,["modelValue"]),t(te,{style:{"max-width":"37.5rem","min-height":"20.125rem","margin-top":"20px"},data:b.value,ref_key:"treeRef",ref:R,"show-checkbox":"","node-key":"id","default-checked-keys":p.value.menuId,"default-expanded-keys":p.value.menuId,"default-expand-all":"",props:Y,onCheck:ee},null,8,["data","default-checked-keys","default-expanded-keys"])]),_:1}),t(A,{span:16},{default:e(()=>[t(F,{ref_key:"tableRef",ref:z,data:h.value,border:""},{empty:e(()=>[t(S,{description:"暂无数据"})]),default:e(()=>[t(l,{align:"center","show-overflow-tooltip":"",prop:"memberId",label:"员工ID"},{default:e(({row:a})=>[a.memberId?(s(),c(o,{key:0},{default:e(()=>[f(v(a.memberId),1)]),_:2},1024)):(s(),c(o,{key:1},{default:e(()=>[f(v(a.id),1)]),_:2},1024))]),_:1}),t(l,{align:"center","show-overflow-tooltip":"",prop:"userName",label:"用户名"},{default:e(({row:a})=>[a.memberId?(s(!0),g(I,{key:0},k(w.value,r=>(s(),c(o,null,{default:e(()=>[a.memberId===r.id?(s(),c(o,{key:0},{default:e(()=>[f(v(r.name),1)]),_:2},1024)):y("",!0)]),_:2},1024))),256)):(s(),c(o,{key:1},{default:e(()=>[f(v(a.userName?a.userName:"-"),1)]),_:2},1024))]),_:1}),t(l,{align:"center","show-overflow-tooltip":"",prop:"name",label:"姓名"},{default:e(({row:a})=>[a.memberId?(s(!0),g(I,{key:0},k(w.value,r=>(s(),c(o,null,{default:e(()=>[a.memberId===r.id?(s(),c(o,{key:0},{default:e(()=>[f(v(r.name),1)]),_:2},1024)):y("",!0)]),_:2},1024))),256)):(s(),c(o,{key:1},{default:e(()=>[f(v(a.name),1)]),_:2},1024))]),_:1}),t(l,{align:"center","show-overflow-tooltip":"",prop:"lable",label:"部门"},{default:e(({row:a})=>[(s(!0),g(I,null,k(b.value,r=>(s(),c(o,null,{default:e(()=>[L.value===r.id?(s(),c(o,{key:0},{default:e(()=>[f(v(r.name),1)]),_:2},1024)):y("",!0)]),_:2},1024))),256))]),_:1}),t(l,{align:"center",width:"200",fixed:"right","show-overflow-tooltip":"",label:"提成比例"},{default:e(({row:a})=>[t(V,{model:a,ref_key:"formRef",ref:D,rules:T.value},{default:e(()=>[t(i,{prop:"commission"},{default:e(()=>[t(d,{modelValue:a.commission,"onUpdate:modelValue":r=>a.commission=r,modelModifiers:{number:!0},placeholder:"请输入提成比例",clearable:""},{append:e(()=>[f("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])),[[se,X.value]])}}}),Ne=he(ke,[["__scopeId","data-v-5a83f7fa"]]);export{Ne as default};
