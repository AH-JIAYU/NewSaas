
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as ce}from"./index-CGz0rSyJ.js";import{d as pe,aO as ve,r as b,n as ge,Z as M,a as d,q as me,o as f,b as fe,v,f as l,w as o,g as C,aA as P,s as S,e as I,A as z,az as D,aq as U,i as _,aN as _e,j as V,aP as L,E as N,_ as he,aI as ye,aJ as be,M as Ce,ao as A}from"./index-DFP_ze2i.js";import Ie from"./index-CQayOH06.js";import ke from"./index-CVKoJSqX.js";import we from"./index-CVOy_d_H.js";import{a as k}from"./department-BYxIM0zJ.js";import"./configuration_manager-CugTyjq0.js";import"./tenantDictionary-Du3q7-0R.js";const Ee=w=>(ye("data-v-9ca44787"),w=w(),be(),w),Se={class:"absolute-container"},ze={class:"page-main"},De={class:"custom-tree-node"},Ve=["title"],Le={class:"code"},Ne={class:"actions"},$e={class:"dictionary-container"},xe={class:"dictionary-container"},Be=Ee(()=>v("div",{class:"empty"},"请在左侧新增或选择一个部门",-1)),Te=[Be],G=pe({name:"department",__name:"list",setup(w){const{pagination:g,getParams:Me,onSizeChange:R,onCurrentChange:J,onSortChange:K}=ve(),$=b(),i=b({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),r=b({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",name:""},row:"",loading:!1}),O=b(),t=b({loading:!1,search:{organizationalStructureId:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});async function h(){try{i.value.loading=!0,t.value.search.organizationalStructureId="";const e={...i.value.search},a=await k.list(e);i.value.tree=a.data,i.value.loading=!1}catch{}finally{i.value.loading=!1}}ge(()=>{h()}),M(()=>i.value.search,e=>{$.value.filter(e)});function q(e,a){return e?a.label.includes(e):!0}function j(e){i.value.currentData=e,i.value.dialog.parentId="",i.value.dialog.id="",i.value.dialog.visible=!0}function F(e){r.value.currentData=e,r.value.dialog.parentId=(e==null?void 0:e.id)??"",r.value.dialog.name=(e==null?void 0:e.name)??"",r.value.dialog.id="",r.value.dialog.visible=!0}function Z(e,a){i.value.currentNode=e,i.value.currentData=a,i.value.row=JSON.stringify(a),i.value.dialog.parentId=e.parent.data.id??"",i.value.dialog.id=a.id,i.value.dialog.visible=!0}function H(e,a){L.confirm(`确认删除「${a.name}」吗？`,"确认信息").then(()=>{k.delete({id:a.id}).then(()=>{N.success({message:"删除成功",center:!0});const s=e.parent,y=s.data.children||s.data,c=y.findIndex(E=>E.id===a.id);y.splice(c,1),i.value.tree=[...i.value.tree]})})}function Q(e){g.value.page=1,t.value.search.organizationalStructureId=e.id}M(()=>t.value.search.organizationalStructureId,()=>{u()});async function u(){try{t.value.loading=!0;const e={...t.value.search},a=await k.itemlist(e);t.value.loading=!1,t.value.dataList=a.data,t.value.dataList.forEach(s=>{s.enableLoading=!1}),g.value.total=a.data.length}catch{}finally{t.value.loading=!1}}function W(e){R(e).then(()=>u())}function X(e=1){J(e).then(()=>u())}function Y({prop:e,order:a}){K(e,a).then(()=>u())}function x(e){console.log(1111),t.value.dialog.id="",t.value.dialog.visible=!0,t.value.dialog.level=1,e&&(t.value.dialog.parentId=e.id,t.value.dialog.level=Number(e.level)+1)}function ee(e){console.log("row",e),t.value.row=JSON.stringify(e),t.value.dialog.id=e.id,t.value.dialog.parentId=e.parentId,t.value.dialog.visible=!0}function ae(e){L.confirm(`确认删除「${e.name}」吗？`,"确认信息").then(()=>{k.delete([e.id]).then(()=>{u(),N.success({message:"删除成功",center:!0})})}).catch(()=>{})}function te(e){const a=e.map(s=>s.id);L.confirm(`确认删除选中的 ${e.length} 条数据吗？`,"确认信息").then(()=>{k.delete(a).then(()=>{u(),N.success({message:"删除成功",center:!0})})}).catch(()=>{})}return(e,a)=>{const s=d("ElButton"),y=d("ElButtonGroup"),c=he,E=d("ElInput"),le=d("ElTree"),ie=d("ElScrollbar"),ne=d("ElSpace"),m=d("ElTableColumn"),oe=d("ElTag"),se=d("el-empty"),re=d("ElTable"),de=d("ElPagination"),ue=ce,B=me("loading");return f(),fe("div",Se,[v("div",ze,[l(ue,{"hide-left-side-toggle":""},{leftSide:o(()=>[l(y,{class:"btns"},{default:o(()=>[l(s,{type:"primary",class:"add",onClick:a[0]||(a[0]=n=>j())},{default:o(()=>[C(" 新增部门 ")]),_:1})]),_:1}),l(E,{modelValue:i.value.search.name,"onUpdate:modelValue":a[1]||(a[1]=n=>i.value.search.name=n),placeholder:"请输入关键词筛选",clearable:"",class:"search",onKeydown:P(h,["enter"])},{append:o(()=>[l(s,{onClick:h},{default:o(()=>[l(c,{name:"i-ep:search"})]),_:1})]),_:1},8,["modelValue"]),l(ie,{class:"tree"},{default:o(()=>[S((f(),I(le,{ref_key:"dictionaryRef",ref:$,data:i.value.tree,"filter-node-method":q,"default-expand-all":"",onNodeClick:Q},{default:o(({node:n,data:p})=>[v("div",De,[v("div",{class:"label",title:n.label},z(p.name),9,Ve),v("div",Le,z(p.name),1),v("div",Ne,[l(y,null,{default:o(()=>[l(s,{type:"primary",plain:"",size:"default",onClick:D(T=>F(p),["stop"])},{icon:o(()=>[l(c,{name:"i-ep:plus"})]),_:2},1032,["onClick"]),l(s,{type:"info",plain:"",size:"default",onClick:D(T=>Z(n,p),["stop"])},{icon:o(()=>[l(c,{name:"i-ep:edit"})]),_:2},1032,["onClick"]),l(s,{type:"danger",plain:"",size:"default",onClick:D(T=>H(n,p),["stop"])},{icon:o(()=>[l(c,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["data","filter-node-method"])),[[B,i.value.loading]])]),_:1})]),default:o(()=>[S(v("div",$e,[l(ne,{wrap:""},{default:o(()=>[l(s,{type:"primary",onClick:a[2]||(a[2]=n=>x())},{icon:o(()=>[l(c,{name:"i-ep:plus"})]),_:1}),l(s,{type:"danger",disabled:!t.value.selectionDataList.length,onClick:a[3]||(a[3]=n=>te(t.value.selectionDataList))},{icon:o(()=>[l(c,{name:"i-ep:delete"})]),_:1},8,["disabled"]),l(E,{modelValue:t.value.search.chineseName,"onUpdate:modelValue":a[4]||(a[4]=n=>t.value.search.chineseName=n),placeholder:"请输入关键词筛选",clearable:"",style:{width:"200px"},onKeydown:P(u,["enter"])},null,8,["modelValue"]),l(s,{onClick:u},{icon:o(()=>[l(c,{name:"i-ep:search"})]),_:1})]),_:1}),S((f(),I(re,{ref_key:"dictionaryItemRef",ref:O,data:t.value.dataList,stripe:"","highlight-current-row":"",border:"",height:"100%",onSortChange:Y,onSelectionChange:a[5]||(a[5]=n=>t.value.selectionDataList=n),"row-key":"id","default-expand-all":""},{empty:o(()=>[l(se,{image:_(_e),"image-size":300},null,8,["image"])]),default:o(()=>[l(m,{type:"selection",align:"left",fixed:""}),l(m,{prop:"chineseName",label:"中文名称"}),l(m,{prop:"englishName",label:"英文名称"}),l(m,{prop:"remark",label:"备注"}),l(m,{label:"键值",align:"left",width:"150"},{default:o(n=>[l(oe,{type:"info"},{default:o(()=>[C(z(n.row.code),1)]),_:2},1024)]),_:1}),l(m,{label:"操作",width:"250",align:"left"},{default:o(n=>[l(s,{type:"primary",size:"small",plain:"",onClick:p=>x(n.row)},{default:o(()=>[C(" 新增子项 ")]),_:2},1032,["onClick"]),l(s,{type:"primary",size:"small",plain:"",onClick:p=>ee(n.row)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),l(s,{type:"danger",size:"small",plain:"",onClick:p=>ae(n.row)},{default:o(()=>[C(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,t.value.loading]]),l(de,{"current-page":_(g).page,total:_(g).total,"page-size":_(g).size,"page-sizes":_(g).sizes,layout:_(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:W,onCurrentChange:X},null,8,["current-page","total","page-size","page-sizes","layout"])],512),[[U,t.value.search.organizationalStructureId]]),S(v("div",xe,Te,512),[[U,!t.value.search.organizationalStructureId]])]),_:1}),i.value.dialog.visible?(f(),I(Ie,{key:0,id:i.value.dialog.id,modelValue:i.value.dialog.visible,"onUpdate:modelValue":a[6]||(a[6]=n=>i.value.dialog.visible=n),row:i.value.row,"parent-id":i.value.dialog.parentId,tree:i.value.tree,onGetList:h},null,8,["id","modelValue","row","parent-id","tree"])):V("",!0),r.value.dialog.visible?(f(),I(ke,{key:1,id:r.value.dialog.id,modelValue:r.value.dialog.visible,"onUpdate:modelValue":a[7]||(a[7]=n=>r.value.dialog.visible=n),row:r.value.row,"parent-id":r.value.dialog.parentId,name:r.value.dialog.name,tree:r.value.tree,onGetList:h},null,8,["id","modelValue","row","parent-id","name","tree"])):V("",!0),t.value.dialog.visible?(f(),I(we,{key:2,id:t.value.dialog.id,modelValue:t.value.dialog.visible,"onUpdate:modelValue":a[8]||(a[8]=n=>t.value.dialog.visible=n),"catalogue-id":t.value.search.organizationalStructureId,"parent-id":t.value.dialog.parentId,level:t.value.dialog.level,tree:i.value.tree,dataList:t.value.dataList,row:t.value.row,onSuccess:u},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):V("",!0)])])}}});typeof A=="function"&&A(G);const qe=Ce(G,[["__scopeId","data-v-9ca44787"]]);export{qe as default};
