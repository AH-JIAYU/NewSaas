
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Pe,l as Be,r as c,aM as we,a3 as Oe,c as Ae,n as Ue,a as g,q as He,s as le,o as a,b as L,f as n,w as t,g as i,e as s,i as v,aL as Me,y as d,z as u,N as j,j as r,F as ne,t as Ve,E as ae,b8 as Fe,b9 as Je,bd as qe,_ as Qe,ap as Ge,L as Ke}from"./index-Du40dtBh.js";import{_ as We}from"./index-BwxmH7SA.js";import{_ as Xe}from"./index.vue_vue_type_style_index_0_lang-BpeZ3VQR.js";import{_ as Ye}from"./index-CSVnGH4s.js";import{_ as Ze}from"./index.vue_vue_type_script_setup_true_lang-zO9oxDUa.js";import et from"./index-Icz5Tl_e.js";import{_ as tt}from"./index.vue_vue_type_script_setup_true_lang-golSm1Ig.js";import lt from"./index-CzEzOm0U.js";import nt from"./index-CJw6iYVF.js";import at from"./index-BspOFblZ.js";import{u as ot}from"./user_customer-BG-enzhQ.js";import{u as st}from"./configuration_manager-9ZZ-K2xp.js";import{a as it}from"./project_settlement-CByOcQnq.js";import"./index-B6wQsEz5.js";import"./index.vue_vue_type_script_setup_true_lang-C_1e48jj.js";import"./sortable.esm-C0-Qcoum.js";import"./user_customer-DMZ5-UoN.js";const rt={class:"copyId"},ct={class:"id oneLine tableSmall projectId"},ut={class:"oneLine tableBig"},dt={class:"oneLine"},pt={class:"oneLine"},mt={class:"tableBig"},ft={key:0,class:"oneLine"},_t={class:"tableBig"},yt={class:"flex-c tableBig"},gt={class:"oneLine",style:{width:"calc(100% - 20px)"}},vt={class:"flex-c tableBig"},ht={class:"oneLine",style:{width:"calc(100% - 40px)"}},kt={style:{display:"flex"},class:"oneLine"},bt={class:"flex-c tableBig"},Ct={class:"oneLine",style:{width:"calc(100% - 20px)"}},St=Pe({name:"settlement",__name:"list",setup(It){const M=Be(),V=c(),oe=ot(),F=c(),se=st(),ie=c(),re=c([]),{pagination:b,onSizeChange:ce,onCurrentChange:ue}=we(),de=c(""),S=c(!0),z=c(),J=c(),q=c(),R=c(),Q=c(),G=c(),T=c(!1),$=c(!1),p=c([]);c(!1);const E=c("default"),P=c(!1),I=c([]),B=c([{label:"项目ID",prop:"projectId",sortable:!0,checked:!0},{label:"项目名称",prop:"projectName",sortable:!0,checked:!0},{label:"客户简称/标识",prop:"customerName",sortable:!0,checked:!0},{label:"项目价",prop:"projectAmount",sortable:!0,checked:!0},{label:"所属国家",prop:"countryId",sortable:!0,checked:!0},{label:"系统/审核完成数",prop:"systemDone",sortable:!0,checked:!0},{label:"结算PO号",prop:"settlementPo",sortable:!0,checked:!0},{label:"结算状态",prop:"status",sortable:!0,checked:!0},{label:"节点时间",prop:"nodeTime",sortable:!0,checked:!0},{label:"备注",prop:"remark",sortable:!0,checked:!0}]),K=c(),pe=c("formSearch-settlement"),W=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],h=Oe({page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:"",timeType:"",time:[],startTime:"",endTime:""}),X=c([]);function me(l){I.value=l}const C=c();function fe(l){l?C.value=l.projectId:C.value=""}function _e(l){if(I.value.length)z.value.showEdit(l,I.value);else return ae({message:"请选择至少一条数据",type:"warning"})}function ye(){J.value.showEdit()}function ge(l){if(I.value.length)z.value.showEdit(l,I.value);else return ae({message:"请选择至少一条数据",type:"warning"})}async function Y(l){q.value.showEdit(JSON.stringify(l))}function ve(l){R.value.showEdit(JSON.stringify(l),"")}function w(l,o){R.value.showEdit(JSON.stringify(l),o)}function he(l){Q.value.showEdit(JSON.stringify(l))}function ke(l){ce(l).then(()=>{h.limit=l,k()})}function O(l=1){ue(l).then(()=>{h.page=l,k()})}function be(){Object.assign(h,{page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:"",timeType:"",time:[],startTime:"",endTime:""}),re.value=[],k()}const D=Ae(()=>l=>V.value.filter(N=>l.includes(N.id)).map(N=>N.chineseName));async function k(){try{S.value=!0;const l={...h};Array.isArray(h.countryId)&&(l.countryId=l.countryId.join(",")),h.time&&h.time.length&&(l.beginTime=l.time[0]||"",l.endTime=l.time[1]||""),h.settlementStatus?l.settlementStatus=[l.settlementStatus]:l.settlementStatus=[];const{data:o}=await it.list(l);X.value=o.projectSettlementList,b.value.total=+o.total,S.value=!1}catch{}finally{S.value=!1}}Ue(async()=>{V.value=await M.getCountry(),F.value=await oe.getCustomerList(),ie.value=await se.getStaff(),B.value.forEach(l=>{l.checked&&p.value.push(l.prop)}),k(),K.value=[{index:1,show:!0,type:"input",modelName:"projectId",placeholder:"项目ID"},{index:2,show:!0,type:"input",modelName:"projectName",placeholder:"项目名称"},{index:3,show:!0,type:"input",modelName:"projectIdentification",placeholder:"项目标识"},{index:4,show:!0,type:"select",modelName:"countryData",placeholder:"区域",option:"global",optionLabel:"chineseName",optionValue:"id"},{index:5,show:!0,type:"select",modelName:"customerId",placeholder:"客户简称",option:"customerId",optionLabel:"customerAccord",optionValue:"tenantCustomerId"},{index:6,show:!0,type:"select",modelName:"settlementStatus",placeholder:"结算状态",option:"settlementStatus",optionLabel:"label",optionValue:"value"},{index:8,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"开始日期",endPlaceHolder:"结束日期"}]});const Ce={customerId:()=>F.value,settlementStatus:()=>W,timeType:()=>W};function A(l,o){switch(l){case"auditing":Y(o);break;case"edit":ve(o);break;case"refundDetails":he(o);break}}function x(l){G.value.showEdit(JSON.stringify(l))}return(l,o)=>{const N=Ye,Se=g("ElDivider"),f=g("el-button"),Ie=Xe,xe=Fe,Ne=Je,je=g("el-row"),_=g("el-table-column"),Z=g("el-tooltip"),ee=We,De=qe,U=g("el-tag"),Le=g("el-link"),y=g("el-text"),H=Qe,ze=g("ElSpace"),Re=g("el-empty"),Te=g("el-table"),$e=g("ElPagination"),Ee=Ge,te=He("loading");return le((a(),L("div",{class:j({"absolute-container":T.value})},[n(Ee,null,{default:t(()=>[n(N,{formSearchList:K.value,formSearchName:pe.value,onCurrentChange:O,onOnReset:be,model:h,formOption:Ce},null,8,["formSearchList","formSearchName","model"]),n(Se,{"border-style":"dashed"}),n(je,{gutter:24},{default:t(()=>[n(Ie,null,{default:t(()=>[n(f,{type:"primary",size:"default",onClick:ye},{default:t(()=>[i(" 新增结算 ")]),_:1}),n(f,{type:"primary",size:"default",onClick:o[0]||(o[0]=e=>_e(1))},{default:t(()=>[i(" 开票 ")]),_:1}),n(f,{type:"primary",size:"default",onClick:o[1]||(o[1]=e=>ge(2))},{default:t(()=>[i(" 结算 ")]),_:1})]),_:1}),n(Ne,null,{default:t(()=>[n(f,{size:"default",onClick:o[2]||(o[2]=()=>{})},{default:t(()=>[i(" 导出 ")]),_:1}),n(xe,{border:$.value,"onUpdate:border":o[3]||(o[3]=e=>$.value=e),tableAutoHeight:T.value,"onUpdate:tableAutoHeight":o[4]||(o[4]=e=>T.value=e),checkList:p.value,"onUpdate:checkList":o[5]||(o[5]=e=>p.value=e),columns:B.value,"onUpdate:columns":o[6]||(o[6]=e=>B.value=e),"line-height":E.value,"onUpdate:lineHeight":o[7]||(o[7]=e=>E.value=e),stripe:P.value,"onUpdate:stripe":o[8]||(o[8]=e=>P.value=e),style:{"margin-left":"0.75rem"},onQueryData:O},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),le((a(),s(Te,{ref_key:"tableSortRef",ref:de,style:{"margin-top":"10px"},"row-key":"id",data:X.value,border:$.value,size:E.value,stripe:P.value,"highlight-current-row":"",onSelectionChange:me,onCurrentChange:fe},{empty:t(()=>[n(Re,{image:v(Me),"image-size":300},null,8,["image"])]),default:t(()=>[n(_,{align:"left",type:"selection"}),p.value.includes("projectId")?(a(),s(_,{key:0,prop:"projectId",align:"left",label:"项目"},{default:t(({row:e})=>[d("div",rt,[d("div",ct,[n(Z,{effect:"dark",content:e.projectId,placement:"top-start"},{default:t(()=>[i(u(e.projectId),1)]),_:2},1032,["content"])]),n(ee,{content:e.projectId,class:j({rowCopy:"rowCopy",current:e.projectId===C.value})},null,8,["content","class"])])]),_:1})):r("",!0),p.value.includes("projectName")?(a(),s(_,{key:1,"show-overflow-tooltip":"",prop:"projectName",align:"left",label:"名称/标识"},{default:t(({row:e})=>[d("div",null,[d("b",ut,"名: "+u(e.projectName?e.projectName:"-"),1),d("div",dt," 标: "+u(e.customerName.split("/")[1]!=="null"?e.customerName.split("/")[1]:"-"),1)])]),_:1})):r("",!0),p.value.includes("customerName")?(a(),s(_,{key:2,"show-overflow-tooltip":"",prop:"customerName",align:"left",label:"客户"},{default:t(({row:e})=>[d("div",pt,[d("b",mt,u(e.customerName.split("/")[0]),1),e.projectType!==2?(a(),L("div",ft,[d("span",null,"PM："+u(e.userName),1)])):r("",!0)])]),_:1})):r("",!0),p.value.includes("projectAmount")?(a(),s(_,{key:3,"show-overflow-tooltip":"",align:"left",label:"项目价",width:"80"},{default:t(({row:e})=>[d("div",_t,[n(De),i(u(e.projectAmount||0),1)])]),_:1})):r("",!0),p.value.includes("countryId")?(a(),s(_,{key:4,"show-overflow-tooltip":"",align:"left",label:"区域"},{default:t(({row:e})=>[e.countryId?(a(),L(ne,{key:0},[e.countryId.length>=v(M).country.length?(a(),s(U,{key:0,type:"primary"},{default:t(()=>[i("全球")]),_:1})):v(D)(e.countryId).length>1?(a(),s(Z,{key:1,class:"box-item",effect:"dark",content:v(D)(e.countryId).join(","),placement:"top"},{default:t(()=>[n(Le,{type:"primary"},{default:t(()=>[n(U,{type:"primary"},{default:t(()=>[i("×"+u(v(D)(e.countryId).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])):(a(!0),L(ne,{key:2},Ve(v(D)(e.countryId),m=>(a(),s(U,{key:m,type:"primary"},{default:t(()=>[i(u(m),1)]),_:2},1024))),128))],64)):r("",!0)]),_:1})):r("",!0),p.value.includes("systemDone")?(a(),s(_,{key:5,"show-overflow-tooltip":"",prop:"systemDone",align:"left",label:"系统/审核完成数"},{default:t(({row:e})=>[d("div",yt,[d("div",gt,[n(y,null,{default:t(()=>[i(u(e.systemDone?e.systemDone:0),1)]),_:2},1024),i(" /"),n(y,{class:"mx-1",type:"success"},{default:t(()=>[i(u(e.settlementDone?e.settlementDone:0),1)]),_:2},1024)]),n(H,{onClick:m=>w(e,"systemDone"),class:j({edit:"edit",current:e.projectId===C.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):r("",!0),p.value.includes("settlementDone")?(a(),s(_,{key:6,"show-overflow-tooltip":"",prop:"settlementDone",align:"left",label:"结算完成数"})):r("",!0),p.value.includes("settlementPo")?(a(),s(_,{key:7,"show-overflow-tooltip":"",prop:"settlementPo",align:"left",label:"结算PO号"},{default:t(({row:e})=>[d("div",vt,[d("div",ht,u(e.settlementPo?e.settlementPo:"-"),1),e.settlementPo?(a(),s(ee,{key:0,class:"copy",content:e.settlementPo},null,8,["content"])):r("",!0),n(H,{onClick:m=>w(e,"settlementPo"),class:j({edit:"edit",current:e.projectId===C.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):r("",!0),p.value.includes("status")?(a(),s(_,{key:8,width:"80","show-overflow-tooltip":"",prop:"status",align:"left",label:"状态"},{default:t(({row:e})=>[d("div",kt,[e.status===1?(a(),s(y,{key:0,class:"mx-1 tableBig flex-c"},{default:t(()=>[n(f,{style:{"margin-right":"5px"},size:"small",class:"p-1",type:"warning",onClick:m=>x(e)},{default:t(()=>[i("待审核")]),_:2},1032,["onClick"])]),_:2},1024)):r("",!0),e.status===3?(a(),s(y,{key:1,class:"mx-1 tableBig flex-c"},{default:t(()=>[n(f,{style:{"margin-right":"6px"},size:"small",class:"p-1",type:"success",onClick:m=>x(e)},{default:t(()=>[i("已开票")]),_:2},1032,["onClick"])]),_:2},1024)):r("",!0),e.status===4?(a(),s(y,{key:2,class:"mx-1 tableBig flex-c"},{default:t(()=>[n(f,{style:{"margin-right":"6px"},size:"small",class:"p-1",type:"info",onClick:m=>x(e)},{default:t(()=>[i("已结算")]),_:2},1032,["onClick"])]),_:2},1024)):r("",!0),e.status===2?(a(),s(y,{key:3,class:"mx-1 tableBig flex-c"},{default:t(()=>[n(f,{style:{"margin-right":"6px"},size:"small",class:"p-1",type:"primary",onClick:m=>x(e)},{default:t(()=>[i("已审核")]),_:2},1032,["onClick"])]),_:2},1024)):r("",!0),e.status===5?(a(),s(y,{key:4,class:"mx-1 tableBig flex-c"},{default:t(()=>[n(f,{style:{"margin-right":"6px"},size:"small",class:"p-1",type:"danger",onClick:m=>x(e)},{default:t(()=>[i("已冻结")]),_:2},1032,["onClick"])]),_:2},1024)):r("",!0)])]),_:1})):r("",!0),p.value.includes("nodeTime")?(a(),s(_,{key:9,"show-overflow-tooltip":"",align:"left",label:"时间",width:"160"},{default:t(({row:e})=>[e.status===1?(a(),s(y,{key:0,style:{color:"#333333"}},{default:t(()=>[i(u(e.pendReviewTime),1)]),_:2},1024)):r("",!0),e.status===2?(a(),s(y,{key:1,style:{color:"#333333"}},{default:t(()=>[i(u(e.reviewTime),1)]),_:2},1024)):r("",!0),e.status===3?(a(),s(y,{key:2,style:{color:"#333333"}},{default:t(()=>[i(u(e.invoicedOutTime),1)]),_:2},1024)):r("",!0),e.status===4?(a(),s(y,{key:3,style:{color:"#333333"}},{default:t(()=>[i(u(e.settledTime),1)]),_:2},1024)):r("",!0),e.status===5?(a(),s(y,{key:4,style:{color:"#333333"}},{default:t(()=>[i(u(e.frozenTime),1)]),_:2},1024)):r("",!0)]),_:1})):r("",!0),p.value.includes("remark")?(a(),s(_,{key:10,"show-overflow-tooltip":"",prop:"remark",align:"left",label:"备注"},{default:t(({row:e})=>[d("div",bt,[d("div",Ct,u(e.remark?e.remark:"-"),1),n(H,{onClick:m=>w(e,"remark"),class:j({edit:"edit",current:e.projectId===C.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):r("",!0),n(_,{align:"left",fixed:"right",label:"操作",width:"250"},{default:t(({row:e})=>[n(ze,null,{default:t(()=>[e.status===1?(a(),s(f,{key:0,type:"primary",size:"small",plain:"",onClick:m=>Y(e)},{default:t(()=>[i(" 审核 ")]),_:2},1032,["onClick"])):r("",!0),e.status===5?(a(),s(f,{key:1,type:"primary",size:"small",plain:"",onClick:m=>A("auditing",e)},{default:t(()=>[i(" 重审 ")]),_:2},1032,["onClick"])):r("",!0),n(f,{type:"warning",size:"small",plain:"",onClick:m=>A("edit",e)},{default:t(()=>[i(" 结算编辑 ")]),_:2},1032,["onClick"]),n(f,{type:"danger",size:"small",plain:"",onClick:m=>A("refundDetails",e)},{default:t(()=>[i(" 退款详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","border","size","stripe"])),[[te,S.value]]),n($e,{"current-page":v(b).page,total:v(b).total,"page-size":v(b).size,"page-sizes":v(b).sizes,layout:v(b).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:ke,onCurrentChange:O},null,8,["current-page","total","page-size","page-sizes","layout"]),n(Ze,{onSuccess:k,ref_key:"invoicingRef",ref:z},null,512),n(et,{onSuccess:k,ref_key:"auditingRef",ref:q},null,512),n(tt,{onSuccess:k,ref_key:"editRef",ref:R},null,512),n(lt,{ref_key:"refundRef",ref:Q},null,512),n(at,{ref_key:"StatusDetailRef",ref:G},null,512),n(nt,{onSuccess:k,ref_key:"addSettlementRef",ref:J},null,512)]),_:1})],2)),[[te,S.value]])}}}),Mt=Ke(St,[["__scopeId","data-v-40997f38"]]);export{Mt as default};
