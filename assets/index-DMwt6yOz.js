
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as S,af as P,d as Q,r as x,a as T,o as I,b as y,f as a,w as u,y as t,g as l,z as o,i as d,F as M,t as N,N as b,bs as A,aM as E,j as $,A as F,bd as H,aH as q,aI as w,L as R}from"./index-gQ46oyv3.js";const z={list:_=>S.post("tenantBind/getProjectAllocationList",_),meList:_=>S.post("tenantBind/getProjectMeAllocationList",_),getTenantMeasurementList:_=>S.post("tenantBind/getTenantMeasurementList",_),getQuestionnaireClickList:_=>S.post("tenantBind/getQuestionnaireClickList",_)},U=P("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),J=U,K=_=>(q("data-v-917402d1"),_=_(),w(),_),W={class:"details"},X={class:"details-left"},Y={class:"project box"},Z=K(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),ee=["onClick"],te={class:"item-left"},se={class:"tenant"},ne={key:0,class:"tenantName"},ae={class:"tenantLength"},le={class:"tenantName"},oe={class:"price flex-b"},ie={class:"viewAll"},ce={key:0,class:"details-right"},re={key:0,class:"clickId"},pe={class:"clickIdItem"},ue={class:"clickIdItem-title"},de={class:"supplierName"},_e={class:"clickIdItem-content"},fe={key:1,class:"nodata"},Ie={style:{flex:"auto"}},ye=Q({name:"Edit",__name:"index",setup(_,{expose:O}){const k=J(),v=x(!1);x();const s=x({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function G(c,m=0){const n={linkId:c.linkId,projectId:c.projectId,source:m},f=await z.getTenantMeasurementList(n),i=f.data.tenantMeasurementInfoList;f.data.tenantMeasurementInfo&&i.unshift(f.data.tenantMeasurementInfo);const g=i.findIndex(p=>p.allocationTenantId===f.data.currentTenantId);i.splice(0,g);const h=i.filter(p=>p.type===1),e=i.filter(p=>p.type===2),r=i.filter(p=>p.type===3),L=[...h];if(e.length){const p=e.map(C=>C.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=p,L.push(e[0])}else if(r.length){const p=r.map(C=>C.memberGroupOrSupperId);r[0].length=r.length,r[0].memberGroupOrSupperIdList=p,L.push(r[0])}L.forEach(p=>p.visible=!1),s.value.currentTenantId=f.data.currentTenantId,s.value.tenantMeasurementInfoList=L,v.value=!0}const V=async(c,m)=>{s.value.select=s.value.select===m?"":m,s.value.clickIdList=[];const n={type:c.type,projectId:c.projectId,tenantId:c.allocationTenantId,supplierIdList:c.type===2?c.memberGroupOrSupperIdList:[],memberGroupIdList:c.type===3?c.memberGroupOrSupperIdList:[]},f=await z.getQuestionnaireClickList(n);s.value.clickIdList=B(f.data.questionnaireClickInfoList),c.type===2?s.value.clickIdList=s.value.clickIdList.filter(i=>i.peopleType===2):c.type===3&&(s.value.clickIdList=s.value.clickIdList.filter(i=>i.peopleType===1))};function B(c){return c.reduce((m,n)=>{const{supplierId:f,supplierName:i,projectQuestionnaireClickId:g,surveyStatus:h,price:e,peopleType:r}=n;let L=m.find(p=>p.supplierId===f);return L?L.list.push({projectQuestionnaireClickId:g,surveyStatus:h,price:e}):m.push({supplierId:f,peopleType:r,supplierName:i,list:[{projectQuestionnaireClickId:g,surveyStatus:h,price:e}]}),m},[])}function j(){v.value=!1,s.value={select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]}}function D(){j()}return O({showEdit:G}),(c,m)=>{const n=T("el-text"),f=H,i=T("el-button"),g=T("el-empty"),h=T("el-drawer");return I(),y("div",null,[a(h,{modelValue:d(v),"onUpdate:modelValue":m[0]||(m[0]=e=>F(v)?v.value=e:null),title:"详情",size:"60%","before-close":j},{footer:u(()=>[t("div",Ie,[a(i,{onClick:j},{default:u(()=>[l(" 取消 ")]),_:1}),a(i,{type:"primary",onClick:D},{default:u(()=>[l(" 确定 ")]),_:1})])]),default:u(()=>[t("div",W,[t("div",X,[t("div",Y,[t("div",null,[a(n,{tag:"b"},{default:u(()=>{var e;return[l(o((e=d(s).tenantMeasurementInfoList[0])==null?void 0:e.projectName),1)]}),_:1})]),t("div",null,[a(n,{type:"info"},{default:u(()=>{var e;return[l("ID："+o((e=d(s).tenantMeasurementInfoList[0])==null?void 0:e.projectId),1)]}),_:1})])]),(I(!0),y(M,null,N(d(s).tenantMeasurementInfoList,(e,r)=>(I(),y("div",{class:"link",key:e.allocationTenantId},[Z,t("div",{class:b({"item box":!0,select:r===d(s).select}),onClick:L=>V(e,r)},[t("div",te,[t("div",se,[(e==null?void 0:e.length)>1?(I(),y("p",ne,[l(" 已分配数： "),t("span",ae,o(e==null?void 0:e.length),1),t("span",{class:b("type"+e.type)},o(d(k).typeList[e.type-1]),3)])):(I(),y(M,{key:1},[t("p",null,[t("span",le,o(e.tenantName),1),t("span",{class:b("type"+e.type)},o(d(k).typeList[e.type-1]),3)]),a(n,{type:"info"},{default:u(()=>[l("ID："+o(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",oe,[t("p",null,[l(" 项目价: "),a(f),l(o(e.doMoneyPrice),1)]),t("p",null,[l(" 参数: "),a(n,{size:"large"},{default:u(()=>[l(o(e.participationNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{type:"success",size:"large"},{default:u(()=>[l(o(e.doneNumber||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{type:"warning",size:"large"},{default:u(()=>[l(o(e.num||0),1)]),_:2},1024),a(n,{size:"large"},{default:u(()=>[l(" / ")]),_:1}),a(n,{size:"large"},{default:u(()=>[l(o(e.limitedQuantity||0),1)]),_:2},1024)])])]),t("div",ie,[a(i,{type:"primary",circle:"",size:"small",icon:d(A)},null,8,["icon"])])],10,ee)]))),128))]),d(s).select!==""?(I(),y("div",ce,[d(s).clickIdList.length?(I(),y("div",re,[(I(!0),y(M,null,N(d(s).clickIdList,e=>(I(),y("div",pe,[t("div",ue,[t("div",null,[t("span",de,o(e.supplierName),1),t("span",{class:b("peopleType"+e.peopleType)},o(d(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[a(n,{type:"info"},{default:u(()=>[l("ID： "+o(e.supplierId),1)]),_:2},1024)])]),t("div",_e,[t("ul",null,[(I(!0),y(M,null,N(e.list,r=>(I(),y("li",null,[t("span",null,o(r.projectQuestionnaireClickId),1),t("span",{class:b("surveyStatus"+r.surveyStatus)},o(d(k).surveyStatusList[r.surveyStatus-1]),3)]))),256))])])]))),256))])):(I(),y("div",fe,[a(g,{image:d(E),"image-size":300},null,8,["image"])]))])):$("",!0)])]),_:1},8,["modelValue"])])}}}),me=R(ye,[["__scopeId","data-v-917402d1"]]),ve=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"}));export{z as a,ve as i,me as o,J as u};
