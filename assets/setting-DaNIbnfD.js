
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as F,d as ye,r as n,$ as _e,l as Ve,a as d,al as we,am as Ee,i as l,o as p,b as U,f as o,w as s,Q as Pe,G as S,be as xe,C,F as I,n as T,e as g,j as R,g as k,E as b,aK as he,aL as Ue,P as ke,aj as M}from"./index-DYnJw9TK.js";import{u as Ce}from"./otherFunctions_basicDictionary-7VJqabLB.js";const J={list:()=>F.post("user/getUserInfo"),edit:f=>F.post("user/update",f),uploadAvatar:f=>F.post("user/uploadAvatar",f)},q=f=>(he("data-v-01a1754a"),f=f(),Ue(),f),Ne=q(()=>C("h2",null,"个人信息",-1)),Fe=q(()=>C("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),Se=["src"],Ie=q(()=>C("h2",{style:{"margin-bottom":"30px"}},"账户管理",-1)),Z=ye({name:"personalSetting",__name:"setting",emits:["success"],setup(f,{expose:H,emit:K}){const w=n(!1),Q=_e(),B=K,Y="http://47.96.98.102:9100/user/uploadAvatar",W=Ce(),j=n([]),v=n(!1),z=n(!1),y=n(!1),X=[{label:"公司",value:"company"},{label:"个人",value:"personal"}],ee=[{label:"人民币",value:"CNY"},{label:"美元",value:"USD"}],E=n(),P=n(),e=n({type:"personal",name:"",phone:"15288888888",email:"88888@qq.com",currencyType:"",companyName:"",legalPersonName:"",taxId:""}),m=n({oldPassword:"",password:"",confirmPassword:""}),le=n({supplierName:[{required:!0,trigger:"blur",message:"请输入姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,t,i)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value.email)?i():i(new Error("请输入合法邮箱"))},trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,t,i)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(e.value.phone)?i():i(new Error("请输入合法手机号"))},trigger:"blur"}]}),ae=n({password:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"},{validator:(r,t,i)=>{t===m.value.oldPassword?i(new Error("新密码不能与旧密码一致")):i()},trigger:"blur"}],oldPassword:[{required:!0,trigger:"blur",message:"请输入旧密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(r,t,i)=>{t!==m.value.password?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]}),L=r=>{(r!==e.value.phone||r!==e.value.email)&&(z.value=!0)};function te(){E.value&&E.value.validate(async r=>{if(r){if(v.value=!0,e.value.type==="personal"?(delete e.value.companyName,delete e.value.legalPersonName,delete e.value.taxId,delete e.value.country,delete e.value.avatar):(delete e.value.country,delete e.value.avatar),e.value.country==="CN"?delete e.value.email:delete e.value.phone,z.value||(delete e.value.phone,delete e.value.email),(await J.edit({type:e.value.type})).status===-1)return b.warning({message:"修改失败",center:!0});B("success"),v.value=!1,b.success({message:"修改成功",center:!0}),V()}})}const oe=Q.token,se=n({Token:oe}),O=n(""),x=n(!1),_=n([]),re=async()=>{w.value=!1,b.success({message:"删除成功",center:!0})},ue=()=>{w.value=!0},ne=async()=>{b.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},de=r=>{O.value=r.url,x.value=!0},ie=()=>{P.value&&P.value.validate(async r=>{if(r){if(v.value=!0,delete m.value.confirmPassword,(await J.edit(m.value)).status===-1)return b.warning({message:"修改失败",center:!0});B("success"),v.value=!1,b.success({message:"修改成功",center:!0}),V()}})};async function me(r){e.value=r,_.value.push({name:"file",url:e.value.avatar}),e.value.avatar!==""&&(w.value=!0),y.value=!0}function V(){E.value.resetFields(),P.value.resetFields(),Object.assign(e,{}),_.value=[],Object.assign(m,{}),y.value=!1}return Ve(async()=>{v.value=!0,j.value=await W.getCountry(),v.value=!1}),H({showEdit:me}),(r,t)=>{const i=d("el-icon"),N=d("el-upload"),pe=d("el-dialog"),u=d("ElFormItem"),A=d("el-option"),D=d("el-select"),c=d("ElInput"),ce=d("ElOption"),fe=d("ElSelect"),h=d("ElButton"),$=d("ElForm"),G=d("ElTabPane"),ve=d("ElTabs"),ge=d("el-drawer"),be=we("loading");return Ee((p(),U("div",null,[o(ge,{modelValue:l(y),"onUpdate:modelValue":t[14]||(t[14]=a=>S(y)?y.value=a:null),title:"修改用户信息",direction:"rtl","before-close":V,style:{height:"100%"},size:"40%"},{default:s(()=>[o(ve,{"tab-position":"left"},{default:s(()=>[o(G,{label:"个人信息",class:"basic"},{default:s(()=>[Ne,o($,{ref_key:"userFormRef",ref:E,model:l(e),rules:l(le),"label-width":"120px","el-width":"120px","label-suffix":"："},{default:s(()=>[o(u,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"头像"},{default:s(()=>[o(N,{class:Pe({hide_box:l(w)}),"file-list":l(_),"onUpdate:fileList":t[0]||(t[0]=a=>S(_)?_.value=a:null),headers:l(se),action:Y,"list-type":"picture-card",limit:1,"on-preview":de,"on-remove":re,"on-success":ue,"on-exceed":ne},{tip:s(()=>[Fe]),default:s(()=>[o(i,{class:"el-icon--upload"},{default:s(()=>[o(l(xe))]),_:1})]),_:1},8,["class","file-list","headers"]),o(pe,{modelValue:l(x),"onUpdate:modelValue":t[1]||(t[1]=a=>S(x)?x.value=a:null),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:s(()=>[C("img",{"w-full":"",src:l(O),alt:"Preview Image"},null,8,Se)]),_:1},8,["modelValue"])]),_:1}),o(u,{label:"账户类型"},{default:s(()=>[o(D,{modelValue:l(e).type,"onUpdate:modelValue":t[2]||(t[2]=a=>l(e).type=a),"value-key":"",placeholder:"账户类型",clearable:"",filterable:""},{default:s(()=>[(p(),U(I,null,T(X,a=>o(A,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(u,{label:"用户名"},{default:s(()=>[o(c,{disabled:"",modelValue:l(e).name,"onUpdate:modelValue":t[3]||(t[3]=a=>l(e).name=a),placeholder:"请输入你的用户名"},null,8,["modelValue"])]),_:1}),o(u,{label:"国家"},{default:s(()=>[o(fe,{modelValue:l(e).country,"onUpdate:modelValue":t[4]||(t[4]=a=>l(e).country=a),disabled:""},{default:s(()=>[(p(!0),U(I,null,T(l(j),a=>(p(),g(ce,{label:a.chineseName,value:a.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(u,{prop:"",label:"货币类型"},{default:s(()=>[o(D,{modelValue:l(e).currencyType,"onUpdate:modelValue":t[5]||(t[5]=a=>l(e).currencyType=a),"value-key":"",placeholder:"请选择货币类型",disabled:"",clearable:"",filterable:""},{default:s(()=>[(p(),U(I,null,T(ee,a=>o(A,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(e).type==="company"?(p(),g(u,{key:0,label:"公司名称"},{default:s(()=>[o(c,{modelValue:l(e).companyName,"onUpdate:modelValue":t[6]||(t[6]=a=>l(e).companyName=a),placeholder:"请输入你的公司名称"},null,8,["modelValue"])]),_:1})):R("",!0),l(e).type==="company"?(p(),g(u,{key:1,label:"公司税号"},{default:s(()=>[o(c,{modelValue:l(e).taxId,"onUpdate:modelValue":t[7]||(t[7]=a=>l(e).taxId=a),placeholder:"请输入你的公司税号"},null,8,["modelValue"])]),_:1})):R("",!0),l(e).type==="company"?(p(),g(u,{key:2,label:"法人姓名"},{default:s(()=>[o(c,{modelValue:l(e).legalPersonName,"onUpdate:modelValue":t[8]||(t[8]=a=>l(e).legalPersonName=a),placeholder:"请输入你的法人姓名"},null,8,["modelValue"])]),_:1})):R("",!0),l(e).country==="CN"?(p(),g(u,{key:3,prop:"phone",label:"手机号码"},{default:s(()=>[o(c,{modelValue:l(e).phone,"onUpdate:modelValue":t[9]||(t[9]=a=>l(e).phone=a),placeholder:"请输入你的手机号码",disabled:"",onChange:L},null,8,["modelValue"])]),_:1})):(p(),g(u,{key:4,prop:"email",label:"电子邮箱"},{default:s(()=>[o(c,{modelValue:l(e).email,"onUpdate:modelValue":t[10]||(t[10]=a=>l(e).email=a),placeholder:"请输入你的电子邮箱",disabled:"",onChange:L},null,8,["modelValue"])]),_:1})),o(u,null,{default:s(()=>[o(h,{onClick:te,type:"primary"},{default:s(()=>[k(" 保存 ")]),_:1}),o(h,{onClick:V,type:"primary"},{default:s(()=>[k(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),o(G,{label:"账户管理",class:"security"},{default:s(()=>[Ie,o($,{ref_key:"accountFormRef",ref:P,model:l(m),rules:l(ae),"label-width":"120px","label-suffix":"："},{default:s(()=>[o(u,{prop:"oldPassword",label:"旧密码"},{default:s(()=>[o(c,{modelValue:l(m).oldPassword,"onUpdate:modelValue":t[11]||(t[11]=a=>l(m).oldPassword=a),placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),o(u,{prop:"password",label:"新密码"},{default:s(()=>[o(c,{modelValue:l(m).password,"onUpdate:modelValue":t[12]||(t[12]=a=>l(m).password=a),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(u,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[o(c,{modelValue:l(m).confirmPassword,"onUpdate:modelValue":t[13]||(t[13]=a=>l(m).confirmPassword=a),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(u,null,{default:s(()=>[o(h,{onClick:ie,type:"primary"},{default:s(()=>[k(" 保存 ")]),_:1}),o(h,{onClick:V,type:"primary"},{default:s(()=>[k(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[be,l(v)]])}}});typeof M=="function"&&M(Z);const Te=ke(Z,[["__scopeId","data-v-01a1754a"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{J as a,ze as b,Te as s};
