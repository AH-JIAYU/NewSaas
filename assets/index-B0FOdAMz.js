
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as ne,a as ue}from"./he-Cx_rshqu.js";import{o as B,s as de}from"./apiLoading-BY9he6r_.js";import{a as O}from"./projectManagement-D1KDgZQs.js";import{a as ce}from"./user_cooperation-BqpI6nZw.js";import{a as fe}from"./survey_vip_department-B6Sc9pBw.js";import{U as ge}from"./user_supplier-BPTgtYNi.js";import{u as me}from"./survey_vipGroup-Cj-w1KYO.js";import{d as Ie,r as n,n as ve,a as I,q as Ae,o as u,b as S,f as r,w as s,y as v,g as c,s as Se,i as t,e as T,j as h,F as Y,t as z,A as Le,E as G,aH as he,aI as ye,L as _e}from"./index-DAoDi_gt.js";import"./user_supplier-BBhA9C7f.js";import"./survey_vipGroup-A_-geDUi.js";const D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAS1JREFUKFN1kr8vQ1EUxz+HRl5EYhEaSRMSTBIDo/DKYDCwWVjKZrAYREgaJTF0MJD4kdbSjT/AxAsREgYSo0gs/gDLE1575Op77VV1l3ty7vfzzflxhfC4aY2RYAZhGugBPlAeBPYv5uUx0okJxo+0o9jAKcJw9FBzb3opWTc5cY/VocQVwtA/4ii95qVkywBLKDu2OJ2E8xe4fLWySsAnveLm9K7WPd4C2Qk4vP8DLRvgCyHW1gyDnVVHA80NwIb3CyqIm1cfcPrbYbKvCjQ1wmgXnD1D9rqSL9QtyYgzY+AHkPGgqCEgrBhgEWHXbnp1BH4gW2z24tMt4cJu7MYTrfD2bjmX3cpjNZG7p3EcTuouzoxT2K4szi4lmdcphdnwawTALSUOvAV5inTfDOJhkx1Lf7QAAAAASUVORK5CYII=",be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAklJREFUOE+VlF9Ik2EUxp/HjbZSgoqJZFiLIBeEgoOEiBZ02UAoWFCwdbUNEvKui0CFLrorUHBdaVHQqGiw0V1oRNGFhiGUdtGWDlquMMJs4fpOfPv7fdvrau/d953n/b3nHM55CMWREY8Vfd0+oQwA6AfYUZKlITJPtsRS2V9R56WpXO111v6QeOiCUG4A3Kd6zPAvQ5Er9N6OGnUVoJ6V5u6+SeDyP0CmsIhEWuaWBjkyk9cDFeCfeHiClFAzsLJWgHHLmchgBShPgz7R+EAJ6zoBOI4UQ6sLwMorpYyCi/RG7lMmA3Zx2JMAyo0HDp4G9nuA94+BHj9otRUh+Rzk7V3AdRZIPgNS0wa4pDm75KQkwn6BTJme9YyCre2Q+TuGppQUArDXD/xchcwMm64VstTiwScg9fGonlPXwR17Grdz4xtk+lqNRh5RS4T0cg+ogLL2Efj9w3xpWxu4+xCgBqZ14CYAqxK4/BLIrZmB9l1g1/EtgMg3Bn5ZADbX6zNsP9oIGFyp24pSD+XzGyD33Qy07QT3urcqOUUtEXwI8Nx/l9zqADuPqYEiMRZ3F/eUwK8fgPyGOUOLDXS4lECCAeo7LO7DSVPZJ4fBtuqcK+dnPQN5PmoMZT5lc87CLtdl2dEDdPY3nsPlF0D2XUVDkfO681TNIREaa9ZpyjQRRizeibD+bbavPtdYs45DYByzi0N19lV5reg8t0xmoSxe0hRe1R3GGK5z7EJPJwN2OLb7RLQBkL0ASu4tGQCvKYxhbjFazsoI/AvM0v9Xs8g/iwAAAABJRU5ErkJggg==",b=k=>(he("data-v-197f3acf"),k=k(),ye(),k),je=b(()=>v("span",{class:"icon-class"},[v("img",{src:ne,alt:"",style:{"margin-right":"0.25rem"}}),c(" 供应商")],-1)),ke=b(()=>v("img",{src:D,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Ve={key:1},Ce=b(()=>v("span",{class:"icon-class"},[v("img",{src:be,alt:"",style:{"margin-right":"0.25rem"}}),c(" 调查站")],-1)),xe=b(()=>v("img",{src:D,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Te={key:1},we=b(()=>v("span",{class:"icon-class"},[v("img",{src:ue,alt:"",style:{"margin-right":"0.25rem"}}),c(" 合作商")],-1)),Ee=b(()=>v("img",{src:D,alt:"",style:{"margin-left":"0.25rem"}},null,-1)),Re={key:1},Ue={style:{flex:"auto"}},Pe=Ie({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(k,{expose:Q,emit:J}){const M=ge();me();const F=J,V=n(!1),j=n(!1),w=n(),y=n(),_=n([]),H={children:"children",label:"name"};n([]);const e=n({title:"分配",list:[],tenantSupplierList:[],departmentList:[],tenantList:[],form:{projectId:"",allocationType:1,groupSupplierIdList:[],deleteSet:[]},selectAll:{supplier:!1,member:!1,tenant:!1}}),f=n({projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),g=n({projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),i=n({projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),q=n({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择分配目标"}]}),C=n();async function W(a,l){if(e.value.list=[{...a}],l==="reassign"){e.value.title="重新分配";const m=await B(O.getProjectAllocation({projectId:a.projectId}));e.value.form.projectId=a.projectId;const{getProjectAllocationInfoList:L}=m.data;L.forEach(p=>{p.allocationType===2?g.value={allocationType:p.allocationType,projectId:p.projectId,groupSupplierIdList:p.groupSupplierIdSet}:p.allocationType===3?i.value={allocationType:p.allocationType,projectId:p.projectId,groupSupplierIdList:p.groupSupplierIdSet}:p.allocationType===4&&(f.value={allocationType:p.allocationType,projectId:p.projectId,groupSupplierIdList:p.groupSupplierIdSet},C.value=p.groupSupplierIdSet)})}else e.value.title="分配",e.value.form.projectId=a.projectId,f.value.projectId=a.projectId,g.value.projectId=a.projectId,i.value.projectId=a.projectId;e.value.tenantSupplierList=await B(M.getTenantSupplierList(a.projectId));const A=await fe.list({name:""});e.value.departmentList=A.data;const d=await B(ce.getAllocationBindList({projectId:a.projectId}));_.value=[],e.value.form.groupSupplierIdList&&e.value.form.allocationType===3&&(_.value=e.value.form.groupSupplierIdList),e.value.tenantList=d.data.allocationBindInfoList,j.value=!0}function Z(){f.value.groupSupplierIdList=[],e.value.selectAll.tenant&&e.value.tenantList.map(a=>{f.value.groupSupplierIdList.push(a.beInvitationTenantId)})}function X(){g.value.groupSupplierIdList=[],e.value.selectAll.supplier&&e.value.tenantSupplierList.map(a=>{g.value.groupSupplierIdList.push(a.tenantSupplierId)})}const $=()=>{i.value.groupSupplierIdList=[],e.value.departmentList.forEach(a=>{N(a)}),y.value.setCheckedKeys(i.value.groupSupplierIdList)};function N(a){i.value.groupSupplierIdList.push(a.id),a.children&&a.children.length&&a.children.forEach(l=>{N(l)})}function ee(){i.value.groupSupplierIdList=[],e.value.selectAll.member?($(),y.value.setCheckedKeys(i.value.groupSupplierIdList)):(e.value.selectAll.member=!1,i.value.groupSupplierIdList=[],y.value.setCheckedKeys([]))}const le=(a,l)=>{l?_.value.includes(a.id)||_.value.push(a.id):_.value=_.value.filter(L=>L!==a.id);const A=y.value.getCheckedKeys(),d=y.value.getHalfCheckedKeys(),m=[...A,...d];i.value.groupSupplierIdList=m},E=n(!1),K=n(null),te=(a,l)=>{},ae=()=>{Object.assign(f.value,{projectId:null,allocationType:4,groupSupplierIdList:[],deleteSet:[]}),Object.assign(g.value,{projectId:null,allocationType:2,groupSupplierIdList:[],deleteSet:[]}),Object.assign(i.value,{projectId:null,allocationType:3,groupSupplierIdList:[],deleteSet:[]}),e.value.selectAll.tenant=!1,e.value.selectAll.supplier=!1,e.value.selectAll.member=!1};function R(){w.value.resetFields(),ae(),j.value=!1,E.value=!1,K.value=null}function oe(){w.value.validate(async a=>{if(a)try{V.value=!0;let l={addProjectAllocationInfoList:[]};if(f.value.groupSupplierIdList.length&&(f.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(f.value)),g.value.groupSupplierIdList.length&&(g.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(g.value)),i.value.groupSupplierIdList.length&&(i.value.projectId=e.value.form.projectId,l.addProjectAllocationInfoList.push(i.value)),e.value.title!=="分配")l.addProjectAllocationInfoList.length||(E.value=!0),l.addProjectAllocationInfoList.map(d=>{d.projectId||(d.projectId=e.value.form.projectId),d.allocationType===4&&(d.deleteSet=[],C.value&&C.value.length&&C.value.filter(m=>{d.groupSupplierIdList.map(L=>{m!==L&&d.deleteSet.push(m)})}))});else if(!l.addProjectAllocationInfoList.length){G.warning({message:"至少选择一个分配目标",center:!0});return}E.value&&(l={addProjectAllocationInfoList:[{projectId:e.value.form.projectId,allocationType:5,groupSupplierIdList:[],deleteSet:[]}]}),console.log("params",l);const{status:A}=await de(O.allocation(l));V.value=!1,A===1&&G.success({message:"分配成功",center:!0}),R(),F("fetch-data")}catch{}finally{V.value=!1}})}const U=a=>{};return ve(async()=>{}),Q({showEdit:W}),(a,l)=>{const A=I("el-table-column"),d=I("el-table"),m=I("el-checkbox"),L=I("el-option"),p=I("el-select"),x=I("el-form-item"),se=I("el-tree-select"),P=I("el-button"),re=I("el-form"),ie=I("el-dialog"),pe=Ae("loading");return u(),S("div",null,[r(ie,{modelValue:t(j),"onUpdate:modelValue":l[10]||(l[10]=o=>Le(j)?j.value=o:null),title:t(e).title,width:"700","before-close":R},{footer:s(()=>[v("div",Ue,[r(P,{onClick:R},{default:s(()=>[c(" 取消 ")]),_:1}),r(P,{type:"primary",onClick:oe},{default:s(()=>[c(" 确定 ")]),_:1})])]),default:s(()=>[Se((u(),T(d,{data:t(e).list,"row-key":"id"},{default:s(()=>[r(A,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"name"}),r(A,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),r(A,{align:"left","show-overflow-tooltip":"",label:"客户简称",width:"100",prop:"clientName"})]),_:1},8,["data"])),[[pe,t(V)]]),r(re,{ref_key:"formRef",ref:w,"label-width":"90px",rules:t(q),model:t(e).form,inline:!1,"label-position":"left",prop:"groupSupplierIdList"},{default:s(()=>[r(x,{style:{"margin-top":"1rem"}},{label:s(()=>[je]),default:s(()=>[r(p,{modelValue:t(g).groupSupplierIdList,"onUpdate:modelValue":l[2]||(l[2]=o=>t(g).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[r(m,{modelValue:t(e).selectAll.supplier,"onUpdate:modelValue":l[0]||(l[0]=o=>t(e).selectAll.supplier=o),onChange:X,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantSupplierList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[1]||(l[1]=o=>U("供应商"))},[c(" 请先维护供应商数据 "),ke])):h("",!0),t(g).groupSupplierIdList.length==0&&t(e).tenantSupplierList.length!=0?(u(),S("span",Ve,"请先选择供应商数据")):h("",!0)]),default:s(()=>[(u(!0),S(Y,null,z(t(e).tenantSupplierList,o=>(u(),T(L,{label:o.supplierAccord,key:o.supplierAccord,value:o.tenantSupplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(x,null,{label:s(()=>[Ce]),default:s(()=>[r(se,{ref_key:"treeRef",ref:y,modelValue:t(i).groupSupplierIdList,"onUpdate:modelValue":l[5]||(l[5]=o=>t(i).groupSupplierIdList=o),data:t(e).departmentList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:H,onCheckChange:le,"check-strictly":!0,"check-on-click-node":!0,multiple:!0,"expand-on-click-node":!1,style:{width:"37.625rem"},clearable:"",placeholder:""},{header:s(()=>[r(m,{modelValue:t(e).selectAll.member,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).selectAll.member=o),onChange:ee,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).departmentList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[4]||(l[4]=o=>U("调查站"))},[c(" 请先维护调查站数据 "),xe])):h("",!0),!t(i).groupSupplierIdList.length&&t(e).departmentList.length!=0?(u(),S("span",Te,"请先选择调查站数据")):h("",!0)]),_:1},8,["modelValue","data"])]),_:1}),r(x,null,{label:s(()=>[we]),default:s(()=>[r(p,{modelValue:t(f).groupSupplierIdList,"onUpdate:modelValue":l[8]||(l[8]=o=>t(f).groupSupplierIdList=o),clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":10,placeholder:""},{header:s(()=>[r(m,{modelValue:t(e).selectAll.tenant,"onUpdate:modelValue":l[6]||(l[6]=o=>t(e).selectAll.tenant=o),onChange:Z,style:{display:"flex",height:"unset"}},{default:s(()=>[c("全选")]),_:1},8,["modelValue"])]),prefix:s(()=>[t(e).tenantList.length==0?(u(),S("span",{key:0,class:"prefix-class",onClick:l[7]||(l[7]=o=>U("合作商"))},[c(" 请先维护合作商数据 "),Ee])):h("",!0),t(f).groupSupplierIdList.length==0&&t(e).tenantList.length!=0?(u(),S("span",Re,"请先选择合作商数据")):h("",!0)]),default:s(()=>[(u(!0),S(Y,null,z(t(e).tenantList,o=>(u(),T(L,{label:o.beInvitationTenantName,key:o.beInvitationTenantName,value:o.beInvitationTenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e).title=="重新分配"?(u(),T(x,{key:0},{label:s(()=>[r(P,{type:t(K)===1?"primary":"",onClick:l[9]||(l[9]=o=>te("发送",1)),style:{"border-radius":"1.875rem"}},{default:s(()=>[c(" 取消分配 ")]),_:1},8,["type"])]),_:1})):h("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),Me=_e(Pe,[["__scopeId","data-v-197f3acf"]]);export{Me as default};
