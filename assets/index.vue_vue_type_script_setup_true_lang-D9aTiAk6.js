
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as U,D as P}from"./download-D3JdcDN_.js";import{a as g}from"./projectManagement_materials-RR--h5dE.js";import{d as S,r as d,a as s,o as T,b as Q,f as a,w as e,v as D,g as i,A as v,E as R}from"./index-KFsg0x_i.js";const F={style:{flex:"auto"}},G=["src"],W=S({name:"Details",__name:"index",emits:["fetchData"],setup(H,{expose:L,emit:y}){const b=y,r=d(!1),t=d({showData:{},idList:[],materialUrlList:[]}),w=d(""),u=d(!1),x="https://saas-api.surveysaas.com/api/project/uploadQiniu";async function V(l){t.value.showData=l,r.value=!0,await N(l.materialUrl)}const N=async l=>{l.length&&l.forEach(async o=>{const c=await U.detail({fileName:o.materialUrl});o.url=c.data.fileUrl,o.name=o.materialUrl})},E=l=>{w.value=l.url,u.value=!0},C=async(l,o)=>{l.id?t.value.idList.push(l.id):await U.delete({fileName:l.response.data.qiNiuUrl})},k=()=>{R.warning({message:"上传失败了,换张图片试试吧",center:!0})},I=(l,o)=>{t.value.materialUrlList.push(l.data.qiNiuUrl)};function j(){t.value.showData.materialUrl.forEach(l=>{P(l.url,l.name)})}async function h(){t.value.materialUrlList.length&&await g.create({id:t.value.showData.id,materialUrlList:t.value.materialUrlList}),t.value.idList.length&&await g.deleteMaterialDetails({idList:t.value.idList}),r.value=!1,b("fetchData"),t.value.idList=[],t.value.materialUrlList=[]}return L({showEdit:V}),(l,o)=>{const c=s("el-divider"),m=s("el-text"),f=s("el-form-item"),_=s("el-col"),B=s("el-row"),p=s("el-button"),q=s("el-upload"),z=s("el-form"),A=s("el-dialog"),M=s("el-drawer");return T(),Q("div",null,[a(M,{modelValue:r.value,"onUpdate:modelValue":o[2]||(o[2]=n=>r.value=n),title:"详情",direction:"rtl","before-close":h,size:"40%"},{footer:e(()=>[D("div",F,[a(p,{onClick:h},{default:e(()=>[i(" 关闭 ")]),_:1})])]),default:e(()=>[a(c,{"content-position":"left"}),a(z,{"label-width":"80px",inline:!1},{default:e(()=>[a(B,{gutter:20},{default:e(()=>[a(_,{span:8},{default:e(()=>[a(f,{label:"项目ID"},{default:e(()=>[a(m,null,{default:e(()=>[i(v(t.value.showData.projectId),1)]),_:1})]),_:1})]),_:1}),a(_,{span:8},{default:e(()=>[a(f,{label:"项目名称"},{default:e(()=>[a(m,null,{default:e(()=>[i(v(t.value.showData.projectName),1)]),_:1})]),_:1})]),_:1}),a(_,{span:8},{default:e(()=>[a(f,{label:"会员名称"},{default:e(()=>[a(m,null,{default:e(()=>[i(v(t.value.showData.memberChildName),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(q,{"file-list":t.value.showData.materialUrl,"onUpdate:fileList":o[0]||(o[0]=n=>t.value.showData.materialUrl=n),class:"upload-demo",action:x,"on-preview":E,"on-remove":C,"on-success":I,"on-error":k,"list-type":"picture"},{trigger:e(()=>[a(p,{type:"primary",class:"m-4"},{default:e(()=>[i("上传")]),_:1})]),default:e(()=>[a(p,{type:"primary",onClick:j},{default:e(()=>[i(" 下载 ")]),_:1})]),_:1},8,["file-list"])]),_:1}),a(A,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=n=>u.value=n),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:e(()=>[D("img",{"w-full":"",src:w.value,alt:"Preview Image"},null,8,G)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}});export{W as _};
