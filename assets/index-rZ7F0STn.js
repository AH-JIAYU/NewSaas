
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Q,m as N,r as v,u as W,c as X,n as Y,p as M,a as u,q as Z,o as f,e as h,w as t,f as s,g as V,s as L,i as o,b as z,t as x,F as C,y as _,aG as P,E as U,L as ee}from"./index-C6kbZRUu.js";import{a as q}from"./department-BBN9Sg--.js";const le={class:"user"},ae={class:"mr checkbox-container"},oe={class:"centers mr"},se={class:"center mr"},te={class:"center mr"},ie=Q({__name:"index",props:N({parentId:{default:""},id:{default:""},tree:{},row:{},isClick:{type:Boolean}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:N(["getList","getItmelist"],["update:modelValue"]),setup(B,{emit:R}){const y=v([]),g=B,D=v(!1),j=[{label:"完成计提",value:1},{label:"审核计提",value:2},{label:"结算计提",value:3}],O=[{label:"按项目价",value:1},{label:"按成本价",value:2},{label:"按毛利润",value:3}],p=v(!1),S=R,k=W(B,"modelValue"),A=X(()=>g.id===""?"新增部门":"编辑部门"),F=v([]),I=v(),e=v({parentId:g.parentId,name:"",remark:"",userIdList:[],organizationalStructurePersonList:[],commission:null,commissionTime:null,commissionStatus:2,commissionType:null}),G=v({name:[{required:!0,message:"请输入部门名称"}],commissionType:[{required:!0,message:"请选择计提方式",trigger:"change"}]});async function J(){try{I.value&&await I.value.validate(async i=>{if(i){if(p.value=!0,e.value.organizationalStructurePersonList=[],e.value.commissionStatus===1&&!/^[1-9]\d*$/.test(e.value.commission)){U.warning({message:"提成比例必须是正整数",center:!0}),p.value=!1;return}e.value.commission=e.value.commission?e.value.commission:0,e.value.commissionTime=e.value.commissionTime?e.value.commissionTime:1,e.value.commissionType=e.value.commissionType?e.value.commissionType:1,e.value.userIdList.map(m=>{const c={userId:m};e.value.organizationalStructurePersonList.push(c)});const a={...e.value};delete a.userIdList;let n;e.value.id?n=await q.edit(a):n=await q.create(a);const{status:r}=n;r===1?U.success({message:e.value.id?"编辑成功":"新增成功",center:!0}):U.error("操作失败，请重试"),D.value?(await S("getItmelist"),await S("getList")):await S("getList"),w()}})}catch{}finally{p.value=!1}}function w(){Object.assign(e,{parentId:"",name:"",remark:"",userIdList:[],organizationalStructurePersonList:[],commission:null,commissionTime:null,commissionStatus:2,commissionType:null}),k.value=!1}const $=()=>y.value.filter(i=>{var a;return(a=e.value)==null?void 0:a.userIdList.includes(i.id)});return Y(async()=>{try{if(p.value=!0,g.id){const{id:i,name:a,remark:n,organizationalStructurePersonList:r,commission:m,commissionTime:c,commissionStatus:T,commissionType:E}=JSON.parse(g.row);e.value.id=i,e.value.name=a,e.value.remark=n,D.value=g.isClick,e.value.commission=m,e.value.commissionTime=c,e.value.commissionStatus=T,e.value.commissionType=E;const{data:b}=await M.queryNotEnableStaffList({organizationalStructureId:e.value.id});b&&(y.value=b),e.value.organizationalStructurePersonList=[],r?(r.forEach(d=>{d.enableChargePerson==1&&e.value.organizationalStructurePersonList.push(d)}),e.value.organizationalStructurePersonList.forEach(d=>{e.value.userIdList.push(d.userId)})):e.value.organizationalStructurePersonList=[]}else{const{data:i}=await M.queryAllNotEnableStaffList();i&&(y.value=i)}F.value=$(),e.value.id&&(F.value=e.value.organizationalStructurePersonList)}catch(i){console.error("Error occurred:",i)}finally{p.value=!1}}),(i,a)=>{const n=u("ElInput"),r=u("ElFormItem"),m=u("el-option"),c=u("el-select"),T=u("el-text"),E=u("el-switch"),b=u("ElForm"),d=u("ElButton"),H=u("ElDialog"),K=Z("loading");return f(),h(H,{modelValue:k.value,"onUpdate:modelValue":a[7]||(a[7]=l=>k.value=l),title:o(A),style:{width:"48rem"},"close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:w},{footer:t(()=>[s(d,{size:"large",onClick:w},{default:t(()=>[V(" 取消 ")]),_:1}),s(d,{type:"primary",size:"large",onClick:J},{default:t(()=>[V(" 确定 ")]),_:1})]),default:t(()=>[L((f(),h(b,{ref_key:"formRef",ref:I,model:o(e),rules:o(G),"label-width":"7rem"},{default:t(()=>[s(r,{label:"部门名称",prop:"name"},{default:t(()=>[s(n,{modelValue:o(e).name,"onUpdate:modelValue":a[0]||(a[0]=l=>o(e).name=l),placeholder:"请输入部门名称",clearable:""},null,8,["modelValue"])]),_:1}),s(r,{label:"部门主管",prop:""},{default:t(()=>[s(c,{modelValue:o(e).userIdList,"onUpdate:modelValue":a[1]||(a[1]=l=>o(e).userIdList=l),"value-key":"",placeholder:"请选择部门主管",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",clearable:"",filterable:""},{default:t(()=>[(f(!0),z(C,null,x(o(y),l=>(f(),h(m,{key:l.value,label:l.userName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(r,{label:"备注"},{default:t(()=>[s(n,{modelValue:o(e).remark,"onUpdate:modelValue":a[2]||(a[2]=l=>o(e).remark=l),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1}),_("div",le,[_("div",ae,[s(T,{style:{width:"4.375rem"}},{default:t(()=>[V("开启提成")]),_:1}),s(E,{modelValue:o(e).commissionStatus,"onUpdate:modelValue":a[3]||(a[3]=l=>o(e).commissionStatus=l),"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"])]),L(_("div",oe,[s(c,{modelValue:o(e).commissionType,"onUpdate:modelValue":a[4]||(a[4]=l=>o(e).commissionType=l),"value-key":"",placeholder:"计提方式",clearable:"",filterable:""},{default:t(()=>[(f(),z(C,null,x(O,l=>s(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])],512),[[P,o(e).commissionStatus===1]]),L(_("div",se,[s(c,{class:"select",modelValue:o(e).commissionTime,"onUpdate:modelValue":a[5]||(a[5]=l=>o(e).commissionTime=l),"value-key":"",placeholder:"计提时间",clearable:"",filterable:""},{default:t(()=>[(f(),z(C,null,x(j,l=>s(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])],512),[[P,o(e).commissionStatus===1]]),L(_("div",te,[s(n,{modelValue:o(e).commission,"onUpdate:modelValue":a[6]||(a[6]=l=>o(e).commission=l),placeholder:"提成比例",style:{"max-width":"25rem"},clearable:""},{append:t(()=>[V("%")]),_:1},8,["modelValue"])],512),[[P,o(e).commissionStatus===1]])])]),_:1},8,["model","rules"])),[[K,o(p)]])]),_:1},8,["modelValue","title"])}}}),re=ee(ie,[["__scopeId","data-v-004dc97e"]]);export{re as default};
