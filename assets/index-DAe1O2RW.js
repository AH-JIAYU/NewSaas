
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as L}from"./configuration_role-CSrZvK9L.js";import{k as J,aa as M,r as i,d as T,bm as j,v as q,ah as S,a as _,an as z,ak as H,i as s,o as x,b as w,f as m,w as f,e as F,y as I,z as P,Z as O,$ as Z,g as Q,j as $,J as W}from"./index-CHE_Y-qx.js";const X={list:()=>J.get("role/getRoleButton")},Y=M("buttonPermission",()=>{const p=i([]);return{permissions:p,getPermissions:async()=>{if(p.value.length)return p.value;const{data:k}=await X.list();return p.value=k,k}}}),D=Y,ee={class:"custom-tree-node"},te={class:"menu"},oe={class:"permission"},se={key:0,class:"permissions"},le=T({__name:"index",props:["id","row"],setup(p,{expose:E}){const k=p,V=j(),K=D(),v=i(!1),h=i(),g=i(),N=i([]),l=i([]),e=i({id:k.id??null,menuId:[],permission:[],roleName:"",remark:""}),U=i({roleName:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});q(async()=>{v.value=!0,e.value.id!==""&&await A(),l.value=await K.getPermissions(),N.value=V.routesRaw;const a=await V.obtainLevel1AndLevel2Routing();e.value.menuId=e.value.menuId.filter(t=>!a.some(n=>n.id===t)),v.value=!1});async function A(){v.value=!0,e.value=JSON.parse(k.row),v.value=!1}function R(a){var t;return(t=l==null?void 0:l.value)==null?void 0:t.filter(n=>a===n.menuId)}const G=a=>{const t=[];t.push(a),g.value.getNode(a.id).checked?t.map(r=>{var d;const o=(d=l==null?void 0:l.value)==null?void 0:d.filter(u=>r.id===u.menuId);o&&o.length&&o.forEach(u=>{e.value.permission.push(u.id)})}):t.map(r=>{var d;const o=(d=l==null?void 0:l.value)==null?void 0:d.filter(u=>r.id===u.menuId);if(o&&o.length){let u=o.map(b=>b.id);e.value.permission=e.value.permission.filter(b=>!u.some(C=>C===b))}})};return E({submit(){return e.value.menuId=g.value.getCheckedKeys(!1),new Promise(a=>{const t=g.value.getCheckedKeys(),n=g.value.getHalfCheckedKeys(),r=t.concat(n);e.value.menuId=r,e.value.id===""?h.value&&h.value.validate(o=>{o&&L.create(e.value).then(()=>{S.success({message:"新增成功",center:!0}),a()})}):h.value&&h.value.validate(o=>{o&&L.edit(e.value).then(()=>{S.success({message:"编辑成功",center:!0}),a()})})})}}),(a,t)=>{const n=_("ElInput"),r=_("ElFormItem"),o=_("ElCheckbox"),d=_("ElCheckboxGroup"),u=_("el-tree"),b=_("ElForm"),C=z("loading");return H((x(),w("div",null,[m(b,{ref_key:"formRef",ref:h,model:s(e),rules:s(U),"label-width":"120px","label-suffix":"："},{default:f(()=>[m(r,{label:"角色码",prop:"roleName"},{default:f(()=>[m(n,{modelValue:s(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=c=>s(e).roleName=c),disabled:!!s(e).id,placeholder:"请输入角色码"},null,8,["modelValue","disabled"])]),_:1}),m(r,{label:"备注",prop:"remark"},{default:f(()=>[m(n,{modelValue:s(e).remark,"onUpdate:modelValue":t[1]||(t[1]=c=>s(e).remark=c),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),m(r,{label:"权限"},{default:f(()=>[s(v)?$("",!0):(x(),F(u,{key:0,ref_key:"treeRef",ref:g,data:s(N),style:{width:"100%"},"default-checked-keys":s(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"",onCheckChange:G,"default-expand-all":"",border:""},{default:f(({data:c})=>{var B;return[I("div",ee,[I("div",te,P(c.meta.title),1),I("div",oe,[(B=R(c.id))!=null&&B.length?(x(),w("div",se,[m(d,{modelValue:s(e).permission,"onUpdate:modelValue":t[2]||(t[2]=y=>s(e).permission=y)},{default:f(()=>[(x(!0),w(O,null,Z(R(c.id),y=>(x(),F(o,{key:y.id,value:y.id},{default:f(()=>[Q(P(y.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):$("",!0)])])]}),_:1},8,["data","default-checked-keys"]))]),_:1})]),_:1},8,["model","rules"])])),[[C,s(v)]])}}}),re=W(le,[["__scopeId","data-v-11820b78"]]);export{re as default};
