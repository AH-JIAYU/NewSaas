
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as me,m as j,O as pe,r as s,al as ce,u as fe,c as ge,k as ve,a as d,o as u,e as p,w as e,f as o,g as v,i as r,b as h,t as E,F as k,s as N,H as _e,j as H,l as K,E as Q,aJ as be,aK as Ve,R as ye}from"./index-UMFAIpvB.js";import{a as he}from"./department-CiACi7eA.js";import{a as Ne}from"./position_manage-B3XPtVhl.js";import{u as we}from"./department-CUBq_KWM.js";import{u as Ie}from"./tenant_role-CjU9C3q3.js";import{u as xe}from"./configuration_manager-HZfPmcC9.js";import"./configuration_role-CE4L5n9Q.js";const W=_=>(be("data-v-210fb908"),_=_(),Ve(),_),Ee=W(()=>N("div",{class:"card-header"},[N("div",{class:"leftTitle"},"基本信息")],-1)),ke=W(()=>N("div",{class:"card-header"},[N("div",{class:"leftTitle"},"角色信息")],-1)),Se={class:"card-header"},Ce={class:"leftTitle"},Be={key:0,style:{"margin-left":"20px","font-size":"14px"}},De=me({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success"],["update:modelValue"]),setup(_,{emit:X}){pe();const Y=xe(),A=s([]),L=s([]),T=s(),ee=ce(),ae=s(),le=Ie(),M=s(),te=we(),F=s(),oe=s(!1),P=s(),$=s(),re=s(),b=_,G=X,R=fe(_,"modelValue"),ue=ge(()=>b.id===""?"新增用户":"编辑用户"),g=s(),ne=s([]),l=s({id:b.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),se=(i,t,n)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(l.value.phoneNumber)?n():n(new Error("请输入合法手机号"))},de=(i,t,n)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l.value.email)?n():n(new Error("请输入合法邮箱"))},J=()=>{l.value.phoneNumber.includes("@")?V.value.email=[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:de,trigger:"blur"}]:V.value.phoneNumber=[{required:!0,trigger:"blur",message:"请输入手机号"},{validator:se,trigger:"blur"}]},V=s({userName:[{required:!0,message:"请输入用户名"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{required:!1,message:"请输入手机号",trigger:"blur"}],email:[{required:!1,message:"请输入邮箱",trigger:"blur"}]}),O=async i=>{const{data:t}=await he.departmentGroup({id:i});L.value=t,re.value=t[0].director};function ie(){l.value.email===""&&(V.value.email=[],g.value.clearValidate("email")),l.value.phoneNumber===""&&(V.value.phoneNumber=[],g.value.clearValidate("phoneNumber")),l.value.id===""?g.value&&g.value.validate(i=>{i&&(delete l.value.id,K.create(l.value).then(()=>{Q.success({message:"新增成功",center:!0}),G("success"),S()}))}):g.value&&g.value.validate(i=>{if(i){const{id:t,phoneNumber:n,email:m,password:f,name:C,country:B,active:w,type:I,role:D,groupId:U,positionId:y,departmentId:z,userName:q}=l.value,c={id:t,phoneNumber:n,email:m,password:f,name:C,country:B,active:w,type:I,role:D,groupId:U,positionId:y,departmentId:z,userName:q};$.value===c.phoneNumber&&delete c.phoneNumber,P.value===c.email&&delete c.email,c.password||delete c.password,K.edit(c).then(()=>{Q.success({message:"编辑成功",center:!0}),G("success"),S()})}})}function S(){R.value=!1}const Z=i=>i.reduce((t,n)=>Array.isArray(n)?t.concat(Z(n)):t.concat(n),[]);return ve(async()=>{const{data:i}=await Ne.list({page:1,limit:10,id:null,name:"",active:null});T.value=i.data,A.value=await Y.getStaff(),M.value=await le.getRole(),F.value=await te.getDepartment(),ae.value=await ee.getCountry(),b.id!==""&&b.row&&(V.value.password=[],l.value=JSON.parse(b.row),P.value=l.value.email,$.value=l.value.phoneNumber,l.value.departmentId&&O(l.value.departmentId),oe.value=!0),ne.value=Z(b.dataList)}),(i,t)=>{const n=d("el-input"),m=d("el-form-item"),f=d("el-col"),C=d("el-option"),B=d("el-select"),w=d("el-row"),I=d("el-card"),D=d("el-radio"),U=d("el-radio-group"),y=d("el-text"),z=d("ElForm"),q=d("ElButton"),c=d("ElDrawer");return u(),p(c,{modelValue:R.value,"onUpdate:modelValue":t[9]||(t[9]=a=>R.value=a),title:r(ue),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:e(()=>[o(q,{size:"large",onClick:S},{default:e(()=>[v(" 取消 ")]),_:1}),o(q,{type:"primary",size:"large",onClick:ie},{default:e(()=>[v(" 确定 ")]),_:1})]),default:e(()=>[o(z,{ref_key:"formRef",ref:g,model:r(l),rules:r(V),"label-width":"100px"},{default:e(()=>[o(I,{class:"box-card"},{header:e(()=>[Ee]),default:e(()=>[o(w,{gutter:24},{default:e(()=>[o(f,{span:8},{default:e(()=>[o(m,{label:"用户名",prop:"userName"},{default:e(()=>[o(n,{modelValue:r(l).userName,"onUpdate:modelValue":t[0]||(t[0]=a=>r(l).userName=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(m,{label:"姓名",prop:"name"},{default:e(()=>[o(n,{modelValue:r(l).name,"onUpdate:modelValue":t[1]||(t[1]=a=>r(l).name=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(m,{label:"手机号",prop:"phoneNumber"},{default:e(()=>[o(n,{modelValue:r(l).phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=a=>r(l).phoneNumber=a),placeholder:"请输入手机号",clearable:"",onBlur:J},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(m,{label:"邮箱",prop:"email"},{default:e(()=>[o(n,{modelValue:r(l).email,"onUpdate:modelValue":t[3]||(t[3]=a=>r(l).email=a),placeholder:"请输入邮箱",clearable:"",onBlur:J},null,8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(m,{label:"部门"},{default:e(()=>[o(B,{modelValue:r(l).departmentId,"onUpdate:modelValue":t[4]||(t[4]=a=>r(l).departmentId=a),placeholder:"请选择部门",clearable:"",filterable:"",onChange:O},{default:e(()=>[(u(!0),h(k,null,E(r(F),a=>(u(),p(C,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(f,{span:8},{default:e(()=>[o(m,{label:"职位",prop:""},{default:e(()=>[o(B,{modelValue:r(l).positionId,"onUpdate:modelValue":t[5]||(t[5]=a=>r(l).positionId=a),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[6]||(t[6]=()=>{})},{default:e(()=>[(u(!0),h(k,null,E(r(T),a=>(u(),p(C,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(I,{class:"box-card"},{header:e(()=>[ke]),default:e(()=>[o(w,{gutter:24},{default:e(()=>[o(m,{label:"分配角色:"},{default:e(()=>{var a;return[(a=r(M))!=null&&a.length?(u(),p(U,{key:0,modelValue:r(l).role,"onUpdate:modelValue":t[7]||(t[7]=x=>r(l).role=x)},{default:e(()=>[(u(!0),h(k,null,E(r(M),x=>(u(),p(D,{key:x.id,value:x.roleName,label:x.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(u(),p(y,{key:1},{default:e(()=>[v("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1}),o(I,{class:"box-card"},{header:e(()=>[N("div",Se,[N("div",Ce,[v(" 小组信息"),r(l).director?(u(),h("span",Be,[v("负责人:"),(u(!0),h(k,null,E(r(A),a=>(u(),p(y,{key:a.id},{default:e(()=>[a.id===r(l).director?(u(),p(y,{key:0},{default:e(()=>[v(_e(a.name),1)]),_:2},1024)):H("",!0)]),_:2},1024))),128))])):H("",!0)])])]),default:e(()=>[o(w,{gutter:24},{default:e(()=>[o(m,{label:"分配小组:"},{default:e(()=>[r(L).length?(u(),p(U,{key:0,modelValue:r(l).groupId,"onUpdate:modelValue":t[8]||(t[8]=a=>r(l).groupId=a)},{default:e(()=>[(u(!0),h(k,null,E(r(L),a=>(u(),p(D,{key:a.id,value:a.id,label:a.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(u(),p(y,{key:1},{default:e(()=>[v("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Te=ye(De,[["__scopeId","data-v-210fb908"]]);export{Te as default};
