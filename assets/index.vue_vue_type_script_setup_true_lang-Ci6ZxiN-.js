
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-CVz9RGxl.js";import{a as d}from"./user_customer-FI-5fX4q.js";import{a as E}from"./apiLoading-Bi9sUNe-.js";import{u as B}from"./stagedData-BMdSSPBU.js";import{d as I,r as m,a0 as z,a1 as f,a as h,o as g,b as P,f as u,w as l,g as p,e as j,j as F,i as M,al as C,ai as v}from"./index-CnQ4xoV5.js";const J=I({__name:"index",emits:["fetch-data"],setup(Q,{expose:b,emit:w}){const c=B(),y=w,n=m(!1),o=m(""),r=m([]);function k(e){r.value.push(e)}z("validateTopTabs",k);let s=f([]);const D=[{customerAccord:"客户名称",customerShortName:"",companyName:"",customerName:"",customerPhone:"",emailAddress:"",chargeName:"",settlementCycle:null,customerStatus:null,antecedentQuestionnaire:null,riskControl:null,turnover:null,rateAudit:null}];async function N(e){if(!e)o.value="添加",s=c.userCustomer||C(D);else{o.value="编辑";const{data:t}=await E(d.detail({tenantCustomerId:e.tenantCustomerId}));T(t)}n.value=!0}function T(e){s.length=0,s.push({...e})}function x(e){const t=new Set;for(const a of e){if(t.has(a.customerAccord))return!0;t.add(a.customerAccord)}return!1}function S(){c.userCustomer=C(s),s=f([]),n.value=!1,r.value=[]}function _(){s=f([]),n.value=!1,r.value=[],o.value==="添加"&&(c.userCustomer=null)}async function V(){const e=[];r.value.forEach(t=>{e.push(t.validate())});try{if((await Promise.all(e)).every(a=>a))if(x(s))v.warning({message:"客户名称重复",center:!0});else{if(o.value==="添加"){const a={tenantCustomerInfoList:s},{status:i}=await d.create(a);i===1&&v.success({message:"新增成功",center:!0})}else{const{status:a}=await d.edit(s[0]);a===1&&v.success({message:"修改成功",center:!0})}y("fetch-data"),_()}}catch(t){console.error("Form validation failed:",t)}}return b({showEdit:N}),(e,t)=>{const a=h("el-button"),i=h("el-drawer");return g(),P("div",null,[u(i,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=A=>n.value=A),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%"},{footer:l(()=>[u(a,{onClick:_},{default:l(()=>[p(" 取消 ")]),_:1}),o.value==="添加"?(g(),j(a,{key:0,type:"warning",onClick:S},{default:l(()=>[p(" 暂存 ")]),_:1})):F("",!0),u(a,{type:"primary",onClick:V},{default:l(()=>[p(" 确定 ")]),_:1})]),default:l(()=>[u(L,{title:o.value,"left-tabs-data":M(s),"validate-top-tabs":r.value},null,8,["title","left-tabs-data","validate-top-tabs"])]),_:1},8,["modelValue"])])}}});export{J as _};
