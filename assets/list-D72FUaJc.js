
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as D,d as be,aN as ge,r as s,n as ve,a as p,q as he,o as i,b as F,f as t,w as l,g as n,s as ye,e as d,i as f,aM as Ce,z as u,y as V,N as O,j as _,F as j,aO as ke,E as q,bb as Se,bc as we,be as xe,an as Ne,L as ze}from"./index-J0U3ShSi.js";import{_ as Te}from"./index-BV7CfK2E.js";import{_ as Ie}from"./index.vue_vue_type_style_index_0_lang-BGlYDovN.js";import{_ as Le}from"./index-4HGiBSil.js";import{U as Ae}from"./user_supplier-DY4uqkav.js";import"./index-C9rlyEbw.js";import"./index.vue_vue_type_script_setup_true_lang-PFvPbB_t.js";import"./sortable.esm-C0-Qcoum.js";import"./user_supplier-D5CA2vbj.js";const S={list:b=>D.post("bill/getTenantSupplierBillList",b),changestatus:b=>D.post("bill/updateTenantSupplierBill",b),settlement:b=>D.post("bill/addTenantSupplierBill",b)},Ee={class:"copyId tableSmall"},Be={class:"id oneLine projectId fontColor"},De=be({name:"supplierSettlement",__name:"list",setup(b){const Q=Ae(),{getParams:G,pagination:g,onSizeChange:J,onCurrentChange:K}=ge(),W=s(""),C=s(!0);s();const w=s(!1),c=s([]),x=s(!1);s(!1);const N=s("default"),z=s(!1),X=s([]),P=[{label:"待收票",value:1},{label:"待支付",value:2},{label:"已支付",value:3},{label:"已拒绝",value:4}],Y=Q.payMethod,U=s(),Z=s("formSearch-supplierSettlement"),T=s([{label:"供应商名称",prop:"supplierName",sortable:!0,checked:!0},{label:"供应商ID",prop:"supplierId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税费",prop:"taxesFees",sortable:!0,checked:!0},{label:"实付金额",prop:"payAmount",sortable:!0,checked:!0},{label:"状态",prop:"billStatus",sortable:!0,checked:!0}]),I=s({supplierId:"",billStatus:"",time:[],beginTime:"",endTime:""}),H=s([]);function ee(o){X.value=o}function te(){Object.assign(I.value,{supplierId:"",billStatus:null,time:[],beginTime:"",endTime:""})}function le(o){J(o).then(()=>v())}function L(o=1){K(o).then(()=>v())}async function v(){try{C.value=!0;const o={...G(),...I.value},a=await S.list(o);H.value=a.data.tenantSupplierBillInfoList,g.value.total=a.data.total,C.value=!1}catch{}finally{C.value=!1}}const ae=async()=>{const{data:o}=await S.settlement({});o&&v()};async function A(o,a){a===3?ke.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async k=>{(await S.changestatus({id:o,type:a,notes:k.value})).status===1&&q.success({message:"操作成功"}),v()}):((await S.changestatus({id:o,type:a})).status===1&&q.success({message:"操作成功"}),v())}ve(()=>{T.value.forEach(o=>{o.checked&&c.value.push(o.prop)}),v(),U.value=[{index:1,show:!0,type:"input",modelName:"supplierId",placeholder:"供应商ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"billStatus",placeholder:"状态",option:"billStatus",optionLabel:"label",optionValue:"value"}]});const oe={billStatus:()=>P},E=s();function ne(o){o?E.value=o.id:E.value=""}return(o,a)=>{const k=Le,M=p("ElDivider"),y=p("el-button"),se=Ie,ie=Se,ue=we,$=p("el-row"),h=p("el-col"),r=p("el-text"),m=p("el-table-column"),re=Te,B=xe,ce=p("ElTableColumn"),pe=p("el-empty"),de=p("el-table"),me=p("ElPagination"),fe=Ne,_e=he("loading");return i(),F("div",{class:O({"absolute-container":w.value})},[t(fe,null,{default:l(()=>[t(k,{formSearchList:U.value,formSearchName:Z.value,onCurrentChange:L,onOnReset:te,model:I.value,formOption:oe},null,8,["formSearchList","formSearchName","model"]),t(M,{"border-style":"dashed"}),t($,{gutter:24},{default:l(()=>[t(se,null,{default:l(()=>[t(y,{size:"default",type:"primary",onClick:ae},{default:l(()=>[n(" 手动结算 ")]),_:1})]),_:1}),t(ue,null,{default:l(()=>[t(y,{size:"default",onClick:a[0]||(a[0]=()=>{})},{default:l(()=>[n(" 导出 ")]),_:1}),t(ie,{border:x.value,"onUpdate:border":a[1]||(a[1]=e=>x.value=e),tableAutoHeight:w.value,"onUpdate:tableAutoHeight":a[2]||(a[2]=e=>w.value=e),checkList:c.value,"onUpdate:checkList":a[3]||(a[3]=e=>c.value=e),columns:T.value,"onUpdate:columns":a[4]||(a[4]=e=>T.value=e),"line-height":N.value,"onUpdate:lineHeight":a[5]||(a[5]=e=>N.value=e),stripe:z.value,"onUpdate:stripe":a[6]||(a[6]=e=>z.value=e),style:{"margin-left":"12px"},onQueryData:L},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),ye((i(),d(de,{ref_key:"tableSortRef",ref:W,style:{"margin-top":"10px"},"row-key":"id",data:H.value,border:x.value,size:N.value,stripe:z.value,onSelectionChange:ee,"highlight-current-row":"",onCurrentChange:ne},{empty:l(()=>[t(pe,{image:f(Ce),"image-size":300},null,8,["image"])]),default:l(()=>[t(m,{type:"expand"},{default:l(e=>[t($,{gutter:20,style:{margin:"10px 0"}},{default:l(()=>[t(h,{span:1}),t(h,{span:3},{default:l(()=>[t(r,{class:"fontColor"},{default:l(()=>[n("付款方式: "+u(f(Y)[e.row.billStatus-1].label),1)]),_:2},1024)]),_:2},1024),t(h,{span:3},{default:l(()=>[t(r,{class:"fontColor"},{default:l(()=>[n("账户名称: "+u(e.row.accountName?e.row.accountName:"-"),1)]),_:2},1024)]),_:2},1024),t(h,{span:3},{default:l(()=>[t(r,{class:"fontColor"},{default:l(()=>[n("收款账号: "+u(e.row.collectionAccount?e.row.collectionAccount:"-"),1)]),_:2},1024)]),_:2},1024),t(h,{span:3},{default:l(()=>[t(r,{class:"fontColor"},{default:l(()=>[n("银行名称: "+u(e.row.bankName?e.row.bankName:"-"),1)]),_:2},1024)]),_:2},1024),t(h,{span:3},{default:l(()=>[t(r,{class:"fontColor"},{default:l(()=>[n("结算周期: "+u(e.row.settlementCycle?e.row.settlementCycle:"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),c.value.includes("supplierId")?(i(),d(m,{key:0,"show-overflow-tooltip":"",align:"left",label:"供应商ID"},{default:l(({row:e})=>[V("div",Ee,[V("div",Be,u(e.supplierId?e.supplierId:"-"),1),t(re,{content:e.supplierId,class:O({rowCopy:"rowCopy",current:e.id===E.value})},null,8,["content","class"])])]),_:1})):_("",!0),c.value.includes("supplierName")?(i(),d(m,{key:1,prop:"supplierName","show-overflow-tooltip":"",align:"left",label:"供应商名称"},{default:l(({row:e})=>[t(r,{class:"fontColor"},{default:l(()=>[n(u(e.supplierName?e.supplierName:"-"),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("billTime")?(i(),d(m,{key:2,prop:"billTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:l(({row:e})=>[t(r,{class:"fontColor"},{default:l(()=>[n(u(e.billTime?e.billTime:"-"),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("billAmount")?(i(),d(m,{key:3,prop:"billAmount","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:l(({row:e})=>[t(r,{class:"fontColor"},{default:l(()=>[t(B),n(u(e.billAmount||0),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("taxesFees")?(i(),d(m,{key:4,prop:"taxesFees","show-overflow-tooltip":"",align:"left",label:"税费"},{default:l(({row:e})=>[t(r,{class:"fontColor"},{default:l(()=>[t(B),n(u(e.taxesFees||0),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("payAmount")?(i(),d(m,{key:5,prop:"payAmount","show-overflow-tooltip":"",align:"left",label:"实付金额"},{default:l(({row:e})=>[t(r,{class:"fontColor"},{default:l(()=>[t(B),n(u(e.payAmount||0),1)]),_:2},1024)]),_:1})):_("",!0),c.value.includes("billStatus")?(i(),d(ce,{key:6,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:l(({row:e})=>[t(r,{class:"fontColor"},{default:l(()=>[n(u(P[e.billStatus-1].label),1)]),_:2},1024)]),_:1})):_("",!0),t(m,{align:"left",fixed:"right",label:"操作",width:"170"},{default:l(({row:e})=>[e.billStatus===1?(i(),d(y,{key:0,size:"small",plain:"",type:"primary",onClick:R=>A(e.id,1)},{default:l(()=>[n(" 确认收票 ")]),_:2},1032,["onClick"])):e.billStatus===2?(i(),F(j,{key:1},[t(y,{size:"small",plain:"",onClick:R=>A(e.id,2)},{default:l(()=>[n(" 支付 ")]),_:2},1032,["onClick"]),t(y,{size:"small",plain:"",type:"danger",onClick:R=>A(e.id,3)},{default:l(()=>[n(" 拒绝 ")]),_:2},1032,["onClick"])],64)):(i(),F(j,{key:2},[n("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[_e,C.value]]),t(me,{"current-page":f(g).page,total:f(g).total,"page-size":f(g).size,"page-sizes":f(g).sizes,layout:f(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:le,onCurrentChange:L},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),je=ze(De,[["__scopeId","data-v-60f50863"]]);export{je as default};
