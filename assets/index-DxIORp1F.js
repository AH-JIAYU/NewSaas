
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as O,r as m,a as s,o as j,b as $,f as o,w as a,g as c,i as l,y as d,e as H,j as M,A as G,E as b,_ as Q,aH as W,aI as X,L as Y}from"./index-DneCj3-6.js";import{a as x}from"./user_cooperation-B-A7cKRk.js";import{u as Z}from"./index-BPpjWlLR.js";import{a as ee}from"./department-DAZPoy5y.js";import"./index-BN75PblK.js";import"./index-CNUKGje3.js";const p=v=>(W("data-v-77577d98"),v=v(),X(),v),re=p(()=>d("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式",-1)),te=p(()=>d("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),ae=p(()=>d("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),oe={style:{display:"flex"}},le=p(()=>d("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),ne=p(()=>d("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),se=O({__name:"index",emits:["fetch-data"],setup(v,{expose:N,emit:C}){const R=C,f=m(!1),h=m(),e=m({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(r,t,u)=>{if(/^(100|[1-9]?\d)$/.test(t)==!1)return u(new Error("请输入 0 到 100 之间的数字"));u()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),V={children:"children",label:"name"},y=m([]);m();const _=m();async function E(r){e.value.form.chargeUserId="",e.value.form.id=r.id,e.value.form.priceRatio=r.priceRatio,e.value.form.sendProjectType=r.sendProjectType?[r.sendProjectType]:null,e.value.form.receiveProjectType=r.receiveProjectType?[r.receiveProjectType]:null,e.value.form.chargeUserName=r.userName,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserId=r.userId;const t=await ee.list({name:""});t.data&&(y.value=t.data),f.value=!0}const S=(r,t)=>{t?(_.value.getCheckedKeys().forEach(i=>{i!==r.id&&_.value.setChecked(i,!1)}),e.value.form.chargeUserId=r.id,e.value.form.chargeUserName=r.name):(e.value.form.chargeUserId=[e.value.form.chargeUserId].filter(u=>u!==r.id),e.value.form.chargeUserId.length==0&&(e.value.form.chargeUserId="")),e.value.form.chargeUserId||(e.value.form.chargeUserName="")};function T(){f.value=!1,e.value.form={},h.value.resetFields()}const A=m();async function B(r){await x.updateInvitationBindUser({id:e.value.form.id,chargeUserId:r.chargeUserId,invitationType:r.invitationType,chargeUserName:r.chargeUserName,sendProjectType:r.sendProjectType,receiveProjectType:r.receiveProjectType})}async function q(){await x.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio}),b.success({message:"修改成功",center:!0})}async function w(){h.value.validate(r=>{if(r){let t=JSON.parse(JSON.stringify(e.value.form));if(Array.isArray(t.chargeUserId)&&(t.chargeUserId=t.chargeUserId[0]),t.receiveProjectType==1&&!t.chargeUserId){b.warning({message:"请选择部门",center:!0});return}t.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,t.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,t.invitationType=2,t.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",t.chargeUserId=null,t.chargeUserName="",t.invitationType=""),B(t),q(),setTimeout(()=>{R("fetch-data")},1e3),T()}})}const F=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.sendProjectType=[r[r.length-1]])},K=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.receiveProjectType=[r[r.length-1]])};function z(r){e.value.form.chargeUserId=r.chargeUserId,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserName=r.chargeUserName}return N({showEdit:E}),(r,t)=>{const u=s("el-input"),i=s("el-form-item"),U=Q,P=s("el-tooltip"),g=s("el-checkbox"),I=s("el-checkbox-group"),D=s("el-tree-select"),J=s("ElForm"),k=s("el-button"),L=s("el-dialog");return j(),$("div",null,[o(L,{modelValue:l(f),"onUpdate:modelValue":t[4]||(t[4]=n=>G(f)?f.value=n:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置",class:"hezuoDrawer"},{footer:a(()=>[o(k,{onClick:T},{default:a(()=>[c(" 关闭 ")]),_:1}),o(k,{type:"primary",onClick:w},{default:a(()=>[c(" 确认 ")]),_:1})]),default:a(()=>[o(J,{ref_key:"formRef",ref:h,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"right"},{default:a(()=>[o(i,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[o(u,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":t[0]||(t[0]=n=>l(e).form.priceRatio=n),clearable:""},{append:a(()=>[c("%")]),_:1},8,["modelValue"])]),_:1}),o(i,{"label-width":"7rem"},{label:a(()=>[re]),_:1}),o(i,{prop:"sendProjectType","label-width":"7rem"},{label:a(()=>[d("span",null,[o(P,{effect:"dark",placement:"top-start"},{content:a(()=>[te,ae]),default:a(()=>[o(U,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:a(()=>[o(I,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":t[1]||(t[1]=n=>l(e).form.sendProjectType=n),onChange:F},{default:a(()=>[o(g,{value:1},{default:a(()=>[c(" 自动 ")]),_:1}),o(g,{value:2},{default:a(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),d("div",oe,[o(i,{prop:"receiveProjectType",style:{"margin-right":"1.5625rem"}},{label:a(()=>[d("span",null,[o(P,{effect:"dark",placement:"top-start"},{content:a(()=>[le,ne]),default:a(()=>[o(U,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:a(()=>[o(I,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":t[2]||(t[2]=n=>l(e).form.receiveProjectType=n),onChange:K},{default:a(()=>[o(g,{value:1},{default:a(()=>[c(" 自动 ")]),_:1}),o(g,{value:2},{default:a(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).form.receiveProjectType==1?(j(),H(D,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:_,modelValue:l(e).form.chargeUserId,"onUpdate:modelValue":t[3]||(t[3]=n=>l(e).form.chargeUserId=n),data:l(y),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:V,onCheckChange:S,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):M("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(Z,{ref_key:"userRef",ref:A,onUserData:z},null,512)])}}}),ve=Y(se,[["__scopeId","data-v-77577d98"]]);export{ve as default};
