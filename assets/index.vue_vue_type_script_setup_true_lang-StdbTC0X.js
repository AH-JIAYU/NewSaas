
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as d,d as $,r as D,a4 as k,a as u,o as i,b as I,f as r,w as l,l as G,g as m,i as t,F as L,n as V,e as c,am as P,aB as w,j as N,p as J,an as K,ak as x}from"./index-BzKbJ4XU.js";import{o as C,s as U}from"./apiLoading-3iIZurMp.js";const y={list:p=>d.post("projectDispatch/getProjectDispatchList",p),getProjectList:p=>d.post("projectDispatch/getNotDispatchProjectList",p),create:p=>d.post("projectDispatch/addProjectDispatch",p),edit:p=>d.post("projectDispatch/updateProjectDispatch",p),delete:p=>d.post("projectDispatch/deleteProjectDispatch",p),getAllocationGroupOrSupplier:p=>d.post("projectDispatch/getAllocationGroupOrSupplier",p)},Q={style:{flex:"auto"}},Y=$({name:"Edit",__name:"index",emits:["fetch-data"],setup(p,{expose:M,emit:A}){const B=A,f=D(),q=k({projectId:[{required:!0,message:"请选择项目",trigger:"change"}],dispatchType:[{required:!0,message:"请选择调度类型",trigger:"change"}],dataType:[{required:!0,message:"请选择调度目标",trigger:"change"}],groupSupplierId:[{required:!0,message:"请选择至少一个",trigger:"change"}]}),g=D(!1),e=k({title:"",projectList:[],memberGroupNameInfoList:[],supplierNameInfoList:[],form:{projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""}});async function z(s){const a=await C(y.getProjectList({}));e.projectList=a.data.getNotDispatchProjectInfoList,console.log("row",s),s?(e.title="编辑",e.form=K(s),await v(s.projectId)):e.title="添加",g.value=!0}const v=async s=>{if(s){const a=await C(y.getAllocationGroupOrSupplier({projectId:s}));e.memberGroupNameInfoList=a.data.getAllocationMemberGroupNameInfoList,e.supplierNameInfoList=a.data.getAllocationSupplierNameInfoList,e.supplierNameInfoList.length&&!e.memberGroupNameInfoList.length&&(e.form.dataType=1),!e.supplierNameInfoList.length&&e.memberGroupNameInfoList.length&&(e.form.dataType=2)}},E=()=>{e.form.groupSupplierId=[],f.value.clearValidate(["groupSupplierId"])};function b(){f.value.resetFields(),e.form={projectId:"",groupSupplierId:[],dataType:"",dispatchType:1,doMoneyPrice:""},g.value=!1}function F(){f.value&&f.value.validate(async s=>{if(s){if(e.title==="添加"){const{status:a}=await U(y.create(e.form));a===1&&x.success({message:"添加成功"})}else{const{status:a}=await U(y.edit(e.form));a===1&&x.success({message:"修改成功"})}b(),B("fetch-data")}})}return M({showEdit:z}),(s,a)=>{const _=u("el-radio"),T=u("el-radio-group"),n=u("el-form-item"),h=u("el-option"),j=u("el-select"),O=u("el-input"),R=u("el-form"),S=u("el-button"),H=u("el-dialog");return i(),I("div",null,[r(H,{modelValue:t(g),"onUpdate:modelValue":a[6]||(a[6]=o=>J(g)?g.value=o:null),title:t(e).title,width:"600","before-close":b},{footer:l(()=>[G("div",Q,[r(S,{onClick:b},{default:l(()=>[m(" 取消 ")]),_:1}),r(S,{type:"primary",onClick:F},{default:l(()=>[m(" 确定 ")]),_:1})])]),default:l(()=>[r(R,{ref_key:"formRef",ref:f,"label-width":"130px",model:t(e).form,rules:t(q),inline:!1},{default:l(()=>[r(n,{label:"调度类型",prop:"dispatchType",style:{"align-items":"center"}},{default:l(()=>[r(T,{modelValue:t(e).form.dispatchType,"onUpdate:modelValue":a[0]||(a[0]=o=>t(e).form.dispatchType=o),class:"ml-4"},{default:l(()=>[r(_,{value:1,size:"large"},{default:l(()=>[m(" 指定关闭 ")]),_:1}),r(_,{value:2,size:"large"},{default:l(()=>[m(" 指定价格 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"项目ID/名称",prop:"projectId"},{default:l(()=>[r(j,{placeholder:"",modelValue:t(e).form.projectId,"onUpdate:modelValue":a[1]||(a[1]=o=>t(e).form.projectId=o),clearable:"",onChange:v},{default:l(()=>[(i(!0),I(L,null,V(t(e).projectList,o=>(i(),c(h,{key:o.projectId,label:o.projectName,value:o.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),P(G("div",null,[P(r(n,{prop:"dataType",label:"调度目标",style:{"align-items":"center"}},{default:l(()=>[r(T,{modelValue:t(e).form.dataType,"onUpdate:modelValue":a[2]||(a[2]=o=>t(e).form.dataType=o),class:"ml-4",onChange:E},{default:l(()=>[r(_,{value:1,size:"large"},{default:l(()=>[m(" 供应商 ")]),_:1}),r(_,{value:2,size:"large"},{default:l(()=>[m(" 会员组 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[w,t(e).supplierNameInfoList.length&&t(e).memberGroupNameInfoList.length]]),t(e).supplierNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===1?(i(),c(n,{key:0,label:"供应商",prop:"groupSupplierId"},{default:l(()=>[r(j,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":a[3]||(a[3]=o=>t(e).form.groupSupplierId=o),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:l(()=>[(i(!0),I(L,null,V(t(e).supplierNameInfoList,o=>(i(),c(h,{key:o.projectId,label:o.supplierName,value:o.supplierId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):N("",!0),t(e).memberGroupNameInfoList.length&&t(e).form.dataType&&t(e).form.dataType===2?(i(),c(n,{key:1,label:"会员组",prop:"groupSupplierId"},{default:l(()=>[r(j,{placeholder:"",modelValue:t(e).form.groupSupplierId,"onUpdate:modelValue":a[4]||(a[4]=o=>t(e).form.groupSupplierId=o),clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:l(()=>[(i(!0),I(L,null,V(t(e).memberGroupNameInfoList,o=>(i(),c(h,{key:o.projectId,label:o.memberGroupName,value:o.memberGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):N("",!0)],512),[[w,t(e).form.projectId]]),t(e).form.dispatchType===2?(i(),c(n,{key:0,label:"指定价格"},{default:l(()=>[r(O,{placeholder:"",modelValue:t(e).form.doMoneyPrice,"onUpdate:modelValue":a[5]||(a[5]=o=>t(e).form.doMoneyPrice=o),clearable:""},null,8,["modelValue"])]),_:1})):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Y as _,y as a};
