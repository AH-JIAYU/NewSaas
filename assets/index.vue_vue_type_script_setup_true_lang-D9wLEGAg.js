
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{u as z}from"./user_customer-8faKmal_.js";import{a as H}from"./project_settlement-CEEFgb2Z.js";import{d as J,r,n as $,a as d,q as G,s as K,o as m,b as f,f as a,w as o,y as Q,g,F as c,z as W,t as x,e as D,j as y,E as U}from"./index-DyNgHb7_.js";const X={style:{flex:"auto"}},le=J({name:"SettlementEdit",__name:"index",emits:["success"],setup(Y,{expose:M,emit:j}){const S=j,E=z(),k=r([]),i=r(!1),b=r(),n=r(),l=r({id:"",projectId:"",clientId:"",doMoneyPrice:"",settlementDone:"",systemDone:"",settlementPo:"",remark:"",status:null}),v=r(""),P=r(""),L={systemDone:" 系统/审核",settlementPo:"结算PO号",remark:"备注"},N=r({clientId:[{required:!0,message:"请选择所属客户",trigger:"change"}],doMoneyPrice:[{required:!0,message:"请选择所属客户",trigger:"blur"}]}),O=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],p=r(!1);function B(){b.value&&b.value.validate(async V=>{if(V)try{i.value=!0;const{status:e}=await H.edit(l.value);e===1?(S("success"),i.value=!1,U.success({message:"操作成功",center:!0}),_()):(i.value=!1,U.error({message:"操作失败，请联系工作人员",center:!0}))}catch{}finally{i.value=!1}})}async function q(V,e){P.value=(L[e]||"")+"编辑",v.value=e,n.value=JSON.parse(V),l.value.id=n.value.id,l.value.projectId=n.value.projectId,l.value.clientId=n.value.clientId,l.value.doMoneyPrice=n.value.projectAmount,l.value.settlementDone=n.value.settlementDone,l.value.systemDone=n.value.systemDone,l.value.settlementPo=n.value.settlementPo,l.value.remark=n.value.remark,l.value.status=n.value.status,p.value=!0}function _(){b.value.resetFields(),Object.assign(l.value,{id:"",projectId:"",clientId:"",doMoneyPrice:"",settlementDone:"",systemDone:"",settlementPo:"",remark:"",status:null}),p.value=!1}return $(async()=>{k.value=await E.getCustomerList()}),M({showEdit:q}),(V,e)=>{const R=d("el-text"),u=d("el-form-item"),C=d("el-option"),w=d("el-select"),s=d("el-input"),A=d("el-form"),I=d("el-button"),F=d("el-dialog"),T=G("loading");return K((m(),f("div",null,[a(F,{modelValue:p.value,"onUpdate:modelValue":e[19]||(e[19]=t=>p.value=t),title:P.value,width:"600","before-close":_},{footer:o(()=>[Q("div",X,[a(I,{onClick:e[18]||(e[18]=t=>p.value=!1)},{default:o(()=>[g(" 取消 ")]),_:1}),a(I,{type:"primary",onClick:B},{default:o(()=>[g(" 确定 ")]),_:1})])]),default:o(()=>[a(A,{ref_key:"formRef",ref:b,model:l.value,rules:N.value,"label-width":"86px",inline:!1},{default:o(()=>[v.value?y("",!0):(m(),f(c,{key:0},[a(u,{label:"项目ID"},{default:o(()=>[a(R,{class:"mx-1"},{default:o(()=>[g(W(l.value.projectId),1)]),_:1})]),_:1}),a(u,{prop:"clientId",label:"所属客户"},{default:o(()=>[a(w,{modelValue:l.value.clientId,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.clientId=t),placeholder:"请选择所属客户",disabled:!!l.value.id,clearable:"",filterable:""},{default:o(()=>[(m(!0),f(c,null,x(k.value,t=>(m(),D(C,{key:t.tenantCustomerId,value:t.tenantCustomerId,label:t.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(u,{prop:"doMoneyPrice",label:"项目价"},{default:o(()=>[a(s,{modelValue:l.value.doMoneyPrice,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.doMoneyPrice=t),disabled:!!l.value.id,placeholder:"",clearable:"",onChange:e[2]||(e[2]=()=>{})},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"系统完成数"},{default:o(()=>[a(s,{modelValue:l.value.systemDone,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.systemDone=t),placeholder:"",clearable:"",onChange:e[4]||(e[4]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"审核完成数"},{default:o(()=>[a(s,{modelValue:l.value.settlementDone,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.settlementDone=t),placeholder:"",clearable:"",onChange:e[6]||(e[6]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"结算PO号"},{default:o(()=>[a(s,{modelValue:l.value.settlementPo,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.settlementPo=t),placeholder:"",clearable:"",onChange:e[8]||(e[8]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"备注"},{default:o(()=>[a(s,{maxlength:"200","show-word-limit":"",style:{width:"100%"},type:"textarea",rows:5,modelValue:l.value.remark,"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.remark=t),clearable:""},null,8,["modelValue"])]),_:1}),a(u,{label:"状态"},{default:o(()=>[a(w,{placeholder:"结算状态",modelValue:l.value.status,"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.status=t),clearable:"",filterable:""},{default:o(()=>[(m(),f(c,null,x(O,t=>a(C,{key:t.value,value:t.value,label:t.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1})],64)),v.value==="systemDone"?(m(),f(c,{key:1},[a(u,{label:"系统完成数"},{default:o(()=>[a(s,{modelValue:l.value.systemDone,"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.systemDone=t),placeholder:"",clearable:"",onChange:e[12]||(e[12]=()=>{})},null,8,["modelValue"])]),_:1}),a(u,{label:"审核完成数"},{default:o(()=>[a(s,{modelValue:l.value.settlementDone,"onUpdate:modelValue":e[13]||(e[13]=t=>l.value.settlementDone=t),placeholder:"",clearable:"",onChange:e[14]||(e[14]=()=>{})},null,8,["modelValue"])]),_:1})],64)):y("",!0),v.value==="settlementPo"?(m(),D(u,{key:2,label:"结算PO号"},{default:o(()=>[a(s,{modelValue:l.value.settlementPo,"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.settlementPo=t),placeholder:"",clearable:"",onChange:e[16]||(e[16]=()=>{})},null,8,["modelValue"])]),_:1})):y("",!0),v.value==="remark"?(m(),D(u,{key:3,label:"备注"},{default:o(()=>[a(s,{maxlength:"200","show-word-limit":"",style:{width:"100%"},type:"textarea",rows:5,modelValue:l.value.remark,"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.remark=t),clearable:""},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])),[[T,i.value]])}}});export{le as _};
