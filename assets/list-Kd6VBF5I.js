
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as I,d as de,aN as fe,r as s,n as _e,a as i,q as be,o as u,b as B,f as t,w as l,g as n,s as ge,e as c,i as m,aM as ve,z as r,j as v,F as $,N as he,bf as ye,aO as ke,E as R,b9 as Se,ba as Ce,be as we,ao as xe,L as Te}from"./index-Cs9qlqCQ.js";import{_ as ze}from"./index.vue_vue_type_style_index_0_lang-JmJEEO5F.js";import{_ as Le}from"./index-D9uOCEtU.js";import{U as Ae}from"./user_supplier-BUpNzzoN.js";import"./index.vue_vue_type_script_setup_true_lang-DnMuLiG0.js";import"./sortable.esm-C0-Qcoum.js";import"./user_supplier-CyaqTA9F.js";const S={list:f=>I.post("bill/getTenantSupplierBillList",f),changestatus:f=>I.post("bill/updateTenantSupplierBill",f),settlement:f=>I.post("bill/addTenantSupplierBill",f)},Ne=de({name:"supplierSettlement",__name:"list",setup(f){const O=Ae(),{getParams:V,pagination:_,onSizeChange:j,onCurrentChange:q}=fe(),{format:Q}=ye(),G=s(""),y=s(!0);s();const C=s(!1),p=s([]),w=s(!1);s(!1);const x=s("default"),T=s(!1),J=s([]),D=[{label:"待收票",value:1},{label:"待支付",value:2},{label:"已支付",value:3},{label:"已拒绝",value:4}],K=O.payMethod,F=s(),W=s("formSearch-supplierSettlement"),z=s([{label:"供应商ID",prop:"supplierId",sortable:!0,checked:!0},{label:"账单日期",prop:"billTime",sortable:!0,checked:!0},{label:"账单金额",prop:"billAmount",sortable:!0,checked:!0},{label:"税费",prop:"taxesFees",sortable:!0,checked:!0},{label:"实付金额",prop:"payAmount",sortable:!0,checked:!0},{label:"状态",prop:"billStatus",sortable:!0,checked:!0}]),L=s({supplierId:"",billStatus:"",time:[],beginTime:"",endTime:""}),P=s([]);function X(o){J.value=o}function Y(){Object.assign(L.value,{supplierId:"",billStatus:null,time:[],beginTime:"",endTime:""})}function Z(o){j(o).then(()=>b())}function A(o=1){q(o).then(()=>b())}async function b(){try{y.value=!0;const o={...V(),...L.value},a=await S.list(o);P.value=a.data.tenantSupplierBillInfoList,_.value.total=a.data.total,y.value=!1}catch{}finally{y.value=!1}}const ee=async()=>{const{data:o}=await S.settlement({});o&&b()};async function N(o,a){a===3?ke.prompt("请说明拒绝的理由","说明",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{2,}/,inputErrorMessage:"请输理由-最少2为字符"}).then(async k=>{(await S.changestatus({id:o,type:a,notes:k.value})).status===1&&R.success({message:"操作成功"}),b()}):((await S.changestatus({id:o,type:a})).status===1&&R.success({message:"操作成功"}),b())}_e(()=>{z.value.forEach(o=>{o.checked&&p.value.push(o.prop)}),b(),F.value=[{index:1,show:!0,type:"input",modelName:"supplierId",placeholder:"供应商ID"},{index:2,show:!0,type:"datetimerange",modelName:"time",startPlaceHolder:"创建开始日期",endPlaceHolder:"创建结束日期"},{index:3,show:!0,type:"select",modelName:"billStatus",placeholder:"状态",option:"billStatus",optionLabel:"label",optionValue:"value"}]});const te={billStatus:()=>D};return(o,a)=>{const k=Le,U=i("ElDivider"),h=i("el-button"),le=ze,ae=Se,oe=Ce,H=i("el-row"),g=i("el-col"),d=i("el-table-column"),ne=i("el-tag"),se=i("el-tooltip"),E=we,ie=i("ElTableColumn"),ue=i("el-empty"),re=i("el-table"),pe=i("ElPagination"),ce=xe,me=be("loading");return u(),B("div",{class:he({"absolute-container":C.value})},[t(ce,null,{default:l(()=>[t(k,{formSearchList:F.value,formSearchName:W.value,onCurrentChange:A,onOnReset:Y,model:L.value,formOption:te},null,8,["formSearchList","formSearchName","model"]),t(U,{"border-style":"dashed"}),t(H,{gutter:24},{default:l(()=>[t(le,null,{default:l(()=>[t(h,{size:"default",type:"primary",onClick:ee},{default:l(()=>[n(" 手动结算 ")]),_:1})]),_:1}),t(oe,null,{default:l(()=>[t(h,{size:"default",onClick:a[0]||(a[0]=()=>{})},{default:l(()=>[n(" 导出 ")]),_:1}),t(ae,{border:w.value,"onUpdate:border":a[1]||(a[1]=e=>w.value=e),tableAutoHeight:C.value,"onUpdate:tableAutoHeight":a[2]||(a[2]=e=>C.value=e),checkList:p.value,"onUpdate:checkList":a[3]||(a[3]=e=>p.value=e),columns:z.value,"onUpdate:columns":a[4]||(a[4]=e=>z.value=e),"line-height":x.value,"onUpdate:lineHeight":a[5]||(a[5]=e=>x.value=e),stripe:T.value,"onUpdate:stripe":a[6]||(a[6]=e=>T.value=e),style:{"margin-left":"12px"},onQueryData:A},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),ge((u(),c(re,{ref_key:"tableSortRef",ref:G,style:{"margin-top":"10px"},"row-key":"id",data:P.value,border:w.value,size:x.value,stripe:T.value,onSelectionChange:X},{empty:l(()=>[t(ue,{image:m(ve),"image-size":300},null,8,["image"])]),default:l(()=>[t(d,{type:"expand"},{default:l(e=>[t(H,{gutter:20,style:{margin:"10px 0"}},{default:l(()=>[t(g,{span:1}),t(g,{span:3},{default:l(()=>[n(" 付款方式: "+r(m(K)[e.row.billStatus-1].label),1)]),_:2},1024),t(g,{span:3},{default:l(()=>[n("账户名称: "+r(e.row.accountName),1)]),_:2},1024),t(g,{span:3},{default:l(()=>[n("收款账号: "+r(e.row.collectionAccount),1)]),_:2},1024),t(g,{span:3},{default:l(()=>[n("银行名称: "+r(e.row.bankName),1)]),_:2},1024),t(g,{span:3},{default:l(()=>[n("结算周期: "+r(e.row.settlementCycle),1)]),_:2},1024)]),_:2},1024)]),_:1}),p.value.includes("supplierId")?(u(),c(d,{key:0,prop:"supplierId","show-overflow-tooltip":"",align:"left",label:"供应商ID"})):v("",!0),p.value.includes("billTime")?(u(),c(d,{key:1,prop:"billTime","show-overflow-tooltip":"",align:"left",label:"账单日期"},{default:l(({row:e})=>[t(se,{content:e.billTime,placement:"top"},{default:l(()=>[t(ne,{effect:"plain",type:"info"},{default:l(()=>[n(r(m(Q)(e.billTime)),1)]),_:2},1024)]),_:2},1032,["content"])]),_:1})):v("",!0),p.value.includes("billAmount")?(u(),c(d,{key:2,prop:"billAmount","show-overflow-tooltip":"",align:"left",label:"账单金额"},{default:l(({row:e})=>[t(E),n(r(e.billAmount||0),1)]),_:1})):v("",!0),p.value.includes("taxesFees")?(u(),c(d,{key:3,prop:"taxesFees","show-overflow-tooltip":"",align:"left",label:"税费"},{default:l(({row:e})=>[t(E),n(r(e.taxesFees||0),1)]),_:1})):v("",!0),p.value.includes("payAmount")?(u(),c(d,{key:4,prop:"payAmount","show-overflow-tooltip":"",align:"left",label:"实付金额"},{default:l(({row:e})=>[t(E),n(r(e.payAmount||0),1)]),_:1})):v("",!0),p.value.includes("billStatus")?(u(),c(ie,{key:5,align:"left","show-overflow-tooltip":"",prop:"",label:"状态"},{default:l(({row:e})=>[n(r(D[e.billStatus-1]),1)]),_:1})):v("",!0),t(d,{align:"left",fixed:"right",label:"操作",width:"170"},{default:l(({row:e})=>[e.billStatus===1?(u(),c(h,{key:0,size:"small",plain:"",type:"primary",onClick:M=>N(e.id,1)},{default:l(()=>[n(" 确认收票 ")]),_:2},1032,["onClick"])):e.billStatus===2?(u(),B($,{key:1},[t(h,{size:"small",plain:"",onClick:M=>N(e.id,2)},{default:l(()=>[n(" 支付 ")]),_:2},1032,["onClick"]),t(h,{size:"small",plain:"",type:"danger",onClick:M=>N(e.id,3)},{default:l(()=>[n(" 拒绝 ")]),_:2},1032,["onClick"])],64)):(u(),B($,{key:2},[n("- ")],64))]),_:1})]),_:1},8,["data","border","size","stripe"])),[[me,y.value]]),t(pe,{"current-page":m(_).page,total:m(_).total,"page-size":m(_).size,"page-sizes":m(_).sizes,layout:m(_).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Z,onCurrentChange:A},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1})],2)}}}),He=Te(Ne,[["__scopeId","data-v-03f47d20"]]);export{He as default};
