
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{o as B,s as R}from"./apiLoading-Dp_wkxkt.js";import{a as D}from"./projectManagement-C0Tw6D1g.js";import{u as F}from"./survey_vipGroup-DZP3FNie.js";import{d as T,r as p,l as q,b as a,q as H,o as u,e as v,g as t,w as l,t as M,h as f,s as U,f as g,H as b,j as s,F as A,v as O,I as Q,E as z,R as J}from"./index-BRxVf_xq.js";import"./survey_vipGroup-Do6QRujJ.js";const K={style:{flex:"auto"}},P=T({name:"AllocationEdit",__name:"index",emits:["fetch-data"],setup(W,{expose:y,emit:I}){const w=F(),L=I,i=p(!1),c=p(),e=p({list:[],vipGroupList:[],form:{projectId:"",allocationType:3,groupSupplierIdList:[]}}),V=p({groupSupplierIdList:[{type:"array",required:!0,trigger:"change",message:"请选择至少一项"}]});async function h(n){e.value.list=[{...n}],e.value.form.projectId=n.projectId,e.value.vipGroupList=await B(w.getGroupNameList()),i.value=!0}function d(){c.value.resetFields(),Object.assign(e.value.form,{projectId:"",groupSupplierIdList:[]}),i.value=!1}function S(){c.value.validate(async n=>{if(n){const{status:r}=await R(D.allocation(e.value.form));r===1&&z.success({message:"分配成功",center:!0}),d(),L("fetch-data")}})}return q(async()=>{}),y({showEdit:h}),(n,r)=>{const m=a("el-table-column"),j=a("el-table"),x=a("el-option"),G=a("el-select"),k=a("el-form-item"),E=a("el-form"),_=a("el-button"),N=a("el-dialog"),C=H("loading");return u(),v("div",null,[t(N,{modelValue:s(i),"onUpdate:modelValue":r[1]||(r[1]=o=>Q(i)?i.value=o:null),title:"分配",width:"700","before-close":d},{footer:l(()=>[M("div",K,[t(_,{onClick:d},{default:l(()=>[f(" 取消 ")]),_:1}),t(_,{type:"primary",onClick:S},{default:l(()=>[f(" 确定 ")]),_:1})])]),default:l(()=>[U((u(),g(j,{data:s(e).list,"row-key":"id"},{default:l(()=>[t(m,{align:"left","show-overflow-tooltip":"",label:"项目编码",prop:"projectId"}),t(m,{align:"left","show-overflow-tooltip":"",label:"项目名称",prop:"projectName"}),t(m,{align:"left","show-overflow-tooltip":"",label:"配额/限量",prop:"name"},{default:l(({row:o})=>[f(b(o.limitedQuantity||0)+"/ "+b(o.num||0),1)]),_:1})]),_:1},8,["data"])),[[C,!1]]),t(E,{ref_key:"formRef",ref:c,"label-width":"6rem",rules:s(V),model:s(e).form,inline:!1,style:{"margin-top":"1.25rem"}},{default:l(()=>[t(k,{label:"会员组",prop:"groupSupplierIdList"},{default:l(()=>[t(G,{modelValue:s(e).form.groupSupplierIdList,"onUpdate:modelValue":r[0]||(r[0]=o=>s(e).form.groupSupplierIdList=o),placeholder:"请选择会员组",clearable:"",filterable:"",multiple:"","collapse-tags":""},{default:l(()=>[(u(!0),v(A,null,O(s(e).vipGroupList,o=>(u(),g(x,{label:o.memberGroupName,value:o.memberGroupId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}}),oe=J(P,[["__scopeId","data-v-506d2101"]]);export{oe as default};
