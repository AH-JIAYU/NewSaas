
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as he,aN as ge,r as s,$ as be,c as ke,n as Te,a as v,q as Ie,o as r,b as Ce,f as o,w as a,g as c,i as l,A as k,s as Pe,e as u,aM as je,y as _,j as m,z as T,N as R,aO as Ne,E as B,b8 as Se,b9 as Ue,_ as ze,bd as Be,ao as Ee,L as Re}from"./index-Cz3eoyTV.js";import{_ as Le}from"./index-Cvg_qyr-.js";import{_ as xe}from"./index.vue_vue_type_style_index_0_lang-CkdyJdYX.js";import $e from"./index-DRKH2YJe.js";import De from"./index-BbUOkqTn.js";import Ae from"./index-BKgRbyc_.js";import Me from"./index-DgS_PM2y.js";import{a as C}from"./user_cooperation-CTisbrgU.js";import Fe from"./index-DSv6kgg5.js";import"./index-qvxaEZj4.js";import"./index-CyoZcpJs.js";import"./department-DT8K44KR.js";const He={class:"fontC-System"},qe={class:"copyId tableSmall"},Oe={class:"id oneLine beInvitationTenantId"},Qe={class:"tableBig"},Ve={class:"flex-s"},Je={class:"fontC-System"},we={class:"fontC-System"},Ge={class:"fontC-System"},Ke={class:"fontC-System"},We=he({name:"cooperation",__name:"index",setup(Xe){const{pagination:g,getParams:Q,onSizeChange:V,onCurrentChange:J}=ge(),p=s(!1),E=s([]),L=s(),x=s(),w=s(),P=s(!1),j=s(!1),N=s(!1),S=s("default"),d=s([]),$=s(),U=s([{label:"合作商ID",checked:!0,sortable:!0,prop:"beInvitationTenantId"},{label:"合作商名称",checked:!0,sortable:!0,prop:"beInvitationTenantName"},{label:"PM",checked:!0,sortable:!0,prop:"userName"},{label:"状态",checked:!0,sortable:!0,prop:"bindStatus"},{label:"价格比例",checked:!0,sortable:!0,prop:"priceRatio"},{label:"待审金额",checked:!0,sortable:!0,prop:"pendBalance"},{label:"可用金额",checked:!0,sortable:!0,prop:"availableBalance"},{label:"个人待审金额",checked:!0,sortable:!0,prop:"personalPendBalance"},{label:"个人可用金额",checked:!0,sortable:!0,prop:"personalAvailableBalance"},{label:"发送项目",checked:!0,sortable:!0,prop:"sendProjectType"},{label:"接收项目",checked:!0,sortable:!0,prop:"receiveProjectType"},{label:"负责部门/PM",checked:!0,sortable:!0,prop:"userName"}]),z=s();function G(n){n?z.value=n.id:z.value=""}function K(){L.value.showEdit()}function W(n){Ne.prompt("是否确认进行解约?","终止合作",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"说明",inputPattern:/^.{0,500}$/,inputErrorMessage:"不能超过500个字符",type:"warning"}).then(async e=>{const{data:{flag:i}}=await C.updateRescindTenant({beInvitationTenantId:n.beInvitationTenantId,remark:e.value});i&&B({type:"success",message:"已终止合作"}),I()}).catch(()=>{})}const D=s();function X(n){D.value.showEdit(n)}function Y(n){x.value.showEdit(n)}const Z=be({});function ee(n){V(n).then(()=>I())}function te(n=1){J(n).then(()=>I())}function h(){g.value.page=1,I()}async function I(){try{p.value=!0;const n={...Q(),...Z},{data:e}=await C.list(n);E.value=e.tenantBindInfoList,g.value.total=Number(e.total),p.value=!1}catch{}finally{p.value=!1}}function ne(n){w.value=n}const ae=ke(()=>{const n=E.value.filter(f=>f.bindStatus===2);let e=E.value.filter(f=>f.bindStatus===4);e=Array.from(new Map(e.map(f=>[f.beInvitationTenantId,f])).values());const i=n.map(f=>f.beInvitationTenantId);return e.forEach(f=>{i.includes(f.beInvitationTenantId)||n.push(f)}),n});function le(n,e){$.value.showEdit(n,e)}Te(()=>{U.value.forEach(n=>{n.checked&&d.value.push(n.prop)}),h()});const A=(n,e)=>{if(e.sendProjectType==1&&n=="手动"||e.sendProjectType==2&&n=="自动")try{p.value=!0;let i={id:e.id,chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,sendProjectType:e.sendProjectType==1?2:1,receiveProjectType:e.receiveProjectType};C.updateInvitationBindUser(i).then(()=>{p.value=!1,h(),B.success({message:"修改成功",center:!0})})}catch{}finally{p.value=!1}},M=s(),F=s(null),H=(n,e)=>{if(F.value=e.id,JSON.parse(JSON.stringify(e)),e.receiveProjectType==1&&n=="手动")try{p.value=!0;let i={id:e.id,chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,sendProjectType:e.sendProjectType,receiveProjectType:e.receiveProjectType==1?2:1};C.updateInvitationBindUser(i).then(()=>{p.value=!1,h(),B.success({message:"修改成功",center:!0})})}catch{}finally{p.value=!1}else if(e.receiveProjectType==2&&n=="自动"){let i={chargeUserId:e.userId,invitationType:e.invitationType,chargeUserName:e.userName,id:e.id};M.value.showEdit(i,"请选择负责部门/人")}};function oe(n){try{p.value=!0;let e={id:F.value,chargeUserId:n.chargeUserId,invitationType:n.invitationType,chargeUserName:n.chargeUserName,sendProjectType:n.sendProjectType,receiveProjectType:n.receiveProjectType==1?2:1};Array.isArray(e.chargeUserId)&&(e.chargeUserId=e.chargeUserId[0]),C.updateInvitationBindUser(e).then(()=>{p.value=!1,h(),B.success({message:"修改成功",center:!0})})}catch{}finally{p.value=!1}}return(n,e)=>{const i=v("el-button"),f=xe,ie=Se,se=Ue,re=v("el-row"),y=v("el-table-column"),q=v("el-text"),ce=v("el-tooltip"),ue=Le,pe=ze,O=Be,de=v("ElSpace"),fe=v("el-empty"),me=v("el-table"),ye=v("ElPagination"),ve=Ee,_e=Ie("loading");return r(),Ce("div",{class:R({"absolute-container":l(N)})},[o(ve,null,{default:a(()=>[o(re,null,{default:a(()=>[o(f,null,{default:a(()=>[o(i,{type:"primary",size:"default",onClick:K},{default:a(()=>[c(" 邀约公司 ")]),_:1})]),_:1}),o(se,null,{default:a(()=>[o(i,{size:"default"},{default:a(()=>[c(" 导出 ")]),_:1}),o(ie,{border:l(P),"onUpdate:border":e[0]||(e[0]=t=>k(P)?P.value=t:null),tableAutoHeight:l(N),"onUpdate:tableAutoHeight":e[1]||(e[1]=t=>k(N)?N.value=t:null),checkList:l(d),"onUpdate:checkList":e[2]||(e[2]=t=>k(d)?d.value=t:null),columns:l(U),"onUpdate:columns":e[3]||(e[3]=t=>k(U)?U.value=t:null),"line-height":l(S),"onUpdate:lineHeight":e[4]||(e[4]=t=>k(S)?S.value=t:null),stripe:l(j),"onUpdate:stripe":e[5]||(e[5]=t=>k(j)?j.value=t:null),style:{"margin-left":"12px"},onQueryData:h},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),Pe((r(),u(me,{border:l(P),data:l(ae),size:l(S),stripe:l(j),onSelectionChange:ne,"highlight-current-row":"",onCurrentChange:G},{empty:a(()=>[o(fe,{image:l(je),"image-size":300},null,8,["image"])]),default:a(()=>[o(y,{align:"left",type:"selection"}),l(d).includes("bindStatus")?(r(),u(y,{key:0,align:"left",prop:"bindStatus","show-overflow-tooltip":"",label:"状态",width:"100"},{default:a(({row:t})=>[_("div",He,[t.bindStatus===2?(r(),u(q,{key:0,type:"success"},{default:a(()=>[c("合作")]),_:1})):m("",!0),t.bindStatus===4?(r(),u(q,{key:1,type:"danger"},{default:a(()=>[c("解约")]),_:1})):m("",!0)])]),_:1})):m("",!0),l(d).includes("bindStatus")?(r(),u(y,{key:1,align:"left",prop:"sendProjectType",label:"发送项目",width:"160"},{default:a(({row:t})=>[o(i,{type:t.sendProjectType===1?"primary":"",size:"small",onClick:b=>A("自动",t)},{default:a(()=>[c("自动 ")]),_:2},1032,["type","onClick"]),o(i,{type:t.sendProjectType===2?"primary":"",size:"small",onClick:b=>A("手动",t)},{default:a(()=>[c("手动")]),_:2},1032,["type","onClick"])]),_:1})):m("",!0),l(d).includes("receiveProjectType")?(r(),u(y,{key:2,align:"left",prop:"receiveProjectType",label:"接收项目",width:"160"},{default:a(({row:t})=>[o(i,{type:t.receiveProjectType===1?"primary":"",size:"small",onClick:b=>H("自动",t)},{default:a(()=>[c("自动 ")]),_:2},1032,["type","onClick"]),o(i,{type:t.receiveProjectType===2?"primary":"",size:"small",onClick:b=>H("手动",t)},{default:a(()=>[c("手动")]),_:2},1032,["type","onClick"])]),_:1})):m("",!0),l(d).includes("beInvitationTenantId")?(r(),u(y,{key:3,align:"left",prop:"beInvitationTenantId",width:"200",label:"合作商ID"},{default:a(({row:t})=>[_("div",qe,[_("div",Oe,[o(ce,{effect:"dark",content:t.beInvitationTenantId,placement:"top-start"},{default:a(()=>[c(T(t.beInvitationTenantId),1)]),_:2},1032,["content"])]),o(ue,{content:t.beInvitationTenantId,class:R({rowCopy:"rowCopy",current:t.id===l(z)})},null,8,["content","class"])])]),_:1})):m("",!0),l(d).includes("beInvitationTenantName")?(r(),u(y,{key:4,align:"left",prop:"beInvitationTenantName","show-overflow-tooltip":"",label:"合作商公司名称"},{default:a(({row:t})=>[_("div",Qe,T(t.beInvitationTenantName),1)]),_:1})):m("",!0),l(d).includes("userName")?(r(),u(y,{key:5,align:"left",prop:"userName","show-overflow-tooltip":"",label:"负责部门"},{default:a(({row:t})=>[_("div",Ve,[_("div",Je,T(t.userName?t.userName:"-"),1),t.projectType!==2?(r(),u(pe,{key:0,onClick:b=>le(t,"chargeUserId"),class:R({edit:"edit",current:t.id===l(z)}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])):m("",!0)])]),_:1})):m("",!0),l(d).includes("priceRatio")?(r(),u(y,{key:6,align:"left",prop:"priceRatio","show-overflow-tooltip":"",label:"价格比例"},{default:a(({row:t})=>[_("div",we,T(t.priceRatio)+"%",1)]),_:1})):m("",!0),l(d).includes("personalPendBalance")?(r(),u(y,{key:7,align:"left",prop:"personalPendBalance","show-overflow-tooltip":"",label:"个人待审金额"},{default:a(({row:t})=>[_("div",Ge,[o(O),c(T(t.personalPendBalance||0),1)])]),_:1})):m("",!0),l(d).includes("personalAvailableBalance")?(r(),u(y,{key:8,align:"left",prop:"personalAvailableBalance","show-overflow-tooltip":"",label:"个人可用金额"},{default:a(({row:t})=>[_("div",Ke,[o(O),c(T(t.personalAvailableBalance||0),1)])]),_:1})):m("",!0),o(y,{align:"left",fixed:"right",prop:"i",label:"操作",width:"280"},{default:a(({row:t})=>[o(de,null,{default:a(()=>[o(i,{size:"small",type:"primary",plain:"",onClick:b=>Y(t)},{default:a(()=>[c(" 合作配置 ")]),_:2},1032,["onClick"]),t.bindStatus===2?(r(),u(i,{key:0,type:"danger",plain:"",size:"small",onClick:b=>W(t)},{default:a(()=>[c(" 终止合作 ")]),_:2},1032,["onClick"])):m("",!0),o(i,{type:"warning",plain:"",size:"small",onClick:b=>X(t)},{default:a(()=>[c(" 财务日志 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["border","data","size","stripe"])),[[_e,l(p)]]),o(ye,{"current-page":l(g).page,total:l(g).total,"page-size":l(g).size,"page-sizes":l(g).sizes,layout:l(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:ee,onCurrentChange:te},null,8,["current-page","total","page-size","page-sizes","layout"]),o($e,{ref_key:"editRef",ref:L,onFetchData:h},null,512),o(De,{ref_key:"proportionRef",ref:x,onFetchData:h},null,512),o(Ae,{ref_key:"financialLogRef",ref:D,onFetchData:h},null,512)]),_:1}),o(Fe,{ref_key:"QuickEditRef",ref:$,onFetchData:I},null,512),o(Me,{ref_key:"userRef",ref:M,onUserData:oe},null,512)],2)}}}),ut=Re(We,[["__scopeId","data-v-d85a9a9e"]]);export{ut as default};
