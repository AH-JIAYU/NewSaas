
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Me,am as Ke,r as c,aK as Ye,a5 as qe,c as Je,k as Ge,a as i,p as Qe,q as w,o as s,b as S,f as n,w as t,az as W,F as D,t as T,e as u,aq as x,g as r,H as v,j as d,s as ce,i as g,S as We,E as ie,N as Xe,aM as Ze,aN as et,ba as tt,ap as lt,aG as nt,aH as at,R as ot}from"./index-BHmX7FLT.js";import{_ as st}from"./index.vue_vue_type_style_index_0_lang-DmE3apAj.js";import{_ as rt}from"./index.vue_vue_type_script_setup_true_lang-o01axMGx.js";import{_ as ut}from"./index.vue_vue_type_script_setup_true_lang-CccgMf65.js";import it from"./index-BMXENi6k.js";import{_ as ct}from"./index.vue_vue_type_script_setup_true_lang-Bi9qv1YF.js";import pt from"./index-DtxlHP7i.js";import dt from"./index-Ctfgwl98.js";import{u as mt}from"./user_customer-CGLCT1Gi.js";import{u as ft}from"./configuration_manager-DxIvaKfn.js";import{a as _t}from"./project_settlement-DEDhWm6r.js";import"./user_customer-B2QHuKQr.js";const yt=R=>(nt("data-v-1b4c6002"),R=R(),at(),R),vt=yt(()=>ce("div",{class:"i-grommet-icons:power-reset h-1em w-1em"},null,-1)),gt=Me({name:"settlement",__name:"list",setup(R){const L=Ke(),P=c(),pe=mt(),X=c(),de=ft(),me=c(),A=c([]),{pagination:j,onSizeChange:fe,onCurrentChange:_e}=Ye(),ye=c(""),V=c(!0),O=c(),Z=c(),ee=c(),te=c(),le=c(),B=c(!1),F=c(!0),f=c([]);c(!1);const H=c("default"),M=c(!1),N=c([]),K=c([{label:"项目ID",prop:"projectId",sortable:!0,checked:!0},{label:"项目名称",prop:"projectName",sortable:!0,checked:!0},{label:"客户简称/标识",prop:"customerName",sortable:!0,checked:!0},{label:"原价",prop:"projectAmount",sortable:!0,checked:!0},{label:"所属国家",prop:"countryId",sortable:!0,checked:!0},{label:"系统/审核完成数",prop:"systemDone",sortable:!0,checked:!0},{label:"结算PO号",prop:"settlementPo",sortable:!0,checked:!0},{label:"结算状态",prop:"status",sortable:!0,checked:!0},{label:"节点时间",prop:"nodeTime",sortable:!0,checked:!0},{label:"备注",prop:"remark",sortable:!0,checked:!0}]),ne=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],$=c([]),p=qe({page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:[],timeType:"",startTime:"",endTime:""}),ae=c([]);function ve(a){N.value=a}function ge(a){if(N.value.length)O.value.showEdit(a,N.value);else return ie({message:"请选择至少一条数据",type:"warning"})}function be(){Z.value.showEdit()}function ke(a){if(N.value.length)O.value.showEdit(a,N.value);else return ie({message:"请选择至少一条数据",type:"warning"})}async function oe(a){ee.value.showEdit(JSON.stringify(a))}function he(a){te.value.showEdit(JSON.stringify(a))}function Ce(a){le.value.showEdit(JSON.stringify(a))}function Ie(a){fe(a).then(()=>{p.limit=a,h()})}function b(a=1){_e(a).then(()=>{p.page=a,h()})}function Se(){Object.assign(p,{page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:[],timeType:"",startTime:"",endTime:""}),$.value=[],A.value=[],h()}const we=a=>{p.countryId=a.join(","),b()},De=()=>{p.startTime=$.value[0],p.endTime=$.value[1],b()},je=a=>{if(!a||a.length===0)return"";const l=m=>{const y=m.getFullYear(),z=m.getMonth()+1,q=m.getDate();return`${y}-${z}-${q}`};if(a.length===1){const m=new Date(parseInt(a[0]));return l(m)}else if(a.length===2){const[m,y]=a.map(z=>new Date(parseInt(z)));return`${l(m)} - ${l(y)}`}return""},E=Je(()=>a=>P.value.filter(m=>a.includes(m.id)).map(m=>m.chineseName));async function h(){try{V.value=!0;const{data:a}=await _t.list(p);ae.value=a.projectSettlementList,j.value.total=+a.total,V.value=!1}catch{}finally{V.value=!1}}Ge(async()=>{P.value=await L.getCountry(),X.value=await pe.getCustomerList(),me.value=await de.getStaff(),K.value.forEach(a=>{a.checked&&f.value.push(a.prop)}),h()});function Y(a,l){switch(a){case"auditing":oe(l);break;case"edit":he(l);break;case"refundDetails":Ce(l);break}}return(a,l)=>{const m=i("el-input"),y=i("el-form-item"),z=i("ElOption"),q=i("ElSelect"),J=i("el-option"),G=i("el-select"),Ve=i("el-date-picker"),se=Xe,Q=i("ElButton"),Ne=i("ElFormItem"),$e=i("el-form"),Ee=rt,ze=i("ElDivider"),C=i("el-button"),Te=st,xe=Ze,Re=et,Ue=i("el-row"),_=i("el-table-column"),k=i("el-text"),Le=tt,U=i("el-tag"),re=i("el-link"),Pe=i("el-tooltip"),Ae=i("ElSpace"),Oe=i("el-empty"),Be=i("el-table"),Fe=i("ElPagination"),He=lt,ue=Qe("loading");return w((s(),S("div",{class:We({"absolute-container":B.value})},[n(He,null,{default:t(()=>[n(Ee,{"show-toggle":!1},{default:t(({fold:e,toggle:I})=>[n($e,{model:p,size:"default","label-width":"6.25rem","inline-message":"",inline:"",class:"search-form"},{default:t(()=>[n(y,{label:""},{default:t(()=>[n(m,{modelValue:p.projectId,"onUpdate:modelValue":l[0]||(l[0]=o=>p.projectId=o),clearable:"",placeholder:"项目ID",onKeydown:l[1]||(l[1]=W(o=>b(),["enter"]))},null,8,["modelValue"])]),_:1}),n(y,{label:""},{default:t(()=>[n(m,{modelValue:p.projectName,"onUpdate:modelValue":l[2]||(l[2]=o=>p.projectName=o),clearable:"",placeholder:"项目名称",onKeydown:l[3]||(l[3]=W(o=>b(),["enter"]))},null,8,["modelValue"])]),_:1}),n(y,{label:""},{default:t(()=>[n(m,{modelValue:p.projectIdentification,"onUpdate:modelValue":l[4]||(l[4]=o=>p.projectIdentification=o),clearable:"",placeholder:"项目标识",onKeydown:l[5]||(l[5]=W(o=>b(),["enter"]))},null,8,["modelValue"])]),_:1}),w(n(y,{label:""},{default:t(()=>[n(q,{modelValue:A.value,"onUpdate:modelValue":l[6]||(l[6]=o=>A.value=o),placeholder:"国家",clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:we},{default:t(()=>[(s(!0),S(D,null,T(P.value,o=>(s(),u(z,{label:o.chineseName,value:o.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),w(n(y,{label:""},{default:t(()=>[n(G,{placeholder:"客户简称",modelValue:p.customerId,"onUpdate:modelValue":l[7]||(l[7]=o=>p.customerId=o),clearable:"",onChange:l[8]||(l[8]=o=>b())},{default:t(()=>[(s(!0),S(D,null,T(X.value,o=>(s(),u(J,{key:o.tenantCustomerId,value:o.tenantCustomerId,label:o.customerAccord},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),w(n(y,{label:""},{default:t(()=>[n(G,{placeholder:"结算状态",modelValue:p.settlementStatus,"onUpdate:modelValue":l[9]||(l[9]=o=>p.settlementStatus=o),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:l[10]||(l[10]=o=>b())},{default:t(()=>[(s(),S(D,null,T(ne,o=>n(J,{key:o.value,value:o.value,label:o.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),w(n(y,{label:""},{default:t(()=>[n(G,{placeholder:"时间类型",modelValue:p.timeType,"onUpdate:modelValue":l[11]||(l[11]=o=>p.timeType=o),clearable:"",onChange:l[12]||(l[12]=o=>b())},{default:t(()=>[(s(),S(D,null,T(ne,o=>n(J,{key:o.value,value:o.value,label:o.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:2},1536),[[x,!e]]),w(n(y,null,{default:t(()=>[n(Ve,{modelValue:$.value,"onUpdate:modelValue":l[13]||(l[13]=o=>$.value=o),"value-format":"YYYY-MM-DD hh:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:"",size:"",onChange:De},null,8,["modelValue"])]),_:2},1536),[[x,!e]]),n(Ne,null,{default:t(()=>[n(Q,{type:"primary",onClick:l[14]||(l[14]=o=>b())},{icon:t(()=>[n(se,{name:"i-ep:search"})]),default:t(()=>[r(" 筛选 ")]),_:1}),n(Q,{onClick:Se},{icon:t(()=>[vt]),default:t(()=>[r(" 重置 ")]),_:1}),n(Q,{link:"",onClick:I},{icon:t(()=>[n(se,{name:e?"i-ep:caret-bottom":"i-ep:caret-top"},null,8,["name"])]),default:t(()=>[r(" "+v(e?"展开":"收起"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:1}),n(ze,{"border-style":"dashed"}),n(Ue,{gutter:24},{default:t(()=>[n(Te,null,{default:t(()=>[n(C,{type:"primary",size:"default",onClick:be},{default:t(()=>[r(" 新增结算 ")]),_:1}),n(C,{type:"primary",size:"default",onClick:l[15]||(l[15]=e=>ge(1))},{default:t(()=>[r(" 开票 ")]),_:1}),n(C,{type:"primary",size:"default",onClick:l[16]||(l[16]=e=>ke(2))},{default:t(()=>[r(" 结算 ")]),_:1})]),_:1}),n(Re,null,{default:t(()=>[n(C,{size:"default",onClick:l[17]||(l[17]=()=>{})},{default:t(()=>[r(" 导出 ")]),_:1}),n(xe,{border:F.value,"onUpdate:border":l[18]||(l[18]=e=>F.value=e),tableAutoHeight:B.value,"onUpdate:tableAutoHeight":l[19]||(l[19]=e=>B.value=e),checkList:f.value,"onUpdate:checkList":l[20]||(l[20]=e=>f.value=e),columns:K.value,"onUpdate:columns":l[21]||(l[21]=e=>K.value=e),"line-height":H.value,"onUpdate:lineHeight":l[22]||(l[22]=e=>H.value=e),stripe:M.value,"onUpdate:stripe":l[23]||(l[23]=e=>M.value=e),style:{"margin-left":"0.75rem"},onQueryData:b},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),w((s(),u(Be,{ref_key:"tableSortRef",ref:ye,style:{"margin-top":"10px"},"row-key":"id",data:ae.value,border:F.value,size:H.value,stripe:M.value,onSelectionChange:ve},{empty:t(()=>[n(Oe,{description:"暂无数据"})]),default:t(()=>[n(_,{align:"center",type:"selection"}),f.value.includes("projectId")?(s(),u(_,{key:0,"show-overflow-tooltip":"",prop:"projectId",align:"center",width:"180",label:"项目ID"})):d("",!0),f.value.includes("projectName")?(s(),u(_,{key:1,"show-overflow-tooltip":"",prop:"projectName",align:"center",width:"180",label:"项目名称"},{default:t(({row:e})=>[r(v(e.projectName?e.projectName:"-"),1)]),_:1})):d("",!0),f.value.includes("customerName")?(s(),u(_,{key:2,"show-overflow-tooltip":"",prop:"customerName",width:"130",align:"center",label:"客户简称/标识"},{default:t(({row:e})=>[n(k,{class:"mx-1"},{default:t(()=>[r(v(e.customerName.split("/")[0]!=="null"?e.customerName.split("/")[0]:"-"),1)]),_:2},1024),ce("p",null,v(e.customerName.split("/")[1]!=="null"?e.customerName.split("/")[1]:"-"),1)]),_:1})):d("",!0),f.value.includes("projectAmount")?(s(),u(_,{key:3,"show-overflow-tooltip":"",prop:"d",align:"center",label:"原价"},{default:t(({row:e})=>[n(Le),r(v(e.projectAmount||0),1)]),_:1})):d("",!0),f.value.includes("countryId")?(s(),u(_,{key:4,"show-overflow-tooltip":"",prop:"e",align:"center",label:"所属国家"},{default:t(({row:e})=>[e.countryId?(s(),S(D,{key:0},[e.countryId.length===g(L).country.length?(s(),u(re,{key:0,type:"primary"},{default:t(()=>[n(U,{type:"warning"},{default:t(()=>[r("全球")]),_:1})]),_:1})):g(E)(e.countryId).length>4?(s(),S(D,{key:1},[g(E)(e.countryId).length===g(L).country.length?(s(),u(U,{key:0,type:"warning"},{default:t(()=>[r("全球")]),_:1})):(s(),u(Pe,{key:1,class:"box-item",effect:"dark",content:g(E)(e.countryId).join(","),placement:"top"},{default:t(()=>[n(re,{type:"primary"},{default:t(()=>[n(U,{type:"success"},{default:t(()=>[r(v(g(E)(e.countryId).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"]))],64)):(s(!0),S(D,{key:2},T(g(E)(e.countryId),I=>(s(),u(U,{key:I,type:"primary"},{default:t(()=>[r(v(I),1)]),_:2},1024))),128))],64)):d("",!0)]),_:1})):d("",!0),f.value.includes("systemDone")?(s(),u(_,{key:5,"show-overflow-tooltip":"",prop:"systemDone",align:"center",width:"130",label:"系统/审核完成数"},{default:t(({row:e})=>[n(k,null,{default:t(()=>[r(v(e.systemDone?e.systemDone:0),1)]),_:2},1024),r(" /"),n(k,{class:"mx-1",type:"success"},{default:t(()=>[r(v(e.settlementDone?e.settlementDone:0),1)]),_:2},1024)]),_:1})):d("",!0),f.value.includes("settlementDone")?(s(),u(_,{key:6,"show-overflow-tooltip":"",prop:"settlementDone",align:"center",label:"结算完成数"})):d("",!0),f.value.includes("settlementPo")?(s(),u(_,{key:7,"show-overflow-tooltip":"",prop:"settlementPo",align:"center",label:"结算PO号"},{default:t(({row:e})=>[r(v(e.settlementPo?e.settlementPo:"-"),1)]),_:1})):d("",!0),f.value.includes("status")?(s(),u(_,{key:8,"show-overflow-tooltip":"",prop:"h",align:"center",label:"结算状态"},{default:t(({row:e})=>[e.status===1?(s(),u(k,{key:0,class:"mx-1",type:"warning"},{default:t(()=>[r("待审核")]),_:1})):d("",!0),e.status===3?(s(),u(k,{key:1,class:"mx-1",type:"success"},{default:t(()=>[r("已开票")]),_:1})):d("",!0),e.status===4?(s(),u(k,{key:2,class:"mx-1",type:"info"},{default:t(()=>[r("已结算")]),_:1})):d("",!0),e.status===2?(s(),u(k,{key:3,class:"mx-1",type:"primary"},{default:t(()=>[r("已审核")]),_:1})):d("",!0),e.status===5?(s(),u(k,{key:4,class:"mx-1",type:"danger"},{default:t(()=>[r("已冻结")]),_:1})):d("",!0)]),_:1})):d("",!0),f.value.includes("nodeTime")?(s(),u(_,{key:9,"show-overflow-tooltip":"",prop:"nodeTime",align:"center",label:"节点时间"},{default:t(({row:e})=>[e.nodeTime.length?(s(),u(k,{key:0,class:"mx-1"},{default:t(()=>[r(v(je(e.nodeTime)),1)]),_:2},1024)):(s(),u(k,{key:1,class:"mx-1"},{default:t(()=>[r("-")]),_:1}))]),_:1})):d("",!0),f.value.includes("remark")?(s(),u(_,{key:10,"show-overflow-tooltip":"",prop:"remark",align:"center",label:"备注"},{default:t(({row:e})=>[r(v(e.remark?e.remark:"-"),1)]),_:1})):d("",!0),n(_,{align:"center",fixed:"right",label:"操作",width:"250"},{default:t(({row:e})=>[n(Ae,null,{default:t(()=>[e.status===1?(s(),u(C,{key:0,type:"primary",size:"small",plain:"",onClick:I=>oe(e)},{default:t(()=>[r(" 审核 ")]),_:2},1032,["onClick"])):d("",!0),e.status===5?(s(),u(C,{key:1,type:"primary",size:"small",plain:"",onClick:I=>Y("auditing",e)},{default:t(()=>[r(" 重审 ")]),_:2},1032,["onClick"])):d("",!0),n(C,{type:"primary",size:"small",plain:"",onClick:I=>Y("edit",e)},{default:t(()=>[r(" 结算编辑 ")]),_:2},1032,["onClick"]),n(C,{type:"primary",size:"small",plain:"",onClick:I=>Y("refundDetails",e)},{default:t(()=>[r(" 退款详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","border","size","stripe"])),[[ue,V.value]]),n(Fe,{"current-page":g(j).page,total:g(j).total,"page-size":g(j).size,"page-sizes":g(j).sizes,layout:g(j).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Ie,onCurrentChange:b},null,8,["current-page","total","page-size","page-sizes","layout"]),n(ut,{onSuccess:h,ref_key:"invoicingRef",ref:O},null,512),n(it,{onSuccess:h,ref_key:"auditingRef",ref:ee},null,512),n(ct,{onSuccess:h,ref_key:"editRef",ref:te},null,512),n(pt,{ref_key:"refundRef",ref:le},null,512),n(dt,{onSuccess:h,ref_key:"addSettlementRef",ref:Z},null,512)]),_:1})],2)),[[ue,V.value]])}}}),Et=ot(gt,[["__scopeId","data-v-1b4c6002"]]);export{Et as default};
