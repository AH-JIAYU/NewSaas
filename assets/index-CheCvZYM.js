
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ce,m as J,r as d,l as pe,u as me,c as fe,n as ve,a as i,o as c,e as g,w as a,y as h,f as t,g as v,i as s,b as L,t as T,F as q,z as O,j as G,p as Q,E as W,aH as _e,aI as ge,L as he}from"./index-CiUEwP-Q.js";import{a as ye}from"./department-CXasS277.js";import{a as be}from"./position_manage-KMlMiLfY.js";import{u as ke}from"./tenant_role-DtthTVhU.js";import{u as xe}from"./configuration_manager-CX7qQtHi.js";import"./configuration_role-Ch-Pyg2g.js";const X=y=>(_e("data-v-e561a745"),y=y(),ge(),y),Ve=X(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"基本信息")],-1)),we={class:"card-header"},Ce={class:"leftTitle"},Ie={key:0,style:{"margin-left":"20px","font-size":".875rem"}},Se=X(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"角色信息")],-1)),Ee={class:"flex-c"},Le=ce({__name:"index",props:J(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:J(["success","getList"],["update:modelValue"]),setup(y,{emit:Y}){const ee=xe(),D=d([]),F=d(),ae=pe(),le=d(),te=ke(),N=d(),H=d(),oe=d(!1),Z=d(),$=d(),m=y,C=Y,b=d(),z=me(y,"modelValue"),se=fe(()=>m.id===""?"新增用户":"编辑用户"),ne={children:"children",label:"name"},_=d(),re=d([]),e=d({id:m.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"123456",roleList:[],role:"",active:!0,positionId:"",organizationalStructureId:""}),p=d([]),I=d({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{validator:(r,o,n)=>{const u=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;e.value.phone?u.test(e.value.phone)?n():n(new Error("请输入合法手机号")):n()},trigger:"blur"}],email:[{validator:(r,o,n)=>{const u=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e.value.email?u.test(e.value.email)?n():n(new Error("请输入合法邮箱")):n()},trigger:"blur"}]}),ue=r=>{Array.isArray(r)&&r.length>1&&(e.value.roleList=[r[r.length-1]])};function de(){e.value.email||(I.value.email=[],_.value.clearValidate("email")),e.value.phone||(I.value.phone=[],_.value.clearValidate("phone")),p.value=b.value.getCheckedKeys(!1);const r=b.value.getCheckedKeys(),o=b.value.getHalfCheckedKeys(),n=r.concat(o);e.value.organizationalStructureId=n[0],e.value.roleList.length>0?(e.value.role=e.value.roleList[0],delete e.value.roleList):e.value.role="",e.value.id?_.value&&_.value.validate(u=>{if(u){const{id:f,phone:B,email:P,password:k,name:V,country:w,active:U,type:M,role:R,positionId:A,organizationalStructureId:E,userName:K}=e.value,l={id:f,phone:B,email:P,password:k,name:V,country:w,active:U,type:M,role:R,positionId:A,organizationalStructureId:E,userName:K};$.value===l.phone&&delete l.phone,Z.value===l.email&&delete l.email,l.password||delete l.password,Q.edit(l).then(()=>{W.success({message:"编辑成功",center:!0}),C("success"),C("getList"),S()})}}):_.value&&_.value.validate(u=>{u&&Q.create(e.value).then(()=>{W.success({message:"新增成功",center:!0}),C("success"),C("getList"),S()})})}function S(){z.value=!1}const j=r=>r==null?void 0:r.reduce((o,n)=>Array.isArray(n)?o.concat(j(n)):o.concat(n),[]),ie=(r,o)=>{o?(b.value.getCheckedKeys().forEach(u=>{u!==r.id&&b.value.setChecked(u,!1)}),p.value=[r.id]):p.value=p.value.filter(n=>n!==r.id)};return ve(async()=>{p.value=[],p.value.push(m.parentId);const{data:r}=await be.list({page:1,limit:10,id:null,name:"",active:null});F.value=r.data,D.value=await ee.getStaff(),N.value=await te.getRole();const o=await ye.list({name:""});o.data&&(H.value=o.data),le.value=await ae.getCountry(),m.id!==""&&m.row&&(I.value.password=[],e.value=JSON.parse(m.row),e.value.roleList=[e.value.role],p.value||(p.value=[]),p.value.push(m.parentId),Z.value=e.value.email,$.value=e.value.phone,oe.value=!0),re.value=j(m.dataList)}),(r,o)=>{const n=i("el-input"),u=i("el-form-item"),f=i("el-col"),B=i("el-option"),P=i("el-select"),k=i("el-text"),V=i("el-row"),w=i("el-card"),U=i("el-tree"),M=i("el-checkbox"),R=i("el-checkbox-group"),A=i("ElForm"),E=i("ElButton"),K=i("ElDrawer");return c(),g(K,{modelValue:z.value,"onUpdate:modelValue":o[7]||(o[7]=l=>z.value=l),title:s(se),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:S},{footer:a(()=>[h("div",Ee,[t(E,{size:"large",onClick:S},{default:a(()=>[v(" 取消 ")]),_:1}),t(E,{type:"primary",size:"large",onClick:de},{default:a(()=>[v(" 确定 ")]),_:1})])]),default:a(()=>[t(A,{ref_key:"formRef",ref:_,model:s(e),rules:s(I),"label-width":"100px","validate-on-rule-change":!1},{default:a(()=>[t(w,{class:"box-card"},{header:a(()=>[Ve]),default:a(()=>[t(V,{gutter:24},{default:a(()=>[t(f,{span:8},{default:a(()=>[t(u,{label:"用户名",prop:"userName"},{default:a(()=>[t(n,{modelValue:s(e).userName,"onUpdate:modelValue":o[0]||(o[0]=l=>s(e).userName=l),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"姓名",prop:""},{default:a(()=>[t(n,{modelValue:s(e).name,"onUpdate:modelValue":o[1]||(o[1]=l=>s(e).name=l),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"手机号",prop:"phone"},{default:a(()=>[t(n,{modelValue:s(e).phone,"onUpdate:modelValue":o[2]||(o[2]=l=>s(e).phone=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"邮箱",prop:"email"},{default:a(()=>[t(n,{modelValue:s(e).email,"onUpdate:modelValue":o[3]||(o[3]=l=>s(e).email=l),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"职位",prop:""},{default:a(()=>[t(P,{modelValue:s(e).positionId,"onUpdate:modelValue":o[4]||(o[4]=l=>s(e).positionId=l),placeholder:"请选择职位",clearable:"",filterable:"",onChange:o[5]||(o[5]=()=>{})},{default:a(()=>[(c(!0),L(q,null,T(s(F),l=>(c(),g(B,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(u,{label:"初始密码",prop:""},{default:a(()=>[t(k,null,{default:a(()=>[v("123456")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:a(()=>[h("div",we,[h("div",Ce,[v(" 部门信息"),s(e).enableChargePerson?(c(),L("span",Ie,[v("PM:"),(c(!0),L(q,null,T(s(D),l=>(c(),g(k,{key:l.id},{default:a(()=>[l.id===s(e).id?(c(),g(k,{key:0},{default:a(()=>[v(O(l.userName),1)]),_:2},1024)):G("",!0)]),_:2},1024))),128))])):G("",!0)])])]),default:a(()=>[t(V,{gutter:24},{default:a(()=>[t(u,{label:"分配部门:"},{default:a(()=>[t(U,{style:{"max-width":"600px"},ref_key:"treeRef",ref:b,data:s(H),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":s(p),"default-expand-all":"",props:ne,onCheckChange:ie},null,8,["data","default-checked-keys"])]),_:1})]),_:1})]),_:1}),t(w,{class:"box-card"},{header:a(()=>[Se]),default:a(()=>[t(V,{gutter:24},{default:a(()=>[t(u,{label:"分配角色:"},{default:a(()=>{var l;return[(l=s(N))!=null&&l.length?(c(),g(R,{key:0,modelValue:s(e).roleList,"onUpdate:modelValue":o[6]||(o[6]=x=>s(e).roleList=x),onChange:ue},{default:a(()=>[(c(!0),L(q,null,T(s(N),x=>(c(),g(M,{key:x.id,label:x.roleName,value:x.roleName},{default:a(()=>[v(O(x.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):(c(),g(k,{key:1},{default:a(()=>[v("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ke=he(Le,[["__scopeId","data-v-e561a745"]]);export{Ke as default};
