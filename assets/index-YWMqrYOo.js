
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as X,B as j,ae as Y,r as v,C as Z,E as ee,o as ae,aj as q,a2 as u,al as te,a as g,c as P,w as s,f as n,g as S,t as x,h as a,a3 as V,i as C,O as z,N as D,b,aG as N,ai as U,y as oe}from"./index-C7IrLSdY.js";import{a as O}from"./department-DdWNxXae.js";const le={class:"user"},ne={class:"mr checkbox-container"},se={class:"centers mr"},ie={class:"center mr"},re={class:"center mr"},ue=X({__name:"index",props:j({parentId:{default:""},id:{default:""},tree:{},row:{},isClick:{type:Boolean}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["getList","getItmelist"],["update:modelValue"]),setup(B,{emit:R}){const{t}=Y(),y=v([]),w=B,M=v(!1),A=[{label:t("configuration.department.new.completeProvision"),value:1},{label:t("configuration.department.new.auditAccrual"),value:2},{label:t("configuration.department.new.settlementProvision"),value:3}],G=[{label:t("configuration.department.new.atProjectPrice"),value:1},{label:t("configuration.department.new.atcostPrice"),value:2},{label:t("configuration.department.new.grossProfit"),value:3}],f=v(!1),L=R,h=Z(B,"modelValue"),J=ee(()=>w.id===""?t("configuration.department.new.add"):t("configuration.department.new.edit")),F=v([]),k=v(),e=v({parentId:w.parentId,name:"",remark:"",userIdList:[],organizationalStructurePersonList:[],commission:null,commissionTime:null,commissionStatus:2,commissionType:null}),$=v({name:[{required:!0,message:t("configuration.department.new.enterDepartmentName")}],commissionType:[{required:!0,message:t("configuration.department.new.selectAccrualMethod"),trigger:"change"}]});async function H(){try{k.value&&await k.value.validate(async i=>{if(i){if(f.value=!0,e.value.organizationalStructurePersonList=[],e.value.commissionStatus===1&&!/^[1-9]\d*$/.test(e.value.commission)){U.warning({message:t("configuration.department.new.rate"),center:!0}),f.value=!1;return}e.value.commission=e.value.commission?e.value.commission:0,e.value.commissionTime=e.value.commissionTime?e.value.commissionTime:1,e.value.commissionType=e.value.commissionType?e.value.commissionType:1,e.value.userIdList.map(c=>{const d={userId:c};e.value.organizationalStructurePersonList.push(d)});const l={...e.value};delete l.userIdList;let r;e.value.id?r=await O.edit(l):r=await O.create(l);const{status:m}=r;m===1?U.success({message:e.value.id?t("common.editSuccess"):t("common.addSuccess"),center:!0}):U.error(t("configuration.department.new.failure")),M.value?(await L("getItmelist"),await L("getList")):await L("getList"),I()}})}catch{}finally{f.value=!1}}function I(){Object.assign(e,{parentId:"",name:"",remark:"",userIdList:[],organizationalStructurePersonList:[],commission:null,commissionTime:null,commissionStatus:2,commissionType:null}),h.value=!1}const K=()=>y.value.filter(i=>{var l;return(l=e.value)==null?void 0:l.userIdList.includes(i.id)});return ae(async()=>{try{if(f.value=!0,w.id){const{id:i,name:l,remark:r,organizationalStructurePersonList:m,commission:c,commissionTime:d,commissionStatus:T,commissionType:E}=JSON.parse(w.row);e.value.id=i,e.value.name=l,e.value.remark=r,M.value=w.isClick,e.value.commission=c,e.value.commissionTime=d,e.value.commissionStatus=T,e.value.commissionType=E;const{data:_}=await q.queryNotEnableStaffList({organizationalStructureId:e.value.id});_&&(y.value=_),e.value.organizationalStructurePersonList=[],m?(m.forEach(p=>{p.enableChargePerson==1&&e.value.organizationalStructurePersonList.push(p)}),e.value.organizationalStructurePersonList.forEach(p=>{e.value.userIdList.push(p.userId)})):e.value.organizationalStructurePersonList=[]}else{const{data:i}=await q.queryAllNotEnableStaffList();i&&(y.value=i)}F.value=K(),e.value.id&&(F.value=e.value.organizationalStructurePersonList)}catch(i){console.error("Error occurred:",i)}finally{f.value=!1}}),(i,l)=>{const r=u("ElInput"),m=u("ElFormItem"),c=u("el-option"),d=u("el-select"),T=u("el-text"),E=u("el-switch"),_=u("ElForm"),p=u("ElButton"),Q=u("ElDialog"),W=te("loading");return g(),P(Q,{modelValue:h.value,"onUpdate:modelValue":l[7]||(l[7]=o=>h.value=o),title:a(J),style:{width:"48rem"},"close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:I},{footer:s(()=>[n(p,{size:"large",onClick:I},{default:s(()=>[S(x(a(t)("common.cancel")),1)]),_:1}),n(p,{type:"primary",size:"large",onClick:H},{default:s(()=>[S(x(a(t)("common.confirm")),1)]),_:1})]),default:s(()=>[V((g(),P(_,{ref_key:"formRef",ref:k,model:a(e),rules:a($),"label-width":"7rem"},{default:s(()=>[n(m,{label:a(t)("configuration.department.new.departmentName"),prop:"name"},{default:s(()=>[n(r,{modelValue:a(e).name,"onUpdate:modelValue":l[0]||(l[0]=o=>a(e).name=o),placeholder:a(t)("configuration.department.new.enterDepartmentName"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(m,{label:a(t)("configuration.department.new.departmentSupervisor"),prop:""},{default:s(()=>[n(d,{modelValue:a(e).userIdList,"onUpdate:modelValue":l[1]||(l[1]=o=>a(e).userIdList=o),"value-key":"",placeholder:a(t)("configuration.department.new.selectDepartmentSupervisor"),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",clearable:"",filterable:""},{default:s(()=>[(g(!0),C(D,null,z(a(y),o=>(g(),P(c,{key:o.value,label:o.userName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(m,{label:a(t)("common.remark")},{default:s(()=>[n(r,{modelValue:a(e).remark,"onUpdate:modelValue":l[2]||(l[2]=o=>a(e).remark=o),placeholder:a(t)("configuration.department.new.enterRemark"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),b("div",le,[b("div",ne,[n(T,{style:{width:"4.375rem"}},{default:s(()=>[S(x(a(t)("configuration.department.new.openCommission")),1)]),_:1}),n(E,{modelValue:a(e).commissionStatus,"onUpdate:modelValue":l[3]||(l[3]=o=>a(e).commissionStatus=o),"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":a(t)("common.on"),"inactive-text":a(t)("common.off")},null,8,["modelValue","active-text","inactive-text"])]),V(b("div",se,[n(d,{modelValue:a(e).commissionType,"onUpdate:modelValue":l[4]||(l[4]=o=>a(e).commissionType=o),"value-key":"",placeholder:a(t)("configuration.department.new.accrualMethod"),clearable:"",filterable:""},{default:s(()=>[(g(),C(D,null,z(G,o=>n(c,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])],512),[[N,a(e).commissionStatus===1]]),V(b("div",ie,[n(d,{class:"select",modelValue:a(e).commissionTime,"onUpdate:modelValue":l[5]||(l[5]=o=>a(e).commissionTime=o),"value-key":"",placeholder:a(t)("configuration.department.new.accrualTime"),clearable:"",filterable:""},{default:s(()=>[(g(),C(D,null,z(A,o=>n(c,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])],512),[[N,a(e).commissionStatus===1]]),V(b("div",re,[n(r,{modelValue:a(e).commission,"onUpdate:modelValue":l[6]||(l[6]=o=>a(e).commission=o),placeholder:a(t)("configuration.department.new.percentageOfCommissions"),style:{"max-width":"25rem"},clearable:""},{append:s(()=>[S("%")]),_:1},8,["modelValue","placeholder"])],512),[[N,a(e).commissionStatus===1]])])]),_:1},8,["model","rules"])),[[W,a(f)]])]),_:1},8,["modelValue","title"])}}}),de=oe(ue,[["__scopeId","data-v-eb313190"]]);export{de as default};
