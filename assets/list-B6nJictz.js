
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Re,am as Ee,r as i,aO as Pe,a4 as Be,c as Oe,k as Ae,a as y,p as Ue,q as te,o,b as L,f as a,w as l,g as r,e as s,i as g,aN as He,s as p,A as f,j as c,F as le,t as Ve,O as x,E as ne,aQ as Fe,aR as Me,be as Je,_ as qe,ap as Qe,M as Ye}from"./index-BZHzFsqK.js";import{_ as Ge}from"./index-D4TP2loM.js";import{_ as Ke}from"./index.vue_vue_type_style_index_0_lang-Cc8tUOW7.js";import{_ as We}from"./index-CNPIX_O7.js";import{_ as Xe}from"./index.vue_vue_type_script_setup_true_lang-CUP5Zg4-.js";import Ze from"./index-Dz2Zjv8k.js";import{_ as et}from"./index.vue_vue_type_script_setup_true_lang-DkIktvFX.js";import tt from"./index-DcnKOnuy.js";import lt from"./index-Dl6J5rz3.js";import{u as nt}from"./user_customer-BpunjDvG.js";import{u as at}from"./configuration_manager-ByoXVEKr.js";import{a as ot}from"./project_settlement-Dki4_hqX.js";import"./index-i-qSCPp-.js";import"./index.vue_vue_type_script_setup_true_lang-AwLN4ZYG.js";import"./sortable.esm-C0-Qcoum.js";import"./user_customer-BTOEpQZp.js";const st={class:"copyId"},it={class:"id oneLine tableSmall"},rt={class:"oneLine tableBig"},ct={class:"oneLine"},ut={class:"oneLine"},pt={class:"tableBig"},dt={key:0,class:"oneLine"},mt=["src"],ft={class:"tableBig"},_t={class:"flex-c tableBig"},yt={class:"oneLine",style:{width:"calc(100% - 20px)"}},gt={class:"flex-c tableBig"},vt={class:"oneLine",style:{width:"calc(100% - 40px)"}},ht={class:"flex-c tableBig"},bt={class:"oneLine",style:{width:"calc(100% - 20px)"}},kt=Re({name:"settlement",__name:"list",setup(St){const F=Ee(),M=i(),ae=nt(),J=i(),oe=at(),se=i(),ie=i([]),{pagination:k,onSizeChange:re,onCurrentChange:ce}=Pe(),ue=i(""),S=i(!0),z=i(),q=i(),Q=i(),w=i(),Y=i(),T=i(!1),$=i(!1),d=i([]);i(!1);const R=i("default"),E=i(!1),C=i([]),P=i([{label:"项目ID",prop:"projectId",sortable:!0,checked:!0},{label:"项目名称",prop:"projectName",sortable:!0,checked:!0},{label:"客户简称/标识",prop:"customerName",sortable:!0,checked:!0},{label:"原价",prop:"projectAmount",sortable:!0,checked:!0},{label:"所属国家",prop:"countryId",sortable:!0,checked:!0},{label:"系统/审核完成数",prop:"systemDone",sortable:!0,checked:!0},{label:"结算PO号",prop:"settlementPo",sortable:!0,checked:!0},{label:"结算状态",prop:"status",sortable:!0,checked:!0},{label:"节点时间",prop:"nodeTime",sortable:!0,checked:!0},{label:"备注",prop:"remark",sortable:!0,checked:!0}]),G=i(),pe=i("formSearch-settlement"),K=[{label:"待审核",value:1},{label:"已审核",value:2},{label:"已开票",value:3},{label:"已结算",value:4},{label:"已冻结",value:5}],v=Be({page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:"",timeType:"",time:[],startTime:"",endTime:""}),W=i([]);function de(t){C.value=t}const I=i();function me(t){t?I.value=t.projectId:I.value=""}function fe(t){if(C.value.length)z.value.showEdit(t,C.value);else return ne({message:"请选择至少一条数据",type:"warning"})}function _e(){q.value.showEdit()}function ye(t){if(C.value.length)z.value.showEdit(t,C.value);else return ne({message:"请选择至少一条数据",type:"warning"})}async function X(t){Q.value.showEdit(JSON.stringify(t))}function ge(t){w.value.showEdit(JSON.stringify(t),"")}function B(t,n){w.value.showEdit(JSON.stringify(t),n)}function ve(t){Y.value.showEdit(JSON.stringify(t))}function he(t){re(t).then(()=>{v.limit=t,b()})}function O(t=1){ce(t).then(()=>{v.page=t,b()})}function be(){Object.assign(v,{page:1,limit:10,projectId:null,projectName:"",customerId:null,projectIdentification:"",countryId:"",createUserId:null,settlementStatus:"",timeType:"",time:[],startTime:"",endTime:""}),ie.value=[],b()}const ke=t=>{if(!t||t.length===0)return"";const n=m=>{const N=m.getFullYear(),u=m.getMonth()+1,U=m.getDate();return`${N}-${u}-${U}`};if(t.length===1){const m=new Date(parseInt(t[0]));return n(m)}else if(t.length===2){const[m,N]=t.map(u=>new Date(parseInt(u)));return`${n(m)} - ${n(N)}`}return""},D=Oe(()=>t=>M.value.filter(m=>t.includes(m.id)).map(m=>m.chineseName));async function b(){try{S.value=!0;const t={...v};Array.isArray(v.countryId)&&(t.countryId=t.countryId.join(",")),v.time&&v.time.length&&(t.beginTime=t.time[0]||"",t.endTime=t.time[1]||""),v.settlementStatus?t.settlementStatus=[t.settlementStatus]:t.settlementStatus=[];const{data:n}=await ot.list(t);W.value=n.projectSettlementList,k.value.total=+n.total,S.value=!1}catch{}finally{S.value=!1}}Ae(async()=>{M.value=await F.getCountry(),J.value=await ae.getCustomerList(),se.value=await oe.getStaff(),P.value.forEach(t=>{t.checked&&d.value.push(t.prop)}),b(),G.value=[{index:1,show:!0,type:"input",modelName:"projectId",placeholder:"项目ID"},{index:2,show:!0,type:"input",modelName:"projectName",placeholder:"项目名称"},{index:3,show:!0,type:"input",modelName:"projectIdentification",placeholder:"项目标识"},{index:4,show:!0,type:"select",modelName:"countryData",placeholder:"国家",option:"global",optionLabel:"chineseName",optionValue:"id"},{index:5,show:!0,type:"select",modelName:"customerId",placeholder:"客户简称",option:"customerId",optionLabel:"tenantCustomerId",optionValue:"tenantCustomerId"},{index:6,show:!0,type:"select",modelName:"settlementStatus",placeholder:"结算状态",option:"settlementStatus",optionLabel:"label",optionValue:"value"},{index:7,show:!0,type:"select",modelName:"timeType",placeholder:"时间类型",option:"timeType",optionLabel:"label",optionValue:"value"},{index:8,show:!0,type:"datetimerange",modelName:"timeArr",startPlaceHolder:"开始日期",endPlaceHolder:"结束日期"}]});const Se={customerId:()=>J.value,settlementStatus:()=>K,timeType:()=>K};function A(t,n){switch(t){case"auditing":X(n);break;case"edit":ge(n);break;case"refundDetails":ve(n);break}}return(t,n)=>{const m=We,N=y("ElDivider"),u=y("el-button"),U=Ke,Ce=Fe,Ie=Me,Ne=y("el-row"),_=y("el-table-column"),Z=Ge,De=Je,H=y("el-tag"),je=y("el-link"),Le=y("el-tooltip"),j=y("el-text"),V=qe,xe=y("ElSpace"),ze=y("el-empty"),we=y("el-table"),Te=y("ElPagination"),$e=Qe,ee=Ue("loading");return te((o(),L("div",{class:x({"absolute-container":T.value})},[a($e,null,{default:l(()=>[a(m,{formSearchList:G.value,formSearchName:pe.value,onCurrentChange:O,onOnReset:be,model:v,formOption:Se},null,8,["formSearchList","formSearchName","model"]),a(N,{"border-style":"dashed"}),a(Ne,{gutter:24},{default:l(()=>[a(U,null,{default:l(()=>[a(u,{type:"primary",size:"default",onClick:_e},{default:l(()=>[r(" 新增结算 ")]),_:1}),a(u,{type:"primary",size:"default",onClick:n[0]||(n[0]=e=>fe(1))},{default:l(()=>[r(" 开票 ")]),_:1}),a(u,{type:"primary",size:"default",onClick:n[1]||(n[1]=e=>ye(2))},{default:l(()=>[r(" 结算 ")]),_:1})]),_:1}),a(Ie,null,{default:l(()=>[a(u,{size:"default",onClick:n[2]||(n[2]=()=>{})},{default:l(()=>[r(" 导出 ")]),_:1}),a(Ce,{border:$.value,"onUpdate:border":n[3]||(n[3]=e=>$.value=e),tableAutoHeight:T.value,"onUpdate:tableAutoHeight":n[4]||(n[4]=e=>T.value=e),checkList:d.value,"onUpdate:checkList":n[5]||(n[5]=e=>d.value=e),columns:P.value,"onUpdate:columns":n[6]||(n[6]=e=>P.value=e),"line-height":R.value,"onUpdate:lineHeight":n[7]||(n[7]=e=>R.value=e),stripe:E.value,"onUpdate:stripe":n[8]||(n[8]=e=>E.value=e),style:{"margin-left":"0.75rem"},onQueryData:O},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),te((o(),s(we,{ref_key:"tableSortRef",ref:ue,style:{"margin-top":"10px"},"row-key":"id",data:W.value,border:$.value,size:R.value,stripe:E.value,"highlight-current-row":"",onSelectionChange:de,onCurrentChange:me},{empty:l(()=>[a(ze,{image:g(He),"image-size":300},null,8,["image"])]),default:l(()=>[a(_,{align:"left",type:"selection"}),d.value.includes("projectId")?(o(),s(_,{key:0,"show-overflow-tooltip":"",prop:"projectId",align:"left",label:"项目"},{default:l(({row:e})=>[p("div",st,[p("div",it,"ID: "+f(e.projectId),1),a(Z,{class:"copy",content:e.projectId},null,8,["content"])])]),_:1})):c("",!0),d.value.includes("projectName")?(o(),s(_,{key:1,"show-overflow-tooltip":"",prop:"projectName",align:"left",label:"名称/标识"},{default:l(({row:e})=>[p("b",rt,"名: "+f(e.projectName?e.projectName:"-"),1),p("div",ct,"标: "+f(e.customerName.split("/")[1]!=="null"?e.customerName.split("/")[1]:"-"),1)]),_:1})):c("",!0),d.value.includes("customerName")?(o(),s(_,{key:2,"show-overflow-tooltip":"",prop:"customerName",align:"left",label:"客户"},{default:l(({row:e})=>[p("div",ut,[p("b",pt,f(e.customerName.split("/")[0]),1),e.projectType!==2?(o(),L("div",dt,[p("img",{src:e.avatar,alt:"",class:"avatar"},null,8,mt),p("span",null,f(e.userName),1)])):c("",!0)])]),_:1})):c("",!0),d.value.includes("projectAmount")?(o(),s(_,{key:3,"show-overflow-tooltip":"",align:"left",label:"原价",width:"80"},{default:l(({row:e})=>[p("div",ft,[a(De),r(f(e.projectAmount||0),1)])]),_:1})):c("",!0),d.value.includes("countryId")?(o(),s(_,{key:4,"show-overflow-tooltip":"",align:"left",label:"国家"},{default:l(({row:e})=>[e.countryId?(o(),L(le,{key:0},[e.countryId.length>=g(F).country.length?(o(),s(H,{key:0,type:"primary"},{default:l(()=>[r("全球")]),_:1})):g(D)(e.countryId).length>1?(o(),s(Le,{key:1,class:"box-item",effect:"dark",content:g(D)(e.countryId).join(","),placement:"top"},{default:l(()=>[a(je,{type:"primary"},{default:l(()=>[a(H,{type:"primary"},{default:l(()=>[r("×"+f(g(D)(e.countryId).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])):(o(!0),L(le,{key:2},Ve(g(D)(e.countryId),h=>(o(),s(H,{key:h,type:"primary"},{default:l(()=>[r(f(h),1)]),_:2},1024))),128))],64)):c("",!0)]),_:1})):c("",!0),d.value.includes("systemDone")?(o(),s(_,{key:5,"show-overflow-tooltip":"",prop:"systemDone",align:"left",label:"系统/审核完成数"},{default:l(({row:e})=>[p("div",_t,[p("div",yt,[a(j,null,{default:l(()=>[r(f(e.systemDone?e.systemDone:0),1)]),_:2},1024),r(" /"),a(j,{class:"mx-1",type:"success"},{default:l(()=>[r(f(e.settlementDone?e.settlementDone:0),1)]),_:2},1024)]),a(V,{onClick:h=>B(e,"systemDone"),class:x({edit:"edit",current:e.projectId===I.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):c("",!0),d.value.includes("settlementDone")?(o(),s(_,{key:6,"show-overflow-tooltip":"",prop:"settlementDone",align:"left",label:"结算完成数"})):c("",!0),d.value.includes("settlementPo")?(o(),s(_,{key:7,"show-overflow-tooltip":"",prop:"settlementPo",align:"left",label:"结算PO号"},{default:l(({row:e})=>[p("div",gt,[p("div",vt,f(e.settlementPo?e.settlementPo:"-"),1),e.settlementPo?(o(),s(Z,{key:0,class:"copy",content:e.settlementPo},null,8,["content"])):c("",!0),a(V,{onClick:h=>B(e,"settlementPo"),class:x({edit:"edit",current:e.projectId===I.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):c("",!0),d.value.includes("nodeTime")?(o(),s(_,{key:8,"show-overflow-tooltip":"",prop:"nodeTime",align:"left",label:"节点"},{default:l(({row:e})=>[e.status===1?(o(),s(u,{key:0,size:"small",class:"p-1",type:"warning"},{default:l(()=>[r("待审核")]),_:1})):c("",!0),e.status===3?(o(),s(u,{key:1,size:"small",class:"p-1",type:"success"},{default:l(()=>[r("已开票")]),_:1})):c("",!0),e.status===4?(o(),s(u,{key:2,size:"small",class:"p-1",type:"info"},{default:l(()=>[r("已结算")]),_:1})):c("",!0),e.status===2?(o(),s(u,{key:3,size:"small",class:"p-1",type:"primary"},{default:l(()=>[r("已审核")]),_:1})):c("",!0),e.status===5?(o(),s(u,{key:4,size:"small",class:"p-1",type:"danger"},{default:l(()=>[r("已冻结")]),_:1})):c("",!0),e.nodeTime.length?(o(),s(j,{key:5,class:"mx-1 tableBig"},{default:l(()=>[r(f(ke(e.nodeTime)),1)]),_:2},1024)):(o(),s(j,{key:6,class:"mx-1 tableBig"},{default:l(()=>[r("-")]),_:1}))]),_:1})):c("",!0),d.value.includes("remark")?(o(),s(_,{key:9,"show-overflow-tooltip":"",prop:"remark",align:"left",label:"备注"},{default:l(({row:e})=>[p("div",ht,[p("div",bt,f(e.remark?e.remark:"-"),1),a(V,{onClick:h=>B(e,"remark"),class:x({edit:"edit",current:e.projectId===I.value}),name:"i-ep:edit",color:"#409eff"},null,8,["onClick","class"])])]),_:1})):c("",!0),a(_,{align:"left",fixed:"right",label:"操作",width:"250"},{default:l(({row:e})=>[a(xe,null,{default:l(()=>[e.status===1?(o(),s(u,{key:0,type:"primary",size:"small",plain:"",onClick:h=>X(e)},{default:l(()=>[r(" 审核 ")]),_:2},1032,["onClick"])):c("",!0),e.status===5?(o(),s(u,{key:1,type:"primary",size:"small",plain:"",onClick:h=>A("auditing",e)},{default:l(()=>[r(" 重审 ")]),_:2},1032,["onClick"])):c("",!0),a(u,{type:"warning",size:"small",plain:"",onClick:h=>A("edit",e)},{default:l(()=>[r(" 结算编辑 ")]),_:2},1032,["onClick"]),a(u,{type:"danger",size:"small",plain:"",onClick:h=>A("refundDetails",e)},{default:l(()=>[r(" 退款详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","border","size","stripe"])),[[ee,S.value]]),a(Te,{"current-page":g(k).page,total:g(k).total,"page-size":g(k).size,"page-sizes":g(k).sizes,layout:g(k).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:he,onCurrentChange:O},null,8,["current-page","total","page-size","page-sizes","layout"]),a(Xe,{onSuccess:b,ref_key:"invoicingRef",ref:z},null,512),a(Ze,{onSuccess:b,ref_key:"auditingRef",ref:Q},null,512),a(et,{onSuccess:b,ref_key:"editRef",ref:w},null,512),a(tt,{ref_key:"refundRef",ref:Y},null,512),a(lt,{onSuccess:b,ref_key:"addSettlementRef",ref:q},null,512)]),_:1})],2)),[[ee,S.value]])}}}),At=Ye(kt,[["__scopeId","data-v-1c47b5df"]]);export{At as default};
