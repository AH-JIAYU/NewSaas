
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-Bd2kbbLW.js";import{x as S,af as R,d as U,r as O,a as T,o as _,b as m,f as u,w as c,s as t,g as i,F as j,t as N,S as B,i as I,H as a,e as A,j as M,I as F,aJ as H,aK as q,R as J}from"./index-D7ktWcYH.js";const E={list:d=>S.post("tenantBind/getProjectAllocationList",d),meList:d=>S.post("tenantBind/getProjectMeAllocationList",d),getTenantMeasurementList:d=>S.post("tenantBind/getTenantMeasurementList",d),getQuestionnaireClickList:d=>S.post("tenantBind/getQuestionnaireClickList",d)},K=R("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),W=K,z=d=>(H("data-v-3c9c8dd2"),d=d(),q(),d),X={class:"milestone"},Y={class:"left"},Z={class:"left-top-left p-4"},ee={class:"project"},te={class:"projectName flex-b"},se={class:"projectId"},ne={class:"price flex-b"},ae={key:0,class:"left-top-right p-4"},oe={class:"tenant"},le={key:0,class:"left-bottom"},re=z(()=>t("div",{class:"line"},null,-1)),ie={class:"allocation"},ce=z(()=>t("div",{class:"arrow"},null,-1)),pe={key:0,class:"right"},ue={class:"clickIdItem m-2"},de={class:"clickIdItem-left"},fe={class:"clickIdItem-right"},_e={class:"title"},Ie=z(()=>t("li",null,"点击ID:",-1)),ye={key:0},ve={style:{flex:"auto"}},me=U({name:"Edit",__name:"index",setup(d,{expose:G}){const L=W(),h=O(!1),b=O(),r=O({currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function V(o,p=0){const y={linkId:o.linkId,projectId:o.projectId,source:p},s=await E.getTenantMeasurementList(y),f=s.data.tenantMeasurementInfoList;s.data.tenantMeasurementInfo&&f.unshift(s.data.tenantMeasurementInfo);const g=f.findIndex(n=>n.allocationTenantId===s.data.currentTenantId);f.splice(0,g);const k=f.filter(n=>n.type===1),e=f.filter(n=>n.type===2),v=f.filter(n=>n.type===3),l=[...k];if(e.length){const n=e.map(x=>x.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=n,l.push(e[0])}else if(v.length){const n=v.map(x=>x.memberGroupOrSupperId);v[0].length=v.length,v[0].memberGroupOrSupperIdList=n,l.push(v[0])}l.forEach(n=>n.visible=!1),r.value.currentTenantId=s.data.currentTenantId,r.value.tenantMeasurementInfoList=l,h.value=!0}const P=o=>{r.value.clickIdList=[],r.value.tenantMeasurementInfoList.length===b.value.length?b.value.forEach((p,y)=>{y!==o&&p.hide()}):b.value.forEach((p,y)=>{y!==o-1&&p.hide()})},Q=async o=>{const p={type:o.type,projectId:o.projectId,tenantId:o.allocationTenantId,supplierIdList:o.type===2?o.memberGroupOrSupperIdList:[],memberGroupIdList:o.type===3?o.memberGroupOrSupperIdList:[]},y=await E.getQuestionnaireClickList(p);r.value.clickIdList=$(y.data.questionnaireClickInfoList),o.type===2?r.value.clickIdList=r.value.clickIdList.filter(s=>s.peopleType===2):o.type===3&&(r.value.clickIdList=r.value.clickIdList.filter(s=>s.peopleType===1))};function $(o){return o.reduce((p,y)=>{const{supplierId:s,supplierName:f,projectQuestionnaireClickId:g,surveyStatus:k,price:e,peopleType:v}=y;let l=p.find(n=>n.supplierId===s);return l?l.list.push({projectQuestionnaireClickId:g,surveyStatus:k,price:e}):p.push({supplierId:s,peopleType:v,supplierName:f,list:[{projectQuestionnaireClickId:g,surveyStatus:k,price:e}]}),p},[])}function C(){h.value=!1}function w(){C()}return G({showEdit:V}),(o,p)=>{const y=D,s=T("el-text"),f=T("el-button"),g=T("el-popover"),k=T("el-drawer");return _(),m("div",null,[u(k,{modelValue:I(h),"onUpdate:modelValue":p[0]||(p[0]=e=>F(h)?h.value=e:null),title:"项目测查",size:"60%","before-close":C},{footer:c(()=>[t("div",ve,[u(f,{onClick:C},{default:c(()=>[i(" 取消 ")]),_:1}),u(f,{type:"primary",onClick:w},{default:c(()=>[i(" 确定 ")]),_:1})])]),default:c(()=>[t("div",X,[(_(!0),m(j,null,N(I(r).tenantMeasurementInfoList,(e,v)=>(_(),m("div",{class:"item",key:e.allocationTenantId},[t("div",Y,[t("div",{class:B({"left-top":!0,"flex-b":!0,currentTenant:e.allocationTenantId===I(r).currentTenantId&&e.type===1})},[t("div",Z,[t("div",ee,[t("div",te,[t("b",null,a(e.projectName),1),t("span",null,a(I(L).projectStatusList[e.projectStatus-1]),1)]),t("div",se,a(e.projectId),1)]),t("div",ne,[t("p",null,[i(" 原价： "),u(y),i(" "+a(e.doMoneyPrice),1)]),t("p",null,[i(" 参数： "),u(s,{size:"large"},{default:c(()=>[i(a(e.participationNumber||0),1)]),_:2},1024),u(s,{size:"large"},{default:c(()=>[i(" / ")]),_:1}),u(s,{type:"success",size:"large"},{default:c(()=>[i(a(e.doneNumber||0),1)]),_:2},1024),u(s,{size:"large"},{default:c(()=>[i(" / ")]),_:1}),u(s,{type:"warning",size:"large"},{default:c(()=>[i(a(e.num||0),1)]),_:2},1024),u(s,{size:"large"},{default:c(()=>[i(" / ")]),_:1}),u(s,{size:"large"},{default:c(()=>[i(a(e.limitedQuantity||0),1)]),_:2},1024)])])]),e.allocationTenantId!==I(r).currentTenantId||e.type!==1?(_(),m("div",ae,[t("p",{class:B("type"+e.type)},a(I(L).typeList[e.type-1]),3),t("div",oe,[(e==null?void 0:e.length)>1?(_(),A(f,{key:0,type:"primary",link:""},{default:c(()=>[i(" 查看更多("+a(e==null?void 0:e.length)+") ",1)]),_:2},1024)):(_(),m(j,{key:1},[t("p",null,a(e.tenantName),1),t("p",null,a(e.allocationTenantId),1)],64))])])):M("",!0)],2),I(r).tenantMeasurementInfoList.length!==v+1?(_(),m("div",le,[re,t("div",ie,a(e.tenantName)+"-分配-"+a(I(L).typeList[I(r).tenantMeasurementInfoList[v+1].type-1]),1),ce])):M("",!0)]),e.allocationTenantId!==I(r).currentTenantId||e.type!=1?(_(),m("div",pe,[u(g,{visible:e.visible,"onUpdate:visible":l=>e.visible=l,ref_for:!0,ref_key:"popoverRef",ref:b,placement:"right",width:350,trigger:"click",onBeforeEnter:l=>P(v),onShow:l=>Q(e)},{reference:c(()=>[u(f,{style:{padding:"0.5rem"},type:"primary",link:""},{default:c(()=>[i(" 》 ")]),_:1})]),default:c(()=>[(_(!0),m(j,null,N(I(r).clickIdList,l=>(_(),m("div",ue,[t("div",de,[t("span",{class:B("peopleType"+l.peopleType)},a(I(L).peopleTypeList[l.peopleType-1]),3)]),t("div",fe,[t("div",_e,a(l.supplierName)+"   "+a(l.supplierId),1),t("ul",null,[Ie,(_(!0),m(j,null,N(l.list,n=>(_(),m("li",null,[t("span",null,a(n.projectQuestionnaireClickId),1),t("span",null,"  "+a(I(L).surveyStatusList[n.surveyStatus-1]),1),n.surveyStatus===1?(_(),m("span",ye,[i("   "),u(y),i(a(n.price),1)])):M("",!0)]))),256))])])]))),256))]),_:2},1032,["visible","onUpdate:visible","onBeforeEnter","onShow"])])):M("",!0)]))),128))])]),_:1},8,["modelValue"])])}}}),Le=J(me,[["__scopeId","data-v-3c9c8dd2"]]),ke=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{E as a,Le as e,ke as i,W as u};
