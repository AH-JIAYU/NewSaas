
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ve,l as he,J as Ce,aM as Pe,y as we,r as V,c as Ie,n as Se,z,C as Ve,a as u,q as O,o as s,b as B,f as i,w as n,i as o,s as v,e as d,g as f,aN as Le,A as U,F as T,j as k,O as xe,E as w,aO as F,ao as Be,M as ke}from"./index-Cjx6Hppb.js";import{_ as Me}from"./index-DGm2YWet.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-CyJq4DYo.js";import{s as I}from"./apiLoading-Bw3JLAM0.js";import{G as P}from"./otherFunctions_screenLibrary-DpKF32L5.js";import{_ as Ee}from"./index.vue_vue_type_script_setup_true_lang-DpM8IRzH.js";import{u as Ne}from"./index-BFd2EGpv.js";import{u as De}from"./stagedData-Ch8zl-x-.js";import{u as $e}from"./useTabbar-cSSxwIyR.js";import"./index.vue_vue_type_script_setup_true_lang-DMDk-mZ9.js";import"./sortable.esm-C0-Qcoum.js";/* empty css                      */const ze=ve({name:"screen_library",__name:"list",setup(Oe){const A=he(),R=Ne(),S=De(),q=Ce(),{pagination:p,getParams:G,onSizeChange:H,onCurrentChange:J,onSortChange:K}=Pe(),Q=$e(),M=we(),j=V(),W=V("formSearch-screen_library"),e=V({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),E=V();function m(){try{e.value.loading=!0;const t={...G(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};P.list(t).then(l=>{l.data&&l.status===1&&(e.value.dataList=l.data.getCountryListInfoList,e.value.dataList.forEach(y=>{y.getProjectProblemCategoryInfoList.length!=0&&y.getProjectProblemCategoryInfoList.forEach(g=>g.babOrB2c=g.babOrB2c==null?1:g.babOrB2c)}),p.value.total=l.data.getCountryListInfoList.length),e.value.loading=!1})}catch{}finally{e.value.loading=!1}}const N=Ie(()=>e.value.dataList.slice((p.value.page-1)*p.value.size,p.value.page*p.value.size));function X(t){H(t).then(()=>m())}function D(t=1){J(t).then(()=>m())}function $({prop:t,order:l}){K(t,l).then(()=>m())}function Y(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function Z(t){t.getProjectProblemCategoryInfoList.unshift({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add",babOrB2c:t.babOrB2c})}function ee(t,l,y){E.value.validateField(`[${l}].getProjectProblemCategoryInfoList[${y}].categoryName`,async g=>{if(g){const{data:b,status:L}=await I(P.create(t));L===1&&w.success({message:"新增成功",center:!0}),await m()}})}function te(t,l){const y=e.value.dataList.findIndex(g=>g.countryId===t.countryId);e.value.dataList[y].getProjectProblemCategoryInfoList.splice(l,1)}async function ae(t){const{status:l}=await I(P.update(t));l===1&&w.success({message:"修改「默认区域」成功",center:!0}),m(),S.projectManagementList=null}async function oe(t){const{status:l}=await I(P.edit(t));l===1&&w.success({message:"修改「状态」成功",center:!0}),m(),S.projectManagementList=null}function le(t){R.countryId=t.countryId,e.value.formMode==="router"?M.settings.tabbar.enable&&M.settings.tabbar.mergeTabsBy!=="activeMenu"?Q.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):q.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function ne(t){F.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:l}=await I(P.delete({countryId:t.countryId}));l===1&&w.success({message:"删除成功",center:!0}),m()}).catch(()=>{}),S.projectManagementList=null}function re(t){F.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:l}=await I(P.delete({projectProblemCategoryId:t.projectProblemCategoryId}));l===1&&w.success({message:"删除成功",center:!0}),m()}).catch(()=>{}),S.projectManagementList=null}function ie(){Object.assign(e.value.search,{countryId:""}),m()}return Se(async()=>{m(),e.value.countryList=await A.getCountry(),e.value.formMode==="router"&&z.on("get-data-list",()=>{m()}),j.value=[{index:1,show:!0,type:"select",modelName:"countryId",placeholder:"区域",option:"global",optionLabel:"chineseName",optionValue:"id"}]}),Ve(()=>{e.value.formMode==="router"&&z.off("get-data-list")}),(t,l)=>{const y=Me,g=u("ElDivider"),b=u("ElButton"),L=u("ElSpace"),x=u("el-table-column"),h=u("ElSwitch"),_=u("ElTableColumn"),se=u("el-input"),de=u("el-form-item"),ue=u("el-text"),ce=u("el-table"),me=u("el-tag"),pe=u("el-empty"),ge=u("ElTable"),fe=u("el-form"),ye=u("ElPagination"),be=Be,C=O("auth"),_e=O("loading");return s(),B("div",{class:xe({"absolute-container":o(e).tableAutoHeight})},[i(be,null,{default:n(()=>[i(y,{formSearchList:o(j),formSearchName:o(W),onCurrentChange:D,onOnReset:ie,model:o(e).search},null,8,["formSearchList","formSearchName","model"]),i(g,{"border-style":"dashed"}),i(L,{wrap:""},{default:n(()=>[v((s(),d(b,{type:"primary",size:"default",onClick:Y},{default:n(()=>[f(" 新增前置问卷库 ")]),_:1})),[[C,"screen_library-get-addProjectProblemCategory"]])]),_:1}),i(fe,{ref_key:"formRef",ref:E,rules:o(e).rules,model:o(N)},{default:n(()=>[v((s(),d(ge,{class:"my-4",data:o(N),"highlight-current-row":"",height:"100%",onSortChange:$,onSelectionChange:l[1]||(l[1]=r=>o(e).batch.selectionDataList=r),"default-expand-all":!0},{empty:n(()=>[i(pe,{image:o(Le),"image-size":300},null,8,["image"])]),default:n(()=>[i(x,{type:"expand",width:"55"},{default:n(r=>[i(ce,{data:r.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",height:"100%",onSortChange:$,onSelectionChange:l[0]||(l[0]=a=>o(e).batch.selectionDataList=a)},{default:n(()=>[i(x,{width:"55"}),i(_,{prop:"status",label:"状态",align:"left"},{default:n(a=>[a.row.type==="add"?(s(),d(h,{key:0,modelValue:a.row.status,"onUpdate:modelValue":c=>a.row.status=c,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])):(s(),d(h,{key:1,onChange:c=>oe(a.row),modelValue:a.row.status,"onUpdate:modelValue":c=>a.row.status=c,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),i(x,{width:"500",prop:"categoryName",label:"问卷名称",align:"left"},{default:n(a=>[a.row.type==="add"?(s(),d(de,{key:0,prop:`[${r.$index}].getProjectProblemCategoryInfoList[${a.$index}].categoryName`,rules:o(e).rules.categoryName},{default:n(()=>[i(se,{modelValue:a.row.categoryName,"onUpdate:modelValue":c=>a.row.categoryName=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(s(),d(ue,{key:1,class:"fontC-System"},{default:n(()=>[f(U(a.row.categoryName),1)]),_:2},1024))]),_:2},1024),i(_,{prop:"babOrB2c",label:"类型",align:"left"},{default:n(a=>[a.row.type==="add"?(s(),d(h,{key:0,modelValue:a.row.babOrB2c,"onUpdate:modelValue":c=>a.row.babOrB2c=c,"active-value":2,"inactive-value":1,"inline-prompt":"","active-text":"B2C","inactive-text":"B2B"},null,8,["modelValue","onUpdate:modelValue"])):(s(),d(h,{key:1,modelValue:a.row.babOrB2c,"onUpdate:modelValue":c=>a.row.babOrB2c=c,"active-value":2,"inactive-value":1,"inline-prompt":"","active-text":"B2C","inactive-text":"B2B",disabled:""},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),i(_,{width:"250",align:"left",fixed:"right",label:"操作"},{default:n(a=>[a.row.type==="add"?(s(),B(T,{key:0},[v((s(),d(b,{type:"primary",size:"small",plain:"",onClick:c=>ee(a.row,r.$index,a.$index)},{default:n(()=>[f(" 提交 ")]),_:2},1032,["onClick"])),[[C,"screen_library-get-addProjectProblemCategory"]]),i(b,{type:"danger",size:"small",plain:"",onClick:c=>te(a.row,a.$index)},{default:n(()=>[f(" 取消 ")]),_:2},1032,["onClick"])],64)):(s(),B(T,{key:1},[v((s(),d(b,{type:"warning",size:"small",plain:"",onClick:c=>le(a.row)},{default:n(()=>[f(" 设计问卷 ")]),_:2},1032,["onClick"])),[[C,"screen_library-get-addProjectProblem"]]),v((s(),d(b,{type:"danger",size:"small",plain:"",onClick:c=>re(a.row)},{default:n(()=>[f(" 删除 ")]),_:2},1032,["onClick"])),[[C,"screen_library-delete-deleteProjectProblemCategory"]])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),i(_,{prop:"isDefault",label:"默认/状态",align:"left"},{default:n(r=>[i(h,{onChange:a=>ae(r.row),modelValue:r.row.isDefault,"onUpdate:modelValue":a=>r.row.isDefault=a,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),i(_,{prop:"countryName",label:"区域/标题",width:"500",align:"left"},{default:n(({row:r})=>[i(me,{type:"primary"},{default:n(()=>[f(U(r.countryName),1)]),_:2},1024)]),_:1}),i(_,{prop:"babOrB2c",label:"类型",align:"left"},{default:n(r=>[r.row.type==="add"?(s(),d(h,{key:0,modelValue:r.row.babOrB2c,"onUpdate:modelValue":a=>r.row.babOrB2c=a,"active-value":2,"inactive-value":1,"inline-prompt":"","active-text":"B2C","inactive-text":"B2B",disabled:""},null,8,["modelValue","onUpdate:modelValue"])):k("",!0)]),_:1}),i(_,{label:"操作",width:"250",align:"left",fixed:"right"},{default:n(r=>[v((s(),d(b,{type:"primary",size:"small",plain:"",onClick:a=>Z(r.row)},{default:n(()=>[f(" 新增问卷 ")]),_:2},1032,["onClick"])),[[C,"screen_library-get-addProjectProblemCategory"]]),v((s(),d(b,{type:"danger",size:"small",plain:"",onClick:a=>ne(r.row)},{default:n(()=>[f(" 删除 ")]),_:2},1032,["onClick"])),[[C,"screen_library-delete-deleteProjectProblemCategory"]])]),_:1})]),_:1},8,["data"])),[[_e,o(e).loading]])]),_:1},8,["rules","model"]),i(ye,{"current-page":o(p).page,total:o(p).total,"page-size":o(p).size,"page-sizes":o(p).sizes,layout:o(p).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:X,onCurrentChange:D},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),o(e).editProps.visible?(s(),d(Ee,{key:0,id:o(e).editProps.id,countryId:o(e).editProps.countryId,modelValue:o(e).editProps.visible,"onUpdate:modelValue":l[2]||(l[2]=r=>o(e).editProps.visible=r),row:o(e).editProps.row,onSuccess:m},null,8,["id","countryId","modelValue","row"])):k("",!0),o(e).formMode==="dialog"||o(e).formMode==="drawer"?(s(),d(je,{key:1,id:o(e).formModeProps.id,modelValue:o(e).formModeProps.visible,"onUpdate:modelValue":l[3]||(l[3]=r=>o(e).formModeProps.visible=r),mode:o(e).formMode,details:o(e).formModeProps.details,title:o(e).formModeProps.title,onSuccess:m},null,8,["id","modelValue","mode","details","title"])):k("",!0)],2)}}}),Xe=ke(ze,[["__scopeId","data-v-0d550921"]]);export{Xe as default};
