
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as G,r as m,a as c,o as h,b as Q,f as o,w as t,g as n,i as l,y as _,e as T,j as W,A as X,E as N,_ as Y,aH as Z,aI as ee,L as re}from"./index-e-CmYWR6.js";import{c as x}from"./user_cooperation-DxbnhCW7.js";import{u as ae}from"./index-Bp4OI1mC.js";import{a as te}from"./department-CN-tkMFD.js";import"./index-DsWkRE8a.js";import"./index-BQYSaRiI.js";const oe=p=>(Z("data-v-0028ac56"),p=p(),ee(),p),le=oe(()=>_("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式",-1)),ce={style:{display:"flex"}},ne=G({__name:"index",emits:["fetch-data"],setup(p,{expose:R,emit:C}){const V=C,f=m(!1),y=m(),e=m({form:{},rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(r,a,i)=>{if(/^(100|[1-9]?\d)$/.test(a)==!1)return i(new Error("请输入 0 到 100 之间的数字"));i()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}}),A={children:"children",label:"name"},U=m([]),k=m(),v=m();async function E(r){e.value.form.chargeUserId="",e.value.form.id=r.id,e.value.form.priceRatio=r.priceRatio,e.value.form.sendProjectType=r.sendProjectType?[r.sendProjectType]:null,e.value.form.receiveProjectType=r.receiveProjectType?[r.receiveProjectType]:null,e.value.form.chargeUserName=r.userName,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserId=r.userId;const a=await te.list({name:""});a.data&&(U.value=a.data),f.value=!0}const S=(r,a)=>{if(a){v.value.getCheckedKeys().forEach(u=>{u!==r.id&&v.value.setChecked(u,!1)}),e.value.form.chargeUserId=r.id;const d=v.value.getCheckedNodes();e.value.form.chargeUserName=d.map(u=>u.name)[0],setTimeout(()=>{k.value.blur()},100)}else e.value.form.chargeUserId=[e.value.form.chargeUserId].filter(i=>i!==r.id),e.value.form.chargeUserId.length==0&&(e.value.form.chargeUserId="");e.value.form.chargeUserId||(e.value.form.chargeUserName=""),console.log(e.value.form.chargeUserName,"data.value.form.chargeUserName"),console.log(e.value.form.chargeUserId,"data.value.form.chargeUserId")};function I(){f.value=!1,e.value.form={},y.value.resetFields()}const B=m();async function q(r){await x.updateInvitationBindUser({id:e.value.form.id,chargeUserId:r.chargeUserId,invitationType:r.invitationType,chargeUserName:r.chargeUserName,sendProjectType:r.sendProjectType,receiveProjectType:r.receiveProjectType})}async function w(){await x.updateInvitationBind({id:e.value.form.id,priceRatio:e.value.form.priceRatio}),N.success({message:"修改成功",center:!0})}async function F(){y.value.validate(r=>{if(r){let a=JSON.parse(JSON.stringify(e.value.form));if(Array.isArray(a.chargeUserId)&&(a.chargeUserId=a.chargeUserId[0]),a.receiveProjectType==1&&!a.chargeUserId){N.warning({message:"请选择接收项目负责人",center:!0});return}a.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,a.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,a.invitationType=2,a.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",a.chargeUserId=null,a.chargeUserName="",a.invitationType=""),q(a),w(),V("fetch-data"),I()}})}const K=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.sendProjectType=[r[r.length-1]])},D=r=>{Array.isArray(r)&&r.length>1&&(e.value.form.receiveProjectType=[r[r.length-1]])};function J(r){e.value.form.chargeUserId=r.chargeUserId,e.value.form.invitationType=r.invitationType,e.value.form.chargeUserName=r.chargeUserName}return R({showEdit:E}),(r,a)=>{const i=c("el-input"),d=c("el-form-item"),u=Y,P=c("el-tooltip"),g=c("el-checkbox"),j=c("el-checkbox-group"),L=c("el-tree"),O=c("el-text"),$=c("el-option"),z=c("el-select"),H=c("ElForm"),b=c("el-button"),M=c("el-dialog");return h(),Q("div",null,[o(M,{modelValue:l(f),"onUpdate:modelValue":a[4]||(a[4]=s=>X(f)?f.value=s:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"40%",title:"合作配置"},{footer:t(()=>[o(b,{onClick:I},{default:t(()=>[n(" 关闭 ")]),_:1}),o(b,{type:"primary",onClick:F},{default:t(()=>[n(" 确认 ")]),_:1})]),default:t(()=>[o(H,{ref_key:"formRef",ref:y,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left"},{default:t(()=>[o(d,{label:"价格比例",prop:"priceRatio"},{default:t(()=>[o(i,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":a[0]||(a[0]=s=>l(e).form.priceRatio=s),clearable:""},{append:t(()=>[n("%")]),_:1},8,["modelValue"])]),_:1}),o(d,{"label-width":"7rem"},{label:t(()=>[le]),_:1}),o(d,{prop:"sendProjectType","label-width":"7rem"},{label:t(()=>[_("span",null,[o(P,{effect:"dark",content:"",placement:"top-start"},{default:t(()=>[o(u,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),n(" 发送项目 ")])]),default:t(()=>[o(j,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":a[1]||(a[1]=s=>l(e).form.sendProjectType=s),onChange:K},{default:t(()=>[o(g,{value:1},{default:t(()=>[n(" 自动 ")]),_:1}),o(g,{value:2},{default:t(()=>[n(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),_("div",ce,[o(d,{prop:"receiveProjectType"},{label:t(()=>[_("span",null,[o(P,{effect:"dark",content:"",placement:"top-start"},{default:t(()=>[o(u,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),n(" 接收项目 ")])]),default:t(()=>[o(j,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":a[2]||(a[2]=s=>l(e).form.receiveProjectType=s),onChange:D},{default:t(()=>[o(g,{value:1},{default:t(()=>[n(" 自动 ")]),_:1}),o(g,{value:2},{default:t(()=>[n(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).form.receiveProjectType==1?(h(),T(z,{key:0,modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":a[3]||(a[3]=s=>l(e).form.chargeUserName=s),placeholder:"请选择部门",ref_key:"selectTreeRef",ref:k,style:{width:"15.625rem","margin-left":"1.5625rem"}},{default:t(()=>[o($,{value:l(e).form.chargeUserId,style:{height:"auto"}},{default:t(()=>[l(U).length>0?(h(),T(L,{key:0,ref_key:"treeRef",ref:v,disabled:!0,data:l(U),"show-checkbox":"","check-strictly":"","node-key":"id","default-expanded-keys":[],"default-checked-keys":[l(e).form.chargeUserId],"default-expand-all":"",props:A,onCheckChange:S,"check-on-click-node":!0,"expand-on-click-node":!1},null,8,["data","default-checked-keys"])):(h(),T(O,{key:1},{default:t(()=>[n("暂无数据")]),_:1}))]),_:1},8,["value"])]),_:1},8,["modelValue"])):W("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(ae,{ref_key:"userRef",ref:B,onUserData:J},null,512)])}}}),ve=re(ne,[["__scopeId","data-v-0028ac56"]]);export{ve as default};
