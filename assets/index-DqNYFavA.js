
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as L}from"./configuration_role-BOzvv8xw.js";import{k as G,A as M,r as i,c as T,d as q,bj as H,l as J,E as F,a as v,al as O,am as z,i as l,o as y,b as I,f as m,w as f,e as S,C as E,D as P,F as D,n as Q,g as W,j as A,P as X}from"./index-c-Fvncv2.js";const Y={list:()=>G.get("role/get/getRoleButton")},Z=M("buttonPermission",()=>{const _=i([]),x=T(async()=>{if(_.value.length)return _.value;const{data:C}=await Y.list();return C});return{permissions:_,getPermissions:x}}),ee=Z,te={class:"custom-tree-node"},oe={class:"menu"},le={class:"permission"},se={key:0,class:"permissions"},ae=q({__name:"index",props:["id","row"],setup(_,{expose:x}){const C=_,V=H(),K=ee(),p=i(!1),k=i(),h=i(),N=i([]),s=i([]),e=i({id:C.id??null,menuId:[],permission:[],roleName:"",remark:""}),U=i({roleName:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});J(async()=>{p.value=!0,e.value.id!==""&&await $(),N.value=V.routesRaw;const a=await V.obtainLevel1AndLevel2Routing();e.value.menuId=e.value.menuId.filter(t=>!a.some(n=>n.id===t)),s.value=await K.getPermissions,p.value=!1});async function $(){p.value=!0,e.value=JSON.parse(C.row),p.value=!1}function R(a){var t;return(t=s==null?void 0:s.value)==null?void 0:t.filter(n=>a===n.menuId)}const j=a=>{const t=[];t.push(a),h.value.getNode(a.id).checked?t.map(r=>{var d;const o=(d=s==null?void 0:s.value)==null?void 0:d.filter(u=>r.id===u.menuId);o&&o.length&&o.forEach(u=>{e.value.permission.push(u.id)})}):t.map(r=>{var d;const o=(d=s==null?void 0:s.value)==null?void 0:d.filter(u=>r.id===u.menuId);if(o&&o.length){let u=o.map(g=>g.id);e.value.permission=e.value.permission.filter(g=>!u.some(w=>w===g))}})};return x({submit(){return e.value.menuId=h.value.getCheckedKeys(!1),new Promise(a=>{const t=h.value.getCheckedKeys(),n=h.value.getHalfCheckedKeys(),r=t.concat(n);e.value.menuId=r,e.value.id===""?k.value&&k.value.validate(o=>{o&&L.create(e.value).then(()=>{F.success({message:"新增成功",center:!0}),a()})}):k.value&&k.value.validate(o=>{o&&L.edit(e.value).then(()=>{F.success({message:"编辑成功",center:!0}),a()})})})}}),(a,t)=>{const n=v("ElInput"),r=v("ElFormItem"),o=v("ElCheckbox"),d=v("ElCheckboxGroup"),u=v("el-tree"),g=v("ElForm"),w=O("loading");return z((y(),I("div",null,[m(g,{ref_key:"formRef",ref:k,model:l(e),rules:l(U),"label-width":"120px","label-suffix":"："},{default:f(()=>[m(r,{label:"角色码",prop:"roleName"},{default:f(()=>[m(n,{modelValue:l(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=c=>l(e).roleName=c),disabled:!!l(e).id,placeholder:"请输入角色码"},null,8,["modelValue","disabled"])]),_:1}),m(r,{label:"备注",prop:"remark"},{default:f(()=>[m(n,{modelValue:l(e).remark,"onUpdate:modelValue":t[1]||(t[1]=c=>l(e).remark=c),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),m(r,{label:"权限"},{default:f(()=>[l(p)?A("",!0):(y(),S(u,{key:0,ref_key:"treeRef",ref:h,data:l(N),style:{width:"100%"},"default-checked-keys":l(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"",onCheckChange:j,"default-expand-all":"",border:""},{default:f(({data:c})=>{var B;return[E("div",te,[E("div",oe,P(c.meta.title),1),E("div",le,[(B=R(c.id))!=null&&B.length?(y(),I("div",se,[m(d,{modelValue:l(e).permission,"onUpdate:modelValue":t[2]||(t[2]=b=>l(e).permission=b)},{default:f(()=>[(y(!0),I(D,null,Q(R(c.id),b=>(y(),S(o,{key:b.id,value:b.id},{default:f(()=>[W(P(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):A("",!0)])])]}),_:1},8,["data","default-checked-keys"]))]),_:1})]),_:1},8,["model","rules"])])),[[w,l(p)]])}}}),ue=X(ae,[["__scopeId","data-v-97d7843e"]]);export{ue as default};
