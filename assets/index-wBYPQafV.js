
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as G,r as p,c as Q,a as s,o as i,b as f,f as n,w as o,g as c,i as l,F as W,t as X,e as _,y as v,z as I,j as g,A as Y,E as U,_ as Z,aH as ee,aI as te,aE as ae,L as oe}from"./index-BzANdb3L.js";import{c as R}from"./user_cooperation-UKpuSqwV.js";import{u as ne}from"./index-BO8S_esd.js";import"./index-CKmAeg9s.js";import"./index-D__XWzj4.js";import"./department-x35GuAkL.js";const re=y=>(ee("data-v-c1a98174"),y=y(),te(),y),le={style:{float:"left"}},se={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"0.8125rem"}},ie={key:0},ce={key:1},ue=re(()=>v("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式",-1)),de={key:3,style:{display:"flex"},class:"inviteDialog"},me=G({__name:"index",emits:["fetch-data"],setup(y,{expose:S,emit:w}){const D=w,d=p(!1);p("");const T=p(),e=p({form:{},tenantUserList:[],tenantStaffList:[],chargeUserId:null,departmentId:null,chargeUserName:"",rules:{beInvitationTenantId:[{required:!0,message:"请选择合作商",trigger:"change"}],priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(t,a,u)=>{if(/^(100|[1-9]?\d)$/.test(a)==!1)return u(new Error("请输入 0 到 100 之间的数字"));u()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}]}});async function q(){await A(),d.value=!0}async function A(){const t=await R.getTenantUserList({});e.value.tenantUserList=t.data.tenantUserInfoList}const k=Q(()=>{const t=e.value.tenantUserList.find(a=>a.tenantId===e.value.form.beInvitationTenantId);return t?(e.value.form.tenantName=t.name,e.value.form.phoneOrEmail=ae.local.get("account"),[t]):[]});function j(){d.value=!1,e.value.form={},T.value.resetFields()}async function B(){T.value.validate(t=>{if(t){let a=JSON.parse(JSON.stringify(e.value.form));if(a.receiveProjectType==1&&!a.chargeUserId){U.warning({message:"请选择接收项目负责人",center:!0});return}a.sendProjectType=e.value.form.sendProjectType.length!=0?e.value.form.sendProjectType[0]:null,a.receiveProjectType=e.value.form.receiveProjectType.length!=0?e.value.form.receiveProjectType[0]:null,a.receiveProjectType==2&&(e.value.form.chargeUserId=null,e.value.form.chargeUserName="",e.value.form.invitationType="",a.chargeUserId=null,a.chargeUserName="",a.invitationType=""),R.addInvitationBind(a).then(u=>{u.status==-1?U.success({message:u.error,center:!0}):(U.success({message:"发送成功",center:!0}),D("fetch-data"),j())})}})}S({showEdit:q});const N=p();function F(){let t={chargeUserId:e.value.form.chargeUserId,invitationType:e.value.form.invitationType,chargeUserName:e.value.form.chargeUserName};N.value.showEdit(t,"请选择负责部门/人")}function z(t){e.value.form.chargeUserId=t.chargeUserId,e.value.form.invitationType=t.invitationType,e.value.form.chargeUserName=t.chargeUserName}const O=t=>{Array.isArray(t)&&t.length>1&&(e.value.form.sendProjectType=[t[t.length-1]])},J=t=>{Array.isArray(t)&&t.length>1&&(e.value.form.receiveProjectType=[t[t.length-1]])},K=t=>{t.preventDefault()};return(t,a)=>{const u=s("el-option"),P=s("el-select"),m=s("el-form-item"),h=s("el-table-column"),$=s("el-table"),x=s("el-input"),V=Z,C=s("el-tooltip"),b=s("el-checkbox"),E=s("el-checkbox-group"),H=s("ElForm"),L=s("el-button"),M=s("el-dialog");return i(),f("div",null,[n(M,{modelValue:l(d),"onUpdate:modelValue":a[5]||(a[5]=r=>Y(d)?d.value=r:null),"close-on-click-modal":!1,"destroy-on-close":"",draggable:"",width:"30%",title:"邀约公司"},{footer:o(()=>[n(L,{onClick:j},{default:o(()=>[c(" 关闭 ")]),_:1}),n(L,{type:"primary",onClick:B},{default:o(()=>[c(" 发送邀约 ")]),_:1})]),default:o(()=>[n(H,{ref_key:"formRef",ref:T,rules:l(e).rules,model:l(e).form,"label-width":"7rem",labelPosition:"left"},{default:o(()=>[n(m,{label:"公司名称",prop:"beInvitationTenantId"},{default:o(()=>[n(P,{modelValue:l(e).form.beInvitationTenantId,"onUpdate:modelValue":a[0]||(a[0]=r=>l(e).form.beInvitationTenantId=r),clearable:""},{default:o(()=>[(i(!0),f(W,null,X(l(e).tenantUserList,r=>(i(),_(u,{key:r.tenantId,value:r.tenantId,label:r.tenantName},{default:o(()=>[v("span",le,I(r.tenantName),1),v("span",se,I(r.tenantId),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(k).length?(i(),_($,{key:0,data:l(k),border:"",stripe:"",style:{"margin-bottom":"18px"}},{default:o(()=>[n(h,{prop:"name",label:"用户名"}),n(h,{prop:"tenantName",label:"公司名称"}),n(h,{prop:"country",label:"区域"}),n(h,{label:"电子邮箱/手机号"},{default:o(({row:r})=>[r.phone?(i(),f("span",ie,I(r.phone),1)):(i(),f("span",ce,I(r.email),1))]),_:1})]),_:1},8,["data"])):g("",!0),l(e).form.beInvitationTenantId?(i(),_(m,{key:1,label:"价格比例",prop:"priceRatio"},{default:o(()=>[n(x,{modelValue:l(e).form.priceRatio,"onUpdate:modelValue":a[1]||(a[1]=r=>l(e).form.priceRatio=r),clearable:"",placeholder:"请输入0-100之间的数字"},{append:o(()=>[c("%")]),_:1},8,["modelValue"])]),_:1})):g("",!0),l(e).form.beInvitationTenantId?(i(),_(m,{key:2,"label-width":"7rem"},{label:o(()=>[ue]),_:1})):g("",!0),l(e).form.beInvitationTenantId?(i(),f("div",de,[n(m,{prop:"sendProjectType","label-width":"7rem"},{label:o(()=>[v("span",null,[n(C,{effect:"dark",content:"",placement:"top-start"},{default:o(()=>[n(V,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 发送项目 ")])]),default:o(()=>[n(E,{modelValue:l(e).form.sendProjectType,"onUpdate:modelValue":a[2]||(a[2]=r=>l(e).form.sendProjectType=r),onChange:O},{default:o(()=>[n(b,{value:1},{default:o(()=>[c(" 自动 ")]),_:1}),n(b,{value:2},{default:o(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(m,{prop:"receiveProjectType",style:{"margin-left":"40px"}},{label:o(()=>[v("span",null,[n(C,{effect:"dark",content:"",placement:"top-start"},{default:o(()=>[n(V,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),c(" 接收项目 ")])]),default:o(()=>[n(E,{modelValue:l(e).form.receiveProjectType,"onUpdate:modelValue":a[3]||(a[3]=r=>l(e).form.receiveProjectType=r),onChange:J},{default:o(()=>[n(b,{value:1},{default:o(()=>[c(" 自动 ")]),_:1}),n(b,{value:2},{default:o(()=>[c(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):g("",!0),l(e).form.receiveProjectType&&l(e).form.receiveProjectType[0]==1?(i(),_(x,{key:4,placeholder:"请选择接收项目负责人",onKeydown:K,onClick:F,modelValue:l(e).form.chargeUserName,"onUpdate:modelValue":a[4]||(a[4]=r=>l(e).form.chargeUserName=r)},null,8,["modelValue"])):g("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),n(ne,{ref_key:"userRef",ref:N,onUserData:z},null,512)])}}}),be=oe(me,[["__scopeId","data-v-c1a98174"]]);export{be as default};
