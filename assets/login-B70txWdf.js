
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Re}from"./index.vue_vue_type_script_setup_true_lang-cXp8cEDO.js";import{x as O,d as Ie,am as Ue,y as Fe,a1 as Pe,a2 as Se,r as u,aJ as x,k as $e,bf as te,aP as Ae,a3 as ze,b as oe,f as l,w as t,s as p,q as A,aq as z,i as a,z as Le,a as c,aG as Be,aH as Ke,O as Ze,E as U,n as De,o as h,I as Me,aR as Ge,g as d,H as k,e as E,az as re,j as H,ay as j,F as Oe,t as He,N as je,R as Je,ao as ne}from"./index-DC7p3Iv9.js";import Qe from"./agreement-Bbahlyrl.js";import We from"./index-2e-QIF1y.js";const F={sendCode:f=>O.post("user/sendCode",f),register:f=>O.post("user/register",f),getTenantConfig:f=>O.post("tenant-config/getTenantConfig",f)},P=f=>(Be("data-v-01dd3b10"),f=f(),Ke(),f),Xe=P(()=>p("div",{class:"bg-banner"},null,-1)),Ye={id:"login-box"},ea=P(()=>p("div",{class:"login-banner"},null,-1)),aa={class:"title-container"},la={class:"fx-c"},ta={class:"flex-bar",style:{width:"100%",margin:"0"}},oa={class:"flex-bar"},ra={class:"sub-link"},na=P(()=>p("span",{class:"text"},"还不是会员?",-1)),sa={class:"flex-bar",style:{margin:"0"}},ia={class:"sub-link"},ua=P(()=>p("span",{class:"text"},"已经有帐号?",-1)),da=P(()=>p("div",{class:"title-container"},[p("h3",{class:"title"},"忘记密码了? 🔒")],-1)),pa={class:"sub-link"},se=Ie({name:"Login",__name:"login",setup(f){var Y;const ie=Ue(),ue=Le(),de=Ze(),pe=Fe(),me=Pe(),{t:v}=Se();new URL(""+new URL("login-banner-ZfMZACb6.png",import.meta.url).href,import.meta.url).href,new URL(""+new URL("logo-CLz_KCqM.png",import.meta.url).href,import.meta.url).href;const J=u(),b=u("login"),V=u(!1),ce=u(((Y=ue.query.redirect)==null?void 0:Y.toString())??pe.settings.home.fullPath),T=u(),y=u("code"),L=u("获取验证码"),B=u(!1),i=u({account:x.local.get("login_account")||"",remember:x.local.has("login_account"),agreeToTheAgreement:!1}),ge=(r,e,s)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(i.value.account)?s():s(new Error("请输入合法手机号"))},fe=(r,e,s)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i.value.account)?s():s(new Error("请输入合法邮箱"))},C=u({account:[{required:!0,trigger:"blur",message:"请输入手机号/邮箱/用户名"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],agreeToTheAgreement:[{required:!0,validator:(r,e)=>e===!0,message:"请阅读并勾选协议",trigger:"change"}]});$e(async()=>{const{data:r}=await F.getTenantConfig();J.value=r.register});const ve=()=>{const r=i.value.account;r.includes("@")?C.value.account=[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:fe,trigger:"blur"}]:/^\d{11}$/.test(r)?C.value.account=[{required:!0,trigger:"blur",message:"请输入手机号"},{validator:ge,trigger:"blur"}]:r.trim()!==""?C.value.account=[{required:!0,trigger:"blur",message:"请输入用户名"}]:C.value.account=[]};async function be(){T.value.validateField("account",async r=>{if(r){let e;i.value.account.includes("@")?e={email:i.value.account,type:"login_email"}:e={phone:i.value.account,type:"login_phone_number"};const{status:s}=await F.sendCode(e);s===1&&U.success({message:"已发送"}),ye()}})}const ye=()=>{B.value=!0;let r=60;_.value=setInterval(()=>{r>0?(r--,L.value=`请在${r}s后重新获取`):(clearInterval(_.value),L.value="获取验证码",_.value=null,B.value=!1)},1e3)},K=te(()=>{T.value&&T.value.validate(r=>{if(r){let e={...i.value};y.value==="password"?e.type=1:i.value.account.includes("@")?e.type=3:e.type=2,V.value=!0,me.login(e).then(()=>{V.value=!1,i.value.remember?x.local.set("login_account",i.value.account):x.local.remove("login_account"),de.push(ce.value)}).catch(()=>{V.value=!1})}})},3e3),_=u(null),Z=u("获取验证码"),D=u(!1),q=u(),Q=u([]),n=u({name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",agreeToTheAgreement:!1,companyType:"company",companyName:"",legalPersonName:"",taxID:"",isInvitation:2}),_e=u({account:[{required:!0,trigger:"blur",message:"请输入用户名"}],companyName:[{required:!0,trigger:"blur",message:"请输入公司名称"}],companyType:[{required:!0,trigger:"change",message:"请选择账户类型"}],legalPersonName:[{required:!0,trigger:"blur",message:"请输入法人姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"},{validator:(r,e,s)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n.value.email)?s():s(new Error("请输入合法邮箱"))},trigger:"blur"}],phoneNumber:[{required:!0,trigger:"blur",message:"请输入手机号码"},{validator:(r,e,s)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(n.value.phoneNumber)?s():s(new Error("请输入合法手机号"))},trigger:"blur"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],country:[{required:!0,trigger:"change",message:"请选择国家"}],name:[{required:!0,trigger:"blur",message:"请输入用户名"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],isInvitation:[{required:!0,trigger:"blur",message:"请选择合作邀约"}],agreeToTheAgreement:[{required:!0,validator:(r,e)=>e===!0,message:"请阅读并勾选协议",trigger:"blur"}]}),he=async()=>{q.value.validateField(n.value.country==="CN"?"phoneNumber":"email",async r=>{if(r){const e={type:"register_phone_number",email:n.value.email,phone:n.value.phoneNumber};if(n.value.country==="CN"){const{status:s}=await F.sendCode(e);s===1&&U.success({message:"已发送"})}else{e.type="register_email";const{status:s}=await F.sendCode(e);s===1&&U.success({message:"已发送"})}we()}})},we=()=>{D.value=!0;let r=60;_.value=setInterval(()=>{r>0?(r--,Z.value=`请在${r}s后重新获取`):(clearInterval(_.value),Z.value="获取验证码",_.value=null,D.value=!1)},1e3)},xe=te(async()=>{q.value&&q.value.validate(async r=>{if(r){n.value.type=n.value.country==="CN"?"phone":"email";const{status:e}=await F.register(n.value);e===1&&(U.success({message:"注册成功"}),b.value="login",y.value="password",De(()=>{i.value.account=n.value.email||n.value.phoneNumber}))}})},3e3),M=u(),w=u({account:x.local.get("login_account"),code:"",newPassword:""}),Ve=u({account:[{required:!0,trigger:"blur",message:"请输入用户名"}],code:[{required:!0,trigger:"blur",message:"请输入验证码"}],newPassword:[{required:!0,trigger:"blur",message:"请输入新密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}]});function Ce(){U({message:"重置密码仅提供界面演示，无实际功能，需开发者自行扩展",type:"info"}),M.value&&M.value.validate(r=>{})}Ae(()=>{clearInterval(_.value),_.value=null});const W=()=>{C.value.account=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱/用户名"}],T.value.resetFields()};ze(()=>b.value,async r=>{switch(r){case"login":W(),i.value={account:x.local.get("login_account")||"",remember:x.local.has("login_account")};break;case"register":q.value.resetFields(),n.value={name:"",password:"",email:"",phoneNumber:"",code:"",country:"",type:"phone",isInvitation:2};break}r==="register"&&(Q.value=await ie.getCountry())});const X=u(),S=r=>{X.value.showEdit(r)};return(r,e)=>{const s=je,N=Re,ee=c("el-radio-button"),ke=c("el-radio-group"),R=c("el-button"),g=c("ElInput"),m=c("ElFormItem"),G=c("ElCheckbox"),$=c("ElLink"),I=c("ElButton"),Ee=c("el-form"),Te=c("ElOption"),qe=c("ElSelect"),ae=c("el-option"),Ne=c("el-select"),le=c("ElForm");return h(),oe("div",null,[Xe,l(N,{placement:"bottom-end",class:"i18n-selector"},{default:t(()=>[l(s,{name:"i-ri:translate"})]),_:1}),p("div",Ye,[ea,A(l(Ee,{ref_key:"loginFormRef",ref:T,model:a(i),rules:a(C),class:"login-form","validate-on-rule-change":!1},{default:t(()=>[p("div",aa,[p("div",la,[l(ke,{modelValue:a(y),"onUpdate:modelValue":e[0]||(e[0]=o=>Me(y)?y.value=o:null),size:"large",onChange:W},{default:t(()=>[l(ee,{label:"验证码登录",value:"code"}),l(ee,{label:"密码登录",value:"password"})]),_:1},8,["modelValue"])])]),p("div",null,[l(m,{prop:"account"},{default:t(()=>[l(g,{modelValue:a(i).account,"onUpdate:modelValue":e[1]||(e[1]=o=>a(i).account=o),placeholder:a(v)("app.account"),type:"text",tabindex:"1",onBlur:ve},Ge({prefix:t(()=>[l(s,{name:"i-ri:user-3-fill"})]),_:2},[a(y)==="code"?{name:"append",fn:t(()=>[l(R,{type:"primary",disabled:a(B),onClick:be},{default:t(()=>[d(k(a(L)),1)]),_:1},8,["disabled"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),a(y)==="password"?(h(),E(m,{key:0,prop:"password"},{default:t(()=>[l(g,{modelValue:a(i).password,"onUpdate:modelValue":e[2]||(e[2]=o=>a(i).password=o),type:"password",placeholder:a(v)("app.password"),tabindex:"2",autocomplete:"new-password","show-password":"",onKeyup:re(a(K),["enter"])},{prefix:t(()=>[l(s,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):H("",!0),a(y)==="code"?(h(),E(m,{key:1,prop:"code"},{default:t(()=>[l(g,{modelValue:a(i).code,"onUpdate:modelValue":e[3]||(e[3]=o=>a(i).code=o),type:"text",placeholder:a(v)("app.captcha"),tabindex:"2",onKeyup:re(a(K),["enter"])},{prefix:t(()=>[l(s,{name:"i-ep:message"})]),_:1},8,["modelValue","placeholder","onKeyup"])]),_:1})):H("",!0),l(m,{prop:"agreeToTheAgreement",style:{"margin-bottom":".5rem"}},{default:t(()=>[p("div",ta,[l(G,{modelValue:a(i).agreeToTheAgreement,"onUpdate:modelValue":e[6]||(e[6]=o=>a(i).agreeToTheAgreement=o),tabindex:"3"},{default:t(()=>[d(" 我已阅读并同意 "),l(R,{type:"primary",size:"default",link:"",onClick:e[4]||(e[4]=o=>S(1))},{default:t(()=>[d("《会员协议》")]),_:1}),d("和"),l(R,{type:"primary",size:"default",link:"",onClick:e[5]||(e[5]=o=>S(2))},{default:t(()=>[d("《隐私协议》")]),_:1})]),_:1},8,["modelValue"])])]),_:1}),l(m,null,{default:t(()=>[p("div",oa,[l(G,{modelValue:a(i).remember,"onUpdate:modelValue":e[7]||(e[7]=o=>a(i).remember=o),tabindex:"4"},{default:t(()=>[d(" 保持登录 ")]),_:1},8,["modelValue"]),a(y)==="password"?(h(),E($,{key:0,type:"primary",underline:!1,onClick:e[8]||(e[8]=o=>b.value="reset")},{default:t(()=>[d(" 忘记密码了? ")]),_:1})):H("",!0)])]),_:1})]),l(I,{loading:a(V),type:"primary",size:"large",style:{width:"100%"},onClick:j(a(K),["prevent"]),tabindex:"5"},{default:t(()=>[d(k(a(v)("app.login")),1)]),_:1},8,["loading","onClick"]),A(p("div",ra,[na,l($,{type:"primary",underline:!1,onClick:e[9]||(e[9]=o=>b.value="register")},{default:t(()=>[d(" 立即注册 ")]),_:1})],512),[[z,a(J)]])]),_:1},8,["model","rules"]),[[z,a(b)==="login"]]),A(l(le,{ref_key:"registerFormRef",ref:q,model:a(n),rules:a(_e),class:"login-form","auto-complete":"on"},{default:t(()=>[p("div",null,[l(m,{prop:"companyName"},{default:t(()=>[l(g,{modelValue:a(n).companyName,"onUpdate:modelValue":e[10]||(e[10]=o=>a(n).companyName=o),placeholder:"请输入公司名称",tabindex:"1"},null,8,["modelValue"])]),_:1}),l(m,{prop:"name"},{default:t(()=>[l(g,{modelValue:a(n).name,"onUpdate:modelValue":e[11]||(e[11]=o=>a(n).name=o),placeholder:"用户名",tabindex:"2"},{prefix:t(()=>[l(s,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"country"},{default:t(()=>[l(qe,{modelValue:a(n).country,"onUpdate:modelValue":e[12]||(e[12]=o=>a(n).country=o),placeholder:"国家",clearable:"",filterable:"",tabindex:"3"},{prefix:t(()=>[l(s,{name:"i-mdi:format-list-bulleted-type"})]),default:t(()=>[(h(!0),oe(Oe,null,He(a(Q),o=>(h(),E(Te,{label:o.chineseName,value:o.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(n).country==="CN"?(h(),E(m,{key:0,prop:"phoneNumber"},{default:t(()=>[l(g,{modelValue:a(n).phoneNumber,"onUpdate:modelValue":e[13]||(e[13]=o=>a(n).phoneNumber=o),placeholder:"手机号",tabindex:"4"},{prefix:t(()=>[l(s,{name:"i-ant-design:phone-outlined"})]),_:1},8,["modelValue"])]),_:1})):(h(),E(m,{key:1,prop:"email"},{default:t(()=>[l(g,{modelValue:a(n).email,"onUpdate:modelValue":e[14]||(e[14]=o=>a(n).email=o),placeholder:"邮箱",tabindex:"4"},{prefix:t(()=>[l(s,{name:"i-mdi:email"})]),_:1},8,["modelValue"])]),_:1})),l(m,{prop:"code"},{default:t(()=>[l(g,{modelValue:a(n).code,"onUpdate:modelValue":e[15]||(e[15]=o=>a(n).code=o),placeholder:"验证码",tabindex:"5"},{prefix:t(()=>[l(s,{name:"i-ic:baseline-verified-user"})]),append:t(()=>[l(I,{disabled:a(D),onClick:he},{default:t(()=>[d(k(a(Z)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"password"},{default:t(()=>[l(g,{modelValue:a(n).password,"onUpdate:modelValue":e[16]||(e[16]=o=>a(n).password=o),type:"password",placeholder:"密码",tabindex:"6","show-password":""},{prefix:t(()=>[l(s,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"isInvitation"},{default:t(()=>[l(Ne,{modelValue:a(n).isInvitation,"onUpdate:modelValue":e[17]||(e[17]=o=>a(n).isInvitation=o),tabindex:"7",placeholder:"是否开启合作邀约",filterable:""},{prefix:t(()=>[l(s,{name:"i-ant-design:container-outlined"})]),default:t(()=>[l(ae,{label:"合作邀约开启",value:2}),l(ae,{label:"合作邀约关闭",value:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"agreeToTheAgreement"},{default:t(()=>[p("div",sa,[l(G,{modelValue:a(n).agreeToTheAgreement,"onUpdate:modelValue":e[20]||(e[20]=o=>a(n).agreeToTheAgreement=o),tabindex:"8"},{default:t(()=>[d(" 我已阅读并同意 "),l(R,{type:"primary",size:"default",link:"",onClick:e[18]||(e[18]=o=>S(1))},{default:t(()=>[d("《会员协议》")]),_:1}),d("和"),l(R,{type:"primary",size:"default",link:"",onClick:e[19]||(e[19]=o=>S(2))},{default:t(()=>[d("《隐私协议》")]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),l(I,{tabindex:"9",loading:a(V),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:j(a(xe),["prevent"])},{default:t(()=>[d(" 注册 ")]),_:1},8,["loading","onClick"]),p("div",ia,[ua,l($,{type:"primary",underline:!1,onClick:e[21]||(e[21]=o=>b.value="login")},{default:t(()=>[d(" 去登录 ")]),_:1})])]),_:1},8,["model","rules"]),[[z,a(b)==="register"]]),A(l(le,{ref_key:"resetFormRef",ref:M,model:a(w),rules:a(Ve),class:"login-form"},{default:t(()=>[da,p("div",null,[l(m,{prop:"account"},{default:t(()=>[l(g,{modelValue:a(w).account,"onUpdate:modelValue":e[22]||(e[22]=o=>a(w).account=o),placeholder:a(v)("app.account"),type:"text",tabindex:"1"},{prefix:t(()=>[l(s,{name:"i-ri:user-3-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(m,{prop:"code"},{default:t(()=>[l(g,{modelValue:a(w).code,"onUpdate:modelValue":e[23]||(e[23]=o=>a(w).code=o),placeholder:a(v)("app.captcha"),type:"text",tabindex:"2"},{prefix:t(()=>[l(s,{name:"i-ic:baseline-verified-user"})]),append:t(()=>[l(I,null,{default:t(()=>[d(k(a(v)("app.sendCaptcha")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(m,{prop:"newPassword"},{default:t(()=>[l(g,{modelValue:a(w).newPassword,"onUpdate:modelValue":e[24]||(e[24]=o=>a(w).newPassword=o),type:"password",placeholder:a(v)("app.newPassword"),tabindex:"3","show-password":""},{prefix:t(()=>[l(s,{name:"i-ri:lock-2-fill"})]),_:1},8,["modelValue","placeholder"])]),_:1})]),l(I,{loading:a(V),type:"primary",size:"large",style:{width:"100%","margin-top":"1.25rem"},onClick:j(Ce,["prevent"])},{default:t(()=>[d(k(a(v)("app.check")),1)]),_:1},8,["loading"]),p("div",pa,[l($,{type:"primary",underline:!1,onClick:e[25]||(e[25]=o=>b.value="login")},{default:t(()=>[d(k(a(v)("app.goLogin")),1)]),_:1})])]),_:1},8,["model","rules"]),[[z,a(b)==="reset"]])]),l(We),l(Qe,{ref_key:"agreementRef",ref:X},null,512)])}}});typeof ne=="function"&&ne(se);const ya=Je(se,[["__scopeId","data-v-01dd3b10"]]);export{ya as default};
