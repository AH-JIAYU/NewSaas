
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as B}from"./index.vue_vue_type_script_setup_true_lang-DhzEKIBX.js";import{a as I}from"./apiLoading-DuUE4E_v.js";import{a as p}from"./user_supplier-B9TC2P2N.js";import{u as N}from"./stagedData-C16PitpR.js";import{u as z}from"./index.vue_vue_type_script_setup_true_lang-7Zse0wAT.js";import{d as A,r as f,a0 as M,a1 as m,C as U,a as b,o as h,b as j,f as i,w as l,g as v,e as F,j as P,i as $,an as w,ak as _}from"./index-CX2PmK0L.js";const R=A({__name:"index",emits:["fetch-data"],setup(q,{expose:y,emit:C}){const u=N(),c=z(),S=C,r=f(!1),o=f(""),n=f([]);function T(e){n.value.push(e)}M("validateTopTabs",T);let s=m([]);async function k(e){if(!e)o.value="添加",s=u.usersupplier||[w(c.initialTopTabsData)];else{o.value="编辑";const{data:a}=await I(p.detail({tenantSupplierId:e.tenantSupplierId}));D(a)}r.value=!0}function D(e){s.length=0,s.push({...e})}function x(e){const a=new Set;for(const t of e){if(a.has(t.customerAccord))return!0;a.add(t.customerAccord)}return!1}function V(){u.usersupplier=w(s),s=m([]),r.value=!1,n.value=[]}function g(){s=m([]),r.value=!1,n.value=[],o.value==="添加"&&(u.usersupplier=null)}async function L(){const e=[];n.value.forEach(a=>{e.push(a.validate())});try{if((await Promise.all(e)).every(t=>t))if(x(s))_.warning({message:"客户名称重复",center:!0});else{if(o.value==="添加"){const t={addTenantSupplierInfoList:s},{status:d}=await p.create(t);d===1&&_.success({message:"新增成功",center:!0})}else{const{status:t}=await p.edit(s[0]);t===1&&_.success({message:"修改成功",center:!0})}S("fetch-data"),g()}}catch(a){console.error("Form validation failed:",a)}}return U(async()=>{c.customer=[],await c.getCustomerList()}),y({showEdit:k}),(e,a)=>{const t=b("el-button"),d=b("el-drawer");return h(),j("div",null,[i(d,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=E=>r.value=E),class:"hide-drawer-header","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:""},{footer:l(()=>[i(t,{onClick:g},{default:l(()=>[v(" 取消 ")]),_:1}),o.value==="添加"?(h(),F(t,{key:0,type:"warning",onClick:V},{default:l(()=>[v(" 暂存 ")]),_:1})):P("",!0),i(t,{type:"primary",onClick:L},{default:l(()=>[v(" 确定 ")]),_:1})]),default:l(()=>[i(B,{title:o.value,"left-tabs-data":$(s),"validate-top-tabs":n.value},null,8,["title","left-tabs-data","validate-top-tabs"])]),_:1},8,["modelValue"])])}}});export{R as _};
