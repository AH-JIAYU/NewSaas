
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as fe,m as Q,r as p,ao as _e,u as ve,c as ge,k as be,a as s,o as r,e as c,w as a,f as t,g as b,i as o,b as V,t as y,F as h,s as _,H as Ve,j as ye,l as W,E as X,aJ as he,aK as we,R as Ee}from"./index-DQuRfXxB.js";import{a as Ie}from"./department-CLTDGeyr.js";import{u as xe}from"./department-C1v4kl3H.js";import{u as Se}from"./tenant_role-tuqgU_w3.js";import{u as Ce}from"./configuration_manager-Bal6pgAh.js";import{u as ke}from"./position_manage-DdM8EUV8.js";import"./configuration_role-BhPoLRHO.js";import"./position_manage-Bqyb649E.js";const Y=v=>(he("data-v-15d833f7"),v=v(),we(),v),Ne=Y(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"},"基本信息")],-1)),Ue=Y(()=>_("div",{class:"card-header"},[_("div",{class:"leftTitle"},"角色信息")],-1)),Be={class:"card-header"},Me={class:"leftTitle"},qe={style:{"margin-left":"20px","font-size":"14px"}},De=fe({__name:"index",props:Q({catalogueId:{default:""},parentId:{default:""},id:{default:""},tree:{},dataList:{},row:{},level:{default:1}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:Q(["success"],["update:modelValue"]),setup(v,{emit:ee}){const le=Ce(),z=p([]),U=p([]),ae=ke(),A=p(),te=_e(),P=p(),oe=Se(),R=p(),ne=xe(),F=p(),O=p(!1),G=p(!1),re=p(),g=v,J=ee,B=ve(v,"modelValue"),se=ge(()=>g.id===""?"新增用户":"编辑用户"),w=p(),ue=p([]),l=p({id:g.id,userName:"",name:"",phone:"",email:"",country:"",type:"",password:"",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),de=(i,n,u)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(l.value.phone)?u():u(new Error("请输入合法手机号"))},ie=(i,n,u)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l.value.email)?u():u(new Error("请输入合法邮箱"))},Z=()=>{l.value.phone.includes("@")?S.value.email=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:ie,trigger:"blur"}]:S.value.phone=[{required:!0,trigger:"blur",message:"请输入手机号/邮箱"},{validator:de,trigger:"blur"}]},S=p({userName:[{required:!0,message:"请输入用户名"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]}),$=i=>{(i!==l.value.phone||i!==l.value.email)&&(G.value=!0)},j=async i=>{const{data:n}=await Ie.departmentGroup({id:i});U.value=n,re.value=n[0].director};function pe(){l.value.type=l.value.country==="CN"?"phone":"email",l.value.id===""?w.value&&w.value.validate(i=>{i&&(delete l.value.id,l.value.type==="phone"?delete l.value.email:delete l.value.phone,W.create(l.value).then(()=>{X.success({message:"新增成功",center:!0}),J("success"),C()}))}):w.value&&w.value.validate(i=>{if(i){const{id:n,phone:u,email:d,password:f,name:M,country:q,active:k,type:E,role:D,groupId:L,positionId:I,departmentId:x,userName:N}=l.value,m={id:n,phone:u,email:d,password:f,name:M,country:q,active:k,type:E,role:D,groupId:L,positionId:I,departmentId:x,userName:N};E==="phone"?(m.email="",delete m.email):(m.phone="",delete m.phone),m.password||delete m.password,G.value||(delete m.phone,delete m.email),W.edit(m).then(()=>{X.success({message:"编辑成功",center:!0}),J("success"),C()})}})}function C(){B.value=!1}const H=i=>i.reduce((n,u)=>Array.isArray(u)?n.concat(H(u)):n.concat(u),[]);return be(async()=>{A.value=await ae.PositionManage,z.value=await le.getStaff(),R.value=await oe.getRole(),F.value=await ne.department,P.value=await te.getCountry(),g.id!==""&&g.row&&(S.value.password=[],l.value=JSON.parse(g.row),j(l.value.departmentId),O.value=!0),ue.value=H(g.dataList)}),(i,n)=>{const u=s("el-input"),d=s("el-form-item"),f=s("el-col"),M=s("ElOption"),q=s("ElSelect"),k=s("el-option"),E=s("el-select"),D=s("ElInput"),L=s("el-switch"),I=s("el-row"),x=s("el-card"),N=s("el-radio"),m=s("el-radio-group"),T=s("el-text"),me=s("ElForm"),K=s("ElButton"),ce=s("ElDrawer");return r(),c(ce,{modelValue:B.value,"onUpdate:modelValue":n[12]||(n[12]=e=>B.value=e),title:o(se),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:C},{footer:a(()=>[t(K,{size:"large",onClick:C},{default:a(()=>[b(" 取消 ")]),_:1}),t(K,{type:"primary",size:"large",onClick:pe},{default:a(()=>[b(" 确定 ")]),_:1})]),default:a(()=>[t(me,{ref_key:"formRef",ref:w,model:o(l),rules:o(S),"label-width":"100px"},{default:a(()=>[t(x,{class:"box-card"},{header:a(()=>[Ne]),default:a(()=>[t(I,{gutter:24},{default:a(()=>[t(f,{span:8},{default:a(()=>[t(d,{label:"用户名",prop:"userName"},{default:a(()=>[t(u,{modelValue:o(l).userName,"onUpdate:modelValue":n[0]||(n[0]=e=>o(l).userName=e),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(d,{label:"姓名",prop:"name"},{default:a(()=>[t(u,{modelValue:o(l).name,"onUpdate:modelValue":n[1]||(n[1]=e=>o(l).name=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(d,{label:"国家",prop:"country"},{default:a(()=>[t(q,{modelValue:o(l).country,"onUpdate:modelValue":n[2]||(n[2]=e=>o(l).country=e),placeholder:"请选择国家",clearable:"",filterable:"",tabindex:"2"},{default:a(()=>[(r(!0),V(h,null,y(o(P),e=>(r(),c(M,{label:e.chineseName,value:e.code},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(l).country==="CN"?(r(),c(f,{key:0,span:8},{default:a(()=>[t(d,{label:"手机号",prop:"phone"},{default:a(()=>[t(u,{modelValue:o(l).phone,"onUpdate:modelValue":n[3]||(n[3]=e=>o(l).phone=e),placeholder:"请输入手机号",clearable:"",onChange:$,onBlur:Z},null,8,["modelValue"])]),_:1})]),_:1})):(r(),c(f,{key:1,span:8},{default:a(()=>[t(d,{label:"邮箱",prop:"email"},{default:a(()=>[t(u,{modelValue:o(l).email,"onUpdate:modelValue":n[4]||(n[4]=e=>o(l).email=e),placeholder:"请输入邮箱",clearable:"",onChange:$,onBlur:Z},null,8,["modelValue"])]),_:1})]),_:1})),t(f,{span:8},{default:a(()=>[t(d,{label:"部门"},{default:a(()=>[t(E,{modelValue:o(l).departmentId,"onUpdate:modelValue":n[5]||(n[5]=e=>o(l).departmentId=e),placeholder:"请选择部门",disabled:o(l).id!=="",clearable:"",filterable:"",onChange:j},{default:a(()=>[(r(!0),V(h,null,y(o(F),e=>(r(),c(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(d,{label:"职位",prop:"positionId"},{default:a(()=>[t(E,{modelValue:o(l).positionId,"onUpdate:modelValue":n[6]||(n[6]=e=>o(l).positionId=e),placeholder:"请选择职位",clearable:"",filterable:"",onChange:n[7]||(n[7]=()=>{})},{default:a(()=>[(r(!0),V(h,null,y(o(A),e=>(r(),c(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(d,{label:"密码",prop:"password"},{default:a(()=>[t(D,{disabled:o(O),modelValue:o(l).password,"onUpdate:modelValue":n[8]||(n[8]=e=>o(l).password=e),placeholder:"如要修改密码请前往个人中心"},null,8,["disabled","modelValue"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(d,{label:"是否启用",prop:"active"},{default:a(()=>[t(L,{modelValue:o(l).active,"onUpdate:modelValue":n[9]||(n[9]=e=>o(l).active=e),"inline-prompt":"","active-text":"开启","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(x,{class:"box-card"},{header:a(()=>[Ue]),default:a(()=>[t(I,{gutter:24},{default:a(()=>[t(d,{label:"分配角色:"},{default:a(()=>[t(m,{modelValue:o(l).role,"onUpdate:modelValue":n[10]||(n[10]=e=>o(l).role=e)},{default:a(()=>[(r(!0),V(h,null,y(o(R),e=>(r(),c(N,{key:e.id,value:e.id,label:e.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(x,{class:"box-card"},{header:a(()=>[_("div",Be,[_("div",Me,[b(" 小组信息"),_("span",qe,[b("负责人:"),(r(!0),V(h,null,y(o(z),e=>(r(),c(T,{key:e.id},{default:a(()=>[e.id===o(l).director?(r(),c(T,{key:0},{default:a(()=>[b(Ve(e.name),1)]),_:2},1024)):ye("",!0)]),_:2},1024))),128))])])])]),default:a(()=>[t(I,{gutter:24},{default:a(()=>[t(d,{label:"分配小组:"},{default:a(()=>[o(U).length?(r(),c(m,{key:0,modelValue:o(l).groupId,"onUpdate:modelValue":n[11]||(n[11]=e=>o(l).groupId=e),disabled:o(l).id!==""},{default:a(()=>[(r(!0),V(h,null,y(o(U),e=>(r(),c(N,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])):(r(),c(T,{key:1},{default:a(()=>[b("-")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ge=Ee(De,[["__scopeId","data-v-15d833f7"]]);export{Ge as default};
