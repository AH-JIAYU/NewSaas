
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as pe,aN as ue,r,Z as U,c as de,n as me,a as p,q as fe,o as s,b as _e,f as l,w as a,i as t,g as i,A as b,s as A,e as c,aM as he,z as y,ao as ge,j as m,y as $,N as ye,bb as be,bc as ve,an as we,aH as ke,aI as Ce,L as xe}from"./index--1DmJruX.js";import{_ as Ie}from"./index.vue_vue_type_style_index_0_lang-BhxceQX0.js";import{_ as Se}from"./index-VbVIr_G_.js";import{q as Ne,a as V}from"./index-3LH1jw86.js";import{u as Le}from"./user_customer-BldK0Myv.js";import"./index.vue_vue_type_script_setup_true_lang-DPW1ngU8.js";import"./sortable.esm-C0-Qcoum.js";/* empty css                      */import"./user_customer-BRhN7RR0.js";const je=w=>(ke("data-v-ecb4dc56"),w=w(),Ce(),w),Te=je(()=>$("br",null,null,-1)),ze={class:"tableBig"},Re=pe({name:"preInvestigationRecords",__name:"index",setup(w){const F=Le(),{getParams:M,pagination:u,onSizeChange:O,onCurrentChange:G}=ue(),k=r(!1),R=r([]);r("");const d=r([]),C=r(!1),x=r(!1),I=r("default"),S=r(!1),D=r(),Q=r("formSearch-preInvestigationRecords"),N=r([{prop:"projectId",label:"项目ID",sortable:!0,checked:!0},{prop:"projectName",label:"项目名称",sortable:!0,checked:!0},{prop:"allocationType",label:"分配类型",sortable:!0,checked:!0},{prop:"passNumber",label:"通过数/提交数",sortable:!0,checked:!0},{prop:"passRate",label:"通过率",sortable:!0,checked:!0}]),f=U({projectId:"",projectName:"",allocationType:[]}),E=r(),h=U({allocationTypeList:["未分配","供应商","内部站"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],viceStatusList:["待审","免审","过IR","时间果断","超时完成","超量完成","审核成功","审核失败","数据冻结","时间段过载","ip不一致","id重复参与","和解"],customerList:[],vipList:[],vipGroupList:[],tenantSupplierList:[],expandedRows:[]});function Z(){f.pageNo=1,v()}function J(n){O(n).then(()=>v())}function q(n=1){G(n).then(()=>v())}async function B(n){const o=h.expandedRows.indexOf(n.id);if(o!==-1?h.expandedRows.splice(o,1):h.expandedRows.push(n.id),!n.children){const z=await V.childList({projectId:n.projectId});n.children=z.data.projectScreenMemberChildInfoList}}function K(n){E.value.showEdit(n)}const W=de(()=>R.value.filter(o=>{if(o.projectId.includes(f.projectId)&&o.projectName.includes(f.projectName)&&(!f.allocationType||o.allocationType===f.allocationType))return!0}).slice((u.value.page-1)*u.value.size,u.value.page*u.value.size));async function v(){try{k.value=!0;const n={...M(),...f},{data:o}=await V.list(n);R.value=o.projectSurveyScreenInfoList,u.value.total=o.projectSurveyScreenInfoList.length,k.value=!1}catch{}finally{k.value=!1}}function X(){Object.assign(f,{projectId:"",projectName:"",allocationType:[]}),v()}me(async()=>{h.customerList=await F.getCustomerList(),N.value.forEach(n=>{n.checked&&d.value.push(n.prop)}),v(),D.value=[{index:1,show:!0,type:"input",modelName:"projectId",placeholder:"项目ID"},{index:2,show:!0,type:"input",modelName:"projectName",placeholder:"项目名称"},{index:3,show:!0,type:"select",modelName:"allocationType",placeholder:"分配类型",option:"allocationType",optionLabel:"label",optionValue:"value",multiple:!0}]});const Y={allocationType:()=>h.allocationTypeList.map((n,o)=>({label:n,value:o+1}))};return(n,o)=>{const z=Se,ee=p("ElDivider"),te=Ie,H=p("el-button"),ae=be,oe=ve,le=p("el-row"),g=p("el-table-column"),L=p("el-text"),j=p("ElTableColumn"),ne=p("ElButton"),P=p("el-table"),T=p("el-tag"),se=p("el-empty"),ie=p("ElPagination"),re=we,ce=fe("loading");return s(),_e("div",{class:ye({"absolute-container":t(S)})},[l(re,null,{default:a(()=>[l(z,{formSearchList:t(D),formSearchName:t(Q),onCurrentChange:q,onOnReset:X,model:t(f),formOption:Y},null,8,["formSearchList","formSearchName","model"]),l(ee,{"border-style":"dashed"}),l(le,null,{default:a(()=>[l(te),l(oe,null,{default:a(()=>[l(H,{size:"default"},{default:a(()=>[i(" 导出 ")]),_:1}),l(ae,{border:t(C),"onUpdate:border":o[0]||(o[0]=e=>b(C)?C.value=e:null),tableAutoHeight:t(S),"onUpdate:tableAutoHeight":o[1]||(o[1]=e=>b(S)?S.value=e:null),checkList:t(d),"onUpdate:checkList":o[2]||(o[2]=e=>b(d)?d.value=e:null),columns:t(N),"onUpdate:columns":o[3]||(o[3]=e=>b(N)?N.value=e:null),"line-height":t(I),"onUpdate:lineHeight":o[4]||(o[4]=e=>b(I)?I.value=e:null),stripe:t(x),"onUpdate:stripe":o[5]||(o[5]=e=>b(x)?x.value=e:null),style:{"margin-left":"12px"},onQueryData:Z},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),A((s(),c(P,{border:t(C),data:t(W),size:t(I),stripe:t(x),"row-key":"id","expand-row-keys":t(h).expandedRows,onExpandChange:B},{empty:a(()=>[l(se,{image:t(he),"image-size":300},null,8,["image"])]),default:a(()=>[l(g,{type:"expand",width:"55"},{default:a(e=>[l(P,{data:e.row.children,"highlight-current-row":"",class:"hide-table-header",border:"",height:"100%"},{default:a(()=>[l(g,{width:"55"}),l(g,{width:"300",prop:"memberChildName",label:"名称+ID",align:"left"},{default:a(_=>[l(L,{class:"fontC-System"},{default:a(()=>[i(y(_.row.memberChildName),1)]),_:2},1024),Te,A(l(L,{type:"danger",class:"fontC-System"},{default:a(()=>[i("随机id:"+y(_.row.randomIdentityId),1)]),_:2},1536),[[ge,_.row.randomIdentityId]])]),_:1}),l(j,{prop:"status",label:"状态",align:"left"},{default:a(_=>[_.row.status===1?(s(),c(L,{key:0,type:"success",class:"fontC-System"},{default:a(()=>[i("前置问卷通过")]),_:1})):(s(),c(L,{key:1,type:"danger",class:"fontC-System"},{default:a(()=>[i("前置问卷未通过")]),_:1}))]),_:1}),l(j,{width:"200",align:"left",fixed:"right",label:"操作"},{default:a(_=>[l(ne,{type:"primary",size:"small",plain:"",onClick:De=>K(_.row)},{default:a(()=>[i(" 查看问卷详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])]),_:1}),t(d).includes("projectId")?(s(),c(g,{key:0,width:"300",align:"left",prop:"projectId","show-overflow-tooltip":"",label:"项目ID"})):m("",!0),t(d).includes("projectName")?(s(),c(g,{key:1,align:"left",prop:"projectName","show-overflow-tooltip":"",label:"项目名称"},{default:a(({row:e})=>[$("div",ze,y(e.projectName),1)]),_:1})):m("",!0),t(d).includes("allocationType")?(s(),c(g,{key:2,align:"left","show-overflow-tooltip":"",width:"100",label:"分配类型"},{default:a(({row:e})=>[e.allocationType===1?(s(),c(T,{key:0,effect:"plain",type:"info",class:"mx-1"},{default:a(()=>[i("未分配")]),_:1})):m("",!0),e.allocationType===2?(s(),c(T,{key:1,effect:"dark",style:{"background-color":"#fb6868",border:"none"},class:"mx-1",type:"primary"},{default:a(()=>[i("供应商")]),_:1})):m("",!0),e.allocationType===3?(s(),c(T,{key:2,effect:"dark",style:{"background-color":"#05c9be",border:"none"},class:"mx-1",type:"warning"},{default:a(()=>[i("内部站")]),_:1})):m("",!0),e.allocationType===4?(s(),c(T,{key:3,effect:"dark",style:{"background-color":"#ffac54",border:"none"},class:"mx-1",type:"warning"},{default:a(()=>[i("合作商")]),_:1})):m("",!0)]),_:1})):m("",!0),t(d).includes("passNumber")?(s(),c(g,{key:3,align:"left","show-overflow-tooltip":"",label:"通过数/提交数"},{default:a(({row:e})=>[i(y(e.passNumber||0)+"/ "+y(e.submitNumber||0),1)]),_:1})):m("",!0),t(d).includes("passRate")?(s(),c(j,{key:4,align:"left","show-overflow-tooltip":"",prop:"passRate",label:"通过率"},{default:a(({row:e})=>[i(y(e.passRate+"%"),1)]),_:1})):m("",!0),l(j,{align:"left","show-overflow-tooltip":"",prop:"",fixed:"right",label:"操作",width:"200"},{default:a(({row:e})=>[l(H,{plain:"",type:"primary",size:"small",onClick:_=>B(e)},{default:a(()=>[i(y(t(h).expandedRows.includes(e.id)?"收起":"展开"),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["border","data","size","stripe","expand-row-keys"])),[[ce,t(k)]]),l(ie,{"current-page":t(u).page,total:t(u).total,"page-size":t(u).size,"page-sizes":t(u).sizes,layout:t(u).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:J,onCurrentChange:q},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),l(Ne,{ref_key:"questionnaireDetailsRef",ref:E},null,512)],2)}}}),Fe=xe(Re,[["__scopeId","data-v-ecb4dc56"]]);export{Fe as default};
