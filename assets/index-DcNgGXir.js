
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as b,af as P,d as Q,r as x,a as T,o as I,b as y,f as o,w as r,y as t,g as p,z as n,i as _,F as j,t as N,N as S,bv as A,aL as E,j as $,A as F,aG as H,aH as q,L as w}from"./index-C74Hc-Sz.js";const z={list:f=>b.post("tenantBind/getProjectAllocationList",f),meList:f=>b.post("tenantBind/getProjectMeAllocationList",f),getTenantMeasurementList:f=>b.post("tenantBind/getTenantMeasurementList",f),getQuestionnaireClickList:f=>b.post("tenantBind/getQuestionnaireClickList",f)},R=P("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),U=R,J=f=>(H("data-v-f4548e29"),f=f(),q(),f),K={class:"details"},W={class:"details-left"},X={class:"project box"},Y=J(()=>t("div",{class:"step"},[t("div",{class:"spot"}),t("div",{class:"line"})],-1)),Z=["onClick"],ee={class:"item-left"},te={class:"tenant"},se={key:0,class:"tenantName"},ne={class:"tenantLength"},ae={class:"tenantName"},le={class:"price flex-b"},oe={class:"viewAll"},ie={key:0,class:"details-right"},ce={key:0,class:"clickId"},re={class:"clickIdItem"},pe={class:"clickIdItem-title"},ue={class:"supplierName"},de={class:"clickIdItem-content"},_e={key:1,class:"nodata"},fe={style:{flex:"auto"}},Ie=Q({name:"Edit",__name:"index",setup(f,{expose:O}){const k=U(),g=x(!1);x();const s=x({select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function G(i,m=0){const a={linkId:i.linkId,projectId:i.projectId,source:m},u=await z.getTenantMeasurementList(a),d=u.data.tenantMeasurementInfoList;u.data.tenantMeasurementInfo&&d.unshift(u.data.tenantMeasurementInfo);const h=d.findIndex(c=>c.allocationTenantId===u.data.currentTenantId);d.splice(0,h);const e=d.filter(c=>c.type===1),l=d.filter(c=>c.type===2),L=d.filter(c=>c.type===3),v=[...e];if(l.length){const c=l.map(C=>C.memberGroupOrSupperId);l[0].length=l.length,l[0].memberGroupOrSupperIdList=c,v.push(l[0])}else if(L.length){const c=L.map(C=>C.memberGroupOrSupperId);L[0].length=L.length,L[0].memberGroupOrSupperIdList=c,v.push(L[0])}v.forEach(c=>c.visible=!1),s.value.currentTenantId=u.data.currentTenantId,s.value.tenantMeasurementInfoList=v,g.value=!0}const V=async(i,m)=>{s.value.select=s.value.select===m?"":m,s.value.clickIdList=[];const a={type:i.type,projectId:i.projectId,tenantId:i.allocationTenantId,supplierIdList:i.type===2?i.memberGroupOrSupperIdList:[],memberGroupIdList:i.type===3?i.memberGroupOrSupperIdList:[]},u=await z.getQuestionnaireClickList(a);s.value.clickIdList=B(u.data.questionnaireClickInfoList),i.type===2?s.value.clickIdList=s.value.clickIdList.filter(d=>d.peopleType===2):i.type===3&&(s.value.clickIdList=s.value.clickIdList.filter(d=>d.peopleType===1))};function B(i){return i.reduce((m,a)=>{const{supplierId:u,supplierName:d,projectQuestionnaireClickId:h,surveyStatus:e,price:l,peopleType:L}=a;let v=m.find(c=>c.supplierId===u);return v?v.list.push({projectQuestionnaireClickId:h,surveyStatus:e,price:l}):m.push({supplierId:u,peopleType:L,supplierName:d,list:[{projectQuestionnaireClickId:h,surveyStatus:e,price:l}]}),m},[])}function M(){g.value=!1,s.value={select:"",currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]}}function D(){M()}return O({showEdit:G}),(i,m)=>{const a=T("el-text"),u=T("el-button"),d=T("el-empty"),h=T("el-drawer");return I(),y("div",null,[o(h,{modelValue:_(g),"onUpdate:modelValue":m[0]||(m[0]=e=>F(g)?g.value=e:null),title:"详情",size:"60%","before-close":M},{footer:r(()=>[t("div",fe,[o(u,{onClick:M},{default:r(()=>[p(" 取消 ")]),_:1}),o(u,{type:"primary",onClick:D},{default:r(()=>[p(" 确定 ")]),_:1})])]),default:r(()=>[t("div",K,[t("div",W,[t("div",X,[t("div",null,[o(a,{tag:"b"},{default:r(()=>{var e;return[p(n((e=_(s).tenantMeasurementInfoList[0])==null?void 0:e.projectName),1)]}),_:1})]),t("div",null,[o(a,{type:"info"},{default:r(()=>{var e;return[p("ID："+n((e=_(s).tenantMeasurementInfoList[0])==null?void 0:e.projectId),1)]}),_:1})])]),(I(!0),y(j,null,N(_(s).tenantMeasurementInfoList,(e,l)=>(I(),y("div",{class:"link",key:e.allocationTenantId},[Y,t("div",{class:S({"item box":!0,select:l===_(s).select}),onClick:L=>V(e,l)},[t("div",ee,[t("div",te,[(e==null?void 0:e.length)>1?(I(),y("p",se,[p(" 已分配数： "),t("span",ne,n(e==null?void 0:e.length),1),t("span",{class:S("type"+e.type)},n(_(k).typeList[e.type-1]),3)])):(I(),y(j,{key:1},[t("p",null,[t("span",ae,n(e.tenantName),1),t("span",{class:S("type"+e.type)},n(_(k).typeList[e.type-1]),3)]),o(a,{type:"info"},{default:r(()=>[p("ID："+n(e.allocationTenantId),1)]),_:2},1024)],64))]),t("div",le,[t("p",null," 项目价: "+n(e.currencyType===1?"$":"￥")+" "+n(e.doMoneyPrice),1),t("p",null,[p(" 参数: "),o(a,{size:"large"},{default:r(()=>[p(n(e.participationNumber||0),1)]),_:2},1024),o(a,{size:"large"},{default:r(()=>[p(" / ")]),_:1}),o(a,{type:"success",size:"large"},{default:r(()=>[p(n(e.doneNumber||0),1)]),_:2},1024),o(a,{size:"large"},{default:r(()=>[p(" / ")]),_:1}),o(a,{type:"warning",size:"large"},{default:r(()=>[p(n(e.num||0),1)]),_:2},1024),o(a,{size:"large"},{default:r(()=>[p(" / ")]),_:1}),o(a,{size:"large"},{default:r(()=>[p(n(e.limitedQuantity||0),1)]),_:2},1024)])])]),t("div",oe,[o(u,{type:"primary",circle:"",size:"small",icon:_(A)},null,8,["icon"])])],10,Z)]))),128))]),_(s).select!==""?(I(),y("div",ie,[_(s).clickIdList.length?(I(),y("div",ce,[(I(!0),y(j,null,N(_(s).clickIdList,e=>(I(),y("div",re,[t("div",pe,[t("div",null,[t("span",ue,n(e.supplierName),1),t("span",{class:S("peopleType"+e.peopleType)},n(_(k).peopleTypeList[e.peopleType-1]),3)]),t("div",null,[o(a,{type:"info"},{default:r(()=>[p("ID： "+n(e.supplierId),1)]),_:2},1024)])]),t("div",de,[t("ul",null,[(I(!0),y(j,null,N(e.list,l=>(I(),y("li",null,[t("span",null,n(l.projectQuestionnaireClickId),1),t("span",{class:S("surveyStatus"+l.surveyStatus)},n(_(k).surveyStatusList[l.surveyStatus-1]),3)]))),256))])])]))),256))])):(I(),y("div",_e,[o(d,{image:_(E),"image-size":300},null,8,["image"])]))])):$("",!0)])]),_:1},8,["modelValue"])])}}}),ye=w(Ie,[["__scopeId","data-v-f4548e29"]]),Le=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{z as a,Le as i,ye as o,U as u};
