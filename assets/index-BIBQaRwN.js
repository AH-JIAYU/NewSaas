
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as Ie,r as p,l as Ne,aM as Le,n as ze,X as Se,a as s,q as xe,o as i,b as y,y as C,f as n,j as m,w as o,s as Ee,az as H,F as P,t as R,g as d,i as _,aL as Ve,e as c,z as b,N as we,p as x,aN as $,E as M,_ as De,b8 as Be,ap as Ue,L as He,ao as T}from"./index-DaxZqrrB.js";import{_ as Pe}from"./index-DaXAXuI3.js";import{u as Re}from"./position_manage-LCfbdVbO.js";import $e from"./index-DTaEJlPE.js";import Me from"./index-BxSxAXrj.js";import"./index-ByUZgMbX.js";import"./position_manage-CH6g5JjZ.js";import"./department-Drc9pKsg.js";import"./configuration_role-DgLYl1dR.js";import"./tenant_role-tbocg4DA.js";import"./configuration_manager-ByFsqNL9.js";import"./department-BUc4hCgD.js";const Te={class:"absolute-container"},Ae={class:"page-main"},Fe={class:"leftTree"},je={key:0,class:"leftData",span:3},Ke={class:"dataForm-container"},Oe={class:"copyId tableSmall"},qe={class:"id oneLine idFont"},A=Ie({name:"user",__name:"index",setup(Je){const I=Re(),E=p(),F=Ne(),j=p([]),{pagination:g,getParams:Qe,onSizeChange:K,onCurrentChange:O,onSortChange:q}=Le(),N=p([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),J=[{label:"启用",value:!0},{label:"禁用",value:!1}],Q={children:"children",label:"name"},X=p(),V=p(),u=p({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),L=p(),G=p(),e=p({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),W=p();async function r(){const t={...e.value.search},l=await x.list(t);l.data&&(e.value.dataList=l.data.data,g.value.total=+l.data.total)}ze(async()=>{try{u.value.loading=!0,j.value=await F.getCountry(),E.value=await(I==null?void 0:I.getPositionManage())||[],r(),N.value.forEach(t=>{t.checked&&e.value.checkList.push(t.prop)}),u.value.loading=!1}catch{}finally{u.value.loading=!1}}),Se(()=>u.value.search,t=>{X.value.filter(t)});function Y(t){return new Promise(l=>{$.confirm(`确认${t.active?"禁用":"启用"}「${t.userName}」吗？`,"确认信息").then(()=>{try{u.value.loading=!0,x.edit({id:t.id,email:t.email,phoneNumber:t.phoneNumber,userName:t.userName,country:t.country,role:t.role,positionId:t.positionId,organizationalStructureId:t.organizationalStructureId,active:!t.active}).then(()=>(M.success({message:`${t.active?"禁用":"启用"}成功`,center:!0}),r(),u.value.loading=!1,l(!0))).catch(()=>(u.value.loading=!1,l(!1)))}catch{}finally{u.value.loading=!1}}).catch(()=>l(!1))})}function Z(t){var l;g.value.page=1,(l=t==null?void 0:t.children)!=null&&l.length?(e.value.search.id="",e.value.search.departmentId=t.id,r()):(e.value.search.id=t.id,e.value.search.departmentId="",r())}function ee(t){K(t).then(()=>{e.value.search.limit=t,r()})}function te(t=1){O(t).then(()=>{e.value.search.page=t,r()})}function ae({prop:t,order:l}){q(t,l).then(()=>r())}function le(t){e.value.dialog.id="",e.value.dialog.visible=!0,e.value.dialog.level=1,t&&(e.value.dialog.parentId=t.id,e.value.dialog.level=Number(t.level)+1)}const ne=t=>{L.value=t[0]};function oe(){if(L.value){const{userName:t,id:l}=L.value;$.confirm(`确认将「${t}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{x.reset({id:l}).then(()=>{M.success({message:"重置成功",center:!0}),r()})}).catch(()=>{})}}function ie(t){e.value.row=JSON.stringify(t),e.value.dialog.id=t.id,e.value.dialog.parentId=t.parentId,e.value.dialog.visible=!0}function se(t){V.value.showEdit(t)}function re(){Object.assign(e.value.search,{id:"",userName:"",departmentId:null,active:null}),r()}const z=p();function ue(t){t?z.value=t.id:z.value=""}return(t,l)=>{const w=s("el-tree"),D=s("ElInput"),de=s("el-option"),ce=s("el-select"),B=De,k=s("ElButton"),pe=s("ElSpace"),S=s("el-button"),U=s("el-col"),me=Be,ve=s("el-row"),v=s("ElTableColumn"),fe=s("ElSwitch"),ge=s("el-tooltip"),he=Pe,f=s("el-text"),_e=s("el-empty"),be=s("ElTable"),ye=s("ElPagination"),ke=Ue,Ce=xe("loading");return i(),y("div",Te,[C("div",Ae,[C("div",Fe,[u.value.tree.length?(i(),y("div",je,[n(w,{style:{"max-width":"37.5rem","min-height":"45.4375rem",padding:"10px"},data:u.value.tree,ref_key:"treeRef",ref:W,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,props:Q,onNodeClick:Z},null,8,["data"])])):m("",!0),n(ke,null,{default:o(()=>[Ee((i(),y("div",Ke,[n(pe,null,{default:o(()=>[n(D,{modelValue:e.value.search.id,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.search.id=a),placeholder:"员工ID",clearable:"",style:{width:"12.5rem"},onKeydown:H(r,["enter"])},null,8,["modelValue"]),n(D,{modelValue:e.value.search.userName,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.search.userName=a),placeholder:"用户名",clearable:"",style:{width:"12.5rem"},onKeydown:H(r,["enter"])},null,8,["modelValue"]),n(ce,{modelValue:e.value.search.active,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.search.active=a),"value-key":"",placeholder:"状态",style:{width:"12.5rem"},clearable:"",filterable:"",onChange:r},{default:o(()=>[(i(),y(P,null,R(J,a=>n(de,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),n(k,{type:"primary",onClick:r},{icon:o(()=>[n(B,{name:"i-ep:search"})]),_:1}),n(k,{onClick:re},{icon:o(()=>[n(B,{name:"i-ep:refresh"})]),_:1})]),_:1}),n(ve,{style:{"margin-bottom":".3125rem"},gutter:24},{default:o(()=>[n(U,{style:{"margin-bottom":"1.5625rem"},span:10},{default:o(()=>[n(S,{type:"primary",size:"default",onClick:le},{default:o(()=>[d(" 新增 ")]),_:1}),n(S,{type:"primary",size:"default",onClick:oe},{default:o(()=>[d(" 重置密码 ")]),_:1})]),_:1}),n(U,{style:{display:"flex","justify-content":"flex-end"},span:14},{default:o(()=>[n(S,{size:"default",onClick:l[3]||(l[3]=()=>{})},{default:o(()=>[d(" 导出 ")]),_:1}),n(me,{border:e.value.border,"onUpdate:border":l[4]||(l[4]=a=>e.value.border=a),tableAutoHeight:e.value.tableAutoHeight,"onUpdate:tableAutoHeight":l[5]||(l[5]=a=>e.value.tableAutoHeight=a),checkList:e.value.checkList,"onUpdate:checkList":l[6]||(l[6]=a=>e.value.checkList=a),columns:N.value,"onUpdate:columns":l[7]||(l[7]=a=>N.value=a),"line-height":e.value.lineHeight,"onUpdate:lineHeight":l[8]||(l[8]=a=>e.value.lineHeight=a),stripe:e.value.stripe,"onUpdate:stripe":l[9]||(l[9]=a=>e.value.stripe=a),style:{"margin-left":".75rem"},onQueryData:r},null,8,["border","tableAutoHeight","checkList","columns","line-height","stripe"])]),_:1})]),_:1}),n(be,{ref_key:"userItemRef",ref:G,data:e.value.dataList,border:e.value.border,size:e.value.lineHeight,stripe:e.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:ae,onCurrentChange:ue,onSelectionChange:l[10]||(l[10]=a=>e.value.selectionDataList=a),"row-key":"id","default-expand-all":"",onSelect:ne},{empty:o(()=>[n(_e,{image:_(Ve),"image-size":300},null,8,["image"])]),default:o(()=>[n(v,{type:"selection",align:"left",fixed:""}),e.value.checkList.includes("active")?(i(),c(v,{key:0,align:"left",prop:"active",label:"状态",width:"84"},{default:o(a=>[n(fe,{modelValue:a.row.active,"onUpdate:modelValue":h=>a.row.active=h,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>Y(a.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):m("",!0),e.value.checkList.includes("id")?(i(),c(v,{key:1,align:"left",width:"280",prop:"id",label:"员工ID"},{default:o(({row:a})=>[C("div",Oe,[C("div",qe,[n(ge,{effect:"dark",content:a.id,placement:"top-start"},{default:o(()=>[d(b(a.id),1)]),_:2},1032,["content"])]),n(he,{content:a.id,class:we({rowCopy:"rowCopy",current:a.id===z.value})},null,8,["content","class"])])]),_:1})):m("",!0),e.value.checkList.includes("userName")?(i(),c(v,{key:2,align:"left",prop:"userName",label:"用户名"},{default:o(({row:a})=>[n(f,{class:"tableBig"},{default:o(()=>[d(b(a.userName?a.userName:"-"),1)]),_:2},1024)]),_:1})):m("",!0),e.value.checkList.includes("phoneNumber")?(i(),c(v,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:o(({row:a})=>[n(f,{class:"tableBig"},{default:o(()=>[d(b(a.phoneNumber?a.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):m("",!0),e.value.checkList.includes("email")?(i(),c(v,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:o(({row:a})=>[n(f,{class:"tableBig"},{default:o(()=>[d(b(a.email?a.email:"-"),1)]),_:2},1024)]),_:1})):m("",!0),e.value.checkList.includes("departmentId")?(i(),c(v,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:o(({row:a})=>[n(f,{class:"tableBig"},{default:o(()=>[d(b(a.organizationalStructureName?a.organizationalStructureName:"-"),1)]),_:2},1024)]),_:1})):m("",!0),e.value.checkList.includes("positionId")?(i(),c(v,{key:6,align:"left",prop:"positionId",label:"职位"},{default:o(({row:a})=>[a.positionId?(i(),c(f,{key:0,class:"tableBig"},{default:o(()=>[(i(!0),y(P,null,R(E.value,h=>(i(),c(f,null,{default:o(()=>[a.positionId===h.id?(i(),c(f,{key:0},{default:o(()=>[d(b(h.name?h.name:"-"),1)]),_:2},1024)):m("",!0)]),_:2},1024))),256))]),_:2},1024)):(i(),c(f,{key:1,class:"tableBig"},{default:o(()=>[d("-")]),_:1}))]),_:1})):m("",!0),n(v,{label:"操作",fixed:"right",width:"200",align:"left"},{default:o(a=>[n(k,{type:"primary",size:"small",plain:"",onClick:h=>ie(a.row)},{default:o(()=>[d(" 编辑 ")]),_:2},1032,["onClick"]),n(k,{type:"warning",size:"small",plain:"",onClick:h=>se(a.row)},{default:o(()=>[d(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"]),n(ye,{"current-page":_(g).page,total:_(g).total,"page-size":_(g).size,"page-sizes":_(g).sizes,layout:_(g).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:ee,onCurrentChange:te},null,8,["current-page","total","page-size","page-sizes","layout"])])),[[Ce,u.value.loading]])]),_:1})]),e.value.dialog.visible?(i(),c($e,{key:0,id:e.value.dialog.id,modelValue:e.value.dialog.visible,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.dialog.visible=a),"catalogue-id":e.value.search.catalogueId,"parent-id":e.value.dialog.parentId,level:e.value.dialog.level,tree:u.value.tree,dataList:e.value.dataList,row:e.value.row,onSuccess:r},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):m("",!0),n(Me,{ref_key:"detailRef",ref:V},null,512)])])}}});typeof T=="function"&&T(A);const st=He(A,[["__scopeId","data-v-f2d109f0"]]);export{st as default};
