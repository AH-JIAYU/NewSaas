
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{k as v,d as D,r as b,n as U,E as z,a as u,q as C,s as R,i as t,o as c,b as p,f as l,w as a,g as S,F as _,t as B,e as j,y as O,z as I,L as P}from"./index-DGgnHJGE.js";const V={list:s=>v.post("bill/getMemberBillList",s),create:s=>v.post("bill/addMemberSettlement",s),getMemberBillAvailableBalance:s=>v.post("bill/getMemberBillAvailableBalance",s),changestatus:s=>v.post("bill/updateMemberBill",s)},q=D({__name:"index",props:{id:{default:""}},setup(s,{expose:A}){const i=b(!1),g=b(),n=b({minimumAmount:"",settlementType:1,settlementAmount:"",addMemberSettlementInfoList:[]}),f=b({memberSettlementInfoList:[],memberSettlementInfoSelect:[]}),M=b({}),h=async()=>{try{i.value=!0;const r=await V.getMemberBillAvailableBalance({});f.value.memberSettlementInfoList=r.data.memberBillAvailableBalanceInfoList,n.value.minimumAmount=r.data.minimumAmount,i.value=!1}catch{}finally{i.value=!1}},L=r=>{const o=f.value.memberSettlementInfoList.filter(m=>r.includes(m.id));for(let m=0;m<o.length;m++)n.value.addMemberSettlementInfoList.push(o[m])};return U(async()=>{await h()}),A({submit(){return new Promise(r=>{g.value&&g.value.validate(o=>{if(o)try{i.value=!0,V.create(n.value).then(()=>{i.value=!1,z.success({message:"新增成功",center:!0}),r()})}catch{}finally{i.value=!1}})})}}),(r,o)=>{const m=u("el-radio"),E=u("el-radio-group"),d=u("ElFormItem"),y=u("ElInput"),x=u("el-option"),k=u("el-select"),w=u("ElInputNumber"),F=u("ElForm"),N=C("loading");return R((c(),p("div",null,[l(F,{ref_key:"formRef",ref:g,model:t(n),rules:t(M),"label-width":"9rem"},{default:a(()=>[l(d,{label:"结算方式"},{default:a(()=>[l(E,{modelValue:t(n).settlementType,"onUpdate:modelValue":o[0]||(o[0]=e=>t(n).settlementType=e)},{default:a(()=>[l(m,{value:1,size:"large"},{default:a(()=>[S(" 全部结算 ")]),_:1}),l(m,{value:2,size:"large"},{default:a(()=>[S(" 指定结算 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(n).settlementType===1?(c(),p(_,{key:0},[l(d,{label:"最低结算额度"},{default:a(()=>[l(y,{disabled:"",placeholder:"",value:t(n).minimumAmount},null,8,["value"])]),_:1}),l(d,{label:"结算金额"},{default:a(()=>[l(y,{modelValue:t(n).settlementAmount,"onUpdate:modelValue":o[1]||(o[1]=e=>t(n).settlementAmount=e),placeholder:""},null,8,["modelValue"])]),_:1})],64)):(c(),p(_,{key:1},[l(d,{label:"指定会员"},{default:a(()=>[l(k,{placeholder:"Select",modelValue:t(f).memberSettlementInfoSelect,"onUpdate:modelValue":o[2]||(o[2]=e=>t(f).memberSettlementInfoSelect=e),clearable:"",filterable:"",multiple:"","collapse-tags":"",onChange:L},{default:a(()=>[(c(!0),p(_,null,B(t(f).memberSettlementInfoList,e=>(c(),j(x,{key:e.id,value:e.id,label:e.memberName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"最低结算额度"},{default:a(()=>[l(y,{disabled:"",placeholder:"",value:"111"})]),_:1}),(c(!0),p(_,null,B(t(n).addMemberSettlementInfoList,e=>(c(),p(_,null,[l(d,{label:""},{default:a(()=>[O("p",null,I(e.memberId)+" - "+I(e.memberName)+" - 可用余额："+I(e.availableBalance),1)]),_:2},1024),l(d,{label:"结算金额"},{default:a(()=>[l(w,{"controls-position":"right",modelValue:e.settlementAmount,"onUpdate:modelValue":T=>e.settlementAmount=T,max:e.availableBalance,placeholder:""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)],64))),256))],64))]),_:1},8,["model","rules"])])),[[N,t(i)]])}}}),$=P(q,[["__scopeId","data-v-fa8f99b0"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));export{$ as D,V as a,H as i};
