
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as z}from"./index.vue_vue_type_script_setup_true_lang-QnF2-1qy.js";import{o as M,s as y}from"./apiLoading-JmxtB70e.js";import{a as f}from"./user_supplier-C6y2KO5o.js";import{u as R}from"./stagedData-BYFJ8wfm.js";import{U as j}from"./user_supplier-CX6wuZw6.js";import{u as O}from"./user_customer-BrqaqbBD.js";import{d as P,r as i,X,Z as m,n as Z,a as h,o as T,b as $,f as c,w as u,y as q,g as v,e as F,j as G,i as H,N as J,ao as C,E as d,L as K}from"./index-Cg_UlhSM.js";import"./index-V2BWErIO.js";import"./index-b4FFEIOq.js";import"./configuration_supplierLevel-BXR9JFho.js";import"./user_customer-CwN6Om7U.js";const Q={class:"flex-c"},W=P({__name:"index",emits:["fetch-data"],setup(Y,{expose:S,emit:L}){const p=R(),_=j(),k=O(),x=L,l=i(!1),o=i(""),b=i(),n=i([]),r=i([]);function D(e){r.value.push(e)}X("validateTopTabs",D);let t=m([]);async function V(e){if(!e)o.value="新增",t=p.usersupplier||[C(_.initialTopTabsData)];else{o.value="编辑";const{data:a}=await M(f.detail({tenantSupplierId:e.tenantSupplierId}));a.countryType=a.subordinateCountryId==="343"?1:2,E(a)}n.value=[],l.value=!0,_.TenantSupplierList=null}function E(e){t.length=0,t.push({...e})}function N(e){const a=new Set;for(const s of e){if(a.has(s.supplierAccord))return!0;a.add(s.supplierAccord)}return!1}function I(){p.usersupplier=C(t),t=m([]),l.value=!1,r.value=[]}function g(){t=m([]),l.value=!1,r.value=[],o.value==="新增"&&(p.usersupplier=null)}async function w(){const e=[];r.value.forEach(s=>{e.push(s.validate())});const a=await Promise.allSettled(e);n.value=a.map(s=>s.status)}async function U(){if(t.forEach(e=>{delete e.payMethod,delete e.accountName,delete e.collectionAccount,delete e.bankName}),await w(),n.value.every(e=>e==="fulfilled"))if(N(t))d.warning({message:"供应商名称重复",center:!0});else{if(o.value==="新增"){const e={addTenantSupplierInfoList:t},{status:a}=await y(f.create(e));a===1&&d.success({message:"新增成功",center:!0})}else{delete t[0].getTenantCustomerOperationInfosList;const{status:e}=await y(f.edit(t[0]));e===1&&d.success({message:"修改成功",center:!0})}x("fetch-data"),g()}else b.value.activeLeftTab=n.value.indexOf("rejected"),d.warning({message:"请完善表单",center:!0})}return Z(async()=>{await k.getCustomerList()}),S({showEdit:V}),(e,a)=>{const s=h("el-button"),A=h("el-drawer");return T(),$("div",null,[c(A,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=B=>l.value=B),class:J(o.value==="新增"?"hide-drawer-header":"edit-drawer"),"append-to-body":"","close-on-click-modal":!1,"destroy-on-close":"",draggable:"",size:"70%",title:""},{footer:u(()=>[q("div",Q,[c(s,{onClick:g},{default:u(()=>[v(" 取消 ")]),_:1}),o.value==="新增"?(T(),F(s,{key:0,type:"warning",onClick:I},{default:u(()=>[v(" 暂存 ")]),_:1})):G("",!0),c(s,{type:"primary",onClick:U},{default:u(()=>[v(" 确定 ")]),_:1})])]),default:u(()=>[c(z,{onValidate:w,ref_key:"LeftTabsRef",ref:b,title:o.value,"left-tabs-data":H(t),"validate-top-tabs":r.value,"validate-all":n.value},null,8,["title","left-tabs-data","validate-top-tabs","validate-all"])]),_:1},8,["modelValue","class"])])}}}),de=K(W,[["__scopeId","data-v-a39efee8"]]);export{de as default};
