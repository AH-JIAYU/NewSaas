
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ve,l as he,J as Ce,aM as Pe,y as we,r as S,c as Ie,n as Se,z as E,C as Le,a as u,q as U,o as s,b as x,f as r,w as l,i as a,s as y,e as d,g as p,aN as Me,A as B,F as T,j as F,O as ke,E as P,aO as O,ao as xe,M as Ve}from"./index-BZvN0JzH.js";import{_ as je}from"./index-CKmp6MQY.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-BNHUstfW.js";import{s as w}from"./apiLoading-DRKsIy8c.js";import{G as b}from"./otherFunctions_screenLibrary-BlMyk1NH.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-Bz9Tnyrx.js";import{u as $e}from"./index-DTVjHYMo.js";import{u as ze}from"./stagedData-1fvXUgdu.js";import{u as Ee}from"./useTabbar-CVfKzmAI.js";import"./index.vue_vue_type_script_setup_true_lang-DM0I2tI6.js";import"./sortable.esm-C0-Qcoum.js";/* empty css                      */const Ue=ve({name:"screen_library",__name:"list",setup(Be){const A=he(),R=$e(),I=ze(),q=Ce(),{pagination:m,getParams:G,onSizeChange:H,onCurrentChange:J,onSortChange:K}=Pe(),Q=Ee(),V=we(),j=S(),W=S("formSearch-screen_library"),e=S({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,id:"",details:"",title:""},editProps:{id:"",countryId:"",visible:!1,row:""},search:{countryId:""},batch:{enable:!1,selectionDataList:[]},dataList:[],countryList:[],rules:{categoryName:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),N=S();function c(){try{e.value.loading=!0;const t={...G(),...e.value.search.countryId&&{countryId:e.value.search.countryId}};b.list(t).then(o=>{o.data&&o.status===1&&(e.value.dataList=o.data.getCountryListInfoList,m.value.total=o.data.getCountryListInfoList.length),e.value.loading=!1})}catch{}finally{e.value.loading=!1}}const D=Ie(()=>e.value.dataList.slice((m.value.page-1)*m.value.size,m.value.page*m.value.size));function X(t){H(t).then(()=>c())}function $(t=1){J(t).then(()=>c())}function z({prop:t,order:o}){K(t,o).then(()=>c())}function Y(t){e.value.editProps.id="",e.value.editProps.countryId=t?t.countryId:"",e.value.editProps.row="",e.value.editProps.visible=!0}function Z(t){t.getProjectProblemCategoryInfoList.unshift({categoryName:"",countryId:t.countryId,status:1,isDefault:t.isDefault,type:"add"})}function ee(t,o,v){N.value.validateField(`[${o}].getProjectProblemCategoryInfoList[${v}].categoryName`,async h=>{if(h){const{data:f,status:L}=await w(b.create(t));L===1&&P.success({message:"新增成功",center:!0}),await c()}})}function te(t,o){const v=e.value.dataList.findIndex(h=>h.countryId===t.countryId);e.value.dataList[v].getProjectProblemCategoryInfoList.splice(o,1)}async function ae(t){const{status:o}=await w(b.update(t));o===1&&P.success({message:"修改「默认区域」成功",center:!0}),c(),I.projectManagementList=null}async function oe(t){const{status:o}=await w(b.edit(t));o===1&&P.success({message:"修改「状态」成功",center:!0}),c(),I.projectManagementList=null}function ne(t){R.countryId=t.countryId,e.value.formMode==="router"?V.settings.tabbar.enable&&V.settings.tabbar.mergeTabsBy!=="activeMenu"?Q.open({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):q.push({name:"screenLibraryEdit",params:{id:t.projectProblemCategoryId}}):(e.value.formModeProps.id=t.projectProblemCategoryId,e.value.formModeProps.details=JSON.stringify(t),e.value.formModeProps.title=t.categoryName,e.value.formModeProps.visible=!0)}function le(t){O.confirm(`确认删除「${t.countryId}」吗？`,"确认信息").then(async()=>{const{status:o}=await w(b.delete({countryId:t.countryId}));o===1&&P.success({message:"删除成功",center:!0}),c()}).catch(()=>{}),I.projectManagementList=null}function re(t){O.confirm(`确认删除「${t.categoryName}」吗？`,"确认信息").then(async()=>{const{status:o}=await w(b.delete({projectProblemCategoryId:t.projectProblemCategoryId}));o===1&&P.success({message:"删除成功",center:!0}),c()}).catch(()=>{}),I.projectManagementList=null}function ie(){Object.assign(e.value.search,{countryId:""}),c()}return Se(async()=>{c(),e.value.countryList=await A.getCountry(),e.value.formMode==="router"&&E.on("get-data-list",()=>{c()}),j.value=[{index:1,show:!0,type:"select",modelName:"countryId",placeholder:"区域",option:"global",optionLabel:"chineseName",optionValue:"id"}]}),Le(()=>{e.value.formMode==="router"&&E.off("get-data-list")}),(t,o)=>{const v=je,h=u("ElDivider"),f=u("ElButton"),L=u("ElSpace"),M=u("el-table-column"),k=u("ElSwitch"),C=u("ElTableColumn"),se=u("el-input"),ue=u("el-form-item"),ce=u("el-text"),de=u("el-table"),me=u("el-tag"),ge=u("el-empty"),pe=u("ElTable"),fe=u("el-form"),ye=u("ElPagination"),_e=xe,_=U("auth"),be=U("loading");return s(),x("div",{class:ke({"absolute-container":a(e).tableAutoHeight})},[r(_e,null,{default:l(()=>[r(v,{formSearchList:a(j),formSearchName:a(W),onCurrentChange:$,onOnReset:ie,model:a(e).search},null,8,["formSearchList","formSearchName","model"]),r(h,{"border-style":"dashed"}),r(L,{wrap:""},{default:l(()=>[y((s(),d(f,{type:"primary",size:"default",onClick:Y},{default:l(()=>[p(" 新增前置问卷库 ")]),_:1})),[[_,"screen_library-get-addProjectProblemCategory"]])]),_:1}),r(fe,{ref_key:"formRef",ref:N,rules:a(e).rules,model:a(D)},{default:l(()=>[y((s(),d(pe,{class:"my-4",data:a(D),"highlight-current-row":"",height:"100%",onSortChange:z,onSelectionChange:o[1]||(o[1]=i=>a(e).batch.selectionDataList=i),"default-expand-all":!0},{empty:l(()=>[r(ge,{image:a(Me),"image-size":300},null,8,["image"])]),default:l(()=>[r(M,{type:"expand",width:"55"},{default:l(i=>[r(de,{data:i.row.getProjectProblemCategoryInfoList,"highlight-current-row":"",class:"hide-table-header",height:"100%",onSortChange:z,onSelectionChange:o[0]||(o[0]=n=>a(e).batch.selectionDataList=n)},{default:l(()=>[r(M,{width:"55"}),r(C,{prop:"status",label:"状态",align:"left"},{default:l(n=>[n.row.type==="add"?(s(),d(k,{key:0,modelValue:n.row.status,"onUpdate:modelValue":g=>n.row.status=g,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])):(s(),d(k,{key:1,onChange:g=>oe(n.row),modelValue:n.row.status,"onUpdate:modelValue":g=>n.row.status=g,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),r(M,{width:"500",prop:"categoryName",label:"问卷名称",align:"left"},{default:l(n=>[n.row.type==="add"?(s(),d(ue,{key:0,prop:`[${i.$index}].getProjectProblemCategoryInfoList[${n.$index}].categoryName`,rules:a(e).rules.categoryName},{default:l(()=>[r(se,{modelValue:n.row.categoryName,"onUpdate:modelValue":g=>n.row.categoryName=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(s(),d(ce,{key:1,class:"fontC-System"},{default:l(()=>[p(B(n.row.categoryName),1)]),_:2},1024))]),_:2},1024),r(C,{width:"250",align:"left",fixed:"right",label:"操作"},{default:l(n=>[n.row.type==="add"?(s(),x(T,{key:0},[y((s(),d(f,{type:"primary",size:"small",plain:"",onClick:g=>ee(n.row,i.$index,n.$index)},{default:l(()=>[p(" 提交 ")]),_:2},1032,["onClick"])),[[_,"screen_library-get-addProjectProblemCategory"]]),r(f,{type:"danger",size:"small",plain:"",onClick:g=>te(n.row,n.$index)},{default:l(()=>[p(" 取消 ")]),_:2},1032,["onClick"])],64)):(s(),x(T,{key:1},[y((s(),d(f,{type:"warning",size:"small",plain:"",onClick:g=>ne(n.row)},{default:l(()=>[p(" 设计问卷 ")]),_:2},1032,["onClick"])),[[_,"screen_library-get-addProjectProblem"]]),y((s(),d(f,{type:"danger",size:"small",plain:"",onClick:g=>re(n.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])),[[_,"screen_library-delete-deleteProjectProblemCategory"]])],64))]),_:2},1024)]),_:2},1032,["data"])]),_:1}),r(C,{prop:"isDefault",label:"默认/状态",align:"left"},{default:l(i=>[r(k,{onChange:n=>ae(i.row),modelValue:i.row.isDefault,"onUpdate:modelValue":n=>i.row.isDefault=n,"active-value":1,"inactive-value":2,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),r(C,{prop:"countryName",label:"区域/标题",width:"500",align:"left"},{default:l(({row:i})=>[r(me,{type:"primary"},{default:l(()=>[p(B(i.countryName),1)]),_:2},1024)]),_:1}),r(C,{label:"操作",width:"250",align:"left",fixed:"right"},{default:l(i=>[y((s(),d(f,{type:"primary",size:"small",plain:"",onClick:n=>Z(i.row)},{default:l(()=>[p(" 新增问卷 ")]),_:2},1032,["onClick"])),[[_,"screen_library-get-addProjectProblemCategory"]]),y((s(),d(f,{type:"danger",size:"small",plain:"",onClick:n=>le(i.row)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])),[[_,"screen_library-delete-deleteProjectProblemCategory"]])]),_:1})]),_:1},8,["data"])),[[be,a(e).loading]])]),_:1},8,["rules","model"]),r(ye,{"current-page":a(m).page,total:a(m).total,"page-size":a(m).size,"page-sizes":a(m).sizes,layout:a(m).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:X,onCurrentChange:$},null,8,["current-page","total","page-size","page-sizes","layout"])]),_:1}),a(e).editProps.visible?(s(),d(De,{key:0,id:a(e).editProps.id,countryId:a(e).editProps.countryId,modelValue:a(e).editProps.visible,"onUpdate:modelValue":o[2]||(o[2]=i=>a(e).editProps.visible=i),row:a(e).editProps.row,onSuccess:c},null,8,["id","countryId","modelValue","row"])):F("",!0),a(e).formMode==="dialog"||a(e).formMode==="drawer"?(s(),d(Ne,{key:1,id:a(e).formModeProps.id,modelValue:a(e).formModeProps.visible,"onUpdate:modelValue":o[3]||(o[3]=i=>a(e).formModeProps.visible=i),mode:a(e).formMode,details:a(e).formModeProps.details,title:a(e).formModeProps.title,onSuccess:c},null,8,["id","modelValue","mode","details","title"])):F("",!0)],2)}}}),Xe=Ve(Ue,[["__scopeId","data-v-0c581bf6"]]);export{Xe as default};
