
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as ne,m as j,I as ue,r as u,l as de,u as ie,c as me,n as pe,a as i,o as n,e as p,w as e,f as o,g as _,i as r,b as I,t as D,F as B,y as h,z as ce,j as H,p as J,E as O,aH as fe,aI as _e,L as ve}from"./index-CTDaT2Z5.js";import{a as ge}from"./position_manage-DNNWXLok.js";import{u as be}from"./department-CuSTJ5vm.js";import{u as ye}from"./tenant_role-D4dJkjYZ.js";import{u as he}from"./configuration_manager-4_JVXkqt.js";import"./department-DVBzUfez.js";import"./configuration_role-B6U9bSOJ.js";const G=v=>(fe("data-v-ec9a84e2"),v=v(),_e(),v),Ve=G(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"基本信息")],-1)),Ne={class:"card-header"},we={class:"leftTitle"},Ie={key:0,style:{"margin-left":"20px","font-size":"14px"}},xe=G(()=>h("div",{class:"card-header"},[h("div",{class:"leftTitle"},"角色信息")],-1)),Ee=ne({__name:"index",props:j(["catalogueId","parentId","id","tree","dataList","row","level"],{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:j(["success"],["update:modelValue"]),setup(v,{emit:K}){ue();const Q=he(),T=u([]),P=u([]),q=u(),W=de(),X=u(),Y=ye(),L=u(),ee=be(),ae=u(),le=u(!1),A=u(),F=u();u();const g=v,Z=K,U=ie(v,"modelValue"),te=me(()=>g.id===""?"新增用户":"编辑用户"),f=u(),oe=u([]),a=u({id:g.id,userName:"",name:"",phoneNumber:"",email:"",country:"",type:"",password:"123456",role:"",active:!0,positionId:"",departmentId:"",groupId:""}),x=u({userName:[{required:!0,message:"请输入用户名(1-20位字符)"}],positionId:[{required:!0,message:"请选择职位",trigger:"change"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:18,trigger:"blur",message:"密码长度为6到18位"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],phoneNumber:[{validator:(d,t,s)=>{const m=/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/;a.value.phoneNumber?m.test(a.value.phoneNumber)?s():s(new Error("请输入合法手机号")):s()},trigger:"blur"}],email:[{validator:(d,t,s)=>{const m=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a.value.email?m.test(a.value.email)?s():s(new Error("请输入合法邮箱")):s()},trigger:"blur"}]}),re=async d=>{};function se(){a.value.email||(x.value.email=[],f.value.clearValidate("email")),a.value.phoneNumber||(x.value.phoneNumber=[],f.value.clearValidate("phoneNumber")),a.value.id?f.value&&f.value.validate(d=>{if(d){const{id:t,phoneNumber:s,email:m,password:b,name:z,country:M,active:V,type:N,role:y,groupId:S,positionId:k,departmentId:R,userName:C}=a.value,c={id:t,phoneNumber:s,email:m,password:b,name:z,country:M,active:V,type:N,role:y,groupId:S,positionId:k,departmentId:R,userName:C};F.value===c.phoneNumber&&delete c.phoneNumber,A.value===c.email&&delete c.email,c.password||delete c.password,J.edit(c).then(()=>{O.success({message:"编辑成功",center:!0}),Z("success"),E()})}}):f.value&&f.value.validate(d=>{d&&J.create(a.value).then(()=>{O.success({message:"新增成功",center:!0}),Z("success"),E()})})}function E(){U.value=!1}const $=d=>d==null?void 0:d.reduce((t,s)=>Array.isArray(s)?t.concat($(s)):t.concat(s),[]);return pe(async()=>{const{data:d}=await ge.list({page:1,limit:10,id:null,name:"",active:null});q.value=d.data,T.value=await Q.getStaff(),L.value=await Y.getRole(),ae.value=await ee.getDepartment(),X.value=await W.getCountry(),g.id!==""&&g.row&&(x.value.password=[],a.value=JSON.parse(g.row),A.value=a.value.email,F.value=a.value.phoneNumber,a.value.departmentId&&re(a.value.departmentId),le.value=!0),oe.value=$(g.dataList)}),(d,t)=>{const s=i("el-input"),m=i("el-form-item"),b=i("el-col"),z=i("el-option"),M=i("el-select"),V=i("el-row"),N=i("el-card"),y=i("el-text"),S=i("el-radio"),k=i("el-radio-group"),R=i("ElForm"),C=i("ElButton"),c=i("ElDrawer");return n(),p(c,{modelValue:U.value,"onUpdate:modelValue":t[7]||(t[7]=l=>U.value=l),title:r(te),size:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClosed:E},{footer:e(()=>[o(C,{size:"large",onClick:E},{default:e(()=>[_(" 取消 ")]),_:1}),o(C,{type:"primary",size:"large",onClick:se},{default:e(()=>[_(" 确定 ")]),_:1})]),default:e(()=>[o(R,{ref_key:"formRef",ref:f,model:r(a),rules:r(x),"label-width":"100px","validate-on-rule-change":!1},{default:e(()=>[o(N,{class:"box-card"},{header:e(()=>[Ve]),default:e(()=>[o(V,{gutter:24},{default:e(()=>[o(b,{span:8},{default:e(()=>[o(m,{label:"用户名",prop:"userName"},{default:e(()=>[o(s,{modelValue:r(a).userName,"onUpdate:modelValue":t[0]||(t[0]=l=>r(a).userName=l),maxlength:20,placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(b,{span:8},{default:e(()=>[o(m,{label:"手机号",prop:"phoneNumber"},{default:e(()=>[o(s,{modelValue:r(a).phoneNumber,"onUpdate:modelValue":t[1]||(t[1]=l=>r(a).phoneNumber=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(b,{span:8},{default:e(()=>[o(m,{label:"邮箱",prop:"email"},{default:e(()=>[o(s,{modelValue:r(a).email,"onUpdate:modelValue":t[2]||(t[2]=l=>r(a).email=l),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(b,{span:8},{default:e(()=>[o(m,{label:"职位",prop:""},{default:e(()=>[o(M,{modelValue:r(a).positionId,"onUpdate:modelValue":t[3]||(t[3]=l=>r(a).positionId=l),placeholder:"请选择职位",clearable:"",filterable:"",onChange:t[4]||(t[4]=()=>{})},{default:e(()=>[(n(!0),I(B,null,D(r(q),l=>(n(),p(z,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(N,{class:"box-card"},{header:e(()=>[h("div",Ne,[h("div",we,[_(" 部门信息"),r(a).director?(n(),I("span",Ie,[_("负责人:"),(n(!0),I(B,null,D(r(T),l=>(n(),p(y,{key:l.id},{default:e(()=>[l.id===r(a).director?(n(),p(y,{key:0},{default:e(()=>[_(ce(l.name),1)]),_:2},1024)):H("",!0)]),_:2},1024))),128))])):H("",!0)])])]),default:e(()=>[o(V,{gutter:24},{default:e(()=>[o(m,{label:"分配部门:"},{default:e(()=>[r(P).length?(n(),p(k,{key:0,modelValue:r(a).groupId,"onUpdate:modelValue":t[5]||(t[5]=l=>r(a).groupId=l)},{default:e(()=>[(n(!0),I(B,null,D(r(P),l=>(n(),p(S,{key:l.id,value:l.id,label:l.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(n(),p(y,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]),_:1})]),_:1})]),_:1}),o(N,{class:"box-card"},{header:e(()=>[xe]),default:e(()=>[o(V,{gutter:24},{default:e(()=>[o(m,{label:"分配角色:"},{default:e(()=>{var l;return[(l=r(L))!=null&&l.length?(n(),p(k,{key:0,modelValue:r(a).role,"onUpdate:modelValue":t[6]||(t[6]=w=>r(a).role=w)},{default:e(()=>[(n(!0),I(B,null,D(r(L),w=>(n(),p(S,{key:w.id,value:w.roleName,label:w.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(n(),p(y,{key:1},{default:e(()=>[_("暂无数据")]),_:1}))]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Re=ve(Ee,[["__scopeId","data-v-ec9a84e2"]]);export{Re as default};
