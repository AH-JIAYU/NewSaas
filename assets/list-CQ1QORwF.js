
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as I,d as oe,a1 as ne,r as d,l as se,b as i,q as ue,s as ie,o as C,e as O,g as e,w as l,S as re,j as de,bj as me,t as y,h as c,H as pe,E as x,a0 as ve,aB as fe,ap as ce,aI as _e,aJ as ge,R as ye}from"./index-BRxVf_xq.js";import{a as k,s as Ve}from"./index-CvkgIqKK.js";import{u as be}from"./index-BEiL9uGf.js";import"./index-Banux7uv.js";import"./index-DTay_U_u.js";import"./clipboard-DrT6dflm.js";const he={getTenantLogo:p=>I.post("tenant-logo/getTenantLogo",p),uploadLogo:p=>I.post("tenant-logo/upload",p)},b=p=>(_e("data-v-643e1d6c"),p=p(),ge(),p),we=b(()=>y("div",{class:"el-upload__tip"}," 支持上传JPG/JPEG/PNG图片，小于10MB ",-1)),xe=["src"],Ne={key:0},Le=b(()=>y("span",{class:"red"},null,-1)),De=b(()=>y("span",{style:{"margin-right":"10px"}},"已生效",-1)),Ee=[Le,De],Ue={key:1},Ce=b(()=>y("span",{class:"green"},null,-1)),Oe=b(()=>y("span",{style:{"margin-right":"10px"}},"未生效",-1)),ke=[Ce,Oe],Pe=oe({name:"site_setting",__name:"list",setup(p){const _=ne(),P=d(),S="https://saas-api.surveysaas.com/tenant-logo/upload",{toClipboard:M}=be(),R=d("基本设置"),f=d(!1),g=d(),q=d(!1),z=d(),a=d({id:"",registerOffOrOn:!0,registerExamineOffOrOn:!1,keyWords:"",description:"",webName:"",topLevelDomainName:"",defaultPriceRatio:null,taxRate:null,minimumAmount:null,phone:"",email:"",qqCode:"",address:""}),h=d({webName:[{required:!0,message:"请输入网站名称",trigger:"blur"}],topLevelDomainName:[{required:!1,message:"请输入顶级域名",trigger:"submit"},{validator:(n,t,r)=>{new RegExp("^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(?:\\.[A-Za-z0-9-]{1,63}(?<!-))*\\.[A-Za-z]{2,}$").test(t)?r():r(new Error("请输入合法的域名"))},trigger:"submit"}],phone:[{required:!1,trigger:"submit",message:"请输入手机号"},{validator:(n,t,r)=>{/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(a.value.phone)?r():r(new Error("请输入合法手机号"))},trigger:"submit"}],email:[{required:!1,trigger:"submit",message:"请输入邮箱"},{validator:(n,t,r)=>{/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a.value.email)?r():r(new Error("请输入合法邮箱"))},trigger:"submit"}]});se(()=>{f.value=!0,_.logo&&(v.value=[{name:"logo",url:_.logo}]),N(),f.value=!1});async function N(){try{const{data:n}=await k.list();if(n&&(a.value=n||a.value,z.value=a.value,_.setWebName(n.webName)),a.value.topLevelDomainName!==""&&a.value.topLevelDomainName!==null){const t=await k.getTenantWebConfigQueryAnalysis({url:a.value.topLevelDomainName});q.value=t.data.success}}catch{}finally{f.value=!1}}const $=async()=>{var t;v.value=[];const n=await he.getTenantLogo();n.data&&(_.setLogo(n.data.logoUrl),v.value.push({name:"file",url:(t=n==null?void 0:n.data)==null?void 0:t.logoUrl}))},B=()=>{P.value.showEdit(z.value)},W=()=>{const n=a.value.personalizedDomainName;M(n),x({type:"success",message:"复制成功"})},Z=_.token,j=d({Token:Z}),A=d(""),L=d(!1),v=d([]),G=async()=>{x.success({message:"删除成功",center:!0}),_.delLogo()},J=(n,t)=>{n.status===-1?(ve.error(n.error,{zIndex:2e3}),v.value=v.value.filter(r=>r.name!==t.name)):$()},Q=async()=>{x.warning({message:"只能上传一个,删除原文件后重新上传",center:!0})},F=n=>{A.value=n.url,L.value=!0};function D(){(a.value.email===""||a.value.email===null)&&(h.value.email=[],g.value.clearValidate("email")),(a.value.phone===""||a.value.phone===null)&&(h.value.phone=[],g.value.clearValidate("phone")),(a.value.topLevelDomainName===""||a.value.topLevelDomainName===null)&&(h.value.topLevelDomainName=[],g.value.clearValidate("topLevelDomainName")),g.value&&g.value.validate(async n=>{if(n)try{f.value=!0,a.value.topLevelDomainName&&(a.value.topLevelDomainName=a.value.topLevelDomainName.replace(/^https?:\/\//,""));const t=await k.edit(a.value);f.value=!1,t.status===1&&(N(),x.success({message:"修改成功",center:!0}))}catch(t){console.log("error",t)}finally{f.value=!1}})}return(n,t)=>{const r=fe,w=i("el-icon"),H=i("el-upload"),K=i("el-dialog"),X=i("ElFormItem"),s=i("el-col"),T=i("el-switch"),u=i("el-form-item"),m=i("el-input"),Y=i("el-text"),V=i("el-button"),E=i("el-row"),U=i("el-tab-pane"),ee=i("el-form"),le=i("el-tabs"),ae=ce,te=ue("loading");return ie((C(),O("div",null,[e(r,{title:"站点设置管理"}),e(ae,null,{default:l(()=>[e(le,{modelValue:R.value,"onUpdate:modelValue":t[14]||(t[14]=o=>R.value=o)},{default:l(()=>[e(ee,{ref_key:"formRef",ref:g,model:a.value,rules:h.value,"label-width":"100px","label-position":"right",inline:!1},{default:l(()=>[e(U,{label:"基础设置",name:"基本设置"},{default:l(()=>[e(E,{gutter:20},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(X,{style:{display:"flex","justify-content":"center","align-items":"center"},label:"网址Logo"},{default:l(()=>[e(H,{class:re({hide_box:v.value.length}),"file-list":v.value,"onUpdate:fileList":t[0]||(t[0]=o=>v.value=o),headers:j.value,action:S,"list-type":"picture-card",limit:1,"on-preview":F,"on-remove":G,"on-success":J,"on-exceed":Q},{tip:l(()=>[we]),default:l(()=>[e(w,{class:"el-icon--upload"},{default:l(()=>[e(de(me))]),_:1})]),_:1},8,["class","file-list","headers"]),e(K,{modelValue:L.value,"onUpdate:modelValue":t[1]||(t[1]=o=>L.value=o),style:{"z-index":"1000",transform:"translate(0)",position:"relative"}},{default:l(()=>[y("img",{"w-full":"",src:A.value,alt:"Preview Image"},null,8,xe)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:3},{default:l(()=>[e(u,{label:"注册开关"},{default:l(()=>[e(T,{modelValue:a.value.registerOffOrOn,"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.registerOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:6},{default:l(()=>[e(u,{label:"注册审核"},{default:l(()=>[e(T,{modelValue:a.value.registerExamineOffOrOn,"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.registerExamineOffOrOn=o),"active-text":"开启","inline-prompt":"","inactive-text":"关闭","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"网站名称",prop:"webName"},{default:l(()=>[e(m,{modelValue:a.value.webName,"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.webName=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"网站关键字"},{default:l(()=>[e(m,{modelValue:a.value.keyWords,"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.keyWords=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"网站描述"},{default:l(()=>[e(m,{modelValue:a.value.description,"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.description=o),style:{width:"18rem"}},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"个性化域名",prop:""},{default:l(()=>[e(Y,{class:"mx-1"},{default:l(()=>[c(pe(a.value.personalizedDomainName),1)]),_:1}),e(V,{class:"copy",type:"primary",link:"",onClick:W},{default:l(()=>[c("复制")]),_:1})]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"顶级域名",prop:"topLevelDomainName"},{default:l(()=>[e(m,{modelValue:a.value.topLevelDomainName,"onUpdate:modelValue":t[7]||(t[7]=o=>a.value.topLevelDomainName=o),style:{width:"18rem"}},null,8,["modelValue"]),q.value?(C(),O("div",Ne,Ee)):(C(),O("div",Ue,ke)),e(V,{class:"copy",onClick:B,type:"primary",link:""},{default:l(()=>[c("CNAME配置")]),_:1})]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(V,{type:"primary",onClick:D},{default:l(()=>[c(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{label:"高级设置",name:"高级设置"},{default:l(()=>[e(E,{gutter:20},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(u,{label:"最低结算金额",prop:""},{default:l(()=>[e(m,{modelValue:a.value.minimumAmount,"onUpdate:modelValue":t[8]||(t[8]=o=>a.value.minimumAmount=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"供应商税点",prop:""},{default:l(()=>[e(m,{modelValue:a.value.taxRate,"onUpdate:modelValue":t[9]||(t[9]=o=>a.value.taxRate=o),modelModifiers:{number:!0},style:{width:"18rem"},placeholder:""},{append:l(()=>[c("%")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(V,{type:"primary",onClick:D},{default:l(()=>[c(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{label:"联系我们",name:"联系我们"},{default:l(()=>[e(E,{gutter:20},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(u,{label:"电子邮箱",prop:"email"},{default:l(()=>[e(m,{style:{width:"18rem"},modelValue:a.value.email,"onUpdate:modelValue":t[10]||(t[10]=o=>a.value.email=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"手机号码",prop:"phone"},{default:l(()=>[e(m,{style:{width:"18rem"},modelValue:a.value.phone,"onUpdate:modelValue":t[11]||(t[11]=o=>a.value.phone=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"QQ号码",prop:""},{default:l(()=>[e(m,{style:{width:"18rem"},modelValue:a.value.qqCode,"onUpdate:modelValue":t[12]||(t[12]=o=>a.value.qqCode=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,{label:"公司地址",prop:""},{default:l(()=>[e(m,{style:{width:"18rem"},modelValue:a.value.address,"onUpdate:modelValue":t[13]||(t[13]=o=>a.value.address=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(u,null,{default:l(()=>[e(V,{type:"primary",onClick:D},{default:l(()=>[c("确认")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1}),e(Ve,{ref_key:"recordRef",ref:P,onFetchData:N},null,512)])),[[te,f.value]])}}}),Be=ye(Pe,[["__scopeId","data-v-643e1d6c"]]);export{Be as default};
