
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as Pe}from"./index-CMs3jbEw.js";import{_ as Me}from"./index-Cws8xCJA.js";import{d as Te,aN as Fe,r as p,l as Ge,n as X,X as U,a as v,q as Ae,o as r,b as z,y,f as o,w as t,g as h,aA as $,s as R,e as s,z as C,az as P,aq as Q,F as M,t as T,i as S,aM as He,j as g,aO as F,E as G,p as W,_ as Ke,aH as Oe,aI as je,L as qe,ao as Y}from"./index-B-NpraQI.js";import{a as A}from"./department-CjAByfyh.js";import{u as Je}from"./department-DTAlfIbs.js";import{u as Xe}from"./position_manage-CetwI_ke.js";import Qe from"./index-BY_HJc27.js";import We from"./index-BLAok_rM.js";import Ye from"./index-BEVnBXvw.js";import Ze from"./index-CwlVJav4.js";import ea from"./index-CVykI6I5.js";import"./index-DR8BPe8t.js";import"./position_manage-CVJ6xXGK.js";import"./tenantDictionary-C3hPiz9x.js";import"./tenant_role-DA5PRa5A.js";import"./configuration_role-COeVhKOH.js";import"./configuration_manager-BkI8UcDI.js";const aa=N=>(Oe("data-v-596f94d2"),N=N(),je(),N),la={class:"absolute-container"},ta={class:"page-main"},ia={class:"custom-tree-node"},oa=["title"],na={class:"code"},ra={class:"actions"},sa={class:"dictionary-container"},ua={class:"copyId tableSmall"},da={class:"id oneLine"},ca={class:"dictionary-container"},pa=aa(()=>y("div",{class:"empty"},"请在左侧新增或选择一个部门",-1)),va=[pa],Z=Te({name:"department",__name:"list",setup(N){const{pagination:w,getParams:ma,onSizeChange:ee,onCurrentChange:ae,onSortChange:le}=Fe(),x=Xe(),H=p(),te=Ge(),ie=p([]),B=Je(),K=p(),oe=p([{label:"员工ID",prop:"id",sortable:!0,checked:!0},{label:"用户名",prop:"userName",sortable:!0,checked:!0},{label:"电话号码",prop:"phoneNumber",sortable:!0,checked:!0},{label:"邮箱",prop:"email",sortable:!0,checked:!0},{label:"部门",prop:"departmentId",sortable:!0,checked:!0},{label:"职位",prop:"positionId",sortable:!0,checked:!0},{label:"小组",prop:"groupId",sortable:!0,checked:!0},{label:"状态",prop:"active",sortable:!0,checked:!0}]),ne=[{label:"启用",value:!0},{label:"禁用",value:!1}],re=p(),O=p(),b=p({search:{chineseName:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),j=p(),se=p(),i=p({loading:!1,tableAutoHeight:!1,border:!1,stripe:!1,lineHeight:"default",checkList:[],search:{page:1,limit:10,id:"",userName:"",active:null,departmentId:null},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}}),q=p(),n=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),m=p({search:{name:""},tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:"",name:""},row:"",loading:!1});p();const d=p({loading:!1,search:{organizationalStructureId:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:"",parentId:"",level:1}});async function L(){try{n.value.loading=!0;const e={...n.value.search},l=await A.list(e);n.value.tree=l.data,n.value.loading=!1}catch{}finally{n.value.loading=!1}}X(()=>{L()}),U(()=>n.value.search,e=>{q.value.filter(e)});function ue(e,l){return e?l.label.includes(e):!0}function de(e){n.value.currentData=e,n.value.dialog.parentId="",n.value.dialog.id="",n.value.dialog.visible=!0}function ce(e){m.value.currentData=e,m.value.dialog.parentId=(e==null?void 0:e.id)??"",m.value.dialog.name=(e==null?void 0:e.name)??"",m.value.dialog.id="",m.value.dialog.visible=!0}function pe(e,l){n.value.currentNode=e,n.value.currentData=l,n.value.row=JSON.stringify(l),n.value.dialog.parentId=e.parent.data.id??"",n.value.dialog.id=l.id,n.value.dialog.visible=!0}function ve(e,l){F.confirm(`确认删除「${l.name}」吗？`,"确认信息").then(()=>{A.delete({id:l.id}).then(()=>{G.success({message:"删除成功",center:!0});const c=e.parent,D=c.data.children||c.data,I=D.findIndex(V=>V.id===l.id);D.splice(I,1),n.value.tree=[...n.value.tree]})})}function me(e){w.value.page=1,e.id&&(i.value.dialog.parentId=e.id),d.value.search.organizationalStructureId=e.id}U(()=>d.value.search.organizationalStructureId,()=>{f()});async function f(){try{d.value.loading=!0;const e={...d.value.search},l=await A.itemlist(e);d.value.loading=!1,i.value.dataList=l.data,d.value.dataList.forEach(c=>{c.enableLoading=!1}),w.value.total=l.data.length}catch{}finally{d.value.loading=!1}}X(async()=>{try{b.value.loading=!0,ie.value=await te.getCountry(),K.value=await(B==null?void 0:B.getDepartment())||[],H.value=await(x==null?void 0:x.getPositionManage())||[],oe.value.forEach(e=>{e.checked&&i.value.checkList.push(e.prop)}),b.value.loading=!1}catch{}finally{b.value.loading=!1}}),U(()=>b.value.search,e=>{re.value.filter(e)});function ge(e){return new Promise(l=>{F.confirm(`确认${e.active?"禁用":"启用"}「${e.name}」吗？`,"确认信息").then(()=>{try{b.value.loading=!0,W.edit({id:e.id,email:e.email,phoneNumber:e.phoneNumber,userName:e.userName,country:e.country,role:e.role,positionId:e.positionId,active:!e.active}).then(()=>(G.success({message:`${e.active?"禁用":"启用"}成功`,center:!0}),f(),b.value.loading=!1,l(!0))).catch(()=>(b.value.loading=!1,l(!1)))}catch{}finally{b.value.loading=!1}}).catch(()=>l(!1))})}function fe(e){ee(e).then(()=>{i.value.search.limit=e,f()})}function he(e=1){ae(e).then(()=>{i.value.search.page=e,f()})}function _e({prop:e,order:l}){le(e,l).then(()=>f())}function ye(e){i.value.dialog.id="",i.value.dialog.visible=!0,i.value.dialog.level=1}const be=e=>{j.value=e[0]};function ke(){const{name:e,id:l}=j.value;F.confirm(`确认将「${e}」的密码重置为 “123456” 吗？`,"确认信息").then(()=>{W.reset({id:l}).then(()=>{G.success({message:"重置成功",center:!0}),f()})}).catch(()=>{})}function Ie(e){i.value.row=JSON.stringify(e),i.value.dialog.id=e.id,i.value.dialog.visible=!0}function Ce(e){O.value.showEdit(e)}function we(){Object.assign(i.value.search,{id:"",userName:"",departmentId:null,active:null}),f()}return(e,l)=>{const c=v("ElButton"),D=v("ElButtonGroup"),I=Ke,V=v("ElInput"),Le=v("ElTree"),Se=v("ElScrollbar"),De=v("el-option"),Ve=v("ElSelect"),Ne=v("ElSpace"),k=v("ElTableColumn"),Ee=v("ElSwitch"),ze=Me,_=v("el-text"),xe=v("el-empty"),Be=v("ElTable"),Ue=v("ElPagination"),$e=Pe,Re=Ae("loading");return r(),z("div",la,[y("div",ta,[o($e,{"hide-left-side-toggle":""},{leftSide:t(()=>[o(D,{class:"btns"},{default:t(()=>[o(c,{type:"primary",class:"add",onClick:l[0]||(l[0]=a=>de())},{default:t(()=>[h(" 新增部门 ")]),_:1})]),_:1}),o(V,{modelValue:n.value.search.name,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.search.name=a),placeholder:"请输入关键词筛选",clearable:"",class:"search",onKeydown:$(L,["enter"])},{append:t(()=>[o(c,{onClick:L},{default:t(()=>[o(I,{name:"i-ep:search"})]),_:1})]),_:1},8,["modelValue"]),o(Se,{class:"tree"},{default:t(()=>[R((r(),s(Le,{ref_key:"dictionaryRef",ref:q,data:n.value.tree,"filter-node-method":ue,"default-expand-all":"",onNodeClick:me},{default:t(({node:a,data:u})=>{var J;return[y("div",ia,[y("div",{class:"label",title:a.label},C(u.name),9,oa),y("div",na,C((J=u==null?void 0:u.organizationalStructurePersonList)==null?void 0:J.map(E=>E.userName).join("，")),1),y("div",ra,[o(D,null,{default:t(()=>[o(c,{type:"primary",plain:"",size:"default",onClick:P(E=>ce(u),["stop"])},{icon:t(()=>[o(I,{name:"i-ep:plus"})]),_:2},1032,["onClick"]),o(c,{type:"info",plain:"",size:"default",onClick:P(E=>pe(a,u),["stop"])},{icon:t(()=>[o(I,{name:"i-ep:edit"})]),_:2},1032,["onClick"]),o(c,{type:"danger",plain:"",size:"default",onClick:P(E=>ve(a,u),["stop"])},{icon:t(()=>[o(I,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["data","filter-node-method"])),[[Re,n.value.loading]])]),_:1})]),default:t(()=>[R(y("div",sa,[o(Ne,{wrap:""},{default:t(()=>[o(c,{type:"primary",onClick:l[2]||(l[2]=a=>ye())},{default:t(()=>[h(" 新增员工 ")]),_:1}),o(c,{onClick:ke},{default:t(()=>[h(" 重置密码 ")]),_:1}),o(Ve,{modelValue:i.value.search.active,"onUpdate:modelValue":l[3]||(l[3]=a=>i.value.search.active=a),"value-key":"",placeholder:"用户状态",style:{width:"200px"},clearable:"",filterable:""},{default:t(()=>[(r(),z(M,null,T(ne,a=>o(De,{key:a.label,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o(V,{modelValue:i.value.search.id,"onUpdate:modelValue":l[4]||(l[4]=a=>i.value.search.id=a),placeholder:"员工ID",clearable:"",style:{width:"200px"},onKeydown:$(f,["enter"])},null,8,["modelValue"]),o(V,{modelValue:i.value.search.userName,"onUpdate:modelValue":l[5]||(l[5]=a=>i.value.search.userName=a),placeholder:"用户名",clearable:"",style:{width:"200px"},onKeydown:$(f,["enter"])},null,8,["modelValue"]),o(c,{type:"primary",onClick:f},{icon:t(()=>[o(I,{name:"i-ep:search"})]),_:1}),o(c,{onClick:we},{icon:t(()=>[o(I,{name:"i-ep:refresh"})]),_:1})]),_:1}),o(Be,{ref_key:"userItemRef",ref:se,data:i.value.dataList,border:i.value.border,size:i.value.lineHeight,stripe:i.value.stripe,"highlight-current-row":"",height:"100%",onSortChange:_e,onSelectionChange:l[6]||(l[6]=a=>i.value.selectionDataList=a),"row-key":"id","default-expand-all":"",onSelect:be},{empty:t(()=>[o(xe,{image:S(He),"image-size":300},null,8,["image"])]),default:t(()=>[o(k,{type:"selection",align:"left",fixed:""}),i.value.checkList.includes("active")?(r(),s(k,{key:0,align:"left",prop:"active",label:"状态"},{default:t(a=>[o(Ee,{modelValue:a.row.active,"onUpdate:modelValue":u=>a.row.active=u,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>ge(a.row)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1})):g("",!0),i.value.checkList.includes("id")?(r(),s(k,{key:1,align:"left",width:"180",prop:"id",label:"员工ID"},{default:t(({row:a})=>[y("div",ua,[y("div",da,"ID: "+C(a.id),1),o(ze,{class:"copy",content:a.id},null,8,["content"])])]),_:1})):g("",!0),i.value.checkList.includes("userName")?(r(),s(k,{key:2,align:"left",width:"130",prop:"userName",label:"用户名"},{default:t(({row:a})=>[o(_,{class:"tableBig"},{default:t(()=>[h(C(a.userName?a.userName:"-"),1)]),_:2},1024)]),_:1})):g("",!0),i.value.checkList.includes("phoneNumber")?(r(),s(k,{key:3,align:"left",width:"170",prop:"phone",label:"电话号码"},{default:t(({row:a})=>[o(_,{class:"tableBig"},{default:t(()=>[h(C(a.phoneNumber?a.phoneNumber:"-"),1)]),_:2},1024)]),_:1})):g("",!0),i.value.checkList.includes("email")?(r(),s(k,{key:4,align:"left",width:"180",prop:"email",label:"邮箱"},{default:t(({row:a})=>[o(_,{class:"tableBig"},{default:t(()=>[h(C(a.email?a.email:"-"),1)]),_:2},1024)]),_:1})):g("",!0),i.value.checkList.includes("departmentId")?(r(),s(k,{key:5,align:"left",prop:"departmentId",label:"部门"},{default:t(({row:a})=>[a.departmentId?(r(),s(_,{key:0,class:"tableBig"},{default:t(()=>[(r(!0),z(M,null,T(K.value,u=>(r(),s(_,null,{default:t(()=>[a.departmentId===u.id?(r(),s(_,{key:0},{default:t(()=>[h(C(u.name?u.name:"-"),1)]),_:2},1024)):g("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),s(_,{key:1,class:"tableBig"},{default:t(()=>[h("-")]),_:1}))]),_:1})):g("",!0),i.value.checkList.includes("positionId")?(r(),s(k,{key:6,align:"left",prop:"positionId",label:"职位"},{default:t(({row:a})=>[a.positionId?(r(),s(_,{key:0,class:"tableBig"},{default:t(()=>[(r(!0),z(M,null,T(H.value,u=>(r(),s(_,null,{default:t(()=>[a.positionId===u.id?(r(),s(_,{key:0},{default:t(()=>[h(C(u.name?u.name:"-"),1)]),_:2},1024)):g("",!0)]),_:2},1024))),256))]),_:2},1024)):(r(),s(_,{key:1,class:"tableBig"},{default:t(()=>[h("-")]),_:1}))]),_:1})):g("",!0),o(k,{label:"操作",fixed:"right",width:"200",align:"left"},{default:t(a=>[o(c,{type:"primary",size:"small",plain:"",onClick:u=>Ie(a.row)},{default:t(()=>[h(" 编辑 ")]),_:2},1032,["onClick"]),o(c,{type:"warning",size:"small",plain:"",onClick:u=>Ce(a.row)},{default:t(()=>[h(" 详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","border","size","stripe"]),o(Ue,{"current-page":S(w).page,total:S(w).total,"page-size":S(w).size,"page-sizes":S(w).sizes,layout:S(w).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:fe,onCurrentChange:he},null,8,["current-page","total","page-size","page-sizes","layout"])],512),[[Q,d.value.search.organizationalStructureId]]),R(y("div",ca,va,512),[[Q,!d.value.search.organizationalStructureId]])]),_:1}),n.value.dialog.visible?(r(),s(Qe,{key:0,id:n.value.dialog.id,modelValue:n.value.dialog.visible,"onUpdate:modelValue":l[7]||(l[7]=a=>n.value.dialog.visible=a),row:n.value.row,"parent-id":n.value.dialog.parentId,tree:n.value.tree,onGetList:L},null,8,["id","modelValue","row","parent-id","tree"])):g("",!0),m.value.dialog.visible?(r(),s(We,{key:1,id:m.value.dialog.id,modelValue:m.value.dialog.visible,"onUpdate:modelValue":l[8]||(l[8]=a=>m.value.dialog.visible=a),row:m.value.row,"parent-id":m.value.dialog.parentId,name:m.value.dialog.name,tree:m.value.tree,onGetList:L},null,8,["id","modelValue","row","parent-id","name","tree"])):g("",!0),d.value.dialog.visible?(r(),s(Ye,{key:2,id:d.value.dialog.id,modelValue:d.value.dialog.visible,"onUpdate:modelValue":l[9]||(l[9]=a=>d.value.dialog.visible=a),"catalogue-id":d.value.search.organizationalStructureId,"parent-id":d.value.dialog.parentId,level:d.value.dialog.level,tree:n.value.tree,dataList:d.value.dataList,row:d.value.row,onSuccess:f},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):g("",!0),i.value.dialog.visible?(r(),s(Ze,{key:3,id:i.value.dialog.id,modelValue:i.value.dialog.visible,"onUpdate:modelValue":l[10]||(l[10]=a=>i.value.dialog.visible=a),"catalogue-id":i.value.search.catalogueId,"parent-id":i.value.dialog.parentId,level:i.value.dialog.level,tree:b.value.tree,dataList:i.value.dataList,row:i.value.row,onSuccess:f,onGetList:L},null,8,["id","modelValue","catalogue-id","parent-id","level","tree","dataList","row"])):g("",!0),o(ea,{ref_key:"detailRef",ref:O},null,512)])])}}});typeof Y=="function"&&Y(Z);const xa=qe(Z,[["__scopeId","data-v-596f94d2"]]);export{xa as default};
