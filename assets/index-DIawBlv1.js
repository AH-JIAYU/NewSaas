
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as w}from"./index.vue_vue_type_script_setup_true_lang-BSY3hi7b.js";import{x as S,af as D,d as R,r as x,a as T,o as _,b as I,f as u,w as c,s as t,g as r,F as j,t as O,S as N,i as f,H as n,e as U,j as M,I as A,aJ as F,aK as H,R as q}from"./index-D4axY0XK.js";const G={list:d=>S.post("tenantBind/getProjectAllocationList",d),meList:d=>S.post("tenantBind/getProjectMeAllocationList",d),getTenantMeasurementList:d=>S.post("tenantBind/getTenantMeasurementList",d),getQuestionnaireClickList:d=>S.post("tenantBind/getQuestionnaireClickList",d)},J=D("projectManagementOutsource",()=>({projectStatusList:["进行中(在线)","已完成(审核通过)","离线"],typeList:["租户","供应商","会员组"],surveyStatusList:["完成","被甄别","配额满","安全终止","未完成"],peopleTypeList:["会员组","供应商"]})),K=J,B=d=>(F("data-v-572baae3"),d=d(),H(),d),W={class:"milestone"},X={class:"left"},Y={class:"left-top-left p-4"},Z={class:"project"},ee={class:"projectName flex-b"},te={class:"projectId"},se={class:"price flex-b"},ne={key:0,class:"left-top-right p-4"},ae={class:"tenant"},oe={key:0,class:"left-bottom"},le=B(()=>t("div",{class:"line"},null,-1)),re={class:"allocation"},ie=B(()=>t("div",{class:"arrow"},null,-1)),ce={key:0,class:"right"},pe={class:"clickIdItem m-2"},ue={class:"clickIdItem-left"},de={class:"clickIdItem-right"},_e={class:"title"},fe=B(()=>t("li",null,"点击ID:",-1)),Ie={key:0},ye={style:{flex:"auto"}},ve=R({name:"Edit",__name:"index",setup(d,{expose:z}){const h=K(),g=x(!1),b=x(),o=x({currentTenantId:"",tenantMeasurementInfoList:[],clickIdList:[]});async function E(a){const p={linkId:a.linkId,projectId:a.projectId},i=await G.getTenantMeasurementList(p),l=i.data.tenantMeasurementInfoList.findIndex(s=>s.allocationTenantId===i.data.currentTenantId),y=i.data.tenantMeasurementInfoList;y.splice(0,l);const k=y.filter(s=>s.type===1),v=y.filter(s=>s.type===2),e=y.filter(s=>s.type===3),L=[...k];if(v.length){const s=v.map(m=>m.memberGroupOrSupperId);v[0].length=v.length,v[0].memberGroupOrSupperIdList=s,L.push(v[0])}else if(e.length){const s=e.map(m=>m.memberGroupOrSupperId);e[0].length=e.length,e[0].memberGroupOrSupperIdList=s,L.push(e[0])}L.forEach(s=>s.visible=!1),o.value.currentTenantId=i.data.currentTenantId,o.value.tenantMeasurementInfoList=L,g.value=!0}const V=a=>{o.value.clickIdList=[],o.value.tenantMeasurementInfoList.length===b.value.length?b.value.forEach((p,i)=>{i!==a&&p.hide()}):b.value.forEach((p,i)=>{i!==a-1&&p.hide()})},P=async a=>{const p={type:a.type,projectId:a.projectId,tenantId:a.allocationTenantId,supplierIdList:a.type===2?a.memberGroupOrSupperIdList:[],memberGroupIdList:a.type===3?a.memberGroupOrSupperIdList:[]},i=await G.getQuestionnaireClickList(p);o.value.clickIdList=Q(i.data.questionnaireClickInfoList),a.type===2?o.value.clickIdList=o.value.clickIdList.filter(l=>l.peopleType===2):a.type===3&&(o.value.clickIdList=o.value.clickIdList.filter(l=>l.peopleType===1))};function Q(a){return a.reduce((p,i)=>{const{supplierId:l,supplierName:y,projectQuestionnaireClickId:k,surveyStatus:v,price:e,peopleType:L}=i;let s=p.find(m=>m.supplierId===l);return s?s.list.push({projectQuestionnaireClickId:k,surveyStatus:v,price:e}):p.push({supplierId:l,peopleType:L,supplierName:y,list:[{projectQuestionnaireClickId:k,surveyStatus:v,price:e}]}),p},[])}function C(){g.value=!1}function $(){C()}return z({showEdit:E}),(a,p)=>{const i=w,l=T("el-text"),y=T("el-button"),k=T("el-popover"),v=T("el-drawer");return _(),I("div",null,[u(v,{modelValue:f(g),"onUpdate:modelValue":p[0]||(p[0]=e=>A(g)?g.value=e:null),title:"项目测查",size:"60%","before-close":C},{footer:c(()=>[t("div",ye,[u(y,{onClick:C},{default:c(()=>[r(" 取消 ")]),_:1}),u(y,{type:"primary",onClick:$},{default:c(()=>[r(" 确定 ")]),_:1})])]),default:c(()=>[t("div",W,[(_(!0),I(j,null,O(f(o).tenantMeasurementInfoList,(e,L)=>(_(),I("div",{class:"item",key:e.allocationTenantId},[t("div",X,[t("div",{class:N({"left-top":!0,"flex-b":!0,currentTenant:e.allocationTenantId===f(o).currentTenantId&&e.type===1})},[t("div",Y,[t("div",Z,[t("div",ee,[t("b",null,n(e.projectName),1),t("span",null,n(f(h).projectStatusList[e.projectStatus-1]),1)]),t("div",te,n(e.projectId),1)]),t("div",se,[t("p",null,[r(" 原价： "),u(i),r(" "+n(e.doMoneyPrice),1)]),t("p",null,[r(" 参数： "),u(l,{size:"large"},{default:c(()=>[r(n(e.participationNumber||0),1)]),_:2},1024),u(l,{size:"large"},{default:c(()=>[r(" / ")]),_:1}),u(l,{type:"success",size:"large"},{default:c(()=>[r(n(e.doneNumber||0),1)]),_:2},1024),u(l,{size:"large"},{default:c(()=>[r(" / ")]),_:1}),u(l,{type:"warning",size:"large"},{default:c(()=>[r(n(e.num||0),1)]),_:2},1024),u(l,{size:"large"},{default:c(()=>[r(" / ")]),_:1}),u(l,{size:"large"},{default:c(()=>[r(n(e.limitedQuantity||0),1)]),_:2},1024)])])]),e.allocationTenantId!==f(o).currentTenantId||e.type!==1?(_(),I("div",ne,[t("p",{class:N("type"+e.type)},n(f(h).typeList[e.type-1]),3),t("div",ae,[(e==null?void 0:e.length)>1?(_(),U(y,{key:0,type:"primary",link:""},{default:c(()=>[r(" 查看更多("+n(e==null?void 0:e.length)+") ",1)]),_:2},1024)):(_(),I(j,{key:1},[t("p",null,n(e.tenantName),1),t("p",null,n(e.allocationTenantId),1)],64))])])):M("",!0)],2),f(o).tenantMeasurementInfoList.length!==L+1?(_(),I("div",oe,[le,t("div",re,n(e.tenantName)+"-分配-"+n(f(h).typeList[f(o).tenantMeasurementInfoList[L+1].type-1]),1),ie])):M("",!0)]),e.allocationTenantId!==f(o).currentTenantId||e.type!=1?(_(),I("div",ce,[u(k,{visible:e.visible,"onUpdate:visible":s=>e.visible=s,ref_for:!0,ref_key:"popoverRef",ref:b,placement:"right",width:350,trigger:"click",onBeforeEnter:s=>V(L),onShow:s=>P(e)},{reference:c(()=>[u(y,{style:{padding:"0.5rem"},type:"primary",link:""},{default:c(()=>[r(" 》 ")]),_:1})]),default:c(()=>[(_(!0),I(j,null,O(f(o).clickIdList,s=>(_(),I("div",pe,[t("div",ue,[t("span",{class:N("peopleType"+s.peopleType)},n(f(h).peopleTypeList[s.peopleType-1]),3)]),t("div",de,[t("div",_e,n(s.supplierName)+"   "+n(s.supplierId),1),t("ul",null,[fe,(_(!0),I(j,null,O(s.list,m=>(_(),I("li",null,[t("span",null,n(m.projectQuestionnaireClickId),1),t("span",null,"  "+n(f(h).surveyStatusList[m.surveyStatus-1]),1),m.surveyStatus===1?(_(),I("span",Ie,[r("   "),u(i),r(n(m.price),1)])):M("",!0)]))),256))])])]))),256))]),_:2},1032,["visible","onUpdate:visible","onBeforeEnter","onShow"])])):M("",!0)]))),128))])]),_:1},8,["modelValue"])])}}}),Le=q(ve,[["__scopeId","data-v-572baae3"]]),ge=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{G as a,Le as e,ge as i,K as u};
