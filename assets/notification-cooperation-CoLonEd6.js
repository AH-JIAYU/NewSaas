
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as W,aD as X,r as c,aL as Y,a as d,o as I,b as V,y as n,z as g,i as r,f as l,w as a,g as s,j as E,e as Z,A as ee,ba as T,E as te,_ as ae,aH as oe,aI as re,L as le}from"./index-CqImPfqe.js";import{u as ne}from"./index-BJhMdSSU.js";import{a as se}from"./department-BC0rvror.js";import"./index-Bp6P0TeJ.js";import"./index-DODrp3_N.js";const m=_=>(oe("data-v-ddaf3810"),_=_(),re(),_),ie={class:"news p-4"},ce=m(()=>n("div",{class:"type"},[n("span"),s(" 合作邀约")],-1)),de={class:"news-content"},ue={class:"content"},pe={class:"time"},ge={key:0,class:"footer"},me=m(()=>n("div",{style:{display:"flex","align-items":"center"}},[n("span",{style:{display:"inline-block",width:"8px",height:"8px",background:"#FF8181","border-radius":"50%","margin-right":"4px"}}),n("span",{style:{"font-weight":"700","font-size":"0.9375rem"}},"项目分配方式")],-1)),ve=m(()=>n("div",null,"自动：您所创建的项目，自动分配给该合作商",-1)),fe=m(()=>n("div",null,"手动：您所创建的项目，需要手动分配给该合作商",-1)),he={style:{display:"flex"}},_e=m(()=>n("div",null,"自动：合作商分配给您的项目，全部自动接收",-1)),ye=m(()=>n("div",null,"手动：合作商分配给您的项目，手动选择接收",-1)),be=W({name:"PersonalNotificationCooperation",__name:"notification-cooperation",emits:["delSelectId"],setup(_,{expose:A,emit:F}){const U=X(),v=U.currencyType,p=c();c(1);const C=F,x=Y(),e=c({rules:{priceRatio:[{required:!0,message:"请输入价格比例",trigger:"blur"},{type:"number",trigger:"blur",validator:(t,o,u)=>{if(/^(100|[1-9]?\d)$/.test(o)==!1)return u(new Error("请输入 0 到 100 之间的数字"));u()}}],sendProjectType:[{required:!0,message:"请选择发送项目",trigger:"change"}],receiveProjectType:[{required:!0,message:"请选择接收项目",trigger:"change"}],exchangeRate:[{required:!0,message:"请输入汇率",trigger:"blur"},{pattern:/^(?!0(\.0+)?$)(\d+(\.\d{1,2})?)$/,message:"请输入一个有效的数字，不能小于0，最多保留两位小数",trigger:"blur"}]}}),f=c(!1);c([]);const R=c(),$={children:"children",label:"name"},q=async t=>{e.value.chargeUserId="",e.value=t,p.value=t.currencyType,v===p.value?e.value.exchangeRate=1:v===1&&p.value===2?e.value.exchangeRate=U.originalExchangeRate:v===2&&p.value===1&&(e.value.exchangeRate=(1/U.originalExchangeRate).toFixed(2));const o=await se.list({name:""});o.data&&(P.value=o.data),z()},P=c([]);c();const y=c(),B=(t,o)=>{o?(y.value.getCheckedKeys().forEach(h=>{h!==t.id&&y.value.setChecked(h,!1)}),e.value.chargeUserId=t.id,y.value.getCheckedNodes(),e.value.chargeUserName=t.name):(e.value.chargeUserId=[e.value.chargeUserId].filter(u=>u!==t.id),e.value.chargeUserId.length==0&&(e.value.chargeUserId="")),e.value.chargeUserId||(e.value.chargeUserName="")},z=async()=>{const t={id:e.value.id,type:1};await T.updateTenantAudit(t),await x.getUnreadTodo()},D=async()=>{const t={id:e.value.id,type:2};C("delSelectId"),await T.updateTenantAudit(t),await x.getUnreadTodo()},K=async()=>{R.value.validate(async t=>{if(t){if(Array.isArray(e.value.chargeUserId)&&(e.value.chargeUserId=e.value.chargeUserId[0]),e.value.receiveProjectType==1&&!e.value.chargeUserId){te.warning({message:"请选择部门",center:!0});return}const o={id:e.value.id,priceRatio:e.value.priceRatio,type:3,beInvitationChargeUserId:e.value.chargeUserId,beInvitationType:2,beInvitationChargeUserName:e.value.chargeUserName,sendProjectType:e.value.sendProjectType[0],receiveProjectType:e.value.receiveProjectType[0],exchangeRate:e.value.exchangeRate};C("delSelectId"),await T.updateTenantAudit(o),await x.getUnreadTodo()}})},L=c();function H(t){e.value.chargeUserId=t.chargeUserId,e.value.invitationType=t.invitationType,e.value.chargeUserName=t.chargeUserName}const M=t=>{Array.isArray(t)&&t.length>1&&(e.value.sendProjectType=[t[t.length-1]])},G=t=>{Array.isArray(t)&&t.length>1&&(e.value.receiveProjectType=[t[t.length-1]])};return A({showEdit:q}),(t,o)=>{const u=d("el-button"),h=d("el-input"),b=d("el-form-item"),N=ae,j=d("el-tooltip"),k=d("el-checkbox"),w=d("el-checkbox-group"),J=d("el-tree-select"),O=d("ElForm"),S=d("ElButton"),Q=d("el-dialog");return I(),V("div",ie,[ce,n("div",de,[n("div",ue,"尊贵的"+g(r(e).beInvitedName),1),n("div",pe,[n("div",null,"您好，我是"+g(r(e).invitationName)+"诚挚邀请您与我们一同协作共赢！",1),n("div",null,g(r(e).invitationName)+"货币类型为"+g(r(p)===1?"美元":"人民币")+"，与您的货币类型"+g(r(v)===1?"美元":"人民币")+"汇率换算为"+g(r(v)===r(p)?"1: 1":`1:
          ${r(e).exchangeRate}`)+"，请您悉知。",1)]),r(e).auditStatus===1?(I(),V("div",ge,[l(u,{onClick:D},{default:a(()=>[s("拒绝合作")]),_:1}),l(u,{type:"primary",onClick:o[0]||(o[0]=i=>f.value=!0)},{default:a(()=>[s(" 同意合作 ")]),_:1})])):E("",!0)]),l(Q,{modelValue:r(f),"onUpdate:modelValue":o[6]||(o[6]=i=>ee(f)?f.value=i:null),title:"合作配置",class:"hezuoDrawer"},{footer:a(()=>[l(S,{size:"large",onClick:o[5]||(o[5]=i=>f.value=!1)},{default:a(()=>[s(" 取消 ")]),_:1}),l(S,{type:"primary",size:"large",onClick:K},{default:a(()=>[s(" 确定 ")]),_:1})]),default:a(()=>[l(O,{ref_key:"FormRef",ref:R,rules:r(e).rules,model:r(e),"label-width":"7rem",labelPosition:"left"},{default:a(()=>[l(b,{label:"价格比例",prop:"priceRatio"},{default:a(()=>[l(h,{modelValue:r(e).priceRatio,"onUpdate:modelValue":o[1]||(o[1]=i=>r(e).priceRatio=i),clearable:""},{append:a(()=>[s("%")]),_:1},8,["modelValue"])]),_:1}),l(b,{"label-width":"7.5rem"},{label:a(()=>[me]),_:1}),l(b,{prop:"sendProjectType","label-width":"7rem"},{label:a(()=>[n("span",null,[l(j,{effect:"dark",placement:"top-start"},{content:a(()=>[ve,fe]),default:a(()=>[l(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),s(" 发送项目 ")])]),default:a(()=>[l(w,{modelValue:r(e).sendProjectType,"onUpdate:modelValue":o[2]||(o[2]=i=>r(e).sendProjectType=i),onChange:M},{default:a(()=>[l(k,{value:1},{default:a(()=>[s(" 自动 ")]),_:1}),l(k,{value:2},{default:a(()=>[s(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n("div",he,[l(b,{prop:"receiveProjectType",style:{"margin-right":"1.5625rem"}},{label:a(()=>[n("span",null,[l(j,{effect:"dark",placement:"top-start"},{content:a(()=>[_e,ye]),default:a(()=>[l(N,{class:"SvgIcon1",name:"i-ri:question-line"})]),_:1}),s(" 接收项目 ")])]),default:a(()=>[l(w,{modelValue:r(e).receiveProjectType,"onUpdate:modelValue":o[3]||(o[3]=i=>r(e).receiveProjectType=i),onChange:G},{default:a(()=>[l(k,{value:1},{default:a(()=>[s(" 自动 ")]),_:1}),l(k,{value:2},{default:a(()=>[s(" 手动 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(e).receiveProjectType==1?(I(),Z(J,{key:0,placeholder:"请选择部门",ref_key:"treeRef",ref:y,modelValue:r(e).chargeUserId,"onUpdate:modelValue":o[4]||(o[4]=i=>r(e).chargeUserId=i),data:r(P),"check-strictly":"","show-checkbox":"","default-expand-all":"","node-key":"id",props:$,onCheckChange:B,"check-on-click-node":!0,style:{width:"15.625rem"},"expand-on-click-node":!1},null,8,["modelValue","data"])):E("",!0)])]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),l(ne,{ref_key:"userRef",ref:L,onUserData:H},null,512)])}}}),Re=le(be,[["__scopeId","data-v-ddaf3810"]]);export{Re as default};
